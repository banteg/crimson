
// console_input_clear @ 0x00401030
// clears console input buffer
void console_input_clear()
{
  console_input_ready = 0;
  dword_47EA54 = 0;
  byte_47E448[0] = 0;
}

// console_input_buffer @ 0x00401050
// returns console input buffer pointer
char *console_input_buffer()
{
  return byte_47E448;
}

// console_input_poll @ 0x00401060
// polls text input and updates console buffer
int console_input_poll()
{
  int result; // eax
  int v1; // eax
  int v2; // eax
  int v3; // ecx
  int v4; // ecx

  result = (*(int (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 80))(grim_interface_ptr);
  if ( !console_input_enabled )
    return result;
  if ( !result || console_input_ready )
    return 0;
  if ( result == 13 )
  {
    v1 = dword_47EA54;
    console_input_ready = 1;
    byte_47E448[dword_47EA54] = 0;
    dword_47EA54 = v1 + 1;
    return 0;
  }
  if ( result != 8 )
  {
    v3 = dword_47EA54;
    byte_47E448[dword_47EA54] = result;
    v4 = v3 + 1;
    dword_47EA54 = v4;
    if ( v4 >= 1024 )
      dword_47EA54 = --v4;
    byte_47E448[v4] = 0;
    return 0;
  }
  v2 = dword_47EA54;
  if ( dword_47EA54 > 0 )
    v2 = --dword_47EA54;
  byte_47E448[v2] = 0;
  return 0;
}

// FUN_004010f0 @ 0x004010F0
// [binja] int32_t __stdcall sub_4010f0(int32_t arg1, int32_t arg2, int32_t arg3, int32_t arg4)
int FUN_004010f0(int arg1, int arg2, int arg3, int arg4)
{
  int result; // eax
  int v6; // edi

  result = arg3 - 1;
  if ( arg3 - 1 >= 0 )
  {
    v6 = arg3;
    do
    {
      result = ((int (__thiscall *)(int))arg4)(arg1);
      arg1 += arg2;
      --v6;
    }
    while ( v6 );
  }
  return result;
}

// console_cmd_arg_get @ 0x00401120
// returns console token N (1..argc-1); returns empty string if out of range
char *console_cmd_arg_get(int index)
{
  if ( console_cmd_argc <= 0 || index <= 0 || index >= console_cmd_argc )
    return (char *)off_471158;
  else
    return *(char **)&console_cmd_name[4 * index];
}

// console_cmd_argc_get @ 0x00401150
// returns current console token count (argc; includes the command token at index 0)
int console_cmd_argc_get()
{
  return console_cmd_argc;
}

// sub_401160 @ 0x00401160
// [binja] int32_t sub_401180()
int sub_401160()
{
  FUN_00401170();
  return crt_atexit(func);
}

// console_clear_log @ 0x004011A0
// clears console log history and resets scroll state (clear command handler)
void console_clear_log()
{
  _DWORD *v0; // esi
  int v1; // ecx

  v0 = console_log_head;
  if ( console_log_head )
  {
    if ( *(_DWORD *)console_log_head )
      crt_free(*(void **)console_log_head);
    v1 = v0[1];
    *v0 = 0;
    if ( v1 )
      console_log_node_free(1);
    v0[1] = 0;
    crt_free(v0);
  }
  console_log_head = 0;
  dword_47EEC0 = 0;
  dword_47EEC4 = 0;
}

// console_log_node_free @ 0x004011F0
// frees a console log node (text + next chain) and optionally frees the node
void console_log_node_free(char free_self)
{
  void **v1; // ecx
  void **v2; // esi
  void *v3; // ecx

  v2 = v1;
  if ( *v1 )
    crt_free(*v1);
  v3 = v2[1];
  *v2 = 0;
  if ( v3 )
    console_log_node_free(1);
  v2[1] = 0;
  if ( (free_self & 1) != 0 )
    crt_free(v2);
}

// console_cmd_quit @ 0x00401240
// sets the quit/exit flag (quit command handler)
void console_cmd_quit()
{
  byte_47EA50 = 1;
}

// console_cmd_exec @ 0x00401250
// executes a script file via console_exec_line (exec command handler)
void console_cmd_exec()
{
  FILE *v0; // esi
  char *v1; // eax

  if ( console_cmd_argc == 2 )
  {
    v0 = crt_fopen(console_cmd_arg1, mode);
    if ( v0 )
    {
      console_printf(&console_log_queue, "Executing '%s'\n", console_cmd_arg1);
      while ( crt_fgets(&dst, 511, v0) )
      {
        v1 = strchr(&dst, 10);
        if ( v1 )
          *v1 = 0;
        byte_47EA47 = 0;
        if ( dst != 47 && byte_47E849 != 47 && dst != 10 && dst && dst != 35 )
          console_exec_line(&dst);
      }
      crt_fclose(v0);
    }
    else
    {
      console_printf(&console_log_queue, "Cannot open file '%s'\n", console_cmd_arg1);
    }
  }
  else
  {
    console_printf(&console_log_queue, fmt);
  }
}

// console_cmd_extend @ 0x00401340
// extends console height (extendconsole command handler)
void console_cmd_extend()
{
  console_height_px = (__int64)flt_471144;
}

// console_cmd_minimize @ 0x00401360
// minimizes console height (minimizeconsole command handler)
void console_cmd_minimize()
{
  console_height_px = 300;
}

// console_cmdlist @ 0x00401370
// prints registered command names and a count (cmdlist command handler)
void console_cmdlist()
{
  int v0; // esi
  int i; // edi

  v0 = console_command_list_head;
  for ( i = 0; v0; ++i )
  {
    console_printf(&console_log_queue, "%s\n", *(const char **)v0);
    v0 = *(_DWORD *)(v0 + 4);
  }
  console_printf(&console_log_queue, "%i commands\n", i);
}

// console_vars @ 0x004013C0
// prints registered cvar names and a count (vars command handler)
void console_vars()
{
  int v0; // esi
  int i; // edi

  v0 = console_log_queue;
  for ( i = 0; v0; ++i )
  {
    console_printf(&console_log_queue, "%s\n", *(const char **)v0);
    v0 = *(_DWORD *)(v0 + 4);
  }
  console_printf(&console_log_queue, "%i variables\n", i);
}

// console_echo @ 0x00401410
// toggles echo on/off or prints args back into the console (echo command handler)
void console_echo()
{
  int i; // esi
  char *v1; // eax

  if ( console_cmd_argc_get() == 2 && !strcmp(aOff, console_cmd_arg_get(1)) )
  {
    console_echo_enabled = 0;
  }
  else if ( console_cmd_argc_get() == 2 && !strcmp(aOn, console_cmd_arg_get(1)) )
  {
    console_echo_enabled = 1;
  }
  else
  {
    for ( i = 1; i < console_cmd_argc_get(); ++i )
    {
      v1 = console_cmd_arg_get(i);
      console_printf(&console_log_queue, "%s ", v1);
    }
    console_printf(&console_log_queue, asc_4711C0);
  }
}

// console_cmd_set @ 0x00401510
// sets a cvar from tokens (set command handler)
void console_cmd_set()
{
  const char **v0; // eax

  if ( console_cmd_argc == 3 )
  {
    v0 = (const char **)console_register_cvar(console_cmd_arg1, console_cmd_arg2);
    console_printf(&console_log_queue, "'%s' set to '%s'\n", *v0, v0[4]);
  }
  else
  {
    console_printf(&console_log_queue, aSetVarValue);
  }
}

// console_init @ 0x00401560
// initializes the console state, registers core commands/cvars, and seeds prompt/version strings
int *console_init(int *console_state)
{
  int v1; // ecx
  int *v2; // esi
  char **v3; // eax
  char **v4; // edi
  _DWORD *v5; // eax

  v2 = (int *)v1;
  *(_BYTE *)(v1 + 12) = 1;
  *(_DWORD *)(v1 + 24) = 300;
  *(_DWORD *)(v1 + 28) = -1013579776;
  *(_DWORD *)(v1 + 36) = 0;
  *(_DWORD *)(v1 + 8) = 0;
  v3 = (char **)operator new(0x24u);
  v4 = v3;
  if ( v3 )
  {
    v3[6] = 0;
    v3[7] = 0;
    v3[8] = 0;
    *v3 = strdup_malloc(src);
    v4[1] = 0;
    v4[2] = 0;
    v4[3] = 0;
    v4[4] = 0;
    v4[5] = 0;
  }
  else
  {
    v4 = 0;
  }
  *v2 = (int)v4;
  v4[3] = (char *)1065353216;
  *(_DWORD *)(*v2 + 16) = strdup_malloc(a07);
  *(_DWORD *)(*v2 + 20) = 1;
  dword_47F4D0 = (int)console_register_cvar(name, value);
  *(_DWORD *)str = 0;
  dword_47EAA4 = 0;
  dword_47EAA8 = 0;
  dword_47EAAC = 0;
  console_cmd_argc = 0;
  console_register_command(console_cmd_cmdlist, console_cmdlist);
  console_register_command(console_cmd_vars, console_vars);
  console_register_command(console_cmd_echo, console_echo);
  console_register_command(aSet, console_cmd_set);
  console_register_command(aQuit, console_cmd_quit);
  console_register_command(console_cmd_clear, console_clear_log);
  console_register_command(aExtendconsole, console_cmd_extend);
  console_register_command(aMinimizeconsol, console_cmd_minimize);
  console_register_command(aExec, console_cmd_exec);
  v5 = operator new(8u);
  if ( v5 )
  {
    v5[1] = 0;
    *v5 = 0;
  }
  else
  {
    v5 = 0;
  }
  v2[4] = (int)v5;
  *(_DWORD *)v2[4] = strdup_malloc(szPassword);
  v2[5] = 0;
  return v2;
}

// FUN_004016e0 @ 0x004016E0
// [binja] void __fastcall sub_4016e0(int32_t* arg1)
void FUN_004016e0(int *arg1)
{
  int v1; // ecx
  int v2; // edi
  int v3; // esi
  int v4; // ecx
  void **v5; // esi
  void **v6; // esi
  int v7; // esi
  int v8; // ecx

  v2 = v1;
  v3 = *(_DWORD *)(v1 + 8);
  if ( v3 )
  {
    if ( *(_DWORD *)v3 )
      crt_free(*(void **)v3);
    v4 = *(_DWORD *)(v3 + 4);
    *(_DWORD *)v3 = 0;
    if ( v4 )
      console_log_node_free(1);
    *(_DWORD *)(v3 + 4) = 0;
    crt_free((void *)v3);
  }
  v5 = *(void ***)v2;
  *(_DWORD *)(v2 + 8) = 0;
  if ( v5 )
  {
    if ( *v5 )
      crt_free(*v5);
    *v5 = 0;
    crt_free(v5);
  }
  v6 = *(void ***)(v2 + 4);
  *(_DWORD *)v2 = 0;
  if ( v6 )
  {
    if ( *v6 )
      crt_free(*v6);
    *v6 = 0;
    crt_free(v6);
  }
  v7 = *(_DWORD *)(v2 + 16);
  *(_DWORD *)(v2 + 4) = 0;
  if ( v7 )
  {
    if ( *(_DWORD *)v7 )
      crt_free(*(void **)v7);
    v8 = *(_DWORD *)(v7 + 4);
    *(_DWORD *)v7 = 0;
    if ( v8 )
      console_log_node_free(1);
    *(_DWORD *)(v7 + 4) = 0;
    crt_free((void *)v7);
  }
  *(_DWORD *)(v2 + 16) = 0;
}

// console_push_line @ 0x004017A0
// pushes line into console queue
char console_push_line(char *line)
{
  int v1; // ecx
  int v2; // ebp
  int v3; // eax
  int v4; // esi
  int i; // eax
  int v6; // edi
  int v7; // ecx
  char **v8; // eax
  char **v9; // esi

  v2 = v1;
  LOBYTE(v3) = *(_BYTE *)(v1 + 12);
  if ( (_BYTE)v3 )
  {
    if ( *(_DWORD *)(v1 + 32) == 4096 )
    {
      v4 = *(_DWORD *)(v1 + 8);
      for ( i = *(_DWORD *)(v4 + 4); *(_DWORD *)(i + 4); i = *(_DWORD *)(i + 4) )
        v4 = i;
      v6 = *(_DWORD *)(v4 + 4);
      if ( v6 )
      {
        if ( *(_DWORD *)v6 )
          crt_free(*(void **)v6);
        v7 = *(_DWORD *)(v6 + 4);
        *(_DWORD *)v6 = 0;
        if ( v7 )
          console_log_node_free(1);
        *(_DWORD *)(v6 + 4) = 0;
        crt_free((void *)v6);
      }
      *(_DWORD *)(v4 + 4) = 0;
      --*(_DWORD *)(v2 + 32);
    }
    v8 = (char **)operator new(8u);
    if ( v8 )
    {
      v8[1] = 0;
      *v8 = 0;
      v9 = v8;
    }
    else
    {
      v9 = 0;
    }
    *v9 = strdup_malloc(line);
    v9[1] = *(char **)(v2 + 8);
    v3 = *(_DWORD *)(v2 + 32) + 1;
    *(_DWORD *)(v2 + 8) = v9;
    *(_DWORD *)(v2 + 32) = v3;
  }
  return v3;
}

// console_printf @ 0x00401870
// formats then pushes line
char console_printf(void *console_state, char *fmt, ...)
{
  char result; // al
  va_list ArgList; // [esp+10h] [ebp+Ch] BYREF

  va_start(ArgList, fmt);
  result = *((_BYTE *)console_state + 12);
  if ( result )
  {
    crt_vsprintf(line, fmt, ArgList);
    return console_push_line(line);
  }
  return result;
}

// console_set_open @ 0x004018B0
// sets console_open_flag (console_state+0x28) and console_input_enabled (0x0047f4d4); flushes input via Grim2D vtable +0x4c
void console_set_open(char open)
{
  int v1; // ecx

  *(_BYTE *)(v1 + 40) = open;
  console_input_enabled = open;
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
}

// console_history_apply @ 0x004018D0
// loads a history entry into the input buffer (used by Up/Down navigation)
void console_history_apply(int console_state)
{
  int v1; // ecx
  int v2; // eax
  int v3; // edx
  int v4; // edi

  v2 = *(_DWORD *)(v1 + 16);
  v3 = 0;
  v4 = *(_DWORD *)(v1 + 20) - 1;
  if ( v4 > 0 )
  {
    while ( *(_DWORD *)(v2 + 4) )
    {
      ++v3;
      v2 = *(_DWORD *)(v2 + 4);
      if ( v3 >= v4 )
        goto LABEL_6;
    }
    *(_DWORD *)(v1 + 20) = v3;
  }
LABEL_6:
  strcpy(byte_47E448, *(const char **)v2);
  dword_47EA54 = strlen(byte_47E448);
  console_input_ready = 0;
}

// console_exec_line @ 0x00401940
// executes a console command or cvar assignment from a line
char console_exec_line(char *line)
{
  _BYTE *v1; // ecx
  _BYTE *v2; // edi
  char result; // al
  const char **v4; // esi
  char (**v5)(void); // eax
  double v6; // st7
  char *v7; // [esp+4h] [ebp-Ch]

  v2 = v1;
  console_tokenize_line(line);
  result = console_cmd_argc;
  if ( console_cmd_argc )
  {
    v4 = (const char **)console_cvar_find(*(char **)console_cmd_name);
    v5 = (char (**)(void))console_command_find(*(char **)console_cmd_name);
    if ( v4 )
    {
      if ( console_cmd_argc == 2 )
      {
        if ( v4[4] )
          crt_free((void *)v4[4]);
        v4[4] = 0;
        v4[4] = strdup_malloc(console_cmd_arg1);
        v6 = crt_atof_l(console_cmd_arg1, v7);
        *((float *)v4 + 3) = v6;
        result = v2[12];
        if ( result )
          return console_printf(v2, "\"%s\" set to \"%s\" (%ff)\n", *v4, v4[4], v6);
      }
      else
      {
        result = v2[12];
        if ( result )
          return console_printf(v2, "\"%s\" is \"%s\" (%ff)\n", *v4, v4[4], *((float *)v4 + 3));
      }
    }
    else if ( v5 )
    {
      return v5[2]();
    }
    else
    {
      return console_printf(v2, "Unknown command \"%s\"\n", *(const char **)console_cmd_name);
    }
  }
  return result;
}

// console_update @ 0x00401A40
// console update loop: input polling, history, autocomplete, and key handling
void console_update(int console_state)
{
  int v1; // ecx
  double v2; // st7
  int v3; // ebp
  double v4; // st7
  int v5; // eax
  int v6; // eax
  char *v7; // eax
  char *v8; // eax
  char *v9; // edx
  char *v10; // eax
  char **v11; // eax
  char **v12; // esi
  char *v13; // eax
  char *v14; // eax
  char *v15; // eax
  double v16; // st7
  int v17; // [esp+0h] [ebp-8h]

  v2 = *(float *)&dword_47EA48 * 3.5;
  v3 = v1;
  if ( *(_BYTE *)(v1 + 40) )
  {
    v4 = flt_47115C - v2;
    flt_47115C = v4;
    if ( v4 < 0.0 )
      flt_47115C = 0.0;
    *(float *)(v1 + 28) = sin((1.0 - flt_47115C) * 1.5707964) * (double)*(int *)(v1 + 24) - (double)*(int *)(v1 + 24);
    console_input_poll();
    if ( ((*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 29)
       || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 157))
      && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 200) )
    {
      ++*(_DWORD *)(v3 + 36);
    }
    else if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(
                grim_interface_ptr,
                200) )
    {
      ++*(_DWORD *)(v3 + 20);
      console_history_apply(v17);
    }
    if ( ((*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 29)
       || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 157))
      && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 208) )
    {
      --*(_DWORD *)(v3 + 36);
    }
    else if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(
                grim_interface_ptr,
                208) )
    {
      v5 = *(_DWORD *)(v3 + 20) - 1;
      *(_DWORD *)(v3 + 20) = v5;
      if ( v5 < 0 )
        *(_DWORD *)(v3 + 20) = 0;
      console_history_apply(v17);
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 203) )
    {
      if ( --dword_47EA54 < 0 )
        dword_47EA54 = 0;
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 205) )
    {
      ++dword_47EA54;
      if ( dword_47EA54 > (int)strlen(byte_47E448) )
        dword_47EA54 = strlen(byte_47E448);
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 201) )
      *(_DWORD *)(v3 + 36) += 2;
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 209) )
    {
      v6 = *(_DWORD *)(v3 + 36);
      *(_DWORD *)(v3 + 36) = v6 - 2;
      if ( v6 - 2 < 0 )
        *(_DWORD *)(v3 + 36) = 0;
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 199) )
      *(_DWORD *)(v3 + 36) += 20;
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 207) )
      *(_DWORD *)(v3 + 36) = 0;
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 15) )
    {
      v7 = console_input_buffer();
      console_tokenize_line(v7);
      v8 = console_input_buffer();
      v9 = console_cvar_autocomplete(v8);
      if ( v9 || (v10 = console_input_buffer(), (v9 = console_command_autocomplete(v10)) != 0) )
      {
        strcpy(byte_47E448, v9);
        dword_47EA54 = strlen(v9);
      }
    }
    if ( console_input_ready )
    {
      if ( strcmp(**(const char ***)(v3 + 16), console_input_buffer()) )
      {
        v11 = (char **)operator new(8u);
        if ( v11 )
        {
          v11[1] = 0;
          *v11 = 0;
          v12 = v11;
        }
        else
        {
          v12 = 0;
        }
        v13 = console_input_buffer();
        *v12 = strdup_malloc(v13);
        v12[1] = *(char **)(v3 + 16);
        *(_DWORD *)(v3 + 16) = v12;
      }
      *(_DWORD *)(v3 + 20) = 0;
      v14 = console_input_buffer();
      console_printf(&console_log_queue, "> %s\n", v14);
      v15 = console_input_buffer();
      console_exec_line(v15);
      console_input_clear();
      (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28);
    }
    else
    {
      console_input_buffer();
      (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28);
    }
  }
  else
  {
    v16 = v2 + flt_47115C;
    flt_47115C = v16;
    if ( v16 > 1.0 )
      flt_47115C = 1.0;
    *(float *)(v1 + 28) = sin((1.0 - flt_47115C) * 1.5707964) * (double)*(int *)(v1 + 24) - (double)*(int *)(v1 + 24);
  }
}

// FUN_00401dd0 @ 0x00401DD0
// [binja] int32_t __fastcall sub_401dd0(void* arg1)
int FUN_00401dd0(void *arg1)
{
  int v1; // ecx
  int v2; // esi
  int v3; // ecx
  __int16 v4; // fps
  double v5; // st7
  bool v6; // c0
  char v7; // c2
  bool v8; // c3
  int result; // eax
  int *v10; // edi
  int v11; // ebp
  double v12; // st7
  double v13; // st7
  double v14; // st7
  double v15; // st6
  int v16; // ebx
  char *v17; // eax
  int v18; // ebx
  int v19; // eax
  int v20; // ebx
  int v21; // edx
  char v23; // c3
  int v24; // edi
  int v25; // edi
  long double v26; // st7
  double v27; // st6
  double v28; // st7
  int v29; // edx
  int v30; // ebx
  char *v31; // eax
  int v32; // [esp+D8h] [ebp-38h]
  int v33; // [esp+D8h] [ebp-38h]
  float v34; // [esp+D8h] [ebp-38h]
  float v35; // [esp+D8h] [ebp-38h]
  float v36; // [esp+D8h] [ebp-38h]
  int v37; // [esp+D8h] [ebp-38h]
  float v38; // [esp+DCh] [ebp-34h]
  int v39; // [esp+DCh] [ebp-34h]
  int v40; // [esp+DCh] [ebp-34h]
  float v41; // [esp+DCh] [ebp-34h]
  float v42; // [esp+DCh] [ebp-34h]
  float v43; // [esp+DCh] [ebp-34h]
  float v44; // [esp+DCh] [ebp-34h]
  float v45; // [esp+DCh] [ebp-34h]
  int v46; // [esp+DCh] [ebp-34h]
  float v47; // [esp+DCh] [ebp-34h]
  float v48; // [esp+E0h] [ebp-30h]
  int v49; // [esp+E0h] [ebp-30h]
  int v50; // [esp+E0h] [ebp-30h]
  float v51; // [esp+E0h] [ebp-30h]
  float v52; // [esp+E0h] [ebp-30h]
  float v53; // [esp+E0h] [ebp-30h]
  char *v54; // [esp+E0h] [ebp-30h]
  float v55; // [esp+E0h] [ebp-30h]
  int v56; // [esp+E0h] [ebp-30h]
  int v57; // [esp+E0h] [ebp-30h]
  float v58; // [esp+E0h] [ebp-30h]
  float v59; // [esp+F4h] [ebp-1Ch]
  float v60; // [esp+F4h] [ebp-1Ch]
  float v61; // [esp+F4h] [ebp-1Ch]
  int v62; // [esp+F4h] [ebp-1Ch]
  int v63; // [esp+F4h] [ebp-1Ch]
  float v64; // [esp+F4h] [ebp-1Ch]
  int v65; // [esp+F8h] [ebp-18h] BYREF
  float v66; // [esp+FCh] [ebp-14h]
  int v67; // [esp+100h] [ebp-10h] BYREF
  int v68; // [esp+104h] [ebp-Ch]
  int v69; // [esp+108h] [ebp-8h]
  float v70; // [esp+10Ch] [ebp-4h]

  v2 = v1;
  v3 = *(_DWORD *)(v1 + 24);
  result = -v3;
  v65 = -v3;
  v5 = (double)-v3;
  v6 = v5 < *(float *)(v2 + 28);
  v7 = 0;
  v8 = v5 == *(float *)(v2 + 28);
  LOWORD(result) = v4;
  if ( v5 < *(float *)(v2 + 28) )
  {
    v10 = *(int **)(v2 + 8);
    v11 = v3 / 16 - 2;
    if ( *(_DWORD *)(v2 + 32) <= v11 )
      v11 = *(_DWORD *)(v2 + 32);
    v59 = ((double)v3 + *(float *)(v2 + 28)) / (double)v3;
    if ( v59 <= 1.0 )
    {
      if ( v59 < 0.0 )
        v59 = 0.0;
    }
    else
    {
      v59 = 1.0;
    }
    (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1058642330,
      1058642330,
      1058642330,
      COERCE_FLOAT(LODWORD(v59)));
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    v12 = *(float *)(v2 + 28);
    v70 = v59;
    v66 = v12;
    v13 = (double)*(int *)(v2 + 24);
    v67 = 1041235968;
    v68 = 1044381696;
    v69 = 1049886720;
    v38 = v13;
    *(float *)&v65 = 0.0;
    (*(void (__thiscall **)(int, int *, _DWORD, _DWORD, int *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v65,
      LODWORD(screen_width_f),
      LODWORD(v38),
      &v67);
    v48 = ((double)*(int *)(v2 + 24) + *(float *)(v2 + 28)) / (double)*(int *)(v2 + 24);
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1036831949,
      1058642330,
      1065353216,
      LODWORD(v48));
    v14 = (double)*(int *)(v2 + 24);
    v15 = v14 + *(float *)(v2 + 28);
    v67 = 1046478848;
    v68 = 1049100288;
    v69 = 1052508160;
    *(float *)&v65 = 0.0;
    v60 = v15;
    v70 = v15 / v14;
    v66 = v60 - 4.0;
    (*(void (__thiscall **)(int, int *, _DWORD, int, int *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v65,
      LODWORD(screen_width_f),
      1082130432,
      &v67);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      2,
      v32,
      v39,
      v49);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1056964608,
      v33,
      v40,
      v50);
    v51 = ((double)*(int *)(v2 + 24) + *(float *)(v2 + 28)) / (double)*(int *)(v2 + 24) * 0.30000001;
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v51));
    v41 = (double)*(int *)(v2 + 24) + *(float *)(v2 + 28) - 18.0;
    v34 = screen_width_f - 210.0;
    (*(void (__stdcall **)(_DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
      LODWORD(v34),
      LODWORD(v41),
      aCrimsonland199);
    v52 = ((double)*(int *)(v2 + 24) + *(float *)(v2 + 28)) / (double)*(int *)(v2 + 24) * 0.5;
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v52));
    v53 = ((double)*(int *)(v2 + 24) + *(float *)(v2 + 28)) / (double)*(int *)(v2 + 24);
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v53));
    if ( *(float *)(dword_47F4D0 + 12) == 0.0 )
    {
      v18 = *(_DWORD *)grim_interface_ptr;
      v54 = console_input_buffer();
      v65 = 16 * (v11 + 1);
      v35 = (double)v65 + *(float *)(v2 + 28);
      (*(void (**)(int, int, _DWORD, char *, ...))(v18 + 328))(grim_interface_ptr, 1092616192, LODWORD(v35), aS_1, v54);
    }
    else
    {
      v65 = 16 * (v11 + 1);
      v61 = (float)v65;
      v42 = v61 + *(float *)(v2 + 28);
      (*(void (__stdcall **)(int, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 316))(
        1092616192,
        LODWORD(v42),
        console_prompt_string);
      v16 = *(_DWORD *)grim_interface_ptr;
      v17 = console_input_buffer();
      v43 = v61 + *(float *)(v2 + 28);
      (*(void (__thiscall **)(int, int, _DWORD, char *))(v16 + 316))(grim_interface_ptr, 1104150528, LODWORD(v43), v17);
    }
    v55 = ((double)*(int *)(v2 + 24) + *(float *)(v2 + 28)) / (double)*(int *)(v2 + 24);
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1058642330,
      1058642330,
      1060320051,
      LODWORD(v55));
    v19 = *(_DWORD *)(v2 + 36);
    if ( v19 <= 0 )
    {
LABEL_14:
      if ( v10 )
      {
        v20 = 16 * v11;
        v62 = 16 * v11;
        do
        {
          if ( v11 < 0 )
            break;
          v21 = *(_DWORD *)grim_interface_ptr;
          v56 = *v10;
          v44 = (double)v62 + *(float *)(v2 + 28);
          if ( v23 )
            (*(void (__stdcall **)(int, float, int))(v21 + 324))(1092616192, COERCE_FLOAT(LODWORD(v44)), v56);
          else
            (*(void (__stdcall **)(int, float, int))(v21 + 316))(1092616192, COERCE_FLOAT(LODWORD(v44)), v56);
          v10 = (int *)v10[1];
          --v11;
          v20 -= 16;
          v62 = v20;
        }
        while ( v10 );
      }
    }
    else
    {
      while ( v10 )
      {
        v10 = (int *)v10[1];
        if ( --v19 <= 0 )
          goto LABEL_14;
      }
    }
    v24 = *(_DWORD *)(v2 + 32);
    v63 = *(_DWORD *)(v2 + 24);
    if ( v24 > v63 / 16 - 2 )
      v24 = v63 / 16 - 2;
    v25 = v24 + 1;
    v26 = sin(flt_47EA4C * 3.0);
    *(float *)&v65 = v26;
    v27 = 8.0;
    crt_ci_pow();
    if ( 8.0 < 0.2 )
      v27 = 0.2;
    v64 = ((double)v63 + *(float *)(v2 + 28)) / (double)v63 * v27;
    if ( v64 <= 1.0 )
    {
      if ( v64 < 0.0 )
        v64 = 0.0;
    }
    else
    {
      v64 = 1.0;
    }
    (*(void (__usercall **)(int@<ecx>, int, int, int, float, long double@<st0>))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v64)),
      v26);
    if ( *(float *)(dword_47F4D0 + 12) == 0.0 )
    {
      v65 = 16 * v25;
      v30 = *(_DWORD *)grim_interface_ptr;
      v47 = (double)(16 * v25) + *(float *)(v2 + 28) + 2.0;
      v31 = console_input_buffer();
      v67 = (*(int (__thiscall **)(int, char *, _DWORD, char *))(v30 + 332))(
              grim_interface_ptr,
              v31,
              LODWORD(v47),
              asc_4712B8);
      v58 = (double)v67 + 16.0;
      (*(void (__thiscall **)(int, _DWORD))(v30 + 324))(grim_interface_ptr, LODWORD(v58));
    }
    else
    {
      v65 = 16 * v25;
      v28 = (double)(16 * v25) + *(float *)(v2 + 28);
      v29 = *(_DWORD *)grim_interface_ptr;
      v65 = 8 * dword_47EA54;
      v45 = v28 + 2.0;
      v36 = (double)(8 * dword_47EA54) + 26.0;
      (*(void (__stdcall **)(_DWORD, _DWORD, char *))(v29 + 316))(LODWORD(v36), LODWORD(v45), asc_4712B8);
    }
    return (*(int (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
             grim_interface_ptr,
             21,
             2,
             v37,
             v46,
             v57);
  }
  return result;
}

// console_register_cvar @ 0x00402350
// registers or updates a console cvar entry (stores string + float value)
void *console_register_cvar(char *name, char *value)
{
  void **v2; // ecx
  void **v3; // ebx
  void **v4; // eax
  void **v5; // esi
  _DWORD *v7; // eax
  void *v8; // ebx
  _DWORD *i; // eax
  char **v10; // eax
  char **v11; // esi
  char **v12; // eax
  char **v13; // esi
  char *v14; // [esp-4h] [ebp-14h]
  char *v15; // [esp-4h] [ebp-14h]
  char *v16; // [esp-4h] [ebp-14h]

  v3 = v2;
  v4 = (void **)console_cvar_find(name);
  v5 = v4;
  if ( v4 )
  {
    if ( v4[4] )
      crt_free(v4[4]);
    v5[4] = 0;
    v5[4] = strdup_malloc(value);
    *((float *)v5 + 3) = crt_atof_l(value, v14);
    return v5;
  }
  else
  {
    v7 = *v3;
    if ( *v3 )
    {
      v8 = *v3;
      for ( i = (_DWORD *)v7[1]; i; i = (_DWORD *)i[1] )
        v8 = i;
      v10 = (char **)operator new(0x24u);
      v11 = v10;
      if ( v10 )
      {
        v10[6] = 0;
        v10[7] = 0;
        v10[8] = 0;
        *v10 = strdup_malloc(name);
        v11[1] = 0;
        v11[2] = 0;
        v11[3] = 0;
        v11[4] = 0;
        v11[5] = 0;
      }
      else
      {
        v11 = 0;
      }
      *((_DWORD *)v8 + 1) = v11;
      *(_DWORD *)(*((_DWORD *)v8 + 1) + 16) = strdup_malloc(value);
      *(float *)(*((_DWORD *)v8 + 1) + 12) = crt_atof_l(value, v15);
      return (void *)*((_DWORD *)v8 + 1);
    }
    else
    {
      v12 = (char **)operator new(0x24u);
      v13 = v12;
      if ( v12 )
      {
        v12[6] = 0;
        v12[7] = 0;
        v12[8] = 0;
        *v12 = strdup_malloc(name);
        v13[1] = 0;
        v13[2] = 0;
        v13[3] = 0;
        v13[4] = 0;
        v13[5] = 0;
      }
      else
      {
        v13 = 0;
      }
      *v3 = v13;
      *((_DWORD *)*v3 + 4) = strdup_malloc(value);
      *((float *)*v3 + 3) = crt_atof_l(value, v16);
      return *v3;
    }
  }
}

// console_cvar_find @ 0x00402480
// finds a cvar entry by name
void *console_cvar_find(char *name)
{
  int *v1; // ecx
  int v2; // edi

  v2 = *v1;
  if ( !*v1 )
    return 0;
  while ( strcmp(name, *(const char **)v2) )
  {
    v2 = *(_DWORD *)(v2 + 4);
    if ( !v2 )
      return 0;
  }
  return (void *)v2;
}

// console_cvar_unregister @ 0x004024E0
// removes a cvar entry by name
char console_cvar_unregister(char *name)
{
  _DWORD *v1; // ecx
  _DWORD *v2; // esi
  void *v3; // eax
  _DWORD *v4; // ecx
  void *v6; // edx

  v2 = v1;
  v3 = console_cvar_find(name);
  if ( !v3 )
    return 0;
  v4 = (_DWORD *)*v2;
  if ( v3 == (void *)*v2 )
  {
    *v2 = v4[1];
    return 1;
  }
  if ( !v4 )
    return 0;
  while ( 1 )
  {
    v6 = (void *)v4[1];
    if ( v6 == v3 )
      break;
    v4 = (_DWORD *)v4[1];
    if ( !v6 )
      return 0;
  }
  v4[1] = *(_DWORD *)(v4[1] + 4);
  return 1;
}

// console_command_unregister @ 0x00402530
// removes a console command entry by name
char console_command_unregister(char *name)
{
  int v1; // ecx
  int v2; // esi
  _DWORD *v3; // eax
  _DWORD *v4; // ecx
  _DWORD *v6; // edx

  v2 = v1;
  v3 = console_command_find(name);
  if ( !v3 )
    return 0;
  v4 = *(_DWORD **)(v2 + 4);
  if ( v3 == v4 )
  {
    *(_DWORD *)(v2 + 4) = v4[1];
    return 1;
  }
  if ( !v4 )
    return 0;
  while ( 1 )
  {
    v6 = (_DWORD *)v4[1];
    if ( v6 == v3 )
      break;
    v4 = (_DWORD *)v4[1];
    if ( !v6 )
      return 0;
  }
  v4[1] = *(_DWORD *)(v4[1] + 4);
  return 1;
}

// console_tokenize_line @ 0x00402580
// splits a console line into tokens
void console_tokenize_line(char *line)
{
  char *v1; // eax
  int v2; // edi
  char **i; // esi
  char *v4; // eax

  console_cmd_argc = 0;
  if ( line && (strlen(line) < 2 || *line != 47 || line[1] != 47) )
  {
    strcpy(str, line);
    v1 = crt_strtok(str, delim);
    if ( v1 )
    {
      *(_DWORD *)console_cmd_name = v1;
      v2 = 1;
      for ( i = &console_cmd_arg1; ; ++i )
      {
        v4 = crt_strtok(0, delim);
        if ( !v4 )
          break;
        *i = v4;
        ++v2;
      }
      console_cmd_argc = v2;
    }
  }
}

// console_cvar_autocomplete @ 0x00402630
// returns exact or prefix-matched cvar name
char *console_cvar_autocomplete(char *prefix)
{
  int *v1; // ecx
  int *v2; // edx
  unsigned int v3; // kr04_4
  size_t v4; // ebx
  int v5; // edx
  int v6; // edi
  int v7; // esi

  v2 = v1;
  v3 = strlen(prefix) + 1;
  v4 = v3 - 1;
  if ( v3 == 1 )
    return 0;
  v5 = *v2;
  v6 = v5;
  if ( !v5 )
  {
LABEL_6:
    v7 = v5;
    if ( v5 )
    {
      while ( strncmp(prefix, *(const char **)v7, v4) )
      {
        v7 = *(_DWORD *)(v7 + 4);
        if ( !v7 )
          return 0;
      }
      return *(char **)v7;
    }
    return 0;
  }
  while ( strcmp(prefix, *(const char **)v6) )
  {
    v6 = *(_DWORD *)(v6 + 4);
    if ( !v6 )
    {
      v4 = v3 - 1;
      goto LABEL_6;
    }
  }
  return *(char **)v6;
}

// console_register_command @ 0x004026E0
// registers a console command and handler
void console_register_command(char *name, void *handler)
{
  int v2; // ecx
  int v3; // edi
  char **v4; // esi
  int v5; // ecx
  int i; // eax

  v3 = v2;
  v4 = (char **)operator new(0xCu);
  if ( v4 )
  {
    *v4 = strdup_malloc(name);
    v4[1] = 0;
    v4[2] = 0;
  }
  else
  {
    v4 = 0;
  }
  v4[2] = (char *)handler;
  v5 = *(_DWORD *)(v3 + 4);
  if ( v5 )
  {
    for ( i = *(_DWORD *)(v5 + 4); i; i = *(_DWORD *)(i + 4) )
      v5 = i;
    *(_DWORD *)(v5 + 4) = v4;
  }
  else
  {
    *(_DWORD *)(v3 + 4) = v4;
  }
}

// console_command_find @ 0x00402750
// finds a console command entry by name
void *console_command_find(char *name)
{
  int v1; // ecx
  int v2; // edi

  v2 = *(_DWORD *)(v1 + 4);
  if ( !v2 )
    return 0;
  while ( strcmp(name, *(const char **)v2) )
  {
    v2 = *(_DWORD *)(v2 + 4);
    if ( !v2 )
      return 0;
  }
  return (void *)v2;
}

// console_command_autocomplete @ 0x004027B0
// returns exact or prefix-matched command name
char *console_command_autocomplete(char *prefix)
{
  int v1; // ecx
  int v2; // edx
  unsigned int v3; // kr04_4
  size_t v4; // ebx
  int v5; // edx
  int v6; // edi
  int v7; // esi

  v2 = v1;
  v3 = strlen(prefix) + 1;
  v4 = v3 - 1;
  if ( v3 == 1 )
    return 0;
  v5 = *(_DWORD *)(v2 + 4);
  v6 = v5;
  if ( !v5 )
  {
LABEL_6:
    v7 = v5;
    if ( v5 )
    {
      while ( strncmp(prefix, *(const char **)v7, v4) )
      {
        v7 = *(_DWORD *)(v7 + 4);
        if ( !v7 )
          return 0;
      }
      return *(char **)v7;
    }
    return 0;
  }
  while ( strcmp(prefix, *(const char **)v6) )
  {
    v6 = *(_DWORD *)(v6 + 4);
    if ( !v6 )
    {
      v4 = v3 - 1;
      goto LABEL_6;
    }
  }
  return *(char **)v6;
}

// console_flush_log @ 0x00402860
// flushes console lines to the log file
int console_flush_log(void *console_state, char *filename)
{
  int v2; // ecx
  int v3; // ebp
  char *v4; // eax
  int result; // eax
  FILE *v6; // ebx
  int i; // esi
  int v8; // eax
  int v9; // ecx

  v3 = v2;
  v4 = game_build_path((char *)console_state);
  result = (int)crt_fopen(v4, aWt);
  v6 = (FILE *)result;
  if ( result )
  {
    for ( i = *(_DWORD *)(v3 + 32) - 1; i >= 0; --i )
    {
      v8 = *(_DWORD *)(v3 + 8);
      if ( i > 0 )
      {
        v9 = i;
        do
        {
          v8 = *(_DWORD *)(v8 + 4);
          --v9;
        }
        while ( v9 );
      }
      crt_fwrite(*(void **)v8, strlen(*(const char **)v8), 1u, v6);
    }
    crt_fflush(v6);
    result = crt_fclose(v6);
    LOBYTE(result) = 1;
  }
  else
  {
    LOBYTE(result) = 0;
  }
  return result;
}

// config_init_defaults @ 0x004028F0
// initializes default config globals, key bindings, and name slots
int config_init_defaults()
{
  int v0; // ebx
  int v1; // ebp
  char *v3; // [esp+10h] [ebp-4h]

  config_player_name_buf = 0;
  dword_4803C0 = 0;
  config_hardcore = 0;
  config_full_version = 1;
  config_perk_prompt_counter = 0;
  flt_4807BC = 0.5;
  dword_480798 = 1;
  config_key_pick_perk = 257;
  config_key_reload = 258;
  byte_4807B6 = 0;
  *(_DWORD *)config_texture_scale = 1065353216;
  config_score_load_gate = 0;
  byte_4803C4 = 0;
  v0 = 0;
  v3 = config_saved_name_0;
  v1 = 34;
  do
  {
    config_blob[v1++] = v0;
    strcpy(v3, aDefault);
    ++v0;
    v3 += 27;
  }
  while ( v1 < 42 );
  HIWORD(config_blob[0]) = 0;
  memset(config_player_name, 0, sizeof(config_player_name));
  strcpy(config_player_name, default_player_name);
  config_name_slot_count = 1;
  config_name_slot_selected = 0;
  LOWORD(config_blob[0]) = 0;
  config_fx_toggle = 0;
  byte_4807A8 = 1;
  dword_4804F0 = 0;
  dword_4804F4 = 0;
  dword_4803B4 = 0;
  config_display_bpp = 32;
  config_windowed = 0;
  config_game_mode = 1;
  config_fx_detail_flag0 = 1;
  byte_480357 = 0;
  config_fx_detail_flag1 = 1;
  config_player_mode_flags[0] = 2;
  dword_480368 = 2;
  config_aim_scheme[0] = 0;
  dword_480390 = 0;
  config_fx_detail_flag2 = 1;
  config_player_count = 1;
  config_p1_turn_right = 32;
  config_detail_preset = 5;
  dword_4804F8 = 9000;
  dword_4804FC = 27000;
  dword_4804EC = 100;
  *(_DWORD *)config_screen_width = 800;
  config_screen_height = 600;
  config_sfx_volume = 1.0;
  config_music_volume = 1.0;
  config_p1_move_forward[0] = 17;
  config_p1_move_backward[0] = 31;
  config_p1_turn_left = 30;
  config_p1_fire = 256;
  config_p1_key_reserved_0 = 382;
  config_p1_key_reserved_1 = 382;
  config_p1_aim_left = 16;
  config_p1_aim_right = 18;
  config_p1_axis_aim_y = 319;
  config_p1_axis_aim_x = 320;
  config_p1_axis_move_y = 321;
  config_p1_axis_move_x = 339;
  config_p1_padding_0 = 382;
  config_p1_padding_1 = 382;
  config_p1_padding_2 = 382;
  config_p2_move_forward = 200;
  config_p2_move_backward = 208;
  config_p2_turn_left = 203;
  config_p2_turn_right = 205;
  config_p2_fire = 157;
  config_p2_key_reserved_0 = 382;
  config_p2_key_reserved_1 = 382;
  config_p2_aim_left = 211;
  config_p2_aim_right = 209;
  config_p2_axis_aim_y = 319;
  config_p2_axis_aim_x = 320;
  config_p2_axis_move_y = 321;
  config_p2_axis_move_x = 339;
  config_p2_padding_0 = 382;
  config_p2_padding_1 = 382;
  config_p2_padding_2 = 382;
  config_hud_indicator_toggle = 257;
  return 382;
}

// game_build_path @ 0x00402BD0
// builds a game path by combining game_base_path with filename
char *game_build_path(char *filename)
{
  crt_sprintf(game_path_buf, "%s\\%s", game_base_path, filename);
  return game_path_buf;
}

// register_core_cvars @ 0x00402C00
// registers built-in cvars
void register_core_cvars()
{
  cv_silentloads = (int)console_register_cvar(aCvSilentloads, value);
  cv_terrainFilter = (int)console_register_cvar(aCvTerrainfilte, value);
  cv_bodiesFade = (int)console_register_cvar(aCvBodiesfade, value);
  cv_uiTransparency = (int)console_register_cvar(aCvUitransparen, value);
  cv_uiPointFilterPanels = (int)console_register_cvar(aCvUipointfilte, a0);
  cv_enableMousePointAndClickMovement = (int)console_register_cvar(aCvEnablemousep, a0);
  cv_verbose = (int)console_register_cvar(aCvVerbose, a0);
  cv_terrainBodiesTransparency = (int)console_register_cvar(aCvTerrainbodie, a0);
  cv_uiSmallIndicators = (int)console_register_cvar(aCvUismallindic, a0);
  cv_aimEnhancementFade = (int)console_register_cvar(aCvAimenhanceme, a07);
  cv_friendlyFire = (int)console_register_cvar(aCvFriendlyfire, a0);
  cv_showFPS = (int)console_register_cvar(aCvShowfps, a0);
  cv_padAimDistMul = (int)console_register_cvar(aCvPadaimdistmu, a96);
}

// FUN_00402d50 @ 0x00402D50
// [binja] int32_t sub_402d50()
int FUN_00402d50()
{
  int v0; // esi
  int v2; // [esp+40h] [ebp-30h]
  int v3; // [esp+44h] [ebp-2Ch]
  float v4; // [esp+48h] [ebp-28h]
  float v5; // [esp+4Ch] [ebp-24h]
  int v6; // [esp+54h] [ebp-1Ch]
  float v7; // [esp+58h] [ebp-18h] BYREF
  int v8; // [esp+5Ch] [ebp-14h]
  _DWORD v9[4]; // [esp+60h] [ebp-10h] BYREF

  (*(void (__thiscall **)(int, int, int, int, float, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v3,
    COERCE_FLOAT(LODWORD(v4)),
    COERCE_FLOAT(LODWORD(v5)));
  memset(v9, 0, 12);
  v9[3] = 1056964608;
  v7 = (float)(*(_DWORD *)config_screen_width / 2 - 110);
  v6 = config_screen_height / 2 - 30;
  *(float *)&v8 = (float)v6;
  (*(void (__thiscall **)(int, float *, int, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    &v7,
    1130102784,
    1114636288,
    v9);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v7 = (float)(*(_DWORD *)config_screen_width / 2 - 110);
  v6 = config_screen_height / 2 - 30;
  *(float *)&v8 = (float)v6;
  (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    &v7,
    1130102784,
    1114636288);
  v0 = *(_DWORD *)grim_interface_ptr;
  v6 = config_screen_height / 2 - 8;
  v4 = (float)v6;
  v8 = *(_DWORD *)config_screen_width / 2
     - (*(int (__stdcall **)(char *, float, char *))(v0 + 332))(aPleaseWait, COERCE_FLOAT(LODWORD(v4)), aPleaseWait) / 2;
  v5 = (float)v8;
  (*(void (__thiscall **)(int, float))(v0 + 324))(grim_interface_ptr, COERCE_FLOAT(LODWORD(v5)));
  LOBYTE(v2) = 1;
  return (*(int (__thiscall **)(int, int, int, int, float, float))(*(_DWORD *)grim_interface_ptr + 32))(
           grim_interface_ptr,
           54,
           v2,
           v3,
           COERCE_FLOAT(LODWORD(v4)),
           COERCE_FLOAT(LODWORD(v5)));
}

// demo_setup_variant_0 @ 0x00402ED0
// demo setup 0: 2P, spawns template 0x38 grid, assigns weapon 0xb
void demo_setup_variant_0()
{
  int v0; // ebx
  int v1; // edi
  int v2; // [esp+Ch] [ebp-1Ch]
  float v3; // [esp+Ch] [ebp-1Ch]
  float pos[2]; // [esp+18h] [ebp-10h] BYREF
  float v5[2]; // [esp+20h] [ebp-8h] BYREF

  v0 = 256;
  config_player_count = 2;
  demo_time_limit_ms = 4000;
  v1 = 0;
  v2 = 256;
  do
  {
    pos[0] = (float)((v1 % 2 + 2) << 6);
    v3 = (float)v2;
    pos[1] = v3;
    creature_spawn_template(56, pos, -100.0);
    v5[1] = v3;
    v5[0] = (float)(((v1 % 2) << 6) + 798);
    creature_spawn_template(56, v5, -100.0);
    v0 += 80;
    ++v1;
    v2 = v0;
  }
  while ( v0 < 1696 );
  player_pos_x[0] = 1138753536;
  player_pos_y[0] = 1136656384;
  player2_pos_x[0] = 1141407744;
  player2_pos_y = 1143177216;
  weapon_assign_player(0, 11);
  weapon_assign_player(1, 11);
}

// demo_setup_variant_2 @ 0x00402FE0
// demo setup 2: 1P, spawns template 0x41 columns, assigns weapon 0x15
void demo_setup_variant_2()
{
  int v0; // ebp
  int v1; // ebx
  int v2; // [esp+10h] [ebp-28h]
  float v3; // [esp+10h] [ebp-28h]
  float pos[2]; // [esp+18h] [ebp-20h] BYREF
  float v5[2]; // [esp+20h] [ebp-18h] BYREF
  float v6[2]; // [esp+28h] [ebp-10h] BYREF
  float v7[2]; // [esp+30h] [ebp-8h] BYREF

  v0 = 128;
  config_player_count = 1;
  demo_time_limit_ms = 5000;
  v1 = 0;
  v2 = 128;
  do
  {
    pos[0] = (float)(((v1 % 2) << 6) + 32);
    v3 = (float)v2;
    pos[1] = v3;
    creature_spawn_template(65, pos, -100.0);
    v5[1] = v3;
    v5[0] = (float)((v1 % 2 + 2) << 6);
    creature_spawn_template(65, v5, -100.0);
    v6[1] = v3;
    v6[0] = (float)(((v1 % 2) << 6) - 64);
    creature_spawn_template(65, v6, -100.0);
    v7[1] = v3;
    v7[0] = (float)((v1 % 2 + 12) << 6);
    creature_spawn_template(65, v7, -100.0);
    v0 += 60;
    ++v1;
    v2 = v0;
  }
  while ( v0 < 848 );
  weapon_assign_player(0, 21);
}

// demo_setup_variant_1 @ 0x004030F0
// demo setup 1: 2P, terrain preset DAT_00484914, templates 0x34/0x35, weapon 5, power-up timer
void demo_setup_variant_1()
{
  int i; // esi
  int v1; // eax
  int v2; // eax
  float v3; // [esp+4h] [ebp-1Ch]
  float v4; // [esp+8h] [ebp-18h]
  float pos[2]; // [esp+10h] [ebp-10h] BYREF
  float v6[2]; // [esp+18h] [ebp-8h] BYREF

  config_player_count = 2;
  terrain_generate(desc);
  demo_time_limit_ms = 5000;
  for ( i = 0; i < 20; ++i )
  {
    v4 = (float)(crt_rand() % 200 + 32);
    v1 = crt_rand();
    pos[0] = v4;
    pos[1] = (float)(v1 % 899 + 64);
    creature_spawn_template(52, pos, -100.0);
    if ( i % 3 )
    {
      v3 = (float)(crt_rand() % 30 + 32);
      v2 = crt_rand();
      v6[0] = v3;
      v6[1] = (float)(v2 % 899 + 64);
      creature_spawn_template(53, v6, -100.0);
    }
  }
  player_pos_x[0] = 1140129792;
  player_pos_y[0] = 1138753536;
  player2_pos_x[0] = 1139802112;
  player2_pos_y = 1141899264;
  weapon_assign_player(0, 5);
  weapon_assign_player(1, 5);
  bonus_weapon_power_up_timer = 1097859072;
}

// demo_setup_variant_3 @ 0x00403250
// demo setup 3: 1P, quest-selected terrain, templates 0x24/0x25, weapon 0x12
void demo_setup_variant_3()
{
  int i; // esi
  int v1; // eax
  int v2; // eax
  float v3; // [esp+4h] [ebp-1Ch]
  float v4; // [esp+8h] [ebp-18h]
  float pos[2]; // [esp+10h] [ebp-10h] BYREF
  float v6[2]; // [esp+18h] [ebp-8h] BYREF

  config_player_count = 1;
  terrain_generate(quest_selected_meta);
  demo_time_limit_ms = 4000;
  for ( i = 0; i < 20; ++i )
  {
    v4 = (float)(crt_rand() % 200 + 32);
    v1 = crt_rand();
    pos[0] = v4;
    pos[1] = (float)(v1 % 899 + 64);
    creature_spawn_template(36, pos, 0.0);
    if ( i % 3 )
    {
      v3 = (float)(crt_rand() % 30 + 32);
      v2 = crt_rand();
      v6[0] = v3;
      v6[1] = (float)(v2 % 899 + 64);
      creature_spawn_template(37, v6, 0.0);
    }
  }
  player_pos_x[0] = 1140850688;
  player_pos_y[0] = 1140850688;
  weapon_assign_player(0, 18);
}

// demo_purchase_interstitial_begin @ 0x00403370
// demo setup: activates the purchase/upsell interstitial (sets demo_time_limit_ms=10000 and demo_purchase_screen_active=1)
void demo_purchase_interstitial_begin()
{
  demo_time_limit_ms = 10000;
  demo_purchase_screen_active = 1;
}

// demo_mode_start @ 0x00403390
// starts demo mode and cycles the demo setup
int demo_mode_start()
{
  int result; // eax

  if ( game_state_id != 9 )
    game_state_set(9);
  demo_purchase_screen_active = 0;
  demo_mode_active = 1;
  gameplay_reset_state();
  config_game_mode = 1;
  if ( demo_variant_index )
  {
    switch ( demo_variant_index )
    {
      case 1:
        demo_setup_variant_1();
        goto LABEL_13;
      case 2:
        demo_setup_variant_2();
        goto LABEL_13;
      case 3:
        demo_setup_variant_3();
        goto LABEL_13;
    }
    if ( demo_variant_index != 4 )
    {
      demo_purchase_interstitial_begin();
      goto LABEL_13;
    }
  }
  demo_setup_variant_0();
LABEL_13:
  quest_spawn_timeline = 0;
  result = (demo_variant_index + 1) / 6;
  byte_48702C = 0;
  demo_variant_index = (demo_variant_index + 1) % 6;
  return result;
}

// FUN_00403430 @ 0x00403430
// [binja] int32_t sub_403430(float* arg1, int32_t arg2, int32_t arg3)
int FUN_00403430(float *arg1, int arg2, int arg3)
{
  return *arg1 - 10.0 < ui_mouse_x
      && arg1[1] - 2.0 < ui_mouse_y
      && (double)arg3 + *arg1 > ui_mouse_x
      && (double)arg2 + arg1[1] > ui_mouse_y
      && !ui_mouse_blocked;
}

// ui_mouse_inside_rect @ 0x004034A0
// returns 1 when the mouse is inside the rect and mouse capture is clear
int ui_mouse_inside_rect(float *xy, int h, int w)
{
  return ui_mouse_x > (double)*xy
      && ui_mouse_y > (double)xy[1]
      && (double)w + *xy > ui_mouse_x
      && (double)h + xy[1] > ui_mouse_y
      && !ui_mouse_blocked;
}

// game_core_init @ 0x00403500
// initializes core game systems (quests, effects, UI assets) and sets initial state
int game_core_init()
{
  int result; // eax

  console_printf(&console_log_queue, aGdiInitializin);
  quest_database_init();
  effect_defaults_reset();
  ui_menu_assets_init();
  bonus_metadata_init();
  render_pass_mode = 0;
  game_state_set(0);
  console_printf(&console_log_queue, aCoreInitDone);
  LOBYTE(result) = 1;
  return result;
}

// perk_prompt_update_and_render @ 0x00403550
// updates perk prompt timer, animates transforms, and renders the prompt text
void perk_prompt_update_and_render()
{
  int v0; // eax
  char *v1; // eax
  int v2; // esi
  long double v3; // st7
  long double v4; // st6
  float v5; // [esp+18h] [ebp-90h]
  float v6; // [esp+1Ch] [ebp-8Ch]
  float v7; // [esp+1Ch] [ebp-8Ch]
  float v8; // [esp+24h] [ebp-84h]
  char Buffer[4]; // [esp+28h] [ebp-80h] BYREF
  int v10; // [esp+2Ch] [ebp-7Ch]

  if ( demo_mode_active || config_game_mode == 2 )
    return;
  if ( perk_pending_count > 0 && game_state_id == 9 )
  {
    v0 = frame_dt_ms + perk_prompt_timer;
    perk_prompt_timer += frame_dt_ms;
    if ( perk_prompt_timer > 200 )
    {
      v0 = 200;
LABEL_9:
      perk_prompt_timer = v0;
    }
  }
  else
  {
    v0 = perk_prompt_timer - frame_dt_ms;
    perk_prompt_timer -= frame_dt_ms;
    if ( perk_prompt_timer < 0 )
    {
      v0 = 0;
      goto LABEL_9;
    }
  }
  if ( config_full_version )
  {
    if ( v0 > 0 )
    {
      v6 = (double)perk_prompt_timer * 0.0049999999;
      (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v6));
      v1 = input_key_name(config_key_pick_perk);
      crt_sprintf(Buffer, "Press %s to pick a perk", v1);
      v2 = *(_DWORD *)grim_interface_ptr;
      v5 = perk_prompt_origin_y + 8.0;
      v10 = *(_DWORD *)config_screen_width
          - (*(int (__stdcall **)(char *, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 332))(
              Buffer,
              LODWORD(v5),
              Buffer)
          - 16;
      v7 = (float)v10;
      (*(void (__thiscall **)(int, _DWORD))(v2 + 324))(grim_interface_ptr, LODWORD(v7));
    }
  }
  LOBYTE(byte_48F20C[0]) = 1;
  v3 = (1.0 - (double)perk_prompt_timer * 0.0049999999) * -1.5707964;
  v8 = v3;
  perk_prompt_transform_cos = cos(v3);
  v4 = sin(v8);
  perk_prompt_transform_sin_neg = -v4;
  perk_prompt_transform_sin = v4;
  perk_prompt_transform_cos_2 = perk_prompt_transform_cos;
  ui_element_render((int)byte_48F20C);
}

// input_key_name @ 0x004036D0
// maps key codes (DIK/virtual) to display labels
char *input_key_name(int key_code)
{
  char *result; // eax
  const char *v2; // edi

  if ( key_code > 255 )
  {
    switch ( key_code )
    {
      case 256:
        strcpy(String, aMouse1);
        return String;
      case 257:
        v2 = aMouse2;
        break;
      case 258:
        strcpy(String, aMouse3);
        return String;
      case 259:
        v2 = aMouse4;
        break;
      case 260:
        strcpy(String, aMouse5);
        return String;
      case 265:
        v2 = aMwheelup;
        break;
      case 266:
        strcpy(String, aMwheeldown);
        return String;
      case 287:
        v2 = aJoys1;
        break;
      case 288:
        strcpy(String, aJoys2);
        return String;
      case 289:
        v2 = aJoys3;
        break;
      case 290:
        strcpy(String, aJoys4);
        return String;
      case 291:
        v2 = aJoys5;
        break;
      case 292:
        strcpy(String, aJoys6);
        return String;
      case 293:
        v2 = aJoys7;
        break;
      case 294:
        strcpy(String, aJoys8);
        return String;
      case 295:
        v2 = aJoys9;
        break;
      case 296:
        strcpy(String, aJoys10);
        return String;
      case 297:
        v2 = aJoys11;
        break;
      case 298:
        strcpy(String, aJoys12);
        return String;
      case 305:
        v2 = aJoysup;
        break;
      case 306:
        strcpy(String, aJoysdown);
        return String;
      case 307:
        v2 = aJoysleft;
        break;
      case 308:
        strcpy(String, aJoysright);
        return String;
      case 319:
        v2 = aJoyaxisx;
        break;
      case 320:
        strcpy(String, aJoyaxisy);
        return String;
      case 321:
        v2 = aJoyaxisz;
        break;
      case 339:
        strcpy(String, aJoyrotx);
        return String;
      case 340:
        v2 = aJoyroty;
        break;
      case 341:
        strcpy(String, aJoyrotz);
        return String;
      case 382:
        v2 = aUnbound;
        break;
      case 355:
        strcpy(String, aRim0xaxis);
        return String;
      case 356:
        v2 = aRim1xaxis;
        break;
      case 357:
        strcpy(String, aRim2xaxis);
        return String;
      case 360:
        v2 = aRim0yaxis;
        break;
      case 361:
        strcpy(String, aRim1yaxis);
        return String;
      case 362:
        v2 = aRim2yaxis;
        break;
      case 365:
        strcpy(String, aRim0btn1);
        return String;
      case 366:
        v2 = aRim0btn2;
        break;
      case 367:
        strcpy(String, aRim0btn3);
        return String;
      case 368:
        v2 = aRim0btn4;
        break;
      case 369:
        strcpy(String, aRim0btn5);
        return String;
      case 370:
        v2 = aRim1btn1;
        break;
      case 371:
        strcpy(String, aRim1btn2);
        return String;
      case 372:
        v2 = aRim1btn3;
        break;
      case 373:
        strcpy(String, aRim1btn4);
        return String;
      case 374:
        v2 = aRim1btn5;
        break;
      case 375:
        strcpy(String, aRim2btn1);
        return String;
      case 376:
        v2 = aRim2btn2;
        break;
      case 377:
        strcpy(String, aRim2btn3);
        return String;
      case 378:
        v2 = aRim2btn4;
        break;
      case 379:
        strcpy(String, aRim2btn5);
        return String;
      default:
        if ( key_code <= 355 )
          return String;
        v2 = aRawinput;
        break;
    }
    strcpy(String, v2);
    return String;
  }
  if ( GetKeyNameTextA(key_code << 16, String, 63) )
    return String;
  switch ( key_code )
  {
    case 1:
      result = aDikEscape;
      break;
    case 2:
      result = aDik1;
      break;
    case 3:
      result = aDik2;
      break;
    case 4:
      result = aDik3;
      break;
    case 5:
      result = aDik4;
      break;
    case 6:
      result = aDik5;
      break;
    case 7:
      result = aDik6;
      break;
    case 8:
      result = aDik7;
      break;
    case 9:
      result = aDik8;
      break;
    case 10:
      result = aDik9;
      break;
    case 11:
      result = aDik0;
      break;
    case 12:
      result = aMinus;
      break;
    case 13:
      result = aEquals;
      break;
    case 14:
      result = aBack;
      break;
    case 15:
      result = (char *)&off_47186C;
      break;
    case 16:
      result = aQ;
      break;
    case 17:
      result = aW;
      break;
    case 18:
      result = aE;
      break;
    case 19:
      result = aR;
      break;
    case 20:
      result = aT;
      break;
    case 21:
      result = aY;
      break;
    case 22:
      result = aU;
      break;
    case 23:
      result = aI;
      break;
    case 24:
      result = aO;
      break;
    case 25:
      result = aP;
      break;
    case 26:
      result = aLbracket;
      break;
    case 27:
      result = aRbracket;
      break;
    case 28:
      result = aReturn;
      break;
    case 29:
      result = aLcontrol;
      break;
    case 30:
      result = aA;
      break;
    case 31:
      result = aS_3;
      break;
    case 32:
      result = aD_1;
      break;
    case 33:
      result = asc_471808;
      break;
    case 34:
      result = aG;
      break;
    case 35:
      result = asc_471800;
      break;
    case 36:
      result = aJ;
      break;
    case 37:
      result = aK;
      break;
    case 38:
      result = asc_4717F4;
      break;
    case 39:
      result = aSemicolon;
      break;
    case 40:
      result = aApostrophe;
      break;
    case 41:
      result = aGrave;
      break;
    case 42:
      result = aLshift;
      break;
    case 43:
      result = aBackslash;
      break;
    case 44:
      result = aZ;
      break;
    case 45:
      result = asc_4717B8;
      break;
    case 46:
      result = aC;
      break;
    case 47:
      result = aV;
      break;
    case 48:
      result = aB;
      break;
    case 49:
      result = aN;
      break;
    case 50:
      result = aM;
      break;
    case 51:
      result = aComma;
      break;
    case 52:
      result = aPeriod;
      break;
    case 53:
      result = aSlash;
      break;
    case 54:
      result = aRshift;
      break;
    case 55:
      result = aMultiply;
      break;
    case 56:
      result = aLmenu;
      break;
    case 57:
      result = aSpace;
      break;
    case 58:
      result = aCapital;
      break;
    case 59:
      result = aF1;
      break;
    case 60:
      result = aF2;
      break;
    case 61:
      result = aF3;
      break;
    case 62:
      result = aF4;
      break;
    case 63:
      result = aF5;
      break;
    case 64:
      result = aF6;
      break;
    case 65:
      result = aF7;
      break;
    case 66:
      result = aF8;
      break;
    case 67:
      result = aF9;
      break;
    case 68:
      result = aF10;
      break;
    case 69:
      result = aNumlock;
      break;
    case 70:
      result = aScroll;
      break;
    case 71:
      result = aNumpad7;
      break;
    case 72:
      result = aNumpad8;
      break;
    case 73:
      result = aNumpad9;
      break;
    case 74:
      result = aSubtract;
      break;
    case 75:
      result = aNumpad4;
      break;
    case 76:
      result = aNumpad5;
      break;
    case 77:
      result = aNumpad6;
      break;
    case 78:
      result = (char *)&off_4716E8;
      break;
    case 79:
      result = aNumpad1;
      break;
    case 80:
      result = aNumpad2;
      break;
    case 81:
      result = aNumpad3;
      break;
    case 82:
      result = aNumpad0;
      break;
    case 83:
      result = aDecimal;
      break;
    case 86:
      result = aOem102;
      break;
    case 87:
      result = aF11;
      break;
    case 88:
      result = aF12;
      break;
    case 100:
      result = aF13;
      break;
    case 101:
      result = aF14;
      break;
    case 102:
      result = aF15;
      break;
    case 112:
      result = aKana;
      break;
    case 115:
      result = aAbntC1;
      break;
    case 121:
      result = aConvert;
      break;
    case 123:
      result = aNoconvert;
      break;
    case 125:
      result = aYen;
      break;
    case 126:
      result = aAbntC2;
      break;
    case 141:
      result = aNumpadequals;
      break;
    case 144:
      result = aPrevtrack;
      break;
    case 145:
      result = aAt;
      break;
    case 146:
      result = aColon;
      break;
    case 147:
      result = aUnderline;
      break;
    case 148:
      result = aKanji;
      break;
    case 149:
      result = aStop;
      break;
    case 150:
      result = aAx;
      break;
    case 151:
      result = aUnlabeled;
      break;
    case 153:
      result = aNexttrack;
      break;
    case 156:
      result = aNumpadenter;
      break;
    case 157:
      result = aRcontrol;
      break;
    case 160:
      result = aMute;
      break;
    case 161:
      result = aCalculator;
      break;
    case 162:
      result = aPlaypause;
      break;
    case 164:
      result = aMediastop;
      break;
    case 174:
      result = aVolumedown;
      break;
    case 176:
      result = aVolumeup;
      break;
    case 178:
      result = aWebhome;
      break;
    case 179:
      result = aNumpadcomma;
      break;
    case 181:
      result = aDivide;
      break;
    case 183:
      result = aSysrq;
      break;
    case 184:
      result = aRmenu;
      break;
    case 197:
      result = aPause;
      break;
    case 199:
      result = aHome;
      break;
    case 200:
      result = aUp;
      break;
    case 201:
      result = aPrior;
      break;
    case 203:
      result = aLeft;
      break;
    case 205:
      result = aRight;
      break;
    case 207:
      result = (char *)&off_47155C;
      break;
    case 208:
      result = aDown;
      break;
    case 209:
      result = aNext;
      break;
    case 210:
      result = aInsert;
      break;
    case 211:
      result = aDelete;
      break;
    case 219:
      result = aLwin;
      break;
    case 220:
      result = aRwin;
      break;
    case 221:
      result = aApps;
      break;
    case 222:
      result = aPower;
      break;
    case 223:
      result = aSleep;
      break;
    case 227:
      result = aWake;
      break;
    case 229:
      result = aWebsearch;
      break;
    case 230:
      result = aWebfavorites;
      break;
    case 231:
      result = aWebrefresh;
      break;
    case 232:
      result = aWebstop;
      break;
    case 233:
      result = aWebforward;
      break;
    case 234:
      result = aWebback;
      break;
    case 235:
      result = aMycomputer;
      break;
    case 236:
      result = aMail;
      break;
    case 237:
      result = aMediaselect;
      break;
    default:
      result = aUnknown;
      break;
  }
  return result;
}

// perks_generate_choices @ 0x004045A0
// builds the current perk choice list
void perks_generate_choices()
{
  int v0; // esi
  int v1; // edi
  int v2; // eax
  int v3; // ecx
  int v4; // eax
  int v5; // eax
  int v6; // eax
  int *v7; // ecx
  int v8; // eax

  v0 = 0;
  memset(perk_choice_ids, 0, 0x1Cu);
  do
  {
    if ( !v0
      && *(_DWORD *)quest_stage_major == *(_DWORD *)quest_monster_vision_meta
      && quest_stage_minor == *(_DWORD *)(quest_monster_vision_meta + 4)
      && !perk_count_get(perk_id_monster_vision) )
    {
      v0 = 1;
      perk_choice_ids[0] = perk_id_monster_vision;
    }
    v1 = 0;
    do
    {
      while ( 1 )
      {
        do
        {
LABEL_8:
          ++v1;
          v2 = perk_select_random();
          v3 = perk_id_pyromaniac;
          perk_choice_ids[v0] = v2;
        }
        while ( v2 == v3 && player_weapon_id[0] != 8 );
        if ( perk_count_get(perk_id_death_clock) )
        {
          v4 = perk_choice_ids[v0];
          if ( v4 == perk_id_jinxed
            || v4 == perk_id_breathing_room
            || v4 == perk_id_grim_deal
            || v4 == perk_id_highlander
            || v4 == perk_id_fatal_lottery
            || v4 == dword_4C2B8C
            || v4 == perk_id_ammunition_within
            || v4 == perk_id_infernal_contract
            || v4 == perk_id_regeneration
            || v4 == perk_id_greater_regeneration
            || v4 == perk_id_thick_skinned
            || v4 == perk_id_bandage )
          {
            continue;
          }
        }
        v5 = perk_choice_ids[v0];
        if ( v5 != perk_id_jinxed
          && v5 != perk_id_ammunition_within
          && v5 != perk_id_anxious_loader
          && v5 != perk_id_monster_vision )
        {
          break;
        }
        if ( (crt_rand() & 3) != 1 )
          break;
      }
      if ( v1 > 10000 && (perk_flags_table[20 * perk_choice_ids[v0]] & 4) != 0 )
        break;
      v6 = 0;
      v7 = perk_choice_ids;
      while ( v6 < v0 )
      {
        if ( *v7 == perk_choice_ids[v0] )
          goto LABEL_8;
        ++v6;
        ++v7;
      }
      v8 = perk_choice_ids[v0];
      if ( (perk_flags_table[20 * v8] & 4) != 0 )
        break;
    }
    while ( (int)*(&player_perk_counts + v8) > 0 && v1 < 30000 );
    if ( v1 >= 25000 )
      console_printf(&console_log_queue, aPerkRandomizer);
    ++v0;
  }
  while ( v0 < 7 );
  if ( config_game_mode == 8 )
  {
    perk_choice_ids[0] = perk_id_sharpshooter;
    dword_4807EC = perk_id_long_distance_runner;
    dword_4807F0 = perk_id_evil_eyes;
    dword_4807F4 = perk_id_radioactive;
    dword_4807F8 = perk_id_fastshot;
    dword_4807FC = perk_id_fastshot;
    dword_480800 = perk_id_fastshot;
  }
}

// demo_trial_overlay_render @ 0x004047C0
// renders the demo trial warning panel and remaining time message
void demo_trial_overlay_render(float *xy, float alpha)
{
  int v2; // edi
  int v3; // eax
  float v4; // edx
  int v5; // ecx
  signed int v6; // ebp
  int v7; // edi
  int v8; // ebx
  float v9; // edi
  int v10; // ecx
  int v11; // ecx
  double v12; // st7
  int v13; // ecx
  int v14; // ecx
  int v15; // ecx
  int v16; // ecx
  double v17; // st7
  int v18; // ecx
  int v19; // ecx
  int v20; // ecx
  int v21; // ecx
  int v22; // ecx
  int v23; // ecx
  int v24; // ecx
  int v25; // ecx
  int v26; // ecx
  int v27; // ecx
  double v28; // st7
  float v29; // [esp+6Ch] [ebp-144h]
  float v30; // [esp+70h] [ebp-140h]
  float v31; // [esp+70h] [ebp-140h]
  int v32; // [esp+70h] [ebp-140h]
  float v33; // [esp+74h] [ebp-13Ch]
  int v34; // [esp+74h] [ebp-13Ch]
  char *v35; // [esp+74h] [ebp-13Ch]
  int v36; // [esp+78h] [ebp-138h]
  float v37; // [esp+8Ch] [ebp-124h] BYREF
  float v38; // [esp+90h] [ebp-120h]
  float v39; // [esp+94h] [ebp-11Ch]
  float v40[2]; // [esp+98h] [ebp-118h] BYREF
  _DWORD v41[4]; // [esp+A0h] [ebp-110h] BYREF
  char dst[128]; // [esp+B0h] [ebp-100h] BYREF
  char Buffer[128]; // [esp+130h] [ebp-80h] BYREF

  *(float *)&v41[3] = alpha * 0.80000001;
  byte_480850 = 1;
  memset(v41, 0, 12);
  (*(void (__thiscall **)(int, float *, int, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    xy,
    1140850688,
    1132462080,
    v41);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(alpha));
  (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    xy,
    1140850688,
    1132462080);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v2 = *(_DWORD *)grim_interface_ptr;
  v3 = (*(int (__thiscall **)(int, char *, _DWORD))(*(_DWORD *)grim_interface_ptr + 192))(
         grim_interface_ptr,
         aClLogo,
         0);
  (*(void (__thiscall **)(int, int))(v2 + 196))(grim_interface_ptr, v3);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  v30 = xy[1] + 22.0;
  v29 = *xy + 72.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v29),
    LODWORD(v30),
    1136236954,
    1111071130);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  v33 = xy[1] + 9.0;
  v31 = *xy + 131.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v31),
    LODWORD(v33),
    aYouVeBeenPlayi);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(alpha));
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v32,
    v34,
    v36);
  v4 = xy[1];
  v37 = *xy + 26.0;
  v38 = v4 + 80.0;
  v5 = sub_41DF50() - *(_DWORD *)&game_sequence_id;
  if ( dword_48084C > 0 )
    v5 = 300000 - dword_48084C;
  v6 = v5 / 1000 / 60
     + 60
     * (((unsigned int)(((unsigned __int64)(2004318071LL * (v5 / 1000 / 60)) >> 32) - v5 / 1000 / 60) >> 31)
      + ((int)(((unsigned __int64)(2004318071LL * (v5 / 1000 / 60)) >> 32) - v5 / 1000 / 60) >> 5));
  v7 = v5 / 1000 - 60 * v6;
  v8 = v5 % 1000 / 10;
  if ( v6 >= 0 )
  {
    if ( v7 >= 10 )
      v35 = aD_0;
    else
      v35 = a0D;
    crt_sprintf(Buffer, v35, v7);
  }
  else
  {
    v7 = 0;
    v8 = 0;
    v6 = 0;
    crt_sprintf(Buffer, "0%d", 0);
  }
  if ( v8 >= 10 )
    crt_sprintf(dst, "%d:%s.%d", v6, Buffer, v8);
  else
    crt_sprintf(dst, "%d:%s.0%d", v6, Buffer, v8);
  if ( (unsigned __int8)game_is_full_version() )
    goto LABEL_27;
  if ( config_game_mode == 8 )
    goto LABEL_27;
  *(_DWORD *)&game_sequence_id = game_sequence_get();
  if ( *(int *)&game_sequence_id > 2400000 )
    goto LABEL_27;
  if ( dword_48084C <= 0 )
  {
    if ( config_game_mode != 3 )
      goto LABEL_27;
  }
  else if ( config_game_mode != 3
         || (LODWORD(v39) = dword_48084C / 1000, (double)(dword_48084C / 1000) * 0.016666668 > 5.0) )
  {
LABEL_27:
    if ( v6 > 0 || v7 > 0 )
    {
      v9 = v37;
      v22 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 - 7.0;
      (*(void (__cdecl **)(int, float, float, char *, char *))(v22 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aYouHaveUsedUpY,
        dst);
      v23 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 16.0;
      (*(void (**)(int, float, float, char *, ...))(v23 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aHaveSTimeLeftT,
        dst);
      v24 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 22.0;
      (*(void (__cdecl **)(int, float, float, char *))(v24 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aIfYouWouldLike);
      v25 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 16.0;
      (*(void (__cdecl **)(int, float, float, char *))(v25 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aPleaseUpgradeT_0);
      v26 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 16.0;
      (*(void (__cdecl **)(int, float, float, char *))(v26 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aAndTakesJustMi);
      v27 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 22.0;
      (*(void (__cdecl **)(int, float, float, char *))(v27 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aBuyTheFullVers);
      v38 = v38 + 16.0;
      (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aGameModesAndBe);
      v17 = v38 + 16.0;
    }
    else
    {
      v9 = v37;
      (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aTrialTimeIsUpI);
      v18 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 18.0;
      (*(void (__cdecl **)(int, float, float, char *))(v18 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aAllFeaturesPle);
      v19 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 18.0;
      (*(void (__cdecl **)(int, float, float, char *))(v19 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aIsVeryEasyAndT);
      v20 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 24.0;
      (*(void (__cdecl **)(int, float, float, char *))(v20 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aBuyTheFullVers);
      v21 = *(_DWORD *)grim_interface_ptr;
      v38 = v38 + 18.0;
      (*(void (__cdecl **)(int, float, float, char *))(v21 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v37)),
        COERCE_FLOAT(LODWORD(v38)),
        aGameModesAndBe);
      v17 = v38 + 18.0;
    }
    goto LABEL_31;
  }
  if ( game_state_id != 9 || *(int *)quest_stage_major <= 1 && quest_stage_minor <= 10 )
    goto LABEL_27;
  v38 = v38 - 6.0;
  v9 = v37;
  if ( dword_48084C > 0 )
  {
    v13 = *(_DWORD *)grim_interface_ptr;
    v38 = v38 + 6.0;
    (*(void (__cdecl **)(int, float, float, char *))(v13 + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v37)),
      COERCE_FLOAT(LODWORD(v38)),
      aYouVeCompleted_0);
    v12 = v38 + 18.0;
  }
  else
  {
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v37)),
      COERCE_FLOAT(LODWORD(v38)),
      aYouVeCompleted_0);
    v10 = *(_DWORD *)grim_interface_ptr;
    v38 = v38 + 18.0;
    (*(void (**)(int, float, float, char *, ...))(v10 + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v37)),
      COERCE_FLOAT(LODWORD(v38)),
      aHoweverYouStil,
      dst);
    v11 = *(_DWORD *)grim_interface_ptr;
    v38 = v38 + 18.0;
    (*(void (__cdecl **)(int, float, float, CHAR *))(v11 + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v37)),
      COERCE_FLOAT(LODWORD(v38)),
      szPassword);
    v12 = v38 + 14.0;
  }
  v38 = v12;
  (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v37)),
    COERCE_FLOAT(LODWORD(v38)),
    aIfYouWouldLike);
  v14 = *(_DWORD *)grim_interface_ptr;
  v38 = v38 + 18.0;
  (*(void (__cdecl **)(int, float, float, char *))(v14 + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v37)),
    COERCE_FLOAT(LODWORD(v38)),
    aPleaseUpgradeT);
  v15 = *(_DWORD *)grim_interface_ptr;
  v38 = v38 + 22.0;
  (*(void (__cdecl **)(int, float, float, char *))(v15 + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v37)),
    COERCE_FLOAT(LODWORD(v38)),
    aTheFullVersion);
  v16 = *(_DWORD *)grim_interface_ptr;
  v38 = v38 + 18.0;
  (*(void (__cdecl **)(int, float, float, char *))(v16 + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v37)),
    COERCE_FLOAT(LODWORD(v38)),
    aGameModesAndBe);
  v17 = v38 + 18.0;
LABEL_31:
  v38 = v17;
  (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v9)),
    COERCE_FLOAT(LODWORD(v38)),
    aItNowYouLlHave);
  if ( (byte_47F62C & 1) == 0 )
  {
    byte_48080E = 1;
    byte_47F62C |= 1u;
    byte_48081D = 0;
    byte_48081C = 0;
    dword_480818 = 1065353216;
    dword_480814 = 0;
    ui_button_maybe_later = 0;
    byte_48080C = 0;
    byte_48080D = 0;
    dword_480810 = 0;
    crt_atexit(nullsub_3);
  }
  ui_button_maybe_later = (int)aMaybeLater;
  if ( (byte_47F62C & 2) == 0 )
  {
    byte_47F5FE = 1;
    byte_47F62C |= 2u;
    byte_47F60D = 0;
    byte_47F60C = 0;
    dword_47F608 = 1065353216;
    dword_47F604 = 0;
    ui_button_table_a = 0;
    byte_47F5FC = 0;
    byte_47F5FD = 0;
    dword_47F600 = 0;
    crt_atexit(nullsub_2);
  }
  ui_button_table_a = (int)aPurchase;
  if ( (byte_47F62C & 4) == 0 )
  {
    byte_47F616 = 1;
    byte_47F62C |= 4u;
    byte_47F625 = 0;
    byte_47F624 = 0;
    dword_47F620 = 1065353216;
    dword_47F61C = 0;
    ui_button_already_paid = 0;
    byte_47F614 = 0;
    byte_47F615 = 0;
    dword_47F618 = 0;
    crt_atexit(nullsub_1);
  }
  ui_button_already_paid = (int)aAlreadyPaid;
  v40[0] = *xy + 22.0;
  v28 = xy[1] + 212.0;
  v37 = v40[0] + 6.0;
  v39 = v28 + 6.0;
  v38 = v39;
  if ( ui_button_update(&v37, (int)&ui_button_table_a) )
  {
    shareware_offer_seen_latch = 1;
    byte_47EA50 = 1;
    ShellExecuteA(0, Operation, File, 0, 0, 1);
  }
  v40[0] = v40[0] + 326.0;
  v40[1] = v39;
  if ( ui_button_update(v40, (int)&ui_button_maybe_later) )
  {
    ui_transition_direction = 0;
    game_state_pending = 0;
    render_pass_mode = 0;
    sfx_mute_all(music_track_intro_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    sfx_play_exclusive(music_track_crimson_theme_id);
  }
}

// nullsub_1 @ 0x00405130
void __cdecl nullsub_1()
{
  ;
}

// nullsub_2 @ 0x00405140
void __cdecl nullsub_2()
{
  ;
}

// nullsub_3 @ 0x00405150
void __cdecl nullsub_3()
{
  ;
}

// ui_render_keybind_help @ 0x00405160
// renders the in-game key bindings help overlay
void ui_render_keybind_help(float *xy, float alpha)
{
  float v2; // edi
  int v3; // ebx
  char *v4; // eax
  int v5; // ebp
  char *v6; // eax
  int v7; // eax
  float v8; // ebp
  int v9; // esi
  int v10; // esi
  int v11; // ebp
  char *v12; // eax
  float v13; // ebx
  int v14; // ebp
  char *v15; // eax
  int v16; // eax
  int v17; // ebp
  char *v18; // eax
  int v19; // ebp
  char *v20; // eax
  char *v21; // eax
  int v22; // [esp+5Ch] [ebp-40h]
  int v23; // [esp+5Ch] [ebp-40h]
  int v24; // [esp+64h] [ebp-38h]
  float v25; // [esp+64h] [ebp-38h]
  int v26; // [esp+64h] [ebp-38h]
  float v27; // [esp+64h] [ebp-38h]
  int v28; // [esp+68h] [ebp-34h]
  float v29; // [esp+68h] [ebp-34h]
  int v30; // [esp+68h] [ebp-34h]
  float v31; // [esp+68h] [ebp-34h]
  int v32; // [esp+6Ch] [ebp-30h]
  int v33; // [esp+6Ch] [ebp-30h]
  int v34; // [esp+80h] [ebp-1Ch]
  float v35; // [esp+84h] [ebp-18h]
  float v36; // [esp+88h] [ebp-14h]
  float v37; // [esp+88h] [ebp-14h]
  float v38; // [esp+88h] [ebp-14h]
  float v39; // [esp+88h] [ebp-14h]
  float v40; // [esp+88h] [ebp-14h]
  float v41; // [esp+88h] [ebp-14h]
  float v42; // [esp+88h] [ebp-14h]
  _DWORD v43[4]; // [esp+8Ch] [ebp-10h] BYREF
  float xya; // [esp+A0h] [ebp+4h]
  float *xyb; // [esp+A0h] [ebp+4h]
  float alphab; // [esp+A4h] [ebp+8h]
  int alphaa; // [esp+A4h] [ebp+8h]

  *(float *)&v43[3] = alpha * 0.80000001;
  memset(v43, 0, 12);
  (*(void (__thiscall **)(int, float *, int, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    xy,
    1140850688,
    1132462080,
    v43);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(alpha));
  (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    xy,
    1140850688,
    1132462080);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1061997773,
    v24,
    v28,
    v32);
  v29 = xy[1] + 16.0;
  v25 = *xy + 16.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 320))(
    grim_interface_ptr,
    LODWORD(v25),
    LODWORD(v29),
    aKeyInfo);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(alpha));
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v26,
    v30,
    v33);
  v35 = *xy + 32.0;
  v36 = xy[1] + 50.0;
  v2 = v35;
  (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v35)),
    LODWORD(v36),
    aLevelUp);
  v3 = *(_DWORD *)grim_interface_ptr;
  alphab = v35 + 128.0;
  v4 = input_key_name(config_key_pick_perk);
  (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v3 + 328))(
    grim_interface_ptr,
    LODWORD(alphab),
    LODWORD(v36),
    aSOrSpaceBarOrK,
    v4);
  v37 = v36 + 18.0;
  (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v35)),
    LODWORD(v37),
    aReload);
  v5 = *(_DWORD *)grim_interface_ptr;
  v6 = input_key_name(config_key_reload);
  (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v5 + 328))(
    grim_interface_ptr,
    LODWORD(alphab),
    LODWORD(v37),
    aS_0,
    v6);
  v7 = 0;
  alphaa = 0;
  v38 = v37 + 18.0 + 20.0;
  v8 = v38;
  do
  {
    v9 = 5 * v7;
    if ( v7 == 1 )
    {
      v35 = v35 + 256.0;
      v2 = v35;
    }
    v34 = v7 + 1;
    (*(void (**)(int, float, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v2)),
      COERCE_FLOAT(LODWORD(v8)),
      aPlayerD,
      v7 + 1);
    v39 = v38 + 22.0;
    (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v2)),
      LODWORD(v39),
      aUp_0);
    v22 = config_p1_move_forward[v9];
    v10 = v9 + 1;
    v11 = *(_DWORD *)grim_interface_ptr;
    xya = v35 + 64.0;
    v12 = input_key_name(v22);
    v13 = xya;
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v11 + 328))(
      grim_interface_ptr,
      LODWORD(xya),
      LODWORD(v39),
      aS_0,
      v12);
    v40 = v39 + 16.0;
    (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v2)),
      LODWORD(v40),
      aDown_0);
    v23 = config_p1_move_forward[v10++];
    v14 = *(_DWORD *)grim_interface_ptr;
    v15 = input_key_name(v23);
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v14 + 328))(
      grim_interface_ptr,
      LODWORD(xya),
      LODWORD(v40),
      aS_0,
      v15);
    v41 = v40 + 16.0;
    (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v2)),
      LODWORD(v41),
      aLeft_0);
    v16 = config_p1_move_forward[v10++];
    v17 = *(_DWORD *)grim_interface_ptr;
    v18 = input_key_name(v16);
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v17 + 328))(
      grim_interface_ptr,
      LODWORD(xya),
      LODWORD(v41),
      aS_0,
      v18);
    v42 = v41 + 16.0;
    (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v2)),
      LODWORD(v42),
      aRight_0);
    v19 = *(_DWORD *)grim_interface_ptr;
    v20 = input_key_name(config_p1_move_forward[v10]);
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v19 + 328))(
      grim_interface_ptr,
      LODWORD(xya),
      LODWORD(v42),
      aS_0,
      v20);
    v38 = v42 + 16.0;
    v8 = v38;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v2)),
      COERCE_FLOAT(LODWORD(v38)),
      aFire);
    xyb = *(float **)grim_interface_ptr;
    v21 = input_key_name(config_p1_move_backward[v10]);
    (*((void (**)(int, float, float, char *, ...))xyb + 82))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v13)),
      COERCE_FLOAT(LODWORD(v38)),
      aS_0,
      v21);
    if ( !alphaa )
    {
      v38 = v38 - 94.0;
      v8 = v38;
    }
    v7 = v34;
    alphaa = v34;
  }
  while ( v34 < 2 );
  v31 = v38 + 32.0;
  v27 = v35 - 20.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v27),
    LODWORD(v31),
    aPressF1ToRetur);
}

// perk_apply @ 0x004055E0
// applies perk effects and increments perk counter
void perk_apply(int perk_id)
{
  int v1; // edi
  bool v2; // zf
  char v3; // bl
  char *v4; // esi
  int v5; // ebp
  float *v6; // ecx
  int v7; // edx
  double v8; // st7
  float *v9; // eax
  int v10; // ecx
  double v11; // st7
  float *v12; // eax
  int v13; // esi
  int v14; // eax
  int v15; // esi
  int *v16; // edi
  int v17; // edx
  int *v18; // ecx
  int v19; // edx
  int v20; // edi
  float *v21; // esi
  double v22; // st7
  float *v23; // eax
  double v24; // st7

  sfx_play(SLODWORD(sfx_ui_bonus));
  v1 = perk_id;
  v2 = perk_id == perk_id_instant_winner;
  *(&player_perk_counts + perk_id) = (std::codecvt_base *)((char *)*(&player_perk_counts + perk_id) + 1);
  if ( v2 )
  {
    player_experience[0] += 2500;
LABEL_39:
    v5 = config_player_count;
    goto LABEL_40;
  }
  if ( perk_id == perk_id_fatal_lottery )
  {
    if ( (crt_rand() & 1) != 0 )
      player_health[0] = -1082130432;
    else
      player_experience[0] += 10000;
    goto LABEL_39;
  }
  if ( perk_id == perk_id_lifeline_50_50 )
  {
    v3 = 0;
    v4 = creature_pool;
    do
    {
      if ( (v3 & 1) != 0 && *v4 && *((float *)v4 + 9) <= 500.0 && (v4[140] & 4) == 0 )
      {
        *v4 = 0;
        effect_spawn_burst((float *)v4 + 5, 4);
      }
      v4 += 152;
      ++v3;
    }
    while ( (int)v4 < (int)byte_4AA338 );
    v5 = config_player_count;
  }
  else if ( perk_id == perk_id_thick_skinned )
  {
    v5 = config_player_count;
    if ( config_player_count > 0 )
    {
      v6 = (float *)player_health;
      v7 = config_player_count;
      do
      {
        if ( *v6 > 0.0 )
        {
          v8 = *v6 - *v6 * 0.33333334;
          *v6 = v8;
          if ( v8 <= 0.0 )
            *v6 = 1.0;
        }
        v6 += 216;
        --v7;
      }
      while ( v7 );
    }
  }
  else
  {
    if ( perk_id != perk_id_breathing_room )
    {
      if ( perk_id == perk_id_random_weapon )
      {
        v13 = 0;
        do
        {
          v14 = weapon_pick_random_available();
          ++v13;
        }
        while ( (v14 == 1 || v14 == player_weapon_id[0]) && v13 < 100 );
        weapon_assign_player(0, v14);
      }
      goto LABEL_39;
    }
    v5 = config_player_count;
    if ( config_player_count > 0 )
    {
      v9 = (float *)player_health;
      v10 = config_player_count;
      do
      {
        v11 = *v9 * 0.66666669;
        v9 += 216;
        --v10;
        *(v9 - 216) = *(v9 - 216) - v11;
      }
      while ( v10 );
    }
    v12 = (float *)creature_hitbox_size;
    do
    {
      if ( *((_BYTE *)v12 - 16) )
        *v12 = *v12 - frame_dt;
      v12 += 38;
    }
    while ( (int)v12 < (int)&flt_4AA348 );
    bonus_spawn_guard = 0;
  }
LABEL_40:
  if ( perk_id == perk_id_infernal_contract )
  {
    player_level[0] += 3;
    perk_pending_count += 3;
    if ( *(float *)player_health > 0.0 )
      player_health[0] = 1036831949;
    if ( player2_health[0] > 0.0 )
      player2_health[0] = 0.1;
  }
  if ( perk_id == perk_id_grim_deal )
  {
    player_health[0] = -1082130432;
    player_experience[0] += (__int64)((double)player_experience[0] * 0.18000001);
  }
  if ( perk_id == perk_id_ammo_maniac )
  {
    v15 = 0;
    if ( v5 > 0 )
    {
      v16 = player_weapon_id;
      do
      {
        weapon_assign_player(v15, *v16);
        v5 = config_player_count;
        ++v15;
        v16 += 216;
      }
      while ( v15 < config_player_count );
      v1 = perk_id;
    }
  }
  if ( v1 == perk_id_death_clock )
  {
    v17 = perk_id_regeneration;
    *(&player_perk_counts + perk_id_greater_regeneration) = 0;
    *(&player_perk_counts + v17) = 0;
    if ( v5 > 0 )
    {
      v18 = player_health;
      v19 = v5;
      do
      {
        if ( *(float *)v18 > 0.0 )
          *v18 = 1120403456;
        v18 += 216;
        --v19;
      }
      while ( v19 );
    }
  }
  if ( v1 == perk_id_bandage )
  {
    v20 = 0;
    if ( v5 > 0 )
    {
      v21 = (float *)player_health;
      do
      {
        v22 = ((double)(crt_rand() % 50) + 1.0) * *v21;
        *v21 = v22;
        if ( v22 > 100.0 )
          *v21 = 100.0;
        effect_spawn_burst(v21 - 4, 8);
        v5 = config_player_count;
        ++v20;
        v21 += 216;
      }
      while ( v20 < config_player_count );
    }
    v1 = perk_id;
  }
  if ( v1 == perk_id_my_favourite_weapon && v5 > 0 )
  {
    v23 = (float *)player_clip_size;
    do
    {
      v24 = *v23 + 2.0;
      v23 += 216;
      --v5;
      *(v23 - 216) = v24;
    }
    while ( v5 );
  }
  if ( v1 == perk_id_plaguebearer )
    player_plaguebearer_active[0] = 1;
}

// gameplay_render_world @ 0x00405960
// world render pass: updates gameplay fade and draws fx queue, creatures, players, projectiles, bonuses
void gameplay_render_world()
{
  int v0; // esi
  int *v1; // edi
  int v2; // ecx
  int v3; // ecx

  ui_transition_alpha = (double)ui_elements_timeline / (double)(dword_48EB48 - dword_48EB4C);
  if ( quest_unlock_index_full < 40 )
  {
    if ( player_weapon_id[0] == 29 )
      weapon_assign_player(0, 1);
    if ( player2_weapon_id == 29 )
      weapon_assign_player(1, 1);
  }
  v0 = 0;
  v1 = player_weapon_id;
  do
  {
    if ( *v1 == 25 && dword_486FB8 != 25 )
      weapon_assign_player(v0, 1);
    if ( *v1 == 24 && dword_486FB8 != 24 )
      weapon_assign_player(v0, 1);
    v1 += 216;
    ++v0;
  }
  while ( (int)v1 < (int)dword_491230 );
  if ( !byte_487241 )
  {
    if ( game_state_id == 9
      || game_state_id == 6
      || (game_state_id == 8 || game_state_id == 12 || game_state_id == 7) && ui_transition_direction
      || game_state_pending == 9
      || game_state_pending == 6
      || game_state_pending == 5
      || game_state_pending == 2
      || game_state_pending == 3 )
    {
      goto LABEL_35;
    }
    if ( game_state_id == 5 )
    {
      if ( !game_state_pending )
      {
LABEL_38:
        ui_transition_alpha = (double)ui_elements_timeline / (double)(dword_48EB48 - dword_48EB4C);
        goto LABEL_39;
      }
      goto LABEL_35;
    }
    if ( game_state_id == 2
      || game_state_id == 3
      || game_state_pending == 21
      || game_state_pending == 7
      || game_state_pending == 8
      || game_state_pending == 12 )
    {
LABEL_35:
      ui_transition_alpha = 1.0;
    }
  }
  if ( game_state_id == 5 && !game_state_pending )
    goto LABEL_38;
LABEL_39:
  if ( ui_transition_alpha <= 1.0 )
  {
    if ( ui_transition_alpha < 0.0 )
      ui_transition_alpha = 0.0;
  }
  else
  {
    ui_transition_alpha = 1.0;
  }
  fx_queue_render();
  terrain_render();
  v2 = 0;
  for ( render_overlay_player_index = 0; v2 < config_player_count; render_overlay_player_index = v2 )
  {
    if ( *(float *)&player_health[216 * v2] <= 0.0 )
    {
      player_render_overlays();
      v2 = render_overlay_player_index;
    }
    ++v2;
  }
  creature_render_all();
  v3 = 0;
  for ( render_overlay_player_index = 0; v3 < config_player_count; render_overlay_player_index = v3 )
  {
    if ( *(float *)&player_health[216 * v3] > 0.0 )
    {
      player_render_overlays();
      v3 = render_overlay_player_index;
    }
    ++v3;
  }
  projectile_render();
  bonus_render();
  if ( screen_fade_alpha > 0.0 )
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 204))(
      grim_interface_ptr,
      0,
      0,
      0,
      LODWORD(screen_fade_alpha));
}

// perk_selection_screen_update @ 0x00405BE0
// perk selection screen: list choices, preview text, and selection handling
void perk_selection_screen_update()
{
  double v0; // st7
  int v1; // ecx
  _DWORD *v2; // eax
  int v3; // edi
  int *v4; // esi
  int *v5; // ebp
  float v6; // [esp+54h] [ebp-44h]
  float v7; // [esp+54h] [ebp-44h]
  int v8; // [esp+54h] [ebp-44h]
  float v9; // [esp+54h] [ebp-44h]
  float v10; // [esp+58h] [ebp-40h]
  float v11; // [esp+58h] [ebp-40h]
  int v12; // [esp+58h] [ebp-40h]
  int v13; // [esp+5Ch] [ebp-3Ch]
  char v14; // [esp+73h] [ebp-25h]
  int v15; // [esp+74h] [ebp-24h]
  float v16[2]; // [esp+78h] [ebp-20h] BYREF
  float xy; // [esp+80h] [ebp-18h] BYREF
  float v18; // [esp+84h] [ebp-14h]
  float v19; // [esp+88h] [ebp-10h]
  float v20; // [esp+8Ch] [ebp-Ch]
  float v21; // [esp+94h] [ebp-4h]

  gameplay_render_world();
  ui_elements_update_and_render();
  v21 = flt_48C634 + flt_48C658;
  v16[0] = 19.0;
  v14 = 0;
  v15 = 5;
  v19 = flt_48C654 + flt_48C630 + 180.0;
  v20 = v21 + 40.0;
  v18 = v20;
  xy = flt_48C620 + v19 + 44.0;
  v19 = xy;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  ui_draw_textured_quad((__int64)(xy + 54.0), (__int64)(v20 + 6.0), 128, 32, h);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1056964608);
  if ( (int)*(&player_perk_counts + perk_id_perk_master) <= 0 )
  {
    if ( (int)*(&player_perk_counts + perk_id_perk_expert) > 0 )
    {
      v11 = v18 - 8.0;
      v7 = xy - 26.0;
      (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v7),
        LODWORD(v11),
        aExtraPerkSpons);
      v15 = 6;
    }
  }
  else
  {
    v10 = v18 - 8.0;
    v6 = xy - 28.0;
    (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v6),
      LODWORD(v10),
      aExtraPerksSpon);
    v15 = 7;
  }
  if ( (int)*(&player_perk_counts + perk_id_perk_expert) <= 0 )
  {
    v0 = v18 + 50.0;
  }
  else
  {
    v0 = v18 + 40.0;
    v16[0] = 18.0;
  }
  v18 = v0;
  if ( (byte_4807C8 & 1) == 0 )
  {
    dword_480298 = 1049398413;
    byte_4807C8 |= 1u;
    dword_48029C = 1060418741;
    dword_4802A0 = 1064366321;
    dword_4802A4 = 1058642330;
    crt_atexit(nullsub_8);
  }
  if ( (byte_4807C8 & 2) == 0 )
  {
    dword_480310 = 1049398413;
    byte_4807C8 |= 2u;
    dword_480314 = 1060418741;
    dword_480318 = 1064366321;
    dword_48031C = 1065353216;
    crt_atexit(nullsub_7);
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  if ( (byte_4807C8 & 4) == 0 )
  {
    v1 = 10;
    byte_4807C8 |= 4u;
    v2 = &unk_4800B4;
    do
    {
      *((_BYTE *)v2 - 6) = 1;
      *v2 = 1065353216;
      *(v2 - 3) = 0;
      *((_BYTE *)v2 - 8) = 0;
      *((_BYTE *)v2 - 7) = 0;
      *(v2 - 1) = 0;
      v2 += 4;
      --v1;
    }
    while ( v1 );
    crt_atexit(nullsub_6);
  }
  v3 = 0;
  v4 = &item;
  v5 = perk_choice_ids;
  do
  {
    *v4 = perk_meta_table[5 * *v5];
    ui_menu_item_update(&xy, v4);
    if ( *((_BYTE *)v4 + 4) )
    {
      v14 = 1;
      dword_48089C = v3;
    }
    ++v3;
    ++v5;
    v4 += 4;
    v18 = v18 + v16[0];
  }
  while ( v3 < v15 );
  v18 = v18 + 32.0;
  if ( v15 > 5 )
    v18 = v18 - 20.0;
  xy = xy - 28.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v8,
    v12,
    v13);
  v9 = xy + 16.0;
  (*(void (__stdcall **)(_DWORD, float, int))(*(_DWORD *)grim_interface_ptr + 324))(
    LODWORD(v9),
    COERCE_FLOAT(LODWORD(v18)),
    perk_desc_table[5 * perk_choice_ids[dword_48089C]]);
  if ( (byte_4807C8 & 8) == 0 )
  {
    byte_480096 = 1;
    byte_4807C8 |= 8u;
    byte_4800A5 = 0;
    byte_4800A4 = 0;
    dword_4800A0 = 1065353216;
    dword_48009C = 0;
    dword_480090 = 0;
    byte_480094 = 0;
    byte_480095 = 0;
    dword_480098 = 0;
    crt_atexit(nullsub_5);
  }
  dword_480090 = (int)aCancel;
  if ( (byte_4807C8 & 0x10) == 0 )
  {
    byte_480826 = 1;
    byte_4807C8 |= 0x10u;
    byte_480835 = 0;
    byte_480834 = 0;
    dword_480830 = 1065353216;
    dword_48082C = 0;
    dword_480820 = 0;
    byte_480824 = 0;
    byte_480825 = 0;
    dword_480828 = 0;
    crt_atexit(nullsub_4);
  }
  dword_480820 = (int)aSelect;
  v16[0] = v19 + 162.0;
  v16[1] = v20 + 276.0;
  if ( ui_button_update(v16, (int)&dword_480090) )
  {
    ui_transition_direction = 0;
    game_state_pending = 9;
  }
  perk_prompt_update_and_render();
  ui_cursor_render();
  if ( v14 && dword_48089C >= 0 )
  {
    if ( byte_4800AD[16 * dword_48089C] )
    {
      sfx_play(sfx_ui_buttonclick);
      perk_apply(perk_choice_ids[dword_48089C]);
      ui_transition_direction = 0;
      game_state_pending = 9;
      --perk_pending_count;
      perk_choices_dirty = 1;
    }
  }
}

// nullsub_4 @ 0x00406130
void __cdecl nullsub_4()
{
  ;
}

// nullsub_5 @ 0x00406140
void __cdecl nullsub_5()
{
  ;
}

// nullsub_6 @ 0x00406150
void __cdecl nullsub_6()
{
  ;
}

// nullsub_7 @ 0x00406160
void __cdecl nullsub_7()
{
  ;
}

// nullsub_8 @ 0x00406170
void __cdecl nullsub_8()
{
  ;
}

// format_ordinal @ 0x00406180
// formats an integer as an English ordinal (e.g. 1st/2nd/3rd/4th) into a global scratch buffer
char *format_ordinal(int n)
{
  int v1; // edx

  if ( n >= 8 && n <= 20 )
    goto LABEL_10;
  v1 = n % 10;
  if ( !(n % 10) )
    goto LABEL_10;
  if ( v1 != 1 )
  {
    if ( v1 == 2 )
    {
      crt_sprintf(byte_4802C8, "%d%s", n, aNd);
      return byte_4802C8;
    }
    if ( v1 == 3 )
    {
      crt_sprintf(byte_4802C8, "%d%s", n, aRd);
      return byte_4802C8;
    }
LABEL_10:
    crt_sprintf(byte_4802C8, "%d%s", n, aTh);
    return byte_4802C8;
  }
  crt_sprintf(byte_4802C8, "%d%s", n, aSt);
  return byte_4802C8;
}

// ui_draw_clock_gauge @ 0x004061E0
// draws the 32x32 clock gauge at the current transform
void ui_draw_clock_gauge()
{
  int v0; // [esp+64h] [ebp-18h]
  int v1; // [esp+68h] [ebp-14h]
  int v2; // [esp+6Ch] [ebp-10h]
  float v3; // [esp+6Ch] [ebp-10h]
  int v4; // [esp+80h] [ebp+4h]
  int v5; // [esp+84h] [ebp+8h]
  float v6; // [esp+84h] [ebp+8h]
  int v7; // [esp+88h] [ebp+Ch]
  int v8; // [esp+8Ch] [ebp+10h]
  float v9; // [esp+8Ch] [ebp+10h]

  (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 21, 1);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    ui_clock_table_texture,
    0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    v8);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v9 = (float)v5;
  v6 = (float)v4;
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    LODWORD(v6),
    LODWORD(v9),
    1107296256,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v0,
    v1,
    v2);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7CC, 0);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v3 = (double)(v7 / 1000) * 0.10471976;
  (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v3));
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    LODWORD(v6),
    LODWORD(v9),
    1107296256,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
}

// FUN_00406350 @ 0x00406350
// [binja] int32_t sub_406350()
int FUN_00406350()
{
  int v0; // ecx
  int v1; // ecx
  int result; // eax
  int v3; // [esp+28h] [ebp-28h]
  int v4; // [esp+28h] [ebp-28h]
  int v5; // [esp+2Ch] [ebp-24h]
  int v6; // [esp+2Ch] [ebp-24h]
  int v7; // [esp+30h] [ebp-20h]
  int v8; // [esp+30h] [ebp-20h]
  float v9; // [esp+38h] [ebp-18h] BYREF
  float v10; // [esp+3Ch] [ebp-14h]
  float v11; // [esp+40h] [ebp-10h]
  float v12; // [esp+44h] [ebp-Ch]
  float v13; // [esp+4Ch] [ebp-4h]

  gameplay_render_world();
  ui_elements_update_and_render();
  v13 = flt_48DBDC + flt_48DC00;
  v11 = flt_48DBFC + flt_48DBD8 + 180.0;
  v12 = v13 + 40.0;
  v10 = v12;
  v9 = flt_48DBC8 + v11 + 44.0 - 10.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v10 = v12 + 6.0;
  if ( dword_487234 == -1 )
    dword_487234 = 0;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1061997773,
    v3,
    v5,
    v7);
  v0 = *(_DWORD *)grim_interface_ptr;
  if ( config_hardcore )
    (*(void (__cdecl **)(int, float, float, char *))(v0 + 320))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aIncredible);
  else
    (*(void (__cdecl **)(int, float, float, char *))(v0 + 320))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aCongratulation);
  v10 = v10 + 32.0;
  v9 = v9 - 8.0;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v4,
    v6,
    v8);
  v1 = *(_DWORD *)grim_interface_ptr;
  if ( config_hardcore )
  {
    (*(void (__cdecl **)(int, float, float, char *))(v1 + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aYouVeDoneTheTh);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aVirtuallyImpos);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aEffortsANewWea);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aForYouSplitter);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, CHAR *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      szPassword);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, CHAR *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      szPassword);
  }
  else
  {
    (*(void (__cdecl **)(int, float, float, char *))(v1 + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aYouVeCompleted);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aIsnTOverYetWit);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aAndWeaponsYour);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aYouCanAlsoRepl);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aAsAnAdditional);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aPlayingAComple);
    v10 = v10 + 14.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v9)),
      COERCE_FLOAT(LODWORD(v10)),
      aModeIsUnlocked);
  }
  v10 = v10 + 14.0 + 8.0;
  (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v9)),
    COERCE_FLOAT(LODWORD(v10)),
    aGoodLuckWithYo);
  v13 = flt_48DBDC + flt_48DC00;
  v11 = flt_48DBFC + flt_48DBD8 + 180.0;
  v12 = v13 + 40.0;
  v9 = v11 + flt_48DBC8 + 44.0 + 20.0;
  v10 = v12 + 170.0;
  if ( (byte_480321 & 1) == 0 )
  {
    byte_47F5E6 = 1;
    byte_480321 |= 1u;
    byte_47F5F5 = 0;
    byte_47F5F4 = 0;
    dword_47F5F0 = 1065353216;
    dword_47F5EC = 0;
    dword_47F5E0 = 0;
    byte_47F5E4 = 0;
    byte_47F5E5 = 0;
    dword_47F5E8 = 0;
    crt_atexit(nullsub_12);
  }
  dword_47F5E0 = (int)aSurvival;
  if ( (byte_480321 & 2) == 0 )
  {
    byte_480286 = 1;
    byte_480321 |= 2u;
    byte_480295 = 0;
    byte_480294 = 0;
    dword_480290 = 1065353216;
    dword_48028C = 0;
    dword_480280 = 0;
    byte_480284 = 0;
    byte_480285 = 0;
    dword_480288 = 0;
    crt_atexit(nullsub_11);
  }
  dword_480280 = (int)aRush;
  if ( (byte_480321 & 4) == 0 )
  {
    byte_48032E = 1;
    byte_480321 |= 4u;
    byte_48033D = 0;
    byte_48033C = 0;
    dword_480338 = 1065353216;
    dword_480334 = 0;
    dword_480328 = 0;
    byte_48032C = 0;
    byte_48032D = 0;
    dword_480330 = 0;
    crt_atexit(nullsub_10);
  }
  dword_480328 = (int)aTypOShooter;
  if ( (byte_480321 & 8) == 0 )
  {
    byte_48026E = 1;
    byte_480321 |= 8u;
    byte_48027D = 0;
    byte_48027C = 0;
    dword_480278 = 1065353216;
    dword_480274 = 0;
    dword_480268 = 0;
    byte_48026C = 0;
    byte_48026D = 0;
    dword_480270 = 0;
    crt_atexit(nullsub_9);
  }
  dword_480268 = (int)aMainMenu;
  v9 = v9 - 4.0 + 26.0;
  ui_button_update(&v9, (int)&dword_47F5E0);
  v10 = v10 + 32.0;
  ui_button_update(&v9, (int)&dword_480280);
  v10 = v10 + 32.0;
  ui_button_update(&v9, (int)&dword_480328);
  v10 = v10 + 32.0;
  ui_button_update(&v9, (int)&dword_480268);
  v10 = v10 + 32.0;
  if ( byte_480285 )
  {
    ui_transition_direction = 0;
    game_state_pending = 9;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    config_game_mode = 2;
  }
  if ( byte_47F5E5 )
  {
    ui_transition_direction = 0;
    game_state_pending = 9;
    config_game_mode = 1;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
  }
  if ( byte_48032D )
  {
    render_pass_mode = 0;
    ui_transition_direction = 0;
    game_state_pending = 18;
    config_game_mode = 4;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    byte_48702C = 1;
  }
  if ( byte_48026D )
  {
    sfx_mute_all(music_track_extra_0);
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_play_exclusive(music_track_crimson_theme_id);
    ui_transition_direction = 0;
    game_state_pending = 0;
    ui_sign_crimson_update_disabled = 0;
  }
  ui_cursor_render();
  return result;
}

// nullsub_9 @ 0x00406AB0
void __cdecl nullsub_9()
{
  ;
}

// nullsub_10 @ 0x00406AC0
void __cdecl nullsub_10()
{
  ;
}

// nullsub_11 @ 0x00406AD0
void __cdecl nullsub_11()
{
  ;
}

// nullsub_12 @ 0x00406AE0
void __cdecl nullsub_12()
{
  ;
}

// FUN_00406af0 @ 0x00406AF0
// [binja] int32_t sub_406af0()
int FUN_00406af0()
{
  int result; // eax

  if ( render_pass_mode || game_state_id == 5 )
    gameplay_render_world();
  else
    terrain_render();
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 204))(
    grim_interface_ptr,
    0,
    0,
    0,
    LODWORD(screen_fade_alpha));
  ui_elements_update_and_render();
  perk_prompt_update_and_render();
  ui_cursor_render();
  return result;
}

// perks_update_effects @ 0x00406B40
// updates perk timers/effects (regen, shields, evil eyes, jinxed, bonus timers)
void perks_update_effects()
{
  int v0; // edx
  int v1; // ecx
  int v6; // eax
  int v7; // eax
  int v8; // edx
  int v19; // edi
  float *v23; // esi
  int v27; // eax
  int v28; // edx
  float angle; // [esp+0h] [ebp-24h]
  float anglea; // [esp+0h] [ebp-24h]
  float angleb; // [esp+0h] [ebp-24h]
  float anglec; // [esp+0h] [ebp-24h]
  float angled; // [esp+0h] [ebp-24h]
  int v36; // [esp+18h] [ebp-Ch]
  int v37; // [esp+18h] [ebp-Ch]
  int v38; // [esp+18h] [ebp-Ch]
  int v39; // [esp+18h] [ebp-Ch]
  int v40; // [esp+18h] [ebp-Ch]
  int v41; // [esp+18h] [ebp-Ch]
  int unused; // [esp+1Ch] [ebp-8h] BYREF
  int v43; // [esp+20h] [ebp-4h]

  if ( perk_count_get(perk_id_regeneration) && (crt_rand() & 1) != 0 )
  {
    v0 = config_player_count;
    if ( config_player_count > 0 )
    {
      __asm { fld     player_health }
      v1 = config_player_count;
      do
      {
        __asm
        {
          fcom    ds:flt_46F2C4
          fnstsw  ax
        }
        if ( (_AX & 0x100) != 0 )
        {
          __asm
          {
            fcom    ds:flt_46F228
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
          {
            __asm
            {
              fadd    frame_dt
              fcom    ds:flt_46F2C4
              fnstsw  ax
            }
            if ( (_AX & 0x4100) == 0 )
            {
              __asm
              {
                fstp    st
                fld     ds:flt_46F2C4
              }
            }
          }
        }
        --v1;
      }
      while ( v1 );
      __asm { fstp    player_health }
    }
  }
  else
  {
    v0 = config_player_count;
  }
  __asm
  {
    fld     flt_4808A4
    fsub    frame_dt
    fst     flt_4808A4
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
  {
    flt_4808A4 = 0.25;
    v6 = (int)*(&player_perk_counts + perk_id_lean_mean_exp_machine);
    if ( v6 > 0 )
      player_experience[0] += 10 * v6;
  }
  render_overlay_player_index = 0;
  if ( v0 > 0 )
  {
    do
    {
      v7 = perk_count_get(perk_id_death_clock);
      v8 = render_overlay_player_index;
      if ( v7 )
      {
        _EAX = 864 * render_overlay_player_index;
        __asm
        {
          fld     dword ptr [eax+4908D4h]
          fcomp   ds:flt_46F228
        }
        _ECX = &player_health[216 * render_overlay_player_index];
        __asm { fnstsw  ax }
        if ( (_EAX & 0x4100) != 0 )
        {
          *_ECX = 0;
        }
        else
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F304
            fsubr   dword ptr [ecx]
            fstp    dword ptr [ecx]
          }
          *(float *)_ECX = _ET1;
        }
      }
      _ECX = 864 * v8;
      __asm
      {
        fld     dword ptr [ecx+490BC8h]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
      {
        player_shield_timer[216 * v8] = 0;
      }
      else
      {
        __asm
        {
          fld     dword ptr [ecx+490BC8h]
          fsub    frame_dt
          fstp    dword ptr [ecx+490BC8h]
        }
        player_shield_timer[216 * v8] = _ET1;
      }
      __asm
      {
        fld     dword ptr [ecx+490BCCh]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
      {
        player_fire_bullets_timer[216 * v8] = 0;
      }
      else
      {
        __asm
        {
          fld     dword ptr [ecx+490BCCh]
          fsub    frame_dt
          fstp    dword ptr [ecx+490BCCh]
        }
        player_fire_bullets_timer[216 * v8] = _ET1;
      }
      __asm
      {
        fld     dword ptr [ecx+490BC4h]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
      {
        player_speed_bonus_timer[216 * v8] = 0;
      }
      else
      {
        __asm
        {
          fld     dword ptr [ecx+490BC4h]
          fsub    frame_dt
          fstp    dword ptr [ecx+490BC4h]
        }
        player_speed_bonus_timer[216 * v8] = _ET1;
      }
      render_overlay_player_index = v8 + 1;
    }
    while ( v8 + 1 < config_player_count );
  }
  dword_487268 = -1;
  if ( (int)*(&player_perk_counts + perk_id_doctor) > 0
    || (int)*(&player_perk_counts + perk_id_pyrokinetic) > 0
    || (int)*(&player_perk_counts + perk_id_evil_eyes) > 0 )
  {
    evil_eyes_target_creature = -1;
    v19 = creature_find_in_radius((float *)player_aim_x, 12.0, 0);
    if ( v19 != -1 )
    {
      if ( perk_count_get(perk_id_doctor) )
        dword_487268 = v19;
      if ( perk_count_get(perk_id_pyrokinetic) )
      {
        _ECX = 152 * v19;
        __asm
        {
          fld     dword ptr [ecx+49BF44h]
          fsub    frame_dt
          fst     dword ptr [ecx+49BF44h]
        }
        *(float *)(_ECX + 4833092) = _ET1;
        __asm
        {
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x100) != 0 )
        {
          creature_collision_timer[38 * v19] = 1056964608;
          v23 = (float *)((char *)&creature_pos_x + _ECX);
          unused = 0;
          v43 = 0;
          v36 = crt_rand() % 628;
          __asm
          {
            fild    [esp+24h+var_C]
            fmul    ds:flt_46F300
            fstp    [esp+24h+angle]; angle
          }
          fx_spawn_particle(v23, angle, &unused, 0.80000001);
          unused = 0;
          v43 = 0;
          v37 = crt_rand() % 628;
          __asm
          {
            fild    [esp+24h+var_C]
            fmul    ds:flt_46F300
            fstp    [esp+24h+angle]; angle
          }
          fx_spawn_particle(v23, anglea, &unused, 0.60000002);
          unused = 0;
          v43 = 0;
          v38 = crt_rand() % 628;
          __asm
          {
            fild    [esp+24h+var_C]
            fmul    ds:flt_46F300
            fstp    [esp+24h+angle]; angle
          }
          fx_spawn_particle(v23, angleb, &unused, 0.40000001);
          unused = 0;
          v43 = 0;
          v39 = crt_rand() % 628;
          __asm
          {
            fild    [esp+24h+var_C]
            fmul    ds:flt_46F300
            fstp    [esp+24h+angle]; angle
          }
          fx_spawn_particle(v23, anglec, &unused, 0.30000001);
          unused = 0;
          v43 = 0;
          v40 = crt_rand() % 628;
          __asm
          {
            fild    [esp+20h+var_C]
            fmul    ds:flt_46F300
          }
          __asm { fstp    [esp+24h+angle]; angle }
          fx_spawn_particle(v23, angled, &unused, 0.2);
          fx_queue_add_random(v23);
        }
      }
      if ( perk_count_get(perk_id_evil_eyes) )
        evil_eyes_target_creature = v19;
    }
  }
  if ( !perk_count_get(perk_id_evil_eyes) )
    evil_eyes_target_creature = -1;
  __asm
  {
    fld     flt_4AAF1C
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
    goto LABEL_45;
  __asm
  {
    fld     flt_4AAF1C
    fsub    frame_dt
    fst     flt_4AAF1C
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
  {
LABEL_45:
    if ( (int)*(&player_perk_counts + perk_id_jinxed) > 0 )
    {
      if ( crt_rand() % 10 == 3 )
      {
        __asm
        {
          fld     player_health
          fsub    ds:flt_46F288
        }
        __asm { fstp    player_health }
        fx_queue_add_random((float *)player_pos_x);
        fx_queue_add_random((float *)player_pos_x);
      }
      v41 = crt_rand() % 20;
      __asm
      {
        fild    [esp+14h+var_C]
        fmul    ds:flt_46F2FC
        fadd    flt_4AAF1C
        fadd    ds:flt_46F238
        fstp    flt_4AAF1C
        fld     bonus_freeze_timer
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
      {
        v27 = crt_rand();
        render_overlay_player_index = 0;
        v28 = v27 % 383;
        do
        {
          if ( creature_pool[152 * v28] )
            break;
          v28 = crt_rand() % 383;
          ++render_overlay_player_index;
        }
        while ( render_overlay_player_index < 10 );
        render_overlay_player_index = 0;
        _ESI = 152 * v28;
        if ( creature_pool[152 * v28] )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F2B4
          }
          creature_health[38 * v28] = -1082130432;
          __asm
          {
            fsubr   dword ptr [esi+49BF48h]
            fstp    dword ptr [esi+49BF48h]
          }
          creature_hitbox_size[38 * v28] = _ET1;
          __asm
          {
            fild    player_experience
            fadd    dword ptr [esi+49BF9Ch]
          }
          player_experience[0] = ((signed __int64 (__usercall *)@<edx:eax>())_ftol)();
          sfx_play_panned(sfx_trooper_inpain_01_alias_1);
        }
      }
    }
  }
}

// quest_mode_update @ 0x004070E0
// quest mode update: spawn timeline, stage completion, and transitions
void quest_mode_update()
{
  int v0; // eax
  int v1; // eax
  int v2; // eax

  if ( !console_open_flag && render_pass_mode )
  {
    if ( !(unsigned __int8)creatures_none_active() || !(unsigned __int8)quest_spawn_table_empty() )
      quest_spawn_timeline += frame_dt_ms;
    dword_487244 += frame_dt_ms;
  }
  quest_spawn_timeline_update();
  if ( !demo_mode_active && (unsigned __int8)creatures_none_active() && (unsigned __int8)quest_spawn_table_empty() )
  {
    v0 = dword_487088;
    bonus_reflex_boost_timer = 0.0;
    if ( dword_487088 >= 0 )
    {
      if ( dword_487088 <= 800 || dword_487088 > 850 )
      {
        if ( dword_487088 <= 2000 || dword_487088 > 2050 )
        {
          if ( dword_487088 > 2500 )
          {
            v2 = quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 10;
            if ( v2 > quest_unlock_index )
              quest_unlock_index = quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 10;
            if ( config_hardcore )
            {
              if ( v2 > quest_unlock_index_full )
                quest_unlock_index_full = quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 10;
            }
            game_save_status();
            game_state_pending = 8;
            ui_transition_direction = 0;
            (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
            console_input_poll();
            v0 = dword_487088;
            highscore_score_xp = 0;
          }
          dword_487088 = frame_dt_ms + v0;
        }
        else
        {
          dword_487088 = 2051;
          sfx_play_exclusive(music_track_crimsonquest_id);
          v1 = frame_dt_ms + dword_487088;
          sfx_volume_table[music_track_crimsonquest_id] = 0.0;
          dword_487088 = v1;
        }
      }
      else
      {
        sfx_play(sfx_questhit);
        dword_487088 = frame_dt_ms + 851;
      }
    }
    else
    {
      sfx_mute_all(music_track_extra_0);
      ++dword_4856B8[10 * *(_DWORD *)quest_stage_major + quest_stage_minor];
      dword_487088 = frame_dt_ms;
    }
  }
}

// rush_mode_update @ 0x004072B0
// rush mode update: spawns edge waves and handles demo exit
void rush_mode_update()
{
  double v0; // st7
  int v1; // eax
  long double v2; // st7
  int v3; // eax
  int v4; // ecx
  float pos[2]; // [esp+4h] [ebp-20h] BYREF
  float v6[2]; // [esp+Ch] [ebp-18h] BYREF
  float tint_rgba; // [esp+14h] [ebp-10h] BYREF
  float v8; // [esp+18h] [ebp-Ch]
  float v9; // [esp+1Ch] [ebp-8h]
  int v10; // [esp+20h] [ebp-4h]

  player_weapon_id[0] = 2;
  player_ammo[0] = 1106247680;
  player2_weapon_id = 2;
  player2_ammo = 1106247680;
  if ( !console_open_flag )
  {
    for ( survival_spawn_cooldown -= frame_dt_ms * config_player_count;
          survival_spawn_cooldown < 0;
          *(float *)(v3 * 4 + 4833172) = *(float *)(v3 * 4 + 4833172) * 1.4 )
    {
      survival_spawn_cooldown += 250;
      v0 = (double)(survival_elapsed_ms + 1);
      v10 = 1065353216;
      tint_rgba = v0 * 0.0000083333334 + 0.30000001;
      v8 = v0 * 10000.0 + 0.30000001;
      v9 = sin(v0 * 0.0001) + 0.30000001;
      if ( tint_rgba >= 0.0 )
      {
        if ( tint_rgba > 1.0 )
          tint_rgba = 1.0;
      }
      else
      {
        tint_rgba = 0.0;
      }
      if ( v8 >= 0.0 )
      {
        if ( v8 > 1.0 )
          v8 = 1.0;
      }
      else
      {
        v8 = 0.0;
      }
      if ( v9 >= 0.0 )
      {
        if ( v9 > 1.0 )
          v9 = 1.0;
      }
      else
      {
        v9 = 0.0;
      }
      pos[0] = (double)terrain_texture_width + 64.0;
      pos[1] = cos((double)survival_elapsed_ms * 0.001) * 256.0 + (double)terrain_texture_height * 0.5;
      v1 = creature_spawn(pos, &tint_rgba, 2);
      v6[0] = -64.0;
      v2 = sin((double)survival_elapsed_ms * 0.001);
      creature_ai_mode[38 * v1] = 8;
      v6[1] = v2 * 256.0 + (double)terrain_texture_height * 0.5;
      v3 = 38 * creature_spawn(v6, &tint_rgba, 3);
      creature_ai_mode[v3] = 8;
      v4 = creature_flags[v3];
      LOBYTE(v4) = v4 | 0x80;
      creature_flags[v3] = v4;
    }
    if ( demo_mode_active )
    {
      if ( quest_spawn_timeline > demo_time_limit_ms )
      {
        render_pass_mode = 0;
        demo_mode_start();
      }
    }
  }
}

// survival_spawn_creature @ 0x00407510
// spawns a creature at the given position, selecting type/stats based on DAT_0049095c
void survival_spawn_creature(float *pos)
{
  int v1; // esi
  int v2; // edx
  int v3; // eax
  int v4; // eax
  double v5; // st7
  int v6; // eax
  int v7; // eax
  double v8; // st7
  int v9; // edi
  double v10; // st7
  double v11; // st7
  double v12; // st7
  double v13; // st7
  double v14; // st7
  int v15; // edx
  float *posa; // [esp+20h] [ebp+4h]

  v1 = 152 * creature_alloc_slot() + 4833080;
  *(float *)(v1 + 20) = *pos;
  *(float *)(v1 + 24) = pos[1];
  *(_BYTE *)(v1 + 9) = 0;
  *(_DWORD *)(v1 + 12) = 0;
  *(_DWORD *)(v1 + 144) = 0;
  v2 = crt_rand() % 10;
  if ( player_experience[0] >= 12000 )
  {
    if ( player_experience[0] >= 25000 )
    {
      if ( player_experience[0] >= 42000 )
      {
        if ( player_experience[0] < 50000 )
        {
          *(_DWORD *)(v1 + 108) = 2;
          goto LABEL_25;
        }
        if ( player_experience[0] < 90000 )
        {
          *(_DWORD *)(v1 + 108) = 4;
          goto LABEL_25;
        }
        if ( player_experience[0] < 110000 )
          goto LABEL_24;
        if ( v2 <= 5 )
        {
          *(_DWORD *)(v1 + 108) = 2;
          goto LABEL_25;
        }
        if ( v2 > 8 )
LABEL_24:
          *(_DWORD *)(v1 + 108) = 0;
        else
          *(_DWORD *)(v1 + 108) = 4;
      }
      else if ( v2 > 4 )
      {
        *(_DWORD *)(v1 + 108) = crt_rand() % 2 + 3;
      }
      else
      {
        *(_DWORD *)(v1 + 108) = 2;
      }
    }
    else
    {
      if ( v2 > 3 )
        *(_DWORD *)(v1 + 108) = 3;
      else
        *(_DWORD *)(v1 + 108) = 0;
      if ( v2 >= 9 )
        *(_DWORD *)(v1 + 108) = 2;
    }
  }
  else if ( v2 > 8 )
  {
    *(_DWORD *)(v1 + 108) = 3;
  }
  else
  {
    *(_DWORD *)(v1 + 108) = 2;
  }
LABEL_25:
  if ( (crt_rand() & 0x1F) == 2 )
    *(_DWORD *)(v1 + 108) = 3;
  v3 = crt_rand();
  *(_BYTE *)v1 = 1;
  *(_BYTE *)(v1 + 76) = 0;
  *(_DWORD *)(v1 + 16) = 1098907648;
  *(_DWORD *)(v1 + 28) = 0;
  *(_DWORD *)(v1 + 32) = 0;
  *(float *)(v1 + 52) = (float)(v3 % 20 + 44);
  *(float *)(v1 + 44) = (double)(crt_rand() % 314) * 0.0099999998;
  v4 = *(_DWORD *)(v1 + 108);
  *(float *)(v1 + 92) = (double)(player_experience[0] / 4000) * 0.045000002 + 0.89999998;
  if ( v4 == 3 )
  {
    v5 = *(float *)(v1 + 92) * 1.3;
    v6 = *(_DWORD *)(v1 + 140);
    LOBYTE(v6) = v6 | 0x80;
    *(_DWORD *)(v1 + 140) = v6;
    *(float *)(v1 + 92) = v5;
  }
  posa = (float *)(crt_rand() & 0xF);
  v7 = *(_DWORD *)(v1 + 108);
  *(float *)(v1 + 36) = (double)(int)posa + (double)player_experience[0] * 0.00125 + 52.0;
  if ( !v7 )
  {
    v8 = *(float *)(v1 + 92) * 0.60000002;
    *(float *)(v1 + 92) = v8;
    if ( v8 < 1.3 )
      *(_DWORD *)(v1 + 92) = 1067869798;
    *(float *)(v1 + 36) = *(float *)(v1 + 36) * 1.5;
  }
  if ( *(float *)(v1 + 92) > 3.5 )
    *(_DWORD *)(v1 + 92) = 1080033280;
  *(_DWORD *)(v1 + 96) = 0;
  *(_DWORD *)(v1 + 100) = 0;
  if ( player_experience[0] >= 50000 )
  {
    v9 = v1 + 60;
    if ( player_experience[0] >= 100000 )
    {
      *(float *)v9 = 1.0 - 1.0 / ((double)(player_experience[0] / 1000) + 10.0);
      *(float *)(v1 + 64) = (double)(crt_rand() % 10) * 0.0099999998
                          + 0.89999998
                          - 1.0 / ((double)(player_experience[0] / 10000) + 10.0);
      v10 = (double)(crt_rand() % 10) * 0.0099999998 + 1.0 - (double)(player_experience[0] - 100000) * 0.0000030000001;
      *(float *)(v1 + 68) = v10;
      if ( v10 < 0.5 )
        *(_DWORD *)(v1 + 68) = 1056964608;
    }
    else
    {
      *(float *)v9 = 0.89999998 - 1.0 / ((double)(player_experience[0] / 1000) + 10.0);
      *(float *)(v1 + 64) = (double)(crt_rand() % 10) * 0.0099999998
                          + 0.80000001
                          - 1.0 / ((double)(player_experience[0] / 10000) + 10.0);
      *(float *)(v1 + 68) = (double)(crt_rand() % 10) * 0.0099999998
                          + (double)(player_experience[0] - 50000) * 0.0000060000002
                          + 0.69999999;
    }
  }
  else
  {
    v9 = v1 + 60;
    *(float *)(v1 + 60) = 1.0 - 1.0 / ((double)(player_experience[0] / 1000) + 10.0);
    *(float *)(v1 + 64) = (double)(crt_rand() % 10) * 0.0099999998
                        + 0.89999998
                        - 1.0 / ((double)(player_experience[0] / 10000) + 10.0);
    *(float *)(v1 + 68) = (double)(crt_rand() % 10) * 0.0099999998 + 0.69999999;
  }
  v11 = *(float *)(v1 + 52) * 0.095238097;
  *(_DWORD *)(v1 + 72) = 1065353216;
  *(float *)(v1 + 88) = v11;
  if ( *(float *)(v1 + 100) == 0.0 )
    *(float *)(v1 + 100) = (double)(crt_rand() % 10 + 10)
                         + *(float *)(v1 + 92) * 5.0
                         + *(float *)(v1 + 88) * 0.80000001
                         + *(float *)(v1 + 36) * 0.40000001;
  if ( crt_rand() % 180 >= 2 )
  {
    if ( crt_rand() % 240 >= 2 )
    {
      if ( crt_rand() % 360 < 2 )
      {
        *(_DWORD *)v9 = 1053609165;
        *(_DWORD *)(v1 + 36) = 1123680256;
        *(_DWORD *)(v9 + 4) = 1053609165;
        *(_DWORD *)(v1 + 100) = 1140981760;
        *(_DWORD *)(v9 + 8) = 1063675494;
        *(_DWORD *)(v9 + 12) = 1065353216;
      }
    }
    else
    {
      *(_DWORD *)v9 = 1053609165;
      *(_DWORD *)(v1 + 36) = 1118437376;
      *(_DWORD *)(v9 + 4) = 1063675494;
      *(_DWORD *)(v1 + 100) = 1137836032;
      *(_DWORD *)(v9 + 8) = 1053609165;
      *(_DWORD *)(v9 + 12) = 1065353216;
    }
  }
  else
  {
    *(_DWORD *)v9 = 1063675494;
    *(_DWORD *)(v1 + 36) = 1115815936;
    *(_DWORD *)(v9 + 4) = 1053609165;
    *(_DWORD *)(v1 + 100) = 1134559232;
    *(_DWORD *)(v9 + 8) = 1053609165;
    *(_DWORD *)(v9 + 12) = 1065353216;
  }
  if ( crt_rand() % 1320 >= 4 )
  {
    if ( crt_rand() % 1620 < 4 )
    {
      v13 = *(float *)(v1 + 36) + 2230.0;
      *(_DWORD *)v9 = 1064346583;
      *(float *)(v1 + 36) = v13;
      *(_DWORD *)(v9 + 4) = 1062668861;
      *(_DWORD *)(v1 + 52) = 1118437376;
      *(_DWORD *)(v9 + 8) = 1049918177;
      *(_DWORD *)(v1 + 100) = 1147207680;
      *(_DWORD *)(v9 + 12) = 1065353216;
    }
  }
  else
  {
    v12 = *(float *)(v1 + 36) + 230.0;
    *(_DWORD *)v9 = 1062668861;
    *(float *)(v1 + 36) = v12;
    *(_DWORD *)(v9 + 4) = 1047904911;
    *(_DWORD *)(v1 + 52) = 1117782016;
    *(_DWORD *)(v9 + 8) = 1063507722;
    *(_DWORD *)(v1 + 100) = 1142292480;
    *(_DWORD *)(v9 + 12) = 1065353216;
  }
  v14 = *(float *)(v1 + 100) * 0.80000001;
  v15 = *(_DWORD *)(v1 + 36);
  *(_BYTE *)(v1 + 8) = 1;
  *(_DWORD *)(v1 + 40) = v15;
  *(float *)(v1 + 100) = v14;
  if ( *(float *)v9 >= 0.0 )
  {
    if ( *(float *)v9 > 1.0 )
      *(_DWORD *)v9 = 1065353216;
  }
  else
  {
    *(_DWORD *)v9 = 0;
  }
  if ( *(float *)(v9 + 4) >= 0.0 )
  {
    if ( *(float *)(v9 + 4) > 1.0 )
      *(_DWORD *)(v9 + 4) = 1065353216;
  }
  else
  {
    *(_DWORD *)(v9 + 4) = 0;
  }
  if ( *(float *)(v9 + 8) >= 0.0 )
  {
    if ( *(float *)(v9 + 8) > 1.0 )
      *(_DWORD *)(v9 + 8) = 1065353216;
  }
  else
  {
    *(_DWORD *)(v9 + 8) = 0;
  }
  if ( *(float *)(v9 + 12) >= 0.0 )
  {
    if ( *(float *)(v9 + 12) > 1.0 )
      *(_DWORD *)(v9 + 12) = 1065353216;
  }
  else
  {
    *(_DWORD *)(v9 + 12) = 0;
  }
}

// survival_update @ 0x00407CD0
// main survival mode update: timers, scripted spawns, and enemy wave spawning
void survival_update()
{
  int v0; // ecx
  double v1; // st4
  int v2; // esi
  int v3; // esi
  int v4; // esi
  int v5; // esi
  int v6; // esi
  int v7; // esi
  int v8; // esi
  int v9; // esi
  bool v10; // sf
  int v11; // esi
  unsigned int v12; // edi
  int v13; // ebp
  int v14; // eax
  float *v15; // ecx
  int v16; // ebp
  int v17; // ebp
  int v18; // eax
  int v19; // ebp
  int v20; // eax
  int v21; // esi
  int v22; // eax
  float *v23; // edx
  int v24; // esi
  int v25; // esi
  int v26; // eax
  int v27; // esi
  int pos; // [esp+Ch] [ebp-48h] BYREF
  float v29; // [esp+10h] [ebp-44h]
  float v30; // [esp+14h] [ebp-40h] BYREF
  float v31; // [esp+18h] [ebp-3Ch]
  float v32[2]; // [esp+1Ch] [ebp-38h] BYREF
  float v33[2]; // [esp+24h] [ebp-30h] BYREF
  float v34[2]; // [esp+2Ch] [ebp-28h] BYREF
  float v35[2]; // [esp+34h] [ebp-20h] BYREF
  float v36[2]; // [esp+3Ch] [ebp-18h] BYREF
  float v37[2]; // [esp+44h] [ebp-10h] BYREF
  float v38[2]; // [esp+4Ch] [ebp-8h] BYREF

  if ( console_open_flag )
    return;
  v0 = frame_dt_ms + quest_spawn_timeline;
  quest_spawn_timeline += frame_dt_ms;
  if ( demo_mode_active )
  {
    if ( v0 > demo_time_limit_ms )
    {
      render_pass_mode = 0;
      demo_mode_start();
    }
    return;
  }
  if ( config_player_count == 1 )
  {
    if ( !survival_reward_damage_seen
      && !survival_reward_fire_seen
      && survival_elapsed_ms > 64000
      && survival_reward_handout_enabled )
    {
      if ( player_weapon_id[0] == 1 )
      {
        weapon_assign_player(0, 24);
        dword_486FB8 = 24;
      }
      survival_reward_handout_enabled = 0;
      survival_reward_damage_seen = 1;
      survival_reward_fire_seen = 1;
    }
    if ( survival_recent_death_count == 3 && !survival_reward_fire_seen )
    {
      v29 = flt_486FF4 + *(float *)survival_recent_death_pos_y;
      v29 = flt_486FFC + v29;
      v29 = v29 * 0.33333334;
      v1 = *(float *)player_pos_x
         - (survival_recent_death_pos[0] + survival_recent_death_pos_1 + survival_recent_death_pos_2) * 0.33333334;
      if ( sqrt((*(float *)player_pos_y - v29) * (*(float *)player_pos_y - v29) + v1 * v1) < 16.0
        && *(float *)player_health < 15.0 )
      {
        weapon_assign_player(0, 25);
        dword_486FB8 = 25;
        survival_reward_fire_seen = 1;
        survival_reward_handout_enabled = 0;
      }
    }
  }
  if ( !survival_spawn_stage )
  {
    if ( player_level[0] <= 4 )
      goto LABEL_59;
    survival_spawn_stage = 1;
    pos = -1021050880;
    v29 = 512.0;
    creature_spawn_template(18, (float *)&pos, 3.1415927);
    pos = 1150582784;
    v29 = 512.0;
    creature_spawn_template(18, (float *)&pos, 3.1415927);
  }
  if ( survival_spawn_stage == 1 )
  {
    if ( player_level[0] <= 8 )
      goto LABEL_59;
    survival_spawn_stage = 2;
    pos = 1149763584;
    v29 = 512.0;
    creature_spawn_template(44, (float *)&pos, 3.1415927);
  }
  if ( survival_spawn_stage == 2 )
  {
    if ( player_level[0] <= 10 )
      goto LABEL_59;
    v2 = 0;
    survival_spawn_stage = 3;
    pos = 0;
    do
    {
      v30 = 1088.0;
      v31 = (double)pos * 42.666668 + 256.0;
      creature_spawn_template(53, &v30, 3.1415927);
      pos = ++v2;
    }
    while ( v2 < 12 );
  }
  if ( survival_spawn_stage == 3 )
  {
    if ( player_level[0] <= 12 )
      goto LABEL_59;
    v3 = 0;
    survival_spawn_stage = 4;
    pos = 0;
    do
    {
      v30 = 1088.0;
      v31 = (double)pos * 64.0 + 384.0;
      creature_spawn_template(43, &v30, 3.1415927);
      pos = ++v3;
    }
    while ( v3 < 4 );
  }
  if ( survival_spawn_stage == 4 )
  {
    if ( player_level[0] <= 14 )
      goto LABEL_59;
    v4 = 0;
    survival_spawn_stage = 5;
    pos = 0;
    do
    {
      v30 = 1088.0;
      v31 = (double)pos * 64.0 + 384.0;
      creature_spawn_template(56, &v30, 3.1415927);
      pos = ++v4;
    }
    while ( v4 < 4 );
    v5 = 0;
    pos = 0;
    do
    {
      v30 = -64.0;
      v31 = (double)pos * 64.0 + 384.0;
      creature_spawn_template(56, &v30, 3.1415927);
      pos = ++v5;
    }
    while ( v5 < 4 );
  }
  if ( survival_spawn_stage == 5 )
  {
    if ( player_level[0] <= 16 )
      goto LABEL_59;
    survival_spawn_stage = 6;
    v30 = 1088.0;
    v31 = 512.0;
    creature_spawn_template(58, &v30, 3.1415927);
  }
  if ( survival_spawn_stage == 6 )
  {
    if ( player_level[0] <= 18 )
      goto LABEL_59;
    survival_spawn_stage = 7;
    v30 = 640.0;
    v31 = 512.0;
    creature_spawn_template(1, &v30, 3.1415927);
  }
  if ( survival_spawn_stage == 7 )
  {
    if ( player_level[0] <= 20 )
      goto LABEL_59;
    survival_spawn_stage = 8;
    v30 = 384.0;
    v31 = 256.0;
    creature_spawn_template(1, &v30, 3.1415927);
    v30 = 640.0;
    v31 = 768.0;
    creature_spawn_template(1, &v30, 3.1415927);
  }
  if ( survival_spawn_stage != 8 )
    goto LABEL_53;
  if ( player_level[0] > 25 )
  {
    v6 = 0;
    survival_spawn_stage = 9;
    pos = 0;
    do
    {
      v30 = 1088.0;
      v31 = (double)pos * 64.0 + 384.0;
      creature_spawn_template(60, &v30, 3.1415927);
      pos = ++v6;
    }
    while ( v6 < 4 );
    v7 = 0;
    pos = 0;
    do
    {
      v30 = -64.0;
      v31 = (double)pos * 64.0 + 384.0;
      creature_spawn_template(60, &v30, 3.1415927);
      pos = ++v7;
    }
    while ( v7 < 4 );
LABEL_53:
    if ( survival_spawn_stage == 9 && player_level[0] > 31 )
    {
      survival_spawn_stage = 10;
      v30 = 1088.0;
      v31 = 512.0;
      creature_spawn_template(58, &v30, 3.1415927);
      v30 = -64.0;
      v31 = 512.0;
      creature_spawn_template(58, &v30, 3.1415927);
      v8 = 0;
      pos = 0;
      do
      {
        v31 = -64.0;
        v30 = (double)pos * 64.0 + 384.0;
        creature_spawn_template(60, &v30, 3.1415927);
        pos = ++v8;
      }
      while ( v8 < 4 );
      v9 = 0;
      pos = 0;
      do
      {
        v31 = 1088.0;
        v30 = (double)pos * 64.0 + 384.0;
        creature_spawn_template(60, &v30, 3.1415927);
        pos = ++v9;
      }
      while ( v9 < 4 );
    }
  }
LABEL_59:
  v10 = survival_spawn_cooldown - frame_dt_ms * config_player_count < 0;
  render_overlay_player_index = 0;
  survival_spawn_cooldown -= frame_dt_ms * config_player_count;
  if ( v10 )
  {
    do
    {
      v11 = 500 - survival_elapsed_ms / 1800;
      if ( v11 < 0 )
      {
        v12 = (unsigned int)(1 - v11) >> 1;
        v11 += 2 * v12;
        do
        {
          switch ( crt_rand() & 3 )
          {
            case 0:
              v13 = terrain_texture_width;
              v14 = crt_rand();
              v31 = -40.0;
              v15 = &v30;
              pos = v14 % v13;
              v30 = (float)(v14 % v13);
              goto LABEL_67;
            case 1:
              v16 = terrain_texture_width;
              pos = crt_rand() % v16;
              v32[0] = (float)pos;
              v32[1] = (double)terrain_texture_height + 40.0;
              survival_spawn_creature(v32);
              break;
            case 2:
              v17 = terrain_texture_height;
              v18 = crt_rand();
              v33[0] = -40.0;
              pos = v18 % v17;
              v33[1] = (float)(v18 % v17);
              survival_spawn_creature(v33);
              break;
            case 3:
              v19 = terrain_texture_height;
              v20 = crt_rand();
              v15 = v34;
              pos = v20 % v19;
              v34[0] = (double)terrain_texture_width + 40.0;
              v34[1] = (float)(v20 % v19);
LABEL_67:
              survival_spawn_creature(v15);
              break;
            default:
              break;
          }
          --v12;
        }
        while ( v12 );
      }
      if ( v11 < 1 )
        v11 = 1;
      survival_spawn_cooldown += v11;
      switch ( crt_rand() & 3 )
      {
        case 0:
          v21 = terrain_texture_width;
          v22 = crt_rand();
          v35[1] = -40.0;
          pos = v22 % v21;
          v23 = v35;
          v35[0] = (float)(v22 % v21);
          goto LABEL_76;
        case 1:
          v24 = terrain_texture_width;
          pos = crt_rand() % v24;
          v36[0] = (float)pos;
          v36[1] = (double)terrain_texture_height + 40.0;
          survival_spawn_creature(v36);
          break;
        case 2:
          v25 = terrain_texture_height;
          v26 = crt_rand();
          v37[0] = -40.0;
          pos = v26 % v25;
          v37[1] = (float)(v26 % v25);
          survival_spawn_creature(v37);
          break;
        case 3:
          v27 = terrain_texture_height;
          pos = crt_rand() % v27;
          v23 = v38;
          v38[0] = (double)terrain_texture_width + 40.0;
          v38[1] = (float)pos;
LABEL_76:
          survival_spawn_creature(v23);
          break;
        default:
          break;
      }
    }
    while ( survival_spawn_cooldown < 0 );
  }
}

// tutorial_prompt_dialog @ 0x00408530
// renders tutorial prompt text + Repeat/Play/Skip buttons and handles selections
void tutorial_prompt_dialog(char *text, float alpha)
{
  int v2; // ebp
  int v3; // esi
  int v4; // edi
  double v5; // st7
  float v6; // [esp+30h] [ebp-48h]
  float v7; // [esp+4Ch] [ebp-2Ch]
  float v8; // [esp+50h] [ebp-28h]
  float v9; // [esp+54h] [ebp-24h]
  float v10; // [esp+58h] [ebp-20h] BYREF
  float v11; // [esp+5Ch] [ebp-1Ch]
  int v12; // [esp+60h] [ebp-18h]
  float v13; // [esp+64h] [ebp-14h]
  int v14; // [esp+68h] [ebp-10h] BYREF
  int v15; // [esp+6Ch] [ebp-Ch]
  float v16; // [esp+70h] [ebp-8h]
  float v17; // [esp+74h] [ebp-4h]
  char v18; // [esp+84h] [ebp+Ch]

  v2 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, text);
  v3 = 1;
  if ( strchr(text, 10) )
    v3 = 2;
  if ( v18 )
    v3 = 4;
  v4 = (__int64)((double)(*(_DWORD *)config_screen_width / 2) - (double)v2 * 0.5 - 20.0);
  v17 = alpha * 0.80000001;
  v9 = (float)v4;
  v10 = v9;
  v14 = 0;
  v15 = 0;
  v16 = 0.0;
  v7 = (float)(16 * v3 + 6);
  v11 = 64.0;
  v8 = (float)(v2 + 40);
  (*(void (__thiscall **)(int, float *, _DWORD, _DWORD, int *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    &v10,
    LODWORD(v8),
    LODWORD(v7),
    &v14);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(alpha));
  v11 = 64.0;
  v10 = v9;
  (*(void (__thiscall **)(int, float *, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    &v10,
    LODWORD(v8),
    LODWORD(v7));
  v10 = 1.0;
  v12 = 1065353216;
  v14 = 1065353216;
  v11 = 1.0;
  v13 = alpha * 0.89999998;
  v16 = 1.0;
  v17 = v13;
  v15 = 1065353216;
  v6 = (float)(v4 + 20);
  (*(void (__cdecl **)(int, _DWORD, int, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v6),
    1116209152,
    text);
  if ( (byte_480148 & 1) == 0 )
  {
    byte_480256 = 1;
    byte_480148 |= 1u;
    byte_480265 = 0;
    byte_480264 = 0;
    dword_480260 = 1065353216;
    dword_48025C = 0;
    ui_button_table_b = 0;
    byte_480254 = 0;
    byte_480255 = 0;
    dword_480258 = 0;
    crt_atexit(nullsub_14);
  }
  ui_button_table_b = (int)aRepeatTutorial;
  if ( (byte_480148 & 2) == 0 )
  {
    byte_4807D6 = 1;
    byte_480148 |= 2u;
    byte_4807E5 = 0;
    byte_4807E4 = 0;
    dword_4807E0 = 1065353216;
    dword_4807DC = 0;
    ui_button_table_c = 0;
    byte_4807D4 = 0;
    byte_4807D5 = 0;
    dword_4807D8 = 0;
    crt_atexit(nullsub_13);
  }
  ui_button_table_c = (int)aPlayAGame;
  if ( v18 )
  {
    dword_4807E0 = LODWORD(alpha);
    v10 = (float)(v4 + 32);
    dword_480260 = LODWORD(alpha);
    v11 = 90.0;
    ui_button_update(&v10, (int)&ui_button_table_c);
    v11 = 90.0;
    v10 = (float)(v4 + 192);
    ui_button_update(&v10, (int)&ui_button_table_b);
    if ( byte_4807D5 )
    {
      ui_sign_crimson_update_disabled = 0;
      game_state_pending = 1;
      render_pass_mode = 0;
      ui_transition_direction = 0;
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
      console_input_poll();
      tutorial_stage_transition_timer = -1000;
    }
    if ( byte_480255 )
    {
      player_level[0] = 1;
      memset(&player_perk_counts, 0, 0x200u);
      tutorial_stage_transition_timer = -1000;
      perk_pending_count = 0;
      tutorial_stage_timer = 2000;
    }
  }
  else
  {
    v5 = (double)(tutorial_stage_timer - 1000) * 0.001;
    *(float *)&dword_4807E0 = v5;
    if ( v5 <= 1.0 )
    {
      if ( *(float *)&dword_4807E0 < 0.0 )
        dword_4807E0 = 0;
    }
    else
    {
      dword_4807E0 = 1065353216;
    }
    ui_button_table_c = (int)aSkipTutorial;
    v10 = 10.0;
    v11 = (float)(config_screen_height - 50);
    ui_button_update(&v10, (int)&ui_button_table_c);
    if ( byte_4807D5 )
    {
      ui_sign_crimson_update_disabled = 0;
      game_state_pending = 1;
      render_pass_mode = 0;
      ui_transition_direction = 0;
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
      console_input_poll();
      tutorial_stage_transition_timer = -1000;
    }
  }
}

// nullsub_13 @ 0x00408970
void __cdecl nullsub_13()
{
  ;
}

// nullsub_14 @ 0x00408980
void __cdecl nullsub_14()
{
  ;
}

// tutorial_timeline_update @ 0x00408990
// drives tutorial stage timing, messages, and scripted spawns
void tutorial_timeline_update()
{
  int v0; // eax
  int v1; // esi
  double v2; // st7
  int v3; // edx
  int v4; // eax
  char *v5; // eax
  int *v6; // esi
  int v7; // ecx
  int *v8; // eax
  int *v9; // esi
  int v10; // ecx
  int *v11; // eax
  int v12; // eax
  int v13; // eax
  int v14; // ecx
  int *v15; // eax
  float v16; // [esp+10h] [ebp-70h]
  float alpha; // [esp+24h] [ebp-5Ch] BYREF
  int v18; // [esp+28h] [ebp-58h]
  float pos[2]; // [esp+2Ch] [ebp-54h] BYREF
  float v20; // [esp+34h] [ebp-4Ch] BYREF
  int v21; // [esp+38h] [ebp-48h]
  char *text[7]; // [esp+3Ch] [ebp-44h]
  char *Str[10]; // [esp+58h] [ebp-28h]

  if ( console_open_flag )
    return;
  tutorial_stage_timer += frame_dt_ms;
  text[0] = aThisIsTheSpeed;
  text[1] = aThisIsAWeaponP;
  text[2] = aThisPowerupDou;
  text[3] = aThisIsTheNukeP;
  text[4] = aReflexBoostPow;
  text[5] = (char *)&tutorial_empty_string;
  text[6] = (char *)&tutorial_empty_string;
  Str[0] = aInThisTutorial;
  Str[1] = aFirstLearnToMo;
  Str[2] = aNowPickUpTheBo;
  Str[3] = aNowLearnToShoo;
  Str[4] = aNowMoveTheMous;
  Str[5] = aItWillHelpYouT;
  Str[6] = aNowLetSLearnAb;
  Str[7] = aPerksCanGiveYo;
  Str[8] = aGreatNowYouAre;
  Str[9] = (char *)&tutorial_empty_string;
  quest_spawn_timeline += frame_dt_ms;
  player_health[0] = 1120403456;
  if ( tutorial_stage_index != 6 )
    player_experience[0] = 0;
  v0 = tutorial_stage_transition_timer;
  if ( tutorial_stage_transition_timer >= -1 )
  {
    if ( tutorial_stage_transition_timer >= 0 )
    {
      v0 = frame_dt_ms + tutorial_stage_transition_timer;
      tutorial_stage_transition_timer += frame_dt_ms;
    }
  }
  else
  {
    v0 = frame_dt_ms + tutorial_stage_transition_timer;
    tutorial_stage_transition_timer = v0;
    if ( v0 >= -1 )
    {
      if ( ++tutorial_stage_index == 9 )
        tutorial_stage_index = 0;
      tutorial_stage_transition_timer = 0;
      goto LABEL_13;
    }
  }
  if ( v0 > 1000 )
    tutorial_stage_transition_timer = -1;
LABEL_13:
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v1 = tutorial_stage_transition_timer;
  if ( tutorial_stage_transition_timer < 0 )
  {
    if ( tutorial_stage_transition_timer >= -1 )
    {
      alpha = 1.0;
      goto LABEL_16;
    }
    LODWORD(alpha) = -tutorial_stage_transition_timer;
    v2 = (double)-tutorial_stage_transition_timer;
  }
  else
  {
    v2 = (double)tutorial_stage_transition_timer;
  }
  alpha = v2 * 0.001;
  if ( alpha < 1.0 )
  {
    v3 = tutorial_stage_index;
    if ( tutorial_stage_index != 5 )
      goto LABEL_26;
    goto LABEL_24;
  }
LABEL_16:
  v3 = tutorial_stage_index;
  if ( tutorial_stage_index != 5 )
    goto LABEL_26;
  if ( tutorial_stage_timer > 5000 && tutorial_stage_transition_timer >= -1 )
    alpha = 1.0 - (double)(tutorial_stage_timer - 5000) * 0.001;
LABEL_24:
  if ( tutorial_stage_timer > 6000 )
  {
    alpha = 0.0;
LABEL_33:
    tutorial_prompt_dialog(Str[v3], alpha);
    v1 = tutorial_stage_transition_timer;
    v3 = tutorial_stage_index;
    goto LABEL_34;
  }
LABEL_26:
  if ( alpha <= 1.0 )
  {
    if ( alpha < 0.0 )
      alpha = 0.0;
  }
  else
  {
    alpha = 1.0;
  }
  if ( v3 >= 0 && (v3 != 6 || perk_pending_count > 0) )
    goto LABEL_33;
LABEL_34:
  if ( byte_4808B0 )
  {
    v4 = frame_dt_ms + tutorial_hint_alpha + 2 * frame_dt_ms;
  }
  else
  {
    if ( tutorial_hint_bonus_ptr
      && !*(_BYTE *)tutorial_hint_bonus_ptr
      && *(float *)(tutorial_hint_bonus_ptr + 36) <= 0.0
      && (*(_DWORD *)(tutorial_hint_bonus_ptr + 140) & 0x400) != 0 )
    {
      dword_4712F4 = *(__int16 *)(tutorial_hint_bonus_ptr + 120);
      dword_4712F8 = *(__int16 *)(tutorial_hint_bonus_ptr + 122);
      byte_4808B0 = 1;
      alpha = 128.0;
      v18 = 1124073472;
      creature_spawn_template(36, &alpha, 3.1415927);
      alpha = 152.0;
      v18 = 1126170624;
      creature_spawn_template(38, &alpha, 3.1415927);
      v1 = tutorial_stage_transition_timer;
      v3 = tutorial_stage_index;
      ++tutorial_hint_index;
    }
    v4 = -3 * frame_dt_ms + tutorial_hint_alpha;
  }
  tutorial_hint_alpha = v4;
  if ( v4 <= 1000 )
  {
    if ( v4 < 0 )
      tutorial_hint_alpha = 0;
  }
  else
  {
    tutorial_hint_alpha = 1000;
  }
  if ( tutorial_hint_index >= 0 )
  {
    v5 = text[tutorial_hint_index];
    if ( *v5 != -89 )
    {
      v16 = (double)tutorial_hint_alpha * 0.001;
      tutorial_prompt_dialog(v5, v16);
      v1 = tutorial_stage_transition_timer;
      v3 = tutorial_stage_index;
    }
  }
  if ( v3 )
  {
    switch ( v3 )
    {
      case 1:
        v6 = &player_move_key_backward;
        while ( !(*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
                   grim_interface_ptr,
                   *(v6 - 1))
             && !(*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                   grim_interface_ptr,
                   *v6)
             && !(*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                   grim_interface_ptr,
                   v6[1])
             && !(*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                   grim_interface_ptr,
                   v6[2])
             || tutorial_stage_transition_timer != -1 )
        {
          v6 += 216;
          if ( (int)v6 >= (int)dword_4912A0 )
            return;
        }
        tutorial_stage_transition_timer = -1000;
        sfx_play(sfx_ui_levelup);
        alpha = 260.0;
        v18 = 1132593152;
        bonus_pool[0] = 1;
        bonus_time_left[0] = 1120403456;
        bonus_time_max = 1120403456;
        bonus_state[0] = 0;
        bonus_amount = 500;
        bonus_pos_x = 260.0;
        bonus_pos_y = 1132593152;
        effect_spawn_burst(&bonus_pos_x, 12);
        alpha = 600.0;
        v18 = 1137180672;
        dword_482964 = 1;
        dword_48296C = 1120403456;
        dword_482970 = bonus_time_left[0];
        byte_482968 = 0;
        dword_48297C = 1000;
        ::pos = 600.0;
        dword_482978 = 1137180672;
        effect_spawn_burst(&::pos, 12);
        alpha = 300.0;
        v18 = 1137180672;
        dword_482980 = 1;
        dword_482988 = 1120403456;
        dword_48298C = bonus_time_left[0];
        byte_482984 = 0;
        dword_482998 = 500;
        flt_482990 = 300.0;
        dword_482994 = 1137180672;
        effect_spawn_burst(&flt_482990, 12);
        break;
      case 2:
        v7 = 0;
        v8 = bonus_pool;
        do
        {
          if ( *v8 )
            break;
          v8 += 7;
          ++v7;
        }
        while ( (int)v8 < (int)&quest_spawn_count );
        if ( v7 == 16 && v1 == -1 )
        {
          tutorial_stage_transition_timer = -1000;
          sfx_play(sfx_ui_levelup);
        }
        break;
      case 3:
        v9 = &player_fire_key;
        do
        {
          if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                 grim_interface_ptr,
                 *v9)
            && tutorial_stage_transition_timer == -1 )
          {
            tutorial_stage_transition_timer = -1000;
            sfx_play(sfx_ui_levelup);
            alpha = -164.0;
            v18 = 1137573888;
            creature_spawn_template(36, &alpha, 3.1415927);
            pos[0] = -184.0;
            pos[1] = 512.0;
            creature_spawn_template(38, pos, 3.1415927);
            v20 = -154.0;
            v21 = 1142489088;
            creature_spawn_template(36, &v20, 3.1415927);
          }
          v9 += 216;
        }
        while ( (int)v9 < (int)&dword_4912AC );
        break;
      case 4:
        if ( (unsigned __int8)creatures_none_active() && tutorial_stage_transition_timer == -1 )
        {
          tutorial_stage_timer = 1000;
          tutorial_stage_transition_timer = -1000;
          sfx_play(sfx_ui_levelup);
          tutorial_repeat_spawn_count = 0;
          v20 = 1188.0;
          v21 = 1137573888;
          creature_spawn_template(36, &v20, 3.1415927);
          v20 = 1208.0;
          v21 = 1140850688;
          creature_spawn_template(38, &v20, 3.1415927);
          v20 = 1178.0;
          v21 = 1142489088;
          creature_spawn_template(36, &v20, 3.1415927);
        }
        break;
      case 5:
        v10 = 0;
        v11 = bonus_pool;
        do
        {
          if ( *v11 )
            break;
          v11 += 7;
          ++v10;
        }
        while ( (int)v11 < (int)&quest_spawn_count );
        if ( v10 == 16 && (unsigned __int8)creatures_none_active() )
        {
          v12 = ++tutorial_repeat_spawn_count;
          if ( tutorial_repeat_spawn_count <= 7 )
          {
            byte_4808B0 = 0;
            if ( (v12 & 1) != 0 )
            {
              if ( v12 < 6 )
              {
                v20 = -32.0;
                v21 = 1149501440;
                tutorial_hint_bonus_ptr = (int)creature_spawn_template(39, &v20, 3.1415927);
              }
              v20 = -164.0;
              v21 = 1137573888;
              creature_spawn_template(36, &v20, 3.1415927);
              v20 = -184.0;
              v21 = 1140850688;
              creature_spawn_template(38, &v20, 3.1415927);
              v20 = -154.0;
              v21 = 1142489088;
              creature_spawn_template(36, &v20, 3.1415927);
            }
            else
            {
              if ( v12 < 6 )
              {
                v20 = 1056.0;
                v21 = 1149501440;
                tutorial_hint_bonus_ptr = (int)creature_spawn_template(39, &v20, 3.1415927);
              }
              v20 = 1188.0;
              v21 = 1150156800;
              creature_spawn_template(36, &v20, 3.1415927);
              v20 = 1208.0;
              v21 = 1140850688;
              creature_spawn_template(38, &v20, 3.1415927);
              v20 = 1178.0;
              v21 = 1142489088;
              creature_spawn_template(36, &v20, 3.1415927);
            }
            v13 = tutorial_repeat_spawn_count;
            if ( tutorial_repeat_spawn_count == 4 )
            {
              v20 = 512.0;
              v21 = 1149501440;
              creature_spawn_template(64, &v20, 3.1415927);
              v13 = tutorial_repeat_spawn_count;
            }
            if ( v13 < 6 )
            {
              switch ( v13 )
              {
                case 1:
                  *(_WORD *)(tutorial_hint_bonus_ptr + 120) = 13;
                  *(_WORD *)(tutorial_hint_bonus_ptr + 122) = -1;
                  break;
                case 2:
                  *(_WORD *)(tutorial_hint_bonus_ptr + 120) = 3;
                  *(_WORD *)(tutorial_hint_bonus_ptr + 122) = 5;
                  break;
                case 3:
                  *(_WORD *)(tutorial_hint_bonus_ptr + 120) = 6;
                  *(_WORD *)(tutorial_hint_bonus_ptr + 122) = -1;
                  break;
                case 4:
                  *(_WORD *)(tutorial_hint_bonus_ptr + 120) = 5;
                  *(_WORD *)(tutorial_hint_bonus_ptr + 122) = -1;
                  break;
                case 5:
                  *(_WORD *)(tutorial_hint_bonus_ptr + 120) = 9;
                  *(_WORD *)(tutorial_hint_bonus_ptr + 122) = -1;
                  break;
                default:
                  return;
              }
            }
          }
          else if ( tutorial_stage_transition_timer == -1 )
          {
            tutorial_stage_transition_timer = -1000;
            sfx_play(sfx_ui_levelup);
            player_experience[0] = 3000;
          }
        }
        break;
      case 6:
        if ( perk_pending_count <= 0 && v1 == -1 )
        {
          tutorial_stage_transition_timer = -1000;
          v20 = -164.0;
          v21 = 1137573888;
          creature_spawn_template(36, &v20, 3.1415927);
          v20 = -184.0;
          v21 = 1140850688;
          creature_spawn_template(38, &v20, 3.1415927);
          v20 = -154.0;
          v21 = 1142489088;
          creature_spawn_template(36, &v20, 3.1415927);
          v20 = -32.0;
          v21 = -1040187392;
          creature_spawn_template(40, &v20, 3.1415927);
          v20 = 1188.0;
          v21 = 1137573888;
          creature_spawn_template(36, &v20, 3.1415927);
          v20 = 1208.0;
          v21 = 1140850688;
          creature_spawn_template(38, &v20, 3.1415927);
          v20 = 1178.0;
          v21 = 1142489088;
          creature_spawn_template(36, &v20, 3.1415927);
        }
        break;
      case 7:
        v14 = 0;
        v15 = bonus_pool;
        do
        {
          if ( *v15 )
            break;
          v15 += 7;
          ++v14;
        }
        while ( (int)v15 < (int)&quest_spawn_count );
        if ( v14 == 16 && (unsigned __int8)creatures_none_active() && tutorial_stage_transition_timer == -1 )
          tutorial_stage_transition_timer = -1000;
        break;
    }
  }
  else if ( tutorial_stage_timer > 6000 && v1 == -1 )
  {
    tutorial_repeat_spawn_count = 0;
    tutorial_hint_index = -1;
    byte_4808B0 = 0;
    tutorial_stage_transition_timer = -1000;
  }
}

// camera_update @ 0x00409500
// updates camera offsets and screen shake
void camera_update()
{
  double v0; // st7
  int v1; // esi
  int v2; // esi
  double v3; // st7
  int v4; // esi
  int v5; // esi
  double v6; // st7
  double v7; // st7
  char v8; // fps^1
  char v9; // ah
  bool v10; // c0
  bool v11; // c3
  double v12; // st7
  double v13; // st7

  if ( camera_shake_timer <= 0.0 )
  {
    camera_shake_offset_x = 0.0;
    camera_shake_offset_y = 0.0;
  }
  else
  {
    v0 = camera_shake_timer - frame_dt * 3.0;
    camera_shake_timer = v0;
    if ( v0 < 0.0 )
    {
      if ( --camera_shake_pulses <= 0 )
      {
        camera_shake_timer = 0.0;
      }
      else
      {
        camera_shake_timer = 0.1;
        if ( time_scale_active )
          camera_shake_timer = 0.059999999;
        v1 = crt_rand() % (60 * camera_shake_pulses / 20);
        v2 = crt_rand() % 10 + v1;
        if ( (crt_rand() & 1) != 0 )
          v3 = (double)v2;
        else
          v3 = (double)-v2;
        camera_shake_offset_x = v3;
        v4 = crt_rand() % (60 * camera_shake_pulses / 20);
        v5 = crt_rand() % 10 + v4;
        if ( (crt_rand() & 1) != 0 )
          v6 = (double)v5;
        else
          v6 = (double)-v5;
        camera_shake_offset_y = v6;
      }
    }
  }
  if ( config_player_count == 1 )
  {
    *(float *)&camera_offset_x = (double)(*(_DWORD *)config_screen_width / 2)
                               - *(float *)&player_pos_x[216 * render_overlay_player_index];
    v7 = (double)(config_screen_height / 2) - *(float *)&player_pos_y[216 * render_overlay_player_index];
    goto LABEL_27;
  }
  v9 = v8;
  v10 = player2_health[0] < 0.0;
  v11 = player2_health[0] == 0.0;
  if ( (v9 & 0x41) != 0 )
  {
    if ( !v10 && !v11 )
    {
      *(float *)&camera_offset_x = (double)(*(_DWORD *)config_screen_width / 2) - *(float *)player2_pos_x;
      v7 = (double)(config_screen_height / 2) - *(float *)&player2_pos_y;
      goto LABEL_27;
    }
LABEL_21:
    if ( *(float *)player_health > 0.0 )
    {
      *(float *)&camera_offset_x = (double)(*(_DWORD *)config_screen_width / 2) - *(float *)player_pos_x;
      v7 = (double)(config_screen_height / 2) - *(float *)player_pos_y;
      goto LABEL_27;
    }
    if ( player2_health[0] <= 0.0 )
      goto LABEL_26;
    goto LABEL_24;
  }
  if ( v10 || v11 )
    goto LABEL_21;
LABEL_24:
  if ( *(float *)player_health > 0.0 )
  {
    *(float *)&camera_offset_x = (double)(*(_DWORD *)config_screen_width / 2)
                               - (*(float *)player_pos_x
                                - (*(float *)player_pos_x - *(float *)player2_pos_x) * 0.5);
    v7 = (double)(config_screen_height / 2)
       - (*(float *)player_pos_y
        - (*(float *)player_pos_y - *(float *)&player2_pos_y) * 0.5);
    goto LABEL_27;
  }
LABEL_26:
  v7 = *(float *)&camera_offset_y;
LABEL_27:
  *(float *)&camera_offset_x = *(float *)&camera_offset_x + camera_shake_offset_x;
  *(float *)&camera_offset_y = v7 + camera_shake_offset_y;
  if ( *(float *)&camera_offset_x > -1.0 )
    camera_offset_x = -1082130432;
  if ( *(float *)&camera_offset_y > -1.0 )
    camera_offset_y = -1082130432;
  v12 = (double)(*(_DWORD *)config_screen_width - terrain_texture_width);
  if ( *(float *)&camera_offset_x < v12 )
    *(float *)&camera_offset_x = v12;
  v13 = (double)(config_screen_height - terrain_texture_height);
  if ( *(float *)&camera_offset_y < v13 )
    *(float *)&camera_offset_y = v13;
}

// bonus_apply @ 0x00409890
// applies a picked bonus to the player and spawns related effects
int __cdecl sub_409890(int a1, float *a2)
{
  float v2; // eax
  float *v3; // ecx
  double v4; // st7
  int v5; // ecx
  int *v6; // eax
  int v7; // eax
  double v8; // st7
  int *v9; // esi
  int v10; // edi
  int v11; // edi
  int v12; // eax
  int v13; // ebp
  int v14; // esi
  int v15; // eax
  int v16; // eax
  int v17; // ebp
  int v18; // eax
  float *v19; // esi
  int v20; // ebp
  char *v21; // edi
  double v22; // st6
  double v23; // st5
  long double v24; // st7
  int result; // eax
  int v26; // esi
  int v27; // eax
  float v28; // [esp+0h] [ebp-2Ch]
  float v29; // [esp+0h] [ebp-2Ch]
  float v30; // [esp+0h] [ebp-2Ch]
  float v31; // [esp+0h] [ebp-2Ch]
  float v32; // [esp+0h] [ebp-2Ch]
  float v33; // [esp+0h] [ebp-2Ch]
  float v34; // [esp+8h] [ebp-24h]
  float v35; // [esp+8h] [ebp-24h]
  int v36; // [esp+1Ch] [ebp-10h] BYREF
  int v37; // [esp+20h] [ebp-Ch]
  int v38; // [esp+24h] [ebp-8h]
  int v39; // [esp+28h] [ebp-4h]
  int v40; // [esp+30h] [ebp+4h]
  float v41; // [esp+30h] [ebp+4h]
  float v42; // [esp+30h] [ebp+4h]

  sfx_play(sfx_ui_bonus, 1.0);
  *(float *)&v36 = 1.0;
  if ( perk_count_get(perk_id_bonus_economist) )
    *(float *)&v36 = 1.5;
  v2 = *a2;
  if ( *(_DWORD *)a2 == 3 )
  {
    weapon_assign_player(a1, *((_DWORD *)a2 + 6));
  }
  else
  {
    switch ( LODWORD(v2) )
    {
      case 0xC:
        v3 = (float *)&player_health[216 * a1];
        if ( *v3 < 100.0 )
        {
          v4 = *v3 + 10.0;
          *v3 = v4;
          if ( v4 > 100.0 )
            *v3 = 100.0;
        }
        break;
      case 9:
        if ( bonus_reflex_boost_timer <= 0.0 )
          sub_41A810(dword_485484, dword_48548C, &bonus_reflex_boost_timer, 0);
        v5 = config_player_count;
        bonus_reflex_boost_timer = (double)*((int *)a2 + 6) * *(float *)&v36 + bonus_reflex_boost_timer;
        if ( config_player_count > 0 )
        {
          v6 = player_ammo;
          do
          {
            *v6 = *(v6 - 2);
            v6[1] = 0;
            v6 += 216;
            --v5;
          }
          while ( v5 );
        }
        v37 = 1058642330;
        *(float *)&v36 = 0.60000002;
        effect_template_color_g = 1058642330;
        v38 = 1065353216;
        v39 = 1065353216;
        effect_template_color_r = 1058642330;
        effect_template_flags = 25;
        effect_template_color_b = 1065353216;
        effect_template_color_a = 1065353216;
        effect_template_lifetime = 1048576000;
        effect_template_age = 0;
        effect_template_half_width = 1107296256;
        effect_template_half_height = 1107296256;
        effect_template_rotation = 0;
        effect_template_vel_x = 0;
        effect_template_vel_y = 0;
        effect_template_scale_step = 1112014848;
        effect_spawn(1, a2 + 4);
        effect_template_rotation = 0;
        effect_template_vel_x = 0;
        effect_template_vel_y = 0;
        break;
      case 4:
        if ( *(float *)&bonus_weapon_power_up_timer <= 0.0 )
          sub_41A810(dword_485420, dword_485428, &bonus_weapon_power_up_timer, 0);
        v7 = 216 * a1;
        v8 = (double)*((int *)a2 + 6) * *(float *)&v36 + *(float *)&bonus_weapon_power_up_timer;
        player_weapon_reset_latch[v7] = 0;
        player_shot_cooldown[v7] = 0;
        player_reload_timer[v7] = 0;
        player_ammo[v7] = player_clip_size[216 * a1];
        *(float *)&bonus_weapon_power_up_timer = v8;
        break;
      case 0xD:
        if ( *(float *)player_speed_bonus_timer <= 0.0 && player2_speed_bonus_timer <= 0.0 )
          sub_41A810(dword_4854D4, dword_4854DC, player_speed_bonus_timer, &player2_speed_bonus_timer);
        *(float *)&player_speed_bonus_timer[216 * a1] = (double)*((int *)a2 + 6) * *(float *)&v36
                                                      + *(float *)&player_speed_bonus_timer[216 * a1];
        break;
      case 0xB:
        if ( bonus_freeze_timer <= 0.0 )
          sub_41A810(dword_4854AC, dword_4854B4, &bonus_freeze_timer, 0);
        v9 = &creature_pos_x;
        bonus_freeze_timer = (double)*((int *)a2 + 6) * *(float *)&v36 + bonus_freeze_timer;
        do
        {
          if ( *((_BYTE *)v9 - 20) && *((float *)v9 + 4) <= 0.0 )
          {
            v10 = 8;
            do
            {
              v34 = (double)(crt_rand() % 612) * 0.0099999998;
              effect_spawn_freeze_shard((int)v9, v34);
              --v10;
            }
            while ( v10 );
            v35 = (double)(crt_rand() % 612) * 0.0099999998;
            effect_spawn_freeze_shatter((int)v9, v35);
            *((_BYTE *)v9 - 20) = 0;
          }
          v9 += 38;
        }
        while ( (int)v9 < (int)&dword_4AA34C );
        *(float *)&v36 = 0.30000001;
        v37 = 1056964608;
        v38 = 1061997773;
        v39 = 1065353216;
        effect_template_color_r = 1050253722;
        effect_template_flags = 25;
        effect_template_color_g = 1056964608;
        effect_template_color_b = 1061997773;
        effect_template_color_a = 1065353216;
        effect_template_lifetime = 1048576000;
        effect_template_age = 0;
        effect_template_half_width = 1107296256;
        effect_template_half_height = 1107296256;
        effect_template_rotation = 0;
        effect_template_vel_x = 0;
        effect_template_vel_y = 0;
        effect_template_scale_step = 1112014848;
        effect_spawn(1, a2 + 4);
        sfx_play_panned(sfx_shockwave, (int)(a2 + 4), 1.0);
        effect_template_rotation = 0;
        effect_template_vel_x = 0;
        effect_template_vel_y = 0;
        break;
      case 0xA:
        if ( *(float *)player_shield_timer <= 0.0 && player2_shield_timer <= 0.0 )
          sub_41A810(dword_485498, dword_4854A0, player_shield_timer, &player2_shield_timer);
        *(float *)&player_shield_timer[216 * a1] = (double)*((int *)a2 + 6) * *(float *)&v36
                                                 + *(float *)&player_shield_timer[216 * a1];
        break;
      case 7:
        bonus_spawn_guard = 1;
        if ( *(float *)(cv_friendlyFire + 12) == 0.0 )
          v11 = -100;
        else
          v11 = -1 - a1;
        shock_chain_links_left = 32;
        v12 = creature_find_nearest((int)(a2 + 4), -1, 0.0);
        v28 = atan2(creature_pos_y[38 * v12] - a2[5], *((float *)&creature_pos_x + 38 * v12) - a2[4])
            - 1.5707964
            - 3.1415927;
        shock_chain_projectile_id = projectile_spawn((int)(a2 + 4), v28, 21, v11);
        bonus_spawn_guard = 0;
        sfx_play_panned(sfx_shock_hit_01, (int)(a2 + 4), 1.0);
        break;
      case 8:
        bonus_spawn_guard = 1;
        if ( *(float *)(cv_friendlyFire + 12) == 0.0 )
          v13 = -100;
        else
          v13 = -1 - a1;
        v14 = 0;
        v40 = 0;
        do
        {
          v29 = (double)v40 * 0.39269909;
          projectile_spawn((int)(a2 + 4), v29, 9, v13);
          v40 = ++v14;
        }
        while ( v14 < 16 );
        bonus_spawn_guard = 0;
        sfx_play_panned(sfx_explosion_medium, (int)(a2 + 4), 1.0);
        break;
      case 0xE:
        if ( *(float *)player_fire_bullets_timer <= 0.0 && player2_fire_bullets_timer <= 0.0 )
          sub_41A810(dword_4854E8, dword_4854F0, player_fire_bullets_timer, &player2_fire_bullets_timer);
        v15 = 216 * a1;
        *(float *)(v15 * 4 + 4787148) = *(float *)&v36 * 5.0 + *(float *)&player_fire_bullets_timer[216 * a1];
        player_weapon_reset_latch[v15] = 0;
        player_shot_cooldown[v15] = 0;
        player_reload_timer[v15] = 0;
        player_ammo[v15] = player_clip_size[216 * a1];
        break;
      case 2:
        if ( bonus_energizer_timer <= 0.0 )
          sub_41A810(dword_4853F8, dword_485400, &bonus_energizer_timer, 0);
        bonus_energizer_timer = *(float *)&v36 * 8.0 + bonus_energizer_timer;
        break;
      case 6:
        if ( bonus_double_xp_timer <= 0.0 )
          sub_41A810(dword_485448, dword_485450, &bonus_double_xp_timer, 0);
        bonus_double_xp_timer = *(float *)&v36 * 6.0 + bonus_double_xp_timer;
        break;
      case 5:
        v16 = (crt_rand() & 3) + 4;
        if ( v16 > 0 )
        {
          v17 = v16;
          do
          {
            v30 = (double)(crt_rand() % 628) * 0.0099999998;
            v18 = projectile_spawn((int)(a2 + 4), v30, 1, -100);
            if ( v18 != -1 )
              projectile_speed_scale[16 * v18] = ((double)(crt_rand() % 50) * 0.0099999998 + 0.5)
                                               * projectile_speed_scale[16 * v18];
            --v17;
          }
          while ( v17 );
        }
        v19 = a2 + 4;
        v31 = (double)(crt_rand() % 628) * 0.0099999998;
        projectile_spawn((int)(a2 + 4), v31, 6, -100);
        v32 = (double)(crt_rand() % 628) * 0.0099999998;
        projectile_spawn((int)(a2 + 4), v32, 6, -100);
        effect_spawn_explosion_burst((int)(a2 + 4), 1.0);
        camera_shake_pulses = 20;
        camera_shake_timer = 0.2;
        bonus_spawn_guard = 1;
        v20 = 0;
        v21 = creature_pool;
        do
        {
          if ( *v21 )
          {
            v41 = *((float *)v21 + 5) - *v19;
            if ( COERCE_FLOAT(LODWORD(v41) & 0x7FFFFFFF) <= 256.0 )
            {
              v42 = *((float *)v21 + 6) - a2[5];
              if ( COERCE_FLOAT(LODWORD(v42) & 0x7FFFFFFF) <= 256.0 )
              {
                v22 = *((float *)v21 + 6) - a2[5];
                v23 = *((float *)v21 + 5) - *v19;
                v24 = 256.0 - sqrt(v23 * v23 + v22 * v22);
                if ( v24 > 0.0 )
                {
                  *(float *)&v36 = 0.0;
                  v37 = 0;
                  v33 = v24 * 5.0;
                  creature_apply_damage(v20, v33, 3, (int)&v36);
                }
              }
            }
          }
          v21 += 152;
          ++v20;
        }
        while ( (int)v21 < (int)byte_4AA338 );
        bonus_spawn_guard = 0;
        sfx_play_panned(sfx_explosion_large, (int)(a2 + 4), 1.0);
        sfx_play_panned(sfx_shockwave, (int)(a2 + 4), 1.0);
        break;
      case 1:
        player_experience += *((_DWORD *)a2 + 6);
        break;
    }
  }
  *(float *)&v36 = 0.40000001;
  v37 = 1056964608;
  result = 1056964608;
  v38 = 1065353216;
  v39 = 1056964608;
  effect_template_color_r = 1053609165;
  effect_template_flags = 29;
  effect_template_color_g = 1056964608;
  effect_template_color_b = 1065353216;
  effect_template_color_a = 1056964608;
  effect_template_lifetime = 1053609165;
  effect_template_half_width = 1107296256;
  effect_template_half_height = 1107296256;
  if ( *(_DWORD *)a2 != 5 )
  {
    v26 = 12;
    do
    {
      *(float *)&effect_template_rotation = (double)(crt_rand() & 0x7F) * 0.049087387;
      *(float *)&effect_template_vel_x = (float)(crt_rand() % 128 - 64);
      v27 = crt_rand() % 128;
      effect_template_scale_step = 1036831949;
      *(float *)&effect_template_vel_y = (float)(v27 - 64);
      result = effect_spawn(0, a2 + 4);
      --v26;
    }
    while ( v26 );
  }
  return result;
}

// bonus_update @ 0x0040A320
// updates bonus lifetimes and handles player pickups
void bonus_update()
{
  int v0; // edx
  float *v1; // edi
  float *v2; // esi
  char v3; // cl
  double v4; // st7
  int v5; // ecx
  float *v6; // eax
  double v7; // st6
  double v8; // st5

  if ( render_pass_mode )
  {
    v0 = config_player_count;
    v1 = (float *)bonus_time_left;
    do
    {
      v2 = v1 - 2;
      if ( *((_DWORD *)v1 - 2) )
      {
        v3 = *((_BYTE *)v1 - 4);
        if ( v3 )
          v4 = *v1 - frame_dt * 3.0;
        else
          v4 = *v1 - frame_dt;
        *v1 = v4;
        if ( !v3 && config_game_mode == 8 )
          *v1 = 5.0;
        if ( *v1 < 0.0 )
          *v2 = 0.0;
        if ( !v3 )
        {
          v5 = 0;
          for ( render_overlay_player_index = 0; v5 < v0; render_overlay_player_index = v5 )
          {
            v6 = (float *)&player_pos_x[216 * v5];
            v7 = v1[3] - v6[1];
            v8 = v1[2] - *v6;
            if ( sqrt(v8 * v8 + v7 * v7) < 26.0 )
            {
              bonus_apply(v5, v1 - 2);
              v0 = config_player_count;
              v5 = render_overlay_player_index;
              *((_BYTE *)v2 + 4) = 1;
              *v1 = 0.5;
            }
            ++v5;
          }
        }
      }
      v1 += 7;
    }
    while ( (int)v1 < (int)&highscore_table );
    render_overlay_player_index = 0;
    if ( bonus_freeze_timer <= 0.0 )
      bonus_freeze_timer = 0.0;
    else
      bonus_freeze_timer = bonus_freeze_timer - frame_dt;
    if ( bonus_double_xp_timer <= 0.0 )
      bonus_double_xp_timer = 0.0;
    else
      bonus_double_xp_timer = bonus_double_xp_timer - frame_dt;
    if ( flt_4AAF2C >= 0.0 )
      flt_4AAF2C = (flt_4AAF2C + 1.0) * frame_dt * 1.8 + flt_4AAF2C;
  }
}

// ui_draw_clock_gauge_at @ 0x0040A4C0
// draws the clock gauge at a position when progress > 0
void ui_draw_clock_gauge_at(float *xy, float radius, float progress)
{
  if ( progress > 0.0 )
    ui_draw_clock_gauge();
}

// ui_render_aim_indicators @ 0x0040A510
// renders aim reticles, reload gauges, and player HUD indicators
void ui_render_aim_indicators()
{
  int v0; // esi
  int v1; // edx
  double v2; // st6
  double v3; // st4
  long double v4; // st7
  float *v5; // eax
  double v6; // st7
  double v7; // st7
  double v8; // st7
  int v9; // ecx
  float *v10; // eax
  float v11; // eax
  float v12; // edx
  long double v13; // st7
  int v14; // edx
  int v15; // [esp+BCh] [ebp-50h]
  int v16; // [esp+C0h] [ebp-4Ch]
  int progress; // [esp+C4h] [ebp-48h]
  float progressa; // [esp+C4h] [ebp-48h]
  float v19; // [esp+D4h] [ebp-38h]
  float v20; // [esp+D8h] [ebp-34h]
  float v21; // [esp+DCh] [ebp-30h]
  float v22; // [esp+DCh] [ebp-30h]
  int v23; // [esp+E0h] [ebp-2Ch]
  float v24; // [esp+E0h] [ebp-2Ch]
  float v25; // [esp+E4h] [ebp-28h]
  float v26; // [esp+E4h] [ebp-28h]
  int v27; // [esp+E8h] [ebp-24h]
  float v28; // [esp+E8h] [ebp-24h]
  float v29; // [esp+ECh] [ebp-20h]
  float v30; // [esp+F4h] [ebp-18h]
  float v31; // [esp+100h] [ebp-Ch]
  float v32; // [esp+104h] [ebp-8h]

  if ( !demo_mode_active )
  {
    if ( (byte_480340 & 1) == 0 )
    {
      byte_480340 |= 1u;
      crt_atexit(nullsub_16);
    }
    if ( (byte_480340 & 2) == 0 )
    {
      byte_480340 |= 2u;
      crt_atexit(nullsub_15);
    }
    (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 19, 5);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v15,
      v16,
      progress);
    v0 = config_player_count;
    v1 = 0;
    for ( render_overlay_player_index = 0; v1 < v0; render_overlay_player_index = v1 )
    {
      if ( *(float *)&player_health[216 * v1] > 0.0 )
      {
        v2 = *(float *)&player_aim_y[216 * v1] - *(float *)&player_pos_y[216 * v1];
        v3 = *(float *)&player_aim_x[216 * v1] - *(float *)&player_pos_x[216 * v1];
        v4 = sqrt(v2 * v2 + v3 * v3) * *(float *)&player_spread_heat[216 * v1] * 0.5;
        v19 = v4;
        if ( v4 < 6.0 )
          v19 = 6.0;
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          1056964608,
          1056964608,
          1056964608,
          1056964608);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          0,
          0,
          1036831949,
          1050253722);
        v5 = (float *)&player_aim_x[216 * render_overlay_player_index];
        v21 = *(float *)&camera_offset_x + *v5;
        v6 = *(float *)&camera_offset_y + v5[1];
        aim_screen_x = v21;
        *(float *)&v23 = v6;
        aim_screen_y = v23;
        (*(void (__thiscall **)(int, _DWORD, int, float))(*(_DWORD *)grim_interface_ptr + 216))(
          grim_interface_ptr,
          LODWORD(v21),
          v23,
          COERCE_FLOAT(LODWORD(v19)));
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
          grim_interface_ptr,
          bullet_trail_texture,
          0);
        (*(void (__thiscall **)(int, int, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          1056964608,
          0,
          1056964608,
          1065353216);
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1057803469);
        (*(void (__thiscall **)(int, _DWORD, int, float))(*(_DWORD *)grim_interface_ptr + 220))(
          grim_interface_ptr,
          LODWORD(aim_screen_x),
          aim_screen_y,
          COERCE_FLOAT(LODWORD(v19)));
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1060320051,
          1036831949,
          1061997773);
        v25 = *(float *)&camera_offset_x + *(float *)&player_aim_x[216 * render_overlay_player_index];
        v7 = *(float *)&camera_offset_y + *(float *)&player_aim_y[216 * render_overlay_player_index];
        aim_screen_x = v25;
        *(float *)&v27 = v7;
        v8 = *(float *)&player_reload_timer[216 * render_overlay_player_index]
           / *(float *)&player_reload_timer_max[216 * render_overlay_player_index];
        aim_screen_y = v27;
        progressa = v8;
        ui_draw_clock_gauge_at(&aim_screen_x, 48.0, progressa);
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1060320051);
        v1 = render_overlay_player_index;
        v0 = config_player_count;
      }
      ++v1;
    }
    v9 = 0;
    for ( render_overlay_player_index = 0; v9 < v0; render_overlay_player_index = v9 )
    {
      if ( *(float *)&player_health[216 * v9] > 0.0 && *((_BYTE *)&config_hud_indicator_toggle + v9) )
      {
        (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 252))(
          grim_interface_ptr,
          player_heading[216 * v9]);
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
          grim_interface_ptr,
          dword_48F7D8,
          0);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          0,
          0,
          1065353216,
          1065353216);
        if ( config_player_count == 2 )
        {
          if ( render_overlay_player_index )
            (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
              grim_interface_ptr,
              1065353216,
              1063675494,
              1061997773,
              1058642330);
          else
            (*(void (__stdcall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
              1061997773,
              1063675494,
              1065353216,
              1058642330);
        }
        else
        {
          (*(void (__stdcall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
            1065353216,
            1065353216,
            1065353216,
            1050253722);
        }
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
        if ( config_player_mode_flags[render_overlay_player_index] == 4 )
        {
          v10 = (float *)((char *)&player_move_target_x + 864 * render_overlay_player_index);
          v20 = *(float *)&camera_offset_y + v10[1];
          v26 = *(float *)&camera_offset_x + *v10 - 16.0;
          v11 = v26;
          aim_screen_x = v26;
          v28 = v20 - 16.0;
          v12 = v28;
        }
        else
        {
          v13 = *(float *)&player_heading[216 * render_overlay_player_index] - 1.5707964;
          v29 = cos(v13);
          v30 = v29 * 60.0;
          v31 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index];
          v32 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] + v30;
          v22 = v32 - 16.0;
          v11 = v22;
          aim_screen_x = v22;
          v24 = sin(v13) * 60.0 + v31 - 16.0;
          v12 = v24;
        }
        aim_screen_y = LODWORD(v12);
        (*(void (__thiscall **)(int, float, float, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          grim_interface_ptr,
          COERCE_FLOAT(LODWORD(v11)),
          COERCE_FLOAT(LODWORD(v12)),
          1107296256,
          1107296256);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
        v9 = render_overlay_player_index;
        v0 = config_player_count;
      }
      ++v9;
    }
    v14 = 0;
    for ( render_overlay_player_index = 0; v14 < v0; render_overlay_player_index = v14 )
    {
      if ( *(float *)&player_health[216 * v14] > 0.0 )
      {
        ui_render_aim_enhancement();
        v14 = render_overlay_player_index;
        v0 = config_player_count;
      }
      ++v14;
    }
    render_overlay_player_index = 0;
  }
}

// nullsub_15 @ 0x0040AA90
void __cdecl nullsub_15()
{
  ;
}

// nullsub_16 @ 0x0040AAA0
void __cdecl nullsub_16()
{
  ;
}

// gameplay_update_and_render @ 0x0040AAB0
// main gameplay frame loop for state 9 (timers, updates, renders, UI)
void gameplay_update_and_render()
{
  int *v7; // eax
  int v12; // eax
  int v13; // eax
  int v22; // eax
  int v24; // eax
  float alpha; // [esp+1Ch] [ebp-20h]
  int v27; // [esp+34h] [ebp-8h] BYREF
  int xy; // [esp+38h] [ebp-4h] BYREF

  if ( time_scale_active )
  {
    __asm
    {
      fld     bonus_reflex_boost_timer
      fcomp   ds:flt_46F224
    }
    time_scale_factor = 1050253722;
    __asm { fnstsw  ax }
    if ( (_AX & 0x100) != 0 )
    {
      __asm
      {
        fld     ds:flt_46F224
        fsub    bonus_reflex_boost_timer
        fmul    ds:flt_46F334
        fadd    ds:flt_46F258
        fstp    time_scale_factor
      }
    }
    __asm
    {
      fld     time_scale_factor
      fmul    frame_dt
      fst     frame_dt
      fmul    ds:flt_46F398
    }
    frame_dt_ms = _ftol();
  }
  if ( demo_mode_active )
  {
LABEL_19:
    if ( game_paused_flag )
      goto LABEL_22;
    goto LABEL_20;
  }
  if ( !(unsigned __int8)game_is_full_version() && config_game_mode != 8 )
  {
    *(_DWORD *)&game_sequence_id = game_sequence_get();
    if ( *(int *)&game_sequence_id > 2400000 )
    {
LABEL_12:
      frame_dt_ms = 0;
      frame_dt = 0.0;
      goto LABEL_19;
    }
    if ( dword_48084C <= 0 )
    {
      if ( config_game_mode != 3 )
        goto LABEL_17;
    }
    else
    {
      if ( config_game_mode != 3 )
        goto LABEL_12;
      v27 = dword_48084C / 1000;
      __asm
      {
        fild    [esp+1Ch+var_8]
        fmul    ds:flt_46F28C
        fcomp   ds:flt_46F288
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        goto LABEL_12;
    }
    if ( game_state_id == 9 && (*(int *)quest_stage_major > 1 || quest_stage_minor > 10) )
      goto LABEL_12;
  }
LABEL_17:
  if ( game_paused_flag )
    goto LABEL_12;
LABEL_20:
  if ( !console_open_flag )
    perks_update_effects();
LABEL_22:
  effects_update();
  if ( !demo_mode_active && !(unsigned __int8)game_is_full_version() && config_game_mode != 8 )
  {
    *(_DWORD *)&game_sequence_id = game_sequence_get();
    if ( *(int *)&game_sequence_id > 2400000 )
      goto LABEL_37;
    if ( dword_48084C > 0 )
    {
      if ( config_game_mode != 3 )
        goto LABEL_37;
      v27 = dword_48084C / 1000;
      __asm
      {
        fild    [esp+1Ch+var_8]
        fmul    ds:flt_46F28C
        fcomp   ds:flt_46F288
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        goto LABEL_37;
      goto LABEL_31;
    }
    if ( config_game_mode == 3 )
    {
LABEL_31:
      if ( game_state_id == 9 && (*(int *)quest_stage_major > 1 || quest_stage_minor > 10) )
        goto LABEL_37;
    }
  }
  if ( !game_paused_flag && game_state_id == 9 )
  {
    creature_update_all();
    projectile_update();
  }
LABEL_37:
  if ( !demo_mode_active && !(unsigned __int8)game_is_full_version() && config_game_mode != 8 )
  {
    *(_DWORD *)&game_sequence_id = game_sequence_get();
    if ( *(int *)&game_sequence_id > 2400000 )
      goto LABEL_53;
    if ( dword_48084C > 0 )
    {
      if ( config_game_mode != 3 )
        goto LABEL_53;
      v27 = dword_48084C / 1000;
      __asm
      {
        fild    [esp+1Ch+var_8]
        fmul    ds:flt_46F28C
        fcomp   ds:flt_46F288
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        goto LABEL_53;
      goto LABEL_46;
    }
    if ( config_game_mode == 3 )
    {
LABEL_46:
      if ( game_state_id == 9 && (*(int *)quest_stage_major > 1 || quest_stage_minor > 10) )
        goto LABEL_53;
    }
  }
  if ( !game_paused_flag && game_state_id == 9 )
  {
    for ( render_overlay_player_index = 0; render_overlay_player_index < config_player_count; ++render_overlay_player_index )
      player_update();
  }
LABEL_53:
  render_overlay_player_index = 0;
  if ( config_game_mode == 1 )
    survival_update();
  if ( config_game_mode == 2 )
    rush_mode_update();
  if ( config_game_mode == 3 )
    quest_mode_update();
  highscore_score_xp = player_experience[0];
  if ( !console_open_flag && !game_paused_flag )
  {
    __asm
    {
      fld     bonus_weapon_power_up_timer
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
    {
      __asm
      {
        fld     bonus_weapon_power_up_timer
        fsub    frame_dt
        fstp    bonus_weapon_power_up_timer
      }
    }
    __asm
    {
      fld     bonus_energizer_timer
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
    {
      __asm
      {
        fld     bonus_energizer_timer
        fsub    frame_dt
        fstp    bonus_energizer_timer
      }
    }
    __asm
    {
      fld     bonus_reflex_boost_timer
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
      time_scale_active = 0;
    }
    else
    {
      __asm
      {
        fld     bonus_reflex_boost_timer
        fsub    frame_dt
      }
      time_scale_active = 1;
      __asm { fstp    bonus_reflex_boost_timer }
    }
    survival_elapsed_ms += frame_dt_ms;
    dword_48708C[player_weapon_id[0]] += frame_dt_ms;
  }
  camera_update();
  gameplay_render_world();
  if ( config_game_mode == 8 )
    tutorial_timeline_update();
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  if ( demo_mode_active )
  {
    v7 = player_health;
    do
    {
      *v7 = 1120403456;
      v7 += 216;
    }
    while ( (int)v7 < (int)dword_490F94 );
  }
  else
  {
    __asm
    {
      fld     player_health
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
      __asm
      {
        fld     player_state_table
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
      {
        if ( config_player_count == 1 )
          goto LABEL_80;
        __asm
        {
          fld     player2_health
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4100) != 0 )
        {
          __asm
          {
            fld     player2_death_timer
            fcomp   ds:flt_46F228
            fnstsw  ax
          }
          if ( (_AX & 0x100) != 0 )
          {
LABEL_80:
            render_pass_mode = 0;
            ui_transition_direction = 0;
            game_state_pending = config_game_mode != 3 ? 7 : 12;
            (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
            console_input_poll();
            sfx_mute_all(music_track_extra_0);
            sfx_mute_all(music_track_crimson_theme_id);
            sfx_mute_all(music_track_shortie_monk_id);
            sfx_play_exclusive(music_track_shortie_monk_id);
          }
        }
      }
    }
  }
  if ( config_game_mode != 2 )
  {
    __asm
    {
      fild    player_level
      fld     ds:dbl_46F390
    }
    crt_ci_pow();
    __asm { fmul    ds:flt_46F388 }
    if ( player_experience[0] > (int)(1000 - _ftol()) )
    {
      ++perk_pending_count;
      if ( ++config_perk_prompt_counter > 50 )
      {
        config_perk_prompt_counter = 0;
        config_full_version = 0;
      }
      sfx_play(sfx_ui_levelup);
      ++player_level[0];
    }
  }
  if ( !console_open_flag && !game_paused_flag )
  {
    if ( perk_prompt_hover_active )
      v12 = 3 * frame_dt_ms;
    else
      v12 = -frame_dt_ms;
    v13 = perk_prompt_pulse + 2 * v12;
    perk_prompt_pulse = v13;
    if ( v13 >= 0 )
    {
      if ( v13 > 1000 )
        perk_prompt_pulse = 1000;
    }
    else
    {
      perk_prompt_pulse = 0;
    }
  }
  if ( !demo_mode_active && !game_paused_flag && !mouse_button_down && config_game_mode != 2 && perk_pending_count > 0 )
  {
    __asm
    {
      fld     player_health
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
      goto LABEL_103;
    if ( config_player_count == 2 )
    {
      __asm
      {
        fld     player2_health
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
      {
LABEL_103:
        __asm
        {
          fld     ui_mouse_x
          fsub    perk_prompt_origin_x
        }
        __asm
        {
          fstp    [esp+18h+xy]
          fld     ui_mouse_y
          fsub    perk_prompt_origin_y
          fstp    dword ptr [esp+18h]
        }
        if ( game_state_pending != 6 )
        {
          if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                 grim_interface_ptr,
                 config_key_pick_perk)
            || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(
                 grim_interface_ptr,
                 57)
            || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(
                 grim_interface_ptr,
                 78) )
          {
            perk_prompt_pulse = 1000;
            if ( perk_choices_dirty )
            {
LABEL_116:
              perks_generate_choices();
              perk_choices_dirty = 0;
            }
LABEL_117:
            game_state_set(6);
            goto LABEL_118;
          }
          __asm
          {
            fld     [esp+18h+xy]
            fcomp   perk_prompt_bounds_min_x
            fnstsw  ax
          }
          if ( (_AX & 0x4100) != 0 )
            goto LABEL_114;
          __asm
          {
            fld     dword ptr [esp+18h]
            fcomp   perk_prompt_bounds_min_y
            fnstsw  ax
          }
          if ( (_AX & 0x4100) != 0 )
            goto LABEL_114;
          __asm
          {
            fld     [esp+18h+xy]
            fcomp   perk_prompt_bounds_max_x
            fnstsw  ax
          }
          if ( (_AX & 0x100) == 0 )
            goto LABEL_114;
          __asm
          {
            fld     dword ptr [esp+18h]
            fcomp   perk_prompt_bounds_max_y
            fnstsw  ax
          }
          if ( (_AX & 0x100) == 0 )
          {
LABEL_114:
            perk_prompt_hover_active = 0;
          }
          else
          {
            perk_prompt_hover_active = 1;
            if ( (unsigned __int8)input_primary_just_pressed() )
            {
              if ( perk_choices_dirty )
                goto LABEL_116;
              goto LABEL_117;
            }
          }
        }
      }
    }
  }
LABEL_118:
  mouse_button_down = (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 88))(
                        grim_interface_ptr,
                        0) != 0;
  bonus_update();
  __asm
  {
    fld     [esp+18h+var_8]
    fmul    ds:flt_46F398
  }
  LODWORD(frame_dt) = v27;
  frame_dt_ms = _ftol();
  if ( demo_mode_active )
    goto LABEL_131;
  perk_prompt_update_and_render();
  if ( demo_mode_active || (unsigned __int8)game_is_full_version() || config_game_mode == 8 )
    goto LABEL_131;
  *(_DWORD *)&game_sequence_id = game_sequence_get();
  if ( *(int *)&game_sequence_id > 2400000 )
    goto LABEL_132;
  if ( dword_48084C <= 0 )
  {
    if ( config_game_mode != 3 )
      goto LABEL_131;
    goto LABEL_128;
  }
  if ( config_game_mode == 3 )
  {
    xy = dword_48084C / 1000;
    __asm
    {
      fild    [esp+18h+xy]
      fmul    ds:flt_46F28C
      fcomp   ds:flt_46F288
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
LABEL_128:
      if ( game_state_id == 9 && (*(int *)quest_stage_major > 1 || quest_stage_minor > 10) )
        goto LABEL_132;
LABEL_131:
      ui_render_aim_indicators();
    }
  }
LABEL_132:
  hud_update_and_render();
  ui_elements_update_and_render();
  if ( (unsigned __int8)game_is_full_version() )
    goto LABEL_151;
  if ( demo_mode_active || (unsigned __int8)game_is_full_version() || config_game_mode == 8 )
    goto LABEL_146;
  *(_DWORD *)&game_sequence_id = game_sequence_get();
  if ( *(int *)&game_sequence_id > 2400000 )
  {
LABEL_145:
    __asm { fild    config_screen_width }
    __asm { fmul    ds:flt_46F24C }
    dword_480898 += frame_dt_ms;
    __asm
    {
      fsub    ds:flt_46F2B0
      fstp    [esp+20h+xy]
      fild    config_screen_height
      fmul    ds:flt_46F24C
      fsub    ds:flt_46F2B8
      fstp    dword ptr [esp+20h]
    }
    demo_trial_overlay_render((float *)&xy, 1.0);
    v22 = dword_480898;
    byte_480850 = 1;
    goto LABEL_147;
  }
  if ( dword_48084C <= 0 )
  {
    if ( config_game_mode != 3 )
      goto LABEL_146;
  }
  else
  {
    if ( config_game_mode != 3 )
      goto LABEL_145;
    xy = dword_48084C / 1000;
    __asm
    {
      fild    [esp+18h+xy]
      fmul    ds:flt_46F28C
      fcomp   ds:flt_46F288
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
      goto LABEL_145;
  }
  if ( game_state_id == 9 && (*(int *)quest_stage_major > 1 || quest_stage_minor > 10) )
    goto LABEL_145;
LABEL_146:
  v22 = dword_480898 - frame_dt_ms;
  byte_480850 = 0;
  dword_480898 -= frame_dt_ms;
LABEL_147:
  if ( v22 >= 0 )
  {
    if ( v22 > 1000 )
      dword_480898 = 1000;
  }
  else
  {
    dword_480898 = 0;
  }
LABEL_151:
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 59) )
    game_paused_flag = game_paused_flag == 0;
  if ( !(unsigned __int8)game_is_full_version() && config_game_mode != 8 )
  {
    *(_DWORD *)&game_sequence_id = game_sequence_get();
    if ( *(int *)&game_sequence_id > 2400000 )
    {
LABEL_164:
      game_paused_flag = 0;
LABEL_165:
      v24 = dword_487284 - 4 * frame_dt_ms;
      goto LABEL_166;
    }
    if ( dword_48084C <= 0 )
    {
      if ( config_game_mode != 3 )
        goto LABEL_168;
    }
    else
    {
      if ( config_game_mode != 3 )
        goto LABEL_164;
      v27 = dword_48084C / 1000;
      __asm
      {
        fild    [esp+1Ch+var_8]
        fmul    ds:flt_46F28C
        fcomp   ds:flt_46F288
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        goto LABEL_164;
    }
    if ( game_state_id == 9 && (*(int *)quest_stage_major > 1 || quest_stage_minor > 10) )
      goto LABEL_164;
  }
LABEL_168:
  if ( !game_paused_flag )
    goto LABEL_165;
  v24 = dword_487284 + 2 * frame_dt_ms;
LABEL_166:
  dword_487284 = v24;
  if ( v24 < 0 )
  {
    dword_487284 = 0;
    goto LABEL_174;
  }
  if ( v24 <= 1000 )
  {
    if ( v24 <= 0 )
      goto LABEL_174;
  }
  else
  {
    dword_487284 = 1000;
  }
  __asm { fild    config_screen_width }
  __asm
  {
    fmul    ds:flt_46F24C
    fsub    ds:flt_46F2B0
    fstp    [esp+20h+var_8]
    fild    config_screen_height
    fmul    ds:flt_46F24C
    fsub    ds:flt_46F2B8
    fstp    [esp+20h+xy]
    fild    dword_487284
    fmul    ds:flt_46F30C
    fstp    [esp+20h+alpha]; alpha
  }
  ui_render_keybind_help((float *)&v27, alpha);
LABEL_174:
  if ( !(unsigned __int8)game_is_full_version() && config_game_mode != 8 )
  {
    *(_DWORD *)&game_sequence_id = game_sequence_get();
    if ( *(int *)&game_sequence_id > 2400000 )
      goto LABEL_185;
    if ( dword_48084C <= 0 )
    {
      if ( config_game_mode != 3 )
        return;
    }
    else
    {
      if ( config_game_mode != 3 )
        goto LABEL_185;
      v27 = dword_48084C / 1000;
      __asm
      {
        fild    [esp+18h+var_8]
        fmul    ds:flt_46F28C
        fcomp   ds:flt_46F288
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        goto LABEL_185;
    }
    if ( game_state_id == 9 && (*(int *)quest_stage_major > 1 || quest_stage_minor > 10) )
    {
LABEL_185:
      if ( !demo_mode_active )
        ui_cursor_render();
    }
  }
}

// FUN_0040b5d0 @ 0x0040B5D0
// [binja] int32_t* sub_40b5d0()
int *FUN_0040b5d0()
{
  int *v0; // eax
  int *v1; // eax
  char *v2; // eax
  int *result; // eax

  v0 = bonus_pool;
  do
  {
    *v0 = 0;
    v0 += 7;
  }
  while ( (int)v0 < (int)&quest_spawn_count );
  v1 = creature_health;
  do
  {
    *((_BYTE *)v1 - 36) = 0;
    *v1 = -1082130432;
    v1 += 38;
  }
  while ( (int)v1 < (int)&dword_4AA35C );
  v2 = projectile_pool;
  do
  {
    *v2 = 0;
    v2 += 64;
  }
  while ( (int)v2 < (int)particle_pool );
  result = player_health;
  do
  {
    *((_BYTE *)result - 36) = 0;
    *result = -1082130432;
    result += 216;
  }
  while ( (int)result < (int)dword_490F94 );
  return result;
}

// sub_40B630 @ 0x0040B630
int sub_40B630()
{
  int result; // eax

  if ( plugin_interface_ptr )
  {
    if ( game_state_id == 22 && byte_471304 )
    {
      byte_471304 = 0;
      byte_4824D1 = 0;
      sfx_mute_all(music_track_extra_0);
      FUN_0040b5d0();
      (**(void (__thiscall ***)(int))plugin_interface_ptr)(plugin_interface_ptr);
      *(_BYTE *)(plugin_interface_ptr + 9) = 0;
    }
    else if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)plugin_interface_ptr + 8))(
                plugin_interface_ptr,
                frame_dt_ms) )
    {
      byte_4824D1 = 1;
    }
    else
    {
      byte_4824D1 = 0;
      (*(void (__thiscall **)(int))(*(_DWORD *)plugin_interface_ptr + 4))(plugin_interface_ptr);
      sfx_mute_all(music_track_extra_0);
      plugin_interface_ptr = 0;
      FreeLibrary(hLibModule);
      hLibModule = 0;
      byte_471304 = 1;
      game_state_pending = 20;
      ui_transition_direction = 0;
    }
    ui_elements_update_and_render();
    if ( !ui_transition_direction && game_state_id == 22 )
      return ui_cursor_render();
    result = plugin_interface_ptr;
    if ( plugin_interface_ptr )
    {
      if ( byte_4824D1 && *(_BYTE *)(plugin_interface_ptr + 8) )
        return ui_cursor_render();
    }
  }
  else
  {
    game_state_pending = 20;
    ui_transition_direction = 0;
    result = ui_elements_update_and_render();
    byte_471304 = 1;
  }
  return result;
}

// demo_purchase_screen_update @ 0x0040B740
// demo upsell screen: feature list, purchase link, and exit handling
void demo_purchase_screen_update()
{
  int v0; // ecx
  long double v1; // st7
  int v2; // esi
  int v3; // eax
  int v4; // ebp
  float v5; // edi
  int v6; // esi
  const char *v7; // esi
  double v8; // st7
  double v9; // st6
  int v10; // edx
  int v11; // [esp+130h] [ebp-48h]
  int v12; // [esp+130h] [ebp-48h]
  float v13; // [esp+130h] [ebp-48h]
  int v14; // [esp+134h] [ebp-44h]
  float v15; // [esp+134h] [ebp-44h]
  float v16; // [esp+134h] [ebp-44h]
  int v17; // [esp+134h] [ebp-44h]
  int v18; // [esp+138h] [ebp-40h]
  float v19; // [esp+138h] [ebp-40h]
  int v20; // [esp+138h] [ebp-40h]
  int v21; // [esp+138h] [ebp-40h]
  int v22; // [esp+138h] [ebp-40h]
  float v23; // [esp+138h] [ebp-40h]
  float v24; // [esp+14Ch] [ebp-2Ch]
  float v25; // [esp+14Ch] [ebp-2Ch]
  float v26; // [esp+14Ch] [ebp-2Ch]
  float v27; // [esp+14Ch] [ebp-2Ch]
  float v28; // [esp+14Ch] [ebp-2Ch]
  float v29; // [esp+14Ch] [ebp-2Ch]
  float v30; // [esp+14Ch] [ebp-2Ch]
  float v31; // [esp+14Ch] [ebp-2Ch]
  float v32; // [esp+14Ch] [ebp-2Ch]
  float v33; // [esp+14Ch] [ebp-2Ch]
  float v34; // [esp+14Ch] [ebp-2Ch]
  float v35; // [esp+14Ch] [ebp-2Ch]
  float v36; // [esp+150h] [ebp-28h]
  float v37; // [esp+150h] [ebp-28h]
  const char *v38; // [esp+154h] [ebp-24h]
  float v39; // [esp+154h] [ebp-24h]
  float v40; // [esp+158h] [ebp-20h]
  float v41; // [esp+15Ch] [ebp-1Ch]
  float v42; // [esp+15Ch] [ebp-1Ch]
  float v43; // [esp+15Ch] [ebp-1Ch]
  float v44; // [esp+15Ch] [ebp-1Ch]
  float v45; // [esp+160h] [ebp-18h] BYREF
  float v46; // [esp+164h] [ebp-14h] BYREF
  int v47; // [esp+168h] [ebp-10h] BYREF
  int v48; // [esp+16Ch] [ebp-Ch]
  int v49; // [esp+170h] [ebp-8h]
  float v50; // [esp+174h] [ebp-4h]

  if ( ui_transition_direction && (unsigned __int8)game_is_full_version() )
  {
    ui_transition_direction = 0;
    game_state_pending = 0;
    demo_mode_active = 1;
    config_load_presets();
    sfx_mute_all(music_track_intro_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_play_exclusive(music_track_crimson_theme_id);
    ui_elements_update_and_render();
    ui_cursor_render();
    return;
  }
  if ( !demo_purchase_screen_active
    && ((unsigned __int8)input_primary_just_pressed()
     || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1)
     || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 57)) )
  {
    v0 = 16000;
    demo_purchase_screen_active = 1;
    demo_time_limit_ms = 16000;
  }
  else
  {
    v0 = demo_time_limit_ms;
  }
  if ( (byte_480320 & 1) == 0 )
  {
    byte_4802B6 = 1;
    byte_480320 |= 1u;
    byte_4802C5 = 0;
    byte_4802C4 = 0;
    dword_4802C0 = 1065353216;
    dword_4802BC = 0;
    dword_4802B0 = 0;
    byte_4802B4 = 0;
    byte_4802B5 = 0;
    dword_4802B8 = 0;
    crt_atexit(nullsub_18);
    v0 = demo_time_limit_ms;
  }
  dword_4802B0 = (int)aMaybeLater;
  if ( (byte_480320 & 2) == 0 )
  {
    byte_47F67E = 1;
    byte_480320 |= 2u;
    byte_47F68D = 0;
    byte_47F68C = 0;
    dword_47F688 = 1065353216;
    dword_47F684 = 0;
    dword_47F678 = 0;
    byte_47F67C = 0;
    byte_47F67D = 0;
    dword_47F680 = 0;
    crt_atexit(nullsub_17);
    v0 = demo_time_limit_ms;
  }
  dword_47F678 = (int)aPurchase;
  v40 = 1.0;
  v24 = (double)quest_spawn_timeline * 0.016000001;
  if ( v24 < 20.0 )
    v40 = v24 * 0.050000001;
  if ( quest_spawn_timeline > v0 - 500 )
    v40 = (double)(v0 - quest_spawn_timeline) * 0.0020000001;
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v40)));
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1061997773,
    v11,
    v14,
    v18);
  v38 = szPassword;
  if ( !demo_purchase_screen_active )
  {
    v10 = demo_upsell_message_index;
    if ( !quest_spawn_timeline )
    {
      v10 = (demo_upsell_message_index + 1) % 5;
      demo_upsell_message_index = v10;
    }
    if ( v10 )
    {
      switch ( v10 )
      {
        case 1:
          v38 = aWantMoreWeapon;
          break;
        case 2:
          v38 = aWantMorePerks;
          break;
        case 3:
          v38 = aWantUnlimitedP;
          break;
        case 4:
          v38 = aWantToPostYour;
          break;
      }
    }
    else
    {
      v38 = aWantMoreLevels;
    }
LABEL_33:
    v7 = v38;
    v47 = 0;
    v48 = 0;
    v49 = 0;
    v8 = (double)strlen(v38) * 12.8;
    v45 = 60.0;
    v39 = (double)quest_spawn_timeline / (double)demo_time_limit_ms * v8;
    v50 = v40 * 0.5;
    v9 = v24 + 50.0;
    v44 = v9;
    v46 = v9 - 4.0;
    v13 = v8 + 12.0;
    (*(void (__thiscall **)(int, float *, _DWORD, int, int *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v45,
      LODWORD(v13),
      1106247680,
      &v47);
    v50 = v40 * 0.80000001;
    v47 = 1056964608;
    v48 = 1036831949;
    v49 = 1036831949;
    v45 = 64.0;
    v46 = v24 + 72.0;
    (*(void (__thiscall **)(int, float *, _DWORD, int, int *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v45,
      LODWORD(v39),
      1077936128,
      &v47);
    (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v40)));
    (*(void (__thiscall **)(int, int, _DWORD, const char *))(*(_DWORD *)grim_interface_ptr + 316))(
      grim_interface_ptr,
      1112014848,
      LODWORD(v44),
      v7);
LABEL_34:
    ui_elements_update_and_render();
    ui_cursor_render();
    return;
  }
  ui_pulse_timer_ms += frame_dt_ms;
  v1 = sin((double)(ui_pulse_timer_ms % 1000) * 6.2831855);
  v36 = v1 * v1;
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 280))(
    grim_interface_ptr,
    0,
    0,
    0,
    0,
    1065353216);
  (*(void (__thiscall **)(int, int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 280))(
    grim_interface_ptr,
    1,
    0,
    0,
    1050253722,
    1065353216);
  v15 = v36 * 0.55000001;
  (*(void (__stdcall **)(int, _DWORD, int, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 280))(
    2,
    0,
    1053609165,
    LODWORD(v15),
    LODWORD(v36));
  (*(void (__thiscall **)(int, int, _DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 280))(
    grim_interface_ptr,
    3,
    0,
    1053609165,
    1053609165,
    1065353216);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1056964608,
    1056964608);
  v2 = *(_DWORD *)grim_interface_ptr;
  v3 = (*(int (__thiscall **)(int, char *, _DWORD))(*(_DWORD *)grim_interface_ptr + 192))(
         grim_interface_ptr,
         aBackplasma,
         0);
  (*(void (__thiscall **)(int, int))(v2 + 196))(grim_interface_ptr, v3);
  v19 = (float)config_screen_height;
  v16 = (float)*(int *)config_screen_width;
  (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
    0,
    0,
    LODWORD(v16),
    LODWORD(v19));
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v37 = 0.0;
  if ( *(_DWORD *)config_screen_width == 800 )
  {
    v37 = 64.0;
  }
  else if ( *(_DWORD *)config_screen_width == 1024 )
  {
    v37 = 128.0;
  }
  v20 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, aMockup);
  ui_draw_textured_quad(
    (__int64)((double)(*(_DWORD *)config_screen_width / 2 - 128) + v37),
    config_screen_height / 2 - 140,
    512,
    256,
    v20);
  v21 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, aClLogo);
  ui_draw_textured_quad(
    *(_DWORD *)config_screen_width / 2 - 256,
    (__int64)((double)(config_screen_height / 2 - 200) - v37 * 0.40000001),
    512,
    64,
    v21);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1058642330,
    v12,
    v17,
    v22);
  v25 = (float)(config_screen_height / 2 - 104);
  v4 = (__int64)((double)(*(_DWORD *)config_screen_width / 2 - 296) - v37 * 0.80000001);
  v41 = (float)v4;
  v5 = v41;
  (*(void (__thiscall **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
    grim_interface_ptr,
    LODWORD(v41),
    LODWORD(v25),
    aUpgradeToTheFu);
  v26 = v25 + 28.0;
  (*(void (__thiscall **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
    grim_interface_ptr,
    LODWORD(v41),
    LODWORD(v26),
    aFullVersionFea);
  v45 = v41;
  v46 = v26 + 15.0;
  v6 = *(_DWORD *)grim_interface_ptr;
  v45 = COERCE_FLOAT(
          (*(int (__thiscall **)(int, char *, int))(*(_DWORD *)grim_interface_ptr + 332))(
            grim_interface_ptr,
            aFullVersionFea,
            1065353216));
  v23 = (float)SLODWORD(v45);
  (*(void (__thiscall **)(int, float *, _DWORD))(v6 + 212))(grim_interface_ptr, &v46, LODWORD(v23));
  v27 = v26 + 22.0;
  v42 = (float)(v4 + 8);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
    grim_interface_ptr,
    LODWORD(v42),
    LODWORD(v27),
    aUnlimitedPlayT);
  v28 = v27 + 22.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v42),
    LODWORD(v28),
    aTheVariedWeapo);
  v29 = v28 + 17.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v42),
    LODWORD(v29),
    aWeaponsThatAll);
  v30 = v29 + 17.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v42),
    LODWORD(v30),
    aFireAndElectri);
  v31 = v30 + 22.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v42),
    LODWORD(v31),
    aOver40GameAlte);
  v32 = v31 + 22.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v42),
    LODWORD(v32),
    a40InsaneLevels);
  v33 = v32 + 18.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v42),
    LODWORD(v33),
    aHoursOfIntense);
  v34 = v33 + 22.0;
  (*(void (__thiscall **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
    grim_interface_ptr,
    LODWORD(v42),
    LODWORD(v34),
    aTheAbilityToPo);
  v35 = v34 + 22.0 + 22.0;
  (*(void (__thiscall **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v5)),
    LODWORD(v35),
    aPurchasingTheG);
  v24 = v35 + 17.0 + 17.0 + 22.0;
  v45 = (float)(*(_DWORD *)config_screen_width / 2 + 128);
  v43 = v37 * 0.30000001;
  v46 = (double)(config_screen_height / 2 + 102) + v43 + 50.0;
  if ( ui_button_update(&v45, (int)&dword_47F678) )
  {
    shareware_offer_seen_latch = 1;
    byte_47EA50 = 1;
    ShellExecuteA(0, Operation, File, 0, 0, 1);
    return;
  }
  v45 = (float)(*(_DWORD *)config_screen_width / 2 + 128);
  v46 = (double)(config_screen_height / 2 + 102) + v43 + 90.0;
  if ( !ui_button_update(&v45, (int)&dword_4802B0) )
  {
    quest_spawn_timeline += frame_dt_ms;
    if ( quest_spawn_timeline > demo_time_limit_ms )
    {
      render_pass_mode = 0;
      demo_mode_start();
    }
    if ( demo_purchase_screen_active )
      goto LABEL_34;
    goto LABEL_33;
  }
  if ( shareware_offer_seen_latch )
    byte_47EA50 = 1;
  ui_transition_direction = 0;
  game_state_pending = 0;
  demo_mode_active = 1;
  if ( !shareware_offer_seen_latch )
  {
    config_load_presets();
    sfx_mute_all(music_track_intro_id);
    sfx_mute_all(music_track_crimsonquest_id);
    sfx_play_exclusive(music_track_crimson_theme_id);
  }
}

// nullsub_17 @ 0x0040C1A0
void __cdecl nullsub_17()
{
  ;
}

// nullsub_18 @ 0x0040C1B0
void __cdecl nullsub_18()
{
  ;
}

// console_hotkey_update @ 0x0040C1C0
// per-frame input/update function; contains console hotkey block (DIK_GRAVE) at 0x0040c360 and DIK_F12 check; entry identified via WinDbg
void console_hotkey_update()
{
  unsigned int v0; // ecx
  int v1; // esi
  int v2; // eax
  FILE *v3; // eax
  char v4; // cl
  __int64 v5; // rax
  double v6; // st7
  double v7; // st7
  double v8; // st7
  double v9; // st7
  int v10; // ecx
  double v11; // st7
  double v12; // st7
  float *v13; // eax
  double v14; // st7
  double v15; // st7
  double v16; // st7
  __int64 v17; // rax
  int v18; // esi
  double v19; // st7
  int v20; // ecx
  int v21; // eax
  int v22; // esi
  double v23; // st7
  double v24; // st7
  double v25; // st7
  float v26; // [esp+FCh] [ebp-40h]
  int v27; // [esp+100h] [ebp-3Ch]
  int v28; // [esp+100h] [ebp-3Ch]
  int v29; // [esp+100h] [ebp-3Ch]
  float v30; // [esp+100h] [ebp-3Ch]
  float v31; // [esp+100h] [ebp-3Ch]
  float v32; // [esp+100h] [ebp-3Ch]
  int v33; // [esp+104h] [ebp-38h]
  int v34; // [esp+104h] [ebp-38h]
  int v35; // [esp+104h] [ebp-38h]
  char *v36; // [esp+104h] [ebp-38h]
  int v37; // [esp+108h] [ebp-34h]
  int v38; // [esp+108h] [ebp-34h]
  int v39; // [esp+108h] [ebp-34h]
  int v40; // [esp+108h] [ebp-34h]
  float v41; // [esp+108h] [ebp-34h]
  int v42; // [esp+10Ch] [ebp-30h]
  void *v43; // [esp+10Ch] [ebp-30h]
  int v44; // [esp+10Ch] [ebp-30h]
  float v45; // [esp+114h] [ebp-28h]
  float v46; // [esp+114h] [ebp-28h]
  float v47; // [esp+114h] [ebp-28h]
  float v48; // [esp+114h] [ebp-28h]
  float v49; // [esp+114h] [ebp-28h]
  float v50; // [esp+11Ch] [ebp-20h]
  int v51; // [esp+11Ch] [ebp-20h]
  int v52; // [esp+11Ch] [ebp-20h]
  float v53; // [esp+120h] [ebp-1Ch]
  int v54; // [esp+124h] [ebp-18h] BYREF
  float v55; // [esp+128h] [ebp-14h]
  float v56; // [esp+12Ch] [ebp-10h] BYREF
  float v57; // [esp+130h] [ebp-Ch]
  float v58; // [esp+134h] [ebp-8h]
  int v59; // [esp+138h] [ebp-4h]

  frame_dt = ((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 60))(grim_interface_ptr);
  if ( quest_unlock_index < 40 )
    config_hardcore = 0;
  if ( !(unsigned __int8)game_is_full_version() )
  {
    if ( *(int *)&game_sequence_id < 0 )
      *(_DWORD *)&game_sequence_id = 1200000;
    *(_DWORD *)&game_sequence_id = game_sequence_get();
    config_hardcore = 0;
  }
  if ( (unsigned __int8)game_is_full_version() )
  {
    dword_48823C = (int)sub_447350;
    shareware_offer_seen_latch = 0;
  }
  if ( !byte_486FAA && (unsigned __int8)game_is_full_version() )
  {
    dword_4875B8 = dword_488218;
    dword_4875BC = dword_48821C;
    byte_486FAA = 1;
    byte_488208 = 0;
    flt_4875C4 = flt_4875C4 + 60.0;
    flt_4875C0 = flt_4875C0 - 20.0;
  }
  if ( !audio_suspend_flag
    && *(_BYTE *)(*(int (__thiscall **)(int, float *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                   grim_interface_ptr,
                   &v56,
                   87) )
  {
    if ( render_pass_mode && config_game_mode == 3 )
    {
      v0 = quest_stage_minor - 1;
      v1 = *(_DWORD *)quest_stage_major - 1;
      if ( quest_stage_minor - 1 >= 10 )
        v0 %= 0xAu;
      if ( v1 >= 4 )
        v1 -= 4 * ((unsigned int)v1 >> 2);
      terrain_generate((void *)(44 * (v1 + 10 * v0) + 4736816));
    }
    else
    {
      terrain_generate_random();
    }
    (*(void (__thiscall **)(int, int, _BYTE))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 87, 0);
  }
  if ( !(unsigned __int8)game_is_full_version() && quest_unlock_index > 10 )
    quest_unlock_index = 10;
  if ( audio_suspend_flag )
  {
    audio_resume_all();
    return;
  }
  dword_480848 += frame_dt_ms;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 41) )
    console_set_open(console_open_flag == 0);
  console_update(v42);
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 88) )
  {
    v2 = dword_4808C4;
    do
    {
      if ( v2 >= 10 )
      {
        if ( v2 >= 100 )
          crt_sprintf(path, "shot_%d.bmp", v2);
        else
          crt_sprintf(path, "shot_0%d.bmp", v2);
      }
      else
      {
        crt_sprintf(path, "shot_00%d.bmp", v2);
      }
      v3 = crt_fopen(path, file_mode_read_binary);
      if ( v3 )
      {
        crt_fclose(v3);
        v4 = 0;
      }
      else
      {
        v4 = 1;
      }
      v2 = ++dword_4808C4;
    }
    while ( !v4 );
    (*(void (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 12))(grim_interface_ptr, path);
  }
  if ( !demo_mode_active && !byte_480850 )
  {
    *(_DWORD *)&game_sequence_id = game_sequence_get();
    if ( !console_open_flag && render_pass_mode && game_state_id == 9 )
      *(_DWORD *)&game_sequence_id += (__int64)(frame_dt * 1000.0);
    if ( dword_48084C > 0 && !console_open_flag )
    {
      if ( !render_pass_mode )
        goto LABEL_59;
      if ( game_state_id == 9 && config_game_mode != 8 )
        dword_48084C += (__int64)(frame_dt * 1000.0);
    }
  }
  if ( render_pass_mode && perk_count_get(perk_id_reflex_boosted) && game_state_id == 9 )
    frame_dt = frame_dt * 0.89999998;
LABEL_59:
  dword_47EA48 = LODWORD(frame_dt);
  flt_47EA4C = flt_47EA4C + frame_dt;
  v5 = (__int64)(frame_dt * 1000.0);
  frame_dt_ms = v5;
  if ( !console_open_flag && render_pass_mode && game_state_id == 9 && config_game_mode != 8 )
    *(_DWORD *)&dword_48718C += v5;
  v6 = frame_dt;
  if ( byte_48702C )
    v7 = v6 * 10.0 + screen_fade_alpha;
  else
    v7 = screen_fade_alpha - (v6 + v6);
  screen_fade_alpha = v7;
  if ( screen_fade_alpha >= 0.0 )
  {
    if ( screen_fade_alpha > 1.0 )
      screen_fade_alpha = 1.0;
  }
  else
  {
    screen_fade_alpha = 0.0;
  }
  if ( console_open_flag )
    frame_dt = 0.0;
  if ( ((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 112))(grim_interface_ptr) == 0.0
    || ((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 116))(grim_interface_ptr) == 0.0 )
  {
    byte_4871CB = 0;
  }
  else
  {
    byte_4871CB = 1;
    ui_mouse_blocked = 0;
    dword_4808C8 = 0;
  }
  v50 = 0.0;
  v53 = 0.0;
  v45 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
          grim_interface_ptr,
          player_axis_aim_x);
  v8 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
         grim_interface_ptr,
         player_axis_aim_y);
  if ( sqrt(v8 * v8 + v45 * v45) > 0.2 )
  {
    v53 = v8;
    v50 = v45;
  }
  v46 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
          grim_interface_ptr,
          player_axis_move_x);
  v9 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
         grim_interface_ptr,
         player_axis_move_y);
  if ( sqrt(v9 * v9 + v46 * v46) > 0.2 )
  {
    v50 = v50 + v46;
    v53 = v53 + v9;
  }
  if ( sqrt(v53 * v53 + v50 * v50) > 0.2 )
    dword_4808C8 = 1;
  v10 = game_state_id;
  if ( game_state_id == 9 )
  {
    dword_4808C8 = 0;
  }
  else if ( dword_4808C8 == 1 )
  {
    v15 = flt_4807BC * frame_dt;
    ui_mouse_x = v15 * v50 * 540.0 + ui_mouse_x;
    ui_mouse_y = v15 * v53 * 540.0 + ui_mouse_y;
    goto LABEL_88;
  }
  v11 = ((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 112))(grim_interface_ptr);
  ui_mouse_x = v11 * flt_4807BC + v11 * flt_4807BC + ui_mouse_x;
  v12 = ((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 116))(grim_interface_ptr);
  v13 = (float *)dword_4871F4;
  ui_mouse_y = v12 * flt_4807BC + v12 * flt_4807BC + ui_mouse_y;
  do
  {
    *v13 = ui_mouse_x;
    v13[1] = ui_mouse_y;
    v13 += 2;
  }
  while ( (int)v13 < (int)flt_487204 );
  v10 = game_state_id;
LABEL_88:
  if ( ui_mouse_x < 0.0 )
    ui_mouse_x = 0.0;
  if ( ui_mouse_y < 0.0 )
    ui_mouse_y = 0.0;
  v14 = (double)(*(_DWORD *)config_screen_width - 1);
  if ( ui_mouse_x > v14 )
    ui_mouse_x = v14;
  v16 = (double)(config_screen_height - 1);
  if ( ui_mouse_y > v16 )
    ui_mouse_y = v16;
  if ( v10 == 22 || byte_4824D1 )
  {
    sub_40B630();
    goto LABEL_125;
  }
  if ( v10 != 9 )
  {
    if ( v10 != 24 )
    {
      switch ( v10 )
      {
        case 6:
          perk_selection_screen_update();
          break;
        case 7:
          game_over_screen_update();
          break;
        case 8:
          quest_results_screen_update();
          break;
        case 12:
          quest_failed_screen_update();
          break;
        case 18:
          survival_gameplay_update_and_render();
          break;
        case 21:
          FUN_00406350();
          break;
        default:
          demo_purchase_screen_active = 0;
          FUN_00406af0();
          break;
      }
      goto LABEL_125;
    }
    gameplay_update_and_render();
    goto LABEL_108;
  }
  if ( demo_purchase_screen_active )
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 44))(
      grim_interface_ptr,
      0,
      0,
      0,
      0);
  else
    gameplay_update_and_render();
  if ( demo_mode_active )
LABEL_108:
    demo_purchase_screen_update();
  if ( audio_suspend_flag )
    return;
LABEL_125:
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    0x40000000,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v27,
    v33,
    v37);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1058642330);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1053609165,
    v28,
    v34,
    v38);
  if ( !(unsigned __int8)game_is_full_version() )
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1050253722,
      1050253722,
      1058642330);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1055286886,
    v29,
    v35,
    v39);
  if ( *(float *)(cv_showFPS + 12) != 0.0 )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1058642330);
    v17 = (__int64)((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 64))(grim_interface_ptr);
    v18 = *(_DWORD *)grim_interface_ptr;
    if ( (int)v17 < 400 )
    {
      v40 = (__int64)((double (*)(void))*(_DWORD *)(v18 + 64))();
      v36 = aD_0;
      v30 = (float)(config_screen_height - 24);
      v19 = (double)(*(_DWORD *)config_screen_width - 45);
    }
    else
    {
      v40 = (__int64)((double (*)(void))*(_DWORD *)(v18 + 64))();
      v36 = a400;
      v30 = (float)(config_screen_height - 24);
      v19 = (double)(*(_DWORD *)config_screen_width - 51);
    }
    v26 = v19;
    (*(void (__cdecl **)(int, _DWORD, float, char *, int))(v18 + 328))(
      grim_interface_ptr,
      LODWORD(v26),
      COERCE_FLOAT(LODWORD(v30)),
      v36,
      v40);
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1058642330);
  FUN_00401dd0(v43);
  crt_rand();
  audio_update();
  if ( !(*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1) )
    goto LABEL_140;
  v20 = game_state_id;
  if ( (render_pass_mode || game_state_id == 22) && (game_state_id == 9 || game_state_id == 22 || game_state_id == 18) )
  {
    ui_transition_direction = 0;
    game_state_pending = 5;
    if ( plugin_interface_ptr )
    {
      *(_BYTE *)(plugin_interface_ptr + 9) = 1;
LABEL_140:
      v20 = game_state_id;
    }
  }
  v21 = dword_471308;
  if ( dword_471308 == -1 )
  {
    v21 = crt_rand() % 32;
    v20 = game_state_id;
    dword_471308 = v21;
  }
  if ( v20 == 4 && !render_pass_mode && local_system_time.wMonth == 3 && local_system_time.wDay == 3 && v21 == 3 )
  {
    dword_471308 = -1;
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1045220557,
      1065353216,
      1058642330,
      1056964608,
      v44);
    v22 = *(_DWORD *)grim_interface_ptr;
    v41 = (float)(crt_rand() % 64 + 16);
    (*(void (__thiscall **)(int, _DWORD))(v22 + 324))(grim_interface_ptr, LODWORD(v41));
  }
  if ( (unsigned __int8)game_is_full_version() )
  {
LABEL_154:
    if ( !demo_mode_active )
      goto LABEL_166;
    goto LABEL_155;
  }
  if ( !demo_mode_active )
  {
    v23 = (double)*(int *)&game_sequence_id / (double)sub_41DF50();
    v47 = v23;
    if ( v23 > 1.0 )
      v47 = 1.0;
    v56 = 0.0;
    v57 = 0.0;
    v55 = (float)(config_screen_height - 7);
    v58 = 0.0;
    v59 = 1056964608;
    v54 = 0;
    v31 = (float)*(int *)config_screen_width;
    (*(void (__thiscall **)(int, int *, _DWORD, int, float *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v54,
      LODWORD(v31),
      1090519040,
      &v56);
    v56 = v47;
    v24 = v47 * 4.0 + 1.0;
    v59 = 1056964608;
    v54 = 0x40000000;
    v57 = 0.89999998 / v24;
    v58 = 0.5 / v24;
    v55 = (float)(config_screen_height - 5);
    v32 = (double)(*(_DWORD *)config_screen_width - 4) * v47;
    (*(void (__thiscall **)(int, int *, _DWORD, int, float *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v54,
      LODWORD(v32),
      1077936128,
      &v56);
    goto LABEL_154;
  }
LABEL_155:
  if ( !game_state_pending )
  {
    v51 = ui_elements_max_timeline();
    if ( v51 )
      v25 = 1.0 - (double)ui_elements_timeline / (double)v51;
    else
      v25 = 1.0;
    v48 = v25 * v25;
    if ( game_state_prev == 24 )
    {
      demo_purchase_screen_active = 0;
      v48 = 1.0 - v48;
    }
    if ( v48 >= 0.0 )
    {
      if ( v48 > 1.0 )
        v48 = 1.0;
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 204))(
        grim_interface_ptr,
        0,
        0,
        0,
        COERCE_FLOAT(LODWORD(v48)));
    }
    else
    {
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 204))(
        grim_interface_ptr,
        0,
        0,
        0,
        0);
    }
  }
LABEL_166:
  if ( game_state_pending == 10 )
  {
    v52 = ui_elements_max_timeline();
    if ( v52 )
      v49 = 1.0 - (double)ui_elements_timeline / (double)v52;
    else
      v49 = 1.0;
    if ( game_state_prev == 22 )
      v49 = 1.0 - v49;
    if ( v49 >= 0.0 )
    {
      if ( v49 > 1.0 )
        v49 = 1.0;
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 204))(
        grim_interface_ptr,
        0,
        0,
        0,
        COERCE_FLOAT(LODWORD(v49)));
    }
    else
    {
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 204))(
        grim_interface_ptr,
        0,
        0,
        0,
        0);
    }
  }
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 16)
    && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 56) )
  {
    byte_47EA50 = 1;
  }
  else if ( !byte_47EA50 )
  {
LABEL_186:
    if ( byte_4D7A24 )
    {
      byte_4D7A24 = 0;
      FUN_00402d50();
      FUN_00402d50();
      audio_suspend_all();
      game_is_full_version();
    }
    if ( byte_4D7A25 )
    {
      byte_4D7A25 = 0;
      FUN_00402d50();
      FUN_00402d50();
      audio_suspend_all();
      game_is_full_version();
    }
    if ( byte_4D7A26 )
    {
      byte_4D7A26 = 0;
      FUN_00402d50();
      FUN_00402d50();
      audio_suspend_all();
      game_is_full_version();
    }
    if ( !dword_4D11F0 && byte_4D11F8 && lpMultiByteStr && (game_state_id != 14 || byte_480838) )
      Sleep(0x64u);
    return;
  }
  if ( (unsigned __int8)game_is_full_version() )
  {
    config_sync_from_grim();
    return;
  }
  if ( !shareware_offer_seen_latch && !(unsigned __int8)game_is_full_version() )
  {
    config_sync_from_grim();
    demo_mode_start();
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_extra_0);
    sfx_mute_all(music_track_intro_id);
    sfx_play_exclusive(music_track_shortie_monk_id);
    byte_47EA50 = 0;
    shareware_offer_seen_latch = 1;
    goto LABEL_186;
  }
}

// sub_40CFE0 @ 0x0040CFE0
int *sub_40CFE0()
{
  int *result; // eax
  int v1; // ecx

  result = &credits_line_table;
  v1 = 256;
  do
  {
    result[1] = 0;
    *result = 0;
    result += 2;
    --v1;
  }
  while ( v1 );
  return result;
}

// credits_line_set @ 0x0040D000
// stores a credits line string + flags into the credits line table
void credits_line_set(int index, char *text, int flags)
{
  credits_line_table_flags[2 * index] = flags;
  if ( credits_line_table[2 * index] )
    crt_free((void *)credits_line_table[2 * index]);
  credits_line_table[2 * index] = (int)strdup_malloc(text);
  dword_4811B8 = index;
}

// credits_line_clear_flag @ 0x0040D040
// walks backward to find the last line with flag 0x4 and clears it (penalty for wrong click; plays sfx)
void credits_line_clear_flag(int index)
{
  int v1; // eax
  _BYTE *i; // ecx

  v1 = index;
  if ( index >= 0 )
  {
    for ( i = (_BYTE *)(8 * index + 4721028); (*i & 4) == 0; i -= 8 )
    {
      if ( --v1 < 0 )
        return;
    }
    credits_line_table_flags[2 * v1] &= ~4u;
    sfx_play(sfx_trooper_inpain_01);
  }
}

// credits_build_lines @ 0x0040D090
// populates credits line table with headings, names, and hint lines
void credits_build_lines()
{
  credits_line_set(0, szPassword, 0);
  credits_line_set(1, szAgent, 1);
  credits_line_set(2, szPassword, 0);
  credits_line_set(3, szPassword, 0);
  credits_line_set(4, aGameDesign, 1);
  credits_line_set(5, aTeroAlatalo, 0);
  credits_line_set(6, szPassword, 0);
  credits_line_set(7, aProgramming, 1);
  credits_line_set(8, aTeroAlatalo, 0);
  credits_line_set(9, szPassword, 0);
  credits_line_set(10, aProducer, 1);
  credits_line_set(11, aZachYoung, 0);
  credits_line_set(12, szPassword, 0);
  credits_line_set(13, a2dArt, 1);
  credits_line_set(14, aTeroAlatalo, 0);
  credits_line_set(15, szPassword, 0);
  credits_line_set(16, a3dModelling, 1);
  credits_line_set(17, aTeroAlatalo, 0);
  credits_line_set(18, aTimoPalonen, 0);
  credits_line_set(19, szPassword, 0);
  credits_line_set(20, aMusic, 1);
  credits_line_set(21, aValtteriPihlaj, 0);
  credits_line_set(22, aVilleEriksson, 0);
  credits_line_set(23, szPassword, 0);
  credits_line_set(24, aSoundEffects, 1);
  credits_line_set(25, aIonHardie, 0);
  credits_line_set(26, aTeroAlatalo, 0);
  credits_line_set(27, aValtteriPihlaj, 0);
  credits_line_set(28, aVilleEriksson, 0);
  credits_line_set(29, szPassword, 0);
  credits_line_set(30, aManual, 1);
  credits_line_set(31, aMiikkaKulmala, 0);
  credits_line_set(32, aZachYoung, 0);
  credits_line_set(33, szPassword, 0);
  credits_line_set(34, aSpecialThanksT, 1);
  credits_line_set(35, aPetriJ, 0);
  credits_line_set(36, aPeterHajbaReme, 0);
  credits_line_set(37, szPassword, 0);
  credits_line_set(38, aPlayTesters, 1);
  credits_line_set(39, aAvrahamPetrosy, 0);
  credits_line_set(40, aBryceBaker, 0);
  credits_line_set(41, aDanRuskin, 0);
  credits_line_set(42, aDirkBunk, 0);
  credits_line_set(43, aEricDallaire, 0);
  credits_line_set(44, aErikVanPelt, 0);
  credits_line_set(45, aErnieRamirez, 0);
  credits_line_set(46, aIonHardie, 0);
  credits_line_set(47, aJamesCSmith, 0);
  credits_line_set(48, aJarkkoForsback, 0);
  credits_line_set(49, aJeffMcateer, 0);
  credits_line_set(50, aJuhaAlatalo, 0);
  credits_line_set(51, aKalleHahl, 0);
  credits_line_set(52, aLarsBrubaker, 0);
  credits_line_set(53, aLeeCooper, 0);
  credits_line_set(54, aMarkusLassila, 0);
  credits_line_set(55, aMattiAlanen, 0);
  credits_line_set(56, aMiikkaKulmala, 0);
  credits_line_set(57, aMikaAlatalo, 0);
  credits_line_set(58, aMikeColonnese, 0);
  credits_line_set(59, aSimonHallam, 0);
  credits_line_set(60, aToniNurminen, 0);
  credits_line_set(61, aValtteriPihlaj, 0);
  credits_line_set(62, aVilleEriksson, 0);
  credits_line_set(63, aVilleM, 0);
  credits_line_set(64, aZachYoung, 0);
  credits_line_set(65, szPassword, 0);
  credits_line_set(66, aGreetingTo, 0);
  credits_line_set(66, aChaos, 0);
  credits_line_set(66, aMatricks, 0);
  credits_line_set(66, aMuzzy, 0);
  credits_line_set(66, szPassword, 0);
  credits_line_set(67, szPassword, 0);
  credits_line_set(68, a2003C10tonsEnt, 0);
  credits_line_set(69, a10tonsLogoBy, 0);
  credits_line_set(70, aPasiHeinonen, 0);
  credits_line_set(71, szPassword, 0);
  credits_line_set(72, szPassword, 0);
  credits_line_set(73, szPassword, 0);
  credits_line_set(74, aUsesVorbisAudi, 0);
  credits_line_set(75, a2003CXiphOrgFo, 0);
  credits_line_set(76, aSeeVorbisTxt, 0);
  credits_line_set(77, szPassword, 0);
  credits_line_set(78, szPassword, 0);
  credits_line_set(79, szPassword, 0);
  credits_line_set(80, szPassword, 0);
  credits_line_set(81, szPassword, 0);
  credits_line_set(82, szPassword, 0);
  credits_line_set(83, szPassword, 0);
  credits_secret_line_base_index = 84;
  credits_line_set(84, szPassword, 0);
  credits_line_set(85, szPassword, 0);
  credits_line_set(86, szPassword, 0);
  credits_line_set(87, aYouCanStopWatc, 0);
  credits_line_set(88, szPassword, 0);
  credits_line_set(89, szPassword, 0);
  credits_line_set(90, szPassword, 0);
  credits_line_set(91, szPassword, 0);
  credits_line_set(92, szPassword, 0);
  credits_line_set(93, szPassword, 0);
  credits_line_set(94, szPassword, 0);
  credits_line_set(95, szPassword, 0);
  credits_line_set(96, szPassword, 0);
  credits_line_set(97, szPassword, 0);
  credits_line_set(98, szPassword, 0);
  credits_line_set(99, szPassword, 0);
  credits_line_set(100, szPassword, 0);
  credits_line_set(101, szPassword, 0);
  credits_line_set(102, szPassword, 0);
  credits_line_set(103, szPassword, 0);
  credits_line_set(104, szPassword, 0);
  credits_line_set(105, szPassword, 0);
  credits_line_set(106, szPassword, 0);
  credits_line_set(107, szPassword, 0);
  credits_line_set(108, szPassword, 0);
  credits_line_set(109, szPassword, 0);
  credits_line_set(110, szPassword, 0);
  credits_line_set(111, szPassword, 0);
  credits_line_set(112, szPassword, 0);
  credits_line_set(113, szPassword, 0);
  credits_line_set(114, szPassword, 0);
  credits_line_set(115, szPassword, 0);
  credits_line_set(116, szPassword, 0);
  credits_line_set(117, szPassword, 0);
  credits_line_set(118, szPassword, 0);
  credits_line_set(119, aClickTheOnesWi, 0);
  credits_line_set(120, aAndBePatient, 0);
  credits_line_set(121, szPassword, 0);
  credits_line_set(122, szPassword, 0);
  credits_line_set(123, szPassword, 0);
  credits_line_set(124, szPassword, 0);
  credits_line_set(125, szPassword, 0);
}

// credits_screen_update @ 0x0040D800
// credits screen update/render loop; clicks flag lines containing 'o' (lowercase) and misclicks clear the last flagged line; when all 'o' lines are flagged, sets DAT_004811c4 and injects secret lines at DAT_004811bc; Secret button sets game_state_pending=0x1a (AlienZooKeeper)
void credits_screen_update()
{
  float v0; // ebp
  int v1; // esi
  double v2; // st7
  int v3; // ecx
  int v4; // edx
  double v5; // st7
  unsigned __int8 v7; // c0
  unsigned __int8 v8; // c3
  int v9; // ebp
  int v10; // esi
  int v11; // ecx
  double v12; // st7
  double v13; // st6
  double v14; // st6
  double v15; // st6
  int v16; // eax
  int v17; // eax
  int v18; // edx
  int v19; // edx
  int *v20; // esi
  int v21; // esi
  int v22; // eax
  int v23; // ebp
  int v24; // ecx
  int v25; // edx
  int v26; // ebp
  int v27; // ecx
  int v28; // edx
  int v29; // ebp
  int v30; // ecx
  float v31; // [esp+24h] [ebp-44h]
  float v32; // [esp+24h] [ebp-44h]
  int v33; // [esp+30h] [ebp-38h]
  float v34; // [esp+34h] [ebp-34h]
  int v35; // [esp+44h] [ebp-24h]
  float v36; // [esp+48h] [ebp-20h]
  float v37; // [esp+4Ch] [ebp-1Ch]
  float v38; // [esp+50h] [ebp-18h]
  float v39; // [esp+54h] [ebp-14h]
  float v40; // [esp+54h] [ebp-14h]
  float v41; // [esp+58h] [ebp-10h] BYREF
  float v42; // [esp+5Ch] [ebp-Ch]
  float v43; // [esp+60h] [ebp-8h] BYREF
  float v44; // [esp+64h] [ebp-4h]
  float retaddr; // [esp+68h] [ebp+0h] BYREF

  if ( (byte_480978 & 1) == 0 )
  {
    byte_4811A6 = 1;
    byte_480978 |= 1u;
    byte_4811B5 = 0;
    byte_4811B4 = 0;
    dword_4811B0 = 1065353216;
    dword_4811AC = 0;
    credits_back_button = 0;
    byte_4811A4 = 0;
    credits_back_button_clicked = 0;
    dword_4811A8 = 0;
    crt_atexit(nullsub_20);
  }
  if ( (byte_480978 & 2) == 0 )
  {
    byte_48118E = 1;
    byte_480978 |= 2u;
    byte_48119D = 0;
    byte_48119C = 0;
    dword_481198 = 1065353216;
    dword_481194 = 0;
    credits_secret_button = 0;
    byte_48118C = 0;
    credits_secret_button_clicked = 0;
    dword_481190 = 0;
    crt_atexit(nullsub_19);
  }
  v34 = v0;
  v33 = v1;
  credits_secret_button = (int)menu_label_secret;
  v44 = flt_489DFC + flt_489E20;
  v38 = flt_489E1C + flt_489DF8 + 300.0;
  v39 = v44 + 40.0;
  v42 = v39 + 10.0;
  v41 = v38 + flt_489DE8 + 48.0 - 110.0 - 40.0;
  if ( !dword_487234 )
  {
    dword_487234 = 1;
    credits_build_lines();
    dword_4811C0 = 0;
    dword_481184 = 0;
    goto LABEL_7;
  }
  if ( dword_487234 == 1 )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    if ( dword_481184 > dword_4811B8 + 2 )
    {
      dword_4811C0 = 0;
      dword_481184 = 0;
    }
    v42 = v42 - 4.0;
    v31 = v41 + 4.0;
    (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v31),
      COERCE_FLOAT(LODWORD(v42)),
      menu_label_credits);
    v42 = v42 + 20.0 - 6.0;
    v2 = frame_dt + *(float *)&dword_4811C0;
    *(float *)&dword_4811C0 = v2;
    v3 = (__int64)v2 - 15;
    dword_481184 = v3;
    v4 = v3 + 16;
    dword_481180 = v3 + 16;
    if ( v3 + 16 > dword_4811B8 )
    {
      v4 = dword_4811B8;
      dword_481180 = dword_4811B8;
    }
    v5 = *(float *)&dword_4811C0 * 16.0;
    if ( !(v7 | v8) )
    {
      do
        v5 = v5 - 16.0;
      while ( v5 > 16.0 );
    }
    v9 = 0;
    if ( v4 - v3 > 0 )
    {
      v35 = 0;
      while ( 1 )
      {
        v10 = v3 + v9;
        if ( v3 + v9 < 0 )
          v10 = 0;
        v11 = (*(int (__thiscall **)(int, int, int, float))(*(_DWORD *)grim_interface_ptr + 332))(
                grim_interface_ptr,
                credits_line_table[2 * v10],
                v33,
                COERCE_FLOAT(LODWORD(v34)));
        v12 = (double)SLODWORD(v37) + v44 - v38;
        v41 = v12;
        v13 = v44 - 16.0 + 24.0;
        if ( v12 < v13 )
          break;
        v15 = (double)(16 * (dword_481180 - dword_481184 - 1)) + v44 - 24.0;
        if ( v12 > v15 )
        {
          v14 = (v15 - v12) * 0.041666668 + 1.0;
LABEL_30:
          v36 = v14;
          if ( v36 <= 1.0 )
          {
            if ( v36 < 0.0 )
              v36 = 0.0;
          }
          else
          {
            v36 = 1.0;
          }
          goto LABEL_35;
        }
        v36 = 1.0;
LABEL_35:
        v40 = (float)(v11 / 2);
        retaddr = v43 + 140.0 - v40;
        if ( (unsigned __int8)ui_mouse_inside_rect(&retaddr, 16, v11) && (unsigned __int8)input_primary_just_pressed() )
        {
          if ( strchr((const char *)credits_line_table[2 * v10], 111) )
          {
            if ( (credits_line_table_flags[2 * v10] & 4) == 0 )
              sfx_play(SLODWORD(sfx_ui_bonus));
            v16 = credits_line_table_flags[2 * v10];
            LOBYTE(v16) = v16 | 4;
            credits_line_table_flags[2 * v10] = v16;
          }
          else
          {
            credits_line_clear_flag(v10);
          }
        }
        v17 = credits_line_table_flags[2 * v10];
        if ( (v17 & 4) != 0 )
        {
          v18 = *(_DWORD *)grim_interface_ptr;
          v34 = v36;
          if ( (v17 & 1) != 0 )
          {
            v33 = 1063675494;
            (*(void (__stdcall **)(int, int))(v18 + 276))(1063675494, 1065353216);
          }
          else
          {
            v33 = 1060320051;
            (*(void (__stdcall **)(int, int))(v18 + 276))(1053609165, 1060320051);
          }
        }
        else
        {
          v19 = *(_DWORD *)grim_interface_ptr;
          v34 = v36;
          if ( (v17 & 1) != 0 )
          {
            v33 = 1065353216;
            (*(void (__stdcall **)(int, int))(v19 + 276))(1065353216, 1065353216);
          }
          else
          {
            v33 = 1060320051;
            (*(void (__stdcall **)(int, int))(v19 + 276))(1053609165, 1056964608);
          }
        }
        v32 = v41 + 140.0 - v37;
        (*(void (__stdcall **)(_DWORD, float, int))(*(_DWORD *)grim_interface_ptr + 324))(
          LODWORD(v32),
          COERCE_FLOAT(LODWORD(v38)),
          credits_line_table[2 * v10]);
        v3 = dword_481184;
        ++v9;
        v35 += 16;
        if ( v9 >= dword_481180 - dword_481184 )
          goto LABEL_51;
      }
      v14 = 1.0 - (v13 - v12) * 0.041666668;
      goto LABEL_30;
    }
LABEL_51:
    credits_back_button = (int)aBack_0;
    v41 = v41 + 100.0;
    v42 = v42 + 250.0;
    ui_button_update(&v41, (int)&credits_back_button);
    v20 = credits_line_table;
    while ( !*v20 || !strchr((const char *)*v20, 111) || (v20[1] & 4) != 0 )
    {
      v20 += 2;
      if ( (int)v20 >= (int)&dword_481180 )
      {
        if ( !credits_secret_unlock_flag )
        {
          v21 = credits_secret_line_base_index;
          v22 = credits_secret_line_base_index;
          credits_secret_unlock_flag = 1;
          credits_line_table_flags[2 * credits_secret_line_base_index] |= 4u;
          v23 = dword_48098C[2 * v22++];
          credits_line_table_flags[2 * v22] = v23 | 4;
          v24 = dword_48098C[2 * v22++];
          credits_line_table_flags[2 * v22] = v24 | 4;
          v25 = dword_48098C[2 * v22++];
          credits_line_table_flags[2 * v22] = v25 | 4;
          v26 = dword_48098C[2 * v22++];
          credits_line_table_flags[2 * v22] = v26 | 4;
          v27 = dword_48098C[2 * v22++];
          credits_line_table_flags[2 * v22] = v27 | 4;
          v28 = dword_48098C[2 * v22++];
          credits_line_table_flags[2 * v22] = v28 | 4;
          v29 = dword_48098C[2 * v22++];
          credits_line_table_flags[2 * v22] = v29 | 4;
          v30 = dword_48098C[2 * v22++];
          credits_line_table_flags[2 * v22] = v30 | 4;
          dword_48098C[2 * v22] |= 4u;
          credits_line_table[2 * v21++] = (int)strdup_malloc(aInsideDeadLetM);
          credits_line_table[2 * v21++] = (int)strdup_malloc(aDoFirepowerSee);
          credits_line_table[2 * v21++] = (int)strdup_malloc(aTheSacrificeOl);
          credits_line_table[2 * v21++] = (int)strdup_malloc(aYourselfGround);
          credits_line_table[2 * v21++] = (int)strdup_malloc(aTriangleCubeLa);
          credits_line_table[2 * v21++] = (int)strdup_malloc(a00010011100000);
          credits_line_table[2 * v21++] = (int)strdup_malloc(a01010010111000);
          credits_line_table[2 * v21++] = (int)strdup_malloc(a01111100100011);
          credits_line_table[2 * v21] = (int)strdup_malloc(a4BitsForIndexO);
          crt_free((void *)ptr[2 * v21]);
          credits_line_table[2 * v21 + 2] = (int)strdup_malloc(a4BitsForIndex);
        }
        v43 = v41 + 94.0;
        v44 = v42;
        ui_button_update(&v43, (int)&credits_secret_button);
        break;
      }
    }
  }
LABEL_7:
  if ( credits_back_button_clicked )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
    nullsub_72();
  }
  if ( credits_secret_button_clicked )
  {
    ui_transition_direction = 0;
    game_state_pending = 26;
    nullsub_72();
  }
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1) )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
    nullsub_72();
  }
}

// nullsub_19 @ 0x0040DF50
void __cdecl nullsub_19()
{
  ;
}

// nullsub_20 @ 0x0040DF60
void __cdecl nullsub_20()
{
  ;
}

// nullsub_105 @ 0x0040DF80
void nullsub_105()
{
  ;
}

// mod_api_init @ 0x0040DFA0
// initializes the mod API context (writes mod_api_context.vtable = &mod_api_vtable at 0x0046f3e4; see cl_mod_sdk_v1/ClMod.h)
void mod_api_init()
{
  mod_api_context = (int)&mod_api_vtable;
  dword_481AE8 = 1;
}

// mod_api_core_printf @ 0x0040E000
// mod API vtable 0x00: clAPI_t::CORE_Printf (writes to OutputDebugStringA)
void mod_api_core_printf(const char *fmt, ...)
{
  char Buffer[4092]; // [esp+0h] [ebp-FFCh] BYREF
  va_list ArgList; // [esp+1004h] [ebp+8h] BYREF

  va_start(ArgList, fmt);
  crt_vsprintf(Buffer, (char *)fmt, ArgList);
  OutputDebugStringA(Buffer);
}

// mod_api_core_get_var @ 0x0040E040
// mod API vtable 0x04: clAPI_t::CORE_GetVar (returns a 3-pointer var_t view: id/stringValue/floatValue)
char **__stdcall sub_40E040(char *Source)
{
  char **v1; // eax
  char *v2; // edx

  v1 = (char **)console_cvar_find(&console_log_queue, Source);
  if ( !v1 )
    v1 = console_register_cvar((char ***)&console_log_queue, Source, value);
  v2 = *v1;
  v1[8] = (char *)(v1 + 3);
  v1[6] = v2;
  v1[7] = v1[4];
  return v1 + 6;
}

// mod_api_core_del_var @ 0x0040E080
// mod API vtable 0x08: clAPI_t::CORE_DelVar
unsigned __int8 mod_api_core_del_var(const char *id)
{
  return console_cvar_unregister((char *)id);
}

// mod_api_core_execute @ 0x0040E0A0
// mod API vtable 0x0c: clAPI_t::CORE_Execute
void mod_api_core_execute(const char *string)
{
  console_exec_line((char *)string);
}

// mod_api_core_add_command @ 0x0040E0C0
// mod API vtable 0x10: clAPI_t::CORE_AddCommand
void mod_api_core_add_command(const char *id, void (*cmd)())
{
  console_register_command((char *)id, cmd);
}

// mod_api_core_del_command @ 0x0040E0E0
// mod API vtable 0x14: clAPI_t::CORE_DelCommand
unsigned __int8 mod_api_core_del_command(const char *id)
{
  return console_command_unregister((char *)id);
}

// mod_api_core_get_extension @ 0x0040E100
// mod API vtable 0x18: clAPI_t::CORE_GetExtension (handles "grimgfx", "grimsfx", "IDirect3D8")
void *mod_api_core_get_extension(const char *ext)
{
  _BYTE v2[16]; // [esp+Ch] [ebp-10h] BYREF

  if ( !strcmp(ext, aGrimgfx) )
    return (void *)grim_interface_ptr;
  if ( !strcmp(ext, aGrimsfx) || strcmp(ext, aIdirect3d8) )
    return 0;
  return *(void **)((*(int (__thiscall **)(int, _BYTE *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                      grim_interface_ptr,
                      v2,
                      81)
                  + 12);
}

// mod_api_gfx_clear @ 0x0040E1F0
// mod API vtable 0x1c: clAPI_t::GFX_Clear (bridges to grim_clear_color)
void mod_api_gfx_clear(float r, float g, float b, float a)
{
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 44))(
    grim_interface_ptr,
    LODWORD(r),
    LODWORD(g),
    LODWORD(b),
    LODWORD(a));
}

// mod_api_gfx_get_string_width @ 0x0040E220
// mod API vtable 0x20: clAPI_t::GFX_GetStringWidth (bridges to grim_measure_text_width)
int mod_api_gfx_get_string_width(const char *string)
{
  return (*(int (__thiscall **)(int, const char *))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, string);
}

// mod_api_gfx_printf @ 0x0040E240
// mod API vtable 0x24: clAPI_t::GFX_Printf
void mod_api_gfx_printf(float x, float y, const char *fmt, ...)
{
  char *Format; // [esp+10h] [ebp+10h]
  va_list ArgList; // [esp+14h] [ebp+14h] BYREF

  va_start(ArgList, fmt);
  Format = va_arg(ArgList, char *);
  crt_vsprintf(byte_4D9D00, Format, ArgList);
  (*(void (__thiscall **)(int, _DWORD, const char *, char *))(*(_DWORD *)grim_interface_ptr + 324))(
    grim_interface_ptr,
    LODWORD(y),
    fmt,
    byte_4D9D00);
}

// mod_api_gfx_load_texture @ 0x0040E280
// mod API vtable 0x28: clAPI_t::GFX_LoadTexture (loads under mods\\ and prefixes CLM_)
int mod_api_gfx_load_texture(const char *filename)
{
  char Buffer[260]; // [esp+4h] [ebp-208h] BYREF
  char dst[260]; // [esp+108h] [ebp-104h] BYREF

  crt_sprintf(Buffer, "mods\\%s", filename);
  crt_sprintf(dst, "CLM_%s", filename);
  return texture_get_or_load(dst, Buffer);
}

// mod_api_gfx_free_texture @ 0x0040E2E0
// mod API vtable 0x2c: clAPI_t::GFX_FreeTexture (bridges to grim_destroy_texture)
unsigned __int8 mod_api_gfx_free_texture(int texId)
{
  (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 188))(grim_interface_ptr, texId);
  return 1;
}

// mod_api_gfx_set_texture @ 0x0040E300
// mod API vtable 0x30: clAPI_t::GFX_SetTexture (bridges to grim_bind_texture(handle, 0))
void mod_api_gfx_set_texture(int texId)
{
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, texId, 0);
}

// mod_api_gfx_set_color @ 0x0040E320
// mod API vtable 0x3c: clAPI_t::GFX_SetColor (bridges to grim_set_color)
void mod_api_gfx_set_color(float r, float g, float b, float a)
{
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    LODWORD(r),
    LODWORD(g),
    LODWORD(b),
    LODWORD(a));
}

// mod_api_gfx_set_subset @ 0x0040E350
// mod API vtable 0x40: clAPI_t::GFX_SetSubset (bridges to grim_set_uv)
void mod_api_gfx_set_subset(float x1, float y1, float x2, float y2)
{
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    LODWORD(x1),
    LODWORD(y1),
    LODWORD(x2),
    LODWORD(y2));
}

// mod_api_gfx_set_texture_filter @ 0x0040E380
// mod API vtable 0x34: clAPI_t::GFX_SetTextureFilter (bridges to grim_set_config_var(21, filter))
void mod_api_gfx_set_texture_filter(int filter)
{
  (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 21, filter);
}

// mod_api_gfx_set_blend_mode @ 0x0040E3A0
// mod API vtable 0x38: clAPI_t::GFX_SetBlendMode (bridges to grim_set_config_var(19, src) and (20, dst))
void mod_api_gfx_set_blend_mode(int src, int dst)
{
  int v2; // [esp+4h] [ebp-Ch]
  int v3; // [esp+8h] [ebp-8h]
  int v4; // [esp+Ch] [ebp-4h]

  (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 20, dst);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    src,
    v2,
    v3,
    v4);
}

// mod_api_gfx_begin @ 0x0040E3E0
// mod API vtable 0x44: clAPI_t::GFX_Begin (bridges to grim_begin_batch)
void mod_api_gfx_begin()
{
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  byte_4824D0 = 1;
}

// mod_api_gfx_end @ 0x0040E400
// mod API vtable 0x48: clAPI_t::GFX_End (bridges to grim_end_batch)
void mod_api_gfx_end()
{
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  byte_4824D0 = 0;
}

// mod_api_gfx_quad @ 0x0040E420
// mod API vtable 0x4c: clAPI_t::GFX_Quad (bridges to grim_draw_quad)
void mod_api_gfx_quad(float x, float y, float w, float h)
{
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    LODWORD(x),
    LODWORD(y),
    LODWORD(w),
    LODWORD(h));
  if ( !byte_4824D0 )
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
}

// mod_api_gfx_quad_rot @ 0x0040E470
// mod API vtable 0x50: clAPI_t::GFX_QuadRot
void mod_api_gfx_quad_rot(float x, float y, float w, float h, float a)
{
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, LODWORD(a));
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 292))(
    grim_interface_ptr,
    LODWORD(x),
    LODWORD(y),
    LODWORD(w),
    LODWORD(h));
  if ( !byte_4824D0 )
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
}

// mod_api_gfx_draw_quads @ 0x0040E4C0
// mod API vtable 0x54: clAPI_t::GFX_DrawQuads
char __stdcall sub_40E4C0(int a1, int a2)
{
  char result; // al
  _DWORD v3[2]; // [esp+0h] [ebp-8h] BYREF

  if ( !byte_4824D0 )
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v3[0] = 0;
  v3[1] = 0;
  (*(void (__thiscall **)(int, int, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 300))(
    grim_interface_ptr,
    a1,
    a2,
    v3);
  result = byte_4824D0;
  if ( !byte_4824D0 )
    return (*(int (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  return result;
}

// mod_api_sfx_load_sample @ 0x0040E530
// mod API vtable 0x58: clAPI_t::SFX_LoadSample (loads under mods\\)
int mod_api_sfx_load_sample(const char *filename)
{
  char Buffer[260]; // [esp+0h] [ebp-104h] BYREF

  crt_sprintf(Buffer, "mods\\%s", filename);
  return sfx_load_sample(Buffer);
}

// mod_api_sfx_free_sample @ 0x0040E560
// mod API vtable 0x5c: clAPI_t::SFX_FreeSample
unsigned __int8 mod_api_sfx_free_sample(int sfxId)
{
  return sfx_release_sample(sfxId);
}

// mod_api_sfx_play_sample @ 0x0040E570
// mod API vtable 0x60: clAPI_t::SFX_PlaySample
void mod_api_sfx_play_sample(int sfxId, float pan, float volume)
{
  sfx_play_panned(*(float *)&sfxId);
}

// mod_api_sfx_load_tune @ 0x0040E5B0
// mod API vtable 0x64: clAPI_t::SFX_LoadTune (loads under mods\\)
int mod_api_sfx_load_tune(const char *filename)
{
  char Buffer[260]; // [esp+0h] [ebp-104h] BYREF

  crt_sprintf(Buffer, "mods\\%s", filename);
  return music_load_track(Buffer);
}

// mod_api_sfx_free_tune @ 0x0040E5E0
// mod API vtable 0x68: clAPI_t::SFX_FreeTune
unsigned __int8 mod_api_sfx_free_tune(int tuneId)
{
  return music_release_track(tuneId);
}

// mod_api_sfx_play_tune @ 0x0040E5F0
// mod API vtable 0x6c: clAPI_t::SFX_PlayTune
void mod_api_sfx_play_tune(int tuneId)
{
  sfx_play_exclusive(tuneId);
}

// mod_api_sfx_stop_tune @ 0x0040E600
// mod API vtable 0x70: clAPI_t::SFX_StopTune
void mod_api_sfx_stop_tune(int tuneId)
{
  sfx_mute_all(tuneId);
}

// mod_api_inp_get_pressed_char @ 0x0040E610
// mod API vtable 0x7c: clAPI_t::INP_GetPressedChar (bridges to grim_get_key_char)
char mod_api_inp_get_pressed_char()
{
  return (*(char (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 80))(grim_interface_ptr);
}

// mod_api_inp_get_analog @ 0x0040E620
// mod API vtable 0x78: clAPI_t::INP_GetAnalog
float mod_api_inp_get_analog(int key)
{
  if ( key == 355 )
  {
    return ui_mouse_x;
  }
  else if ( key == 356 )
  {
    return ui_mouse_y;
  }
  else
  {
    return (*(float (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 132))(grim_interface_ptr, key);
  }
}

// mod_api_inp_key_down @ 0x0040E660
// mod API vtable 0x74: clAPI_t::INP_KeyDown (uses grim_is_key_active)
unsigned __int8 mod_api_inp_key_down(int key)
{
  if ( key == 1 )
    return 0;
  else
    return (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(grim_interface_ptr, key);
}

// mod_api_inp_get_key_name @ 0x0040E680
// mod API vtable 0x80: clAPI_t::INP_GetKeyName
char *mod_api_inp_get_key_name(int key)
{
  return input_key_name(key);
}

// mod_api_cl_enter_menu @ 0x0040E690
// mod API vtable 0x84: clAPI_t::CL_EnterMenu (only handles "game_pause")
void mod_api_cl_enter_menu(const char *menu)
{
  if ( menu && !strcmp(aGamePause, menu) )
  {
    if ( plugin_interface_ptr )
      *(_BYTE *)(plugin_interface_ptr + 9) = 1;
    ui_transition_direction = 0;
    game_state_pending = 5;
  }
}

// mod_load_info @ 0x0040E700
// loads mods\%s, calls CMOD_GetInfo, copies the info struct to DAT_00481c88, and returns it
void *mod_load_info()
{
  HMODULE LibraryA; // eax
  int (*CMOD_GetInfo)(void); // esi
  const void *v3; // eax
  CHAR LibFileName[512]; // [esp+4h] [ebp-200h] BYREF
  const char *v5; // [esp+208h] [ebp+4h]

  crt_sprintf(LibFileName, "mods\\%s", v5);
  console_printf(&console_log_queue, "CMOD: '%s'\n", LibFileName);
  LibraryA = LoadLibraryA(LibFileName);
  hLibModule = LibraryA;
  if ( LibraryA )
  {
    CMOD_GetInfo = GetProcAddress(LibraryA, ProcName);
    if ( CMOD_GetInfo )
    {
      if ( (byte_4819C8 & 1) == 0 )
      {
        dword_481CC8 = 1065353216;
        dword_481CCC = 3;
        memset(mod_info_block, 0, sizeof(mod_info_block));
        memset(&unk_481CA8, 0, 0x20u);
        byte_4819C8 |= 1u;
        crt_atexit(nullsub_21);
      }
      v3 = (const void *)CMOD_GetInfo();
      if ( v3 )
        qmemcpy(mod_info_block, v3, 0x48u);
      else
        console_printf(&console_log_queue, aCmodBadCmodGet);
      FreeLibrary(hLibModule);
      console_printf(&console_log_queue, "CMOD: mod enum '%s'\n", mod_info_block);
      return mod_info_block;
    }
    else
    {
      console_printf(&console_log_queue, aCmodGetinfoFai);
      FreeLibrary(hLibModule);
      return 0;
    }
  }
  else
  {
    console_printf(&console_log_queue, aCmodLoadLibrar);
    return 0;
  }
}

// nullsub_21 @ 0x0040E850
void __cdecl nullsub_21()
{
  ;
}

// mod_load_mod @ 0x0040E860
// loads mods\%s, calls CMOD_GetMod, wires the mod context (offset +4), and returns the mod interface pointer
void *mod_load_mod()
{
  HMODULE LibraryA; // eax
  int (*CMOD_GetMod)(void); // eax
  int v3; // eax
  void *v4; // esi
  CHAR LibFileName[512]; // [esp+0h] [ebp-200h] BYREF
  const char *v6; // [esp+204h] [ebp+4h]

  crt_sprintf(LibFileName, "mods\\%s", v6);
  console_printf(&console_log_queue, "CMOD: '%s'\n", LibFileName);
  LibraryA = LoadLibraryA(LibFileName);
  hLibModule = LibraryA;
  if ( LibraryA )
  {
    CMOD_GetMod = GetProcAddress(LibraryA, aCmodGetmod);
    if ( CMOD_GetMod )
    {
      v3 = CMOD_GetMod();
      v4 = (void *)v3;
      if ( v3 )
        *(_DWORD *)(v3 + 4) = &mod_api_context;
      else
        console_printf(&console_log_queue, aCmodBadCmodGet_0);
      console_printf(&console_log_queue, aCmodGetmodOk);
      return v4;
    }
    else
    {
      console_printf(&console_log_queue, aCmodCmodGetmod);
      FreeLibrary(hLibModule);
      return 0;
    }
  }
  else
  {
    console_printf(&console_log_queue, aCmodLoadLibrar);
    return 0;
  }
}

// mods_any_available @ 0x0040E940
// returns true if any mods\*.dll exist
bool mods_any_available()
{
  int v0; // edi
  HANDLE v1; // esi
  int v4; // [esp+0h] [ebp-120h] BYREF
  uint finddata[5]; // [esp+8h] [ebp-118h] BYREF

  v0 = 0;
  v1 = crt_findfirst(pattern, finddata);
  if ( v1 != (HANDLE)-1 && &v4 != (int *)-28 )
  {
    do
      ++v0;
    while ( !crt_findnext(v1, finddata) );
  }
  crt_findclose(v1);
  return v0 != 0;
}

// sub_40E9A0 @ 0x0040E9A0
int sub_40E9A0()
{
  int v0; // edx
  intptr_t v1; // ebp
  int v2; // edx
  char *v3; // ebp
  char *v4; // edi
  int v5; // eax
  int v6; // esi
  int v7; // esi
  int v8; // esi
  int v9; // esi
  _DWORD *v10; // ecx
  int *v11; // eax
  int v12; // edx
  int result; // eax
  float v14; // [esp+FCh] [ebp-164h]
  float v15; // [esp+FCh] [ebp-164h]
  float v16; // [esp+FCh] [ebp-164h]
  int v17; // [esp+100h] [ebp-160h]
  float v18; // [esp+100h] [ebp-160h]
  int v19; // [esp+100h] [ebp-160h]
  float v20; // [esp+100h] [ebp-160h]
  int v21; // [esp+104h] [ebp-15Ch]
  float v22; // [esp+104h] [ebp-15Ch]
  int v23; // [esp+104h] [ebp-15Ch]
  float v24; // [esp+104h] [ebp-15Ch]
  double v25; // [esp+108h] [ebp-158h] BYREF
  float v26; // [esp+11Ch] [ebp-144h] BYREF
  float v27; // [esp+120h] [ebp-140h]
  float v28; // [esp+124h] [ebp-13Ch]
  float v29; // [esp+128h] [ebp-138h] BYREF
  float v30; // [esp+12Ch] [ebp-134h] BYREF
  float v31; // [esp+130h] [ebp-130h]
  float v32; // [esp+134h] [ebp-12Ch]
  char v33[4]; // [esp+138h] [ebp-128h] BYREF
  int v34; // [esp+13Ch] [ebp-124h]
  int v35; // [esp+140h] [ebp-120h]
  int v36; // [esp+144h] [ebp-11Ch]
  int v37; // [esp+148h] [ebp-118h] BYREF
  char Buffer[16]; // [esp+14Ch] [ebp-114h] BYREF
  char v39[260]; // [esp+15Ch] [ebp-104h] BYREF

  v27 = flt_489DFC + flt_48A138;
  v31 = flt_48A134 + flt_489DF8 + 300.0;
  v32 = v27 + 40.0;
  v26 = flt_489DE8 - 240.0 + v31 + 64.0;
  v31 = v26;
  v27 = v32 + 4.0;
  v0 = *(_DWORD *)grim_interface_ptr;
  v32 = v27;
  (*(void (__thiscall **)(int, int, int, int, int))(v0 + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1065353216,
    v17,
    v21,
    LODWORD(v25));
  v22 = v27 - 8.0;
  v18 = v26 - 16.0 + 144.0;
  (*(void (__stdcall **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 320))(
    grim_interface_ptr,
    LODWORD(v18),
    LODWORD(v22),
    aMods);
  v25 = 0.00003051757812500016;
  (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 24);
  v27 = v27 + 32.0;
  if ( byte_472EE8 )
  {
    dword_4824DC = 0;
    v1 = crt_findfirst(pattern, (int)&v37);
    v28 = *(float *)&v1;
    if ( v1 != -1 && (double *)((char *)&v25 + 4) != (double *)-80 )
    {
      do
      {
        v2 = dword_4824DC;
        if ( dword_4824DC == 31 )
        {
          dword_481B84 = (int)byte_482490;
          strcpy(byte_481988, aMore);
          strcpy(byte_482490, aMore);
        }
        else
        {
          strcpy(&byte_4811C8[64 * dword_4824DC], v39);
          v3 = (char *)&unk_481CD0 + 64 * v2;
          v4 = mod_load_info(v39);
          v5 = dword_4824DC;
          strcpy(v3, v4);
          dword_481B04[++v5] = (int)v3;
          v1 = LODWORD(v28);
          dword_4824DC = v5;
        }
      }
      while ( !crt_findnext((HANDLE)v1, (int)&v37) );
    }
    crt_findclose(v1);
    byte_472EE8 = 0;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  (*(void (__thiscall **)(int, int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v19,
    v23,
    LODWORD(v25));
  if ( (byte_481BB8 & 1) == 0 )
  {
    dword_481BE8 = 0;
    byte_481BB8 |= 1u;
    dword_481BEC = 0;
    crt_atexit(nullsub_24);
  }
  dword_481C08 = (int)&unk_481B08;
  dword_481C0C = dword_4824DC;
  dword_481BE4 = 5;
  v26 = v26 + 4.0;
  v27 = v27 + 6.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1056964608);
  v24 = v27 - 14.0;
  (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v26)),
    LODWORD(v24),
    aListOfMods);
  ui_scrollbar_update(&v26, &state);
  if ( dword_481BE0 != dword_472EEC )
  {
    dword_472EEC = dword_481BE0;
    dword_4824E0 = (int)mod_load_info(&byte_4811C8[64 * dword_481BE0]);
  }
  v27 = v27 + 104.0;
  if ( dword_4824E0 )
  {
    (*(void (__thiscall **)(int, int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1056964608,
      HIDWORD(v25));
    v34 = dword_4965F8;
    v35 = dword_4965FC;
    v28 = v28 + 8.0;
    v36 = dword_496600;
    v37 = 1065353216;
    v25 = 0.007187501520093065;
    v27 = v27 + 12.0 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065185444);
    HIDWORD(v25) = dword_4824E0;
    (*(void (__cdecl **)(int, float, float))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v27)),
      COERCE_FLOAT(LODWORD(v28)));
    crt_sprintf(Buffer, "v%.2f", *(float *)(dword_4824E0 + 64));
    v6 = *(_DWORD *)grim_interface_ptr;
    HIDWORD(v25) = Buffer;
    v29 = v27 + 192.0;
    v29 = COERCE_FLOAT(
            (*(int (__thiscall **)(int, char *, float, char *, char *))(v6 + 332))(
              grim_interface_ptr,
              Buffer,
              COERCE_FLOAT(LODWORD(v28)),
              aS_0,
              Buffer));
    v14 = v28 - (double)SLODWORD(v29);
    (*(void (__cdecl **)(int, _DWORD))(v6 + 328))(grim_interface_ptr, LODWORD(v14));
    v27 = v27 + 14.0;
    (*(void (__thiscall **)(int, char *, _DWORD))(*(_DWORD *)grim_interface_ptr + 272))(
      grim_interface_ptr,
      v33,
      HIDWORD(v25));
    v25 = 0.007812501958142093;
    v30 = v27 - 4.0;
    v31 = v28;
    (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
      grim_interface_ptr,
      &v30,
      1128792064,
      1065353216);
    v25 = 0.0000008964540247902164;
    v28 = v28 - 2.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1051595899);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v27)),
      COERCE_FLOAT(LODWORD(v28)),
      aName);
    v7 = *(_DWORD *)grim_interface_ptr;
    HIDWORD(v25) = src;
    v29 = v27 + 192.0;
    v29 = COERCE_FLOAT(
            (*(int (__thiscall **)(int, char *, float, char *))(v7 + 332))(
              grim_interface_ptr,
              src,
              COERCE_FLOAT(LODWORD(v28)),
              src));
    v20 = v28 - (double)SLODWORD(v29);
    (*(void (__cdecl **)(int, _DWORD))(v7 + 328))(grim_interface_ptr, LODWORD(v20));
    (*(void (__thiscall **)(int, int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051,
      HIDWORD(v25));
    HIDWORD(v25) = aAuthorS;
    v28 = v28 + 22.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v27)),
      COERCE_FLOAT(LODWORD(v28)),
      aAuthorS);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1064682127);
    v8 = *(_DWORD *)grim_interface_ptr;
    HIDWORD(v25) = dword_4824E0 + 32;
    v29 = v27 + 192.0;
    v29 = COERCE_FLOAT(
            (*(int (__thiscall **)(int, int, float, char *, int))(v8 + 332))(
              grim_interface_ptr,
              dword_4824E0 + 32,
              COERCE_FLOAT(LODWORD(v28)),
              aS_0,
              dword_4824E0 + 32));
    v15 = v28 - (double)SLODWORD(v29);
    (*(void (__cdecl **)(int, _DWORD))(v8 + 328))(grim_interface_ptr, LODWORD(v15));
    v27 = v27 + 15.0;
    (*(void (__thiscall **)(int, int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051,
      HIDWORD(v25));
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v27)),
      COERCE_FLOAT(LODWORD(v28)),
      aFilename);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1064682127);
    v9 = *(_DWORD *)grim_interface_ptr;
    v29 = v27 + 192.0;
    v29 = COERCE_FLOAT(
            (*(int (__thiscall **)(int, char *, float, char *, char *))(v9 + 332))(
              grim_interface_ptr,
              &byte_4811C8[64 * dword_481BE0],
              COERCE_FLOAT(LODWORD(v28)),
              aS_0,
              &byte_4811C8[64 * dword_481BE0]));
    v16 = v28 - (double)SLODWORD(v29);
    (*(void (__cdecl **)(int, _DWORD))(v9 + 328))(grim_interface_ptr, LODWORD(v16));
    v27 = v27 + 15.0;
    if ( *(_DWORD *)(dword_4824E0 + 68) != 3 )
    {
      (*(void (__thiscall **)(int, int, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        0,
        0,
        1065353216);
      (*(void (__cdecl **)(int, float, float, char *, int))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v26)),
        COERCE_FLOAT(LODWORD(v27)),
        aUnsupportedApi,
        dword_4824E0 + 32);
    }
    v27 = v27 + 15.0 + 15.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1058642330);
    v26 = v26 - 16.0 - 16.0;
    v27 = v27 + 32.0;
  }
  if ( (byte_481BB8 & 2) == 0 )
  {
    byte_481AF6 = 1;
    byte_481BB8 |= 2u;
    LOWORD(dword_481B04[0]) = 0;
    dword_481B00 = 1065353216;
    dword_481AFC = 0;
    dword_481AF0 = 0;
    byte_481AF4 = 0;
    byte_481AF5 = 0;
    dword_481AF8 = 0;
    crt_atexit(nullsub_23);
  }
  dword_481AF0 = (int)aMainMenu_0;
  if ( (byte_481BB8 & 4) == 0 )
  {
    byte_481B8E = 1;
    byte_481BB8 |= 4u;
    byte_481B9D = 0;
    byte_481B9C = 0;
    dword_481B98 = 1065353216;
    dword_481B94 = 0;
    dword_481B88 = 0;
    byte_481B8C = 0;
    byte_481B8D = 0;
    dword_481B90 = 0;
    crt_atexit(nullsub_22);
  }
  dword_481B88 = (int)aLaunch;
  if ( dword_4824E0 )
  {
    if ( *(_DWORD *)(dword_4824E0 + 68) == 3 )
    {
      v29 = v31 + 58.0;
      v30 = v32 + 232.0;
      if ( (unsigned __int8)ui_button_update(&v29, &dword_481B88) )
      {
        if ( dword_481BE0 >= 0 )
        {
          plugin_interface_ptr = mod_load_mod(&byte_4811C8[64 * dword_481BE0]);
          if ( plugin_interface_ptr )
          {
            game_state_pending = 22;
            ui_transition_direction = 0;
            v10 = &unk_481A90;
            v11 = &player_move_key_backward;
            do
            {
              v12 = *(v11 - 1);
              v11 += 216;
              *(v10 - 2) = v12;
              *v10 = *(v11 - 216);
              v10[2] = *(v11 - 215);
              v10[4] = *(v11 - 214);
              v10[6] = *(v11 - 213);
              v10[8] = *(v11 - 210);
              v10[10] = *(v11 - 209);
              v10[12] = *(v11 - 208);
              v10[14] = *(v11 - 207);
              v10[16] = *(v11 - 206);
              v10[18] = *(v11 - 205);
              ++v10;
            }
            while ( (int)v11 < (int)dword_4912A0 );
            dword_481AE0 = config_key_pick_perk;
            dword_481AE4 = config_key_reload;
          }
        }
      }
    }
  }
  v29 = v31 + 58.0;
  v30 = v32 + 266.0;
  result = ui_button_update(&v29, &dword_481AF0);
  if ( (_BYTE)result )
  {
    ui_transition_direction = 0;
    game_state_pending = 0;
    byte_472EE8 = 1;
  }
  return result;
}

// nullsub_22 @ 0x0040F3D0
void __cdecl nullsub_22()
{
  ;
}

// nullsub_23 @ 0x0040F3E0
void __cdecl nullsub_23()
{
  ;
}

// nullsub_24 @ 0x0040F3F0
void __cdecl nullsub_24()
{
  ;
}

// credits_secret_match3_find @ 0x0040F400
// scans a 6x6 board for a 3-in-a-row match; writes start index (row-major; leftmost/topmost) + orientation (0=vertical, 1=horizontal)
uint credits_secret_match3_find(int *board, int *out_idx, unsigned __int8 *out_dir)
{
  int *v3; // edi
  int *v4; // ebx
  int v5; // edx
  int i; // ecx
  int v7; // eax
  int v8; // esi
  int v9; // ebx
  int v10; // esi
  uint result; // eax
  int v12; // ecx
  int v13; // edx
  int v14; // [esp+10h] [ebp-4h]

  v3 = board;
  v14 = 0;
  v4 = board;
  v5 = 2;
  while ( 2 )
  {
    for ( i = 0; i < 4; ++i )
    {
      v7 = *v4;
      if ( *v4 >= 0 )
      {
        v8 = 1;
        if ( v3[v5 - 1 + i] == v7 )
          v8 = 2;
        if ( v3[v5 + i] == v7 )
          ++v8;
        if ( v8 == 3 )
        {
          result = (uint)out_dir;
          *out_idx = i + 6 * v14;
          *out_dir = 1;
          LOBYTE(result) = 1;
          return result;
        }
      }
      ++v4;
    }
    v5 += 6;
    ++v14;
    v4 = board + 6;
    board += 6;
    if ( v5 < 38 )
      continue;
    break;
  }
  v9 = 0;
  while ( 2 )
  {
    v10 = 0;
    result = (uint)v3;
    do
    {
      v12 = *(_DWORD *)result;
      if ( *(int *)result >= 0 )
      {
        v13 = 1;
        if ( *(_DWORD *)(result + 24) == v12 )
          v13 = 2;
        if ( *(_DWORD *)(result + 48) == v12 )
          ++v13;
        if ( v13 == 3 )
        {
          result = (uint)out_idx;
          *out_idx = v9 + 6 * v10;
          *out_dir = 0;
          LOBYTE(result) = 1;
          return result;
        }
      }
      ++v10;
      result += 24;
    }
    while ( v10 < 4 );
    ++v9;
    ++v3;
    if ( v9 < 6 )
      continue;
    break;
  }
  LOBYTE(result) = 0;
  return result;
}

// credits_secret_alien_zookeeper_update @ 0x0040F4F0
// updates and renders the AlienZooKeeper credits secret; drives match-3 board state and UI
void credits_secret_alien_zookeeper_update()
{
  int v0; // edx
  bool v1; // sf
  int v2; // esi
  int v3; // edi
  int *v4; // esi
  int v5; // ebp
  int v6; // eax
  int v7; // eax
  int v8; // ecx
  bool v9; // zf
  int v10; // eax
  int *v11; // esi
  int v12; // edi
  int *v13; // esi
  int v14; // edi
  float v15; // [esp+144h] [ebp-74h]
  float v16; // [esp+144h] [ebp-74h]
  int v17; // [esp+148h] [ebp-70h]
  float v18; // [esp+148h] [ebp-70h]
  float v19; // [esp+148h] [ebp-70h]
  int v20; // [esp+148h] [ebp-70h]
  float v21; // [esp+148h] [ebp-70h]
  float v22; // [esp+148h] [ebp-70h]
  float v23; // [esp+148h] [ebp-70h]
  int v24; // [esp+148h] [ebp-70h]
  float v25; // [esp+148h] [ebp-70h]
  int v26; // [esp+14Ch] [ebp-6Ch]
  float v27; // [esp+14Ch] [ebp-6Ch]
  float v28; // [esp+14Ch] [ebp-6Ch]
  float v29; // [esp+14Ch] [ebp-6Ch]
  int v30; // [esp+14Ch] [ebp-6Ch]
  int v31; // [esp+14Ch] [ebp-6Ch]
  float v32; // [esp+14Ch] [ebp-6Ch]
  int v33; // [esp+150h] [ebp-68h]
  int v34; // [esp+150h] [ebp-68h]
  int v35; // [esp+150h] [ebp-68h]
  unsigned __int8 out_dir[4]; // [esp+164h] [ebp-54h] BYREF
  int v37; // [esp+168h] [ebp-50h]
  int v38; // [esp+16Ch] [ebp-4Ch]
  int out_idx; // [esp+170h] [ebp-48h] BYREF
  float v40; // [esp+174h] [ebp-44h]
  float v41; // [esp+178h] [ebp-40h] BYREF
  float v42; // [esp+17Ch] [ebp-3Ch]
  int v43; // [esp+180h] [ebp-38h] BYREF
  float v44; // [esp+184h] [ebp-34h]
  float v45; // [esp+188h] [ebp-30h] BYREF
  float v46; // [esp+18Ch] [ebp-2Ch]
  float v47; // [esp+190h] [ebp-28h]
  float v48; // [esp+194h] [ebp-24h]
  float xy; // [esp+198h] [ebp-20h] BYREF
  float v50; // [esp+19Ch] [ebp-1Ch]
  float v51; // [esp+1A4h] [ebp-14h]
  int v52; // [esp+1A8h] [ebp-10h] BYREF
  float v53; // [esp+1ACh] [ebp-Ch]
  int v54; // [esp+1B0h] [ebp-8h]
  int v55; // [esp+1B4h] [ebp-4h]

  v50 = flt_489DFC + flt_489E20;
  *(float *)&v43 = flt_489E1C + flt_489DF8 + 300.0;
  v44 = v50 + 40.0;
  v45 = *(float *)&v43 + flt_489DE8 - 80.0;
  v47 = v45;
  v46 = v44 + 10.0;
  v0 = *(_DWORD *)grim_interface_ptr;
  v48 = v46;
  (*(void (__thiscall **)(int, int, int, int, int))(v0 + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1061997773,
    v17,
    v26,
    v33);
  v27 = v46 - 14.0;
  (*(void (__stdcall **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v45)),
    LODWORD(v27),
    aAlienzookeeper);
  (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 24);
  v28 = v46 + 10.0;
  v18 = v45 + 12.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v18),
    LODWORD(v28),
    aAPuzzleGameUnf);
  v29 = v46 + 23.0;
  v19 = v45 + 18.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v19),
    LODWORD(v29),
    aOrSomethingMor);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1054280253,
    v20,
    v30,
    v34);
  v1 = credits_secret_timer_ms < 0;
  credits_secret_anim_time_ms += frame_dt_ms;
  if ( credits_secret_timer_ms > 0 )
  {
    credits_secret_timer_ms -= frame_dt_ms;
    if ( credits_secret_timer_ms > 0 )
      goto LABEL_6;
    sfx_play(sfx_trooper_die_01);
    v1 = credits_secret_timer_ms < 0;
  }
  if ( v1 )
    credits_secret_timer_ms = 0;
LABEL_6:
  v46 = v46 + 40.0;
  v45 = v45 + 22.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  v21 = v46 - 16.0;
  v15 = v45 + 124.0;
  (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v15),
    LODWORD(v21),
    aScoreD,
    credits_secret_score);
  v52 = 0;
  v53 = 0.0;
  v54 = 0;
  v55 = 1058642330;
  (*(void (__thiscall **)(int, float *, int, int, int *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    &v45,
    1128267776,
    1128267776,
    &v52);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    &v45,
    1128267776,
    1128267776);
  v43 = credits_secret_timer_ms / 100;
  if ( credits_secret_timer_ms / 100 > 192 )
    v43 = 192;
  v41 = v45;
  v42 = v46 + 200.0;
  v52 = 1045220557;
  v53 = 0.60000002;
  v54 = 1065353216;
  v22 = (float)v43;
  v55 = 1058642330;
  (*(void (__thiscall **)(int, float *, _DWORD, int, int *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    &v41,
    LODWORD(v22),
    1086324736,
    &v52);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  *(float *)&v43 = v45;
  v44 = v46 + 200.0;
  (*(void (__thiscall **)(int, int *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    &v43,
    1128267776,
    1086324736);
  v38 = 0;
  v2 = 0;
  do
  {
    v3 = 0;
    v37 = 0;
    do
    {
      if ( credits_secret_selected_index == v2 )
      {
        v52 = 1045220557;
        v50 = (float)v38;
        v53 = 0.40000001;
        v54 = 1060320051;
        v55 = 1053609165;
        v42 = v50 * 32.0;
        v40 = v42 + v46;
        *(float *)&v43 = (double)v37 * 32.0 + v45 + 4.0;
        v44 = v40 + 4.0;
        (*(void (__thiscall **)(int, int *, int, int, int *))(*(_DWORD *)grim_interface_ptr + 208))(
          grim_interface_ptr,
          &v43,
          1103101952,
          1103101952,
          &v52);
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1065353216);
        (*(void (__thiscall **)(int, int *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
          grim_interface_ptr,
          &v43,
          1103101952,
          1103101952);
      }
      ++v3;
      ++v2;
      v37 = v3;
    }
    while ( v3 < 6 );
    ++v38;
  }
  while ( v2 < 36 );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_4827B0, 0);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  v38 = 0;
  *(float *)&v43 = 0.0;
  v41 = 0.0;
  v4 = credits_secret_board;
  do
  {
    v5 = 0;
    v37 = 0;
    out_idx = 0;
    do
    {
      if ( *v4 != -3 )
      {
        (*(void (__stdcall **)(int, int))(*(_DWORD *)grim_interface_ptr + 260))(
          8,
          (credits_secret_anim_time_ms / 50 + 2 * *v4) % 32);
        v6 = *v4;
        if ( *v4 )
        {
          switch ( v6 )
          {
            case 1:
              (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
                grim_interface_ptr,
                1056964608,
                1056964608,
                1065353216,
                1065353216);
              break;
            case 2:
              (*(void (__stdcall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
                1065353216,
                1056964608,
                1065353216,
                1065353216);
              break;
            case 3:
              (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
                grim_interface_ptr,
                1056964608,
                1065353216,
                1065353216,
                1065353216);
              break;
            case 4:
              (*(void (__stdcall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
                1065353216,
                1065353216,
                1056964608,
                1065353216);
              break;
          }
        }
        else
        {
          (*(void (__stdcall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
            1065353216,
            1056964608,
            1056964608,
            1065353216);
        }
        v23 = (double)v43 + v46;
        v16 = (double)out_idx + v45;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v16),
          LODWORD(v23),
          1107296256,
          1107296256);
        if ( credits_secret_timer_ms > 0 )
        {
          v51 = (float)v38;
          v53 = v51 * 32.0;
          xy = (double)v37 * 32.0 + v45;
          v50 = v53 + v46;
          if ( (unsigned __int8)ui_mouse_inside_rect(&xy, 32, 32) )
          {
            if ( (unsigned __int8)input_primary_just_pressed() )
            {
              sfx_play(sfx_ui_clink_01);
              v7 = credits_secret_selected_index;
              if ( credits_secret_selected_index == -1 )
              {
                credits_secret_selected_index = v37 + LODWORD(v41);
              }
              else
              {
                v8 = *v4;
                *v4 = credits_secret_board[credits_secret_selected_index];
                credits_secret_board[v7] = v8;
                credits_secret_selected_index = -1;
                out_idx = 0;
                out_dir[3] = 0;
                if ( (unsigned __int8)credits_secret_match3_find(credits_secret_board, &out_idx, &out_dir[3]) )
                {
                  v9 = out_dir[3] == 0;
                  v10 = out_idx;
                  credits_secret_board[out_idx] = -3;
                  if ( v9 )
                  {
                    credits_secret_match_mask_v0[v10] = -3;
                    credits_secret_match_mask_v1[v10] = -3;
                  }
                  else
                  {
                    credits_secret_match_mask_h0[v10] = -3;
                    credits_secret_match_mask_h1[v10] = -3;
                  }
                  ++credits_secret_score;
                  sfx_play(SLODWORD(sfx_ui_bonus));
                  credits_secret_timer_ms += 2000;
                }
              }
            }
          }
        }
      }
      v5 += 32;
      ++v4;
      ++v37;
      out_idx = v5;
    }
    while ( v5 < 192 );
    ++v38;
    LODWORD(v41) += 6;
    v43 += 32;
  }
  while ( (int)v4 < (int)&dword_481A7C );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  if ( !credits_secret_timer_ms )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1065353216,
      v24,
      v31,
      v35);
    if ( cos((double)credits_secret_anim_time_ms * 0.0049999999) > 0.0 )
    {
      v32 = v46 + 96.0 - 22.0;
      v25 = v45 + 38.0;
      (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v25),
        LODWORD(v32),
        aGameOver);
    }
  }
  v11 = credits_secret_board;
  do
  {
    v12 = 6;
    do
    {
      if ( *v11 == -1 )
        *v11 = crt_rand() % 5;
      ++v11;
      --v12;
    }
    while ( v12 );
  }
  while ( (int)v11 < (int)&dword_481A7C );
  if ( (credits_secret_flags & 1) == 0 )
  {
    byte_4819D6 = 1;
    credits_secret_flags |= 1u;
    byte_4819E5 = 0;
    byte_4819E4 = 0;
    dword_4819E0 = 1065353216;
    dword_4819DC = 0;
    credits_secret_reset_button = 0;
    byte_4819D4 = 0;
    byte_4819D5 = 0;
    dword_4819D8 = 0;
    crt_atexit(nullsub_26);
  }
  credits_secret_reset_button = (int)aReset;
  xy = v47 + 38.0;
  v41 = v48 + 256.0;
  v50 = v41;
  if ( ui_button_update(&xy, (int)&credits_secret_reset_button) )
  {
    *(float *)&v43 = 0.0;
    out_dir[3] = 0;
    do
    {
      v13 = credits_secret_board;
      do
      {
        v14 = 6;
        do
        {
          ++v13;
          --v14;
          *(v13 - 1) = crt_rand() % 5;
        }
        while ( v14 );
      }
      while ( (int)v13 < (int)&dword_481A7C );
    }
    while ( (unsigned __int8)credits_secret_match3_find(credits_secret_board, &v43, &out_dir[3]) );
    credits_secret_selected_index = -1;
    credits_secret_score = 0;
    credits_secret_timer_ms = 9600;
  }
  if ( (credits_secret_flags & 2) == 0 )
  {
    byte_481BC6 = 1;
    credits_secret_flags |= 2u;
    byte_481BD5 = 0;
    byte_481BD4 = 0;
    dword_481BD0 = 1065353216;
    dword_481BCC = 0;
    credits_secret_back_button = 0;
    byte_481BC4 = 0;
    byte_481BC5 = 0;
    dword_481BC8 = 0;
    crt_atexit(nullsub_25);
  }
  xy = v47 + 138.0;
  credits_secret_back_button = (int)aBack_0;
  v50 = v41;
  if ( ui_button_update(&xy, (int)&credits_secret_back_button) )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
  }
}

// nullsub_25 @ 0x0040FF30
void __cdecl nullsub_25()
{
  ;
}

// nullsub_26 @ 0x0040FF40
void __cdecl nullsub_26()
{
  ;
}

// FUN_0040ff50 @ 0x0040FF50
// [binja] int32_t sub_40ff50(int32_t arg1)
int FUN_0040ff50(int arg1)
{
  int v2; // [esp+0h] [ebp-4h]

  v2 = arg1 % 60;
  if ( arg1 % 60 >= 10 )
    crt_sprintf(byte_482624, "%d:%d", arg1 / 60, v2);
  else
    crt_sprintf(byte_482624, "%d:0%d", arg1 / 60, v2);
  return (int)byte_482624;
}

// game_over_screen_update @ 0x0040FFC0
// game over flow: high score entry, results text, and navigation buttons
void game_over_screen_update()
{
  signed int v0; // eax
  unsigned int v1; // kr08_4
  double v2; // st7
  double v3; // st7
  float v4; // [esp+0h] [ebp-38h]
  float v5; // [esp+4h] [ebp-34h]
  int xy; // [esp+20h] [ebp-18h] BYREF
  float v7; // [esp+24h] [ebp-14h]
  int input_state; // [esp+28h] [ebp-10h] BYREF
  float v9; // [esp+2Ch] [ebp-Ch]
  float v10; // [esp+30h] [ebp-8h]
  float v11; // [esp+34h] [ebp-4h]

  if ( (byte_4825FC & 1) == 0 )
  {
    byte_4825AE = 1;
    byte_4825FC |= 1u;
    byte_4825BD = 0;
    byte_4825BC = 0;
    dword_4825B8 = 1065353216;
    dword_4825B4 = 0;
    dword_4825A8 = 0;
    byte_4825AC = 0;
    byte_4825AD = 0;
    dword_4825B0 = 0;
    crt_atexit(nullsub_31);
  }
  if ( (byte_4825FC & 2) == 0 )
  {
    dword_4825A0 = 1065353216;
    byte_4825FC |= 2u;
    ::input_state = (int)byte_48256C;
    dword_482594 = 0;
    dword_482598 = 24;
    dword_48259C = 96;
    crt_atexit(nullsub_30);
  }
  bonus_reflex_boost_timer = 0.0;
  if ( ui_transition_direction && byte_48724D )
  {
    byte_48724D = 0;
    dword_487234 = 1;
  }
  if ( game_state_id == 7
    && game_state_pending == 25
    && ui_transition_direction
    && !(unsigned __int8)sfx_is_unmuted(music_track_shortie_monk_id) )
  {
    sfx_play_exclusive(music_track_shortie_monk_id);
  }
  gameplay_render_world();
  ui_elements_update_and_render();
  perk_prompt_update_and_render();
  v11 = flt_48CC64 + flt_48CC88;
  *(float *)&input_state = flt_48CC84 + flt_48CC60 + 180.0;
  v9 = v11 + 40.0;
  v7 = v9;
  *(float *)&xy = flt_48CC50 + *(float *)&input_state + 44.0 - 10.0;
  v10 = *(float *)&xy;
  ui_draw_textured_quad((__int64)(*(float *)&xy - 2.0), (__int64)v9, 256, 64, dword_48F7F8);
  switch ( dword_487234 )
  {
    case -1:
      j_highscore_load_table();
      dword_4825A4 = highscore_rank_index();
      highscore_record_game_mode = config_game_mode;
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
      console_input_poll();
      (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28);
      if ( dword_4825A4 >= 100 )
      {
        dword_487234 = 1;
LABEL_29:
        v7 = v9;
        ::input_state = (int)byte_48256C;
        *(float *)&xy = v10 + 30.0;
        v2 = v9;
        if ( dword_4825A4 < 100 )
        {
          v3 = v2 + 64.0;
        }
        else
        {
          v7 = v2 + 62.0;
          v4 = *(float *)&xy + 8.0;
          (*(void (**)(int, _DWORD, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
            grim_interface_ptr,
            LODWORD(v4),
            COERCE_FLOAT(LODWORD(v7)),
            aScoreTooLowFor,
            100);
          v3 = v7 + 6.0;
        }
        v7 = v3;
        input_state = xy;
        v9 = v7 + 16.0;
        ui_text_input_render(&input_state, COERCE_FLOAT(&highscore_active_record), 1.0);
        v7 = v7 + 146.0;
        if ( (byte_4825FC & 4) == 0 )
        {
          byte_48250E = 1;
          byte_4825FC |= 4u;
          byte_48251D = 0;
          byte_48251C = 0;
          dword_482518 = 1065353216;
          dword_482514 = 0;
          dword_482508 = 0;
          byte_48250C = 0;
          byte_48250D = 0;
          dword_482510 = 0;
          crt_atexit(nullsub_29);
        }
        dword_482508 = (int)aPlayAgain;
        if ( (byte_4825FC & 8) == 0 )
        {
          byte_482556 = 1;
          byte_4825FC |= 8u;
          byte_482565 = 0;
          byte_482564 = 0;
          dword_482560 = 1065353216;
          dword_48255C = 0;
          dword_482550 = 0;
          byte_482554 = 0;
          byte_482555 = 0;
          dword_482558 = 0;
          crt_atexit(nullsub_28);
        }
        dword_482550 = (int)aHighScores;
        if ( (byte_4825FC & 0x10) == 0 )
        {
          byte_48253E = 1;
          byte_4825FC |= 0x10u;
          byte_48254D = 0;
          byte_48254C = 0;
          dword_482548 = 1065353216;
          dword_482544 = 0;
          dword_482538 = 0;
          byte_48253C = 0;
          byte_48253D = 0;
          dword_482540 = 0;
          crt_atexit(nullsub_27);
        }
        dword_482538 = (int)aMainMenu;
        *(float *)&xy = *(float *)&xy - 4.0 + 26.0;
        ui_button_update((float *)&xy, (int)&dword_482508);
        v7 = v7 + 32.0;
        ui_button_update((float *)&xy, (int)&dword_482550);
        v7 = v7 + 32.0;
        ui_button_update((float *)&xy, (int)&dword_482538);
        v7 = v7 + 32.0;
        if ( byte_48250D )
        {
          ui_transition_direction = 0;
          game_state_pending = 9;
          if ( config_game_mode == 4 )
            game_state_pending = 18;
          sfx_mute_all(music_track_crimson_theme_id);
          sfx_mute_all(music_track_shortie_monk_id);
          sfx_mute_all(music_track_extra_0);
        }
        if ( byte_482555 )
        {
          dword_487258 = config_game_mode;
          byte_48724D = 1;
          dword_487250 = *(_DWORD *)quest_stage_major;
          dword_487254 = quest_stage_minor;
          byte_48725C = config_hardcore;
          ui_transition_direction = 0;
          game_state_pending = 14;
        }
        if ( byte_48253D )
        {
          sfx_mute_all(music_track_extra_0);
          sfx_mute_all(music_track_crimson_theme_id);
          sfx_mute_all(music_track_shortie_monk_id);
          sfx_play_exclusive(music_track_crimson_theme_id);
          ui_transition_direction = 0;
          game_state_pending = 0;
          ui_sign_crimson_update_disabled = 0;
        }
        break;
      }
      dword_487234 = 0;
      dword_482598 = 20;
      ::input_state = (int)strcpy(byte_48256C, (const char *)&highscore_active_record);
      dword_482594 = strlen((const char *)&highscore_active_record);
      goto LABEL_18;
    case 0:
LABEL_18:
      flt_496604 = 1.0;
      *(float *)&xy = *(float *)&xy + 8.0;
      v7 = v7 + 84.0;
      (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4965F8);
      v5 = *(float *)&xy + 42.0;
      (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v5),
        COERCE_FLOAT(LODWORD(v7)),
        aStateYourNameT);
      flt_496604 = 0.69999999;
      dword_4825A8 = (int)aOk;
      v7 = v7 + 40.0;
      *(float *)&input_state = *(float *)&xy + 170.0;
      v9 = v7 - 8.0;
      ui_button_update((float *)&input_state, (int)&dword_4825A8);
      dword_48259C = 166;
      if ( (unsigned __int8)ui_text_input_update((float *)&xy, &::input_state) || byte_4825AD )
      {
        v0 = 0;
        v1 = strlen(byte_48256C) + 1;
        if ( (int)(v1 - 1) < 1 )
          goto LABEL_25;
        do
        {
          if ( byte_48256C[v0] != 32 )
            break;
          ++v0;
        }
        while ( v0 < (int)(v1 - 1) );
        if ( byte_48256C[v0] )
        {
          dword_487234 = 1;
          sfx_play(sfx_ui_typeenter);
          memset(&highscore_active_record, 0, 0x1Cu);
          ::input_state = (int)byte_48256C;
          strcpy((char *)&highscore_active_record, byte_48256C);
          player_name_length = dword_482594;
          *(&highscore_active_record + dword_482594) = 0;
          highscore_save_active();
          j_highscore_load_table();
        }
        else
        {
LABEL_25:
          byte_4825AD = 0;
          sfx_play(SLODWORD(sfx_shock_hit_01));
        }
      }
      v7 = v7 + 60.0;
      (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4965F8);
      if ( dword_4825A4 < 100 )
      {
        *(float *)&input_state = *(float *)&xy + 16.0;
        v9 = v7 + 16.0;
        ui_text_input_render(&input_state, COERCE_FLOAT(&highscore_active_record), 1.0);
        ui_cursor_render();
        return;
      }
      break;
    case 1:
      goto LABEL_29;
  }
  ui_cursor_render();
}

// nullsub_27 @ 0x00410790
void __cdecl nullsub_27()
{
  ;
}

// nullsub_28 @ 0x004107A0
void __cdecl nullsub_28()
{
  ;
}

// nullsub_29 @ 0x004107B0
void __cdecl nullsub_29()
{
  ;
}

// nullsub_30 @ 0x004107C0
void __cdecl nullsub_30()
{
  ;
}

// nullsub_31 @ 0x004107D0
void __cdecl nullsub_31()
{
  ;
}

// quest_failed_screen_update @ 0x004107E0
// quest failure screen: retry options and navigation
void quest_failed_screen_update()
{
  double v0; // st7
  int v1; // [esp+Ch] [ebp-18h] BYREF
  float v2; // [esp+10h] [ebp-14h]
  int input_state; // [esp+14h] [ebp-10h] BYREF
  float v4; // [esp+18h] [ebp-Ch]
  int v5; // [esp+1Ch] [ebp-8h]
  float v6; // [esp+20h] [ebp-4h]

  bonus_reflex_boost_timer = 0.0;
  if ( game_state_id == 12
    && game_state_pending == 25
    && ui_transition_direction
    && !(unsigned __int8)sfx_is_unmuted(music_track_shortie_monk_id) )
  {
    sfx_play_exclusive(music_track_shortie_monk_id);
  }
  gameplay_render_world();
  ui_elements_update_and_render();
  perk_prompt_update_and_render();
  v6 = flt_48DBDC + flt_48DC00;
  *(float *)&input_state = flt_48DBFC + flt_48DBD8 + 180.0;
  v4 = v6 + 40.0;
  v2 = v4;
  *(float *)&v1 = flt_48DBC8 + *(float *)&input_state + 44.0 - 10.0;
  v5 = v1;
  ui_draw_textured_quad((__int64)(*(float *)&v1 - 2.0), (__int64)v4, 256, 64, dword_48F7F8);
  if ( dword_487234 == -1 )
  {
    j_highscore_load_table();
    dword_482604 = highscore_rank_index();
    highscore_record_game_mode = config_game_mode;
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
    console_input_poll();
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28);
    dword_487234 = 0;
  }
  else if ( dword_487234 )
  {
    goto LABEL_28;
  }
  *(float *)&v1 = *(float *)&v5 + 30.0;
  v2 = v4 + 70.0 + 16.0;
  switch ( dword_487194 )
  {
    case 1:
      (*(void (__stdcall **)(int, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
        v1,
        COERCE_FLOAT(LODWORD(v2)),
        aYouDidnTMakeIt);
      break;
    case 2:
      (*(void (__stdcall **)(int, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
        v1,
        COERCE_FLOAT(LODWORD(v2)),
        aThirdTimeNoGoo);
      break;
    case 3:
      (*(void (__stdcall **)(int, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
        v1,
        COERCE_FLOAT(LODWORD(v2)),
        aNoLuckThisTime);
      break;
    case 4:
      (*(void (__stdcall **)(int, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
        v1,
        COERCE_FLOAT(LODWORD(v2)),
        aPersistenceWil);
      break;
    case 5:
      (*(void (__stdcall **)(int, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
        v1,
        COERCE_FLOAT(LODWORD(v2)),
        aTryOneMoreTime);
      break;
    default:
      (*(void (__stdcall **)(int, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
        v1,
        COERCE_FLOAT(LODWORD(v2)),
        aQuestFailedTry);
      break;
  }
  v2 = v2 + 16.0;
  v0 = *(float *)&v1 + 6.0;
  *(float *)&v1 = v0;
  *(float *)&input_state = v0 + 4.0;
  v4 = v2 + 10.0;
  ui_text_input_render(&input_state, COERCE_FLOAT(&highscore_active_record), 1.0);
  v2 = v2 + 98.0;
  *(float *)&v1 = *(float *)&v1 + 16.0;
  if ( (byte_4825D8 & 1) == 0 )
  {
    byte_482686 = 1;
    byte_4825D8 |= 1u;
    byte_482695 = 0;
    byte_482694 = 0;
    dword_482690 = 1065353216;
    dword_48268C = 0;
    dword_482680 = 0;
    byte_482684 = 0;
    byte_482685 = 0;
    dword_482688 = 0;
    crt_atexit(nullsub_34);
  }
  dword_482680 = (int)aPlayAgain;
  if ( (byte_4825D8 & 2) == 0 )
  {
    byte_48269E = 1;
    byte_4825D8 |= 2u;
    byte_4826AD = 0;
    byte_4826AC = 0;
    dword_4826A8 = 1065353216;
    dword_4826A4 = 0;
    dword_482698 = 0;
    byte_48269C = 0;
    byte_48269D = 0;
    dword_4826A0 = 0;
    crt_atexit(nullsub_33);
  }
  dword_482698 = (int)aPlayAnother;
  if ( (byte_4825D8 & 4) == 0 )
  {
    byte_4824F6 = 1;
    byte_4825D8 |= 4u;
    byte_482505 = 0;
    byte_482504 = 0;
    dword_482500 = 1065353216;
    dword_4824FC = 0;
    dword_4824F0 = 0;
    byte_4824F4 = 0;
    byte_4824F5 = 0;
    dword_4824F8 = 0;
    crt_atexit(nullsub_32);
  }
  dword_4824F0 = (int)aMainMenu;
  ui_button_update((float *)&v1, (int)&dword_482680);
  v2 = v2 + 32.0;
  ui_button_update((float *)&v1, (int)&dword_482698);
  v2 = v2 + 32.0;
  ui_button_update((float *)&v1, (int)&dword_4824F0);
  v2 = v2 + 32.0;
  if ( byte_482685 )
  {
    ++dword_487194;
    ui_transition_direction = 0;
    game_state_pending = 9;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    render_pass_mode = 0;
  }
  if ( byte_48269D )
  {
    dword_487194 = 0;
    ui_transition_direction = 0;
    game_state_pending = 11;
    ui_sign_crimson_update_disabled = 0;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    sfx_play_exclusive(music_track_crimson_theme_id);
  }
  if ( byte_4824F5 )
  {
    dword_487194 = 0;
    sfx_mute_all(music_track_extra_0);
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_play_exclusive(music_track_crimson_theme_id);
    ui_transition_direction = 0;
    game_state_pending = 0;
    ui_sign_crimson_update_disabled = 0;
  }
LABEL_28:
  ui_cursor_render();
}

// nullsub_32 @ 0x00410CF0
void __cdecl nullsub_32()
{
  ;
}

// nullsub_33 @ 0x00410D00
void __cdecl nullsub_33()
{
  ;
}

// nullsub_34 @ 0x00410D10
void __cdecl nullsub_34()
{
  ;
}

// quest_results_screen_update @ 0x00410D20
// quest/campaign results screen: final time, perk bonus, high score entry, and buttons
void quest_results_screen_update()
{
  int v0; // eax
  int v1; // eax
  int v2; // edx
  double v3; // st7
  int v4; // esi
  bool v5; // cc
  int v6; // eax
  double v7; // st7
  int v8; // edi
  int v9; // eax
  int v10; // edi
  int v11; // eax
  int v12; // edi
  int v13; // eax
  int v14; // esi
  int v15; // eax
  signed int v16; // eax
  unsigned int v17; // kr0C_4
  int v18; // eax
  int v19; // esi
  char *v20; // eax
  float v21; // [esp+8Ch] [ebp-38h]
  float v22; // [esp+8Ch] [ebp-38h]
  float v23; // [esp+8Ch] [ebp-38h]
  float v24; // [esp+8Ch] [ebp-38h]
  float v25; // [esp+8Ch] [ebp-38h]
  float v26; // [esp+90h] [ebp-34h]
  float v27; // [esp+94h] [ebp-30h]
  float v28; // [esp+94h] [ebp-30h]
  float v29; // [esp+98h] [ebp-2Ch]
  float v30; // [esp+98h] [ebp-2Ch]
  float v31; // [esp+98h] [ebp-2Ch]
  float v32; // [esp+98h] [ebp-2Ch]
  float v33; // [esp+98h] [ebp-2Ch]
  int alpha; // [esp+ACh] [ebp-18h] BYREF
  float v35; // [esp+B0h] [ebp-14h]
  int xy; // [esp+B4h] [ebp-10h] BYREF
  float v37; // [esp+B8h] [ebp-Ch]
  int input_state; // [esp+BCh] [ebp-8h] BYREF
  float v39; // [esp+C0h] [ebp-4h]

  bonus_reflex_boost_timer = 0.0;
  dword_487194 = 0;
  if ( game_state_id == 8
    && game_state_pending == 25
    && ui_transition_direction
    && !(unsigned __int8)sfx_is_unmuted(music_track_shortie_monk_id) )
  {
    sfx_play_exclusive(music_track_crimsonquest_id);
  }
  gameplay_render_world();
  ui_elements_update_and_render();
  if ( (byte_482568 & 1) == 0 )
  {
    byte_482526 = 1;
    byte_482568 |= 1u;
    byte_482535 = 0;
    byte_482534 = 0;
    dword_482530 = 1065353216;
    dword_48252C = 0;
    dword_482520 = 0;
    byte_482524 = 0;
    byte_482525 = 0;
    dword_482528 = 0;
    crt_atexit(nullsub_40);
  }
  if ( (byte_482568 & 2) == 0 )
  {
    dword_4826F8 = 1065353216;
    byte_482568 |= 2u;
    dword_4826E8 = (int)byte_4825DC;
    dword_4826EC = 0;
    dword_4826F0 = 24;
    dword_4826F4 = 96;
    crt_atexit(nullsub_39);
  }
  v39 = flt_48DBDC + flt_48DC00;
  *(float *)&alpha = flt_48DBFC + flt_48DBD8 + 180.0;
  v35 = v39 + 40.0;
  *(float *)&xy = *(float *)&alpha + flt_48DBC8 + 40.0;
  ui_draw_textured_quad((__int64)(*(float *)&xy - 18.0), (__int64)(v35 - 4.0), 256, 64, dword_48F804);
  input_state = xy;
  v37 = v35 + 56.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  if ( game_state_prev == 14 && ui_transition_direction && byte_48724D )
  {
    byte_48724D = 0;
    dword_487234 = 2;
    goto LABEL_77;
  }
  v0 = dword_487234;
  if ( dword_487234 == -2 )
  {
    v1 = 11 * (quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 11);
    v2 = quest_unlock_perk_id[v1];
    dword_482700 = quest_unlock_weapon_id[v1];
    dword_482704 = v2;
    alpha = (__int64)*(float *)player_health;
    v3 = (double)alpha;
    *(float *)player_health = v3;
    v4 = (__int64)(v3 * 50.0);
    dword_482600 = v4;
    if ( config_player_count == 2 )
    {
      v4 += (__int64)(player2_health[0] * 50.0);
      dword_482600 = v4;
    }
    dword_48270C = quest_spawn_timeline - 1000 * perk_pending_count - v4;
    survival_elapsed_ms = quest_spawn_timeline - 1000 * perk_pending_count - v4;
    if ( !dword_48270C )
      survival_elapsed_ms = 1;
    dword_482708 = 0;
    highscore_record_init();
    dword_482724 = 700;
    v0 = dword_487234 + 1;
    dword_482710 = 0;
    dword_482714 = 0;
    arg1 = 0;
    dword_48271C = 0;
    dword_482720 = 0;
    ++dword_487234;
  }
  if ( v0 == -1 )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    v5 = dword_482724 - frame_dt_ms <= 0;
    dword_482724 -= frame_dt_ms;
    v37 = v37 + 40.0;
    if ( v5 )
    {
      if ( dword_48271C >= 3 )
      {
        if ( dword_48271C == 3 )
        {
          dword_482724 = 50;
          ++dword_482708;
        }
      }
      else if ( dword_48271C )
      {
        if ( dword_48271C == 1 )
        {
          dword_482714 += 1000;
          dword_482724 = 150;
          sfx_play(sfx_ui_clink_01);
          dword_482720 -= 1000;
          if ( dword_482714 >= dword_482600 )
          {
            dword_482714 = dword_482600;
            ++dword_48271C;
          }
        }
        else if ( dword_48271C == 2 )
        {
          dword_482724 = 300;
          ++arg1;
          sfx_play(sfx_ui_clink_01);
          dword_482720 -= 1000;
          if ( arg1 >= perk_pending_count )
          {
            arg1 = perk_pending_count;
            dword_482724 = 1000;
            ++dword_48271C;
            survival_elapsed_ms = dword_48270C;
            dword_482720 = dword_48270C;
          }
        }
      }
      else
      {
        dword_482724 = 40;
        dword_482710 += 2000;
        sfx_play(sfx_ui_clink_01);
        v6 = dword_482710;
        if ( dword_482710 >= quest_spawn_timeline )
        {
          v6 = quest_spawn_timeline;
          dword_482710 = quest_spawn_timeline;
          ++dword_48271C;
        }
        dword_482720 = v6;
      }
    }
    v7 = 1.0 - (double)dword_482708 * 0.1;
    *(float *)&alpha = v7;
    if ( v7 >= 0.0 )
    {
      if ( *(float *)&alpha > 1.0 )
        *(float *)&alpha = 1.0;
    }
    else
    {
      *(float *)&alpha = 0.0;
    }
    *(float *)&xy = *(float *)&xy + 32.0;
    v37 = v37 + 20.0;
    if ( dword_48271C )
    {
      v29 = *(float *)&alpha * 0.40000001;
      (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v29));
    }
    else
    {
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1036831949,
        1061997773,
        1036831949,
        alpha);
    }
    (*(void (__cdecl **)(int, int, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      xy,
      COERCE_FLOAT(LODWORD(v37)),
      aBaseTime);
    v8 = *(_DWORD *)grim_interface_ptr;
    v9 = FUN_0040ff50(dword_482710 / 1000);
    v21 = *(float *)&xy + 132.0;
    (*(void (**)(int, _DWORD, float, char *, ...))(v8 + 328))(
      grim_interface_ptr,
      LODWORD(v21),
      COERCE_FLOAT(LODWORD(v37)),
      aS_0,
      v9);
    v37 = v37 + 20.0;
    if ( dword_48271C == 1 )
    {
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1036831949,
        1061997773,
        1036831949,
        alpha);
    }
    else
    {
      v30 = *(float *)&alpha * 0.40000001;
      (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v30));
    }
    if ( dword_48271C < 1 )
    {
      v31 = *(float *)&alpha * 0.2;
      (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v31));
    }
    (*(void (__cdecl **)(int, int, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      xy,
      COERCE_FLOAT(LODWORD(v37)),
      aLifeBonus);
    v10 = *(_DWORD *)grim_interface_ptr;
    v11 = FUN_0040ff50(dword_482714 / 1000);
    v22 = *(float *)&xy + 132.0;
    (*(void (**)(int, _DWORD, float, char *, ...))(v10 + 328))(
      grim_interface_ptr,
      LODWORD(v22),
      COERCE_FLOAT(LODWORD(v37)),
      aS_0,
      v11);
    v37 = v37 + 20.0;
    if ( dword_48271C == 2 )
    {
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1036831949,
        1061997773,
        1036831949,
        alpha);
    }
    else
    {
      v32 = *(float *)&alpha * 0.40000001;
      (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v32));
    }
    if ( dword_48271C < 2 )
    {
      v33 = *(float *)&alpha * 0.2;
      (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v33));
    }
    (*(void (__cdecl **)(int, int, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      xy,
      COERCE_FLOAT(LODWORD(v37)),
      aUnpickedPerkBo);
    v12 = *(_DWORD *)grim_interface_ptr;
    v13 = FUN_0040ff50(arg1);
    v23 = *(float *)&xy + 132.0;
    (*(void (**)(int, _DWORD, float, char *, ...))(v12 + 328))(
      grim_interface_ptr,
      LODWORD(v23),
      COERCE_FLOAT(LODWORD(v37)),
      aS_0,
      v13);
    v37 = v37 + 20.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      alpha);
    *(float *)&alpha = *(float *)&xy - 4.0;
    v35 = v37 + 1.0;
    (*(void (__thiscall **)(int, int *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
      grim_interface_ptr,
      &alpha,
      1126694912,
      1065353216);
    v37 = v37 + 8.0;
    (*(void (__cdecl **)(int, int, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      xy,
      COERCE_FLOAT(LODWORD(v37)),
      aFinalTime);
    v14 = *(_DWORD *)grim_interface_ptr;
    v15 = FUN_0040ff50(dword_482720 / 1000);
    v24 = *(float *)&xy + 132.0;
    (*(void (**)(int, _DWORD, float, char *, ...))(v14 + 328))(
      grim_interface_ptr,
      LODWORD(v24),
      COERCE_FLOAT(LODWORD(v37)),
      aS_0,
      v15);
    v37 = v37 + 20.0;
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28);
    if ( dword_487234 == -1
      && ((*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 57)
       || (unsigned __int8)input_primary_just_pressed()) )
    {
      ++dword_487234;
      perk_prompt_update_and_render();
      ui_cursor_render();
      return;
    }
    if ( dword_482708 > 10 )
    {
      dword_482708 = 0;
      ++dword_487234;
      perk_prompt_update_and_render();
      ui_cursor_render();
      return;
    }
    goto LABEL_108;
  }
  if ( v0 )
  {
    if ( v0 != 1 )
    {
      if ( v0 != 2 )
      {
LABEL_108:
        perk_prompt_update_and_render();
        ui_cursor_render();
        return;
      }
LABEL_77:
      if ( dword_482708 >= 500 )
        dword_482708 = 500;
      else
        dword_482708 += frame_dt_ms;
      *(float *)&alpha = (double)dword_482708 * 0.0020000001;
      *(float *)&xy = *(float *)&input_state + 30.0;
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        alpha);
      if ( dword_482620 >= 100 )
      {
        v37 = v37 + 6.0;
        v25 = *(float *)&xy + 8.0;
        (*(void (**)(int, _DWORD, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          LODWORD(v25),
          COERCE_FLOAT(LODWORD(v37)),
          aScoreTooLowFor,
          100);
        v37 = v37 + 6.0;
      }
      input_state = xy;
      v39 = v37 + 16.0;
      ui_text_input_render(&input_state, COERCE_FLOAT(&highscore_active_record), *(float *)&alpha);
      v37 = v37 + 78.0 + 6.0;
      if ( dword_482700 )
      {
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1060320051);
        v27 = v37 + 1.0;
        (*(void (__cdecl **)(int, int, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          xy,
          LODWORD(v27),
          aWeaponUnlocked);
        v37 = v37 + 14.0;
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1063675494);
        v19 = *(_DWORD *)grim_interface_ptr;
        v20 = weapon_table_entry(quest_unlock_weapon_id[110 * *(_DWORD *)quest_stage_major
                                                      - 121
                                                      + 11 * quest_stage_minor]);
        (*(void (**)(int, int, float, char *, ...))(v19 + 328))(
          grim_interface_ptr,
          xy,
          COERCE_FLOAT(LODWORD(v37)),
          aS_0,
          v20);
        v37 = v37 + 16.0;
      }
      if ( dword_482704 != perk_id_antiperk )
      {
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1060320051);
        v28 = v37 + 1.0;
        (*(void (__cdecl **)(int, int, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          xy,
          LODWORD(v28),
          aPerkUnlocked);
        v37 = v37 + 14.0;
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1063675494);
        (*(void (**)(int, int, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          xy,
          COERCE_FLOAT(LODWORD(v37)),
          aS_0,
          perk_meta_table[5 * quest_unlock_perk_id[110 * *(_DWORD *)quest_stage_major - 121 + 11 * quest_stage_minor]]);
        v37 = v37 + 16.0;
      }
      if ( (byte_482568 & 4) == 0 )
      {
        byte_4825C6 = 1;
        byte_482568 |= 4u;
        byte_4825D5 = 0;
        byte_4825D4 = 0;
        dword_4825D0 = 1065353216;
        dword_4825CC = 0;
        dword_4825C0 = 0;
        byte_4825C4 = 0;
        byte_4825C5 = 0;
        dword_4825C8 = 0;
        crt_atexit(nullsub_38);
      }
      dword_4825C0 = (int)aPlayNext;
      if ( (byte_482568 & 8) == 0 )
      {
        byte_48260E = 1;
        byte_482568 |= 8u;
        byte_48261D = 0;
        byte_48261C = 0;
        dword_482618 = 1065353216;
        dword_482614 = 0;
        dword_482608 = 0;
        byte_48260C = 0;
        byte_48260D = 0;
        dword_482610 = 0;
        crt_atexit(nullsub_37);
      }
      dword_482608 = (int)aPlayAgain;
      if ( (byte_482568 & 0x10) == 0 )
      {
        byte_48266E = 1;
        byte_482568 |= 0x10u;
        byte_48267D = 0;
        byte_48267C = 0;
        dword_482678 = 1065353216;
        dword_482674 = 0;
        dword_482668 = 0;
        byte_48266C = 0;
        byte_48266D = 0;
        dword_482670 = 0;
        crt_atexit(nullsub_36);
      }
      dword_482668 = (int)aHighScores;
      if ( (byte_482568 & 0x20) == 0 )
      {
        byte_482568 |= 0x20u;
        byte_4826B6 = 1;
        byte_4826C5 = 0;
        byte_4826C4 = 0;
        dword_4826C0 = 1065353216;
        dword_4826BC = 0;
        dword_4826B0 = 0;
        byte_4826B4 = 0;
        byte_4826B5 = 0;
        dword_4826B8 = 0;
        crt_atexit(nullsub_35);
      }
      dword_4826B0 = (int)aMainMenu;
      v37 = v37 + 6.0;
      if ( *(_DWORD *)quest_stage_major == 5 && quest_stage_minor == 10 )
        dword_4825C0 = (int)aShowEndNote;
      dword_482678 = alpha;
      dword_4825D0 = alpha;
      *(float *)&xy = *(float *)&xy + 20.0;
      dword_482618 = alpha;
      dword_4826C0 = alpha;
      ui_button_update((float *)&xy, (int)&dword_4825C0);
      v37 = v37 + 32.0;
      ui_button_update((float *)&xy, (int)&dword_482608);
      v37 = v37 + 32.0;
      ui_button_update((float *)&xy, (int)&dword_482668);
      v37 = v37 + 32.0;
      ui_button_update((float *)&xy, (int)&dword_4826B0);
      v37 = v37 + 32.0;
      if ( byte_4825C5 )
      {
        if ( *(_DWORD *)quest_stage_major == 5 && quest_stage_minor == 10 )
        {
          render_pass_mode = 0;
          game_state_pending = 21;
          ui_transition_direction = 0;
        }
        else
        {
          sfx_mute_all(music_track_extra_0);
          sfx_mute_all(music_track_crimson_theme_id);
          sfx_mute_all(music_track_shortie_monk_id);
          ui_transition_direction = 0;
          game_state_pending = 9;
          render_pass_mode = 0;
          ++quest_stage_minor;
        }
      }
      if ( byte_48260D )
      {
        ui_transition_direction = 0;
        game_state_pending = 9;
        sfx_mute_all(music_track_crimson_theme_id);
        sfx_mute_all(music_track_shortie_monk_id);
        sfx_mute_all(music_track_extra_0);
        render_pass_mode = 0;
      }
      if ( byte_48266D )
      {
        dword_487258 = config_game_mode;
        byte_48724D = 1;
        dword_487250 = *(_DWORD *)quest_stage_major;
        dword_487254 = quest_stage_minor;
        byte_48725C = config_hardcore;
        ui_transition_direction = 0;
        game_state_pending = 14;
      }
      if ( byte_4826B5 )
      {
        sfx_mute_all(music_track_extra_0);
        sfx_mute_all(music_track_crimson_theme_id);
        sfx_mute_all(music_track_shortie_monk_id);
        sfx_play_exclusive(music_track_crimson_theme_id);
        ui_transition_direction = 0;
        game_state_pending = 0;
        ui_sign_crimson_update_disabled = 0;
      }
      goto LABEL_108;
    }
    if ( dword_482708 >= 500 )
      dword_482708 = 500;
    else
      dword_482708 += frame_dt_ms;
    *(float *)&alpha = (double)dword_482708 * 0.0020000001;
    v37 = v37 + 22.0;
    flt_496604 = *(float *)&alpha;
    (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4965F8);
    v26 = *(float *)&xy + 42.0;
    (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v26),
      COERCE_FLOAT(LODWORD(v37)),
      aStateYourNameT_0);
    flt_496604 = 0.69999999;
    v37 = v37 + 32.0;
    dword_4826F4 = 166;
    dword_4826F8 = alpha;
    dword_482520 = (int)aOk;
    dword_482530 = alpha;
    *(float *)&input_state = *(float *)&xy + 170.0;
    v39 = v37 - 8.0;
    ui_button_update((float *)&input_state, (int)&dword_482520);
    if ( (unsigned __int8)ui_text_input_update((float *)&xy, &dword_4826E8) || byte_482525 )
    {
      v16 = 0;
      v17 = strlen(byte_4825DC) + 1;
      if ( (int)(v17 - 1) < 1 )
        goto LABEL_74;
      do
      {
        if ( byte_4825DC[v16] != 32 )
          break;
        ++v16;
      }
      while ( v16 < (int)(v17 - 1) );
      if ( byte_4825DC[v16] )
      {
        dword_487234 = 2;
        sfx_play(sfx_ui_typeenter);
        v18 = dword_4826EC;
        player_name_length = dword_4826EC;
        strcpy((char *)&highscore_active_record, byte_4825DC);
        dword_4826EC = 0;
        dword_4826F0 = 0;
        *(&highscore_active_record + v18) = 0;
        dword_4826E8 = (int)byte_4825DC;
        highscore_save_active();
        j_highscore_load_table();
      }
      else
      {
LABEL_74:
        byte_482525 = 0;
        sfx_play(SLODWORD(sfx_shock_hit_01));
      }
    }
    v37 = v37 + 30.0;
    (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4965F8);
    *(float *)&input_state = *(float *)&xy + 26.0;
    v39 = v37 + 16.0;
    ui_text_input_render(&input_state, COERCE_FLOAT(&highscore_active_record), *(float *)&alpha);
    perk_prompt_update_and_render();
    ui_cursor_render();
  }
  else
  {
    j_highscore_load_table();
    dword_482620 = highscore_rank_index();
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28);
    if ( dword_482620 < 100 )
    {
      dword_4826F0 = 20;
      dword_4826E8 = (int)byte_4825DC;
      dword_487234 = 1;
      strcpy(byte_4825DC, (const char *)&highscore_active_record);
      dword_4826EC = strlen((const char *)&highscore_active_record);
    }
    else
    {
      dword_4826EC = 0;
      dword_4826F0 = 0;
      dword_4826E8 = (int)byte_4825DC;
      dword_487234 = 2;
    }
    perk_prompt_update_and_render();
    ui_cursor_render();
  }
}

// nullsub_35 @ 0x00412020
void __cdecl nullsub_35()
{
  ;
}

// nullsub_36 @ 0x00412030
void __cdecl nullsub_36()
{
  ;
}

// nullsub_37 @ 0x00412040
void __cdecl nullsub_37()
{
  ;
}

// nullsub_38 @ 0x00412050
void __cdecl nullsub_38()
{
  ;
}

// nullsub_39 @ 0x00412060
void __cdecl nullsub_39()
{
  ;
}

// nullsub_40 @ 0x00412070
void __cdecl nullsub_40()
{
  ;
}

// nullsub_106 @ 0x00412090
void nullsub_106()
{
  ;
}

// FUN_004120b0 @ 0x004120B0
// [binja] int32_t sub_4120b0()
int FUN_004120b0()
{
  memset(&highscore_active_record, 0, 0x48u);
  strcpy((char *)&highscore_active_record, default_player_name);
  highscore_flags = 0;
  byte_487086 = 124;
  byte_487087 = -1;
  dword_487078 = crt_rand() & 0xFEE050F;
  bonus_energizer_timer = 0.0;
  survival_spawn_stage = 0;
  dword_487028 = 0;
  dword_487194 = 0;
  demo_mode_active = 0;
  byte_486FAA = 0;
  quest_unlock_index = 0;
  creature_active_count = 0;
  *(_DWORD *)&dword_48718C = 0;
  dword_487088 = -1;
  *(_DWORD *)quest_stage_major = 1;
  quest_stage_minor = 1;
  return 1;
}

// nullsub_107 @ 0x00412170
void nullsub_107()
{
  ;
}

// sub_412180 @ 0x00412180
// [binja] int32_t sub_4121f0()
int sub_412180()
{
  FUN_00412190();
  return crt_atexit(sub_412200);
}

// FUN_00412190 @ 0x00412190
// [binja] int32_t sub_412190()
int FUN_00412190()
{
  int result; // eax

  crt_ehvec_ctor(quest_selected_meta, 0x2Cu, 50, ctor, dtor);
  return result;
}

// ctor @ 0x004121B0
void __thiscall sub_4121B0(_DWORD *this)
{
  *(this + 7) = 0;
  *(this + 10) = 1;
  *(this + 3) = 0;
  *(this + 9) = 0;
  *(this + 8) = 0;
  *(this + 4) = 0;
  *(this + 5) = 1;
  *(this + 6) = 2;
  *(this + 2) = 120000;
}

// dtor @ 0x004121E0
void __thiscall sub_4121E0(LPVOID *this)
{
  if ( *(this + 3) )
    crt_free(*(this + 3));
}

// sub_412200 @ 0x00412200
void __cdecl sub_412200()
{
  crt_ehvec_dtor(&quest_selected_meta, 0x2Cu, 50, (void (__thiscall *)(void *))dtor);
}

// sub_412230 @ 0x00412230
int *sub_412230()
{
  int *result; // eax
  int v1; // ecx

  result = &bonus_pool;
  v1 = 16;
  do
  {
    *result = 0;
    result += 7;
    --v1;
  }
  while ( v1 );
  return result;
}

// sub_412260 @ 0x00412260
float *sub_412260()
{
  float *result; // eax
  int v1; // ecx

  result = &creature_spawn_slot_timer;
  v1 = 32;
  do
  {
    *(result - 4) = 0.0;
    *(result - 1) = 0.5;
    *result = 0.5;
    *(result - 3) = 0.0;
    *(result - 2) = NAN;
    result += 6;
    --v1;
  }
  while ( v1 );
  return result;
}

// sub_4122A0 @ 0x004122A0
int sub_4122A0()
{
  int v0; // eax
  int v2; // et2

  dword_48578C = 0;
  dword_485784 = 0;
  dword_485788 = 0;
  dword_485790 = 0;
  memset(&dword_4856E4, 0, 0x30u);
  unk_485714 = 0;
  memset(&dword_485644, 0, 0x30u);
  unk_485674 = 0;
  memset(&dword_485544, 0, 0x100u);
  game_status_blob = 0;
  *(_DWORD *)&game_sequence_id = 0;
  dword_485798 = crt_rand() % 345354345;
  dword_48579C = crt_rand() % 345354345;
  dword_4857A0 = crt_rand() % 345354345;
  v0 = crt_rand();
  v2 = v0 % 345354345;
  dword_4857A4 = v2;
  return v0 / 345354345;
}

// FUN_00412360 @ 0x00412360
// [binja] int32_t sub_412360()
int FUN_00412360()
{
  _BYTE *v0; // ebp
  int v1; // ebx
  int result; // eax

  v0 = &unk_482B56;
  v1 = 100;
  do
  {
    memset(v0 - 70, 0, 0x48u);
    strcpy(v0 - 70, default_player_name);
    *(v0 - 2) = 0;
    *v0 = 124;
    v0[1] = -1;
    result = crt_rand() & 0xFEE050F;
    *(_DWORD *)(v0 - 14) = result;
    v0 += 72;
    --v1;
  }
  while ( v1 );
  return result;
}

// sub_4123C0 @ 0x004123C0
// [binja] int32_t sub_412440()
int sub_4123C0()
{
  FUN_004123d0();
  return crt_atexit(sub_412450);
}

// FUN_004123d0 @ 0x004123D0
// [binja] int32_t sub_4123d0()
int FUN_004123d0()
{
  int result; // eax

  crt_ehvec_ctor(bonus_meta_table, 0x14u, 15, sub_4123F0, FUN_00412410);
  return result;
}

// sub_4123F0 @ 0x004123F0
void __thiscall sub_4123F0(_DWORD *this)
{
  *(this + 4) = 1;
  *(this + 2) = -1;
  *(this + 1) = 0;
  *this = 0;
  *((_BYTE *)this + 12) = 0;
}

// FUN_00412410 @ 0x00412410
// [binja] void* __fastcall sub_412410(int32_t* arg1)
void *FUN_00412410(int *arg1)
{
  void **v1; // ecx
  void **v2; // esi
  void *result; // eax
  void *v4; // esi

  v2 = v1;
  result = *v1;
  if ( *v1 )
    crt_free(*v1);
  v4 = v2[1];
  if ( v4 )
    crt_free(v4);
  return result;
}

// sub_412450 @ 0x00412450
void __cdecl sub_412450()
{
  crt_ehvec_dtor(&bonus_meta_table, 0x14u, 15, (void (__thiscall *)(void *))FUN_00412410);
}

// bonus_pick_random_type @ 0x00412470
// rolls a bonus id while respecting timers, perks, quest stage, and enabled flags
uint bonus_pick_random_type()
{
  char v0; // bl
  char *v1; // eax
  int v2; // esi
  uint v3; // edi
  int v4; // esi
  int v5; // esi
  int v6; // eax
  int v9; // [esp+Ch] [ebp-4h]

  v9 = 0;
  v0 = 0;
  v1 = bonus_state;
  do
  {
    if ( *((_DWORD *)v1 - 1) == 14 && !*v1 )
      v0 = 1;
    v1 += 28;
  }
  while ( (int)v1 < (int)byte_482B0C );
  do
  {
    v2 = crt_rand() % 162 + 1;
    v3 = v2 <= 13;
    v4 = v2 - 13;
    if ( !v3 && v4 <= 1 )
      v3 = 2;
    v5 = v4 - 1;
    if ( v3 == 2 )
    {
      if ( (crt_rand() & 0x3F) == 0 )
        goto LABEL_18;
      v3 = 0;
    }
    else if ( v3 )
    {
      goto LABEL_18;
    }
    v6 = 3;
    while ( v5 > 10 )
    {
      v5 -= 10;
      if ( ++v6 >= 15 )
        goto LABEL_18;
    }
    v3 = v6;
LABEL_18:
    if ( shock_chain_links_left <= 0 || v3 != 7 )
    {
      if ( config_game_mode == 3 )
      {
        if ( config_hardcore && *(_DWORD *)quest_stage_major == 3 )
        {
          if ( quest_stage_minor == 10 && v3 == 5 )
            continue;
        }
        else if ( *(_DWORD *)quest_stage_major == 2 && quest_stage_minor == 10 && v3 == 5 )
        {
          continue;
        }
        if ( config_hardcore && *(_DWORD *)quest_stage_major == 2 )
        {
          if ( quest_stage_minor == 10 && v3 == 11 )
            continue;
        }
        else if ( *(_DWORD *)quest_stage_major == 4 )
        {
          if ( quest_stage_minor == 10 && (v3 == 5 || v3 == 11) )
            continue;
        }
        else if ( *(_DWORD *)quest_stage_major == 5 && quest_stage_minor == 10 && v3 == *(_DWORD *)quest_stage_major )
        {
          continue;
        }
      }
      if ( (bonus_freeze_timer <= 0.0 || v3 != 11)
        && (*(float *)player_shield_timer <= 0.0 && player2_shield_timer <= 0.0 || v3 != 10)
        && (!perk_count_get(perk_id_my_favourite_weapon) || v3 != 3)
        && (!perk_count_get(perk_id_death_clock) || v3 != 12)
        && (v3 != 3 || !v0)
        && bonus_meta_enabled[20 * v3] )
      {
        return v3;
      }
    }
  }
  while ( v9++ < 100 );
  return 1;
}

// bonus_metadata_init @ 0x00412660
// builds bonus metadata table (labels, descriptions, durations)
void bonus_metadata_init()
{
  char *v0; // eax

  dword_4853E4 = (int)strdup_malloc(aPoints);
  dword_4853E8 = (int)sub_42FD00(aYouGainSomeExp, 256);
  dword_4853EC = 12;
  dword_4853F4 = 500;
  byte_4853F0 = 1;
  dword_48540C = (int)strdup_malloc(aWeapon);
  dword_485410 = (int)sub_42FD00(aYouGetANewWeap, 256);
  dword_485414 = -1;
  dword_48541C = 3;
  dword_485434 = (int)strdup_malloc(aNuke);
  dword_485438 = (int)sub_42FD00(aAnAmazingExplo, 256);
  dword_48543C = 1;
  dword_485448 = (int)strdup_malloc(aDoubleExperien);
  dword_48544C = (int)sub_42FD00(aEveryExperienc, 256);
  dword_485450 = 4;
  dword_485470 = (int)strdup_malloc(aFireblast);
  dword_485474 = (int)sub_42FD00(aFireballsAllOv, 256);
  dword_485478 = 2;
  dword_48545C = (int)strdup_malloc(aShockChain);
  dword_485460 = (int)sub_42FD00(aChainOfShocksS, 256);
  dword_485464 = 3;
  dword_485484 = (int)strdup_malloc(aReflexBoost);
  dword_485488 = (int)sub_42FD00(aYouGetMoreTime, 256);
  dword_48548C = 5;
  dword_485494 = 3;
  dword_485498 = (int)strdup_malloc(aShield);
  dword_48549C = (int)sub_42FD00(aForceFieldProt, 256);
  dword_4854A0 = 6;
  dword_4854A8 = 7;
  dword_4854AC = (int)strdup_malloc(aFreeze);
  dword_4854B0 = (int)sub_42FD00(aMonstersAreFro, 256);
  dword_4854B4 = 8;
  dword_4854BC = 5;
  dword_4854D4 = (int)strdup_malloc(aSpeed);
  dword_4854D8 = (int)sub_42FD00(aYourMovementSp, 256);
  dword_4854DC = 9;
  dword_4854E4 = 8;
  dword_4853F8 = (int)strdup_malloc(aEnergizer);
  dword_4853FC = (int)sub_42FD00(aSuddenlyMonste, 256);
  dword_485400 = 10;
  dword_485408 = 8;
  dword_485420 = (int)strdup_malloc(aWeaponPowerUp);
  dword_485424 = (int)sub_42FD00(aYourFirerateAn, 256);
  dword_485428 = 7;
  dword_485430 = 10;
  dword_4854E8 = (int)strdup_malloc(aFireBullets);
  dword_4854EC = (int)sub_42FD00(aForFewSecondsM, 256);
  dword_4854F0 = 11;
  dword_4854F8 = 4;
  dword_4854C0 = (int)strdup_malloc(aMedikit);
  v0 = sub_42FD00(aYouRegainSomeO, 256);
  dword_4854D0 = 10;
  dword_4854C4 = (int)v0;
  dword_4854C8 = 14;
}

// FUN_00412940 @ 0x00412940
// [binja] char* sub_412940()
char *FUN_00412940()
{
  char *result; // eax

  result = bonus_meta_enabled;
  do
  {
    *result = 1;
    result += 20;
  }
  while ( (int)result < (int)byte_485508 );
  bonus_meta_enabled[0] = 0;
  return result;
}

// game_mode_label @ 0x00412960
// returns a display label for the current game mode
char *game_mode_label()
{
  const char *v0; // edi

  switch ( config_game_mode )
  {
    case 2:
      v0 = aRush_0;
      break;
    case 1:
      return strcpy(byte_4854FC, aSurvival);
    case 3:
      v0 = aQuests;
      break;
    case 4:
      return strcpy(byte_4854FC, aTypOShooter);
    default:
      v0 = aUnknown;
      break;
  }
  strcpy(byte_4854FC, v0);
  return byte_4854FC;
}

// game_sequence_load @ 0x00412A10
// reads the sequence value from registry
void game_sequence_load()
{
  HKEY phkResult; // [esp+0h] [ebp-8h] BYREF
  DWORD Type; // [esp+4h] [ebp-4h] BYREF

  if ( !RegCreateKeyExA(HKEY_LOCAL_MACHINE, &SubKey, 0, 0, 0, 0xF003Fu, 0, &phkResult, 0) )
  {
    reg_read_dword_default(phkResult, ValueName, &Type, 0);
    if ( *(_DWORD *)&game_sequence_id < Type )
      *(_DWORD *)&game_sequence_id = Type;
    RegCloseKey(phkResult);
  }
}

// game_save_status @ 0x00412A80
// writes registry state and saves status file
void game_save_status()
{
  int v0; // esi
  char *v1; // eax
  FILE *v2; // ebp
  int v3; // edi
  int v4; // ecx
  unsigned int v5; // esi
  char v6; // dl
  unsigned int v7; // ebx
  HKEY phkResult; // [esp+8h] [ebp-8h] BYREF
  int Buffer; // [esp+Ch] [ebp-4h] BYREF

  if ( !RegCreateKeyExA(HKEY_LOCAL_MACHINE, &SubKey, 0, 0, 0, 0xF003Fu, 0, &phkResult, 0) )
  {
    v0 = *(_DWORD *)&game_sequence_id;
    reg_write_dword(phkResult, ValueName, *(unsigned int *)&game_sequence_id);
    reg_write_dword(phkResult, aDatapathid, (unsigned int)(13 * v0 + 3) >> 1);
    reg_write_dword(phkResult, aTransferfailed, 0);
    RegCloseKey(phkResult);
  }
  v1 = game_build_path(game_status_filename);
  v2 = crt_fopen(v1, file_mode_write_binary);
  if ( v2 )
  {
    LOWORD(game_status_blob) = quest_unlock_index;
    v3 = 0;
    v4 = 0;
    HIWORD(game_status_blob) = quest_unlock_index_full;
    v5 = 0;
    do
    {
      v6 = *((_BYTE *)&game_status_blob + v4);
      v7 = v5 + v6 * (v4 + 7 * v6);
      v5 += 111;
      v3 += v7 + 13;
      *((_BYTE *)&game_status_blob + v4) = v6 + v4 * (v4 * (7 * v4 + 15) + 3) + 111;
      ++v4;
    }
    while ( v5 < 0x10B18 );
    Buffer = v3;
    crt_fwrite(&game_status_blob, 0x268u, 1u, v2);
    crt_fwrite(&Buffer, 4u, 1u, v2);
    crt_fclose(v2);
    if ( *(float *)(cv_verbose + 12) != 0.0 )
      console_printf(&console_log_queue, aGameSavestatus);
    game_load_status();
    game_sequence_load();
    game_sequence_load();
  }
  else
  {
    console_printf(&console_log_queue, aGameSavestatus_0);
    game_sequence_load();
  }
}

// game_load_status @ 0x00412C10
// loads status file; regenerates on failure
void game_load_status()
{
  char *v0; // eax
  FILE *v1; // eax
  FILE *v2; // ebp
  unsigned int v3; // esi
  int v4; // edi
  int v5; // ecx
  char v6; // al
  unsigned int v7; // edx
  int Buffer; // [esp+8h] [ebp-4h] BYREF

  v0 = game_build_path(game_status_filename);
  v1 = crt_fopen(v0, file_mode_read_binary);
  v2 = v1;
  v3 = 0;
  if ( v1 )
  {
    crt_fseek(v1, 0, 2);
    if ( crt_ftell(v2) == 620 )
    {
      crt_fseek(v2, 0, 0);
      crt_fread(&game_status_blob, 0x268u, 1u, v2);
      Buffer = 0;
      crt_fread(&Buffer, 4u, 1u, v2);
      v4 = 0;
      v5 = 0;
      do
      {
        v6 = -111 - v5 * (v5 * (7 * v5 + 15) + 3) + *((_BYTE *)&game_status_blob + v5);
        *((_BYTE *)&game_status_blob + v5) = v6;
        v7 = v3 + v6 * (v5 + 7 * v6);
        v3 += 111;
        ++v5;
        v4 += v7 + 13;
      }
      while ( v3 < 0x10B18 );
      if ( v4 == Buffer )
      {
        quest_unlock_index = (unsigned __int16)game_status_blob;
        quest_unlock_index_full = HIWORD(game_status_blob);
        crt_fclose(v2);
        if ( *(float *)(cv_verbose + 12) != 0.0 )
          console_printf(&console_log_queue, aGameLoadstatus_1);
      }
      else
      {
        crt_fclose(v2);
        console_printf(&console_log_queue, aGameLoadstatus_0);
        game_sequence_load();
      }
    }
    else
    {
      crt_fclose(v2);
      console_printf(&console_log_queue, aGameLoadstatus);
      game_sequence_load();
    }
  }
  else
  {
    console_printf(&console_log_queue, aGameLoadstatus_2);
    console_printf(&console_log_queue, aGeneratingNewF);
    game_status_blob = 0;
    game_sequence_load();
    game_save_status();
    game_sequence_load();
  }
}

// gameplay_reset_state @ 0x00412DC0
// resets gameplay/session globals, pools, and availability tables
void gameplay_reset_state()
{
  _DWORD *v0; // eax
  int v1; // eax
  int *v2; // eax
  int *v3; // eax
  char *v4; // eax
  char *v5; // eax
  _BYTE *v6; // eax
  int v7; // edi
  char *v8; // esi
  int v9; // ecx
  int *v10; // eax
  int v11; // [esp+18h] [ebp-8h]
  int v12; // [esp+1Ch] [ebp-4h]

  v0 = &bonus_hud_slot_y;
  byte_48727C = 0;
  do
  {
    v0[6] = 1084227584;
    *((_BYTE *)v0 - 4) = 0;
    *v0 = 0;
    v0[5] = 1;
    v0[4] = aEmpty;
    v0[1] = 1065353216;
    v0 += 8;
  }
  while ( (int)v0 < (int)dword_48F78C );
  quest_spawn_timeline = 0;
  shock_chain_links_left = 0;
  dword_486FB8 = 1;
  creature_spawned_count = 0;
  survival_recent_death_count = 0;
  survival_reward_damage_seen = 0;
  survival_reward_fire_seen = 0;
  byte_486FA9 = 1;
  survival_reward_handout_enabled = 1;
  tutorial_stage_index = -1;
  tutorial_stage_timer = 0;
  tutorial_stage_transition_timer = -1000;
  dword_487088 = -1;
  bonus_double_xp_timer = 0.0;
  survival_spawn_stage = 0;
  camera_shake_pulses = 0;
  FUN_00412940();
  dword_482940 = 6;
  creature_type_table[0] = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                             grim_interface_ptr,
                             aZombie);
  LODWORD(creature_type_sfx_b0) = sfx_zombie_attack_01;
  creature_type_sfx_b1 = sfx_zombie_attack_02;
  LODWORD(creature_type_sfx_a0) = sfx_zombie_die_01;
  creature_type_sfx_a1 = sfx_zombie_die_02;
  dword_482748 = 1065353216;
  creature_type_anim_rate[0] = 1067030938;
  creature_type_sfx_a2 = sfx_zombie_die_03;
  creature_type_sfx_a3 = sfx_zombie_die_04;
  creature_type_base_frame[0] = 32;
  creature_type_corpse_frame[0] = 0;
  dword_48276C = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, aLizard);
  dword_482784 = sfx_lizard_attack_02;
  dword_482780 = sfx_lizard_attack_01;
  dword_482770 = sfx_lizard_die_01;
  dword_482778 = sfx_lizard_die_03;
  dword_48278C = 1065353216;
  dword_4827A0 = 1070386381;
  dword_482774 = sfx_lizard_die_02;
  dword_48277C = sfx_lizard_die_04;
  dword_4827AC = 1;
  dword_4827A4 = 16;
  dword_4827A8 = 3;
  dword_4827F4 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                   grim_interface_ptr,
                   aSpiderSp1);
  dword_482808 = sfx_spider_attack_01;
  dword_48280C = sfx_spider_attack_02;
  dword_482814 = 1065353216;
  dword_482828 = 1069547520;
  dword_4827F8 = sfx_spider_die_01;
  dword_4827FC = sfx_spider_die_02;
  dword_482800 = sfx_spider_die_03;
  dword_482804 = sfx_spider_die_04;
  dword_482834 = 1;
  dword_48282C = 16;
  dword_482830 = 1;
  dword_482838 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                   grim_interface_ptr,
                   aSpiderSp2);
  dword_482850 = sfx_spider_attack_02;
  dword_48284C = sfx_spider_attack_01;
  dword_48283C = sfx_spider_die_01;
  dword_482844 = sfx_spider_die_03;
  dword_482858 = 1065353216;
  dword_48286C = 1069547520;
  dword_482840 = sfx_spider_die_02;
  dword_482848 = sfx_spider_die_04;
  dword_482878 = 1;
  dword_482870 = 16;
  dword_482874 = 2;
  dword_4827B0 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, aAlien);
  dword_4827C4 = sfx_alien_attack_01;
  dword_4827C8 = sfx_alien_attack_02;
  dword_4827B4 = sfx_alien_die_01;
  dword_4827B8 = sfx_alien_die_02;
  dword_4827BC = sfx_alien_die_03;
  dword_4827C0 = sfx_alien_die_04;
  dword_482880 = sfx_trooper_die_01;
  dword_4827D0 = 1065353216;
  dword_4827E4 = 1068289229;
  dword_4827F0 = 0;
  dword_4827E8 = 32;
  dword_4827EC = 4;
  dword_482884 = sfx_trooper_die_02;
  dword_482888 = sfx_trooper_die_03;
  dword_4828B8 = 7;
  dword_48287C = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                   grim_interface_ptr,
                   aTrooper);
  perk_choices_dirty = 1;
  bonus_spawn_guard = 0;
  memset(dword_48708C, 0, sizeof(dword_48708C));
  *(float *)&v11 = (double)terrain_texture_width * 0.5;
  camera_offset_x = v11;
  *(float *)&v12 = (double)terrain_texture_height * 0.5;
  camera_offset_y = v12;
  weapon_table_init();
  weapon_refresh_available();
  perks_rebuild_available();
  effect_defaults_reset();
  perk_pending_count = 0;
  survival_spawn_cooldown = 0;
  creatures_any_active_flag = 0;
  time_scale_active = 0;
  time_scale_factor = 1065353216;
  bonus_reflex_boost_timer = 0.0;
  bonus_weapon_power_up_timer = 0;
  bonus_energizer_timer = 0.0;
  plaguebearer_infection_count = 0;
  dword_487268 = -1;
  highscore_full_version_marker = 0;
  survival_elapsed_ms = 0;
  highscore_score_xp = 0;
  highscore_record_quest_minor = 0;
  highscore_record_quest_major = 0;
  highscore_record_game_mode = 0;
  highscore_record_weapon_id = 0;
  creature_kill_count = 0;
  highscore_record_shots_hit = 0;
  highscore_record_shots_fired = 0;
  byte_487081 = 0;
  highscore_year_offset = 0;
  highscore_month = 0;
  highscore_day = 0;
  highscore_flags = 0;
  v1 = crt_rand();
  dword_4AAF24 = 0;
  dword_487078 = v1 & 0xFEE050F;
  bonus_freeze_timer = 0.0;
  flt_4AAF1C = 0.0;
  flt_4AAF2C = -1.0;
  perk_prompt_timer = 0;
  projectile_reset_pools();
  FUN_0041fc80();
  dword_4871D0[0] = 0;
  dword_4871D4 = 0;
  v2 = player_low_health_timer;
  do
  {
    v2[5] = -1082130432;
    v2[6] = -1082130432;
    *v2 = 1120403456;
    v2[3] = 0;
    v2 += 216;
  }
  while ( (int)v2 < (int)dword_491280 );
  v3 = bonus_pool;
  do
  {
    *v3 = 0;
    v3 += 7;
  }
  while ( (int)v3 < (int)&quest_spawn_count );
  v4 = projectile_pool;
  do
  {
    *v4 = 0;
    v4 += 64;
  }
  while ( (int)v4 < (int)particle_pool );
  v5 = sprite_effect_pool;
  do
  {
    *v5 = 0;
    v5 += 44;
  }
  while ( (int)v5 < (int)byte_49AA20 );
  v6 = &secondary_projectile_pool;
  do
  {
    *v6 = 0;
    v6 += 44;
  }
  while ( (int)v6 < (int)&dword_4965D8 );
  v7 = 0;
  v8 = creature_target_player;
  do
  {
    v9 = config_player_count;
    *((_DWORD *)v8 - 14) = 0;
    *(v8 - 112) = 0;
    if ( v9 )
      *v8 = v7 % v9;
    else
      *v8 = 0;
    *(v8 - 104) = 1;
    *((_DWORD *)v8 + 7) = 0;
    v8 += 152;
    ++v7;
    *((float *)v8 - 29) = (float)(crt_rand() % 31);
  }
  while ( (int)v8 < (int)byte_4AA3A8 );
  v10 = creature_spawn_slot_table;
  do
  {
    *v10 = 0;
    v10 += 6;
  }
  while ( (int)v10 < (int)&SubKey );
  fx_queue_rotated = 0;
  fx_queue_count = 0;
  highscore_full_version_marker = 0;
  survival_elapsed_ms = 0;
  highscore_score_xp = 0;
  highscore_record_quest_minor = 0;
  highscore_record_quest_major = 0;
  highscore_record_game_mode = 0;
  highscore_record_weapon_id = 0;
  creature_kill_count = 0;
  highscore_record_shots_hit = 0;
  highscore_record_shots_fired = 0;
  byte_487081 = 0;
  highscore_year_offset = 0;
  highscore_month = 0;
  highscore_day = 0;
  highscore_flags = 0;
  dword_487078 = crt_rand() & 0xFEE050F;
  terrain_generate_random();
}

// player_start_reload @ 0x00413430
// starts reload for the active player, sets timers, and plays SFX
void player_start_reload()
{
  int v0; // eax
  int v3; // eax

  v0 = render_overlay_player_index;
  if ( player_reload_active[864 * render_overlay_player_index] )
  {
    if ( perk_count_get(perk_id_ammunition_within) || perk_count_get(perk_id_regression_bullets) )
      return;
    v0 = render_overlay_player_index;
  }
  _ECX = 216 * v0;
  if ( !player_reload_active[864 * v0] )
  {
    sfx_play_panned(*(&sfx_id + 31 * player_weapon_id[216 * v0]));
    _ECX = 216 * render_overlay_player_index;
    player_reload_active[864 * render_overlay_player_index] = 1;
  }
  _EDX = 31 * player_weapon_id[_ECX];
  v3 = perk_id_fastloader;
  __asm
  {
    fld     flt_4D7A78[edx*4]
    fst     dword ptr [ecx+490B80h]
  }
  *(float *)(_ECX * 4 + 4787072) = _ET1;
  if ( (int)*(&player_perk_counts + v3) <= 0 )
  {
    __asm { fstp    st }
  }
  else
  {
    __asm
    {
      fmul    ds:flt_46F334
      fstp    dword ptr [ecx+490B80h]
    }
    *(float *)(_ECX * 4 + 4787072) = _ET1;
  }
  __asm
  {
    fld     bonus_weapon_power_up_timer
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) == 0 )
  {
    __asm
    {
      fld     dword ptr [ecx+490B80h]
      fmul    ds:flt_46F33C
      fstp    dword ptr [ecx+490B80h]
    }
    *(float *)(_ECX * 4 + 4787072) = _ET1;
  }
  player_reload_timer_max[_ECX] = player_reload_timer[_ECX];
}

// sub_413540 @ 0x00413540
double __cdecl sub_413540(float a1)
{
  int v1; // ecx
  double v2; // st7
  double v3; // st7
  double v4; // st7
  double v5; // st6
  double result; // st7
  unsigned __int8 v8; // c0
  unsigned __int8 v9; // c3
  double v10; // st6
  double v11; // st6
  int v12; // [esp+0h] [ebp-8h]
  float v13; // [esp+4h] [ebp-4h]
  float v14; // [esp+4h] [ebp-4h]
  int v15; // [esp+4h] [ebp-4h]

  v1 = 864 * render_overlay_player_index;
  if ( *(float *)&player_heading[216 * render_overlay_player_index] < 0.0 )
  {
    do
    {
      v2 = *(float *)(v1 + 4786396) + 6.2831855;
      *(float *)(v1 + 4786396) = v2;
    }
    while ( v2 < 0.0 );
  }
  if ( *(float *)(v1 + 4786396) > 6.2831855 )
  {
    do
    {
      v3 = *(float *)(v1 + 4786396) - 6.2831855;
      *(float *)(v1 + 4786396) = v3;
    }
    while ( v3 > 6.2831855 );
  }
  v13 = a1 - *(float *)(v1 + 4786396);
  v4 = *(float *)(v1 + 4786396);
  v12 = LODWORD(v13) & 0x7FFFFFFF;
  if ( a1 > v4 )
    v4 = a1;
  v5 = *(float *)(v1 + 4786396);
  if ( a1 < v5 )
    v5 = a1;
  v14 = 6.2831855 - v4 + v5;
  v15 = LODWORD(v14) & 0x7FFFFFFF;
  if ( *(float *)&v12 >= (double)*(float *)&v15 )
    result = *(float *)&v15;
  else
    result = *(float *)&v12;
  if ( v8 | v9 )
  {
    v10 = frame_dt * result;
    if ( a1 > (double)*(float *)(v1 + 4786396) )
    {
      v11 = v10 * 5.0;
      goto LABEL_18;
    }
LABEL_17:
    v11 = v10 * -5.0;
    goto LABEL_18;
  }
  v10 = frame_dt * result;
  if ( a1 >= (double)*(float *)(v1 + 4786396) )
    goto LABEL_17;
  v11 = v10 * 5.0;
LABEL_18:
  flt_487198 = v11;
  *(float *)(v1 + 4786396) = flt_487198 + *(float *)(v1 + 4786396);
  return result;
}

// player_update @ 0x004136B0
// per-player gameplay update: movement, firing, status timers, and effects
void player_update()
{
  float *v0; // ebp
  int v2; // edi
  float v11; // ebp
  char v12; // al
  int v23; // ebp
  int v24; // ebx
  float v33; // eax
  int v36; // eax
  int v41; // ebp
  int v42; // ebx
  int v47; // edx
  int v48; // eax
  int v51; // edx
  int v55; // eax
  char v91; // bl
  int v94; // eax
  int v95; // eax
  int v101; // eax
  int v102; // eax
  int v140; // eax
  int v160; // eax
  int v179; // ebx
  int v180; // ebp
  int v183; // eax
  int v186; // eax
  int v194; // eax
  int v195; // ecx
  int v202; // edx
  char v209; // bl
  int v214; // ecx
  float *v216; // ecx
  float *v219; // ecx
  char v224; // al
  char v225; // al
  int v226; // eax
  int v230; // ebp
  float v232; // ecx
  int v234; // eax
  int v237; // ebx
  int v239; // edx
  int v241; // eax
  int v246; // ebx
  int v247; // eax
  int v248; // eax
  int v249; // eax
  int v250; // eax
  int v251; // eax
  int v252; // eax
  int v253; // eax
  int v254; // eax
  int v255; // eax
  int v256; // eax
  int v258; // ebx
  int v259; // eax
  bool v260; // zf
  int v262; // eax
  int v264; // ebx
  int v265; // eax
  int v267; // eax
  int v268; // eax
  int v270; // ebx
  int v271; // eax
  int v273; // eax
  int v274; // eax
  int v275; // eax
  int v276; // eax
  int v278; // ebx
  int v279; // eax
  int v281; // eax
  int v282; // eax
  int v284; // ebx
  int v285; // eax
  int v287; // eax
  int v288; // eax
  int v289; // eax
  int v290; // eax
  int v291; // eax
  float v293; // ebx
  int v295; // eax
  int v296; // eax
  int v297; // eax
  int v299; // ebx
  int v300; // eax
  int v329; // [esp+14h] [ebp-68h]
  float angle; // [esp+18h] [ebp-64h]
  float anglea; // [esp+18h] [ebp-64h]
  float angleb; // [esp+18h] [ebp-64h]
  float anglec; // [esp+18h] [ebp-64h]
  float angled; // [esp+18h] [ebp-64h]
  float anglee; // [esp+18h] [ebp-64h]
  float anglef; // [esp+18h] [ebp-64h]
  float angleg; // [esp+18h] [ebp-64h]
  float angleh; // [esp+18h] [ebp-64h]
  float anglei; // [esp+18h] [ebp-64h]
  float anglej; // [esp+18h] [ebp-64h]
  float anglek; // [esp+18h] [ebp-64h]
  float anglel; // [esp+18h] [ebp-64h]
  int v343; // [esp+1Ch] [ebp-60h]
  int v344; // [esp+1Ch] [ebp-60h]
  float v345; // [esp+1Ch] [ebp-60h]
  float *v346; // [esp+24h] [ebp-58h]
  char v347; // [esp+36h] [ebp-46h]
  char v348; // [esp+37h] [ebp-45h]
  int v349; // [esp+38h] [ebp-44h]
  float v351; // [esp+38h] [ebp-44h]
  int owner_id; // [esp+3Ch] [ebp-40h]
  int owner_ida; // [esp+3Ch] [ebp-40h]
  int owner_idb; // [esp+3Ch] [ebp-40h]
  int v367; // [esp+40h] [ebp-3Ch]
  int v368; // [esp+40h] [ebp-3Ch]
  int v369; // [esp+40h] [ebp-3Ch]
  int v371; // [esp+40h] [ebp-3Ch]
  int v372; // [esp+40h] [ebp-3Ch]
  int v373; // [esp+40h] [ebp-3Ch]
  int v378; // [esp+40h] [ebp-3Ch]
  int v379; // [esp+40h] [ebp-3Ch]
  int v381; // [esp+40h] [ebp-3Ch]
  int v383; // [esp+40h] [ebp-3Ch]
  int v385; // [esp+40h] [ebp-3Ch]
  float v389; // [esp+40h] [ebp-3Ch]
  int v391; // [esp+40h] [ebp-3Ch]
  int v392; // [esp+44h] [ebp-38h]
  int v393; // [esp+44h] [ebp-38h]
  float v395; // [esp+44h] [ebp-38h]
  int v396; // [esp+44h] [ebp-38h]
  int v399; // [esp+44h] [ebp-38h]
  int v401; // [esp+44h] [ebp-38h]
  int v404; // [esp+44h] [ebp-38h]
  float v405; // [esp+48h] [ebp-34h]
  float v406; // [esp+48h] [ebp-34h]
  float arg1[2]; // [esp+4Ch] [ebp-30h] BYREF
  int v408; // [esp+54h] [ebp-28h]
  int v409; // [esp+58h] [ebp-24h]
  float arg2; // [esp+5Ch] [ebp-20h] BYREF
  float v411; // [esp+60h] [ebp-1Ch] BYREF
  float pos; // [esp+64h] [ebp-18h] BYREF
  float v413; // [esp+68h] [ebp-14h]
  float vel; // [esp+6Ch] [ebp-10h] BYREF
  float v415; // [esp+70h] [ebp-Ch]
  int v416; // [esp+74h] [ebp-8h]
  int v417; // [esp+78h] [ebp-4h]

  if ( console_open_flag )
    return;
  _EAX = render_overlay_player_index;
  v2 = 3 * render_overlay_player_index;
  dword_4871F4[2 * render_overlay_player_index] = LODWORD(ui_mouse_x);
  dword_4871F8[2 * _EAX] = ui_mouse_y;
  _EDI = (char *)&unk_4908B0 + 288 * v2;
  _ESI = (float *)(_EDI + 20);
  v408 = *((int *)_EDI + 5);
  v409 = *((_DWORD *)_EDI + 6);
  __asm
  {
    fld     dword ptr [edi+24h]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_EAX & 0x4100) != 0 )
  {
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F2B4
      fsubr   dword ptr [edi+10h]
      fstp    dword ptr [edi+10h]
    }
    *((float *)_EDI + 4) = _ET1;
    return;
  }
  __asm
  {
    fld     dword ptr [edi+314h]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) == 0 )
  {
    __asm
    {
      fld     dword ptr [edi+5Ch]
      fadd    ds:flt_46F224
      fstp    dword ptr [edi+5Ch]
    }
    *((float *)_EDI + 23) = _ET1;
  }
  v346 = v0;
  if ( *((_DWORD *)_EDI + 196) != 1120403456 )
  {
    __asm
    {
      fld     dword ptr [edi+24h]
      fcomp   ds:flt_46F2B4
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
    {
      __asm
      {
        fld     dword ptr [edi+310h]
        fsub    frame_dt
        fst     dword ptr [edi+310h]
      }
      *((float *)_EDI + 196) = _ET1;
      __asm
      {
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
      {
        __asm
        {
          fld     dword ptr [edi+300h]
          fadd    ds:flt_46F220
        }
        __asm
        {
          fsub    ds:flt_46F24C
          fcos
          fmul    ds:flt_46F53C
          fld     dword ptr [edi+300h]
          fadd    ds:flt_46F220
          fsub    ds:flt_46F24C
          fsin
          fmul    ds:flt_46F53C
          fstp    [esp+5Ch+var_14]
        }
        __asm { fadd    dword ptr [esi] }
        v11 = *((float *)_EDI + 192);
        __asm
        {
          fstp    [esp+64h+pos]
          fld     [esp+64h+var_14]
          fadd    dword ptr [esi+4]
          fstp    [esp+64h+var_14]
        }
        effect_spawn_blood_splatter(&pos, v11, 0.0);
        effect_spawn_blood_splatter(&pos, v11, 0.0);
        effect_spawn_blood_splatter(&pos, v11, 0.0);
        v12 = crt_rand();
        sfx_play_panned(COERCE_FLOAT(sfx_bloodspill_01 + (v12 & 1)));
        *((_DWORD *)_EDI + 196) = 1065353216;
      }
    }
  }
  __asm
  {
    fld     frame_dt
    fadd    st, st
  }
  _ECX = (float *)(_EDI + 764);
  v405 = *(float *)&_ECX;
  __asm
  {
    fsubr   dword ptr [ecx]
    fst     dword ptr [ecx]
  }
  *_ECX = _ET1;
  __asm
  {
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
    *_ECX = 0.0;
  __asm
  {
    fld     bonus_weapon_power_up_timer
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0 )
  {
    __asm
    {
      fld     dword ptr [edi+2D4h]
      fsub    frame_dt
    }
  }
  else
  {
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F338
      fsubr   dword ptr [edi+2D4h]
    }
  }
  __asm { fstp    dword ptr [edi+2D4h] }
  *((float *)_EDI + 181) = _ET1;
  __asm
  {
    fld     dword ptr [edi+2D4h]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
    *((_DWORD *)_EDI + 181) = 0;
  if ( perk_count_get(perk_id_man_bomb) )
  {
    __asm
    {
      fld     frame_dt
      fadd    dword ptr [edi+0A0h]
      fst     dword ptr [edi+0A0h]
    }
    *((float *)_EDI + 40) = _ET1;
    __asm
    {
      fcomp   flt_473310
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
    {
      _ECX = cv_friendlyFire;
      __asm
      {
        fld     dword ptr [ecx+0Ch]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4000) != 0 )
        v23 = -100;
      else
        v23 = -1 - render_overlay_player_index;
      v24 = 0;
      v392 = 0;
      do
      {
        if ( (v24 & 1) != 0 )
        {
          v343 = 21;
          v367 = crt_rand() % 50;
          __asm { fild    [esp+60h+var_3C] }
        }
        else
        {
          v343 = 22;
          v368 = crt_rand() % 50;
          __asm { fild    [esp+60h+var_3C] }
        }
        __asm
        {
          fmul    ds:flt_46F300
          fild    [esp+60h+var_38]
        }
        __asm
        {
          fmul    ds:flt_46F538
          faddp   st(1), st
          fsub    ds:flt_46F534
          fstp    [esp+64h+angle]; angle
        }
        projectile_spawn((float *)_EDI + 5, angle, v343, v23);
        v392 = ++v24;
      }
      while ( v24 < 8 );
      sfx_play_panned(sfx_explosion_small);
      __asm
      {
        fld     dword ptr [edi+0A0h]
        fsub    flt_473310
      }
      __asm { fstp    dword ptr [edi+0A0h] }
      *((float *)_EDI + 40) = _ET1;
      flt_473310 = 4.0;
    }
  }
  else
  {
    *((_DWORD *)_EDI + 40) = 0;
  }
  if ( perk_count_get(perk_id_living_fortress) )
  {
    __asm
    {
      fld     frame_dt
      fadd    dword ptr [edi+0A4h]
      fst     dword ptr [edi+0A4h]
    }
    *((float *)_EDI + 41) = _ET1;
    __asm
    {
      fcomp   ds:flt_46F4B0
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
      *((_DWORD *)_EDI + 41) = 1106247680;
  }
  else
  {
    *((_DWORD *)_EDI + 41) = 0;
  }
  if ( perk_count_get(perk_id_fire_caugh) )
  {
    __asm
    {
      fld     frame_dt
      fadd    dword ptr [edi+0A8h]
      fst     dword ptr [edi+0A8h]
    }
    *((float *)_EDI + 42) = _ET1;
    __asm
    {
      fcomp   flt_473314
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
    {
      _EDX = cv_friendlyFire;
      __asm
      {
        fld     dword ptr [edx+0Ch]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4000) != 0 )
        owner_id = -100;
      else
        owner_id = -1 - render_overlay_player_index;
      sfx_play_panned(flt_4D9050);
      sfx_play_panned(flt_4D7FD8);
      v392 = *((_DWORD *)_EDI + 192);
      __asm
      {
        fld     [esp+70h+var_38]
        fsub    ds:flt_46F220
      }
      __asm { fsub    ds:flt_46F530 }
      _EBP = 864 * render_overlay_player_index;
      __asm
      {
        fld     st
        fcos
      }
      v33 = *(float *)&player_aim_x[216 * render_overlay_player_index];
      v411 = *(float *)&player_aim_y[216 * render_overlay_player_index];
      _EBX = &player_pos_x[216 * render_overlay_player_index];
      arg2 = v33;
      __asm
      {
        fmul    ds:flt_46F230
        fstp    [esp+74h+pos]
        fsin
        fmul    ds:flt_46F230
        fstp    [esp+74h+var_14]
        fld     [esp+74h+var_1C]
        fsub    dword ptr [ebx+4]
        fld     [esp+74h+arg2]
        fsub    dword ptr [ebx]
        fstp    [esp+74h+vel]
        fstp    [esp+74h+var_C]
      }
      sub_417660(&vel);
      __asm { fmul    ds:flt_46F24C }
      __asm { fstp    [esp+58h+arg1] }
      v369 = crt_rand() & 0x1FF;
      __asm
      {
        fild    [esp+58h+var_3C]
        fmul    ds:flt_46F52C
        fstp    [esp+58h+var_3C]
      }
      v349 = crt_rand() & 0x1FF;
      __asm
      {
        fild    [esp+58h+var_44]
        fld     [esp+58h+arg1]
        fmul    dword ptr [ebp+490B68h]
      }
      __asm
      {
        fmulp   st(1), st
        fmul    ds:flt_46F528
        fld     [esp+60h+var_3C]
        fcos
        fmul    st, st(1)
        fadd    [esp+60h+arg2]
        fstp    [esp+60h+arg2]
        fld     [esp+60h+var_3C]
        fsin
        fmul    st, st(1)
        fadd    [esp+60h+var_1C]
        fstp    [esp+60h+var_1C]
        fstp    st
      }
      _EAX = FUN_00417640(arg1, &arg2, v346);
      __asm
      {
        fld     dword ptr [eax]
        fld     dword ptr [eax+4]
        fxch    st(1)
        fpatan
      }
      __asm
      {
        fsub    ds:flt_46F220
        fstp    [esp+60h+arg1]
        fld     [esp+60h+var_14]
        fadd    dword ptr [esi+4]
        fld     [esp+60h+pos]
        fadd    dword ptr [esi]
      }
      __asm
      {
        fstp    [esp+68h+vel]
        fstp    [esp+68h+var_C]
      }
      projectile_spawn(&vel, arg1[0], 45, owner_id);
      __asm
      {
        fld     [esp+68h+var_38]
        fcos
      }
      __asm
      {
        fmul    ds:flt_46F524
        fstp    [esp+74h+vel]
        fld     [esp+74h+var_38]
        fsin
        fmul    ds:flt_46F524
        fstp    [esp+74h+var_C]
        fld     [esp+74h+var_14]
        fadd    dword ptr [esi+4]
        fld     [esp+74h+pos]
        fadd    dword ptr [esi]
        fstp    [esp+74h+pos]
        fstp    [esp+74h+var_14]
      }
      v36 = 11 * fx_spawn_sprite(&pos, &vel, 1.0);
      sprite_effect_color_r[v36] = 1056964608;
      sprite_effect_color_g[v36] = 1056964608;
      sprite_effect_color_b[v36] = 1056964608;
      sprite_effect_color_a[v36] = 1054045372;
      __asm
      {
        fld     dword ptr [edi+0A8h]
        fsub    flt_473314
        fstp    dword ptr [edi+0A8h]
      }
      *((float *)_EDI + 42) = _ET1;
      LODWORD(arg1[0]) = crt_rand() % 4;
      __asm
      {
        fild    [esp+58h+arg1]
        fadd    ds:flt_46F238
        fstp    flt_473314
      }
    }
  }
  else
  {
    *((_DWORD *)_EDI + 42) = 0;
  }
  if ( perk_count_get(perk_id_hot_tempered) )
  {
    __asm
    {
      fld     frame_dt
      fadd    dword ptr [edi+9Ch]
      fst     dword ptr [edi+9Ch]
    }
    *((float *)_EDI + 39) = _ET1;
    __asm
    {
      fcomp   flt_473318
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
    {
      _EAX = cv_friendlyFire;
      __asm
      {
        fld     dword ptr [eax+0Ch]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_EAX & 0x4000) != 0 )
        v41 = -100;
      else
        v41 = -1 - render_overlay_player_index;
      v42 = 0;
      v392 = 0;
      do
      {
        if ( (v42 & 1) != 0 )
          v344 = 9;
        else
          v344 = 11;
        __asm { fild    [esp+60h+var_38] }
        __asm
        {
          fmul    ds:flt_46F538
          fstp    [esp+64h+angle]; angle
        }
        projectile_spawn((float *)_EDI + 5, anglea, v344, v41);
        v392 = ++v42;
      }
      while ( v42 < 8 );
      sfx_play_panned(sfx_explosion_small);
      __asm
      {
        fld     dword ptr [edi+9Ch]
        fsub    flt_473318
      }
      __asm { fstp    dword ptr [edi+9Ch] }
      *((float *)_EDI + 39) = _ET1;
      LODWORD(arg1[0]) = crt_rand() % 8;
      __asm
      {
        fild    [esp+58h+arg1]
        fadd    ds:flt_46F238
        fstp    flt_473318
      }
    }
  }
  else
  {
    *((_DWORD *)_EDI + 39) = 0;
  }
  __asm
  {
    fld     flt_4AAF34
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0 )
  {
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F2A4
      fadd    flt_473A40
      fst     flt_473A40
      fcomp   ds:flt_46F224
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
      flt_473A40 = 1.0;
  }
  else
  {
    __asm
    {
      fld     flt_473A40
      fsub    frame_dt
      fst     flt_473A40
      fcomp   ds:flt_46F258
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
      flt_473A40 = 0.30000001;
  }
  v47 = *((_DWORD *)_EDI + 23);
  pos = 0.0;
  v413 = 0.0;
  *((_DWORD *)_EDI + 7) = 0;
  *((float *)_EDI + 8) = v413;
  v371 = v47;
  if ( time_scale_active )
  {
    __asm
    {
      fld     ds:flt_46F33C
      fdiv    time_scale_factor
      fmul    frame_dt
      fstp    frame_dt
    }
  }
  v48 = render_overlay_player_index;
  if ( demo_mode_active
    || config_player_mode_flags[render_overlay_player_index] == 5
    || config_aim_scheme[render_overlay_player_index] == 5 )
  {
    if ( *((int *)_EDI + 200) < 0 )
      *((_DWORD *)_EDI + 200) = 0;
    _ECX = 152 * *((_DWORD *)_EDI + 200);
    if ( !creature_pool[_ECX] )
      goto LABEL_67;
    __asm
    {
      fld     dword ptr [ecx+49BF5Ch]
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
LABEL_67:
      __asm { fld     ds:flt_46F520 }
    }
    else
    {
      __asm
      {
        fld     dword ptr [esi+4]
        fsub    dword ptr [ecx+49BF50h]
        fld     dword ptr [esi]
        fsub    dword ptr [ecx+49BF4Ch]
        fld     st
        fmul    st, st(1)
        fld     st(2)
        fmul    st, st(3)
        faddp   st(1), st
        fsqrt
        fstp    st(2)
        fstp    st
      }
    }
    v51 = 0;
    _ECX = creature_pool;
    do
    {
      if ( *_ECX )
      {
        __asm
        {
          fld     dword ptr [ecx+24h]
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4100) == 0 )
        {
          __asm
          {
            fld     dword ptr [esi+4]
            fsub    dword ptr [ecx+18h]
            fld     dword ptr [esi]
            fsub    dword ptr [ecx+14h]
            fld     st
            fmul    st, st(1)
            fld     st(2)
            fmul    st, st(3)
            faddp   st(1), st
            fsqrt
            fstp    st(2)
            fstp    st
            fst     [esp+58h+arg1]
            fld     st(1)
            fsub    ds:flt_46F2AC
            fxch    st(1)
            fcompp
            fnstsw  ax
          }
          if ( (_AX & 0x100) != 0 )
          {
            __asm { fstp    st }
            *((_DWORD *)_EDI + 200) = v51;
            __asm { fld     [esp+58h+arg1] }
          }
        }
      }
      _ECX += 152;
      ++v51;
    }
    while ( (int)_ECX < (int)byte_4AA338 );
    __asm { fstp    st }
    if ( demo_mode_active )
      goto LABEL_216;
    v48 = render_overlay_player_index;
  }
  v55 = config_player_mode_flags[v48];
  if ( v55 == 5 )
  {
LABEL_216:
    v140 = *((_DWORD *)_EDI + 200);
    if ( v140 < 0 )
      goto LABEL_222;
    _EDX = 19 * v140;
    __asm
    {
      fld     creature_health[edx*8]
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
LABEL_222:
      __asm
      {
        fld     dword ptr [esi+4]
        fsub    ds:flt_46F46C
        fld     dword ptr [esi]
        fsub    ds:flt_46F46C
        fpatan
        fadd    ds:flt_46F378
      }
    }
    else
    {
      __asm
      {
        fld     dword ptr [esi+4]
        fsub    ds:flt_46F46C
        fld     dword ptr [esi]
        fsub    ds:flt_46F46C
        fld     st
        fmul    st, st(1)
        fld     st(2)
        fmul    st, st(3)
        faddp   st(1), st
        fsqrt
        fstp    st(2)
        fstp    st
        fcomp   ds:flt_46F3E0
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
      {
        __asm { fld     dword ptr [esi+4] }
        _EAX = 19 * *((_DWORD *)_EDI + 200);
        __asm
        {
          fsub    creature_pos_y[eax*8]
          fld     dword ptr [esi]
          fsub    creature_pos_x[eax*8]
        }
        __asm { fstp    [esp+58h+arg2] }
        __asm { fstp    [esp+58h+var_1C] }
      }
      else
      {
        __asm
        {
          fld     dword ptr [esi+4]
          fsub    ds:flt_46F46C
          fld     dword ptr [esi]
          fsub    ds:flt_46F46C
          fstp    [esp+58h+arg2]
        }
        __asm { fstp    [esp+58h+var_1C] }
      }
      pos = arg2;
      v413 = v411;
      __asm
      {
        fld     [esp+58h+var_14]
        fld     [esp+58h+pos]
        fpatan
        fsub    ds:flt_46F220
      }
    }
    __asm
    {
      fst     [esp+58h+var_38]
      fcomp   ds:flt_46F36C
      fnstsw  ax
    }
    if ( (_AX & 0x4000) == 0 )
    {
      sub_413540(*(float *)&v399);
      if ( (int)*(&player_perk_counts + perk_id_long_distance_runner) <= 0 )
      {
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F288
          fadd    dword ptr [edi+68h]
          fst     dword ptr [edi+68h]
        }
        *((float *)_EDI + 26) = _ET1;
        __asm
        {
          fcomp   ds:flt_46F238
          fnstsw  ax
        }
        if ( (_AX & 0x4100) == 0 )
          *((_DWORD *)_EDI + 26) = 0x40000000;
      }
      else
      {
        __asm
        {
          fld     dword ptr [edi+68h]
          fcomp   ds:flt_46F238
          fnstsw  ax
        }
        if ( (_AX & 0x100) != 0 )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F25C
            fadd    dword ptr [edi+68h]
            fstp    dword ptr [edi+68h]
          }
          *((float *)_EDI + 26) = _ET1;
        }
        __asm
        {
          fld     frame_dt
          fadd    dword ptr [edi+68h]
          fst     dword ptr [edi+68h]
        }
        *((float *)_EDI + 26) = _ET1;
        __asm
        {
          fcomp   ds:flt_46F51C
          fnstsw  ax
        }
        if ( (_AX & 0x4100) == 0 )
          *((_DWORD *)_EDI + 26) = 1077097267;
      }
      if ( *((_DWORD *)_EDI + 176) == 7 )
      {
        __asm
        {
          fld     dword ptr [edi+68h]
          fcomp   ds:flt_46F2A4
          fnstsw  ax
        }
        if ( (_AX & 0x4100) == 0 )
          *((_DWORD *)_EDI + 26) = 1061997773;
      }
      __asm
      {
        fld     dword ptr [edi+2Ch]
        fsub    ds:flt_46F220
        fld     ds:flt_46F378
        fsub    st, st(2)
      }
      __asm
      {
        fstp    [esp+60h+var_38]
        fcos
        fstp    st(1)
        fmul    dword ptr [edi+68h]
        fmul    [esp+60h+var_38]
        fmul    [esp+60h+var_3C]
        fmul    ds:flt_46F518
        fstp    dword ptr [edi+1Ch]
      }
      *((float *)_EDI + 7) = _ET1;
      __asm
      {
        fld     dword ptr [edi+2Ch]
        fsub    ds:flt_46F220
        fsin
        fmul    dword ptr [edi+68h]
        fmul    [esp+60h+var_38]
        fmul    [esp+60h+var_3C]
        fmul    ds:flt_46F518
        fstp    dword ptr [edi+20h]
      }
      *((float *)_EDI + 8) = _ET1;
      __asm
      {
        fld     frame_dt
        fld     st
        fmul    dword ptr [edi+20h]
        fxch    st(1)
        fmul    dword ptr [edi+1Ch]
      }
      __asm
      {
        fstp    [esp+64h+vel]
        fstp    [esp+64h+var_C]
      }
      player_apply_move_with_spawn_avoidance(render_overlay_player_index, (float *)_EDI + 5, &vel);
      goto LABEL_239;
    }
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F360
      fsubr   dword ptr [edi+68h]
      fst     dword ptr [edi+68h]
    }
    *((float *)_EDI + 26) = _ET1;
    __asm
    {
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
      *((_DWORD *)_EDI + 26) = 0;
    __asm
    {
      fld     dword ptr [edi+2Ch]
      fsub    ds:flt_46F220
    }
    __asm
    {
      fcos
      fmul    dword ptr [edi+68h]
      fmul    [esp+58h+var_3C]
      fmul    ds:flt_46F524
      fstp    dword ptr [edi+1Ch]
    }
    *((float *)_EDI + 7) = _ET1;
    __asm
    {
      fld     dword ptr [edi+2Ch]
      fsub    ds:flt_46F220
      fsin
      fmul    dword ptr [edi+68h]
      fmul    [esp+58h+var_3C]
      fmul    ds:flt_46F524
      fstp    dword ptr [edi+20h]
    }
    *((float *)_EDI + 8) = _ET1;
    __asm
    {
      fld     frame_dt
      fld     st
      fmul    dword ptr [edi+20h]
      fxch    st(1)
      fmul    dword ptr [edi+1Ch]
      fstp    [esp+58h+vel]
      fstp    [esp+58h+var_C]
    }
    goto LABEL_238;
  }
  if ( v55 != 4 )
  {
    if ( v55 == 3 )
    {
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 132))(
        grim_interface_ptr,
        *((_DWORD *)_EDI + 215));
      __asm { fchs }
      __asm { fstp    [esp+5Ch+var_38] }
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 132))(
        grim_interface_ptr,
        *((_DWORD *)_EDI + 214));
      __asm
      {
        fchs
        fstp    [esp+58h+arg2]
        fld     [esp+58h+arg2]
        fmul    [esp+58h+arg2]
        fld     [esp+58h+var_38]
        fmul    [esp+58h+var_38]
      }
      v411 = v395;
      __asm
      {
        faddp   st(1), st
        fsqrt
        fcomp   ds:flt_46F23C
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
        goto LABEL_118;
      j_FUN_00452f1d(&arg2);
      __asm
      {
        fld     [esp+58h+var_1C]
        fld     [esp+58h+arg2]
        fpatan
        fsub    ds:flt_46F220
        fcom    ds:flt_46F228
        fst     [esp+58h+var_38]
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
      {
        do
        {
          __asm
          {
            fadd    ds:flt_46F3B0
            fcom    ds:flt_46F228
            fnstsw  ax
          }
        }
        while ( (_AX & 0x100) != 0 );
        __asm { fst     [esp+58h+var_38] }
      }
      __asm
      {
        fcomp   ds:flt_46F36C
        fnstsw  ax
      }
      if ( (_AX & 0x4000) != 0 )
      {
LABEL_118:
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F360
          fsubr   dword ptr [edi+68h]
          fst     dword ptr [edi+68h]
        }
        *((float *)_EDI + 26) = _ET1;
        __asm
        {
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x100) != 0 )
          *((_DWORD *)_EDI + 26) = 0;
        __asm
        {
          fld     dword ptr [edi+2Ch]
          fsub    ds:flt_46F220
        }
        __asm
        {
          fcos
          fmul    dword ptr [edi+68h]
          fmul    [esp+60h+var_3C]
          fmul    ds:flt_46F524
          fstp    dword ptr [edi+1Ch]
        }
        *((float *)_EDI + 7) = _ET1;
        __asm
        {
          fld     dword ptr [edi+2Ch]
          fsub    ds:flt_46F220
          fsin
          fmul    dword ptr [edi+68h]
          fmul    [esp+60h+var_3C]
          fmul    ds:flt_46F524
          fstp    dword ptr [edi+20h]
        }
        *((float *)_EDI + 8) = _ET1;
        __asm
        {
          fld     frame_dt
          fld     st
          fmul    dword ptr [edi+20h]
          fxch    st(1)
          fmul    dword ptr [edi+1Ch]
        }
        __asm
        {
          fstp    [esp+64h+vel]
          fstp    [esp+64h+var_C]
        }
        player_apply_move_with_spawn_avoidance(render_overlay_player_index, (float *)_EDI + 5, &vel);
      }
      else
      {
        sub_413540(*(float *)&v396);
        if ( (int)*(&player_perk_counts + perk_id_long_distance_runner) <= 0 )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F288
            fadd    dword ptr [edi+68h]
            fst     dword ptr [edi+68h]
          }
          *((float *)_EDI + 26) = _ET1;
          __asm
          {
            fcomp   ds:flt_46F238
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
            *((_DWORD *)_EDI + 26) = 0x40000000;
        }
        else
        {
          __asm
          {
            fld     dword ptr [edi+68h]
            fcomp   ds:flt_46F238
            fnstsw  ax
          }
          if ( (_AX & 0x100) != 0 )
          {
            __asm
            {
              fld     frame_dt
              fmul    ds:flt_46F25C
              fadd    dword ptr [edi+68h]
              fstp    dword ptr [edi+68h]
            }
            *((float *)_EDI + 26) = _ET1;
          }
          __asm
          {
            fld     frame_dt
            fadd    dword ptr [edi+68h]
            fst     dword ptr [edi+68h]
          }
          *((float *)_EDI + 26) = _ET1;
          __asm
          {
            fcomp   ds:flt_46F51C
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
            *((_DWORD *)_EDI + 26) = 1077097267;
        }
        if ( *((_DWORD *)_EDI + 176) == 7 )
        {
          __asm
          {
            fld     dword ptr [edi+68h]
            fcomp   ds:flt_46F2A4
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
            *((_DWORD *)_EDI + 26) = 1061997773;
        }
        __asm
        {
          fld     dword ptr [edi+2Ch]
          fsub    ds:flt_46F220
          fld     ds:flt_46F378
          fsub    st, st(2)
        }
        __asm
        {
          fstp    [esp+60h+var_38]
          fcos
          fstp    st(1)
          fmul    dword ptr [edi+68h]
          fmul    [esp+60h+var_38]
          fmul    [esp+60h+var_3C]
          fmul    ds:flt_46F518
          fstp    dword ptr [edi+1Ch]
        }
        *((float *)_EDI + 7) = _ET1;
        __asm
        {
          fld     dword ptr [edi+2Ch]
          fsub    ds:flt_46F220
          fsin
          fmul    dword ptr [edi+68h]
          fmul    [esp+60h+var_38]
          fmul    [esp+60h+var_3C]
          fmul    ds:flt_46F518
          fstp    dword ptr [edi+20h]
        }
        *((float *)_EDI + 8) = _ET1;
        __asm
        {
          fld     frame_dt
          fld     st
          fmul    dword ptr [edi+20h]
          fxch    st(1)
          fmul    dword ptr [edi+1Ch]
        }
        __asm
        {
          fstp    [esp+64h+vel]
          fstp    [esp+64h+var_C]
        }
        player_apply_move_with_spawn_avoidance(render_overlay_player_index, (float *)_EDI + 5, &vel);
      }
      goto LABEL_239;
    }
    if ( v55 == 1 )
    {
      __asm
      {
        fld     dword ptr [edi+304h]
        fcomp   ds:flt_46F224
      }
      v91 = 0;
      __asm { fnstsw  ax }
      if ( (_AX & 0x100) != 0 )
        *((_DWORD *)_EDI + 193) = 1065353216;
      __asm
      {
        fld     dword ptr [edi+304h]
        fcomp   ds:flt_46F278
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        *((_DWORD *)_EDI + 193) = 1088421888;
      v94 = (*(int (__thiscall **)(int, _DWORD, float *))(*(_DWORD *)grim_interface_ptr + 128))(
              grim_interface_ptr,
              *((_DWORD *)_EDI + 205),
              v346);
      if ( (_BYTE)v94
        || config_player_count == 1
        && (LOBYTE(v94) = player_alt_turn_key_left,
            (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, v94)) )
      {
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F260
          fadd    dword ptr [edi+304h]
          fst     dword ptr [edi+304h]
        }
        *((float *)_EDI + 193) = _ET1;
        __asm
        {
          fmul    frame_dt
          fmul    ds:flt_46F24C
          fsubr   dword ptr [edi+2Ch]
          fstp    dword ptr [edi+2Ch]
        }
        *((float *)_EDI + 11) = _ET1;
        __asm
        {
          fld     frame_dt
          fmul    dword ptr [edi+304h]
          fmul    ds:flt_46F24C
          fsubr   dword ptr [edi+300h]
        }
      }
      else
      {
        v95 = (*(int (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
                grim_interface_ptr,
                *((_DWORD *)_EDI + 206));
        if ( !(_BYTE)v95 )
        {
          if ( config_player_count != 1 )
            goto LABEL_135;
          LOBYTE(v95) = player_alt_turn_key_right;
          if ( !(*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(
                  grim_interface_ptr,
                  v95) )
            goto LABEL_135;
        }
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F260
          fadd    dword ptr [edi+304h]
          fst     dword ptr [edi+304h]
        }
        *((float *)_EDI + 193) = _ET1;
        __asm
        {
          fmul    frame_dt
          fmul    ds:flt_46F24C
          fadd    dword ptr [edi+2Ch]
          fstp    dword ptr [edi+2Ch]
        }
        *((float *)_EDI + 11) = _ET1;
        __asm
        {
          fld     frame_dt
          fmul    dword ptr [edi+304h]
          fmul    ds:flt_46F24C
          fadd    dword ptr [edi+300h]
        }
      }
      __asm { fstp    dword ptr [edi+300h] }
      *((float *)_EDI + 192) = _ET1;
      v91 = 1;
LABEL_135:
      v405 = 1.0;
      v101 = (*(int (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
               grim_interface_ptr,
               *((_DWORD *)_EDI + 203));
      if ( (_BYTE)v101
        || config_player_count == 1
        && (LOBYTE(v101) = player_alt_move_key_forward,
            (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, v101)) )
      {
        if ( (int)*(&player_perk_counts + perk_id_long_distance_runner) <= 0 )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F288
            fadd    dword ptr [edi+68h]
            fst     dword ptr [edi+68h]
          }
          *((float *)_EDI + 26) = _ET1;
          __asm
          {
            fcomp   ds:flt_46F238
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
            *((_DWORD *)_EDI + 26) = 0x40000000;
        }
        else
        {
          __asm
          {
            fld     dword ptr [edi+68h]
            fcomp   ds:flt_46F238
            fnstsw  ax
          }
          if ( (_AX & 0x100) != 0 )
          {
            __asm
            {
              fld     frame_dt
              fmul    ds:flt_46F25C
              fadd    dword ptr [edi+68h]
              fstp    dword ptr [edi+68h]
            }
            *((float *)_EDI + 26) = _ET1;
          }
          __asm
          {
            fld     frame_dt
            fadd    dword ptr [edi+68h]
            fst     dword ptr [edi+68h]
          }
          *((float *)_EDI + 26) = _ET1;
          __asm
          {
            fcomp   ds:flt_46F51C
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
            *((_DWORD *)_EDI + 26) = 1077097267;
        }
        if ( *((_DWORD *)_EDI + 176) == 7 )
        {
          __asm
          {
            fld     dword ptr [edi+68h]
            fcomp   ds:flt_46F2A4
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
            *((_DWORD *)_EDI + 26) = 1061997773;
        }
        __asm
        {
          fld     dword ptr [edi+2Ch]
          fsub    ds:flt_46F220
        }
        __asm
        {
          fcos
          fmul    dword ptr [edi+68h]
          fmul    [esp+58h+var_3C]
          fmul    ds:flt_46F524
          fstp    dword ptr [edi+1Ch]
        }
        *((float *)_EDI + 7) = _ET1;
        __asm
        {
          fld     dword ptr [edi+2Ch]
          fsub    ds:flt_46F220
          fsin
          fmul    dword ptr [edi+68h]
          fmul    [esp+58h+var_3C]
          fmul    ds:flt_46F524
          fstp    dword ptr [edi+20h]
        }
        *((float *)_EDI + 8) = _ET1;
        __asm
        {
          fld     frame_dt
          fld     st
          fmul    dword ptr [edi+20h]
          fxch    st(1)
          fmul    dword ptr [edi+1Ch]
          fstp    [esp+58h+vel]
          fstp    [esp+58h+var_C]
        }
      }
      else
      {
        v102 = (*(int (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
                 grim_interface_ptr,
                 *((_DWORD *)_EDI + 204));
        if ( (_BYTE)v102
          || config_player_count == 1
          && (LOBYTE(v102) = player_alt_move_key_backward,
              (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(
                grim_interface_ptr,
                v102)) )
        {
          if ( (int)*(&player_perk_counts + perk_id_long_distance_runner) <= 0 )
          {
            __asm
            {
              fld     frame_dt
              fmul    ds:flt_46F288
              fadd    dword ptr [edi+68h]
              fst     dword ptr [edi+68h]
            }
            *((float *)_EDI + 26) = _ET1;
            __asm
            {
              fcomp   ds:flt_46F238
              fnstsw  ax
            }
            if ( (_AX & 0x4100) == 0 )
              *((_DWORD *)_EDI + 26) = 0x40000000;
          }
          else
          {
            __asm
            {
              fld     dword ptr [edi+68h]
              fcomp   ds:flt_46F238
              fnstsw  ax
            }
            if ( (_AX & 0x100) != 0 )
            {
              __asm
              {
                fld     frame_dt
                fmul    ds:flt_46F25C
                fadd    dword ptr [edi+68h]
                fstp    dword ptr [edi+68h]
              }
              *((float *)_EDI + 26) = _ET1;
            }
            __asm
            {
              fld     frame_dt
              fadd    dword ptr [edi+68h]
              fst     dword ptr [edi+68h]
            }
            *((float *)_EDI + 26) = _ET1;
            __asm
            {
              fcomp   ds:flt_46F51C
              fnstsw  ax
            }
            if ( (_AX & 0x4100) == 0 )
              *((_DWORD *)_EDI + 26) = 1077097267;
          }
          __asm
          {
            fld     dword ptr [edi+2Ch]
            fsub    ds:flt_46F220
          }
          v392 = -1082130432;
          __asm
          {
            fcos
            fmul    dword ptr [edi+68h]
            fmul    [esp+58h+var_3C]
            fmul    ds:flt_46F514
            fstp    dword ptr [edi+1Ch]
          }
          *((float *)_EDI + 7) = _ET1;
          __asm
          {
            fld     dword ptr [edi+2Ch]
            fsub    ds:flt_46F220
            fsin
            fmul    dword ptr [edi+68h]
            fmul    [esp+58h+var_3C]
            fmul    ds:flt_46F514
            fstp    dword ptr [edi+20h]
          }
          *((float *)_EDI + 8) = _ET1;
          __asm
          {
            fld     frame_dt
            fld     st
            fmul    dword ptr [edi+20h]
            fxch    st(1)
            fmul    dword ptr [edi+1Ch]
            fstp    [esp+58h+vel]
            fstp    [esp+58h+var_C]
          }
        }
        else
        {
          if ( !v91 )
            *((_DWORD *)_EDI + 193) = 1065353216;
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F360
            fsubr   dword ptr [edi+68h]
            fst     dword ptr [edi+68h]
          }
          *((float *)_EDI + 26) = _ET1;
          __asm
          {
            fcomp   ds:flt_46F228
            fnstsw  ax
          }
          if ( (_AX & 0x100) != 0 )
            *((_DWORD *)_EDI + 26) = 0;
          __asm
          {
            fld     dword ptr [edi+2Ch]
            fsub    ds:flt_46F220
          }
          __asm
          {
            fcos
            fmul    dword ptr [edi+68h]
            fmul    [esp+58h+var_3C]
            fmul    ds:flt_46F524
            fstp    dword ptr [edi+1Ch]
          }
          *((float *)_EDI + 7) = _ET1;
          __asm
          {
            fld     dword ptr [edi+2Ch]
            fsub    ds:flt_46F220
            fsin
            fmul    dword ptr [edi+68h]
            fmul    [esp+58h+var_3C]
            fmul    ds:flt_46F524
            fstp    dword ptr [edi+20h]
          }
          *((float *)_EDI + 8) = _ET1;
          __asm
          {
            fld     frame_dt
            fld     st
            fmul    dword ptr [edi+20h]
            fxch    st(1)
            fmul    dword ptr [edi+1Ch]
            fstp    [esp+58h+vel]
            fstp    [esp+58h+var_C]
          }
        }
      }
      player_apply_move_with_spawn_avoidance(render_overlay_player_index, (float *)_EDI + 5, &vel);
      __asm
      {
        fld     [esp+64h+var_38]
        fmul    dword ptr [edi+68h]
      }
      __asm { fmul    frame_dt }
      goto LABEL_240;
    }
    if ( v55 != 2 )
      goto LABEL_241;
    owner_ida = -1082130432;
    if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD, float *))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           *((_DWORD *)_EDI + 205),
           v346)
      || config_player_count == 1
      && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           player_alt_turn_key_left) )
    {
      v371 = 1083624420;
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           *((_DWORD *)_EDI + 206))
      || config_player_count == 1
      && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           player_alt_turn_key_right) )
    {
      v371 = 1070141403;
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           *((_DWORD *)_EDI + 203))
      || config_player_count == 1
      && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           player_alt_move_key_forward) )
    {
      if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
             grim_interface_ptr,
             *((_DWORD *)_EDI + 205))
        || config_player_count == 1
        && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
             grim_interface_ptr,
             player_alt_turn_key_left) )
      {
        v371 = 1085271520;
      }
      else if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
                  grim_interface_ptr,
                  *((_DWORD *)_EDI + 206))
             || config_player_count == 1
             && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                  grim_interface_ptr,
                  player_alt_turn_key_right) )
      {
        v371 = 1061752795;
      }
      else
      {
        v371 = 0;
      }
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           *((_DWORD *)_EDI + 204))
      || config_player_count == 1
      && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           player_alt_move_key_backward) )
    {
      if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
             grim_interface_ptr,
             *((_DWORD *)_EDI + 205))
        || config_player_count == 1
        && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
             grim_interface_ptr,
             player_alt_turn_key_left) )
      {
        sub_413540(3.926991);
      }
      else if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
                  grim_interface_ptr,
                  *((_DWORD *)_EDI + 206))
             || config_player_count == 1
             && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                  grim_interface_ptr,
                  player_alt_turn_key_right) )
      {
        sub_413540(2.3561945);
      }
      else
      {
        sub_413540(3.1415927);
      }
    }
    else
    {
      __asm
      {
        fld     [esp+58h+owner_id]
        fcomp   ds:flt_46F36C
        fnstsw  ax
      }
      if ( (_AX & 0x4000) != 0 )
      {
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F360
          fsubr   dword ptr [edi+68h]
          fst     dword ptr [edi+68h]
        }
        *((float *)_EDI + 26) = _ET1;
        __asm
        {
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x100) != 0 )
          *((_DWORD *)_EDI + 26) = 0;
        __asm
        {
          fld     dword ptr [edi+2Ch]
          fsub    ds:flt_46F220
        }
        __asm
        {
          fcos
          fmul    dword ptr [edi+68h]
          fmul    [esp+60h+var_3C]
          fmul    ds:flt_46F524
          fstp    dword ptr [edi+1Ch]
        }
        *((float *)_EDI + 7) = _ET1;
        __asm
        {
          fld     dword ptr [edi+2Ch]
          fsub    ds:flt_46F220
          fsin
          fmul    dword ptr [edi+68h]
          fmul    [esp+60h+var_3C]
          fmul    ds:flt_46F524
          fstp    dword ptr [edi+20h]
        }
        *((float *)_EDI + 8) = _ET1;
        __asm
        {
          fld     frame_dt
          fld     st
          fmul    dword ptr [edi+20h]
          fxch    st(1)
          fmul    dword ptr [edi+1Ch]
        }
        __asm
        {
          fstp    [esp+64h+vel]
          fstp    [esp+64h+var_C]
        }
        player_apply_move_with_spawn_avoidance(render_overlay_player_index, (float *)_EDI + 5, &vel);
        goto LABEL_215;
      }
      sub_413540(-1.0);
    }
    __asm
    {
      fld     flt_487198
      fadd    dword ptr [edi+300h]
    }
    __asm { fstp    dword ptr [edi+300h] }
    *((float *)_EDI + 192) = _ET1;
    if ( (int)*(&player_perk_counts + perk_id_long_distance_runner) <= 0 )
    {
      __asm
      {
        fld     frame_dt
        fmul    ds:flt_46F288
        fadd    dword ptr [edi+68h]
        fst     dword ptr [edi+68h]
      }
      *((float *)_EDI + 26) = _ET1;
      __asm
      {
        fcomp   ds:flt_46F238
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        *((_DWORD *)_EDI + 26) = 0x40000000;
    }
    else
    {
      __asm
      {
        fld     dword ptr [edi+68h]
        fcomp   ds:flt_46F238
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
      {
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F25C
          fadd    dword ptr [edi+68h]
          fstp    dword ptr [edi+68h]
        }
        *((float *)_EDI + 26) = _ET1;
      }
      __asm
      {
        fld     frame_dt
        fadd    dword ptr [edi+68h]
        fst     dword ptr [edi+68h]
      }
      *((float *)_EDI + 26) = _ET1;
      __asm
      {
        fcomp   ds:flt_46F51C
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        *((_DWORD *)_EDI + 26) = 1077097267;
    }
    if ( *((_DWORD *)_EDI + 176) == 7 )
    {
      __asm
      {
        fld     dword ptr [edi+68h]
        fcomp   ds:flt_46F2A4
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        *((_DWORD *)_EDI + 26) = 1061997773;
    }
    __asm
    {
      fld     dword ptr [edi+2Ch]
      fsub    ds:flt_46F220
      fld     ds:flt_46F378
      fsub    st, st(2)
    }
    __asm
    {
      fstp    [esp+60h+var_38]
      fcos
      fstp    st(1)
      fmul    dword ptr [edi+68h]
      fmul    [esp+60h+var_38]
      fmul    [esp+60h+var_3C]
      fmul    ds:flt_46F518
      fstp    dword ptr [edi+1Ch]
    }
    *((float *)_EDI + 7) = _ET1;
    __asm
    {
      fld     dword ptr [edi+2Ch]
      fsub    ds:flt_46F220
      fsin
      fmul    dword ptr [edi+68h]
      fmul    [esp+60h+var_38]
      fmul    [esp+60h+var_3C]
      fmul    ds:flt_46F518
      fstp    dword ptr [edi+20h]
    }
    *((float *)_EDI + 8) = _ET1;
    __asm
    {
      fld     frame_dt
      fld     st
      fmul    dword ptr [edi+20h]
      fxch    st(1)
      fmul    dword ptr [edi+1Ch]
    }
    __asm
    {
      fstp    [esp+64h+vel]
      fstp    [esp+64h+var_C]
    }
    player_apply_move_with_spawn_avoidance(render_overlay_player_index, (float *)_EDI + 5, &vel);
LABEL_215:
    __asm
    {
      fld     frame_dt
      fmul    dword ptr [edi+68h]
    }
    __asm
    {
      fmul    ds:flt_46F510
      fadd    dword ptr [edi+94h]
      fstp    dword ptr [edi+94h]
    }
    *((float *)_EDI + 37) = _ET1;
    goto LABEL_241;
  }
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
         grim_interface_ptr,
         config_key_reload) )
  {
    _EAX = render_overlay_player_index;
    __asm
    {
      fld     dword_4871F8[eax*8]
      fsub    camera_offset_y
      fld     dword_4871F4[eax*8]
      fsub    camera_offset_x
      fstp    [esp+58h+pos]
    }
    __asm { fstp    [esp+58h+var_14] }
    *((float *)_EDI + 201) = pos;
    *((float *)_EDI + 202) = v413;
  }
  if ( *((_DWORD *)_EDI + 201) == -1082130432 )
    goto LABEL_98;
  __asm
  {
    fld     dword ptr [esi+4]
    fsub    dword ptr [edi+328h]
    fld     dword ptr [esi]
    fsub    dword ptr [edi+324h]
    fld     st
    fmul    st, st(1)
    fld     st(2)
    fmul    st, st(3)
    faddp   st(1), st
    fsqrt
    fcomp   ds:flt_46F2B4
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0 )
  {
    __asm
    {
      fstp    st
      fstp    st
    }
LABEL_98:
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F360
      fsubr   dword ptr [edi+68h]
      fst     dword ptr [edi+68h]
    }
    *((float *)_EDI + 26) = _ET1;
    __asm
    {
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
      *((_DWORD *)_EDI + 26) = 0;
    __asm
    {
      fld     dword ptr [edi+2Ch]
      fsub    ds:flt_46F220
    }
    __asm
    {
      fcos
      fmul    dword ptr [edi+68h]
      fmul    [esp+60h+var_3C]
      fmul    ds:flt_46F524
      fstp    dword ptr [edi+1Ch]
    }
    *((float *)_EDI + 7) = _ET1;
    __asm
    {
      fld     dword ptr [edi+2Ch]
      fsub    ds:flt_46F220
      fsin
      fmul    dword ptr [edi+68h]
      fmul    [esp+60h+var_3C]
      fmul    ds:flt_46F524
      fstp    dword ptr [edi+20h]
    }
    *((float *)_EDI + 8) = _ET1;
    __asm
    {
      fld     frame_dt
      fld     st
      fmul    dword ptr [edi+20h]
      fxch    st(1)
      fmul    dword ptr [edi+1Ch]
    }
    __asm
    {
      fstp    [esp+64h+vel]
      fstp    [esp+64h+var_C]
    }
    player_apply_move_with_spawn_avoidance(render_overlay_player_index, (float *)_EDI + 5, &vel);
    goto LABEL_239;
  }
  __asm
  {
    fpatan
    fsub    ds:flt_46F220
    fcom    ds:flt_46F228
    fst     [esp+58h+var_38]
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
  {
    do
    {
      __asm
      {
        fadd    ds:flt_46F3B0
        fcom    ds:flt_46F228
        fnstsw  ax
      }
    }
    while ( (_AX & 0x100) != 0 );
    __asm { fst     [esp+58h+var_38] }
  }
  __asm
  {
    fcomp   ds:flt_46F36C
    fnstsw  ax
  }
  if ( (_AX & 0x4000) != 0 )
    goto LABEL_98;
  sub_413540(*(float *)&v393);
  if ( (int)*(&player_perk_counts + perk_id_long_distance_runner) <= 0 )
  {
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F288
      fadd    dword ptr [edi+68h]
      fst     dword ptr [edi+68h]
    }
    *((float *)_EDI + 26) = _ET1;
    __asm
    {
      fcomp   ds:flt_46F238
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
      *((_DWORD *)_EDI + 26) = 0x40000000;
  }
  else
  {
    __asm
    {
      fld     dword ptr [edi+68h]
      fcomp   ds:flt_46F238
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
    {
      __asm
      {
        fld     frame_dt
        fmul    ds:flt_46F25C
        fadd    dword ptr [edi+68h]
        fstp    dword ptr [edi+68h]
      }
      *((float *)_EDI + 26) = _ET1;
    }
    __asm
    {
      fld     frame_dt
      fadd    dword ptr [edi+68h]
      fst     dword ptr [edi+68h]
    }
    *((float *)_EDI + 26) = _ET1;
    __asm
    {
      fcomp   ds:flt_46F51C
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
      *((_DWORD *)_EDI + 26) = 1077097267;
  }
  if ( *((_DWORD *)_EDI + 176) == 7 )
  {
    __asm
    {
      fld     dword ptr [edi+68h]
      fcomp   ds:flt_46F2A4
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
      *((_DWORD *)_EDI + 26) = 1061997773;
  }
  __asm
  {
    fld     dword ptr [edi+2Ch]
    fsub    ds:flt_46F220
    fld     ds:flt_46F378
    fsub    st, st(2)
  }
  __asm
  {
    fstp    [esp+58h+var_38]
    fcos
    fstp    st(1)
    fmul    dword ptr [edi+68h]
    fmul    [esp+58h+var_38]
    fmul    [esp+58h+var_3C]
    fmul    ds:flt_46F518
    fstp    dword ptr [edi+1Ch]
  }
  *((float *)_EDI + 7) = _ET1;
  __asm
  {
    fld     dword ptr [edi+2Ch]
    fsub    ds:flt_46F220
    fsin
    fmul    dword ptr [edi+68h]
    fmul    [esp+58h+var_38]
    fmul    [esp+58h+var_3C]
    fmul    ds:flt_46F518
    fstp    dword ptr [edi+20h]
  }
  *((float *)_EDI + 8) = _ET1;
  __asm
  {
    fld     frame_dt
    fld     st
    fmul    dword ptr [edi+20h]
    fxch    st(1)
    fmul    dword ptr [edi+1Ch]
    fstp    [esp+58h+vel]
    fstp    [esp+58h+var_C]
  }
LABEL_238:
  player_apply_move_with_spawn_avoidance(render_overlay_player_index, (float *)_EDI + 5, &vel);
LABEL_239:
  __asm
  {
    fld     frame_dt
    fmul    dword ptr [edi+68h]
  }
LABEL_240:
  __asm { fmul    ds:flt_46F510 }
  __asm
  {
    fadd    dword ptr [edi+94h]
    fstp    dword ptr [edi+94h]
  }
  *((float *)_EDI + 37) = _ET1;
LABEL_241:
  if ( time_scale_active )
  {
    __asm
    {
      fld     time_scale_factor
      fmul    frame_dt
      fmul    ds:flt_46F50C
      fstp    frame_dt
    }
  }
  v160 = perk_count_get(perk_id_sharpshooter);
  __asm { fld     frame_dt }
  if ( v160 )
  {
    __asm
    {
      fadd    st, st
      fsubr   dword ptr [edi+2B8h]
      fst     dword ptr [edi+2B8h]
    }
    *((float *)_EDI + 174) = _ET1;
    __asm
    {
      fcomp   ds:flt_46F534
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
      *((_DWORD *)_EDI + 174) = 1048576000;
    *((_DWORD *)_EDI + 174) = 1017370378;
  }
  else
  {
    __asm
    {
      fmul    ds:flt_46F324
      fsubr   dword ptr [edi+2B8h]
      fst     dword ptr [edi+2B8h]
    }
    *((float *)_EDI + 174) = _ET1;
    __asm
    {
      fcomp   ds:flt_46F300
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
      *((_DWORD *)_EDI + 174) = 1008981770;
  }
  if ( perk_count_get(perk_id_anxious_loader) )
  {
    if ( (unsigned __int8)input_primary_just_pressed() )
    {
      __asm
      {
        fld     dword ptr [edi+2D0h]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
      {
        __asm
        {
          fld     dword ptr [edi+2D0h]
          fsub    ds:flt_46F508
          fst     dword ptr [edi+2D0h]
        }
        *((float *)_EDI + 180) = _ET1;
        __asm
        {
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4100) != 0 )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F2A4
            fstp    dword ptr [edi+2D0h]
          }
          *((float *)_EDI + 180) = _ET1;
        }
      }
    }
  }
  __asm
  {
    fld     dword ptr [edi+2D0h]
    fsub    frame_dt
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
  {
    __asm
    {
      fld     dword ptr [edi+2D0h]
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
      *((_DWORD *)_EDI + 179) = *((_DWORD *)_EDI + 177);
  }
  __asm
  {
    fld     dword ptr [esi]
    fcomp   [esp+58h+var_28]
  }
  v401 = 1065353216;
  __asm { fnstsw  ax }
  if ( (_AX & 0x4000) == 0 )
    goto LABEL_261;
  __asm
  {
    fld     dword ptr [edi+18h]
    fcomp   [esp+58h+var_24]
    fnstsw  ax
  }
  if ( (_AX & 0x4000) != 0 )
  {
    if ( perk_count_get(perk_id_stationary_reloader) )
      v401 = 1077936128;
  }
  else
  {
LABEL_261:
    *((_DWORD *)_EDI + 40) = 0;
    *((_DWORD *)_EDI + 41) = 0;
  }
  if ( !perk_count_get(perk_id_angry_reloader) )
    goto LABEL_274;
  __asm
  {
    fld     dword ptr [edi+2D8h]
    fcomp   ds:flt_46F24C
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0 )
    goto LABEL_274;
  __asm
  {
    fld     dword ptr [edi+2D8h]
    fmul    ds:flt_46F24C
    fcom    dword ptr [edi+2D0h]
    fnstsw  ax
  }
  if ( (_AX & 0x100) == 0 )
  {
    __asm { fstp    st }
LABEL_274:
    __asm
    {
      fld     [esp+58h+var_38]
      fmul    frame_dt
      fsubr   dword ptr [edi+2D0h]
      fstp    dword ptr [edi+2D0h]
    }
    *((float *)_EDI + 180) = _ET1;
    goto LABEL_275;
  }
  __asm
  {
    fld     [esp+58h+var_38]
    fmul    frame_dt
    fsubr   dword ptr [edi+2D0h]
    fst     dword ptr [edi+2D0h]
  }
  *((float *)_EDI + 180) = _ET1;
  __asm
  {
    fcomp   st(1)
    fnstsw  ax
  }
  __asm { fstp    st }
  if ( (_AX & 0x4100) != 0 )
  {
    _EDX = cv_friendlyFire;
    bonus_spawn_guard = 1;
    __asm
    {
      fld     dword ptr [edx+0Ch]
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4000) != 0 )
      v401 = -100;
    else
      v401 = -1 - render_overlay_player_index;
    __asm
    {
      fld     dword ptr [edi+2D8h]
      fmul    ds:flt_46F504
    }
    v179 = 0;
    v180 = 7 - _ftol();
    v372 = 0;
    LODWORD(arg1[0]) = v180;
    if ( v180 > 0 )
    {
      __asm
      {
        fild    [esp+58h+arg1]
        fdivr   ds:flt_46F3B0
        fstp    [esp+58h+arg1]
      }
      do
      {
        __asm { fild    [esp+58h+var_3C] }
        __asm { fmul    [esp+60h+arg1] }
        __asm
        {
          fadd    ds:flt_46F2FC
          fstp    [esp+64h+angle]; angle
        }
        projectile_spawn((float *)_EDI + 5, angleb, 11, v401);
        v372 = ++v179;
      }
      while ( v179 < v180 );
    }
    bonus_spawn_guard = 0;
    sfx_play_panned(sfx_explosion_small);
  }
LABEL_275:
  __asm
  {
    fld     dword ptr [edi+2D0h]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
    *((_DWORD *)_EDI + 180) = 0;
  if ( demo_mode_active )
    goto LABEL_284;
  v183 = perk_count_get(perk_id_alternate_weapon);
  _ECX = render_overlay_player_index;
  if ( !v183 && config_player_mode_flags[render_overlay_player_index] != 4 )
  {
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           config_key_reload) )
    {
      __asm
      {
        fld     dword ptr [edi+2D0h]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4000) != 0 && config_player_count == 1 )
        player_start_reload();
    }
LABEL_284:
    _ECX = render_overlay_player_index;
  }
  v348 = 0;
  if ( demo_mode_active || (v186 = config_aim_scheme[_ECX], v186 == 5) )
  {
    _EBP = (float *)(_EDI + 80);
    _EAX = 19 * *((_DWORD *)_EDI + 200);
    __asm
    {
      fld     creature_pos_y[eax*8]
      fsub    dword ptr [ebp+4]
      fld     creature_pos_x[eax*8]
    }
    __asm
    {
      fsub    dword ptr [ebp+0]
      fstp    [esp+58h+arg2]
      fst     [esp+58h+var_1C]
      fld     [esp+58h+arg2]
      fmul    [esp+58h+arg2]
      fld     st(1)
      fmul    st, st(2)
      faddp   st(1), st
      fsqrt
      fstp    st(1)
      fst     [esp+58h+var_38]
      fcomp   ds:flt_46F25C
      fnstsw  ax
    }
    if ( (_EAX & 0x100) != 0 )
    {
      v202 = 19 * *((_DWORD *)_EDI + 200);
      *_EBP = *(&creature_pos_x + 38 * *((_DWORD *)_EDI + 200));
      *((float *)_EDI + 21) = creature_pos_y[2 * v202];
    }
    else
    {
      j_FUN_00452f1d(&arg2);
      __asm
      {
        fld     [esp+58h+var_38]
        fmul    ds:flt_46F284
        fmul    frame_dt
        fld     [esp+58h+arg2]
        fmul    st, st(1)
        fstp    [esp+58h+vel]
        fmul    [esp+58h+var_1C]
        fld     [esp+58h+vel]
        fadd    dword ptr [ebp+0]
        fstp    dword ptr [ebp+0]
      }
      *_EBP = _ET1;
      __asm
      {
        fadd    dword ptr [ebp+4]
        fstp    dword ptr [ebp+4]
      }
      *((float *)_EDI + 21) = _ET1;
    }
    __asm
    {
      fld     [esp+58h+var_38]
      fcomp   ds:flt_46F2B8
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
    {
      _EDX = 19 * *((_DWORD *)_EDI + 200);
      __asm
      {
        fld     creature_health[edx*8]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        v348 = 1;
    }
  }
  else
  {
    switch ( v186 )
    {
      case 0:
        __asm
        {
          fld     dword_4871F8[ecx*8]
          fsub    camera_offset_y
          fld     dword_4871F4[ecx*8]
          fsub    camera_offset_x
          fstp    [esp+58h+pos]
        }
        __asm { fstp    [esp+58h+var_14] }
        *((float *)_EDI + 20) = pos;
        *((float *)_EDI + 21) = v413;
LABEL_289:
        __asm
        {
          fld     dword ptr [esi+4]
          fsub    dword ptr [edi+54h]
          fld     dword ptr [esi]
          fsub    dword ptr [edi+50h]
          fpatan
          fsub    ds:flt_46F220
          fstp    dword ptr [edi+300h]
        }
        *((float *)_EDI + 192) = _ET1;
        break;
      case 4:
        (*(void (__thiscall **)(int, _DWORD, float *))(*(_DWORD *)grim_interface_ptr + 132))(
          grim_interface_ptr,
          *((_DWORD *)_EDI + 213),
          v346);
        __asm { fstp    [esp+54h+var_34] }
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 132))(
          grim_interface_ptr,
          *((_DWORD *)_EDI + 212));
        __asm
        {
          fstp    [esp+54h+var_1C]
          fld     [esp+54h+var_1C]
          fmul    [esp+54h+var_1C]
          fld     [esp+54h+var_34]
          fmul    [esp+54h+var_34]
        }
        pos = v406;
        __asm
        {
          faddp   st(1), st
          fsqrt
          fld     ds:flt_46F224
          fcomp   st(1)
          fnstsw  ax
        }
        if ( (_AX & 0x100) != 0 )
        {
          __asm { fstp    st }
          v405 = 1.0;
        }
        else
        {
          __asm { fstp    [esp+54h+var_34] }
        }
        j_FUN_00452f1d(&v411);
        _ECX = cv_padAimDistMul;
        __asm
        {
          fld     [esp+58h+var_38]
          fmul    dword ptr [ecx+0Ch]
          fadd    ds:flt_46F4B4
          fld     st
          fmul    [esp+58h+arg2]
          fstp    [esp+58h+vel]
          fmul    [esp+58h+var_1C]
          fadd    dword ptr [esi+4]
          fld     [esp+58h+vel]
          fadd    dword ptr [esi]
          fstp    [esp+58h+pos]
        }
        __asm { fstp    [esp+58h+var_14] }
        *((float *)_EDI + 20) = pos;
        *((float *)_EDI + 21) = v413;
        goto LABEL_289;
      case 3:
        __asm
        {
          fld     dword_4871F8[ecx*8]
          fsub    ds:flt_46F49C
          fld     dword_4871F4[ecx*8]
          fsub    ds:flt_46F49C
          fstp    [esp+58h+arg2]
          fst     [esp+58h+var_1C]
          fld     [esp+58h+arg2]
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4000) == 0 )
          goto LABEL_298;
        __asm
        {
          fcom    ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4000) != 0 )
        {
          __asm { fstp    st }
        }
        else
        {
LABEL_298:
          __asm
          {
            fld     [esp+58h+arg2]
            fpatan
            fadd    ds:flt_46F220
            fst     dword ptr [edi+300h]
          }
          *((float *)_EDI + 192) = _ET1;
          __asm
          {
            fsub    ds:flt_46F220
            fst     [esp+58h+arg1]
            fcos
            fld     [esp+58h+arg1]
            fsin
            fstp    [esp+58h+var_C]
            fmul    ds:flt_46F384
            fld     [esp+58h+var_C]
            fmul    ds:flt_46F384
            fadd    dword ptr [esi+4]
            fxch    st(1)
            fadd    dword ptr [esi]
            fstp    [esp+58h+pos]
          }
          __asm { fstp    [esp+58h+var_14] }
          *((float *)_EDI + 20) = pos;
          *((float *)_EDI + 21) = v413;
        }
        __asm
        {
          fld     [esp+58h+var_1C]
          fmul    [esp+58h+var_1C]
          fld     [esp+58h+arg2]
          fmul    [esp+58h+arg2]
          faddp   st(1), st
          fsqrt
          fcomp   ds:flt_46F4B0
          fnstsw  ax
        }
        if ( (_AX & 0x4100) == 0 )
        {
          j_FUN_00452f1d(&arg2);
          __asm
          {
            fld     [esp+58h+arg2]
            fmul    ds:flt_46F4B0
            fld     [esp+58h+var_1C]
            fmul    ds:flt_46F4B0
          }
          v194 = render_overlay_player_index;
          __asm
          {
            fstp    [esp+58h+var_C]
            fadd    ds:flt_46F49C
            fstp    [esp+58h+pos]
            fld     [esp+58h+var_C]
            fadd    ds:flt_46F49C
          }
          *(float *)&dword_4871F4[2 * render_overlay_player_index] = pos;
          __asm { fstp    [esp+58h+var_14] }
          dword_4871F8[2 * v194] = v413;
        }
        break;
      case 1:
        v195 = config_player_mode_flags[_ECX];
        if ( v195 == 1 || v195 == 2 )
        {
          if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD, float *))(*(_DWORD *)grim_interface_ptr + 128))(
                 grim_interface_ptr,
                 *((_DWORD *)_EDI + 211),
                 v346) )
          {
            __asm
            {
              fld     frame_dt
              fmul    ds:flt_46F248
              fadd    dword ptr [edi+300h]
              fstp    dword ptr [edi+300h]
            }
            *((float *)_EDI + 192) = _ET1;
          }
          if ( (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
                 grim_interface_ptr,
                 *((_DWORD *)_EDI + 210)) )
          {
            __asm
            {
              fld     frame_dt
              fmul    ds:flt_46F248
              fsubr   dword ptr [edi+300h]
              fstp    dword ptr [edi+300h]
            }
            *((float *)_EDI + 192) = _ET1;
          }
          __asm
          {
            fld     dword ptr [edi+300h]
            fsub    ds:flt_46F220
            fst     [esp+58h+arg1]
            fcos
            fld     [esp+58h+arg1]
            fsin
            fstp    [esp+58h+var_C]
            fmul    ds:flt_46F384
            fld     [esp+58h+var_C]
            fmul    ds:flt_46F384
            fadd    dword ptr [esi+4]
            fxch    st(1)
            fadd    dword ptr [esi]
            fstp    [esp+58h+pos]
          }
          __asm { fstp    [esp+58h+var_14] }
          *((float *)_EDI + 20) = pos;
          *((float *)_EDI + 21) = v413;
        }
        break;
      default:
        if ( sub_41E8D0() )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F25C
            fsubr   dword ptr [edi+300h]
            fstp    dword ptr [edi+300h]
          }
          *((float *)_EDI + 192) = _ET1;
        }
        if ( sub_41E8F0() )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F25C
            fadd    dword ptr [edi+300h]
            fstp    dword ptr [edi+300h]
          }
          *((float *)_EDI + 192) = _ET1;
        }
        __asm
        {
          fld     dword ptr [edi+300h]
          fsub    ds:flt_46F220
          fst     [esp+58h+arg1]
          fcos
          fld     [esp+58h+arg1]
          fsin
          fstp    [esp+58h+var_C]
          fmul    ds:flt_46F384
          fld     [esp+58h+var_C]
          fmul    ds:flt_46F384
          fadd    dword ptr [esi+4]
          fxch    st(1)
          fadd    dword ptr [esi]
          fstp    [esp+58h+pos]
        }
        __asm { fstp    [esp+58h+var_14] }
        *((float *)_EDI + 20) = pos;
        *((float *)_EDI + 21) = v413;
        break;
    }
  }
  __asm
  {
    fld     dword ptr [esi+4]
    fsub    dword ptr [edi+54h]
    fld     dword ptr [esi]
    fsub    dword ptr [edi+50h]
    fpatan
  }
  _EBP = _EDI + 724;
  v209 = 0;
  v347 = 0;
  __asm
  {
    fsub    ds:flt_46F220
    fstp    dword ptr [edi+300h]
  }
  *((float *)_EDI + 192) = _ET1;
  __asm
  {
    fld     dword ptr [ebp+0]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0 )
  {
    __asm
    {
      fld     dword ptr [edi+2D0h]
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4000) != 0 )
    {
      v209 = 1;
      _EDI[712] = 0;
    }
  }
  __asm
  {
    fld     dword ptr [ebp+0]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0
    && *((int *)_EDI + 43) > 0
    && (perk_count_get(perk_id_regression_bullets) || perk_count_get(perk_id_ammunition_within)) )
  {
    v347 = 1;
  }
  if ( perk_count_get(perk_id_alternate_weapon) )
  {
    if ( (dword_48719C <= 0 || (dword_48719C -= frame_dt_ms, dword_48719C <= 0))
      && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           config_key_reload) )
    {
      v214 = *((_DWORD *)_EDI + 183);
      *((_DWORD *)_EDI + 183) = *((_DWORD *)_EDI + 176);
      *((_DWORD *)_EDI + 176) = v214;
      __asm { fld     dword ptr [edi+2E0h] }
      *((_DWORD *)_EDI + 184) = *((_DWORD *)_EDI + 177);
      __asm { fstp    dword ptr [edi+2C4h] }
      *((float *)_EDI + 177) = _ET1;
      LOBYTE(v214) = _EDI[740];
      _EDI[740] = _EDI[712];
      _EDI[712] = v214;
      __asm { fld     dword ptr [edi+2E8h] }
      *((_DWORD *)_EDI + 186) = *((_DWORD *)_EDI + 179);
      v216 = (float *)(_EDI + 720);
      __asm { fstp    dword ptr [edi+2CCh] }
      *((float *)_EDI + 179) = _ET1;
      __asm { fld     dword ptr [edi+2ECh] }
      *((_DWORD *)_EDI + 187) = *((_DWORD *)_EDI + 180);
      __asm { fstp    dword ptr [ecx] }
      *v216 = _ET1;
      __asm { fld     dword ptr [edi+2F0h] }
      v219 = (float *)(_EDI + 724);
      *((_DWORD *)_EDI + 188) = *_EBP;
      __asm { fstp    dword ptr [ecx] }
      *v219 = _ET1;
      __asm { fld     dword ptr [edi+2F4h] }
      *((_DWORD *)_EDI + 189) = *((_DWORD *)_EDI + 182);
      __asm { fstp    dword ptr [edi+2D8h] }
      *((float *)_EDI + 182) = _ET1;
      sfx_play_panned(*(&sfx_id + 31 * *((_DWORD *)_EDI + 176)));
      __asm
      {
        fld     dword ptr [ebp+0]
        fadd    ds:flt_46F2FC
      }
      __asm { fstp    dword ptr [ebp+0] }
      *(float *)_EBP = _ET1;
      dword_48719C = 200;
    }
    else if ( !(*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                 grim_interface_ptr,
                 config_key_reload) )
    {
      dword_48719C = 0;
    }
  }
  if ( !v209 && !v347 )
    goto LABEL_464;
  v373 = *((_DWORD *)_EDI + 192);
  if ( !(*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 128))(
          grim_interface_ptr,
          *((_DWORD *)_EDI + 207))
    && !v348 )
  {
    goto LABEL_464;
  }
  survival_reward_fire_seen = 1;
  if ( !v209 )
  {
    if ( perk_count_get(perk_id_regression_bullets) )
    {
      __asm { fild    dword ptr [edi+0ACh] }
      _EAX = 31 * *((_DWORD *)_EDI + 176);
      __asm { fld     dword ptr [eax+4D7A78h] }
      if ( weapon_ammo_class[_EAX] == 1 )
      {
        __asm
        {
          fmul    ds:flt_46F25C
          fsubp   st(1), st
        }
      }
      else
      {
        __asm
        {
          fmul    ds:flt_46F49C
          fsubp   st(1), st
        }
      }
      *((_DWORD *)_EDI + 43) = _ftol();
    }
    else if ( perk_count_get(perk_id_ammunition_within) )
    {
      if ( weapon_ammo_class[31 * *((_DWORD *)_EDI + 176)] == 1 )
        player_take_damage(render_overlay_player_index, 0.15000001);
      else
        player_take_damage(render_overlay_player_index, 1.0);
    }
    if ( *((int *)_EDI + 43) < 0 )
      *((_DWORD *)_EDI + 43) = 0;
  }
  __asm
  {
    fld     [esp+58h+var_3C]
    fsub    ds:flt_46F220
    fst     [esp+58h+owner_id]
    fsub    ds:flt_46F530
    fld     st
    fcos
    fmul    ds:flt_46F230
    fstp    [esp+58h+arg2]
    fsin
    fmul    ds:flt_46F230
    fstp    [esp+58h+var_1C]
  }
  if ( (byte_4D7A94[124 * *((_DWORD *)_EDI + 176)] & 1) != 0 )
  {
    LODWORD(arg1[0]) = crt_rand() & 0x3F;
    __asm
    {
      fild    [esp+58h+arg1]
      fmul    ds:flt_46F300
      fadd    [esp+58h+var_3C]
      fstp    [esp+58h+var_38]
    }
    v224 = crt_rand();
    vel = 1.0;
    LODWORD(arg1[0]) = v224 & 0x3F;
    __asm { fild    [esp+58h+arg1] }
    v415 = 1.0;
    v416 = 1065353216;
    __asm { fmul    ds:flt_46F500 }
    v417 = 1058642330;
    effect_template_color_r = 1065353216;
    effect_template_flags = 453;
    __asm
    {
      fadd    ds:flt_46F224
      fld     [esp+58h+var_38]
      fcos
    }
    effect_template_color_g = 1065353216;
    effect_template_color_b = 1065353216;
    effect_template_color_a = 1058642330;
    effect_template_lifetime = 1041865114;
    effect_template_age = 0;
    __asm
    {
      fmul    st, st(1)
      fstp    [esp+58h+pos]
      fld     [esp+58h+var_38]
      fsin
      fmul    st, st(1)
      fstp    [esp+58h+var_14]
      fstp    st
    }
    v225 = crt_rand();
    effect_template_half_height = 0x40000000;
    effect_template_half_width = 0x40000000;
    LODWORD(arg1[0]) = (v225 & 0x3F) - 32;
    __asm
    {
      fild    [esp+58h+arg1]
      fmul    ds:flt_46F2FC
      fstp    effect_template_rotation
      fld     [esp+58h+pos]
      fmul    ds:flt_46F2C4
      fstp    effect_template_vel_x
      fld     [esp+58h+var_14]
      fmul    ds:flt_46F2C4
      fstp    effect_template_vel_y
    }
    v226 = crt_rand();
    effect_template_scale_step = 0;
    LODWORD(arg1[0]) = v226 % 20;
    __asm { fild    [esp+58h+arg1] }
    __asm
    {
      fmul    ds:flt_46F2FC
      fsub    ds:flt_46F224
      fmul    ds:flt_46F280
      fstp    effect_template_rotation_step
      fld     [esp+60h+var_1C]
      fadd    dword ptr [esi+4]
      fld     [esp+60h+arg2]
      fadd    dword ptr [esi]
      fstp    [esp+60h+vel]
      fstp    [esp+60h+var_C]
    }
    effect_spawn(18, &vel);
  }
  _ECX = v405;
  __asm
  {
    fld     dword ptr [ecx]
    fcomp   ds:flt_46F224
    fnstsw  ax
  }
  if ( (_AX & 0x4100) == 0 )
    *(_DWORD *)LODWORD(v405) = 1065353216;
  _EAX = cv_friendlyFire;
  v404 = 1065353216;
  __asm
  {
    fld     dword ptr [eax+0Ch]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_EAX & 0x4000) != 0 )
    v230 = -100;
  else
    v230 = -1 - render_overlay_player_index;
  _EBX = 864 * render_overlay_player_index;
  v232 = *(float *)&player_aim_x[216 * render_overlay_player_index];
  v413 = *(float *)&player_aim_y[216 * render_overlay_player_index];
  pos = v232;
  __asm
  {
    fld     [esp+5Ch+var_14]
    fsub    dword ptr [ebx+4908C8h]
    fld     [esp+5Ch+pos]
    fsub    dword ptr [ebx+4908C4h]
    fstp    [esp+5Ch+vel]
    fstp    [esp+5Ch+var_C]
  }
  sub_417660(&vel);
  __asm { fmul    ds:flt_46F24C }
  __asm { fstp    [esp+58h+var_28] }
  LODWORD(arg1[0]) = crt_rand() & 0x1FF;
  __asm
  {
    fild    [esp+58h+arg1]
    fmul    ds:flt_46F52C
    fstp    [esp+58h+var_44]
  }
  LODWORD(arg1[0]) = crt_rand() & 0x1FF;
  __asm
  {
    fild    [esp+5Ch+arg1]
    fld     [esp+5Ch+var_28]
    fmul    dword ptr [ebx+490B68h]
    fmulp   st(1), st
    fmul    ds:flt_46F528
    fld     [esp+5Ch+var_44]
    fcos
    fmul    st, st(1)
    fadd    [esp+5Ch+pos]
    fstp    [esp+5Ch+pos]
    fld     [esp+5Ch+var_44]
    fsin
  }
  __asm
  {
    fmulp   st(1), st
    fadd    [esp+5Ch+var_14]
    fsubr   dword ptr [ebx+4908C8h]
    fld     dword ptr [ebx+4908C4h]
    fsub    [esp+5Ch+pos]
    fpatan
    fsub    ds:flt_46F220
    fstp    [esp+5Ch+var_44]
  }
  if ( (*(unsigned __int8 (__stdcall **)(int))(*(_DWORD *)grim_interface_ptr + 128))(34) )
    *((_DWORD *)_EDI + 199) = 1092616192;
  __asm
  {
    fld     dword ptr [edi+31Ch]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0 )
  {
    *((_DWORD *)_EDI + 181) = dword_4D7A74[31 * *((_DWORD *)_EDI + 176)];
    _ECX = 31 * *((_DWORD *)_EDI + 176);
    _EAX = (float *)LODWORD(v405);
    __asm
    {
      fld     flt_4D7A7C[ecx*4]
      fadd    dword ptr [eax]
      fstp    dword ptr [eax]
    }
    *_EAX = _ET1;
    v246 = 31 * *((_DWORD *)_EDI + 176);
    v247 = crt_rand();
    sfx_play_panned(COERCE_FLOAT(*(_DWORD *)((char *)&flt_4D7A84 + v246 * 4) + v247 % dword_4D7A88[v246]));
    v248 = *((_DWORD *)_EDI + 176);
    if ( v248 == 24 )
    {
      __asm
      {
        fld     [esp+58h+var_1C]
        fadd    dword ptr [esi+4]
        fld     [esp+58h+arg2]
        fadd    dword ptr [esi]
      }
      __asm { fstp    [esp+60h+vel] }
      __asm { fstp    [esp+68h+var_C] }
      projectile_spawn(&vel, v351, v248, v230);
      __asm
      {
        fld     [esp+68h+var_3C]
        fcos
      }
      __asm
      {
        fst     [esp+74h+owner_id]
        fmul    ds:flt_46F524
        fstp    [esp+74h+vel]
        fld     [esp+74h+var_3C]
        fsin
        fst     [esp+74h+var_3C]
        fmul    ds:flt_46F524
        fstp    [esp+74h+var_C]
        fld     [esp+74h+var_1C]
        fadd    dword ptr [esi+4]
        fld     [esp+74h+arg2]
        fadd    dword ptr [esi]
        fstp    [esp+74h+pos]
        fstp    [esp+74h+var_14]
      }
      v249 = fx_spawn_sprite(&pos, &vel, 1.0);
      __asm
      {
        fld     [esp+74h+owner_id]
        fmul    ds:flt_46F360
      }
      __asm
      {
        fstp    [esp+7Ch+vel]
        fld     [esp+7Ch+var_3C]
        fmul    ds:flt_46F360
      }
      v249 *= 44;
      __asm
      {
        fstp    [esp+7Ch+var_C]
        fld     [esp+7Ch+var_1C]
      }
      *(int *)((char *)sprite_effect_color_r + v249) = 1056964608;
      *(int *)((char *)sprite_effect_color_g + v249) = 1056964608;
      *(int *)((char *)sprite_effect_color_b + v249) = 1056964608;
      *(int *)((char *)sprite_effect_color_a + v249) = 1047233823;
      __asm
      {
        fadd    dword ptr [esi+4]
        fld     [esp+7Ch+arg2]
        fadd    dword ptr [esi]
      }
      __asm
      {
        fstp    [esp+7Ch+pos]
        fstp    [esp+7Ch+var_14]
      }
      v250 = fx_spawn_sprite(&pos, &vel, 2.0);
    }
    else
    {
      if ( v248 != 1 )
      {
        switch ( v248 )
        {
          case 2:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v253 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v253 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v253) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v253) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v253) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v253) = 1047233823;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            v254 = fx_spawn_sprite(&pos, &vel, 2.0);
            __asm { fld     [esp+70h+var_1C] }
            v254 *= 44;
            *(int *)((char *)sprite_effect_color_r + v254) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v254) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v254) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v254) = 1046092972;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+7Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+80h+vel]
              fstp    [esp+80h+var_C]
            }
            projectile_spawn(&vel, v351, 2, v230);
            break;
          case 3:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v255 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v255 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v255) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v255) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v255) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v255) = 1048576000;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            v378 = 12;
            v256 = 11 * fx_spawn_sprite(&pos, &vel, 2.0);
            sprite_effect_color_r[v256] = 1056964608;
            sprite_effect_color_g[v256] = 1056964608;
            sprite_effect_color_b[v256] = 1056964608;
            sprite_effect_color_a[v256] = 1046764061;
            do
            {
              __asm { fld     [esp+58h+var_1C] }
              _EAX = _EDI + 20;
              __asm
              {
                fadd    dword ptr [eax+4]
                fld     [esp+60h+arg2]
                fadd    dword ptr [eax]
                fstp    [esp+60h+vel]
                fstp    [esp+60h+var_C]
              }
              v408 = crt_rand() % 200 - 100;
              __asm
              {
                fild    [esp+64h+var_28]
                fmul    ds:flt_46F4F8
                fadd    [esp+64h+var_44]
                fstp    [esp+64h+angle]; angle
              }
              v258 = projectile_spawn(&vel, anglec, 3, v230);
              v259 = crt_rand();
              v258 <<= 6;
              v260 = v378-- == 1;
              v408 = v259 % 100;
              __asm
              {
                fild    [esp+58h+var_28]
                fmul    ds:flt_46F300
                fadd    ds:flt_46F224
                fstp    dword ptr [ebx+4926E4h]
              }
              *(float *)(v258 + 4794084) = _ET1;
            }
            while ( !v260 );
            break;
          case 20:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fmul    ds:flt_46F360
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fmul    ds:flt_46F360
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v379 = 4;
            v262 = 11 * fx_spawn_sprite(&pos, &vel, 2.0);
            sprite_effect_color_r[v262] = 1056964608;
            sprite_effect_color_g[v262] = 1056964608;
            sprite_effect_color_b[v262] = 1056964608;
            sprite_effect_color_a[v262] = 1046764061;
            do
            {
              __asm { fld     [esp+58h+var_1C] }
              _EAX = _EDI + 20;
              __asm
              {
                fadd    dword ptr [eax+4]
                fld     [esp+60h+arg2]
                fadd    dword ptr [eax]
                fstp    [esp+60h+vel]
                fstp    [esp+60h+var_C]
              }
              v408 = crt_rand() % 200 - 100;
              __asm
              {
                fild    [esp+64h+var_28]
                fmul    ds:flt_46F4F8
                fadd    [esp+64h+var_44]
                fstp    [esp+64h+angle]; angle
              }
              v264 = projectile_spawn(&vel, angled, 3, v230);
              v265 = crt_rand();
              v264 <<= 6;
              v260 = v379-- == 1;
              v408 = v265 % 100;
              __asm
              {
                fild    [esp+58h+var_28]
                fmul    ds:flt_46F300
                fadd    ds:flt_46F224
                fstp    dword ptr [ebx+4926E4h]
              }
              *(float *)(v264 + 4794084) = _ET1;
            }
            while ( !v260 );
            break;
          case 4:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v267 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v267 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v267) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v267) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v267) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v267) = 1048911544;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            v381 = 12;
            v268 = 11 * fx_spawn_sprite(&pos, &vel, 2.0);
            sprite_effect_color_r[v268] = 1056964608;
            sprite_effect_color_g[v268] = 1056964608;
            sprite_effect_color_b[v268] = 1056964608;
            sprite_effect_color_a[v268] = 1047435149;
            do
            {
              __asm { fld     [esp+58h+var_1C] }
              _EAX = _EDI + 20;
              __asm
              {
                fadd    dword ptr [eax+4]
                fld     [esp+60h+arg2]
                fadd    dword ptr [eax]
                fstp    [esp+60h+vel]
                fstp    [esp+60h+var_C]
              }
              v408 = crt_rand() % 200 - 100;
              __asm
              {
                fild    [esp+64h+var_28]
                fmul    ds:flt_46F4F4
                fadd    [esp+64h+var_44]
                fstp    [esp+64h+angle]; angle
              }
              v270 = projectile_spawn(&vel, anglee, 3, v230);
              v271 = crt_rand();
              v270 <<= 6;
              v260 = v381-- == 1;
              v408 = v271 % 100;
              __asm
              {
                fild    [esp+58h+var_28]
                fmul    ds:flt_46F300
                fadd    ds:flt_46F224
                fstp    dword ptr [ebx+4926E4h]
              }
              *(float *)(v270 + 4794084) = _ET1;
            }
            while ( !v260 );
            break;
          case 8:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+64h+var_C] }
            fx_spawn_particle(&vel, *(float *)&owner_idb, _EDI + 28, 1.0);
            v404 = 1036831949;
            break;
          case 16:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+64h+var_C] }
            v273 = fx_spawn_particle(&vel, *(float *)&owner_idb, _EDI + 28, 1.0);
            if ( v273 != -1 )
              particle_style_id[56 * v273] = 2;
            v404 = 1036831949;
            break;
          case 15:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+64h+var_C] }
            v274 = fx_spawn_particle(&vel, *(float *)&owner_idb, _EDI + 28, 1.0);
            if ( v274 != -1 )
              particle_style_id[56 * v274] = 1;
            v404 = 1028443341;
            break;
          case 5:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v275 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v275 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v275) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v275) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v275) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v275) = 1047233823;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            v276 = fx_spawn_sprite(&pos, &vel, 2.0);
            __asm { fld     [esp+70h+var_1C] }
            v276 *= 44;
            *(int *)((char *)sprite_effect_color_r + v276) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v276) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v276) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v276) = 1046092972;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+7Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+80h+vel]
              fstp    [esp+80h+var_C]
            }
            projectile_spawn(&vel, v351, 5, v230);
            break;
          case 9:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 10:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+64h+vel]
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_44]
              fsub    ds:flt_46F4F0
              fstp    [esp+64h+angle]; angle
            }
            projectile_spawn(&vel, anglef, 9, v230);
            __asm
            {
              fld     [esp+68h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+68h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+58h+vel] }
            __asm
            {
              fstp    [esp+60h+var_C]
              fld     [esp+60h+var_44]
              fsub    ds:flt_46F4EC
            }
            __asm { fstp    [esp+64h+angle]; angle }
            projectile_spawn(&vel, angleg, 11, v230);
            __asm
            {
              fld     [esp+68h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+68h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+70h+vel] }
            __asm { fstp    [esp+78h+var_C] }
            projectile_spawn(&vel, v351, 9, v230);
            __asm
            {
              fld     [esp+78h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+78h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+58h+vel] }
            __asm
            {
              fstp    [esp+60h+var_C]
              fld     [esp+60h+var_44]
              fadd    ds:flt_46F4EC
            }
            __asm { fstp    [esp+64h+angle]; angle }
            projectile_spawn(&vel, angleh, 11, v230);
            __asm
            {
              fld     [esp+68h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+68h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+58h+vel] }
            __asm
            {
              fstp    [esp+60h+var_C]
              fld     [esp+60h+var_44]
              fadd    ds:flt_46F4F0
            }
            __asm { fstp    [esp+64h+angle]; angle }
            projectile_spawn(&vel, anglei, 9, v230);
            break;
          case 19:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 25:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 29:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 21:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 22:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 23:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 28:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 31:
            v383 = 8;
            do
            {
              __asm { fld     [esp+58h+var_1C] }
              _EAX = _EDI + 20;
              __asm
              {
                fadd    dword ptr [eax+4]
                fld     [esp+60h+arg2]
                fadd    dword ptr [eax]
                fstp    [esp+60h+vel]
                fstp    [esp+60h+var_C]
              }
              v408 = crt_rand() % 200 - 100;
              __asm
              {
                fild    [esp+64h+var_28]
                fmul    ds:flt_46F4E8
                fadd    [esp+64h+var_44]
                fstp    [esp+64h+angle]; angle
              }
              v278 = projectile_spawn(&vel, anglej, 22, v230);
              v279 = crt_rand();
              v278 <<= 6;
              v260 = v383-- == 1;
              v408 = v279 % 80;
              __asm
              {
                fild    [esp+58h+var_28]
                fmul    ds:flt_46F300
                fadd    ds:flt_46F308
                fstp    dword ptr [ebx+4926E4h]
              }
              *(float *)(v278 + 4794084) = _ET1;
            }
            while ( !v260 );
            break;
          case 11:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 30:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v281 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v281 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v281) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v281) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v281) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v281) = 1051260355;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            v385 = 6;
            v282 = 11 * fx_spawn_sprite(&pos, &vel, 2.0);
            sprite_effect_color_r[v282] = 1056964608;
            sprite_effect_color_g[v282] = 1056964608;
            sprite_effect_color_b[v282] = 1056964608;
            sprite_effect_color_a[v282] = 1049012208;
            do
            {
              __asm { fld     [esp+58h+var_1C] }
              _EAX = _EDI + 20;
              __asm
              {
                fadd    dword ptr [eax+4]
                fld     [esp+60h+arg2]
                fadd    dword ptr [eax]
                fstp    [esp+60h+vel]
                fstp    [esp+60h+var_C]
              }
              v408 = crt_rand() % 200 - 100;
              __asm
              {
                fild    [esp+64h+var_28]
                fmul    ds:flt_46F3B4
                fadd    [esp+64h+var_44]
                fstp    [esp+64h+angle]; angle
              }
              v284 = projectile_spawn(&vel, anglek, 6, v230);
              v285 = crt_rand();
              v284 <<= 6;
              v260 = v385-- == 1;
              v408 = v285 % 80;
              __asm
              {
                fild    [esp+58h+var_28]
                fmul    ds:flt_46F300
                fadd    ds:flt_46F308
                fstp    dword ptr [ebx+4926E4h]
              }
              *(float *)(v284 + 4794084) = _ET1;
            }
            while ( !v260 );
            break;
          case 6:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v287 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v287 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v287) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v287) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v287) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v287) = 1051260355;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            v288 = fx_spawn_sprite(&pos, &vel, 2.0);
            __asm { fld     [esp+70h+var_1C] }
            v288 *= 44;
            *(int *)((char *)sprite_effect_color_r + v288) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v288) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v288) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v288) = 1049012208;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+7Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+80h+vel]
              fstp    [esp+80h+var_C]
            }
            projectile_spawn(&vel, v351, 6, v230);
            break;
          case 12:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v289 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v289 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v289) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v289) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v289) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v289) = 1051595899;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            v290 = fx_spawn_sprite(&pos, &vel, 2.0);
            __asm { fld     [esp+70h+var_1C] }
            v290 *= 44;
            *(int *)((char *)sprite_effect_color_r + v290) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v290) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v290) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v290) = 1049683296;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+78h+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+7Ch+vel]
              fstp    [esp+7Ch+var_C]
            }
            fx_spawn_secondary_projectile(&vel, v351, 1);
            break;
          case 17:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v291 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v291 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v291) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v291) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v291) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v291) = 1051595899;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            _EAX = 44 * fx_spawn_sprite(&pos, &vel, 2.0);
            *(int *)((char *)sprite_effect_color_r + _EAX) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + _EAX) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + _EAX) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + _EAX) = 1049683296;
            __asm
            {
              fld     dword ptr [edi+2CCh]
              fmul    ds:flt_46F4E4
            }
            v293 = 0.0;
            __asm
            {
              fstp    [esp+58h+owner_id]
              fld     [esp+58h+var_44]
              fsub    ds:flt_46F378
              fld     [esp+58h+owner_id]
              fmul    dword ptr [edi+2CCh]
              fmul    ds:flt_46F24C
              fsubp   st(1), st
              fstp    [esp+58h+var_3C]
              fld     ds:flt_46F228
              fcomp   dword ptr [edi+2CCh]
              fnstsw  ax
            }
            if ( (_EAX & 0x100) != 0 )
            {
              do
              {
                __asm
                {
                  fld     [esp+58h+var_1C]
                  fadd    dword ptr [esi+4]
                  fld     [esp+58h+arg2]
                  fadd    dword ptr [esi]
                }
                __asm { fstp    [esp+60h+vel] }
                __asm { fstp    [esp+64h+var_C] }
                fx_spawn_secondary_projectile(&vel, v389, 2);
                __asm
                {
                  fld     [esp+64h+var_3C]
                  fadd    [esp+64h+owner_id]
                }
                ++LODWORD(v293);
                *(float *)&v408 = v293;
                __asm
                {
                  fstp    [esp+58h+var_3C]
                  fild    [esp+58h+var_28]
                  fcomp   dword ptr [edi+2CCh]
                  fnstsw  ax
                }
              }
              while ( (_AX & 0x100) != 0 );
            }
            v404 = *((_DWORD *)_EDI + 179);
            break;
          case 18:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v295 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm { fld     [esp+64h+var_1C] }
            v295 *= 44;
            *(int *)((char *)sprite_effect_color_r + v295) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v295) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v295) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v295) = 1051595899;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+vel]
              fstp    [esp+70h+var_C]
            }
            fx_spawn_secondary_projectile(&vel, v351, 4);
            break;
          case 13:
            __asm
            {
              fld     [esp+58h+var_3C]
              fcos
            }
            __asm
            {
              fst     [esp+64h+owner_id]
              fmul    ds:flt_46F524
              fstp    [esp+64h+vel]
              fld     [esp+64h+var_3C]
              fsin
              fst     [esp+64h+var_3C]
              fmul    ds:flt_46F524
              fstp    [esp+64h+var_C]
              fld     [esp+64h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+64h+arg2]
              fadd    dword ptr [esi]
              fstp    [esp+64h+pos]
              fstp    [esp+64h+var_14]
            }
            v296 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+64h+owner_id]
              fmul    ds:flt_46F360
            }
            __asm
            {
              fstp    [esp+6Ch+vel]
              fld     [esp+6Ch+var_3C]
              fmul    ds:flt_46F360
            }
            v296 *= 44;
            __asm
            {
              fstp    [esp+6Ch+var_C]
              fld     [esp+6Ch+var_1C]
            }
            *(int *)((char *)sprite_effect_color_r + v296) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v296) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v296) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v296) = 1050589266;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+6Ch+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+70h+pos]
              fstp    [esp+70h+var_14]
            }
            v297 = fx_spawn_sprite(&pos, &vel, 2.0);
            __asm { fld     [esp+70h+var_1C] }
            v297 *= 44;
            *(int *)((char *)sprite_effect_color_r + v297) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v297) = 1056964608;
            *(int *)((char *)sprite_effect_color_b + v297) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v297) = 1048106238;
            __asm
            {
              fadd    dword ptr [esi+4]
              fld     [esp+78h+arg2]
              fadd    dword ptr [esi]
            }
            __asm
            {
              fstp    [esp+7Ch+vel]
              fstp    [esp+7Ch+var_C]
            }
            fx_spawn_secondary_projectile(&vel, v351, 2);
            break;
          case 7:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, 1, v230);
            break;
          case 14:
            v391 = 14;
            do
            {
              __asm { fld     [esp+58h+var_1C] }
              _EAX = _EDI + 20;
              __asm
              {
                fadd    dword ptr [eax+4]
                fld     [esp+60h+arg2]
                fadd    dword ptr [eax]
                fstp    [esp+60h+vel]
                fstp    [esp+60h+var_C]
              }
              v408 = (unsigned __int8)crt_rand() - 128;
              __asm
              {
                fild    [esp+64h+var_28]
                fmul    ds:flt_46F3B4
                fadd    [esp+64h+var_44]
                fstp    [esp+64h+angle]; angle
              }
              v299 = projectile_spawn(&vel, anglel, 11, v230);
              v300 = crt_rand();
              v299 <<= 6;
              v260 = v391-- == 1;
              v408 = v300 % 100;
              __asm
              {
                fild    [esp+58h+var_28]
                fmul    ds:flt_46F300
                fadd    ds:flt_46F224
                fstp    dword ptr [ebx+4926E4h]
              }
              *(float *)(v299 + 4794084) = _ET1;
            }
            while ( !v260 );
            break;
          case 41:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 43:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm { fstp    [esp+68h+var_C] }
            projectile_spawn(&vel, v351, v248, v230);
            break;
          case 42:
            __asm
            {
              fld     [esp+58h+var_1C]
              fadd    dword ptr [esi+4]
              fld     [esp+58h+arg2]
              fadd    dword ptr [esi]
            }
            __asm { fstp    [esp+60h+vel] }
            __asm
            {
              fstp    [esp+60h+var_C]
              fld     [esp+60h+var_44]
              fsub    ds:flt_46F220
              fstp    [esp+60h+var_60]; angle
            }
            fx_spawn_particle_slow(&vel, v345);
            v404 = 1041865114;
            break;
        }
        goto LABEL_452;
      }
      __asm
      {
        fld     [esp+58h+var_1C]
        fadd    dword ptr [esi+4]
        fld     [esp+58h+arg2]
        fadd    dword ptr [esi]
      }
      __asm { fstp    [esp+60h+vel] }
      __asm { fstp    [esp+68h+var_C] }
      projectile_spawn(&vel, v351, v248, v230);
      __asm
      {
        fld     [esp+68h+var_3C]
        fcos
      }
      __asm
      {
        fst     [esp+74h+owner_id]
        fmul    ds:flt_46F524
        fstp    [esp+74h+vel]
        fld     [esp+74h+var_3C]
        fsin
        fst     [esp+74h+var_3C]
        fmul    ds:flt_46F524
        fstp    [esp+74h+var_C]
        fld     [esp+74h+var_1C]
        fadd    dword ptr [esi+4]
        fld     [esp+74h+arg2]
        fadd    dword ptr [esi]
        fstp    [esp+74h+pos]
        fstp    [esp+74h+var_14]
      }
      v252 = fx_spawn_sprite(&pos, &vel, 1.0);
      __asm
      {
        fld     [esp+74h+owner_id]
        fmul    ds:flt_46F360
      }
      __asm
      {
        fstp    [esp+7Ch+vel]
        fld     [esp+7Ch+var_3C]
        fmul    ds:flt_46F360
      }
      v252 *= 44;
      __asm
      {
        fstp    [esp+7Ch+var_C]
        fld     [esp+7Ch+var_1C]
      }
      *(int *)((char *)sprite_effect_color_r + v252) = 1056964608;
      *(int *)((char *)sprite_effect_color_g + v252) = 1056964608;
      *(int *)((char *)sprite_effect_color_b + v252) = 1056964608;
      *(int *)((char *)sprite_effect_color_a + v252) = 1047233823;
      __asm
      {
        fadd    dword ptr [esi+4]
        fld     [esp+7Ch+arg2]
        fadd    dword ptr [esi]
      }
      __asm
      {
        fstp    [esp+7Ch+pos]
        fstp    [esp+7Ch+var_14]
      }
      v250 = fx_spawn_sprite(&pos, &vel, 2.0);
    }
    v251 = 11 * v250;
    sprite_effect_color_r[v251] = 1056964608;
    sprite_effect_color_g[v251] = 1056964608;
    sprite_effect_color_b[v251] = 1056964608;
    sprite_effect_color_a[v251] = 1046092972;
LABEL_452:
    if ( !perk_count_get(perk_id_sharpshooter) )
    {
      _EDX = 31 * *((_DWORD *)_EDI + 176);
      __asm
      {
        fld     flt_4D7A7C[edx*4]
        fmul    ds:flt_46F348
        fadd    dword ptr [edi+2B8h]
        fstp    dword ptr [edi+2B8h]
      }
      *((float *)_EDI + 174) = _ET1;
    }
    __asm
    {
      fld     bonus_reflex_boost_timer
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
      __asm
      {
        fld     dword ptr [edi+2CCh]
        fsub    [esp+58h+var_38]
        fstp    dword ptr [edi+2CCh]
      }
      *((float *)_EDI + 179) = _ET1;
    }
    goto LABEL_456;
  }
  sfx_play_panned(flt_4D9050);
  sfx_play_panned(flt_4D7FD8);
  v234 = 31 * *((_DWORD *)_EDI + 176);
  if ( weapon_projectile_pellet_count[v234] == 1 )
  {
    *((_DWORD *)_EDI + 181) = dword_4D9040;
    __asm { fld     flt_4D9048 }
  }
  else
  {
    *((_DWORD *)_EDI + 181) = dword_4D7A74[v234];
    _ECX = 31 * *((_DWORD *)_EDI + 176);
    __asm { fld     flt_4D7A7C[ecx*4] }
  }
  _EAX = (float *)LODWORD(v405);
  v237 = 0;
  __asm
  {
    fadd    dword ptr [eax]
    fstp    dword ptr [eax]
  }
  *_EAX = _ET1;
  if ( weapon_projectile_pellet_count[31 * *((_DWORD *)_EDI + 176)] > 0 )
  {
    do
    {
      v239 = crt_rand() % 200;
      _EAX = _EDI + 20;
      v408 = v239 - 100;
      __asm
      {
        fild    [esp+60h+var_28]
        fmul    ds:flt_46F4FC
        fadd    [esp+60h+var_44]
        fstp    [esp+60h+var_28]
        fld     [esp+60h+var_1C]
        fadd    dword ptr [eax+4]
        fld     [esp+60h+arg2]
        fadd    dword ptr [eax]
      }
      __asm
      {
        fstp    [esp+68h+vel]
        fstp    [esp+68h+var_C]
      }
      projectile_spawn(&vel, *(float *)&v408, 45, v230);
      ++v237;
    }
    while ( v237 < weapon_projectile_pellet_count[31 * *((_DWORD *)_EDI + 176)] );
  }
  __asm
  {
    fld     [esp+58h+var_3C]
    fcos
  }
  __asm
  {
    fmul    ds:flt_46F524
    fstp    [esp+64h+vel]
    fld     [esp+64h+var_3C]
    fsin
    fmul    ds:flt_46F524
    fstp    [esp+64h+var_C]
    fld     [esp+64h+var_1C]
    fadd    dword ptr [esi+4]
    fld     [esp+64h+arg2]
    fadd    dword ptr [esi]
    fstp    [esp+64h+pos]
    fstp    [esp+64h+var_14]
  }
  v241 = fx_spawn_sprite(&pos, &vel, 1.0);
  v329 = perk_id_sharpshooter;
  v241 *= 44;
  *(int *)((char *)sprite_effect_color_r + v241) = 1056964608;
  *(int *)((char *)sprite_effect_color_g + v241) = 1056964608;
  *(int *)((char *)sprite_effect_color_b + v241) = 1056964608;
  *(int *)((char *)sprite_effect_color_a + v241) = 1054045372;
  if ( !perk_count_get(v329) )
  {
    __asm
    {
      fld     flt_4D9048
      fmul    ds:flt_46F348
      fadd    dword ptr [edi+2B8h]
      fstp    dword ptr [edi+2B8h]
    }
    *((float *)_EDI + 174) = _ET1;
  }
LABEL_456:
  __asm
  {
    fld     dword ptr [edi+2B8h]
    fcomp   ds:flt_46F4E0
    fnstsw  ax
  }
  if ( (_AX & 0x4100) == 0 )
    *((_DWORD *)_EDI + 174) = 1056293519;
  if ( (int)*(&player_perk_counts + perk_id_fastshot) > 0 )
  {
    __asm
    {
      fld     dword ptr [edi+2D4h]
      fmul    ds:flt_46F4DC
      fstp    dword ptr [edi+2D4h]
    }
    *((float *)_EDI + 181) = _ET1;
  }
  if ( (int)*(&player_perk_counts + perk_id_sharpshooter) > 0 )
  {
    __asm
    {
      fld     dword ptr [edi+2D4h]
      fmul    ds:flt_46F4D8
      fstp    dword ptr [edi+2D4h]
    }
    *((float *)_EDI + 181) = _ET1;
  }
  __asm
  {
    fld     dword ptr [edi+2CCh]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0 )
    player_start_reload();
LABEL_464:
  __asm
  {
    fld     dword ptr [edi+94h]
    fcomp   ds:flt_46F280
  }
  __asm { fnstsw  ax }
  if ( (_AX & 0x4100) == 0 )
  {
    do
    {
      __asm
      {
        fld     dword ptr [edi+94h]
        fsub    ds:flt_46F280
        fst     dword ptr [edi+94h]
      }
      *((float *)_EDI + 37) = _ET1;
      __asm
      {
        fcomp   ds:flt_46F280
        fnstsw  ax
      }
    }
    while ( (_AX & 0x4100) == 0 );
  }
  __asm
  {
    fld     dword ptr [edi+94h]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
  {
    do
    {
      __asm
      {
        fld     dword ptr [edi+94h]
        fadd    ds:flt_46F280
        fst     dword ptr [edi+94h]
      }
      *((float *)_EDI + 37) = _ET1;
      __asm
      {
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
    }
    while ( (_AX & 0x100) != 0 );
  }
  __asm
  {
    fld     dword ptr [edi+314h]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) == 0 )
  {
    __asm
    {
      fld     dword ptr [edi+5Ch]
      fsub    ds:flt_46F224
      fstp    dword ptr [edi+5Ch]
    }
    *((float *)_EDI + 23) = _ET1;
  }
  __asm
  {
    fld     dword ptr [edi+34h]
    fmul    ds:flt_46F24C
    fcom    dword ptr [esi]
    fnstsw  ax
  }
  if ( (_AX & 0x4100) == 0 )
  {
    __asm { fst     dword ptr [esi] }
    *_ESI = _ET1;
  }
  __asm
  {
    fild    terrain_texture_width
    fsub    st, st(1)
    fcom    dword ptr [esi]
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
  {
    __asm { fstp    dword ptr [esi] }
    *_ESI = _ET1;
  }
  else
  {
    __asm { fstp    st }
  }
  __asm { fcom    dword ptr [edi+18h] }
  _EDI = (float *)(_EDI + 24);
  __asm { fnstsw  ax }
  if ( (_AX & 0x4100) == 0 )
  {
    __asm { fst     dword ptr [edi] }
    *_EDI = _ET1;
  }
  __asm
  {
    fisubr  terrain_texture_height
    fcom    dword ptr [edi]
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
  {
    __asm { fstp    dword ptr [edi] }
    *_EDI = _ET1;
  }
  else
  {
    __asm { fstp    st }
  }
  _ECX = v405;
  __asm
  {
    fld     dword ptr [ecx]
    fcomp   ds:flt_46F2A4
    fnstsw  ax
  }
  if ( (_AX & 0x4100) == 0 )
    *(_DWORD *)LODWORD(v405) = 1061997773;
}

// FUN_00417640 @ 0x00417640
// [binja] float* __thiscall sub_417640(float* arg1, float* arg2, float* arg3)
float *FUN_00417640(float *arg1, float *arg2, float *arg3)
{
  float *v3; // ecx
  double v4; // st7

  v4 = v3[1] - arg2[1];
  *arg1 = *v3 - *arg2;
  arg1[1] = v4;
  return arg1;
}

// sub_417660 @ 0x00417660
long double __cdecl sub_417660(float *a1)
{
  return sqrt(*a1 * *a1 + a1[1] * a1[1]);
}

// FUN_00417690 @ 0x00417690
// [binja] int32_t sub_417690()
int FUN_00417690()
{
  Iostream_init *v0; // esi
  int v1; // edi
  Iostream_init *v2; // esi
  int v3; // edi
  Iostream_init *v4; // esi
  int v5; // edi
  Iostream_init *v6; // esi
  int v7; // edi
  Iostream_init *v8; // esi
  int v9; // edi
  Iostream_init *v10; // esi
  int v11; // edi
  int result; // eax

  v0 = (Iostream_init *)&unk_48F808;
  v1 = 8;
  do
  {
    Iostream_init::Iostream_init(v0);
    v0 = (Iostream_init *)((char *)v0 + 28);
    --v1;
  }
  while ( v1 );
  v2 = (Iostream_init *)&unk_48F8F0;
  dword_48F8EC = 4;
  v3 = 8;
  do
  {
    Iostream_init::Iostream_init(v2);
    v2 = (Iostream_init *)((char *)v2 + 28);
    --v3;
  }
  while ( v3 );
  dword_48F9D4 = 4;
  v4 = (Iostream_init *)&unk_48F9D8;
  v5 = 8;
  do
  {
    Iostream_init::Iostream_init(v4);
    v4 = (Iostream_init *)((char *)v4 + 28);
    --v5;
  }
  while ( v5 );
  dword_48FABC = 4;
  v6 = (Iostream_init *)&unk_48FAC0;
  v7 = 8;
  do
  {
    Iostream_init::Iostream_init(v6);
    v6 = (Iostream_init *)((char *)v6 + 28);
    --v7;
  }
  while ( v7 );
  dword_48FBA4 = 4;
  v8 = (Iostream_init *)&unk_48FBA8;
  v9 = 8;
  do
  {
    Iostream_init::Iostream_init(v8);
    v8 = (Iostream_init *)((char *)v8 + 28);
    --v9;
  }
  while ( v9 );
  dword_48FC8C = 4;
  v10 = (Iostream_init *)&unk_48FC90;
  v11 = 8;
  do
  {
    Iostream_init::Iostream_init(v10);
    v10 = (Iostream_init *)((char *)v10 + 28);
    --v11;
  }
  while ( v11 );
  dword_48FD74 = 4;
  FUN_004010f0((int)&unk_48FD78, 28, 8, (int)Iostream_init::Iostream_init);
  dword_48FE5C = 4;
  FUN_004010f0((int)&unk_48FE60, 28, 8, (int)Iostream_init::Iostream_init);
  dword_48FF44 = 4;
  FUN_004010f0((int)&unk_48FF48, 28, 8, (int)Iostream_init::Iostream_init);
  dword_49002C = 4;
  FUN_004010f0((int)&unk_490030, 28, 8, (int)Iostream_init::Iostream_init);
  dword_490114 = 4;
  FUN_004010f0((int)&unk_490118, 28, 8, (int)Iostream_init::Iostream_init);
  dword_4901FC = 4;
  result = FUN_004010f0((int)&unk_490200, 28, 8, (int)Iostream_init::Iostream_init);
  dword_4902E4 = 4;
  return result;
}

// sub_4177F0 @ 0x004177F0
int sub_4177F0()
{
  void *v1; // [esp+0h] [ebp-Ch]
  void *v2; // [esp+0h] [ebp-Ch]
  void *v3; // [esp+0h] [ebp-Ch]
  void *v4; // [esp+0h] [ebp-Ch]
  void *v5; // [esp+0h] [ebp-Ch]
  void *v6; // [esp+0h] [ebp-Ch]
  char *v7; // [esp+0h] [ebp-Ch]
  char *v8; // [esp+0h] [ebp-Ch]
  char *v9; // [esp+0h] [ebp-Ch]
  char *v10; // [esp+0h] [ebp-Ch]
  char *v11; // [esp+0h] [ebp-Ch]
  char *v12; // [esp+0h] [ebp-Ch]
  char *v13; // [esp+0h] [ebp-Ch]
  char *v14; // [esp+0h] [ebp-Ch]
  char *v15; // [esp+0h] [ebp-Ch]
  char *v16; // [esp+0h] [ebp-Ch]
  char *v17; // [esp+0h] [ebp-Ch]
  char *v18; // [esp+0h] [ebp-Ch]
  char *v19; // [esp+0h] [ebp-Ch]
  char *v20; // [esp+0h] [ebp-Ch]
  char *v21; // [esp+0h] [ebp-Ch]
  char *v22; // [esp+0h] [ebp-Ch]
  char *v23; // [esp+0h] [ebp-Ch]
  char *v24; // [esp+0h] [ebp-Ch]
  char *v25; // [esp+0h] [ebp-Ch]
  char *v26; // [esp+0h] [ebp-Ch]
  char *v27; // [esp+0h] [ebp-Ch]
  char *v28; // [esp+0h] [ebp-Ch]
  char *v29; // [esp+0h] [ebp-Ch]
  char *v30; // [esp+0h] [ebp-Ch]
  char *v31; // [esp+0h] [ebp-Ch]
  char *v32; // [esp+0h] [ebp-Ch]
  char *v33; // [esp+0h] [ebp-Ch]
  char *v34; // [esp+0h] [ebp-Ch]
  char *v35; // [esp+0h] [ebp-Ch]
  char *v36; // [esp+0h] [ebp-Ch]
  char *v37; // [esp+0h] [ebp-Ch]
  char *v38; // [esp+0h] [ebp-Ch]
  char *v39; // [esp+0h] [ebp-Ch]
  char *v40; // [esp+0h] [ebp-Ch]
  char *v41; // [esp+0h] [ebp-Ch]
  char *v42; // [esp+0h] [ebp-Ch]
  char *v43; // [esp+0h] [ebp-Ch]
  char *v44; // [esp+0h] [ebp-Ch]
  char *v45; // [esp+0h] [ebp-Ch]
  char *v46; // [esp+0h] [ebp-Ch]

  FUN_004010f0((int)&unk_4872B0, 8, 2, (int)Iostream_init::Iostream_init);
  FUN_00417aa0(v1);
  FUN_00417aa0(v2);
  FUN_00417aa0(v3);
  dword_487588 = 0;
  byte_4875A4 = 0;
  dword_4872C8 = 0;
  dword_4872C4 = 0;
  ui_sign_crimson = 0;
  FUN_004010f0((int)&unk_4875C8, 8, 2, (int)Iostream_init::Iostream_init);
  FUN_00417aa0(v4);
  FUN_00417aa0(v5);
  FUN_00417aa0(v6);
  dword_4878A0 = 0;
  byte_4878BC = 0;
  dword_4875E0 = 0;
  dword_4875DC = 0;
  byte_4875A8 = 0;
  FUN_00417ab0(v7);
  FUN_00417ab0(v8);
  FUN_00417ab0(v9);
  FUN_00417ab0(v10);
  FUN_00417ab0(v11);
  FUN_00417ab0(v12);
  FUN_00417ab0(v13);
  FUN_00417ab0(v14);
  FUN_00417ab0(v15);
  FUN_00417ab0(v16);
  FUN_00417ab0(v17);
  FUN_00417ab0(v18);
  FUN_00417ab0(v19);
  FUN_00417ab0(v20);
  FUN_00417ab0(v21);
  FUN_00417ab0(v22);
  FUN_00417ab0(v23);
  FUN_00417ab0(v24);
  FUN_00417ab0(v25);
  FUN_00417ab0(v26);
  FUN_00417ab0(v27);
  FUN_00417ab0(v28);
  FUN_00417ab0(v29);
  FUN_00417ab0(v30);
  FUN_00417ab0(v31);
  FUN_00417ab0(v32);
  FUN_00417ab0(v33);
  FUN_00417ab0(v34);
  FUN_00417ab0(v35);
  FUN_00417ab0(v36);
  FUN_00417ab0(v37);
  FUN_00417ab0(v38);
  FUN_00417ab0(v39);
  FUN_00417ab0(v40);
  FUN_00417ab0(v41);
  FUN_00417ab0(v42);
  FUN_00417ab0(v43);
  FUN_00417ab0(v44);
  FUN_00417ab0(v45);
  FUN_00417ab0(v46);
  byte_48724D = 0;
  byte_48727C = 0;
  dword_487284 = 0;
  player_name_length = 0;
  camera_shake_timer = 0.0;
  byte_487241 = 0;
  byte_4871C9 = 0;
  byte_4871CA = 0;
  byte_4871CB = 0;
  ui_mouse_blocked = 0;
  ui_transition_alpha = 1.0;
  camera_shake_offset_x = 0.0;
  camera_shake_offset_y = 0.0;
  return 0;
}

// FUN_00417aa0 @ 0x00417AA0
// [binja] void* __fastcall sub_417aa0(void* arg1)
void *FUN_00417aa0(void *arg1)
{
  _DWORD *v1; // ecx

  v1[57] = 4;
  return v1;
}

// FUN_00417ab0 @ 0x00417AB0
// [binja] char* __fastcall sub_417ab0(char* arg1)
char *FUN_00417ab0(char *arg1)
{
  int v1; // ecx

  *(_DWORD *)(v1 + 288) = 4;
  *(_DWORD *)(v1 + 520) = 4;
  *(_DWORD *)(v1 + 752) = 4;
  *(_DWORD *)(v1 + 760) = 0;
  *(_BYTE *)(v1 + 788) = 0;
  *(_DWORD *)(v1 + 56) = 0;
  *(_DWORD *)(v1 + 52) = 0;
  *(_BYTE *)v1 = 0;
  return (char *)v1;
}

// ui_draw_textured_quad @ 0x00417AE0
// binds a texture and draws a screen-space quad
void ui_draw_textured_quad(int texture_id, int x, int y, int w, int h)
{
  float v5; // [esp+2Ch] [ebp-10h]
  int v6; // [esp+30h] [ebp-Ch]
  float v7; // [esp+30h] [ebp-Ch]
  int v8; // [esp+30h] [ebp-Ch]
  int v9; // [esp+34h] [ebp-8h]
  float v10; // [esp+34h] [ebp-8h]
  int v11; // [esp+34h] [ebp-8h]
  int v12; // [esp+38h] [ebp-4h]
  float v13; // [esp+38h] [ebp-4h]
  int v14; // [esp+38h] [ebp-4h]

  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, h, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v6,
    v9,
    v12);
  v13 = (float)w;
  v10 = (float)y;
  v7 = (float)x;
  v5 = (float)texture_id;
  (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v5),
    LODWORD(v7),
    LODWORD(v10),
    LODWORD(v13));
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v8,
    v11,
    v14);
}

// terrain_generate @ 0x00417B80
// generates terrain texture into a render target using a level descriptor
void terrain_generate(void *desc)
{
  int v2; // edx
  int v3; // esi
  int v4; // ebp
  int v5; // eax
  int v6; // eax
  int v7; // esi
  int v8; // ebp
  int v9; // eax
  int v10; // eax
  int v11; // esi
  int v12; // ebx
  int v13; // eax
  _DWORD v14[4]; // [esp+D0h] [ebp-34h] BYREF
  float v15; // [esp+F0h] [ebp-14h]
  float v16; // [esp+F4h] [ebp-10h]
  int v17; // [esp+F8h] [ebp-Ch]
  float v18; // [esp+FCh] [ebp-8h] BYREF
  float v19; // [esp+100h] [ebp-4h]
  float desca; // [esp+108h] [ebp+4h]
  float descb; // [esp+108h] [ebp+4h]
  float descc; // [esp+108h] [ebp+4h]

  v16 = 0.0;
  camera_offset_x = 0;
  v17 = 0;
  camera_offset_y = 0;
  v15 = 1.0 / *(float *)config_texture_scale;
  if ( terrain_texture_failed )
  {
    terrain_render_target = dword_48F548[*((_DWORD *)desc + 4)];
  }
  else
  {
    LOBYTE(v14[0]) = 1;
    (*(void (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      18,
      v14[0],
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      1,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 48))(grim_interface_ptr, terrain_render_target);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 44))(
      grim_interface_ptr,
      1048378621,
      1046536417,
      1036568777,
      1065353216);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_48F548[*((_DWORD *)desc + 4)],
      0);
    v2 = *(_DWORD *)grim_interface_ptr;
    qmemcpy(v14, "333?333?333?fff?", sizeof(v14));
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(v2 + 276))(
      grim_interface_ptr,
      v14[0],
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v3 = 0;
    if ( 800 * terrain_texture_width * terrain_texture_height / 0x80000 > 0 )
    {
      desca = v15 * 128.0;
      do
      {
        v4 = *(_DWORD *)grim_interface_ptr;
        *(float *)&v14[3] = (double)(crt_rand() % 314) * 0.0099999998;
        (*(void (__thiscall **)(int, _DWORD))(v4 + 252))(grim_interface_ptr, v14[3]);
        v16 = (double)(crt_rand() % (terrain_texture_width + 128)) - 64.0;
        v5 = crt_rand();
        *(float *)&v14[3] = desca;
        *(float *)&v14[2] = desca;
        v14[1] = &v18;
        v18 = ((double)(v5 % (terrain_texture_width + 128)) - 64.0) * v15;
        v19 = v16 * v15;
        (*(void (__thiscall **)(int, float *, float, float))(*(_DWORD *)grim_interface_ptr + 288))(
          grim_interface_ptr,
          &v18,
          COERCE_FLOAT(LODWORD(desca)),
          COERCE_FLOAT(LODWORD(desca)));
        ++v3;
      }
      while ( v3 < 800 * terrain_texture_width * terrain_texture_height / 0x80000 );
    }
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_48F548[*((_DWORD *)desc + 5)],
      0);
    v6 = *(_DWORD *)grim_interface_ptr;
    qmemcpy(v14, "333?333?333?fff?", sizeof(v14));
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(v6 + 276))(
      grim_interface_ptr,
      v14[0],
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v7 = 0;
    if ( 35 * terrain_texture_width * terrain_texture_height / 0x80000 > 0 )
    {
      descb = v15 * 128.0;
      do
      {
        v8 = *(_DWORD *)grim_interface_ptr;
        *(float *)&v14[3] = (double)(crt_rand() % 314) * 0.0099999998;
        (*(void (__thiscall **)(int, _DWORD))(v8 + 252))(grim_interface_ptr, v14[3]);
        v16 = (double)(crt_rand() % (terrain_texture_width + 128)) - 64.0;
        v9 = crt_rand();
        *(float *)&v14[3] = descb;
        *(float *)&v14[2] = descb;
        v14[1] = &v18;
        v18 = ((double)(v9 % (terrain_texture_width + 128)) - 64.0) * v15;
        v19 = v16 * v15;
        (*(void (__thiscall **)(int, float *, float, float))(*(_DWORD *)grim_interface_ptr + 288))(
          grim_interface_ptr,
          &v18,
          COERCE_FLOAT(LODWORD(descb)),
          COERCE_FLOAT(LODWORD(descb)));
        ++v7;
      }
      while ( v7 < 35 * terrain_texture_width * terrain_texture_height / 0x80000 );
    }
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_48F548[*((_DWORD *)desc + 6)],
      0);
    v14[3] = 1058642330;
    v10 = *(_DWORD *)grim_interface_ptr;
    qmemcpy(v14, "333?333?333?", 12);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(v10 + 276))(
      grim_interface_ptr,
      v14[0],
      v14[1],
      v14[2],
      1058642330);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v11 = 0;
    if ( 15 * terrain_texture_width * terrain_texture_height / 0x80000 > 0 )
    {
      descc = v15 * 128.0;
      do
      {
        v12 = *(_DWORD *)grim_interface_ptr;
        *(float *)&v14[3] = (double)(crt_rand() % 314) * 0.0099999998;
        (*(void (__thiscall **)(int, _DWORD))(v12 + 252))(grim_interface_ptr, v14[3]);
        v16 = (double)(crt_rand() % (terrain_texture_width + 128)) - 64.0;
        v13 = crt_rand();
        *(float *)&v14[3] = descc;
        *(float *)&v14[2] = descc;
        v14[1] = &v18;
        v18 = ((double)(v13 % (terrain_texture_width + 128)) - 64.0) * v15;
        v19 = v16 * v15;
        (*(void (__thiscall **)(int, float *, float, float))(*(_DWORD *)grim_interface_ptr + 288))(
          grim_interface_ptr,
          &v18,
          COERCE_FLOAT(LODWORD(descc)),
          COERCE_FLOAT(LODWORD(descc)));
        ++v11;
      }
      while ( v11 < 15 * terrain_texture_width * terrain_texture_height / 0x80000 );
    }
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    v16 = 0.0;
    v17 = 0;
    camera_offset_x = 0;
    camera_offset_y = 0;
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      1,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      2,
      v14[1],
      v14[2],
      v14[3]);
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 48))(grim_interface_ptr, -1);
  }
}

// terrain_generate_random @ 0x004181B0
// selects a terrain variant and generates the terrain texture
void terrain_generate_random()
{
  int v0; // esi
  int v1; // ebp
  int v2; // eax
  int v3; // esi
  int v4; // edi
  int v5; // ebx
  int v6; // eax
  int v7; // edx
  int v8; // esi
  int v9; // edi
  int v10; // ebx
  int v11; // eax
  int v12; // eax
  int v13; // esi
  int v14; // edi
  int v15; // ebx
  int v16; // eax
  _DWORD v17[4]; // [esp+D0h] [ebp-44h] BYREF
  float v18; // [esp+F0h] [ebp-24h]
  int v19; // [esp+F4h] [ebp-20h]
  int v20; // [esp+F8h] [ebp-1Ch]
  int v21; // [esp+FCh] [ebp-18h]
  float v22; // [esp+100h] [ebp-14h] BYREF
  float v23; // [esp+104h] [ebp-10h]
  int v24; // [esp+110h] [ebp-4h]

  v18 = 1.0 / *(float *)config_texture_scale;
  dword_48F53C = crt_rand() % 7;
  dword_48F540 = crt_rand() % 7;
  crt_rand();
  v0 = dword_48F548[0];
  v1 = dword_48F54C;
  dword_48F53C = 0;
  dword_48F540 = 1;
  dword_48F544 = 0;
  v24 = dword_48F548[0];
  if ( (unsigned __int16)game_status_blob >= 0x28u && (crt_rand() & 7) == 3 )
  {
    terrain_generate(dword_484C84);
  }
  else if ( (unsigned __int16)game_status_blob >= 0x1Eu && (crt_rand() & 7) == 3 )
  {
    terrain_generate(dword_484ACC);
  }
  else if ( (unsigned __int16)game_status_blob >= 0x14u && (crt_rand() & 7) == 3 )
  {
    terrain_generate(desc);
  }
  else
  {
    v21 = 0;
    camera_offset_y = 0;
    *(float *)&v20 = 0.0;
    camera_offset_x = 0;
    if ( !terrain_texture_failed )
    {
      LOBYTE(v17[0]) = 1;
      (*(void (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        18,
        v17[0],
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        21,
        1,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
        grim_interface_ptr,
        0,
        0,
        1065353216,
        1065353216);
      (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 48))(grim_interface_ptr, terrain_render_target);
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 44))(
        grim_interface_ptr,
        1048378621,
        1046536417,
        1036568777,
        1065353216);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, v0, 0);
      v2 = *(_DWORD *)grim_interface_ptr;
      qmemcpy(v17, "333?333?333?fff?", sizeof(v17));
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(v2 + 276))(
        grim_interface_ptr,
        v17[0],
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v3 = 0;
      if ( 800 * terrain_texture_width * terrain_texture_height / 0x80000 > 0 )
      {
        *(float *)&v19 = v18 * 128.0;
        v4 = v19;
        do
        {
          v5 = *(_DWORD *)grim_interface_ptr;
          v19 = crt_rand() % 314;
          *(float *)&v17[3] = (double)v19 * 0.0099999998;
          (*(void (__thiscall **)(int, _DWORD))(v5 + 252))(grim_interface_ptr, v17[3]);
          v19 = crt_rand() % (terrain_texture_width + 128);
          *(float *)&v20 = (double)v19 - 64.0;
          v6 = crt_rand();
          v17[3] = v4;
          v17[2] = v4;
          v17[1] = &v22;
          v19 = v6 % (terrain_texture_width + 128);
          v22 = ((double)v19 - 64.0) * v18;
          v23 = *(float *)&v20 * v18;
          (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 288))(
            grim_interface_ptr,
            &v22,
            v4,
            v4);
          ++v3;
        }
        while ( v3 < 800 * terrain_texture_width * terrain_texture_height / 0x80000 );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, v1, 0);
      v7 = *(_DWORD *)grim_interface_ptr;
      qmemcpy(v17, "333?333?333?fff?", sizeof(v17));
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(v7 + 276))(
        grim_interface_ptr,
        v17[0],
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v8 = 0;
      if ( 35 * terrain_texture_width * terrain_texture_height / 0x80000 > 0 )
      {
        *(float *)&v19 = v18 * 128.0;
        v9 = v19;
        do
        {
          v10 = *(_DWORD *)grim_interface_ptr;
          v20 = crt_rand() % 314;
          *(float *)&v17[3] = (double)v20 * 0.0099999998;
          (*(void (__thiscall **)(int, _DWORD))(v10 + 252))(grim_interface_ptr, v17[3]);
          v20 = crt_rand() % (terrain_texture_width + 128);
          *(float *)&v19 = (double)v20 - 64.0;
          v11 = crt_rand();
          v17[3] = v9;
          v17[2] = v9;
          v17[1] = &v22;
          v20 = v11 % (terrain_texture_width + 128);
          v22 = ((double)v20 - 64.0) * v18;
          v23 = *(float *)&v19 * v18;
          (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 288))(
            grim_interface_ptr,
            &v22,
            v9,
            v9);
          ++v8;
        }
        while ( v8 < 35 * terrain_texture_width * terrain_texture_height / 0x80000 );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, v24, 0);
      v17[3] = 1058642330;
      v12 = *(_DWORD *)grim_interface_ptr;
      qmemcpy(v17, "333?333?333?", 12);
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(v12 + 276))(
        grim_interface_ptr,
        v17[0],
        v17[1],
        v17[2],
        1058642330);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v13 = 0;
      if ( 15 * terrain_texture_width * terrain_texture_height / 0x80000 > 0 )
      {
        *(float *)&v19 = v18 * 128.0;
        v14 = v19;
        do
        {
          v15 = *(_DWORD *)grim_interface_ptr;
          v20 = crt_rand() % 314;
          *(float *)&v17[3] = (double)v20 * 0.0099999998;
          (*(void (__thiscall **)(int, _DWORD))(v15 + 252))(grim_interface_ptr, v17[3]);
          v20 = crt_rand() % (terrain_texture_width + 128);
          *(float *)&v19 = (double)v20 - 64.0;
          v16 = crt_rand();
          v17[3] = v14;
          v17[2] = v14;
          v17[1] = &v22;
          v20 = v16 % (terrain_texture_width + 128);
          v22 = ((double)v20 - 64.0) * v18;
          v23 = *(float *)&v19 * v18;
          (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 288))(
            grim_interface_ptr,
            &v22,
            v14,
            v14);
          ++v13;
        }
        while ( v13 < 15 * terrain_texture_width * terrain_texture_height / 0x80000 );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      *(float *)&v20 = 0.0;
      v21 = 0;
      camera_offset_x = 0;
      camera_offset_y = 0;
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        1065353216);
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        1,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        21,
        2,
        v17[1],
        v17[2],
        v17[3]);
      (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 48))(grim_interface_ptr, -1);
      if ( *(float *)(cv_verbose + 12) != 0.0 )
        console_printf(&console_log_queue, aGeneratedTerra);
    }
  }
}

// terrain_render @ 0x004188A0
// renders the terrain layer from terrain_render_target (ground RT) with UV scrolling; honors cv_terrainFilter (point filter when value==2.0); tiles fallback when texture missing
void terrain_render()
{
  int v0; // eax
  int v1; // edi
  int v2; // ecx
  int v3; // esi
  double v4; // st7
  double v5; // st6
  int v6; // [esp+64h] [ebp-28h]
  float v7; // [esp+64h] [ebp-28h]
  int v8; // [esp+64h] [ebp-28h]
  int v9; // [esp+68h] [ebp-24h]
  int v10; // [esp+68h] [ebp-24h]
  float v11; // [esp+68h] [ebp-24h]
  int v12; // [esp+68h] [ebp-24h]
  int v13; // [esp+68h] [ebp-24h]
  int v14; // [esp+6Ch] [ebp-20h]
  int v15; // [esp+6Ch] [ebp-20h]
  int v16; // [esp+6Ch] [ebp-20h]
  float v17; // [esp+6Ch] [ebp-20h]
  int v18; // [esp+6Ch] [ebp-20h]
  int v19; // [esp+70h] [ebp-1Ch]
  int v20; // [esp+70h] [ebp-1Ch]
  int v21; // [esp+70h] [ebp-1Ch]
  float v22; // [esp+70h] [ebp-1Ch]
  int v23; // [esp+70h] [ebp-1Ch]
  int v24; // [esp+80h] [ebp-Ch]
  float v25; // [esp+80h] [ebp-Ch]
  int v26; // [esp+84h] [ebp-8h]
  float v27; // [esp+84h] [ebp-8h]
  float v28; // [esp+88h] [ebp-4h]

  if ( *(_DWORD *)(cv_terrainFilter + 12) == 0x40000000 )
    (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 21, 1);
  v0 = *(_DWORD *)grim_interface_ptr;
  if ( terrain_texture_failed )
  {
    (*(void (__stdcall **)(int, _DWORD))(v0 + 196))(terrain_render_target, 0);
    LOBYTE(v6) = 0;
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      18,
      v6,
      v9,
      v14,
      v19);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    v1 = 0;
    if ( terrain_texture_height / 256 + 1 > 0 )
    {
      v2 = terrain_texture_width;
      v26 = 0;
      do
      {
        v3 = 0;
        if ( v2 / 256 + 1 > 0 )
        {
          v24 = 0;
          do
          {
            v28 = (float)v26;
            v11 = v28 + *(float *)&camera_offset_y;
            v7 = (double)v24 + *(float *)&camera_offset_x;
            (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
              LODWORD(v7),
              LODWORD(v11),
              1132462080,
              1132462080);
            v2 = terrain_texture_width;
            ++v3;
            v24 += 256;
          }
          while ( v3 < terrain_texture_width / 256 + 1 );
        }
        ++v1;
        v26 += 256;
      }
      while ( v1 < terrain_texture_height / 256 + 1 );
    }
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      2,
      v10,
      v15,
      v20);
    LOBYTE(v8) = 1;
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      18,
      v8,
      v12,
      v16,
      v21);
  }
  else
  {
    (*(void (__stdcall **)(int, _DWORD))(v0 + 196))(terrain_render_target, 0);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    v4 = (double)terrain_texture_width;
    v25 = -(*(float *)&camera_offset_x / v4);
    v5 = (double)terrain_texture_height;
    v27 = -(*(float *)&camera_offset_y / v5);
    v22 = (double)config_screen_height / v5 + v27;
    v17 = (double)*(int *)config_screen_width / v4 + v25;
    (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 256))(
      LODWORD(v25),
      LODWORD(v27),
      LODWORD(v17),
      LODWORD(v22));
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 200))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      2,
      v13,
      v18,
      v23);
  }
}

// creature_render_type @ 0x00418B60
// renders active creatures matching type_id using 8x8 atlases and animation strips
void creature_render_type(int type_id)
{
  int v1; // ebp
  int *v2; // esi
  int v3; // ebx
  int v4; // eax
  double v5; // st7
  __int64 v6; // rax
  double v7; // st7
  double v8; // st7
  float *v9; // esi
  double v10; // st7
  int v11; // ebx
  int v12; // eax
  double v13; // st7
  __int64 v14; // rax
  double v15; // st7
  double v16; // st7
  char v17; // al
  float *v18; // esi
  int v19; // ebx
  int v20; // eax
  double v21; // st7
  __int64 v22; // rax
  double v23; // st7
  double v24; // st7
  char v25; // al
  int *v26; // esi
  double v27; // st7
  int v28; // ebx
  int v29; // eax
  __int64 v30; // rax
  double v31; // st7
  int v32; // [esp+C0h] [ebp-58h]
  int v33; // [esp+C0h] [ebp-58h]
  int v34; // [esp+C0h] [ebp-58h]
  int v35; // [esp+C0h] [ebp-58h]
  int v36; // [esp+C0h] [ebp-58h]
  int v37; // [esp+C4h] [ebp-54h]
  int v38; // [esp+C4h] [ebp-54h]
  int v39; // [esp+C4h] [ebp-54h]
  int v40; // [esp+C4h] [ebp-54h]
  int v41; // [esp+C4h] [ebp-54h]
  int v42; // [esp+C8h] [ebp-50h]
  int v43; // [esp+C8h] [ebp-50h]
  float v44; // [esp+C8h] [ebp-50h]
  int v45; // [esp+C8h] [ebp-50h]
  int v46; // [esp+C8h] [ebp-50h]
  float v47; // [esp+C8h] [ebp-50h]
  float v48; // [esp+C8h] [ebp-50h]
  int v49; // [esp+C8h] [ebp-50h]
  float v50; // [esp+C8h] [ebp-50h]
  float v51; // [esp+DCh] [ebp-3Ch]
  float v52; // [esp+E0h] [ebp-38h]
  float v53; // [esp+E4h] [ebp-34h]
  float v54; // [esp+E8h] [ebp-30h]
  float v55; // [esp+E8h] [ebp-30h]
  float v56; // [esp+E8h] [ebp-30h]
  float v57; // [esp+E8h] [ebp-30h]
  float v58; // [esp+ECh] [ebp-2Ch]
  float v59; // [esp+ECh] [ebp-2Ch]
  float v60; // [esp+ECh] [ebp-2Ch]
  float v61; // [esp+F0h] [ebp-28h]
  float v62; // [esp+F4h] [ebp-24h]
  float v63; // [esp+F4h] [ebp-24h]
  float v64; // [esp+F4h] [ebp-24h]
  float v65; // [esp+F8h] [ebp-20h]
  float v66; // [esp+F8h] [ebp-20h]
  float v67; // [esp+FCh] [ebp-1Ch]
  float v68; // [esp+108h] [ebp-10h] BYREF
  float v69; // [esp+10Ch] [ebp-Ch]
  float v70; // [esp+110h] [ebp-8h]
  float v71; // [esp+114h] [ebp-4h]
  float v72; // [esp+120h] [ebp+8h]

  v1 = type_id;
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    creature_type_table[17 * type_id],
    0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  if ( config_fx_detail_flag0 && !perk_count_get(perk_id_monster_vision) )
  {
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      1,
      v32,
      v37,
      v42);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v33,
      v38,
      v43);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v2 = creature_hitbox_size;
    while ( 1 )
    {
      if ( !*((_BYTE *)v2 - 16) || v2[23] != v1 )
        goto LABEL_27;
      v3 = v2[31];
      v68 = *((float *)v2 + 11);
      v69 = *((float *)v2 + 12);
      v70 = *((float *)v2 + 13);
      v71 = *((float *)v2 + 14);
      v71 = v71 * 0.40000001;
      if ( (v3 & 4) == 0 || (v3 & 0x40) != 0 )
        break;
      v4 = (int)(__int64)(*((float *)v2 + 33) + 0.5) % 16;
      if ( v4 > 7 )
        v4 = 15 - v4;
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(
        grim_interface_ptr,
        8,
        creature_type_base_frame[17 * type_id] + v4 + 16);
      if ( *(float *)v2 < 0.0 )
      {
        v5 = *(float *)v2 * 0.1 + v71;
        if ( v5 < 0.0 )
          v5 = 0.0;
        goto LABEL_26;
      }
LABEL_25:
      v5 = v71;
LABEL_26:
      v71 = v5 * v72;
      (*(void (__thiscall **)(int, float *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &v68);
      v44 = *((float *)v2 + 7) - 1.5707964;
      (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v44));
      v8 = *((float *)v2 + 9) * 0.5 + 0.69999999;
      v54 = v8;
      v62 = *(float *)&camera_offset_y + *((float *)v2 + 2);
      v52 = *(float *)&camera_offset_x + *((float *)v2 + 1) - v54;
      v53 = v62 - v8;
      v51 = *((float *)v2 + 9) * 1.0700001;
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v52),
        LODWORD(v53),
        LODWORD(v51),
        LODWORD(v51));
      v1 = type_id;
LABEL_27:
      v2 += 38;
      if ( (int)v2 >= (int)&flt_4AA348 )
      {
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
        goto LABEL_29;
      }
    }
    if ( *(float *)v2 >= 16.0 )
    {
      HIDWORD(v6) = (__int64)(*((float *)v2 + 33) + 0.5);
      if ( (creature_type_anim_flags[68 * type_id] & 1) == 0 || SHIDWORD(v6) <= 15 )
        goto LABEL_22;
      LODWORD(v6) = 31 - HIDWORD(v6);
    }
    else
    {
      if ( *(float *)v2 < 0.0 )
      {
        HIDWORD(v6) = creature_type_base_frame[17 * type_id] + 15;
        v7 = *(float *)v2 * 0.5 + v71;
        v71 = v7;
        if ( v7 < 0.0 )
          v71 = 0.0;
        goto LABEL_22;
      }
      v6 = (__int64)((double)(creature_type_base_frame[17 * type_id] + 15) - *(float *)v2);
    }
    HIDWORD(v6) = v6;
LABEL_22:
    if ( (v3 & 0x10) != 0 )
      HIDWORD(v6) += 32;
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 8, HIDWORD(v6));
    goto LABEL_25;
  }
LABEL_29:
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    v32,
    v37,
    v42);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    v34,
    v39,
    v45);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  if ( bonus_energizer_timer > 0.0 )
  {
    v9 = creature_max_health;
    while ( !*((_BYTE *)v9 - 40) || *((_DWORD *)v9 + 17) != v1 )
    {
LABEL_62:
      v9 += 38;
      if ( (int)v9 >= (int)flt_4AA360 )
        goto LABEL_91;
    }
    if ( *v9 >= 500.0 )
    {
      v68 = v9[5];
      v69 = v9[6];
      v70 = v9[7];
      v71 = v9[8];
    }
    else
    {
      if ( bonus_energizer_timer >= 1.0 )
        v10 = 1.0;
      else
        v10 = bonus_energizer_timer;
      v68 = (1.0 - v10) * v9[5] + v10 * 0.5;
      v69 = (1.0 - v10) * v9[6] + v10 * 0.5;
      v70 = (1.0 - v10) * v9[7] + v10;
      v71 = (1.0 - v10) * v9[8] + v10;
    }
    v11 = *((_DWORD *)v9 + 25);
    if ( (v11 & 4) != 0 && (v11 & 0x40) == 0 )
    {
      v12 = (int)(__int64)(v9[27] + 0.5) % 16;
      if ( v12 > 7 )
        v12 = 15 - v12;
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(
        grim_interface_ptr,
        8,
        creature_type_base_frame[17 * type_id] + v12 + 16);
      if ( *(v9 - 6) < 0.0 )
      {
        v13 = *(v9 - 6) * 0.1 + v71;
        if ( v13 < 0.0 )
          v13 = 0.0;
        goto LABEL_59;
      }
LABEL_58:
      v13 = v71;
LABEL_59:
      v71 = v13 * v72;
      (*(void (__thiscall **)(int, float *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &v68);
      v47 = v9[1] - 1.5707964;
      (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v47));
      v16 = v9[3] * 0.5;
      v61 = v16;
      v67 = *(float *)&camera_offset_y + *(v9 - 4);
      v55 = *(float *)&camera_offset_x + *(v9 - 5) - v61;
      v58 = v67 - v16;
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v55),
        LODWORD(v58),
        *((_DWORD *)v9 + 3),
        *((_DWORD *)v9 + 3));
      if ( *(v9 - 6) < -10.0 )
      {
        v17 = *((_BYTE *)v9 + 100);
        *((_BYTE *)v9 - 40) = 0;
        if ( (v17 & 4) != 0 )
          creature_spawn_slot_table[6 * *((_DWORD *)v9 + 20)] = 0;
      }
      goto LABEL_62;
    }
    if ( *(v9 - 6) >= 16.0 )
    {
      HIDWORD(v14) = (__int64)(v9[27] + 0.5);
      if ( (creature_type_anim_flags[68 * type_id] & 1) == 0 || SHIDWORD(v14) <= 15 )
        goto LABEL_55;
      LODWORD(v14) = 31 - HIDWORD(v14);
    }
    else
    {
      if ( *(v9 - 6) < 0.0 )
      {
        HIDWORD(v14) = creature_type_base_frame[17 * type_id] + 15;
        v15 = *(v9 - 6) * 0.1 + v71;
        v71 = v15;
        if ( v15 < 0.0 )
          v71 = 0.0;
        goto LABEL_55;
      }
      v14 = (__int64)((double)(creature_type_base_frame[17 * type_id] + 15) - *(v9 - 6));
    }
    HIDWORD(v14) = v14;
LABEL_55:
    if ( (v11 & 0x10) != 0 )
      HIDWORD(v14) += 32;
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 260))(
      grim_interface_ptr,
      8,
      HIDWORD(v14));
    goto LABEL_58;
  }
  v18 = creature_anim_phase;
  do
  {
    if ( !*((_BYTE *)v18 - 148) || *((_DWORD *)v18 - 10) != type_id )
      goto LABEL_90;
    v19 = *((_DWORD *)v18 - 2);
    v68 = *(v18 - 22);
    v69 = *(v18 - 21);
    v70 = *(v18 - 20);
    v71 = *(v18 - 19);
    if ( (v19 & 4) == 0 || (v19 & 0x40) != 0 )
    {
      if ( *(v18 - 33) >= 16.0 )
      {
        HIDWORD(v22) = (__int64)(*v18 + 0.5);
        if ( (creature_type_anim_flags[68 * type_id] & 1) == 0 || SHIDWORD(v22) <= 15 )
          goto LABEL_83;
        LODWORD(v22) = 31 - HIDWORD(v22);
      }
      else
      {
        if ( *(v18 - 33) < 0.0 )
        {
          HIDWORD(v22) = creature_type_base_frame[17 * type_id] + 15;
          v23 = *(v18 - 33) * 0.1 + v71;
          v71 = v23;
          if ( v23 < 0.0 )
            v71 = 0.0;
          goto LABEL_83;
        }
        v22 = (__int64)((double)(creature_type_base_frame[17 * type_id] + 15) - *(v18 - 33));
      }
      HIDWORD(v22) = v22;
LABEL_83:
      if ( (v19 & 0x10) != 0 )
        HIDWORD(v22) += 32;
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 260))(
        grim_interface_ptr,
        8,
        HIDWORD(v22));
      goto LABEL_86;
    }
    v20 = (int)(__int64)(*v18 + 0.5) % 16;
    if ( v20 > 7 )
      v20 = 15 - v20;
    (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(
      grim_interface_ptr,
      8,
      creature_type_base_frame[17 * type_id] + v20 + 16);
    if ( *(v18 - 33) < 0.0 )
    {
      v21 = *(v18 - 33) * 0.1 + v71;
      if ( v21 < 0.0 )
        v21 = 0.0;
      goto LABEL_87;
    }
LABEL_86:
    v21 = v71;
LABEL_87:
    v71 = v21 * v72;
    (*(void (__thiscall **)(int, float *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &v68);
    v48 = *(v18 - 26) - 1.5707964;
    (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v48));
    v24 = *(v18 - 24) * 0.5;
    v65 = v24;
    v63 = *(float *)&camera_offset_y + *(v18 - 31);
    v56 = *(float *)&camera_offset_x + *(v18 - 32) - v65;
    v59 = v63 - v24;
    (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
      LODWORD(v56),
      LODWORD(v59),
      *((_DWORD *)v18 - 24),
      *((_DWORD *)v18 - 24));
    if ( *(v18 - 33) < -10.0 )
    {
      v25 = *((_BYTE *)v18 - 8);
      *((_BYTE *)v18 - 148) = 0;
      if ( (v25 & 4) != 0 )
        creature_spawn_slot_table[6 * *((_DWORD *)v18 - 7)] = 0;
    }
LABEL_90:
    v18 += 38;
  }
  while ( (int)v18 < (int)flt_4AA3CC );
LABEL_91:
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  if ( config_fx_toggle )
  {
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      2,
      v35,
      v40,
      v46);
    v68 = 1.0;
    v71 = 1.0;
    v69 = 1.0;
    v70 = 1.0;
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v26 = creature_hitbox_size;
    do
    {
      if ( *((_BYTE *)v26 - 16) && v26[23] == type_id && *((float *)v26 + 10) > 0.0 )
      {
        v27 = *((float *)v26 + 10) * 5.0;
        v71 = v27;
        if ( v27 > 1.0 )
          v71 = 1.0;
        v28 = v26[31];
        if ( (v28 & 4) == 0 || (v28 & 0x40) != 0 )
        {
          if ( *(float *)v26 >= 16.0 )
          {
            v30 = (__int64)(*((float *)v26 + 33) + 0.5);
            if ( (creature_type_anim_flags[68 * type_id] & 1) != 0 && (int)v30 > 15 )
              LODWORD(v30) = 31 - v30;
            if ( (v28 & 0x10) != 0 )
              LODWORD(v30) = v30 + 32;
          }
          else if ( *(float *)v26 >= 0.0 )
          {
            v30 = (__int64)((double)(creature_type_base_frame[17 * type_id] + 15) - *(float *)v26);
          }
          else
          {
            LODWORD(v30) = creature_type_base_frame[17 * type_id] + 15;
          }
          HIDWORD(v30) = *(_DWORD *)grim_interface_ptr;
        }
        else
        {
          v29 = (int)(__int64)(*((float *)v26 + 33) + 0.5) % 16;
          if ( v29 > 7 )
            v29 = 15 - v29;
          HIDWORD(v30) = *(_DWORD *)grim_interface_ptr;
          LODWORD(v30) = creature_type_base_frame[17 * type_id] + v29 + 16;
        }
        (*(void (__stdcall **)(int, _DWORD))(HIDWORD(v30) + 260))(8, v30);
        v71 = v71 * v72;
        (*(void (__thiscall **)(int, float *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &v68);
        v50 = *((float *)v26 + 7) - 1.5707964;
        (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v50));
        v31 = *((float *)v26 + 9) * 0.5;
        v66 = v31;
        v64 = *(float *)&camera_offset_y + *((float *)v26 + 2);
        v57 = *(float *)&camera_offset_x + *((float *)v26 + 1) - v66;
        v60 = v64 - v31;
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          grim_interface_ptr,
          LODWORD(v57),
          LODWORD(v60),
          v26[9],
          v26[9]);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          grim_interface_ptr,
          LODWORD(v57),
          LODWORD(v60),
          v26[9],
          v26[9]);
      }
      v26 += 38;
    }
    while ( (int)v26 < (int)&flt_4AA348 );
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v36,
      v41,
      v49);
  }
}

// creature_render_all @ 0x00419680
// creature render pass: overlays + per-type draws via creature_render_type
void creature_render_all()
{
  int *v0; // esi
  double v1; // st7
  double v2; // st7
  double v3; // st7
  double v4; // st7
  float *v5; // esi
  double v6; // st7
  float v7; // [esp+FCh] [ebp-20h]
  float v8; // [esp+FCh] [ebp-20h]
  float v9; // [esp+FCh] [ebp-20h]
  float v10; // [esp+FCh] [ebp-20h]
  int v11; // [esp+100h] [ebp-1Ch]
  float v12; // [esp+100h] [ebp-1Ch]
  float v13; // [esp+100h] [ebp-1Ch]
  float v14; // [esp+100h] [ebp-1Ch]
  int v15; // [esp+100h] [ebp-1Ch]
  int v16; // [esp+100h] [ebp-1Ch]
  float v17; // [esp+100h] [ebp-1Ch]
  int v18; // [esp+100h] [ebp-1Ch]
  int v19; // [esp+104h] [ebp-18h]
  int v20; // [esp+104h] [ebp-18h]
  int v21; // [esp+104h] [ebp-18h]
  int v22; // [esp+104h] [ebp-18h]
  int v23; // [esp+104h] [ebp-18h]
  int v24; // [esp+108h] [ebp-14h]
  float v25; // [esp+108h] [ebp-14h]
  float v26; // [esp+108h] [ebp-14h]
  float v27; // [esp+108h] [ebp-14h]
  int v28; // [esp+108h] [ebp-14h]
  int v29; // [esp+108h] [ebp-14h]
  float v30; // [esp+108h] [ebp-14h]
  int v31; // [esp+108h] [ebp-14h]
  float v32; // [esp+114h] [ebp-8h]
  int v33; // [esp+114h] [ebp-8h]
  float v34; // [esp+118h] [ebp-4h]

  v32 = ui_transition_alpha;
  if ( ui_transition_alpha > 0.0
    && game_state_id != 20
    && game_state_id != 22
    && game_state_prev != 20
    && game_state_prev != 22 )
  {
    (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 19, 5);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v11,
      v19,
      v24);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      particles_texture,
      0);
    effect_select_texture(16);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      0,
      0,
      0,
      1065353216);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v0 = creature_hitbox_size;
    do
    {
      if ( *((_BYTE *)v0 - 16) )
      {
        if ( perk_count_get(perk_id_monster_vision) )
        {
          if ( *(float *)v0 < 0.0 && (v1 = (*(float *)v0 + 10.0) * 0.1, v1 <= 1.0) )
          {
            if ( v1 < 0.0 )
              v1 = 0.0;
          }
          else
          {
            v1 = 1.0;
          }
          v25 = v1 * v32;
          (*(void (__stdcall **)(int, int, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
            1065353216,
            1065353216,
            0,
            LODWORD(v25));
          v12 = *(float *)&camera_offset_y + *((float *)v0 + 2) - 45.0;
          v7 = *(float *)&camera_offset_x + *((float *)v0 + 1) - 45.0;
          (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v7),
            LODWORD(v12),
            1119092736,
            1119092736);
        }
        if ( *((_BYTE *)v0 - 7) )
        {
          if ( *(float *)v0 >= 0.0 )
            v2 = 1.0;
          else
            v2 = (*(float *)v0 + 10.0) * 0.1;
          v26 = v2 * v32;
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
            0,
            0,
            0,
            LODWORD(v26));
          v13 = *(float *)&camera_offset_y + *((float *)v0 + 2) - 40.0;
          v8 = *(float *)&camera_offset_x + *((float *)v0 + 1) - 40.0;
          (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v8),
            LODWORD(v13),
            1117782016,
            1117782016);
        }
        if ( (v0[31] & 1) != 0 )
        {
          if ( *(float *)v0 >= 0.0 )
            v3 = 1.0;
          else
            v3 = (*(float *)v0 + 10.0) * 0.1;
          v27 = v3 * v32;
          (*(void (__stdcall **)(int, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
            1065353216,
            0,
            0,
            LODWORD(v27));
          v14 = *(float *)&camera_offset_y + *((float *)v0 + 2) - 30.0;
          v9 = *(float *)&camera_offset_x + *((float *)v0 + 1) - 30.0;
          (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v9),
            LODWORD(v14),
            1114636288,
            1114636288);
        }
      }
      v0 += 38;
    }
    while ( (int)v0 < (int)&flt_4AA348 );
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    creature_render_type(0);
    creature_render_type(3);
    creature_render_type(4);
    creature_render_type(2);
    creature_render_type(1);
    if ( bonus_freeze_timer > 0.0 )
    {
      (*(void (__thiscall **)(int, int, int, float, int, float))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        COERCE_FLOAT(LODWORD(v32)),
        v20,
        COERCE_FLOAT(LODWORD(v32)));
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v15,
        v21,
        v28);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        particles_texture,
        0);
      effect_select_texture(14);
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        0,
        0,
        0,
        1065353216);
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
      v4 = 1.0;
      if ( bonus_freeze_timer < 1.0 )
      {
        v4 = bonus_freeze_timer;
        if ( bonus_freeze_timer <= 1.0 )
        {
          if ( v4 < 0.0 )
            v4 = 0.0;
        }
        else
        {
          v4 = 1.0;
        }
      }
      v34 = v4 * v32 * 0.69999999;
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v33 = 0;
      v5 = &creature_size;
      do
      {
        if ( *((_BYTE *)v5 - 52) )
        {
          (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            1065353216,
            1065353216,
            1065353216,
            COERCE_FLOAT(LODWORD(v34)));
          v30 = (double)v33 * 0.0099999998 + *(v5 - 2);
          (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v30));
          v6 = *v5 * 0.5;
          v17 = *(float *)&camera_offset_y + *(v5 - 7) - v6;
          v10 = *(float *)&camera_offset_x + *(v5 - 8) - v6;
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v10),
            LODWORD(v17),
            *(_DWORD *)v5,
            *(_DWORD *)v5);
        }
        v5 += 38;
        ++v33;
      }
      while ( (int)v5 < (int)flt_4AA36C );
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v16,
        v22,
        v29);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v18,
        v23,
        v31);
    }
    (*(void (__thiscall **)(int, _DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      0,
      1065353216,
      1065353216,
      1065353216);
  }
}

// ui_element_set_rect @ 0x00419BA0
// sets element quad vertices/UVs for a size and offset
float *__cdecl sub_419BA0(int a1, float a2, float a3, float *a4)
{
  double v4; // st7
  float *result; // eax
  float v6; // edx
  int v7; // edx
  double v8; // st7
  float v9; // [esp+0h] [ebp-Ch]
  float v10; // [esp+4h] [ebp-8h]
  float v11; // [esp+4h] [ebp-8h]
  float v12; // [esp+4h] [ebp-8h]
  float v13; // [esp+8h] [ebp-4h]
  float v14; // [esp+14h] [ebp+8h]
  float v15; // [esp+14h] [ebp+8h]

  v4 = 1.0 / a2;
  *(_DWORD *)a1 = 1065353216;
  *(_DWORD *)(a1 + 4) = 1065353216;
  result = (float *)(a1 + 4);
  v9 = 1.0 / a3;
  v10 = a2 - 1.0;
  *(float *)(a1 + 28) = v10;
  *(_DWORD *)(a1 + 32) = 1065353216;
  *(_DWORD *)(a1 + 84) = 1065353216;
  v14 = a3 - 1.0;
  *(float *)(a1 + 88) = v14;
  v6 = v10;
  v11 = v4;
  *(float *)(a1 + 56) = v6;
  *(float *)(a1 + 60) = v14;
  *(float *)(a1 + 20) = v11;
  *(float *)(a1 + 24) = v9;
  v15 = 1.0 - v4;
  *(float *)(a1 + 48) = v15;
  v12 = v4;
  *(float *)(a1 + 52) = v9;
  *(float *)(a1 + 104) = v12;
  v13 = 1.0 - v9;
  *(float *)(a1 + 76) = v15;
  *(float *)(a1 + 108) = v15;
  *(float *)(a1 + 80) = v13;
  v7 = 4;
  do
  {
    result[3] = NAN;
    result[1] = 0.5;
    result[2] = 1.0;
    v8 = *(result - 1) + *a4;
    result += 7;
    --v7;
    *(result - 8) = v8;
    *(result - 7) = *(result - 7) + a4[1];
  }
  while ( v7 );
  return result;
}

// ui_element_load @ 0x00419D00
// loads a UI element JAZ asset and logs failures
char __cdecl sub_419D00(int a1, const char *a2)
{
  int v2; // eax
  _BYTE v4[4]; // [esp+8h] [ebp-104h] BYREF
  char ArgList[256]; // [esp+Ch] [ebp-100h] BYREF

  strcpy(ArgList, a2);
  v4[strlen(a2)] = 0;
  if ( *(float *)(cv_silentloads + 12) == 0.0 )
    console_printf((int)&console_log_queue, "Loading uiElement %s\n", ArgList);
  (*(void (__thiscall **)(int, char *, const char *))(*(_DWORD *)grim_interface_ptr + 180))(
    grim_interface_ptr,
    ArgList,
    a2);
  v2 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, ArgList);
  *(_DWORD *)(a1 + 224) = v2;
  if ( v2 == -1 )
    LOBYTE(v2) = console_printf((int)&console_log_queue, "! FAILED Loading uiElement %s\n", ArgList);
  return v2;
}

// ui_menu_assets_init @ 0x00419DD0
// loads menu UI elements and seeds layout copies
void ui_menu_assets_init()
{
  float *v0; // eax
  double v1; // st7
  int v2; // [esp+8h] [ebp-8h] BYREF
  int v3; // [esp+Ch] [ebp-4h]

  ui_element_load((int)&unk_48FAC0, aUiUiSigncrimso);
  v2 = -1005560791;
  v3 = -1032323072;
  ui_element_set_rect((int)&unk_48FAC0, 573.44, 143.36, (float *)&v2);
  ui_element_load((int)&unk_48FBA8, aUiUiMenuitemJa);
  v2 = -1030750208;
  v3 = -1032847360;
  ui_element_set_rect((int)&unk_48FBA8, 512.0, 64.0, (float *)&v2);
  ui_element_load((int)&unk_48FC90, aUiUiMenupanelJ);
  v2 = 1101004800;
  v3 = -1029439488;
  ui_element_set_rect((int)&unk_48FC90, 512.0, 256.0, (float *)&v2);
  qmemcpy(&unk_48FD78, &unk_48FC90, 0xE8u);
  dword_48FE5C = 8;
  qmemcpy(&unk_48FE3C, &unk_48FDCC, 0x1Cu);
  v0 = (float *)&unk_48FD78;
  qmemcpy(&unk_48FE20, &unk_48FDB0, 0x1Cu);
  flt_48FDB4 = flt_48FDB4 - 116.0;
  flt_48FDD0 = flt_48FDD0 - 116.0;
  dword_48FDC8 = 1057095680;
  dword_48FDE4 = 1057095680;
  qmemcpy(&unk_48FDE8, &unk_48FDCC, 0x1Cu);
  qmemcpy(&unk_48FE04, &unk_48FDB0, 0x1Cu);
  flt_48FDEC = flt_48FDEC + 124.0;
  flt_48FE08 = flt_48FE08 + 124.0;
  dword_48FE00 = 1058406400;
  dword_48FE1C = 1058406400;
  flt_48FE24 = flt_48FE24 + 124.0;
  flt_48FE40 = flt_48FE40 + 124.0;
  do
  {
    v1 = *v0 - 84.0;
    v0[1] = v0[1];
    v0 += 7;
    *(v0 - 7) = v1;
  }
  while ( (int)v0 < (int)&flt_48FE58 );
  qmemcpy(&unk_48FE60, &unk_48FD78, 0xE8u);
  flt_48FED4 = flt_48FDEC - 100.0;
  flt_48FEF0 = flt_48FEF0 - 100.0;
  flt_48FF0C = flt_48FF0C - 100.0;
  flt_48FF28 = flt_48FF28 - 100.0;
  ui_menu_layout_init();
}

// ui_render_aim_enhancement @ 0x0041A320
// renders the aim enhancement overlay (cv_aimEnhancementFade-driven)
void ui_render_aim_enhancement()
{
  int v0; // edx
  float v1; // [esp+A0h] [ebp-14h]
  float v2; // [esp+A0h] [ebp-14h]
  int v3; // [esp+A4h] [ebp-10h]
  float v4; // [esp+A4h] [ebp-10h]
  int v5; // [esp+A4h] [ebp-10h]
  int v6; // [esp+A4h] [ebp-10h]
  float v7; // [esp+A4h] [ebp-10h]
  int v8; // [esp+A8h] [ebp-Ch]
  int v9; // [esp+A8h] [ebp-Ch]
  int v10; // [esp+A8h] [ebp-Ch]
  int v11; // [esp+ACh] [ebp-8h]
  int v12; // [esp+ACh] [ebp-8h]
  int v13; // [esp+ACh] [ebp-8h]
  float *v14; // [esp+B8h] [ebp+4h]

  flt_4902F0 = frame_dt + flt_4902F0;
  flt_4902F4 = frame_dt * 0.60000002 + flt_4902F4;
  (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 19, 5);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    2,
    v3,
    v8,
    v11);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    particles_texture,
    0);
  effect_select_texture(13);
  v0 = cv_aimEnhancementFade;
  if ( *(float *)(cv_aimEnhancementFade + 12) > 1.0 )
  {
    *(_DWORD *)(cv_aimEnhancementFade + 12) = 1065353216;
    v0 = cv_aimEnhancementFade;
  }
  if ( *(float *)(v0 + 12) < 0.0 )
  {
    *(_DWORD *)(v0 + 12) = 0;
    v0 = cv_aimEnhancementFade;
  }
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    *(_DWORD *)(v0 + 12));
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v4 = v14[1] - 32.0;
  v1 = *v14 - 32.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v1),
    LODWORD(v4),
    1115684864,
    1115684864);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    v5,
    v9,
    v12);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    v6,
    v10,
    v13);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F79C, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    *(_DWORD *)(cv_aimEnhancementFade + 12));
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v7 = v14[1] - 10.0;
  v2 = *v14 - 10.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v2),
    LODWORD(v7),
    1101004800,
    1101004800);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
}

// ui_elements_update_and_render @ 0x0041A530
// advances UI timeline, handles transitions, updates + renders all UI elements
void ui_elements_update_and_render()
{
  int v0; // eax
  long double v1; // st6
  int *v2; // esi
  int v3; // [esp-Ch] [ebp-10h]
  int v4; // [esp-8h] [ebp-Ch]
  int v5; // [esp-4h] [ebp-8h]

  (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 21, 2);
  if ( !console_open_flag )
  {
    if ( ui_transition_direction )
      v0 = frame_dt_ms + ui_elements_timeline;
    else
      v0 = ui_elements_timeline - frame_dt_ms;
    ui_elements_timeline = v0;
  }
  if ( ui_elements_timeline < 0 )
  {
    ui_elements_timeline = 0;
    if ( demo_mode_active && !game_state_pending )
      terrain_generate_random();
    game_state_set(game_state_pending);
    game_state_pending = 25;
  }
  if ( ui_elements_timeline > ui_elements_max_timeline() )
  {
    if ( !game_state_id && demo_mode_active )
    {
      demo_mode_active = 0;
      config_load_presets();
    }
    ui_sign_crimson_update_disabled = 1;
    flt_487594 = cos(0.0);
    v1 = sin(0.0);
    flt_487598 = -v1;
    flt_48759C = v1;
    flt_4875A0 = flt_487594;
    ui_elements_timeline = ui_elements_max_timeline();
  }
  if ( game_state_id != 9 )
  {
    v2 = &ui_element_table_start;
    do
    {
      ui_element_update(*v2);
      ui_element_render(*v2--);
    }
    while ( (int)v2 >= (int)ui_element_table_end );
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    if ( game_state_id == 10 )
      byte_47EA50 = 1;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1056964608,
      v3,
      v4,
      v5);
  }
}

// ui_draw_progress_bar @ 0x0041A6D0
// draws a filled progress bar with a tinted background
void ui_draw_progress_bar(float *xy, float width, float ratio, float *rgba)
{
  float v4; // [esp+10h] [ebp-2Ch]
  float v5; // [esp+24h] [ebp-18h] BYREF
  float v6; // [esp+28h] [ebp-14h]
  float v7[4]; // [esp+2Ch] [ebp-10h] BYREF

  if ( ratio >= 0.0 )
  {
    if ( ratio > 1.0 )
      ratio = 1.0;
  }
  else
  {
    ratio = 0.0;
  }
  v7[0] = *rgba * 0.60000002;
  v7[1] = rgba[1] * 0.60000002;
  v7[2] = rgba[2] * 0.60000002;
  v7[3] = rgba[3] * 0.40000001;
  v5 = *xy;
  v6 = xy[1];
  (*(void (__thiscall **)(int, float *, _DWORD, int, float *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    &v5,
    LODWORD(width),
    1082130432,
    v7);
  v5 = *xy + 1.0;
  v6 = xy[1] + 1.0;
  v4 = (width - 2.0) * ratio;
  (*(void (__thiscall **)(int, float *, _DWORD, int, float *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    &v5,
    LODWORD(v4),
    0x40000000,
    rgba);
}

// sub_41A7D0 @ 0x0041A7D0
_DWORD *sub_41A7D0()
{
  _DWORD *result; // eax
  int v1; // ecx

  result = &bonus_hud_slot_y;
  v1 = 16;
  do
  {
    result[6] = 1084227584;
    *((_BYTE *)result - 4) = 0;
    *result = 0;
    result[5] = 1;
    result[4] = aEmpty;
    result[1] = 1065353216;
    result += 8;
    --v1;
  }
  while ( v1 );
  return result;
}

// sub_41A810 @ 0x0041A810
char __cdecl sub_41A810(int a1, int a2, int a3, int a4)
{
  int v4; // eax
  char *v5; // ecx
  char *v6; // eax
  int v7; // ecx
  int v8; // esi
  _DWORD *v9; // edx
  int v10; // ecx

  v4 = 0;
  v5 = (char *)&bonus_hud_slot_table;
  while ( *v5 )
  {
    v5 += 32;
    ++v4;
    if ( (int)v5 >= (int)byte_48F788 )
      return v4;
  }
  v6 = (char *)&bonus_hud_slot_table + 32 * v4;
  *((_DWORD *)v6 + 3) = a3;
  *((_DWORD *)v6 + 6) = a2;
  v7 = config_player_count;
  *((_DWORD *)v6 + 4) = a4;
  *v6 = 1;
  *((_DWORD *)v6 + 1) = -1019740160;
  *((_DWORD *)v6 + 5) = a1;
  if ( v7 <= 1 )
    *((_DWORD *)v6 + 4) = 0;
  v8 = 0;
  v9 = &bonus_hud_slot_timer_ptr;
  do
  {
    LOBYTE(v4) = *((_BYTE *)v9 - 12);
    if ( (_BYTE)v4 )
    {
      v10 = 16;
      v4 = (int)byte_48F788;
      do
      {
        if ( *v9 == *(_DWORD *)(v4 + 12) && v8 != v10 )
          *(_BYTE *)v4 = 0;
        v4 -= 32;
        --v10;
      }
      while ( v4 >= (int)&bonus_hud_slot_table );
    }
    v9 += 8;
    ++v8;
  }
  while ( (int)v9 < (int)&dword_48F794 );
  return v4;
}

// bonus_hud_slot_update_and_render @ 0x0041A8B0
// updates bonus HUD slot animation and renders icon/timers
void bonus_hud_slot_update_and_render(float *xy, int slot)
{
  int v2; // edi
  char *v3; // esi
  float *v4; // eax
  double v5; // st7
  int v6; // eax
  _BYTE *v7; // ecx
  bool v8; // zf
  int v9; // edx
  float v10; // ebx
  _DWORD *v11; // edi
  int v12; // eax
  float *v13; // ecx
  double v14; // st7
  float *v15; // edx
  double v16; // st7
  float *v17; // edx
  double v18; // st7
  float *v19; // eax
  double v20; // st7
  double v21; // st7
  float v22; // [esp+7Ch] [ebp-30h]
  float v23; // [esp+7Ch] [ebp-30h]
  float v24; // [esp+80h] [ebp-2Ch]
  float v25; // [esp+80h] [ebp-2Ch]
  float ratio; // [esp+84h] [ebp-28h]
  float ratioa; // [esp+84h] [ebp-28h]
  float ratiob; // [esp+84h] [ebp-28h]
  float ratioc; // [esp+84h] [ebp-28h]
  float ratiod; // [esp+84h] [ebp-28h]
  float v31; // [esp+98h] [ebp-14h] BYREF
  float v32; // [esp+9Ch] [ebp-10h]
  float rgba; // [esp+A0h] [ebp-Ch] BYREF
  int v34; // [esp+A4h] [ebp-8h]
  int v35; // [esp+A8h] [ebp-4h]
  float retaddr; // [esp+ACh] [ebp+0h]
  float v37; // [esp+B8h] [ebp+Ch]
  float v38; // [esp+BCh] [ebp+10h]

  v3 = (char *)&bonus_hud_slot_table + 32 * slot;
  if ( *v3 )
  {
    if ( **((float **)v3 + 3) > 0.0 || (v4 = (float *)*((_DWORD *)v3 + 4)) != 0 && *v4 > 0.0 )
      v5 = frame_dt * 350.0 + *((float *)v3 + 1);
    else
      v5 = *((float *)v3 + 1) - frame_dt * 320.0;
    *((float *)v3 + 1) = v5;
    if ( *((float *)v3 + 1) > -2.0 )
      *((_DWORD *)v3 + 1) = -1073741824;
    if ( *((float *)v3 + 1) >= -184.0 )
    {
      v9 = *(_DWORD *)grim_interface_ptr;
      if ( *(float *)(cv_uiSmallIndicators + 12) == 0.0 )
      {
        (*(void (__stdcall **)(int, _DWORD, int))(v9 + 196))(dword_48F7C4, 0, v2);
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          0,
          0,
          1065353216,
          1065353216);
        v37 = v38 * 0.69999999;
        v10 = v37;
        (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v37)));
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
        v11 = (_DWORD *)slot;
        v25 = *(float *)slot - 11.0;
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          grim_interface_ptr,
          *((_DWORD *)v3 + 1),
          LODWORD(v25),
          1127612416,
          1112801280);
      }
      else
      {
        (*(void (__stdcall **)(int, _DWORD, int))(v9 + 196))(dword_48F7C4, 0, v2);
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          0,
          0,
          1065353216,
          1065353216);
        v37 = v38 * 0.69999999;
        v10 = v37;
        (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v37)));
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
        v11 = (_DWORD *)slot;
        v24 = *(float *)slot + 5.0;
        v22 = *((float *)v3 + 1) - 100.0 + 4.0;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v22),
          LODWORD(v24),
          1127612416,
          1104412672);
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        COERCE_FLOAT(LODWORD(v38)));
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        bonus_texture,
        0);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 260))(
        grim_interface_ptr,
        4,
        *((_DWORD *)v3 + 6));
      v23 = *((float *)v3 + 1) - 1.0;
      (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v23),
        *v11,
        1107296256,
        1107296256);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      v12 = *((_DWORD *)v3 + 4);
      if ( *(float *)(cv_uiSmallIndicators + 12) == 0.0 )
      {
        v17 = (float *)*((_DWORD *)v3 + 3);
        if ( v12 )
        {
          v31 = *((float *)v3 + 1) + 36.0;
          v18 = *(float *)v11 + 21.0;
          rgba = 0.1;
          v34 = 1050253722;
          v35 = 1058642330;
          v32 = v18 - 4.0;
          ratiob = *v17 * 0.050000001;
          ui_draw_progress_bar(&v31, 100.0, ratiob, &rgba);
          v19 = (float *)*((_DWORD *)v3 + 4);
          v31 = *((float *)v3 + 1) + 36.0;
          retaddr = v37;
          v32 = *(float *)v11 + 23.0;
          v20 = *v19 * 0.050000001;
          rgba = 0.1;
        }
        else
        {
          retaddr = v37;
          v31 = *((float *)v3 + 1) + 36.0;
          v21 = *(float *)v11 + 21.0;
          rgba = 0.1;
          v32 = v21;
          v20 = *v17 * 0.050000001;
        }
        v34 = 1050253722;
        v35 = 1058642330;
        ratioc = v20;
        ui_draw_progress_bar(&v31, 100.0, ratioc, &rgba);
        (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v10)));
        ratiod = *((float *)v3 + 1) + 36.0;
        (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 324))(LODWORD(ratiod));
        *(float *)v11 = *(float *)v11 + 52.0;
      }
      else
      {
        if ( v12 )
        {
          v13 = (float *)*((_DWORD *)v3 + 3);
          v31 = *((float *)v3 + 1) + 36.0;
          v14 = *(float *)v11 + 21.0;
          rgba = 0.1;
          v34 = 1050253722;
          v35 = 1058642330;
          v32 = v14 - 4.0 - 4.0;
          ratio = *v13 * 0.050000001;
          ui_draw_progress_bar(&v31, 32.0, ratio, &rgba);
          v15 = (float *)*((_DWORD *)v3 + 4);
          v31 = *((float *)v3 + 1) + 36.0;
          v16 = *(float *)v11 + 23.0;
          retaddr = v37;
        }
        else
        {
          v15 = (float *)*((_DWORD *)v3 + 3);
          retaddr = v37;
          v31 = *((float *)v3 + 1) + 36.0;
          v16 = *(float *)v11 + 21.0;
        }
        rgba = 0.1;
        v34 = 1050253722;
        v35 = 1058642330;
        v32 = v16 - 4.0;
        ratioa = *v15 * 0.050000001;
        ui_draw_progress_bar(&v31, 32.0, ratioa, &rgba);
        (*(void (__thiscall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216);
        *(float *)v11 = *(float *)v11 + 52.0;
      }
    }
    else
    {
      v6 = 15;
      if ( slot <= 15 )
      {
        v7 = &unk_48F768;
        v8 = slot == 15;
        do
        {
          if ( v8 )
          {
            *v3 = 0;
          }
          else if ( *v7 )
          {
            break;
          }
          --v6;
          v7 -= 32;
          v8 = slot == v6;
        }
        while ( slot <= v6 );
      }
      *xy = *xy + 52.0;
    }
  }
}

// ui_render_hud @ 0x0041AED0
// renders the in-game HUD (health, weapon icons, player UI)
void ui_render_hud()
{
  double v0; // st6
  double v1; // st7
  int v2; // esi
  int v3; // eax
  int v4; // esi
  int v5; // eax
  int v6; // edx
  double v7; // st5
  long double v8; // st7
  double v9; // st6
  double v10; // st7
  int v11; // edx
  int v12; // ebx
  double v13; // st7
  int v14; // eax
  int v15; // eax
  int v16; // eax
  int v17; // esi
  int v18; // eax
  int v19; // edi
  int v20; // ebp
  int v21; // esi
  int v22; // edx
  int v23; // ebx
  int v24; // edx
  float v25; // edi
  int v26; // esi
  int v27; // edx
  int v28; // eax
  int *v29; // ecx
  int v30; // ebx
  double v31; // st7
  int v32; // edx
  int v33; // esi
  int v34; // eax
  int v35; // ecx
  int v36; // edx
  double v37; // st5
  int v38; // esi
  int v39; // esi
  int v40; // ebp
  int v41; // esi
  int v42; // ebp
  int v43; // esi
  int v44; // edx
  int v45; // ecx
  int v46; // edi
  int v47; // esi
  double v48; // st5
  int v49; // esi
  int v50; // edi
  int v51; // ecx
  int v52; // esi
  double v53; // st7
  double v55; // st6
  char v56; // c0
  double v57; // st6
  int v58; // edx
  float v59; // [esp+630h] [ebp-54h]
  float v60; // [esp+630h] [ebp-54h]
  float v61; // [esp+630h] [ebp-54h]
  float v62; // [esp+630h] [ebp-54h]
  float v63; // [esp+630h] [ebp-54h]
  float v64; // [esp+630h] [ebp-54h]
  float v65; // [esp+630h] [ebp-54h]
  int v66; // [esp+634h] [ebp-50h]
  float v67; // [esp+634h] [ebp-50h]
  float v68; // [esp+634h] [ebp-50h]
  int v69; // [esp+634h] [ebp-50h]
  float v70; // [esp+634h] [ebp-50h]
  float v71; // [esp+634h] [ebp-50h]
  float v72; // [esp+634h] [ebp-50h]
  int v73; // [esp+634h] [ebp-50h]
  float v74; // [esp+634h] [ebp-50h]
  int v75; // [esp+634h] [ebp-50h]
  int v76; // [esp+634h] [ebp-50h]
  int v77; // [esp+634h] [ebp-50h]
  int v78; // [esp+634h] [ebp-50h]
  float v79; // [esp+634h] [ebp-50h]
  float v80; // [esp+634h] [ebp-50h]
  int v81; // [esp+634h] [ebp-50h]
  int v82; // [esp+634h] [ebp-50h]
  int v83; // [esp+634h] [ebp-50h]
  float v84; // [esp+634h] [ebp-50h]
  int v85; // [esp+634h] [ebp-50h]
  float v86; // [esp+634h] [ebp-50h]
  float v87; // [esp+634h] [ebp-50h]
  int v88; // [esp+634h] [ebp-50h]
  float v89; // [esp+634h] [ebp-50h]
  float v90; // [esp+634h] [ebp-50h]
  int v91; // [esp+634h] [ebp-50h]
  int ratio; // [esp+638h] [ebp-4Ch]
  float ratioa; // [esp+638h] [ebp-4Ch]
  int ratiob; // [esp+638h] [ebp-4Ch]
  float ratiog; // [esp+638h] [ebp-4Ch]
  char *ratioc; // [esp+638h] [ebp-4Ch]
  int ratioh; // [esp+638h] [ebp-4Ch]
  int ratioi; // [esp+638h] [ebp-4Ch]
  int ratioj; // [esp+638h] [ebp-4Ch]
  int ratiod; // [esp+638h] [ebp-4Ch]
  int ratiok; // [esp+638h] [ebp-4Ch]
  int ratiol; // [esp+638h] [ebp-4Ch]
  char *ratioe; // [esp+638h] [ebp-4Ch]
  int ratiom; // [esp+638h] [ebp-4Ch]
  float ration; // [esp+638h] [ebp-4Ch]
  int ratioo; // [esp+638h] [ebp-4Ch]
  float ratiop; // [esp+638h] [ebp-4Ch]
  float ratioq; // [esp+638h] [ebp-4Ch]
  int ratior; // [esp+638h] [ebp-4Ch]
  int ratios; // [esp+638h] [ebp-4Ch]
  int ratiot; // [esp+638h] [ebp-4Ch]
  int ratiou; // [esp+638h] [ebp-4Ch]
  float ratiov; // [esp+638h] [ebp-4Ch]
  float ratiow; // [esp+638h] [ebp-4Ch]
  int ratiof; // [esp+638h] [ebp-4Ch]
  int ratiox; // [esp+638h] [ebp-4Ch]
  float ratioy; // [esp+638h] [ebp-4Ch]
  int v118; // [esp+63Ch] [ebp-48h]
  float v119; // [esp+63Ch] [ebp-48h]
  float v120; // [esp+63Ch] [ebp-48h]
  int v121; // [esp+63Ch] [ebp-48h]
  float v122; // [esp+63Ch] [ebp-48h]
  float v123; // [esp+63Ch] [ebp-48h]
  int v124; // [esp+63Ch] [ebp-48h]
  int v125; // [esp+63Ch] [ebp-48h]
  int v126; // [esp+63Ch] [ebp-48h]
  int v127; // [esp+63Ch] [ebp-48h]
  int v128; // [esp+63Ch] [ebp-48h]
  int v129; // [esp+63Ch] [ebp-48h]
  int v130; // [esp+63Ch] [ebp-48h]
  int v131; // [esp+63Ch] [ebp-48h]
  int v132; // [esp+63Ch] [ebp-48h]
  float v133; // [esp+63Ch] [ebp-48h]
  float v134; // [esp+63Ch] [ebp-48h]
  float v135; // [esp+63Ch] [ebp-48h]
  int v136; // [esp+63Ch] [ebp-48h]
  float v137; // [esp+63Ch] [ebp-48h]
  int v138; // [esp+63Ch] [ebp-48h]
  int v139; // [esp+63Ch] [ebp-48h]
  float v140; // [esp+63Ch] [ebp-48h]
  int v141; // [esp+63Ch] [ebp-48h]
  float v142; // [esp+63Ch] [ebp-48h]
  float v143; // [esp+63Ch] [ebp-48h]
  int v144; // [esp+63Ch] [ebp-48h]
  int v145; // [esp+640h] [ebp-44h]
  int v146; // [esp+640h] [ebp-44h]
  int v147; // [esp+640h] [ebp-44h]
  float v148; // [esp+640h] [ebp-44h]
  int v149; // [esp+640h] [ebp-44h]
  int v150; // [esp+644h] [ebp-40h]
  int v151; // [esp+644h] [ebp-40h]
  int v152; // [esp+648h] [ebp-3Ch]
  int v153; // [esp+648h] [ebp-3Ch]
  float v154; // [esp+650h] [ebp-34h]
  float v155; // [esp+650h] [ebp-34h]
  float v156; // [esp+654h] [ebp-30h]
  float v157; // [esp+654h] [ebp-30h]
  float v158; // [esp+654h] [ebp-30h]
  float v159; // [esp+654h] [ebp-30h]
  float v160; // [esp+654h] [ebp-30h]
  float v161; // [esp+654h] [ebp-30h]
  float v162; // [esp+654h] [ebp-30h]
  float v163; // [esp+658h] [ebp-2Ch]
  float v164; // [esp+658h] [ebp-2Ch]
  int v165; // [esp+658h] [ebp-2Ch]
  int v166; // [esp+658h] [ebp-2Ch]
  float v167; // [esp+658h] [ebp-2Ch]
  float v168; // [esp+658h] [ebp-2Ch]
  int v169; // [esp+658h] [ebp-2Ch]
  float v170; // [esp+65Ch] [ebp-28h]
  __int64 rgba; // [esp+660h] [ebp-24h] BYREF
  int v172; // [esp+668h] [ebp-1Ch]
  float v173; // [esp+66Ch] [ebp-18h]
  int v174; // [esp+670h] [ebp-14h] BYREF
  float v175; // [esp+674h] [ebp-10h]
  float v176; // [esp+678h] [ebp-Ch] BYREF
  int xy; // [esp+67Ch] [ebp-8h] BYREF
  float v178; // [esp+680h] [ebp-4h]
  float v179; // [esp+688h] [ebp+4h]
  float v180; // [esp+68Ch] [ebp+8h]

  if ( *(float *)(cv_uiTransparency + 12) >= 0.0 && *(float *)(cv_uiTransparency + 12) <= 1.0 )
    v179 = v179 * *(float *)(cv_uiTransparency + 12);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 21, 1);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  v1 = v179 * 0.69999999;
  v170 = v1;
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v170)));
  v2 = *(_DWORD *)grim_interface_ptr;
  v3 = (*(int (__thiscall **)(int, char *, _DWORD))(*(_DWORD *)grim_interface_ptr + 192))(
         grim_interface_ptr,
         aIgameui,
         0);
  (*(void (__thiscall **)(int, int))(v2 + 196))(grim_interface_ptr, v3);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    989855744,
    1015021568,
    1065320448,
    1065091072);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    0,
    0,
    1140850688,
    1115684864);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  if ( byte_4871B0 )
  {
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      2,
      v66,
      ratio,
      v118);
    *(float *)&v174 = 27.0;
    if ( config_player_count == 1 )
    {
      v175 = 21.0;
      *(float *)&xy = 27.0;
      v178 = 21.0;
    }
    else
    {
      v175 = 12.0;
      *(float *)&xy = 27.0;
      v178 = 12.0;
    }
    v119 = v179 * 0.80000001;
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v119));
    v4 = *(_DWORD *)grim_interface_ptr;
    v5 = (*(int (__thiscall **)(int, char *, _DWORD))(*(_DWORD *)grim_interface_ptr + 192))(
           grim_interface_ptr,
           aIheart,
           0);
    (*(void (__thiscall **)(int, int))(v4 + 196))(grim_interface_ptr, v5);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      1023410176,
      1023410176,
      1064828928,
      1064828928);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v163 = 2.0;
    if ( config_player_count == 1 )
    {
      if ( *(float *)player_health < 30.0 )
        v163 = 5.0;
      v1 = sin(flt_47EA4C * v163);
      *(float *)&v174 = v1;
      crt_ci_pow();
      v0 = 4.0 * 4.0 + 14.0;
      v6 = *(_DWORD *)grim_interface_ptr;
      v156 = v0 + v0;
      v120 = v156;
      ratioa = v156;
      v7 = v178 - v0;
    }
    else
    {
      if ( *(float *)player_health < 30.0 )
        v163 = 5.0;
      v8 = sin(flt_47EA4C * v163);
      *(float *)&v174 = v8;
      crt_ci_pow();
      v9 = (4.0 * 4.0 + 14.0) * 0.5;
      v157 = v9 + v9;
      v67 = v178 - v9;
      v59 = *(float *)&xy - v9;
      (*(void (__userpurge **)(_DWORD, _DWORD, _DWORD, _DWORD, double@<st0>))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v59),
        LODWORD(v67),
        LODWORD(v157),
        LODWORD(v157),
        v8);
      if ( player2_health[0] >= 30.0 )
        v10 = v163;
      else
        v10 = 5.0;
      *(float *)&v174 = sin(flt_47EA4C * v10 + 1.5707964);
      v1 = *(float *)&v174;
      crt_ci_pow();
      v6 = *(_DWORD *)grim_interface_ptr;
      v0 = (4.0 * 4.0 + 14.0) * 0.5;
      v158 = v0 + v0;
      v120 = v158;
      ratioa = v158;
      v7 = v178 - v0 + 15.0;
    }
    v68 = v7;
    v60 = *(float *)&xy - v0;
    (*(void (__userpurge **)(_DWORD, _DWORD, float, float, double@<st0>))(v6 + 284))(
      LODWORD(v60),
      LODWORD(v68),
      COERCE_FLOAT(LODWORD(ratioa)),
      COERCE_FLOAT(LODWORD(v120)),
      v1);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  }
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v66,
    ratio,
    v118);
  if ( byte_4871B1 )
  {
    v1 = v179 * 0.80000001;
    v122 = v1;
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v122));
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      ui_weapon_icons_texture,
      0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v11 = *(_DWORD *)grim_interface_ptr;
    if ( config_player_count == 1 )
    {
      (*(void (__stdcall **)(int, int, int, int, int, int, int))(v11 + 264))(
        8,
        2,
        1,
        2 * effect_subrect_frame_table[31 * player_weapon_id[0]],
        v145,
        v150,
        v152);
      v153 = 1107296256;
      v151 = 1115684864;
      v146 = 0x40000000;
    }
    else
    {
      (*(void (__stdcall **)(int, int, int, int, int, int, int))(v11 + 264))(
        8,
        2,
        1,
        2 * effect_subrect_frame_table[31 * player_weapon_id[0]],
        v145,
        v150,
        v152);
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
        grim_interface_ptr,
        1130102784,
        1082130432,
        1107296256,
        1098907648);
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 264))(
        grim_interface_ptr,
        8,
        2,
        1,
        2 * effect_subrect_frame_table[31 * player2_weapon_id]);
      v153 = 1098907648;
      v151 = 1107296256;
      v146 = 1101004800;
    }
    (*(void (__stdcall **)(int))(*(_DWORD *)grim_interface_ptr + 284))(1130102784);
    (*(void (__thiscall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 240))(
      grim_interface_ptr,
      v146,
      v151,
      v153);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
  }
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v69,
    ratiob,
    v121);
  if ( byte_4871B0 )
  {
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_48F7C0,
      0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    *(float *)&xy = 64.0;
    if ( config_player_count == 1 )
      v178 = 16.0;
    else
      v178 = 6.0;
    render_overlay_player_index = 0;
    if ( config_player_count > 0 )
    {
      *(float *)&rgba = v179 * 0.5;
      *(float *)&v174 = v179 * 0.80000001;
      v12 = v174;
      do
      {
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          rgba);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          0,
          0,
          1065353216,
          1065353216);
        v174 = 16 * render_overlay_player_index;
        v70 = (double)(16 * render_overlay_player_index) + v178;
        (*(void (__stdcall **)(int, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          1115684864,
          LODWORD(v70),
          1123024896,
          1091567616);
        v13 = *(float *)&player_health[216 * render_overlay_player_index] * 0.0099999998;
        v164 = v13;
        if ( v13 <= 1.0 )
        {
          if ( v164 < 0.0 )
            v164 = 0.0;
        }
        else
        {
          v164 = 1.0;
        }
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          v12);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, float, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          0,
          0,
          COERCE_FLOAT(LODWORD(v164)),
          1065353216);
        v174 = 16 * render_overlay_player_index;
        ratiog = v164 * 120.0;
        v1 = (double)(16 * render_overlay_player_index) + v178;
        v71 = v1;
        (*(void (__stdcall **)(int, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 284))(
          1115684864,
          LODWORD(v71),
          LODWORD(ratiog),
          1091567616);
        ++render_overlay_player_index;
      }
      while ( render_overlay_player_index < config_player_count );
    }
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  }
  if ( byte_4871B1 )
  {
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    if ( config_player_count == 1 )
    {
      *(float *)&v174 = 300.0;
      v175 = 10.0;
      *(float *)&v14 = 10.0;
      *(float *)&xy = 300.0;
    }
    else
    {
      *(float *)&v174 = 290.0;
      v175 = 4.0;
      *(float *)&v14 = 4.0;
      *(float *)&xy = 290.0;
    }
    v178 = *(float *)&v14;
    v15 = 0;
    for ( render_overlay_player_index = 0; render_overlay_player_index < config_player_count; ++render_overlay_player_index )
    {
      v16 = weapon_ammo_class[31 * player_weapon_id[216 * v15]];
      if ( v16 == 1 )
      {
        ratioc = aUiUiIndfireJaz;
        v17 = *(_DWORD *)grim_interface_ptr;
      }
      else if ( v16 )
      {
        if ( v16 == 2 )
          ratioc = aUiUiIndrocketJ;
        else
          ratioc = aUiUiIndelectri;
        v17 = *(_DWORD *)grim_interface_ptr;
      }
      else
      {
        ratioc = aUiUiIndbulletJ;
        v17 = *(_DWORD *)grim_interface_ptr;
      }
      v18 = (*(int (__stdcall **)(char *, _DWORD))(v17 + 192))(ratioc, 0);
      (*(void (__thiscall **)(int, int))(v17 + 196))(grim_interface_ptr, v18);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v19 = (__int64)*(float *)&player_clip_size[216 * render_overlay_player_index];
      if ( v19 > 30 )
        v19 = 20;
      v1 = *(float *)&player_ammo[216 * render_overlay_player_index];
      v20 = (__int64)v1;
      (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
        grim_interface_ptr,
        0,
        0,
        1065353216,
        1065353216);
      v21 = 0;
      if ( v19 > 0 )
      {
        v165 = 0;
        do
        {
          if ( v21 >= v20 )
            v123 = v179 * 0.30000001;
          else
            v123 = v179;
          (*(void (__stdcall **)(int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
            1065353216,
            1065353216,
            1065353216,
            COERCE_FLOAT(LODWORD(v123)));
          v22 = *(_DWORD *)grim_interface_ptr;
          v174 = 14 * render_overlay_player_index;
          v72 = (double)(14 * render_overlay_player_index) + v178;
          v1 = (double)v165 + *(float *)&xy;
          v61 = v1;
          (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v22 + 284))(
            LODWORD(v61),
            LODWORD(v72),
            1086324736,
            1098907648);
          ++v21;
          v165 += 6;
        }
        while ( v21 < v19 );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      if ( v20 > v19 )
      {
        (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v170)));
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          24,
          1056964608,
          v73,
          ratioh,
          v124);
        v174 = 6 * v21;
        v74 = (double)(14 * render_overlay_player_index) + v178 + 1.0;
        v1 = (double)(6 * v21) + *(float *)&xy + 8.0;
        v62 = v1;
        (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          LODWORD(v62),
          LODWORD(v74),
          aD,
          v20 - v19);
      }
      v15 = render_overlay_player_index + 1;
    }
  }
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v170)));
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v75,
    ratioi,
    v125);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v76,
    ratioj,
    v126);
  v23 = 78;
  v166 = 78;
  if ( !byte_4871B3 )
    goto LABEL_97;
  (*(void (__usercall **)(int@<ecx>, int, int, int, int, int, double@<st0>, double@<st1>))(*(_DWORD *)grim_interface_ptr
                                                                                         + 32))(
    grim_interface_ptr,
    21,
    1,
    v77,
    ratiod,
    v127,
    v1,
    v0);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7C4, 0);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v170)));
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v167 = 0.0;
  if ( quest_spawn_timeline < 1000 )
  {
    v174 = 1000 - quest_spawn_timeline;
    v167 = (double)(1000 - quest_spawn_timeline) * -0.12800001;
  }
  v63 = v167 - 90.0;
  (*(void (__stdcall **)(_DWORD, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v63),
    1116078080,
    1127612416,
    1112801280,
    v145);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    -1029701632,
    1121320960,
    1127612416,
    1112801280);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  v168 = v180 * 0.89999998;
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(v168));
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    ui_clock_table_texture,
    0);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v24 = *(_DWORD *)grim_interface_ptr;
  v175 = v170 + 2.0;
  v25 = v175;
  (*(void (__thiscall **)(int, float, int, int, int))(v24 + 284))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v175)),
    1117519872,
    1107296256,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    ratiok,
    v128,
    v147);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(v168));
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7CC, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v26 = *(_DWORD *)grim_interface_ptr;
  LODWORD(v175) = quest_spawn_timeline / 1000;
  v148 = (double)(quest_spawn_timeline / 1000) * 0.10471976;
  (*(void (__stdcall **)(_DWORD))(v26 + 252))(LODWORD(v148));
  (*(void (__thiscall **)(int, float, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v25)),
    1117519872,
    1107296256,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    ratiol,
    v129,
    v149);
  if ( quest_spawn_timeline / 1000 % 60 >= 10 )
    ratioe = aDD_0;
  else
    ratioe = aD0D;
  v64 = v170 + 32.0;
  (*(void (__cdecl **)(int, _DWORD, int, char *, int, int))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v64),
    1118568448,
    ratioe,
    quest_spawn_timeline / 1000 / 60,
    quest_spawn_timeline / 1000 % 60);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1055286886,
    ratiom,
    v130);
  (*(void (__cdecl **)(int, int, int, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    1099956224,
    1123287040,
    aProgress);
  if ( (byte_48F528 & 1) == 0 )
  {
    ::rgba = 0.2;
    byte_48F528 |= 1u;
    dword_4871A4 = 1061997773;
    dword_4871A8 = 1050253722;
    dword_4871AC = 1065353216;
    crt_atexit(nullsub_41);
  }
  v27 = quest_spawn_count;
  v28 = 0;
  dword_4902FC = 0;
  *(float *)&dword_4871AC = v179 * 0.80000001;
  if ( quest_spawn_count > 0 )
  {
    v29 = (int *)&unk_4857BC;
    do
    {
      v30 = *v29;
      v29 += 6;
      v28 += v30;
      --v27;
    }
    while ( v27 );
  }
  v174 = v28 + creature_spawned_count;
  *(float *)&xy = 10.0;
  v178 = 139.0;
  ::ratio = (double)creature_kill_count / (double)(v28 + creature_spawned_count);
  ui_draw_progress_bar((float *)&xy, 70.0, ::ratio, &::rgba);
  v23 = 158;
  v166 = 158;
  if ( dword_487244 < 500 )
  {
    v174 = 2 * dword_487244;
    v31 = (double)(2 * dword_487244) * 0.001;
    goto LABEL_73;
  }
  if ( dword_487244 < 1500 )
  {
LABEL_74:
    v154 = 1.0;
    goto LABEL_75;
  }
  if ( dword_487244 < 2000 )
  {
    v174 = 2 * dword_487244 - 3000;
    v31 = 1.0 - (double)v174 * 0.001;
LABEL_73:
    v154 = v31;
    if ( v154 <= 1.0 )
      goto LABEL_75;
    goto LABEL_74;
  }
  v154 = 0.0;
LABEL_75:
  v1 = v154 * v179;
  v32 = *(_DWORD *)grim_interface_ptr;
  *(float *)&rgba = v1;
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(v32 + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    rgba);
  if ( v154 >= 0.0 )
  {
    v159 = 0.80000001;
    *(float *)&xy = COERCE_FLOAT(strlen((const char *)quest_meta_name[110 * *(_DWORD *)quest_stage_major
                                                                    - 121
                                                                    + 11 * quest_stage_minor]));
    if ( *(int *)config_screen_width <= 640 )
      v159 = 0.75;
    (*(void (__usercall **)(int@<ecx>, int, float, int, int, int, double@<st0>, double@<st1>))(*(_DWORD *)grim_interface_ptr
                                                                                             + 32))(
      grim_interface_ptr,
      24,
      COERCE_FLOAT(LODWORD(v159)),
      v77,
      ratiod,
      v127,
      v1,
      v0);
    v174 = *(_DWORD *)config_screen_width / 2;
    v33 = *(_DWORD *)grim_interface_ptr;
    v131 = quest_meta_name[110 * *(_DWORD *)quest_stage_major - 121 + 11 * quest_stage_minor];
    *(float *)&v174 = (double)(*(_DWORD *)config_screen_width / 2) - (double)xy * v159 * 8.0;
    xy = config_screen_height / 2 - 32;
    ration = (float)xy;
    (*(void (__stdcall **)(int, _DWORD, int))(v33 + 316))(v174, LODWORD(ration), v131);
    v160 = v159 - 0.2;
    (*(void (__thiscall **)(int, int, float, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      COERCE_FLOAT(LODWORD(v160)),
      v78,
      ratioo,
      v132);
    v133 = *(float *)&rgba * 0.5;
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v133));
    v34 = quest_stage_minor;
    if ( quest_stage_minor > 10 )
    {
      v34 = quest_stage_minor - 10;
      ++*(_DWORD *)quest_stage_major;
      quest_stage_minor -= 10;
    }
    crt_sprintf(byte_48F788, "%d.%d", *(_DWORD *)quest_stage_major, v34);
    v35 = *(_DWORD *)grim_interface_ptr;
    xy = config_screen_height / 2 - 32;
    v36 = v35;
    ratiop = (double)xy + v160 * 23.360001 - v160 * 16.0;
    rgba = strlen(byte_48F788);
    v0 = v160 * 32.0;
    v1 = *(float *)&v174 - (double)rgba * v160 * 8.0 - v0 - 4.0;
    v79 = v1;
    (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(v36 + 320))(
      grim_interface_ptr,
      LODWORD(v79),
      LODWORD(ratiop),
      byte_48F788);
  }
  if ( dword_487088 > 0 )
  {
    if ( dword_487088 >= 500 )
    {
      if ( dword_487088 < 1500 )
      {
        v155 = 1.0;
LABEL_96:
        (*(void (__usercall **)(int@<ecx>, int, int, int, int, int, double@<st0>, double@<st1>))(*(_DWORD *)grim_interface_ptr
                                                                                               + 32))(
          grim_interface_ptr,
          24,
          1065353216,
          v77,
          ratiod,
          v127,
          v1,
          v0);
        v161 = (double)dword_487088 * 0.00039999999 * 0.13 + 0.95;
        v134 = v155 * v179;
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v134));
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
          grim_interface_ptr,
          dword_48F7A0,
          0);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          0,
          0,
          1065353216,
          1065353216);
        v38 = *(_DWORD *)grim_interface_ptr;
        v135 = v161 * 32.0;
        ratioq = v161 * 256.0;
        v80 = (double)(config_screen_height / 2) - v161 * 16.0;
        xy = *(_DWORD *)config_screen_width / 2;
        v0 = v161 * 128.0;
        v1 = (double)(*(_DWORD *)config_screen_width / 2) - v0;
        v65 = v1;
        (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(v38 + 284))(
          LODWORD(v65),
          LODWORD(v80),
          LODWORD(ratioq),
          LODWORD(v135));
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
        goto LABEL_97;
      }
      if ( dword_487088 >= 2500 )
      {
LABEL_95:
        v155 = 0.0;
        goto LABEL_96;
      }
      xy = 2000 - dword_487088;
      v37 = (double)(2000 - dword_487088) * 0.0020000001 + 1.0;
    }
    else
    {
      v37 = (double)dword_487088 * 0.0020000001;
    }
    v155 = v37;
    if ( v155 > 1.0 )
    {
      v155 = 1.0;
      goto LABEL_96;
    }
    if ( v155 >= 0.0 )
      goto LABEL_96;
    goto LABEL_95;
  }
LABEL_97:
  if ( byte_4871B4 )
  {
    (*(void (__usercall **)(int@<ecx>, int, int, int, int, int, double@<st0>, double@<st1>))(*(_DWORD *)grim_interface_ptr
                                                                                           + 32))(
      grim_interface_ptr,
      21,
      1,
      v77,
      ratiod,
      v127,
      v1,
      v0);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    v162 = v179 * 0.89999998;
    (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v162));
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      ui_clock_table_texture,
      0);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
      grim_interface_ptr,
      1130102784,
      0x40000000,
      1107296256,
      1107296256);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      2,
      v81,
      ratior,
      v136);
    (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v162));
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_48F7CC,
      0);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v39 = *(_DWORD *)grim_interface_ptr;
    xy = survival_elapsed_ms / 1000;
    v1 = (double)(survival_elapsed_ms / 1000) * 0.10471976;
    v137 = v1;
    (*(void (__stdcall **)(_DWORD))(v39 + 252))(LODWORD(v137));
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
      grim_interface_ptr,
      1130102784,
      0x40000000,
      1107296256,
      1107296256);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1056964608,
      v82,
      ratios,
      v138);
    (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v170)));
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1056964608,
      v83,
      ratiot,
      v139);
    (*(void (**)(int, int, int, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      1132396544,
      1092616192,
      aDSeconds,
      survival_elapsed_ms / 1000);
  }
  if ( byte_4871B2 )
  {
    (*(void (__usercall **)(int@<ecx>, int, _DWORD, double@<st0>, double@<st1>))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_48F7C4,
      0,
      v1,
      v0);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v170)));
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    xy = v23 - 18;
    v84 = (float)(v23 - 18);
    (*(void (__stdcall **)(int, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
      -1031274496,
      LODWORD(v84),
      1127612416,
      1112801280);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    if ( player_experience[0] )
    {
      if ( survival_xp_smoothed >= player_experience[0] )
      {
        if ( survival_xp_smoothed <= player_experience[0] )
          goto LABEL_116;
        v42 = frame_dt_ms / 2;
        if ( frame_dt_ms / 2 <= 0 )
          v42 = 1;
        v43 = abs32(survival_xp_smoothed - player_experience[0]);
        if ( v43 > 1000 )
          v42 *= v43 / 100;
        survival_xp_smoothed -= v42;
        if ( survival_xp_smoothed >= player_experience[0] )
          goto LABEL_116;
      }
      else
      {
        v40 = frame_dt_ms / 2;
        if ( frame_dt_ms / 2 <= 0 )
          v40 = 1;
        v41 = abs32(survival_xp_smoothed - player_experience[0]);
        if ( v41 > 1000 )
          v40 *= v41 / 100;
        survival_xp_smoothed += v40;
        if ( survival_xp_smoothed <= player_experience[0] )
          goto LABEL_116;
      }
      survival_xp_smoothed = player_experience[0];
    }
    else
    {
      survival_xp_smoothed = 0;
    }
LABEL_116:
    v140 = v179 * 0.89999998;
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v140));
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1056964608,
      v85,
      ratiou,
      v141);
    ratiov = (float)v166;
    (*(void (__cdecl **)(int, int, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      1082130432,
      LODWORD(ratiov),
      aXp);
    v44 = *(_DWORD *)grim_interface_ptr;
    xy = v23 - 4;
    v86 = (float)(v23 - 4);
    (*(void (**)(int, int, _DWORD, char *, ...))(v44 + 328))(
      grim_interface_ptr,
      1104150528,
      LODWORD(v86),
      aD_0,
      survival_xp_smoothed);
    flt_496604 = v179;
    (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4965F8);
    v45 = *(_DWORD *)grim_interface_ptr;
    xy = v23 + 1;
    v87 = (float)(v23 + 1);
    (*(void (**)(int, int, _DWORD, char *, ...))(v45 + 328))(
      grim_interface_ptr,
      1118437376,
      LODWORD(v87),
      aD_0,
      player_level[0]);
    v46 = player_level[0];
    flt_496604 = 0.69999999;
    xy = player_level[0] - 1;
    v1 = (double)(player_level[0] - 1);
    crt_ci_pow();
    v47 = 1000 - (__int64)(1.799999952316284 * -1000.0);
    if ( v46 == 1 )
      v47 = 0;
    v173 = v170;
    rgba = 0x3E99999A3DCCCCCDLL;
    v175 = (float)(v23 + 13);
    xy = player_experience[0] - v47;
    v0 = (double)(player_experience[0] - v47);
    v48 = (double)player_level[0];
    v172 = 1058642330;
    *(float *)&v174 = 26.0;
    crt_ci_pow();
    xy = 1000 - (__int64)(1.799999952316284 * -1000.0) - v47;
    ratiow = v48 / (double)xy;
    ui_draw_progress_bar((float *)&v174, 54.0, ratiow, (float *)&rgba);
    v166 = v23 + 43;
  }
  (*(void (__usercall **)(int@<ecx>, int, int, int, int, int, double@<st0>, double@<st1>))(*(_DWORD *)grim_interface_ptr
                                                                                         + 32))(
    grim_interface_ptr,
    21,
    1,
    v77,
    ratiod,
    v127,
    v1,
    v0);
  v49 = 0;
  v176 = (float)v166;
  do
  {
    v142 = v179;
    bonus_hud_slot_update_and_render(&v176, v49++);
  }
  while ( v49 < 16 );
  v50 = (__int64)v176 + 1;
  v51 = 0;
  v169 = v50;
  render_overlay_player_index = 0;
  if ( config_player_count > 0 )
  {
    v52 = (__int64)v176 - 5;
    LODWORD(rgba) = v52;
    do
    {
      if ( *(float *)&dword_4871D0[v51] > 0.0 )
      {
        v53 = *(float *)&dword_4871D0[v51];
        v55 = frame_dt;
        if ( v56 )
          v57 = v55 * 0.5;
        else
          v57 = v55 * 1.4;
        *(float *)&dword_4871D0[v51] = *(float *)&dword_4871D0[v51] - v57;
        if ( v53 > 1.0 )
          v53 = 2.0 - v53;
        if ( v53 < 0.0 )
          v53 = 0.0;
        v58 = *(_DWORD *)grim_interface_ptr;
        *(float *)&v174 = v53 * v179;
        v143 = *(float *)&v174 * 0.80000001;
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(v58 + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v143));
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
          grim_interface_ptr,
          dword_48F7C4,
          0);
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
          grim_interface_ptr,
          0,
          0,
          1065353216,
          1065353216);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
        xy = v52 - 12;
        v89 = (float)(v52 - 12);
        (*(void (__stdcall **)(int, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          -1052770304,
          LODWORD(v89),
          1127612416,
          1112801280);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
          grim_interface_ptr,
          ui_weapon_icons_texture,
          0);
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 264))(
          grim_interface_ptr,
          8,
          2,
          1,
          2 * effect_subrect_frame_table[31 * player_weapon_id[216 * render_overlay_player_index]]);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
        v90 = (float)(int)rgba;
        (*(void (__stdcall **)(int, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          1121058816,
          LODWORD(v90),
          1114636288,
          1106247680);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          24,
          1056964608,
          v91,
          ratiox,
          v144);
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          v174);
        ratioy = (float)v169;
        (*(void (__stdcall **)(int, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 324))(
          1090519040,
          LODWORD(ratioy),
          124 * player_weapon_id[216 * render_overlay_player_index] + 5077548);
        v51 = render_overlay_player_index;
        v50 += 32;
        v52 += 32;
        v169 = v50;
        LODWORD(rgba) = v52;
      }
      render_overlay_player_index = ++v51;
    }
    while ( v51 < config_player_count );
  }
  (*(void (__thiscall **)(int, int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v88,
    ratiof,
    COERCE_FLOAT(LODWORD(v142)));
  render_overlay_player_index = 0;
}

// nullsub_41 @ 0x0041CA80
void __cdecl nullsub_41()
{
  ;
}

// hud_update_and_render @ 0x0041CA90
// updates HUD flags/targets and renders the HUD
void hud_update_and_render()
{
  double v0; // st7
  double v1; // st7
  double v2; // st6
  float ratio; // [esp+Ch] [ebp-28h]
  float v4; // [esp+10h] [ebp-24h]
  float xy[3]; // [esp+14h] [ebp-20h] BYREF
  float v6; // [esp+20h] [ebp-14h]
  float rgba[4]; // [esp+24h] [ebp-10h] BYREF

  v0 = (double)ui_elements_timeline / (double)(dword_48EB48 - dword_48EB4C);
  if ( v0 > 1.0 || (v4 = v0, v4 == 1.0) )
    byte_487241 = 0;
  if ( dword_487268 != -1 )
  {
    v1 = *(float *)&camera_offset_x + *(&creature_pos_x + 38 * dword_487268);
    v6 = *(float *)&camera_offset_y + creature_pos_y[38 * dword_487268];
    v2 = *(float *)&creature_health[38 * dword_487268] / creature_max_health[38 * dword_487268];
    ratio = v2;
    if ( v2 <= 1.0 )
    {
      if ( ratio < 0.0 )
        ratio = 0.0;
    }
    else
    {
      ratio = 1.0;
    }
    rgba[2] = 0.2;
    rgba[3] = 0.69999999;
    rgba[0] = (1.0 - ratio) * 0.89999998 + 0.1;
    rgba[1] = ratio * 0.89999998 + 0.1;
    xy[0] = v1 - 32.0;
    xy[1] = v6 + 32.0;
    ui_draw_progress_bar(xy, 64.0, ratio, rgba);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
  }
  if ( config_game_mode == 3 )
  {
    byte_4871B0 = 1;
    byte_4871B1 = 1;
    byte_4871B2 = 1;
    byte_4871B3 = 1;
  }
  else
  {
    switch ( config_game_mode )
    {
      case 1:
        byte_4871B0 = 1;
        byte_4871B1 = 1;
        byte_4871B2 = 1;
        break;
      case 2:
        byte_4871B0 = 1;
        byte_4871B1 = 0;
        byte_4871B2 = 0;
        byte_4871B3 = 0;
        byte_4871B4 = 1;
        goto LABEL_21;
      case 4:
        byte_4871B0 = 1;
        byte_4871B1 = 0;
        byte_4871B2 = 1;
        byte_4871B3 = 0;
        byte_4871B4 = 1;
        goto LABEL_21;
      default:
        byte_4871B0 = 0;
        byte_4871B1 = 0;
        byte_4871B2 = 0;
        break;
    }
    byte_4871B3 = 0;
  }
  byte_4871B4 = 0;
LABEL_21:
  if ( !demo_mode_active )
    ui_render_hud();
}

// dx_get_version @ 0x0041CCB0
// query DirectX version
int dx_get_version(int *version, char *out, int out_len)
{
  int *v3; // ebx
  char *v4; // esi
  int v5; // ebp
  char v7; // al
  int v8; // edx
  int v9; // edi
  int v10; // ecx
  int arg2; // [esp+10h] [ebp-4h] BYREF

  v3 = version;
  if ( version )
    *version = 0;
  v4 = out;
  v5 = out_len;
  if ( out && out_len > 0 )
    *out = 0;
  out_len = 0;
  arg2 = 0;
  LOBYTE(out) = 32;
  if ( sub_41CDB0((int)v4, &out_len, (int)&arg2, (LONG *)&out) < 0 && FUN_0041cfe0(&out_len, &arg2, (char *)&out) < 0 )
    return -2147467259;
  v7 = crt_tolower((char)out);
  v8 = out_len;
  v9 = arg2;
  LOBYTE(out) = v7;
  if ( version )
  {
    v10 = (arg2 + (out_len << 8)) << 8;
    if ( v7 >= 97 && v7 <= 122 )
    {
      v10 = v10 + v7 - 96;
      v3 = version;
    }
    *v3 = v10;
  }
  if ( v4 && v5 > 0 )
  {
    if ( v7 == 32 )
    {
      crt_snprintf(v4, v5, "%d.%d", v8, v9);
      v4[v5 - 1] = 0;
      return 0;
    }
    crt_snprintf(v4, v5, "%d.%d%c", v8, v9, v7);
    v4[v5 - 1] = 0;
  }
  return 0;
}

// sub_41CDB0 @ 0x0041CDB0
int __usercall sub_41CDB0@<eax>(int a1@<esi>, LONG *a2, int a3, LONG *a4)
{
  bool v5; // [esp+43h] [ebp-39h]
  int v6; // [esp+44h] [ebp-38h] BYREF
  LPVOID ppv; // [esp+48h] [ebp-34h] BYREF
  int v8; // [esp+4Ch] [ebp-30h] BYREF
  CHAR MultiByteStr[12]; // [esp+50h] [ebp-2Ch] BYREF
  VARIANTARG pvarg; // [esp+5Ch] [ebp-20h] BYREF
  _DWORD v11[4]; // [esp+6Ch] [ebp-10h] BYREF

  ppv = 0;
  v5 = CoInitialize(0) >= 0;
  if ( CoCreateInstance(&rclsid, 0, 1u, &riid, &ppv) >= 0 )
  {
    v11[0] = 16;
    v11[1] = 111;
    v11[2] = 0;
    v11[3] = 0;
    if ( (*(int (__stdcall **)(LPVOID, _DWORD *))(*(_DWORD *)ppv + 12))(ppv, v11) < 0
      || (v8 = 0, v6 = 0, (*(int (__stdcall **)(LPVOID, int *))(*(_DWORD *)ppv + 16))(ppv, &v8) < 0) )
    {
      (*(void (__stdcall **)(LPVOID))(*(_DWORD *)ppv + 8))(ppv);
    }
    else if ( (*(int (__stdcall **)(int, wchar_t *, int *))(*(_DWORD *)v8 + 20))(v8, aDxdiagSystemin, &v6) < 0 )
    {
      (*(void (__stdcall **)(int))(*(_DWORD *)v8 + 8))(v8);
      (*(void (__stdcall **)(LPVOID))(*(_DWORD *)ppv + 8))(ppv);
    }
    else
    {
      VariantInit(&pvarg);
      if ( (*(int (__stdcall **)(int, wchar_t *, VARIANTARG *))(*(_DWORD *)v6 + 32))(v6, aDwdirectxversi, &pvarg) >= 0
        && pvarg.vt == 19
        && a2 )
      {
        *a2 = pvarg.lVal;
      }
      VariantClear(&pvarg);
      if ( (*(int (__stdcall **)(int, wchar_t *, VARIANTARG *, int))(*(_DWORD *)v6 + 32))(
             v6,
             aDwdirectxversi_0,
             &pvarg,
             a1) >= 0
        && pvarg.wReserved2 == 19 )
      {
        if ( a4 )
          *a4 = pvarg.cyVal.Hi;
        BYTE1(v6) = 1;
      }
      VariantClear((VARIANTARG *)&pvarg.decVal.Hi32);
      if ( (*(int (__stdcall **)(LPVOID, wchar_t *))(*(_DWORD *)ppv + 32))(ppv, aSzdirectxversi) >= 0 && pvarg.vt == 8 )
      {
        if ( pvarg.lVal )
        {
          WideCharToMultiByte(0, 0, pvarg.bstrVal, -1, MultiByteStr, 10, 0, 0);
          if ( a4 )
            *(_BYTE *)a4 = MultiByteStr[0];
        }
      }
      VariantClear(&pvarg);
      (*(void (__stdcall **)(int))(*(_DWORD *)v6 + 8))(v6);
      (*(void (__stdcall **)(int))(*(_DWORD *)v8 + 8))(v8);
      (*(void (__stdcall **)(LPVOID))(*(_DWORD *)ppv + 8))(ppv);
    }
  }
  if ( v5 )
    CoUninitialize();
  return -2147467259;
}

// FUN_0041cfe0 @ 0x0041CFE0
// [binja] int32_t sub_41cfe0(int32_t* arg1, int32_t* arg2, char* arg3)
int FUN_0041cfe0(int *arg1, int *arg2, char *arg3)
{
  int v3; // ebx
  unsigned int v4; // eax
  unsigned int v5; // edx
  int *v6; // esi
  char *v7; // edi
  unsigned int v8; // eax
  unsigned int v9; // edx
  unsigned int v10; // eax
  unsigned int v11; // edx
  unsigned int v12; // eax
  unsigned int v13; // edx
  unsigned int v14; // eax
  unsigned int v15; // edx
  int *v16; // esi
  char *v17; // edi
  unsigned int v18; // eax
  unsigned int v19; // edx
  unsigned int v20; // eax
  unsigned int v21; // edx
  unsigned int v22; // eax
  unsigned int v23; // edx
  unsigned int v24; // eax
  unsigned int v25; // edx
  unsigned int v26; // eax
  unsigned int v27; // edx
  unsigned int v28; // eax
  unsigned int v29; // eax
  unsigned int v30; // edx
  unsigned int v31; // eax
  unsigned int v32; // edx
  unsigned int v33; // eax
  unsigned int v34; // eax
  unsigned int v35; // edx
  unsigned int v36; // eax
  unsigned int v37; // edx
  int *v38; // esi
  char *v39; // edi
  unsigned int v40; // eax
  unsigned int v41; // edx
  unsigned int v42; // eax
  unsigned int v43; // edx
  unsigned int v44; // eax
  unsigned int v45; // edx
  unsigned int v46; // eax
  unsigned int v47; // eax
  unsigned int v48; // edx
  unsigned int v49; // eax
  unsigned int v50; // edx
  int v52; // [esp+8h] [ebp-408h] BYREF
  unsigned int v53; // [esp+Ch] [ebp-404h]
  CHAR tstrFilename[512]; // [esp+10h] [ebp-400h] BYREF
  CHAR Buffer[512]; // [esp+210h] [ebp-200h] BYREF

  v3 = 0;
  if ( !GetSystemDirectoryA(Buffer, 0x104u) )
    goto LABEL_160;
  Buffer[259] = 0;
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aDdrawDll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v4 = sub_41DC10(4, 2, 0, 0x5Fu);
    if ( sub_41DC50(v52, v53, v4, v5) < 0 )
    {
      v7 = arg3;
      v6 = arg2;
    }
    else
    {
      if ( arg1 )
        *arg1 = 1;
      v6 = arg2;
      if ( arg2 )
        *arg2 = 0;
      v7 = arg3;
      if ( arg3 )
        *arg3 = 32;
      v3 = 1;
    }
    v8 = sub_41DC10(4, 3, 0, 0x448u);
    if ( sub_41DC50(v52, v53, v8, v9) >= 0 )
    {
      if ( arg1 )
        *arg1 = 2;
      if ( v6 )
        *v6 = 0;
      if ( v7 )
        *v7 = 32;
      v3 = 1;
    }
    v10 = sub_41DC10(4, 4, 0, 0x44u);
    if ( sub_41DC50(v52, v53, v10, v11) >= 0 )
    {
      if ( arg1 )
        *arg1 = 3;
      if ( v6 )
        *v6 = 0;
      if ( v7 )
        *v7 = 32;
      v3 = 1;
    }
  }
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aD3drg8xDll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v12 = sub_41DC10(4, 4, 0, 0x46u);
    if ( sub_41DC50(v52, v53, v12, v13) >= 0 )
    {
      if ( arg1 )
        *arg1 = 3;
      if ( arg2 )
        *arg2 = 0;
      if ( arg3 )
        *arg3 = 97;
      v3 = 1;
    }
  }
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aDdrawDll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v14 = sub_41DC10(4, 5, 0, 0x9Bu);
    if ( sub_41DC50(v52, v53, v14, v15) < 0 )
    {
      v17 = arg3;
      v16 = arg2;
    }
    else
    {
      if ( arg1 )
        *arg1 = 5;
      v16 = arg2;
      if ( arg2 )
        *arg2 = 0;
      v17 = arg3;
      if ( arg3 )
        *arg3 = 32;
      v3 = 1;
    }
    v18 = sub_41DC10(4, 6, 0, 0x13Eu);
    if ( sub_41DC50(v52, v53, v18, v19) >= 0 )
    {
      if ( arg1 )
        *arg1 = 6;
      if ( v16 )
        *v16 = 0;
      if ( v17 )
        *v17 = 32;
      v3 = 1;
    }
    v20 = sub_41DC10(4, 6, 0, 0x1B4u);
    if ( sub_41DC50(v52, v53, v20, v21) >= 0 )
    {
      if ( arg1 )
        *arg1 = 6;
      if ( v16 )
        *v16 = 1;
      if ( v17 )
        *v17 = 32;
      v3 = 1;
    }
  }
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aDplayxDll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v22 = sub_41DC10(4, 6, 3u, 0x206u);
    if ( sub_41DC50(v52, v53, v22, v23) >= 0 )
    {
      if ( arg1 )
        *arg1 = 6;
      if ( arg2 )
        *arg2 = 1;
      if ( arg3 )
        *arg3 = 97;
      v3 = 1;
    }
  }
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aDdrawDll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v24 = sub_41DC10(4, 7, 0, 0x2BCu);
    if ( sub_41DC50(v52, v53, v24, v25) >= 0 )
    {
      if ( arg1 )
        *arg1 = 7;
      if ( arg2 )
        *arg2 = 0;
      if ( arg3 )
        *arg3 = 32;
      v3 = 1;
    }
  }
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aDinputDll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v26 = sub_41DC10(4, 7, 0, 0x2CCu);
    if ( sub_41DC50(v52, v53, v26, v27) >= 0 )
    {
      if ( arg1 )
        *arg1 = 7;
      if ( arg2 )
        *arg2 = 0;
      if ( arg3 )
        *arg3 = 97;
      v3 = 1;
    }
  }
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aDdrawDll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v28 = v53;
    if ( HIWORD(v53) == 4 )
    {
      v29 = sub_41DC10(4, 8, 0, 0x190u);
      if ( sub_41DC50(v52, v53, v29, v30) >= 0 )
      {
LABEL_96:
        if ( arg1 )
          *arg1 = 8;
        if ( arg2 )
          *arg2 = 0;
        if ( arg3 )
          *arg3 = 32;
        v3 = 1;
        goto LABEL_103;
      }
      v28 = v53;
    }
    if ( HIWORD(v28) != 5 )
      goto LABEL_103;
    v31 = sub_41DC10(5, 1, 0x8D2u, 0x190u);
    if ( sub_41DC50(v52, v53, v31, v32) < 0 )
      goto LABEL_103;
    goto LABEL_96;
  }
LABEL_103:
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aD3d8Dll_0);
  if ( FUN_0041db50((uint)tstrFilename, &v52) < 0 )
    goto LABEL_130;
  v33 = v53;
  if ( HIWORD(v53) != 4 )
  {
LABEL_107:
    if ( HIWORD(v33) == 5 )
    {
      v36 = sub_41DC10(5, 1, 0xA28u, 0x371u);
      if ( sub_41DC50(v52, v53, v36, v37) >= 0 )
        goto LABEL_109;
      v33 = v53;
    }
    v39 = arg3;
    v38 = arg2;
    goto LABEL_118;
  }
  v34 = sub_41DC10(4, 8, 1u, 0x371u);
  if ( sub_41DC50(v52, v53, v34, v35) < 0 )
  {
    v33 = v53;
    goto LABEL_107;
  }
LABEL_109:
  if ( arg1 )
    *arg1 = 8;
  v38 = arg2;
  if ( arg2 )
    *arg2 = 1;
  v39 = arg3;
  if ( arg3 )
    *arg3 = 32;
  v33 = v53;
  v3 = 1;
LABEL_118:
  if ( HIWORD(v33) != 4 )
  {
LABEL_121:
    if ( HIWORD(v33) != 5 )
      goto LABEL_130;
    v42 = sub_41DC10(5, 1, 0xA28u, 0x385u);
    if ( sub_41DC50(v52, v53, v42, v43) < 0 )
      goto LABEL_130;
    goto LABEL_123;
  }
  v40 = sub_41DC10(4, 8, 1u, 0x385u);
  if ( sub_41DC50(v52, v53, v40, v41) < 0 )
  {
    v33 = v53;
    goto LABEL_121;
  }
LABEL_123:
  if ( arg1 )
    *arg1 = 8;
  if ( v38 )
    *v38 = 1;
  if ( v39 )
    *v39 = 97;
  v3 = 1;
LABEL_130:
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aMpg2spltAx);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v44 = sub_41DC10(6, 3, 1u, 0x375u);
    if ( sub_41DC50(v52, v53, v44, v45) >= 0 )
    {
      if ( arg1 )
        *arg1 = 8;
      if ( arg2 )
        *arg2 = 1;
      if ( arg3 )
        *arg3 = 98;
      v3 = 1;
    }
  }
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aDpnetDll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) >= 0 )
  {
    v46 = v53;
    if ( HIWORD(v53) == 4 )
    {
      v47 = sub_41DC10(4, 9, 0, 0x86u);
      if ( sub_41DC50(v52, v53, v47, v48) >= 0 )
      {
LABEL_145:
        if ( arg1 )
          *arg1 = 8;
        if ( arg2 )
          *arg2 = 2;
        if ( arg3 )
          *arg3 = 32;
        v3 = 1;
        goto LABEL_152;
      }
      v46 = v53;
    }
    if ( HIWORD(v46) != 5 )
      goto LABEL_152;
    v49 = sub_41DC10(5, 2, 0xE5Du, 0x86u);
    if ( sub_41DC50(v52, v53, v49, v50) < 0 )
      goto LABEL_152;
    goto LABEL_145;
  }
LABEL_152:
  strcpy(tstrFilename, Buffer);
  strcat(tstrFilename, aD3d9Dll);
  if ( FUN_0041db50((uint)tstrFilename, &v52) < 0 )
  {
    if ( v3 )
      return 0;
LABEL_160:
    if ( arg1 )
      *arg1 = 0;
    if ( arg2 )
      *arg2 = 0;
    if ( arg3 )
      *arg3 = 32;
    return 0;
  }
  if ( arg1 )
    *arg1 = 9;
  if ( arg2 )
    *arg2 = 0;
  if ( arg3 )
  {
    *arg3 = 32;
    return 0;
  }
  return 0;
}

// FUN_0041db50 @ 0x0041DB50
// [binja] int32_t sub_41db50(uint32_t arg1, int32_t* arg2)
int FUN_0041db50(uint arg1, int *arg2)
{
  const CHAR *v2; // edi
  int *v3; // ebx
  uint FileVersionInfoSizeA; // eax
  void *v5; // eax
  void *v6; // esi
  int *v8; // eax
  DWORD dwHandle; // [esp+Ch] [ebp-4h] BYREF

  v2 = (const CHAR *)arg1;
  if ( !arg1 )
    return -2147024809;
  v3 = arg2;
  if ( !arg2 )
    return -2147024809;
  FileVersionInfoSizeA = GetFileVersionInfoSizeA((LPCSTR)arg1, &dwHandle);
  arg1 = FileVersionInfoSizeA;
  if ( FileVersionInfoSizeA )
  {
    v5 = operator new(FileVersionInfoSizeA);
    v6 = v5;
    if ( !v5 )
      return -2147024882;
    if ( GetFileVersionInfoA(v2, 0, arg1, v5) )
    {
      arg2 = 0;
      if ( VerQueryValueA(v6, SubBlock, (LPVOID *)&arg2, &arg1) )
      {
        v8 = arg2;
        if ( arg2 )
        {
          v3[1] = arg2[2];
          *v3 = v8[3];
          crt_free(v6);
          return 0;
        }
      }
    }
    crt_free(v6);
  }
  return -2147467259;
}

// sub_41DC10 @ 0x0041DC10
int __cdecl sub_41DC10(int a1, int a2, unsigned __int16 a3, unsigned __int16 a4)
{
  return a4 | (a3 << 16);
}

// sub_41DC50 @ 0x0041DC50
int __cdecl sub_41DC50(unsigned int a1, unsigned int a2, unsigned int a3, unsigned int a4)
{
  if ( a2 > a4 )
    return 1;
  if ( a2 < a4 )
    return -1;
  if ( a1 <= a3 )
    return -(a1 < a3);
  return 1;
}

// grim_load_interface @ 0x0041DC80
// load grim DLL and fetch GRIM_GetInterface
int grim_load_interface(char *dll_name)
{
  int result; // eax
  int (*GRIM__GetInterface)(void); // edx

  result = (int)LoadLibraryA(dll_name);
  dword_490304 = result;
  if ( result )
  {
    GRIM__GetInterface = GetProcAddress((HMODULE)result, aGrimGetinterfa);
    strcpy(byte_490308, dll_name);
    if ( GRIM__GetInterface )
      return GRIM__GetInterface();
    else
      return 0;
  }
  return result;
}

// vorbis_mem_read @ 0x0041DCE0
// ov_open_callbacks read hook for memory-backed OGG data
uint vorbis_mem_read(void *dst, uint size, uint count, void *datasource)
{
  int v4; // esi
  uint v5; // eax
  uint result; // eax

  if ( *((_DWORD *)datasource - 1) >= *((_DWORD *)datasource - 2) )
    *((_DWORD *)datasource - 1) = 0;
  v4 = *((_DWORD *)datasource - 1);
  v5 = *((_DWORD *)datasource - 2);
  if ( v5 >= count * size + v4 )
    result = count * size;
  else
    result = v5 - v4;
  qmemcpy(dst, (char *)datasource + v4, result);
  *((_DWORD *)datasource - 1) += count * size;
  return result;
}

// sub_41DD40 @ 0x0041DD40
int __cdecl sub_41DD40(int a1, int a2, int a3, int a4)
{
  int v5; // edx

  if ( a4 )
  {
    if ( a4 == 2 )
      v5 = *(_DWORD *)(a1 - 8) - a2;
    else
      v5 = a2 + *(_DWORD *)(a1 - 4);
    *(_DWORD *)(a1 - 4) = v5;
    return 1;
  }
  else
  {
    *(_DWORD *)(a1 - 4) = a2;
    return 1;
  }
}

// sub_41DD90 @ 0x0041DD90
int sub_41DD90()
{
  return 1;
}

// vorbis_mem_tell @ 0x0041DDA0
// ov_open_callbacks tell hook (returns current offset)
int vorbis_mem_tell(void *datasource)
{
  return *((_DWORD *)datasource - 1);
}

// vorbis_pcm_seek @ 0x0041DDB0
// wrapper around ov_pcm_seek for memory stream
int vorbis_pcm_seek(void *stream, uint sample_offset)
{
  int v2; // ecx

  return ov_pcm_seek(v2 + 16, stream, 0);
}

// vorbis_mem_open @ 0x0041DDD0
// open OGG/Vorbis data from a memory buffer (sets callbacks)
int vorbis_mem_open(void *stream, void *buffer, uint size)
{
  uint (**v3)(void *, uint, uint, void *); // ecx
  uint (**v4)(void *, uint, uint, void *); // ebx
  int result; // eax
  __int64 v6; // rax

  v4 = v3;
  *v3 = vorbis_mem_read;
  v3[1] = (uint (*)(void *, uint, uint, void *))sub_41DD40;
  v3[2] = (uint (*)(void *, uint, uint, void *))sub_41DD90;
  v3[3] = (uint (*)(void *, uint, uint, void *))vorbis_mem_tell;
  v3[184] = 0;
  v3[187] = (uint (*)(void *, uint, uint, void *))stream;
  *(_DWORD *)stream = buffer;
  *((_DWORD *)v3[187] + 1) = 0;
  if ( ov_open_callbacks((char *)v3[187] + 8, v3 + 4, 0, 0, *v3, v3[1], v3[2], v3[3]) >= 0 )
  {
    qmemcpy(v4 + 188, (const void *)ov_info(v4 + 4, -1), 0x20u);
    v6 = 16 * ov_pcm_total(v4 + 4, -1) * (int)v4[189] / 8;
    HIDWORD(v6) = v4[187];
    v4[185] = (uint (*)(void *, uint, uint, void *))v6;
    result = vorbis_mem_tell((void *)(HIDWORD(v6) + 8));
    v4[186] = (uint (*)(void *, uint, uint, void *))result;
    LOBYTE(result) = 1;
  }
  else
  {
    result = sub_461FD5((int)aInputDoesNotAp);
    LOBYTE(result) = 0;
  }
  return result;
}

// vorbis_mem_close @ 0x0041DEE0
// frees memory buffer and ov_clear
void vorbis_mem_close(void *stream)
{
  int v1; // ecx
  int v2; // esi

  v2 = v1;
  crt_free(*(void **)(v1 + 748));
  ov_clear(v2 + 16);
}

// vorbis_read_pcm16 @ 0x0041DF00
// decode PCM16 samples via ov_read
int vorbis_read_pcm16(void *stream, char *dst, int bytes)
{
  int v3; // ecx
  int result; // eax

  result = ov_read(v3 + 16, stream, dst, 0, 2, 1, v3 + 736);
  if ( result )
    return result < 0 ? 0 : result;
  return result;
}

// sub_41DF50 @ 0x0041DF50
int sub_41DF50()
{
  return 2400000;
}

// game_sequence_get @ 0x0041DF60
// returns the saved game_sequence_id
int game_sequence_get()
{
  return *(_DWORD *)&game_sequence_id;
}

// nullsub_108 @ 0x0041E0C0
void nullsub_108()
{
  ;
}

// sub_41E120 @ 0x0041E120
int sub_41E120()
{
  dword_49100C = 1;
  dword_491008 = 0;
  dword_491004 = 0;
  dword_491000 = 0;
  return 0;
}

// sub_41E150 @ 0x0041E150
void sub_41E150()
{
  dword_4AA4D0 = 0;
  dword_4AA4D4 = 0;
}

// sub_41E180 @ 0x0041E180
void sub_41E180()
{
  dword_490F78 = 0;
  dword_490F7C = 0;
}

// sub_41E1B0 @ 0x0041E1B0
int *sub_41E1B0()
{
  int *result; // eax
  int *v1; // ebx
  int v2; // [esp+10h] [ebp-1Ch]

  result = &fx_queue_pos_x;
  v2 = 128;
  do
  {
    v1 = result + 4;
    *result = 0;
    *(result - 2) = 0;
    result[4] = 1065353216;
    *(result - 1) = 0;
    result[1] = 0;
    result[5] = 1065353216;
    result[2] = 0;
    result[3] = 0;
    result[6] = 1065353216;
    result += 10;
    v1[3] = 1065353216;
    --v2;
  }
  while ( v2 );
  return result;
}

// nullsub_109 @ 0x0041E260
void nullsub_109()
{
  ;
}

// FUN_0041e270 @ 0x0041E270
// [binja] int32_t sub_41e270(float* arg1, float* arg2)
int FUN_0041e270(float *arg1, float *arg2)
{
  *arg1 = *arg1 + *arg2;
  arg1[1] = arg2[1] + arg1[1];
  return 0;
}

// player_apply_move_with_spawn_avoidance @ 0x0041E290
// applies movement delta (scaled by alternate-weapon perk) and resolves collisions with creature spawn slots
void player_apply_move_with_spawn_avoidance(int player_index, float *pos, float *delta)
{
  float *v3; // ebx
  int *v4; // edi
  float *v5; // edx
  double v6; // st6
  double v7; // st4
  double v9; // st7
  unsigned __int8 v10; // c0
  unsigned __int8 v11; // c3
  double v12; // st5
  double v13; // st3
  double v14; // st7
  double v15; // st3
  int player_indexa; // [esp+18h] [ebp+4h]

  v3 = (float *)((char *)&unk_4908B0 + 864 * player_index);
  if ( perk_count_get(perk_id_alternate_weapon) )
  {
    *delta = *delta * 0.80000001;
    delta[1] = delta[1] * 0.80000001;
  }
  v4 = creature_spawn_slot_table;
  *pos = *pos + *delta;
  pos[1] = delta[1] + pos[1];
  do
  {
    v5 = (float *)*v4;
    if ( *v4 )
    {
      *(float *)&player_indexa = (v5[13] + v3[13]) * 0.33333334;
      v6 = v5[6] - pos[1];
      v7 = v5[5] - *pos;
      if ( sqrt(v6 * v6 + v7 * v7) <= *(float *)&player_indexa )
      {
        *pos = *pos - *delta;
        pos[1] = pos[1] - delta[1];
        v9 = *pos + *delta;
        if ( v10 | v11 )
        {
          *pos = v9;
          pos[1] = delta[1] + pos[1];
        }
        else
        {
          *pos = v9;
          v12 = v5[6] - pos[1];
          v13 = v5[5] - v9;
          if ( sqrt(v12 * v12 + v13 * v13) <= *(float *)&player_indexa )
          {
            *pos = v9 - *delta;
            v14 = delta[1] + pos[1];
            pos[1] = v14;
            v15 = v5[5] - *pos;
            if ( sqrt((v5[6] - v14) * (v5[6] - v14) + v15 * v15) <= *(float *)&player_indexa )
              pos[1] = v14 - delta[1];
          }
        }
      }
    }
    v4 += 6;
  }
  while ( (int)v4 < (int)&SubKey );
}

// vec2_add_inplace @ 0x0041E400
// adds delta XY into pos; unused param_1 in decompile
void vec2_add_inplace(int unused, float *pos, float *delta)
{
  *pos = *pos + *delta;
  pos[1] = delta[1] + pos[1];
}

// sub_41E430 @ 0x0041E430
void sub_41E430()
{
  dword_490418 = 0;
  dword_49041C = 0;
}

// sub_41E460 @ 0x0041E460
_DWORD *sub_41E460()
{
  _DWORD *result; // eax
  int v1; // ecx

  result = &secondary_proj_speed;
  v1 = 64;
  do
  {
    *((_BYTE *)result - 8) = 0;
    result[5] = 1;
    *result = 0;
    result[6] = 0;
    result[8] = -100;
    result += 11;
    --v1;
  }
  while ( v1 );
  return result;
}

// sub_41E4A0 @ 0x0041E4A0
char *sub_41E4A0()
{
  char *result; // eax
  int v1; // ebx
  _DWORD *v2; // ebp

  result = &sprite_effect_pool;
  v1 = 384;
  do
  {
    v2 = result + 4;
    *result = 0;
    result += 44;
    --v1;
    *v2 = 1065353216;
    v2[1] = 1065353216;
    v2[2] = 1065353216;
    v2[3] = 1065353216;
  }
  while ( v1 );
  return result;
}

// sub_41E520 @ 0x0041E520
int sub_41E520()
{
  int *v0; // esi
  int *v1; // eax
  int v2; // eax
  int v3; // edx
  int result; // eax
  int v5; // [esp+10h] [ebp-18h]

  v0 = &particle_intensity;
  v5 = 128;
  do
  {
    v1 = v0 - 4;
    *((_BYTE *)v0 + 12) = 0;
    *((_BYTE *)v0 - 36) = 0;
    *v1 = 1065353216;
    *v0 = 1065353216;
    v1[1] = 1065353216;
    v1[2] = 1065353216;
    v1[3] = 1065353216;
    v2 = crt_rand();
    *((_BYTE *)v0 - 35) = 1;
    v3 = v2 % 628;
    v0[4] = -1;
    v0 += 14;
    result = v5 - 1;
    v5 = result;
    *((float *)v0 - 12) = (double)v3 * 0.0099999998;
  }
  while ( result );
  return result;
}

// sub_41E5D0 @ 0x0041E5D0
_DWORD *sub_41E5D0()
{
  _DWORD *result; // eax
  int v1; // ebx

  result = &unk_4908B4;
  v1 = 2;
  do
  {
    result[28] = 0;
    *result = 0;
    result[13] = 0;
    *((_BYTE *)result - 4) = 0;
    result[35] = 0;
    *((_BYTE *)result + 4) = 0;
    result[36] = 0;
    *((_BYTE *)result + 5) = 0;
    result[2] = 0;
    result[29] = -1;
    result[200] = -1082130432;
    result[198] = 0;
    result[195] = 0;
    result[39] = 0;
    result[40] = 0;
    result[41] = 0;
    result[201] = -1082130432;
    result[194] = -1;
    result[199] = 0;
    result[37] = 0;
    result[38] = 0;
    *((_BYTE *)result + 708) = 0;
    result[197] = 0;
    result[192] = 0;
    result[42] = 0;
    result[44] = 1;
    result[180] = 0;
    result[189] = 0;
    result[176] = 1106247680;
    result[190] = 0;
    result += 216;
    --v1;
  }
  while ( v1 );
  return result;
}

// sub_41E6D0 @ 0x0041E6D0
int *sub_41E6D0()
{
  int *result; // eax
  int v1; // edx

  result = &creature_phase_seed;
  v1 = 385;
  do
  {
    result[28] = 0;
    *result = 0;
    result[13] = 0;
    *((_BYTE *)result - 4) = 0;
    result[35] = 0;
    *((_BYTE *)result + 4) = 0;
    result[36] = 0;
    *((_BYTE *)result + 5) = 0;
    result[2] = 0;
    result[29] = -1;
    result += 38;
    --v1;
  }
  while ( v1 );
  return result;
}

// nullsub_110 @ 0x0041E720
void nullsub_110()
{
  ;
}

// nullsub_111 @ 0x0041E740
void nullsub_111()
{
  ;
}

// sub_41E760 @ 0x0041E760
_DWORD *sub_41E760()
{
  _DWORD *result; // eax
  int v1; // esi

  result = &projectile_type_id;
  v1 = 96;
  do
  {
    result[7] = -1;
    *((_BYTE *)result - 32) = 0;
    *result = 1;
    result[3] = 1065353216;
    result[5] = 0;
    result[6] = 1065353216;
    result += 16;
    --v1;
  }
  while ( v1 );
  return result;
}

// nullsub_112 @ 0x0041E7B0
void nullsub_112()
{
  ;
}

// nullsub_113 @ 0x0041E7D0
void nullsub_113()
{
  ;
}

// nullsub_114 @ 0x0041E7F0
void nullsub_114()
{
  ;
}

// nullsub_115 @ 0x0041E810
void nullsub_115()
{
  ;
}

// nullsub_116 @ 0x0041E830
void nullsub_116()
{
  ;
}

// fx_queue_add @ 0x0041E840
// pushes a quad entry into DAT_004aaf18 (capped at 0x80); returns 1 on success
int fx_queue_add(int effect_id, float *pos, float w, float h, float rotation, float *rgba)
{
  int result; // eax
  int v7; // ecx
  float *v8; // edx
  int v9; // esi

  result = 40 * fx_queue_count;
  v7 = fx_queue_count + 1;
  *(int *)((char *)fx_queue_pos_x + result) = *(_DWORD *)pos;
  *(int *)((char *)fx_queue_pos_y + result) = *((_DWORD *)pos + 1);
  v8 = (float *)((char *)&fx_queue_color_r + result);
  *v8 = *rgba;
  v8[1] = rgba[1];
  v8[2] = rgba[2];
  v9 = *((_DWORD *)rgba + 3);
  fx_queue_count = v7;
  *((_DWORD *)v8 + 3) = v9;
  *(float *)((char *)fx_queue_width + result) = w;
  *(float *)((char *)fx_queue_height + result) = h;
  *(float *)((char *)fx_queue_rotation + result) = rotation;
  *(int *)((char *)fx_queue + result) = effect_id;
  if ( v7 < 128 )
  {
    LOBYTE(result) = 1;
  }
  else
  {
    fx_queue_count = 127;
    LOBYTE(result) = 0;
  }
  return result;
}

// sub_41E8D0 @ 0x0041E8D0
bool sub_41E8D0()
{
  return (*(int (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 164))(grim_interface_ptr, 0) == dword_4804FC;
}

// sub_41E8F0 @ 0x0041E8F0
bool sub_41E8F0()
{
  return (*(int (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 164))(grim_interface_ptr, 0) == dword_4804F8;
}

// creature_handle_death @ 0x0041E910
// death handler: bonus spawns, split-on-death, score, and cleanup
void creature_handle_death(int creature_id, bool keep_corpse)
{
  const void *v2; // ebx
  int v3; // eax
  int v4; // ebp
  int v5; // ebp
  int v6; // edi
  float angle; // [esp+0h] [ebp-10h]
  float anglea; // [esp+0h] [ebp-10h]

  v2 = (const void *)(152 * creature_id + 4833080);
  if ( (creature_flags[38 * creature_id] & 0x400) != 0 )
    bonus_spawn_at(
      (float *)(152 * creature_id + 4833100),
      SLOWORD(creature_link_index[38 * creature_id]),
      SHIWORD(creature_link_index[38 * creature_id]));
  v3 = survival_recent_death_count;
  if ( survival_recent_death_count < 6 )
  {
    if ( survival_recent_death_count < 3 )
    {
      survival_recent_death_pos[2 * survival_recent_death_count] = *(&creature_pos_x + 38 * creature_id);
      survival_recent_death_pos_y[2 * survival_recent_death_count] = LODWORD(creature_pos_y[38 * creature_id]);
      v3 = survival_recent_death_count;
    }
    survival_recent_death_count = v3 + 1;
    if ( v3 == 2 )
    {
      survival_reward_fire_seen = 0;
      survival_reward_handout_enabled = 0;
    }
  }
  if ( creature_pool[152 * creature_id] )
  {
    if ( (creature_flags[38 * creature_id] & 4) != 0 )
      creature_spawn_slot_table[6 * creature_link_index[38 * creature_id]] = 0;
    if ( (creature_flags[38 * creature_id] & 8) != 0 && *(&creature_size + 38 * creature_id) > 35.0 )
    {
      v4 = 152 * creature_alloc_slot();
      qmemcpy(&creature_pool[v4], v2, 0x98u);
      creature_phase_seed[v4 / 4u] = (unsigned __int8)crt_rand();
      *(float *)(v4 + 4833124) = *(&creature_heading + 38 * creature_id) - 1.5707964;
      *(float *)(v4 + 4833116) = creature_max_health[38 * creature_id] * 0.25;
      *(float *)(v4 + 4833180) = *(float *)(v4 + 4833180) * 0.66666669;
      *(float *)(v4 + 4833132) = *(float *)(v4 + 4833132) - 8.0;
      *(float *)(v4 + 4833172) = *(float *)(v4 + 4833172) + 0.1;
      *(float *)(v4 + 4833168) = *(float *)(v4 + 4833168) * 0.69999999;
      creature_hitbox_size[v4 / 4u] = 1098907648;
      v5 = 152 * creature_alloc_slot();
      qmemcpy(&creature_pool[v5], v2, 0x98u);
      creature_phase_seed[v5 / 4u] = (unsigned __int8)crt_rand();
      *(float *)(v5 + 4833124) = *(&creature_heading + 38 * creature_id) + 1.5707964;
      *(float *)(v5 + 4833116) = creature_max_health[38 * creature_id] * 0.25;
      *(float *)(v5 + 4833132) = *(float *)(v5 + 4833132) - 8.0;
      *(float *)(v5 + 4833172) = *(float *)(v5 + 4833172) + 0.1;
      *(float *)(v5 + 4833180) = *(float *)(v5 + 4833180) * 0.66666669;
      creature_hitbox_size[v5 / 4u] = 1098907648;
      *(float *)(v5 + 4833168) = *(float *)(v5 + 4833168) * 0.69999999;
      effect_spawn_burst((float *)(152 * creature_id + 4833100), 8);
    }
    if ( keep_corpse )
      *(float *)&creature_hitbox_size[38 * creature_id] = *(float *)&creature_hitbox_size[38 * creature_id] - frame_dt;
    else
      creature_pool[152 * creature_id] = 0;
    if ( (int)*(&player_perk_counts + perk_id_bloody_mess_quick_learner) <= 0 )
      player_experience[0] = (__int64)((double)player_experience[0] + creature_reward_value[38 * creature_id]);
    else
      player_experience[0] += (__int64)(creature_reward_value[38 * creature_id] * 1.3);
    if ( bonus_double_xp_timer > 0.0 )
    {
      if ( (int)*(&player_perk_counts + perk_id_bloody_mess_quick_learner) <= 0 )
        player_experience[0] = (__int64)((double)player_experience[0] + creature_reward_value[38 * creature_id]);
      else
        player_experience[0] += (__int64)(creature_reward_value[38 * creature_id] * 1.3);
    }
    if ( !bonus_spawn_guard )
      bonus_try_spawn_on_kill((float *)(152 * creature_id + 4833100));
    if ( bonus_freeze_timer > 0.0 )
    {
      v6 = 8;
      do
      {
        angle = (double)(crt_rand() % 612) * 0.0099999998;
        effect_spawn_freeze_shard((float *)(152 * creature_id + 4833100), angle);
        --v6;
      }
      while ( v6 );
      anglea = (double)(crt_rand() % 612) * 0.0099999998;
      effect_spawn_freeze_shatter((float *)(152 * creature_id + 4833100), anglea);
      ++creature_kill_count;
      creature_pool[152 * creature_id] = 0;
      fx_queue_add_random((float *)(152 * creature_id + 4833100));
    }
  }
}

// config_sync_from_grim @ 0x0041EC60
// syncs Grim config values into config blob and writes crimson.cfg
int config_sync_from_grim()
{
  int v0; // eax
  int v1; // edx
  int *v2; // ebp
  char *v3; // eax
  FILE *v4; // eax
  FILE *v5; // ebp
  char *v6; // eax
  int result; // eax
  FILE *v8; // esi
  char *v9; // [esp+30h] [ebp-494h]
  _DWORD v10[4]; // [esp+34h] [ebp-490h] BYREF
  _BYTE Buffer[4]; // [esp+44h] [ebp-480h] BYREF
  __int16 v12; // [esp+48h] [ebp-47Ch]
  char v13; // [esp+52h] [ebp-472h]
  char v14; // [esp+53h] [ebp-471h]
  char v15; // [esp+54h] [ebp-470h]
  char v16; // [esp+55h] [ebp-46Fh]
  int v17; // [esp+58h] [ebp-46Ch]
  int v18; // [esp+5Ch] [ebp-468h]
  int v19; // [esp+60h] [ebp-464h]
  int v20; // [esp+64h] [ebp-460h]
  int v21; // [esp+88h] [ebp-43Ch]
  int v22; // [esp+8Ch] [ebp-438h]
  int v23; // [esp+B0h] [ebp-414h]
  int v24; // [esp+B4h] [ebp-410h]
  _DWORD v25[2]; // [esp+B8h] [ebp-40Ch] BYREF
  char v26; // [esp+C0h] [ebp-404h]
  int v27; // [esp+C4h] [ebp-400h]
  int v28; // [esp+C8h] [ebp-3FCh]
  char v29; // [esp+CCh] [ebp-3F8h] BYREF
  char v30; // [esp+ECh] [ebp-3D8h] BYREF
  _DWORD v31[17]; // [esp+1C4h] [ebp-300h] BYREF
  int v32; // [esp+208h] [ebp-2BCh]
  int v33; // [esp+20Ch] [ebp-2B8h]
  int v34; // [esp+210h] [ebp-2B4h]
  int v35; // [esp+214h] [ebp-2B0h]
  int v36; // [esp+218h] [ebp-2ACh]
  int v37; // [esp+21Ch] [ebp-2A8h]
  int v38; // [esp+220h] [ebp-2A4h]
  int v39; // [esp+224h] [ebp-2A0h]
  int v40; // [esp+228h] [ebp-29Ch]
  int v41; // [esp+22Ch] [ebp-298h]
  int v42; // [esp+230h] [ebp-294h]
  int v43; // [esp+234h] [ebp-290h]
  int v44; // [esp+238h] [ebp-28Ch]
  int v45; // [esp+23Ch] [ebp-288h]
  int v46; // [esp+240h] [ebp-284h]
  int v47; // [esp+244h] [ebp-280h]
  int v48; // [esp+248h] [ebp-27Ch]
  int v49; // [esp+24Ch] [ebp-278h]
  int v50; // [esp+250h] [ebp-274h]
  int v51; // [esp+254h] [ebp-270h]
  int v52; // [esp+258h] [ebp-26Ch]
  int v53; // [esp+25Ch] [ebp-268h]
  int v54; // [esp+260h] [ebp-264h]
  int v55; // [esp+264h] [ebp-260h]
  int v56; // [esp+268h] [ebp-25Ch]
  int v57; // [esp+26Ch] [ebp-258h]
  int v58; // [esp+270h] [ebp-254h]
  int v59; // [esp+274h] [ebp-250h]
  int v60; // [esp+278h] [ebp-24Ch]
  int v61; // [esp+27Ch] [ebp-248h]
  int v62; // [esp+280h] [ebp-244h]
  int v63; // [esp+284h] [ebp-240h]
  int v64; // [esp+288h] [ebp-23Ch]
  int v65; // [esp+48Ch] [ebp-38h]
  int v66; // [esp+490h] [ebp-34h]
  int v67; // [esp+494h] [ebp-30h]
  char v68; // [esp+4A4h] [ebp-20h]
  int v69; // [esp+4A8h] [ebp-1Ch]
  int v70; // [esp+4ACh] [ebp-18h]
  char v71; // [esp+4B0h] [ebp-14h]
  char v72; // [esp+4B1h] [ebp-13h]
  char v73; // [esp+4B2h] [ebp-12h]
  int v74; // [esp+4B4h] [ebp-10h]
  int v75; // [esp+4B8h] [ebp-Ch]
  int v76; // [esp+4BCh] [ebp-8h]
  int v77; // [esp+4C0h] [ebp-4h]

  config_windowed = *(_BYTE *)(*(int (__thiscall **)(int, _DWORD *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                                grim_interface_ptr,
                                v10,
                                8);
  config_display_bpp = *(_DWORD *)(*(int (__thiscall **)(int, _DWORD *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                                    grim_interface_ptr,
                                    v10,
                                    43);
  *(_DWORD *)config_screen_width = *(_DWORD *)(*(int (__thiscall **)(int, _DWORD *, int))(*(_DWORD *)grim_interface_ptr
                                                                                        + 36))(
                                                grim_interface_ptr,
                                                v10,
                                                41);
  config_screen_height = *(_DWORD *)(*(int (__thiscall **)(int, _DWORD *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                                      grim_interface_ptr,
                                      v10,
                                      42);
  *(_DWORD *)config_texture_scale = *(_DWORD *)(*(int (__thiscall **)(int, _DWORD *, int))(*(_DWORD *)grim_interface_ptr
                                                                                         + 36))(
                                                 grim_interface_ptr,
                                                 v10,
                                                 89);
  byte_4807B6 = *(_BYTE *)(*(int (__thiscall **)(int, _DWORD *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                            grim_interface_ptr,
                            v10,
                            84);
  v0 = player_name_length;
  strcpy(config_player_name, (const char *)&highscore_active_record);
  config_player_name_length = v0;
  if ( grim_config_invoked )
  {
    v25[0] = 0;
    LOWORD(v65) = 256;
    v25[1] = 0;
    v66 = 0;
    v75 = 1056964608;
    v67 = 1;
    v76 = 257;
    v77 = 258;
    v73 = 0;
    v24 = 1065353216;
    v72 = 0;
    v26 = 0;
    v1 = 0;
    v9 = &v30;
    v2 = (int *)&v29;
    do
    {
      *v2++ = v1;
      strcpy(v9, aDefault);
      ++v1;
      v9 += 27;
    }
    while ( v1 < 8 );
    Buffer[3] = 0;
    Buffer[2] = 0;
    memset(v31, 0, 0x20u);
    strcpy((char *)v31, default_player_name);
    v28 = 1;
    v68 = 1;
    v31[14] = 32;
    v18 = 1;
    v13 = 1;
    v15 = 1;
    v16 = 1;
    v17 = 1;
    v36 = 32;
    v27 = 0;
    v74 = 5;
    Buffer[0] = 0;
    Buffer[1] = 0;
    v71 = 0;
    v31[10] = 0;
    v31[11] = 0;
    v31[12] = 9000;
    v31[13] = 27000;
    v31[9] = 100;
    v23 = 0;
    v31[15] = 800;
    v31[16] = 600;
    LOBYTE(v32) = 0;
    v14 = 0;
    v19 = 2;
    v20 = 2;
    v21 = 0;
    v22 = 0;
    v69 = 1065353216;
    v70 = 1065353216;
    v33 = 17;
    v34 = 31;
    v35 = 30;
    v37 = 256;
    v38 = 382;
    v39 = 382;
    v40 = 16;
    v41 = 18;
    v42 = 319;
    v43 = 320;
    v44 = 321;
    v45 = 339;
    v46 = 382;
    v47 = 382;
    v48 = 382;
    v49 = 200;
    v50 = 208;
    v51 = 203;
    v52 = 205;
    v53 = 157;
    v54 = 382;
    v55 = 382;
    v56 = 211;
    v57 = 209;
    v58 = 319;
    v59 = 320;
    v60 = 321;
    v61 = 339;
    v62 = 382;
    v63 = 382;
    v64 = 382;
    v12 = 257;
    v3 = game_build_path(config_filename);
    v4 = crt_fopen(v3, file_mode_read_binary);
    v5 = v4;
    if ( v4 )
    {
      crt_fseek(v4, 0, 2);
      if ( crt_ftell(v5) == 1152 )
      {
        crt_fseek(v5, 0, 0);
        crt_fread(Buffer, 0x480u, 1u, v5);
        config_fx_toggle = v71;
        strcpy((char *)&config_player_name_buf, (const char *)v25);
      }
      crt_fclose(v5);
    }
  }
  v6 = game_build_path(config_filename);
  result = (int)crt_fopen(v6, file_mode_write_binary);
  v8 = (FILE *)result;
  if ( result )
  {
    crt_fwrite(config_blob, 0x480u, 1u, (FILE *)result);
    result = crt_fclose(v8);
  }
  LOBYTE(result) = 1;
  return result;
}

// config_ensure_file @ 0x0041F130
// creates crimson.cfg when missing (writes default config blob)
void config_ensure_file()
{
  char *v0; // eax
  FILE *v1; // eax
  char *v2; // eax
  FILE *v3; // eax
  FILE *v4; // esi

  v0 = game_build_path(config_filename);
  v1 = crt_fopen(v0, file_mode_read_binary);
  if ( v1 )
  {
    crt_fclose(v1);
  }
  else
  {
    config_fx_toggle = 1;
    v2 = game_build_path(config_filename);
    v3 = crt_fopen(v2, file_mode_write_binary);
    v4 = v3;
    if ( v3 )
    {
      crt_fwrite(config_blob, 0x480u, 1u, v3);
      crt_fclose(v4);
    }
  }
}

// config_load_presets @ 0x0041F1A0
// loads config presets into globals
uint config_load_presets()
{
  char *v0; // eax
  uint result; // eax
  FILE *v2; // esi
  int *v3; // ecx
  int *v4; // eax
  int v5; // edx
  byte *v6; // edi
  char *v7; // esi
  char v8; // cl
  int v9; // [esp-8h] [ebp-18h]
  int v10; // [esp-8h] [ebp-18h]
  int v11; // [esp-8h] [ebp-18h]
  int v12; // [esp-4h] [ebp-14h]
  int v13; // [esp-4h] [ebp-14h]
  int v14; // [esp-4h] [ebp-14h]
  int v15; // [esp-4h] [ebp-14h]
  int v16; // [esp-4h] [ebp-14h]
  int v17; // [esp-4h] [ebp-14h]
  int v18; // [esp-4h] [ebp-14h]
  int v19; // [esp+0h] [ebp-10h]
  int v20; // [esp+0h] [ebp-10h]
  int v21; // [esp+0h] [ebp-10h]
  int v22; // [esp+0h] [ebp-10h]
  int v23; // [esp+0h] [ebp-10h]
  int v24; // [esp+0h] [ebp-10h]
  int v25; // [esp+0h] [ebp-10h]
  int v26; // [esp+4h] [ebp-Ch]
  int v27; // [esp+4h] [ebp-Ch]
  int v28; // [esp+4h] [ebp-Ch]
  int v29; // [esp+4h] [ebp-Ch]
  int v30; // [esp+4h] [ebp-Ch]
  int v31; // [esp+4h] [ebp-Ch]
  int v32; // [esp+4h] [ebp-Ch]
  char v33; // [esp+14h] [ebp+4h]

  player_move_key_forward = 17;
  player_move_key_backward = 31;
  player_turn_key_left = 30;
  player_turn_key_right = 32;
  player_fire_key = 15;
  player_key_reserved_0 = 17;
  player_key_reserved_1 = 31;
  player_aim_key_left = 16;
  player_aim_key_right = 18;
  player_alt_move_key_forward = 200;
  player_alt_move_key_backward = 208;
  player_alt_turn_key_left = 203;
  player_alt_turn_key_right = 205;
  player_alt_fire_key = 157;
  player_alt_key_reserved_0 = 17;
  player_alt_key_reserved_1 = 31;
  player_alt_key_reserved_2 = 211;
  player_alt_key_reserved_3 = 201;
  v0 = game_build_path(config_filename);
  result = (uint)crt_fopen(v0, file_mode_read_binary);
  v2 = (FILE *)result;
  if ( result )
  {
    crt_fseek((FILE *)result, 0, 2);
    if ( crt_ftell(v2) == 1152 )
    {
      crt_fseek(v2, 0, 0);
      crt_fread(config_blob, 0x480u, 1u, v2);
      crt_fclose(v2);
      v3 = &player_move_key_backward;
      v4 = &config_p1_axis_move_x;
      do
      {
        v5 = *(v4 - 12);
        v4 += 16;
        *(v3 - 1) = v5;
        *v3 = *(v4 - 27);
        v3[1] = *(v4 - 26);
        v3[2] = *(v4 - 25);
        v3[3] = *(v4 - 24);
        v3[4] = *(v4 - 23);
        v3[5] = *(v4 - 22);
        v3[6] = *(v4 - 21);
        v3[7] = *(v4 - 20);
        v3[9] = *(v4 - 19);
        v3[8] = *(v4 - 18);
        v3[11] = *(v4 - 17);
        v3[10] = *(v4 - 16);
        v3 += 216;
      }
      while ( (int)v4 < (int)dword_4805C0 );
      (*(void (__thiscall **)(int, int, _DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        89,
        *(_DWORD *)config_texture_scale,
        v12,
        v19,
        v26);
      if ( !v33 )
      {
        LOBYTE(v9) = byte_4807B6;
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          84,
          v9,
          v13,
          v20,
          v27);
        LOBYTE(v10) = config_windowed;
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          8,
          v10,
          v14,
          v21,
          v28);
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          43,
          config_display_bpp,
          v15,
          v22,
          v29);
        (*(void (__thiscall **)(int, int, _DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          41,
          *(_DWORD *)config_screen_width,
          v16,
          v23,
          v30);
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          42,
          config_screen_height,
          v17,
          v24,
          v31);
        LOBYTE(v11) = config_blob[0];
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          83,
          v11,
          v18,
          v25,
          v32);
      }
      result = strlen(config_player_name) + 1;
      qmemcpy(&highscore_active_record, config_player_name, 4 * (result >> 2));
      v7 = &config_player_name[4 * (result >> 2)];
      v6 = &highscore_active_record + 4 * (result >> 2);
      v8 = result;
      LOBYTE(result) = 1;
      qmemcpy(v6, v7, v8 & 3);
      player_name_length = config_player_name_length;
      BYTE2(config_blob[0]) = 0;
      config_name_slot_selected = 0;
    }
    else
    {
      crt_fclose(v2);
      result = config_sync_from_grim();
      LOBYTE(result) = 0;
    }
  }
  else
  {
    LOBYTE(result) = 0;
  }
  return result;
}

// angle_approach @ 0x0041F430
// wraps angle into [0,2pi] and steps toward target using shortest arc
void angle_approach(float *angle, float target, float rate)
{
  double v4; // st7
  double v5; // st7
  double v6; // st7
  double v7; // st6
  double v8; // st7
  unsigned __int8 v10; // c0
  unsigned __int8 v11; // c3
  double v12; // st6
  float v13; // [esp+0h] [ebp-4h]
  int v14; // [esp+0h] [ebp-4h]
  float angleb; // [esp+8h] [ebp+4h]
  float *anglea; // [esp+8h] [ebp+4h]

  if ( *angle < 0.0 )
  {
    do
    {
      v4 = *angle + 6.2831855;
      *angle = v4;
    }
    while ( v4 < 0.0 );
  }
  if ( *angle > 6.2831855 )
  {
    do
    {
      v5 = *angle - 6.2831855;
      *angle = v5;
    }
    while ( v5 > 6.2831855 );
  }
  angleb = target - *angle;
  v6 = *angle;
  anglea = (float *)(LODWORD(angleb) & 0x7FFFFFFF);
  if ( target > v6 )
    v6 = target;
  v7 = *angle;
  if ( target < v7 )
    v7 = target;
  v13 = 6.2831855 - v6 + v7;
  v14 = LODWORD(v13) & 0x7FFFFFFF;
  if ( *(float *)&anglea >= (double)*(float *)&v14 )
    v8 = *(float *)&v14;
  else
    v8 = *(float *)&anglea;
  if ( v8 > 1.0 )
    v8 = 1.0;
  if ( v10 | v11 )
  {
    v12 = frame_dt * v8 * rate;
    if ( target > (double)*angle )
    {
      *angle = v12 + *angle;
      return;
    }
  }
  else
  {
    v12 = frame_dt * v8 * rate;
    if ( target < (double)*angle )
    {
      *angle = v12 + *angle;
      return;
    }
  }
  *angle = *angle - v12;
}

// sub_41F570 @ 0x0041F570
void sub_41F570()
{
  bonus_pool_sentinel = 0;
}

// bonus_alloc_slot @ 0x0041F580
// returns a free bonus slot in DAT_00482948 (or DAT_00490630 sentinel)
int *sub_41F580()
{
  int v0; // ecx
  int *v1; // eax

  v0 = 0;
  v1 = &bonus_pool;
  while ( *v1 )
  {
    v1 += 7;
    ++v0;
    if ( (int)v1 >= (int)&quest_spawn_count )
      return &bonus_pool_sentinel;
  }
  return (int *)(28 * v0 + 4729160);
}

// bonus_spawn_at @ 0x0041F5B0
// clamps position, fills bonus entry fields, and spawns pickup effect
int *__cdecl sub_41F5B0(float *a1, int a2, int a3)
{
  double v3; // st7
  double v4; // st7
  int *v6; // esi
  int v7; // ebx

  if ( *a1 < 32.0 )
    *a1 = 32.0;
  if ( a1[1] < 32.0 )
    a1[1] = 32.0;
  v3 = (double)(terrain_texture_width - 32);
  if ( v3 < *a1 )
    *a1 = v3;
  v4 = (double)(terrain_texture_height - 32);
  if ( v4 < a1[1] )
    a1[1] = v4;
  if ( config_game_mode == 2 )
    return &bonus_pool_sentinel;
  v6 = bonus_alloc_slot();
  *((_BYTE *)v6 + 4) = 0;
  v6[4] = *(_DWORD *)a1;
  v6[5] = *((_DWORD *)a1 + 1);
  v6[2] = 1092616192;
  v6[3] = 1092616192;
  *v6 = a2;
  v6[6] = a3;
  if ( a3 == -1 )
    v6[6] = bonus_meta_default_amount[5 * a2];
  effect_template_color_r = 1053609165;
  effect_template_flags = 29;
  effect_template_color_g = 1056964608;
  effect_template_color_b = 1065353216;
  effect_template_color_a = 1056964608;
  effect_template_lifetime = 1056964608;
  effect_template_half_width = 1107296256;
  effect_template_half_height = 1107296256;
  v7 = 16;
  do
  {
    *(float *)&effect_template_rotation = (double)(crt_rand() & 0x7F) * 0.049087387;
    *(float *)&effect_template_vel_x = (float)(crt_rand() % 128 - 64);
    *(float *)&effect_template_vel_y = (float)(crt_rand() % 128 - 64);
    *(float *)&effect_template_scale_step = (double)(crt_rand() % 100) * 0.0099999998 + 0.1;
    effect_spawn(0, a1);
    --v7;
  }
  while ( v7 );
  return v6;
}

// bonus_spawn_at_pos @ 0x0041F790
// allocates a bonus slot near pos, enforces spacing/edges, picks bonus type + amount
int *__cdecl sub_41F790(float *a1)
{
  int *v1; // esi
  int *v2; // ecx
  double v3; // st6
  double v4; // st5
  int v5; // eax

  if ( *a1 < 32.0
    || (double)(terrain_texture_width - 32) < *a1
    || a1[1] < 32.0
    || (double)(terrain_texture_height - 32) < a1[1]
    || config_game_mode == 2 )
  {
    return &bonus_pool_sentinel;
  }
  v1 = bonus_alloc_slot();
  v2 = &bonus_pool;
  while ( 1 )
  {
    if ( *v2 )
    {
      v3 = a1[1] - *((float *)v2 + 5);
      v4 = *a1 - *((float *)v2 + 4);
      if ( sqrt(v4 * v4 + v3 * v3) < 32.0 )
        break;
    }
    v2 += 7;
    if ( (int)v2 >= (int)&quest_spawn_count )
      goto LABEL_12;
  }
  v1 = &bonus_pool_sentinel;
LABEL_12:
  *((_BYTE *)v1 + 4) = 0;
  v1[4] = *(_DWORD *)a1;
  v1[5] = *((_DWORD *)a1 + 1);
  v1[2] = 1092616192;
  v1[3] = 1092616192;
  v5 = bonus_pick_random_type();
  *v1 = v5;
  if ( v5 == 3 )
  {
    v1[6] = weapon_pick_random_available();
    return v1;
  }
  if ( *v1 == 1 )
  {
    v1[6] = 500;
    if ( (crt_rand() & 7u) <= 2 )
    {
      v1[6] = 1000;
      return v1;
    }
  }
  else
  {
    v1[6] = bonus_meta_default_amount[5 * *v1];
  }
  return v1;
}

// bonus_try_spawn_on_kill @ 0x0041F8D0
// decides whether to drop a bonus on kill (mode/perk rules) and spawns pickup burst
void bonus_try_spawn_on_kill(float *pos)
{
  float *v1; // edi
  int *v2; // esi
  int v3; // eax
  int v4; // edx
  int *v5; // eax
  double v6; // st6
  double v7; // st5
  int v8; // edx
  int *v9; // eax
  int v10; // esi

  if ( config_game_mode == 4 || demo_mode_active || config_game_mode == 2 || config_game_mode == 8 )
    return;
  if ( (player_weapon_id[0] == 1 || player2_weapon_id == 1 && config_player_count == 2) && (crt_rand() & 3) != 3 )
  {
    v1 = pos;
    v2 = bonus_spawn_at_pos(pos);
    *v2 = 3;
    v3 = weapon_pick_random_available();
    v2[6] = v3;
    if ( v3 == 1 )
      v2[6] = weapon_pick_random_available();
    v4 = 0;
    if ( *v2 != 1 )
    {
      v5 = bonus_pool;
      do
      {
        if ( *v5 == *v2 )
          ++v4;
        v5 += 7;
      }
      while ( (int)v5 < (int)&quest_spawn_count );
      if ( v4 >= 2 )
        goto LABEL_19;
    }
    if ( v2[6] == 1 || perk_count_get(perk_id_my_favourite_weapon) )
    {
LABEL_19:
      *v2 = 0;
      return;
    }
LABEL_36:
    if ( v2 && v2 != &bonus_pool_sentinel )
    {
      effect_template_color_r = 1053609165;
      effect_template_flags = 29;
      effect_template_color_g = 1056964608;
      effect_template_color_b = 1065353216;
      effect_template_color_a = 1056964608;
      effect_template_lifetime = 1056964608;
      effect_template_half_width = 1107296256;
      effect_template_half_height = 1107296256;
      v10 = 16;
      do
      {
        *(float *)&effect_template_rotation = (double)(crt_rand() & 0x7F) * 0.049087387;
        *(float *)&effect_template_vel_x = (float)(crt_rand() % 128 - 64);
        *(float *)&effect_template_vel_y = (float)(crt_rand() % 128 - 64);
        *(float *)&effect_template_scale_step = (double)(crt_rand() % 100) * 0.0099999998 + 0.1;
        effect_spawn(0, v1);
        --v10;
      }
      while ( v10 );
    }
    return;
  }
  if ( crt_rand() % 9 == 1
    || player_weapon_id[0] == 1 && crt_rand() % 5 == 1
    || perk_count_get(perk_id_bonus_magnet) && crt_rand() % 10 == 2 )
  {
    v1 = pos;
    v2 = bonus_spawn_at_pos(pos);
    if ( *v2 == 3 )
    {
      v6 = pos[1] - *(float *)player_pos_y;
      v7 = *pos - *(float *)player_pos_x;
      if ( sqrt(v7 * v7 + v6 * v6) < 56.0 )
      {
        *v2 = 1;
        v2[6] = 100;
      }
    }
    v8 = 0;
    if ( *v2 != 1 )
    {
      v9 = bonus_pool;
      do
      {
        if ( *v9 == *v2 )
          ++v8;
        v9 += 7;
      }
      while ( (int)v9 < (int)&quest_spawn_count );
      if ( v8 >= 2 )
        goto LABEL_35;
    }
    if ( v2[6] == player_weapon_id[0] )
    {
LABEL_35:
      *v2 = 0;
      return;
    }
    goto LABEL_36;
  }
}

// fx_spawn_sprite @ 0x0041FBB0
// spawns a sprite effect entry in DAT_00496820
int fx_spawn_sprite(float *pos, float *vel, float scale)
{
  int v3; // edi
  char *v4; // eax
  int v5; // esi
  int v6; // edx

  v3 = 0;
  v4 = sprite_effect_pool;
  while ( *v4 )
  {
    v4 += 44;
    ++v3;
    if ( (int)v4 >= (int)byte_49AA20 )
    {
      v3 = crt_rand() % 384;
      break;
    }
  }
  v5 = 11 * v3;
  sprite_effect_pool[v5 * 4] = 1;
  sprite_effect_color_b[v5] = 1065353216;
  sprite_effect_color_g[v5] = 1065353216;
  sprite_effect_color_r[v5] = 1065353216;
  sprite_effect_color_a[v5] = 1065353216;
  sprite_effect_pos_x[v5] = *(_DWORD *)pos;
  sprite_effect_pos_y[v5] = *((_DWORD *)pos + 1);
  sprite_effect_vel_x[v5] = *(_DWORD *)vel;
  sprite_effect_vel_y[v5] = *((_DWORD *)vel + 1);
  *(float *)&sprite_effect_scale[v5] = scale;
  v6 = crt_rand() % 628;
  *(float *)(v5 * 4 + 4810804) = (double)v6 * 0.0099999998;
  return v3;
}

// weapon_table_entry @ 0x0041FC60
// returns the entry base (&DAT_004d7a2c + weapon_id * 0x1f)
char *weapon_table_entry(int weapon_id)
{
  return (char *)(124 * weapon_id + 5077548);
}

// FUN_0041fc80 @ 0x0041FC80
// [binja] void* sub_41fc80()
void *FUN_0041fc80()
{
  int v0; // esi
  int v1; // eax
  double v2; // st7
  double v3; // st7
  int v4; // esi
  double v5; // st7
  int v6; // eax
  int v7; // ecx
  void *result; // eax
  int v9; // [esp+4h] [ebp-20h]
  int v10; // [esp+8h] [ebp-1Ch]
  float v11; // [esp+14h] [ebp-10h]
  float v12; // [esp+1Ch] [ebp-8h]

  if ( *(float *)(cv_verbose + 12) != 0.0 )
    console_printf(&console_log_queue, aResetingPlayer);
  v0 = 0;
  render_overlay_player_index = 0;
  do
  {
    dword_4AAF30 = 0;
    v1 = 216 * v0;
    *(float *)&v9 = (double)terrain_texture_width * 0.5;
    v2 = (double)terrain_texture_height;
    player_speed_bonus_timer[v1] = 0;
    player_shield_timer[v1] = 0;
    player_state_aux[v1] = 0;
    player_plaguebearer_active[v1 * 4] = 0;
    player_pos_x[v1] = v9;
    *(float *)&v10 = v2 * 0.5;
    player_pos_y[v1] = v10;
    player_health[v1] = 1120403456;
    v3 = (double)(80 * v0);
    if ( v0 % 2 )
    {
      v12 = v3;
      *(float *)&player_pos_x[216 * v0] = *(float *)&player_pos_x[216 * v0] - v12;
      *(float *)&player_pos_y[216 * v0] = *(float *)&player_pos_y[216 * v0] - v3;
    }
    else
    {
      v11 = v3;
      *(float *)&player_pos_x[216 * v0] = v11 + *(float *)&player_pos_x[216 * v0];
      *(float *)&player_pos_y[216 * v0] = v3 + *(float *)&player_pos_y[216 * v0];
    }
    v4 = render_overlay_player_index;
    v5 = (double)dword_4D7AEC;
    v6 = 216 * render_overlay_player_index;
    player_size[v6] = 1111490560;
    player_speed_multiplier[v6] = 0x40000000;
    player_level[v6] = 1;
    player_heading[v6] = 0;
    player_experience[v6] = 0;
    dword_490960[v6] = 0;
    player_spread_heat[v6] = 0;
    player_move_speed[v6] = 0;
    player_ammo[v6] = 1092616192;
    player_clip_size[v6] = 1092616192;
    player_reload_timer_max[v6] = 1065353216;
    player_reload_timer[v6] = 0;
    player_alt_weapon_id[v6] = 1;
    *(float *)(v6 * 4 + 4787088) = v5;
    player_alt_reload_active[v6 * 4] = 0;
    player_alt_ammo[v6] = player_alt_clip_size[v6];
    v7 = dword_4D7AF4;
    player_alt_reload_timer[v6] = 0;
    player_alt_shot_cooldown[v6] = 0;
    player_alt_reload_timer_max[v6] = v7;
    LOBYTE(v7) = demo_mode_active;
    player_shot_cooldown[v6] = 1061997773;
    player_weapon_id[v6] = 1;
    dword_490BA8[v6] = 0;
    player_state_table[v6] = 16.0;
    if ( !(_BYTE)v7 )
    {
      ui_mouse_x = 320.0;
      ui_mouse_y = 140.0;
    }
    memset((char *)&player_perk_counts + v6 * 4, 0, 0x200u);
    result = creature_collision_flag;
    do
    {
      *(_BYTE *)result = 0;
      result = (char *)result + 152;
    }
    while ( (int)result < (int)byte_4AA341 );
    v0 = v4 + 1;
    render_overlay_player_index = v0;
  }
  while ( v0 < 2 );
  render_overlay_player_index = 0;
  return result;
}

// effect_uv_tables_init @ 0x0041FED0
// precomputes UV grids for 2x2, 4x4, 8x8, 16x16 effect atlases
void effect_uv_tables_init()
{
  float *v0; // eax
  double v1; // st7
  int v2; // esi
  int *v3; // edx
  int v4; // ecx
  int *v5; // eax
  double v6; // st6
  int v7; // esi
  float *v8; // edx
  int v9; // ecx
  float *v10; // eax
  double v11; // st6
  int v12; // esi
  float *v13; // edx
  int v14; // ecx
  float *v15; // eax
  double v16; // st6
  int v17; // esi
  float *v18; // edx
  int v19; // ecx
  float *v20; // eax
  double v21; // st6
  int v22; // [esp+4h] [ebp-8h]
  int v23; // [esp+4h] [ebp-8h]
  int v24; // [esp+4h] [ebp-8h]
  int v25; // [esp+4h] [ebp-8h]
  int v26; // [esp+4h] [ebp-8h]
  int v27; // [esp+8h] [ebp-4h]
  int v28; // [esp+8h] [ebp-4h]
  int v29; // [esp+8h] [ebp-4h]
  int v30; // [esp+8h] [ebp-4h]

  v22 = 0;
  v0 = (float *)&unk_490F84;
  do
  {
    v0 += 2;
    v1 = (double)v22++ * 0.0625;
    *(v0 - 3) = v1;
    *(v0 - 2) = 0.0;
  }
  while ( (int)v0 < (int)&dword_491004 );
  v2 = 0;
  v3 = effect_uv2_v;
  v27 = 0;
  do
  {
    v4 = 0;
    v5 = v3;
    v23 = 0;
    v3 += 4;
    do
    {
      v6 = (double)v23;
      v5 += 2;
      v23 = ++v4;
      *((float *)v5 - 3) = v6 * 0.5;
      *((float *)v5 - 2) = (double)v27 * 0.5;
    }
    while ( v4 < 2 );
    v27 = ++v2;
  }
  while ( v2 < 2 );
  v7 = 0;
  v8 = effect_uv4_v;
  v28 = 0;
  do
  {
    v9 = 0;
    v10 = v8;
    v24 = 0;
    v8 += 8;
    do
    {
      v11 = (double)v24;
      v10 += 2;
      v24 = ++v9;
      *(v10 - 3) = v11 * 0.25;
      *(v10 - 2) = (double)v28 * 0.25;
    }
    while ( v9 < 4 );
    v28 = ++v7;
  }
  while ( v7 < 4 );
  v12 = 0;
  v13 = effect_uv8_v;
  v29 = 0;
  do
  {
    v14 = 0;
    v15 = v13;
    v25 = 0;
    v13 += 16;
    do
    {
      v16 = (double)v25;
      v15 += 2;
      v25 = ++v14;
      *(v15 - 3) = v16 * 0.125;
      *(v15 - 2) = (double)v29 * 0.125;
    }
    while ( v14 < 8 );
    v29 = ++v12;
  }
  while ( v12 < 8 );
  v17 = 0;
  v18 = effect_uv16_v;
  v30 = 0;
  do
  {
    v19 = 0;
    v20 = v18;
    v26 = 0;
    v18 += 32;
    do
    {
      v21 = (double)v26;
      v20 += 2;
      v26 = ++v19;
      *(v20 - 3) = v21 * 0.0625;
      *(v20 - 2) = (double)v30 * 0.0625;
    }
    while ( v19 < 16 );
    v30 = ++v17;
  }
  while ( v17 < 16 );
}

// creature_find_nearest @ 0x00420040
// returns nearest creature index; uses hitbox-size sentinel when exclude_id == -1
int creature_find_nearest(float *pos, int exclude_id, float min_dist)
{
  double v3; // st7
  int v4; // ebx
  int v6; // edx
  char *v7; // ecx
  double v8; // st5
  double v9; // st4
  long double v10; // st6
  int v13; // edx
  char *v14; // ecx
  double v15; // st5
  double v16; // st3
  long double v17; // st6
  float posb; // [esp+10h] [ebp+4h]
  float posa; // [esp+10h] [ebp+4h]

  v3 = 1000000.0;
  v4 = 0;
  if ( exclude_id == -1 )
  {
    v6 = 0;
    v7 = creature_pool;
    do
    {
      if ( *v7 && *((_DWORD *)v7 + 4) == 1098907648 )
      {
        v8 = pos[1] - *((float *)v7 + 6);
        v9 = *pos - *((float *)v7 + 5);
        v10 = sqrt(v9 * v9 + v8 * v8);
        if ( v10 < v3 )
        {
          posb = v10;
          v3 = posb;
          v4 = v6;
        }
      }
      v7 += 152;
      ++v6;
    }
    while ( (int)v7 < (int)byte_4AA338 );
    return v4;
  }
  else
  {
    v13 = 0;
    v14 = creature_pool;
    do
    {
      if ( *v14 )
      {
        if ( v13 != exclude_id )
        {
          v15 = pos[1] - *((float *)v14 + 6);
          v16 = *pos - *((float *)v14 + 5);
          v17 = sqrt(v15 * v15 + v16 * v16);
          posa = v17;
          if ( v17 > min_dist && posa < v3 )
          {
            v3 = posa;
            v4 = v13;
          }
        }
      }
      v14 += 152;
      ++v13;
    }
    while ( (int)v14 < (int)byte_4AA338 );
    return v4;
  }
}

// fx_spawn_particle @ 0x00420130
// spawns a fast particle entry in DAT_00493eb8
int fx_spawn_particle(float *pos, float angle, void *unused, float intensity)
{
  char *v4; // eax
  int v5; // edi
  int v6; // esi
  _DWORD *v7; // ecx
  int v8; // edx

  v4 = particle_pool;
  v5 = 0;
  while ( *v4 )
  {
    v4 += 56;
    ++v5;
    if ( (int)v4 >= (int)&dword_495AB8 )
    {
      v5 = crt_rand() % 128;
      break;
    }
  }
  v6 = 56 * v5;
  particle_pool[v6] = 1;
  particle_pos_x[v6 / 4u] = *(_DWORD *)pos;
  particle_pos_y[v6 / 4u] = *((_DWORD *)pos + 1);
  v7 = &particle_scale_x[14 * v5];
  *(float *)(v6 + 4800196) = cos(angle) * 90.0;
  *(float *)(v6 + 4800200) = sin(angle) * 90.0;
  *(float *)&particle_intensity[v6 / 4u] = intensity;
  *v7 = 1065353216;
  v7[1] = 1065353216;
  v7[2] = 1065353216;
  v7[3] = 0;
  *(float *)&particle_angle[v6 / 4u] = angle;
  v8 = crt_rand() % 628;
  *(float *)(v6 + 4800228) = (double)v8 * 0.0099999998;
  byte_493EB9[v6] = 1;
  particle_style_id[v6] = 0;
  return v5;
}

// fx_spawn_particle_slow @ 0x00420240
// spawns a slow particle entry in DAT_00493eb8
int fx_spawn_particle_slow(float *pos, float angle)
{
  char *v2; // eax
  int v3; // edi
  int v4; // esi
  _DWORD *v5; // eax
  int v6; // edx

  v2 = particle_pool;
  v3 = 0;
  while ( *v2 )
  {
    v2 += 56;
    ++v3;
    if ( (int)v2 >= (int)&dword_495AB8 )
    {
      v3 = crt_rand() % 128;
      break;
    }
  }
  v4 = 56 * v3;
  particle_pool[v4] = 1;
  particle_pos_x[v4 / 4u] = *(_DWORD *)pos;
  particle_pos_y[v4 / 4u] = *((_DWORD *)pos + 1);
  v5 = &particle_scale_x[14 * v3];
  *(float *)(v4 + 4800196) = cos(angle) * 30.0;
  *(float *)(v4 + 4800200) = sin(angle) * 30.0;
  particle_intensity[v4 / 4u] = 1065353216;
  *v5 = 1065353216;
  v5[1] = 1065353216;
  v5[2] = 1065353216;
  v5[3] = 0;
  *(float *)&particle_angle[v4 / 4u] = angle;
  v6 = crt_rand() % 628;
  *(float *)(v4 + 4800228) = (double)v6 * 0.0099999998;
  byte_493EB9[v4] = 1;
  particle_style_id[v4] = 8;
  particle_target_id[v4 / 4u] = -1;
  return v3;
}

// fx_spawn_secondary_projectile @ 0x00420360
// spawns a typed entry in DAT_00495ad8 (secondary projectile pool)
int fx_spawn_secondary_projectile(float *pos, float angle, int type_id)
{
  int v3; // edi
  _BYTE *v4; // eax
  long double v5; // st7
  long double v6; // st6
  int v7; // esi
  long double v8; // st7
  float v10; // [esp+8h] [ebp-4h]
  float posa; // [esp+10h] [ebp+4h]

  v3 = 0;
  v4 = &secondary_projectile_pool;
  while ( *v4 )
  {
    v4 += 44;
    ++v3;
    if ( (int)v4 >= (int)&dword_4965D8 )
    {
      v3 = 63;
      break;
    }
  }
  v5 = angle - 1.5707964;
  v6 = cos(v5);
  ++highscore_record_shots_fired;
  v7 = 44 * v3 + 4807384;
  *(_BYTE *)v7 = 1;
  *(float *)(v7 + 12) = *pos;
  *(float *)(v7 + 16) = pos[1];
  *(_DWORD *)(v7 + 8) = 0x40000000;
  *(float *)(v7 + 4) = angle;
  *(_DWORD *)(v7 + 32) = 0;
  *(_DWORD *)(v7 + 28) = type_id;
  *(float *)(v7 + 20) = v6 * 90.0;
  v8 = sin(v5);
  *(float *)(v7 + 24) = v8 * 90.0;
  if ( type_id == 2 )
  {
    LODWORD(secondary_proj_vel_y[11 * v3 + 3]) = creature_find_nearest(
                                                   (float *)&player_aim_x[216 * render_overlay_player_index],
                                                   -1,
                                                   0.0);
    posa = v6;
    *((float *)&secondary_proj_vel_x + 11 * v3) = posa * 190.0;
    v10 = v8;
    secondary_proj_vel_y[11 * v3] = v10 * 190.0;
  }
  return v3;
}

// projectile_spawn @ 0x00420440
// allocates a projectile slot, initializes fields, and returns the index (overrides to type 0x2d when Fire Bullets is active)
int projectile_spawn(float *pos, float angle, int type_id, int owner_id)
{
  int v5; // ecx
  int v6; // ecx
  char *v7; // eax
  int result; // eax
  char *v9; // ecx

  if ( !bonus_spawn_guard )
  {
    v5 = highscore_record_shots_fired;
    while ( owner_id == -100 || owner_id == -1 || owner_id == -2 || owner_id == -3 )
    {
      ++v5;
      if ( type_id == 45 || *(float *)player_fire_bullets_timer <= 0.0 && player2_fire_bullets_timer <= 0.0 )
        break;
      type_id = 45;
    }
    highscore_record_shots_fired = v5;
  }
  v6 = 0;
  v7 = projectile_pool;
  while ( *v7 )
  {
    v7 += 64;
    ++v6;
    if ( (int)v7 >= (int)particle_pool )
    {
      result = 95;
      goto LABEL_16;
    }
  }
  result = v6;
LABEL_16:
  v9 = &projectile_pool[64 * result];
  *((_DWORD *)v9 + 15) = owner_id;
  *v9 = 1;
  *((_DWORD *)v9 + 14) = weapon_projectile_meta[31 * type_id];
  *((float *)v9 + 2) = *pos;
  *((float *)v9 + 3) = pos[1];
  *((float *)v9 + 4) = *pos;
  *((float *)v9 + 5) = pos[1];
  *((float *)v9 + 1) = angle;
  *((_DWORD *)v9 + 8) = type_id;
  *((_DWORD *)v9 + 9) = 1053609165;
  *((_DWORD *)v9 + 10) = 0;
  *((_DWORD *)v9 + 11) = 1065353216;
  *((float *)v9 + 6) = cos(angle) * 1.5;
  *((float *)v9 + 7) = sin(angle) * 1.5;
  switch ( type_id )
  {
    case 22:
      *((_DWORD *)v9 + 13) = 1077936128;
      *((_DWORD *)v9 + 12) = 1065353216;
      return result;
    case 21:
      *((_DWORD *)v9 + 13) = 1084227584;
      *((_DWORD *)v9 + 12) = 1065353216;
      return result;
    case 23:
    case 28:
      *((_DWORD *)v9 + 13) = 1092616192;
      break;
    default:
      *((_DWORD *)v9 + 13) = 1065353216;
      switch ( type_id )
      {
        case 6:
          *((_DWORD *)v9 + 12) = 1133903872;
          return result;
        case 45:
          *((_DWORD *)v9 + 12) = 1131413504;
          return result;
        case 25:
          *((_DWORD *)v9 + 12) = 1112014848;
          return result;
      }
      break;
  }
  *((_DWORD *)v9 + 12) = 1065353216;
  return result;
}

// projectile_reset_pools @ 0x004205D0
// clears projectile and effect pools (DAT_004926b8, DAT_00493eb8)
void projectile_reset_pools()
{
  char *v0; // eax
  char *v1; // eax

  v0 = projectile_pool;
  do
  {
    *v0 = 0;
    v0 += 64;
  }
  while ( (int)v0 < (int)particle_pool );
  v1 = particle_pool;
  do
  {
    *v1 = 0;
    v1 += 56;
  }
  while ( (int)v1 < (int)&dword_495AB8 );
}

// creatures_apply_radius_damage @ 0x00420600
// applies damage to creatures within radius using FUN_004207c0
void creatures_apply_radius_damage(float *pos, float radius, float damage, int damage_type)
{
  int v4; // edi
  char *v5; // esi
  double v6; // st5
  double v7; // st7
  double v8; // st5
  float impulse[2]; // [esp+10h] [ebp-8h] BYREF

  impulse[0] = 0.0;
  impulse[1] = 0.0;
  v4 = 0;
  v5 = creature_pool;
  do
  {
    if ( *v5 )
    {
      v6 = *((float *)v5 + 5) - *pos;
      v7 = v6 * v6;
      v8 = *((float *)v5 + 6) - pos[1];
      if ( *((float *)v5 + 13) * 0.14285715 + 3.0 > sqrt(v7 + v8 * v8) - radius && *((float *)v5 + 4) > 5.0 )
        creature_apply_damage(v4, damage, damage_type, impulse);
    }
    v5 += 152;
    ++v4;
  }
  while ( (int)v5 < (int)byte_4AA338 );
}

// creature_find_in_radius @ 0x004206A0
// returns the first creature index in range, or -1
int creature_find_in_radius(float *pos, float radius, int start_index)
{
  int v3; // edx
  int v4; // ecx
  double v5; // st5
  double v6; // st7
  double v7; // st5

  v3 = start_index;
  if ( start_index >= 384 )
    return -1;
  v4 = 152 * start_index + 4833080;
  while ( 1 )
  {
    if ( *(_BYTE *)v4 )
    {
      v5 = *(float *)(v4 + 20) - *pos;
      v6 = v5 * v5;
      v7 = *(float *)(v4 + 24) - pos[1];
      if ( *(float *)(v4 + 52) * 0.14285715 + 3.0 > sqrt(v6 + v7 * v7) - radius && *(float *)(v4 + 16) > 5.0 )
        break;
    }
    v4 += 152;
    ++v3;
    if ( v4 >= (int)byte_4AA338 )
      return -1;
  }
  return v3;
}

// player_find_in_radius @ 0x00420730
// returns a player index in range, skipping owner_id (-1/-2/-3 -> player 0/1/2)
int player_find_in_radius(int owner_id, float *pos, float radius)
{
  int v3; // ecx
  float *i; // edx
  double v5; // st5
  double v6; // st7
  double v7; // st5

  v3 = 0;
  if ( config_player_count <= 0 )
    return -1;
  for ( i = (float *)player_health; ; i += 216 )
  {
    if ( v3 != -1 - owner_id && *i > 0.0 )
    {
      v5 = *(i - 4) - *pos;
      v6 = v5 * v5;
      v7 = *(i - 3) - pos[1];
      if ( i[4] * 0.14285715 + 3.0 > sqrt(v6 + v7 * v7) - radius )
        break;
    }
    if ( ++v3 >= config_player_count )
      return -1;
  }
  return v3;
}

// creature_apply_damage @ 0x004207C0
// applies damage + impulse, handles death side effects; returns 1 when killed
int creature_apply_damage(int creature_id, float damage, int damage_type, float *impulse)
{
  int v6; // edx
  int v20; // edi
  int v21; // ecx
  int creature_ida; // [esp+20h] [ebp+4h]
  int damagea; // [esp+24h] [ebp+8h]
  int damageb; // [esp+24h] [ebp+8h]
  int damagec; // [esp+24h] [ebp+8h]
  int damaged; // [esp+24h] [ebp+8h]

  _ESI = 152 * creature_id;
  creature_hit_flash_timer[38 * creature_id] = 1045220557;
  if ( damage_type == 1 )
  {
    if ( perk_count_get(perk_id_uranium_filled_bullets) )
    {
      __asm
      {
        fld     [esp+1Ch+damage]
        fadd    st, st
        fstp    [esp+1Ch+damage]
      }
    }
    if ( perk_count_get(perk_id_living_fortress) )
    {
      v6 = config_player_count;
      if ( config_player_count > 0 )
      {
        __asm { fld     [esp+1Ch+damage] }
        _ECX = (char *)&player_living_fortress_timer;
        do
        {
          __asm
          {
            fld     dword ptr [ecx-80h]
            fcomp   ds:flt_46F228
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
          {
            __asm
            {
              fld     dword ptr [ecx]
              fmul    ds:flt_46F3B8
              fadd    ds:flt_46F224
              fmulp   st(1), st
            }
          }
          _ECX += 864;
          --v6;
        }
        while ( v6 );
        __asm { fstp    [esp+1Ch+damage] }
      }
    }
    if ( perk_count_get(perk_id_barrel_greaser) )
    {
      __asm
      {
        fld     [esp+1Ch+damage]
        fmul    ds:flt_46F308
        fstp    [esp+1Ch+damage]
      }
    }
    if ( perk_count_get(perk_id_doctor) )
    {
      __asm
      {
        fld     [esp+1Ch+damage]
        fmul    ds:flt_46F5F4
        fstp    [esp+1Ch+damage]
      }
    }
    if ( (creature_flags[38 * creature_id] & 4) == 0 )
    {
      creature_ida = (crt_rand() & 0x7F) - 64;
      __asm
      {
        fild    [esp+1Ch+creature_id]
        fmul    ds:flt_46F3B4
        fld     dword ptr [esi+49BF6Ch]
        fmul    ds:flt_46F5F0
        fdivp   st(1), st
        fcom    ds:flt_46F220
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
      {
        __asm
        {
          fstp    st
          fld     ds:flt_46F220
        }
      }
      __asm
      {
        fadd    dword ptr [esi+49BF64h]
        fstp    dword ptr [esi+49BF64h]
      }
      *(float *)(_ESI + 4833124) = _ET1;
    }
  }
  else if ( damage_type == 7 && perk_count_get(perk_id_ion_gun_master) )
  {
    __asm
    {
      fld     [esp+1Ch+damage]
      fmul    ds:flt_46F5F4
      fstp    [esp+1Ch+damage]
    }
  }
  __asm
  {
    fld     dword ptr [esi+49BF5Ch]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) != 0 )
  {
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F360
      fsubr   dword ptr [esi+49BF48h]
      fstp    dword ptr [esi+49BF48h]
    }
    *(float *)(_ESI + 4833096) = _ET1;
  }
  else
  {
    if ( damage_type == 4 && perk_count_get(perk_id_pyromaniac) )
    {
      __asm
      {
        fld     [esp+1Ch+damage]
        fmul    ds:flt_46F338
        fstp    [esp+1Ch+damage]
      }
      crt_rand();
    }
    __asm
    {
      fld     dword ptr [esi+49BF5Ch]
      fsub    [esp+1Ch+damage]
    }
    _EBX = impulse;
    __asm { fstp    dword ptr [esi+49BF5Ch] }
    *(float *)(_ESI + 4833116) = _ET1;
    __asm
    {
      fld     dword ptr [esi+49BF54h]
      fsub    dword ptr [ebx]
      fstp    dword ptr [esi+49BF54h]
    }
    *(float *)(_ESI + 4833108) = _ET1;
    __asm
    {
      fld     dword ptr [esi+49BF58h]
      fsub    dword ptr [ebx+4]
      fstp    dword ptr [esi+49BF58h]
    }
    *(float *)(_ESI + 4833112) = _ET1;
    __asm
    {
      fld     dword ptr [esi+49BF5Ch]
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
      __asm
      {
        fld     dword ptr [esi+49BF48h]
        fsub    frame_dt
      }
      __asm { fstp    dword ptr [esi+49BF48h] }
      *(float *)(_ESI + 4833096) = _ET1;
      creature_handle_death(creature_id, 1);
      __asm
      {
        fld     dword ptr [ebx]
        fadd    st, st
        fld     dword ptr [ebx+4]
        fadd    st, st
      }
      __asm
      {
        fstp    [esp+1Ch+var_C]
        fld     dword ptr [esi+49BF54h]
        fsub    st, st(1)
        fstp    dword ptr [esi+49BF54h]
      }
      *(float *)(_ESI + 4833108) = _ET1;
      __asm
      {
        fstp    st
        fld     dword ptr [esi+49BF58h]
        fsub    [esp+1Ch+var_C]
        fstp    dword ptr [esi+49BF58h]
      }
      *(float *)(_ESI + 4833112) = _ET1;
      if ( (creature_flags[_ESI / 4u] & 0x10) != 0 )
      {
        effect_template_color_r = 1061997773;
        effect_template_flags = 29;
        effect_template_color_g = 1061997773;
        effect_template_color_b = 1050253722;
        effect_template_color_a = 1056964608;
        effect_template_lifetime = 1060320051;
        effect_template_half_width = 1108344832;
        effect_template_half_height = 1108344832;
        v20 = 5;
        do
        {
          damagea = crt_rand() & 0x7F;
          __asm
          {
            fild    [esp+1Ch+damage]
            fmul    ds:flt_46F370
            fstp    effect_template_rotation
          }
          damageb = (crt_rand() & 0x7F) - 64;
          __asm
          {
            fild    [esp+1Ch+damage]
            fstp    effect_template_vel_x
          }
          damagec = (crt_rand() & 0x7F) - 64;
          __asm
          {
            fild    [esp+1Ch+damage]
            fstp    effect_template_vel_y
          }
          damaged = crt_rand() % 140;
          __asm
          {
            fild    [esp+24h+damage]
            fmul    ds:flt_46F300
            fadd    ds:flt_46F258
            fstp    effect_template_scale_step
          }
          effect_spawn(0, (float *)((char *)&creature_pos_x + _ESI));
          --v20;
        }
        while ( v20 );
      }
      else
      {
        v21 = crt_rand() % 4;
        sfx_play_panned(*(&creature_type_sfx_a0 + 17 * *(int *)((char *)&creature_type_id + _ESI) + v21));
      }
    }
  }
  __asm
  {
    fld     dword ptr [esi+49BF5Ch]
    fcomp   ds:flt_46F228
  }
  __asm { fnstsw  ax }
  return (_AX & 0x4100) != 0;
}

// projectile_update @ 0x00420B90
// updates projectile movement, collisions, and hit effects
void projectile_update()
{
  int v3; // eax
  int v11; // eax
  int v12; // ebx
  int v13; // ecx
  float v14; // ebx
  int v16; // eax
  int v17; // ebp
  int v18; // eax
  int v19; // ebx
  int v20; // ebx
  int v22; // ebx
  int v24; // ebp
  int v25; // eax
  int v29; // eax
  int nearest; // eax
  int v33; // ebp
  int v43; // ecx
  int v44; // eax
  int v47; // ebp
  int v52; // eax
  int v53; // ebp
  int v61; // ebx
  int v67; // eax
  int v82; // eax
  int v83; // ebp
  int v86; // eax
  int v87; // eax
  int v89; // edi
  int v90; // ebp
  int v92; // edi
  int v93; // ebp
  float *v95; // ebp
  int v96; // edi
  int v97; // ebp
  int v98; // edi
  char wYear; // cl
  int v119; // eax
  int v120; // eax
  int v131; // ebx
  float v132; // edx
  int v149; // eax
  float radius; // [esp+8h] [ebp-110h]
  float radiusa; // [esp+8h] [ebp-110h]
  float radiusb; // [esp+8h] [ebp-110h]
  float radiusc; // [esp+8h] [ebp-110h]
  float radiusd; // [esp+8h] [ebp-110h]
  float radiuse; // [esp+8h] [ebp-110h]
  float radiusf; // [esp+8h] [ebp-110h]
  float damage; // [esp+Ch] [ebp-10Ch]
  float damagea; // [esp+Ch] [ebp-10Ch]
  float damageb; // [esp+Ch] [ebp-10Ch]
  float damagec; // [esp+Ch] [ebp-10Ch]
  float damaged; // [esp+Ch] [ebp-10Ch]
  float damagee; // [esp+Ch] [ebp-10Ch]
  float damagef; // [esp+Ch] [ebp-10Ch]
  float v180; // [esp+10h] [ebp-108h]
  float v181; // [esp+10h] [ebp-108h]
  float v182; // [esp+10h] [ebp-108h]
  float v183; // [esp+10h] [ebp-108h]
  float v184; // [esp+10h] [ebp-108h]
  float v185; // [esp+10h] [ebp-108h]
  float wb; // [esp+24h] [ebp-F4h]
  int wc; // [esp+24h] [ebp-F4h]
  int wd; // [esp+24h] [ebp-F4h]
  int we; // [esp+24h] [ebp-F4h]
  int wf; // [esp+24h] [ebp-F4h]
  int wg; // [esp+24h] [ebp-F4h]
  int wh; // [esp+24h] [ebp-F4h]
  int wi; // [esp+24h] [ebp-F4h]
  int wj; // [esp+24h] [ebp-F4h]
  int wk; // [esp+24h] [ebp-F4h]
  int wl; // [esp+24h] [ebp-F4h]
  int wm; // [esp+24h] [ebp-F4h]
  int wn; // [esp+24h] [ebp-F4h]
  int wo; // [esp+24h] [ebp-F4h]
  int wp; // [esp+24h] [ebp-F4h]
  int wq; // [esp+24h] [ebp-F4h]
  int wr; // [esp+24h] [ebp-F4h]
  int ws; // [esp+24h] [ebp-F4h]
  int wt; // [esp+24h] [ebp-F4h]
  int wu; // [esp+24h] [ebp-F4h]
  int wv; // [esp+24h] [ebp-F4h]
  int ww; // [esp+24h] [ebp-F4h]
  int wx; // [esp+24h] [ebp-F4h]
  int wy; // [esp+24h] [ebp-F4h]
  int v212; // [esp+28h] [ebp-F0h]
  int v213; // [esp+28h] [ebp-F0h]
  int v214; // [esp+28h] [ebp-F0h]
  int v215; // [esp+28h] [ebp-F0h]
  int v216; // [esp+28h] [ebp-F0h]
  int v217; // [esp+28h] [ebp-F0h]
  int v218; // [esp+28h] [ebp-F0h]
  int v220; // [esp+28h] [ebp-F0h]
  int v221; // [esp+28h] [ebp-F0h]
  int v222; // [esp+28h] [ebp-F0h]
  int v223; // [esp+28h] [ebp-F0h]
  int v224; // [esp+2Ch] [ebp-ECh]
  int v225; // [esp+2Ch] [ebp-ECh]
  int v226; // [esp+2Ch] [ebp-ECh]
  float v227; // [esp+2Ch] [ebp-ECh]
  int v228; // [esp+2Ch] [ebp-ECh]
  int v229; // [esp+2Ch] [ebp-ECh]
  int v230; // [esp+2Ch] [ebp-ECh]
  int v231; // [esp+2Ch] [ebp-ECh]
  int v232; // [esp+2Ch] [ebp-ECh]
  float v233; // [esp+2Ch] [ebp-ECh]
  int i; // [esp+30h] [ebp-E8h]
  int v238; // [esp+30h] [ebp-E8h]
  int angle; // [esp+34h] [ebp-E4h]
  float angleb; // [esp+34h] [ebp-E4h]
  int v244; // [esp+3Ch] [ebp-DCh]
  float v245; // [esp+3Ch] [ebp-DCh]
  int v246; // [esp+40h] [ebp-D8h]
  float v248; // [esp+40h] [ebp-D8h]
  int v253; // [esp+48h] [ebp-D0h]
  int v254; // [esp+48h] [ebp-D0h]
  int v255; // [esp+48h] [ebp-D0h]
  float arg2; // [esp+4Ch] [ebp-CCh] BYREF
  float v257; // [esp+50h] [ebp-C8h]
  float v258; // [esp+54h] [ebp-C4h]
  float v259; // [esp+58h] [ebp-C0h] BYREF
  int v260; // [esp+5Ch] [ebp-BCh]
  float v261; // [esp+60h] [ebp-B8h] BYREF
  float vel; // [esp+68h] [ebp-B0h] BYREF
  float v264; // [esp+6Ch] [ebp-ACh]
  float delta; // [esp+70h] [ebp-A8h] BYREF
  float v266; // [esp+74h] [ebp-A4h]
  float v267; // [esp+78h] [ebp-A0h] BYREF
  float v269; // [esp+80h] [ebp-98h] BYREF
  float v271; // [esp+88h] [ebp-90h] BYREF
  float v273; // [esp+90h] [ebp-88h] BYREF
  float v275; // [esp+98h] [ebp-80h] BYREF
  float impulse; // [esp+A0h] [ebp-78h] BYREF
  float v279; // [esp+A8h] [ebp-70h] BYREF
  float v281; // [esp+B0h] [ebp-68h]
  int v282; // [esp+B4h] [ebp-64h]
  int v283; // [esp+B8h] [ebp-60h]
  int v284; // [esp+BCh] [ebp-5Ch]
  float v288; // [esp+D0h] [ebp-48h] BYREF
  float pos; // [esp+F8h] [ebp-20h] BYREF
  float rgba[4]; // [esp+108h] [ebp-10h] BYREF

  ++dword_4AAF54;
  v259 = 1.0;
  if ( perk_count_get(perk_id_ion_gun_master) )
    v259 = 1.2;
  for ( i = 0; i < 96; ++i )
  {
    _ESI = &projectile_pool[64 * i];
    if ( !*_ESI )
      continue;
    __asm
    {
      fld     dword ptr [esi+24h]
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
      *_ESI = 0;
    __asm
    {
      fld     dword ptr [esi+24h]
      fcomp   ds:flt_46F324
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
    {
      v3 = *((_DWORD *)_ESI + 8);
      switch ( v3 )
      {
        case 21:
        case 22:
          if ( i == shock_chain_projectile_id )
          {
            shock_chain_projectile_id = -1;
            shock_chain_links_left = 0;
          }
          __asm
          {
            fld     dword ptr [esi+24h]
            fsub    frame_dt
          }
          __asm { fstp    dword ptr [esi+24h] }
          *((float *)_ESI + 9) = _ET1;
          __asm { fld     frame_dt }
          if ( v3 == 21 )
          {
            __asm { fmul    ds:flt_46F2C4 }
            __asm
            {
              fstp    [esp+10Ch+damage]; damage
              fld     [esp+10Ch+var_C0]
              fmul    ds:flt_46F63C
            }
          }
          else
          {
            __asm { fmul    ds:flt_46F2EC }
            __asm
            {
              fstp    [esp+10Ch+damage]
              fld     [esp+10Ch+var_C0]
              fmul    ds:flt_46F384
            }
          }
          goto LABEL_18;
        case 23:
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F334
          }
          __asm
          {
            fsubr   dword ptr [esi+24h]
            fstp    dword ptr [esi+24h]
          }
          *((float *)_ESI + 9) = _ET1;
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F3E0
            fstp    [esp+10Ch+damage]
            fld     [esp+10Ch+var_C0]
            fmul    ds:flt_46F640
          }
LABEL_18:
          __asm { fstp    [esp+110h+radius]; radius }
          creatures_apply_radius_damage((float *)_ESI + 2, radius, damage, 7);
          continue;
        case 6:
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F2FC
            fsubr   dword ptr [esi+24h]
          }
          break;
        default:
LABEL_126:
          __asm
          {
            fld     dword ptr [esi+24h]
            fsub    frame_dt
          }
          break;
      }
      __asm { fstp    dword ptr [esi+24h] }
      *((float *)_ESI + 9) = _ET1;
      continue;
    }
    __asm
    {
      fld     dword ptr [esi+8]
      fcomp   ds:flt_46F638
    }
    _EDI = (float *)(_ESI + 8);
    __asm { fnstsw  ax }
    if ( (_AX & 0x100) != 0 )
      goto LABEL_126;
    __asm
    {
      fld     dword ptr [esi+0Ch]
      fcomp   ds:flt_46F638
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
      goto LABEL_126;
    v224 = terrain_texture_width + 64;
    __asm
    {
      fild    [esp+104h+var_EC]
      fcomp   dword ptr [edi]
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
      goto LABEL_126;
    v225 = terrain_texture_height + 64;
    __asm
    {
      fild    [esp+104h+var_EC]
      fcomp   dword ptr [esi+0Ch]
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
      goto LABEL_126;
    __asm { fld     dword ptr [esi+38h] }
    v11 = _ftol();
    __asm
    {
      fld     dword ptr [esi+4]
      fsub    ds:flt_46F220
    }
    v12 = v11;
    v244 = v11;
    __asm
    {
      fld     st
      fcos
      fmul    frame_dt
      fmul    ds:flt_46F2B4
      fstp    [esp+108h+var_D0]
      fsin
      fmul    frame_dt
      fmul    ds:flt_46F2B4
      fstp    [esp+108h+w]
    }
    if ( perk_count_get(perk_id_barrel_greaser) && *((int *)_ESI + 15) < 0 )
    {
      __asm
      {
        fild    [esp+104h+var_DC]
        fadd    st, st
      }
      v12 = _ftol();
      v244 = v12;
    }
    v257 = 0.0;
    arg2 = 0.0;
    v258 = 0.0;
    if ( v12 > 0 )
    {
      v13 = v244;
      v14 = v258;
      do
      {
        __asm
        {
          fld     [esp+104h+var_D0]
          fmul    dword ptr [esi+2Ch]
          fmul    ds:flt_46F248
          fadd    [esp+104h+arg2]
          fstp    [esp+104h+arg2]
          fld     [esp+104h+w]
          fmul    dword ptr [esi+2Ch]
          fmul    ds:flt_46F248
          fadd    [esp+104h+var_C8]
          fstp    [esp+104h+var_C8]
          fld     [esp+104h+arg2]
          fmul    [esp+104h+arg2]
          fld     [esp+104h+var_C8]
          fmul    [esp+104h+var_C8]
          faddp   st(1), st
          fsqrt
          fcomp   ds:flt_46F25C
          fnstsw  ax
        }
        if ( (_AX & 0x100) == 0 || LODWORD(v14) + 3 >= v13 )
        {
          FUN_0041e270((float *)_ESI + 2, &arg2);
          v16 = creature_find_in_radius((float *)_ESI + 2, *((float *)_ESI + 13), 0);
          v17 = v16;
          v226 = v16;
          if ( v16 == -1 || v16 == *((_DWORD *)_ESI + 15) )
          {
            if ( i != shock_chain_projectile_id )
            {
              v52 = *((_DWORD *)_ESI + 15);
              if ( v52 != -100 )
                v17 = player_find_in_radius(v52, (float *)_ESI + 2, *((float *)_ESI + 13));
              if ( v17 != -1 )
              {
                v53 = 3 * v17;
                *((_DWORD *)_ESI + 9) = 1048576000;
                _ECX = 288 * v53;
                __asm
                {
                  fld     dword ptr [ecx+490BC8h]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x4100) != 0 )
                {
                  __asm
                  {
                    fld     dword ptr [ecx+4908D4h]
                    fsub    ds:flt_46F260
                    fstp    dword ptr [ecx+4908D4h]
                  }
                  player_health[72 * v53] = _ET1;
                }
              }
            }
          }
          else
          {
            if ( perk_count_get(perk_id_poison_bullets) && (crt_rand() & 7) == 1 )
              creature_flags[38 * v17] |= 1u;
            v18 = *((_DWORD *)_ESI + 8);
            if ( v18 == 25 )
            {
              v19 = 8;
              do
              {
                v212 = (unsigned __int8)crt_rand();
                __asm
                {
                  fild    [esp+10Ch+var_F0]
                  fmul    ds:flt_46F634
                  fstp    [esp+10Ch+damage]; angle
                }
                effect_spawn_blood_splatter((float *)_ESI + 2, damagea, 0.0);
                --v19;
              }
              while ( v19 );
            }
            else if ( v18 == 29 )
            {
              FUN_0042f3f0((float *)_ESI + 2, 26.0, COERCE_FLOAT(3));
              __asm
              {
                fld     dword ptr [esi+4]
                fsub    ds:flt_46F4E4
              }
              __asm { fstp    [esp+110h+radius]; angle }
              projectile_spawn((float *)_ESI + 2, radiusa, 29, v17);
              __asm
              {
                fld     dword ptr [esi+4]
                fadd    ds:flt_46F4E4
              }
              __asm { fstp    [esp+110h+radius]; angle }
              projectile_spawn((float *)_ESI + 2, radiusb, 29, v17);
            }
            v282 = 1065353216;
            v281 = 1.0;
            effect_template_color_g = 1065353216;
            v283 = 1065353216;
            v284 = 1065353216;
            effect_template_color_r = 1065353216;
            effect_template_flags = 89;
            effect_template_color_b = 1065353216;
            effect_template_color_a = 1065353216;
            effect_template_lifetime = 1051931443;
            effect_template_age = 0;
            effect_template_half_width = 1082130432;
            effect_template_half_height = 1082130432;
            if ( !config_fx_toggle )
            {
              if ( perk_count_get(perk_id_bloody_mess_quick_learner) )
              {
                v20 = 8;
                do
                {
                  v213 = (crt_rand() & 0x1F) - 16;
                  __asm
                  {
                    fild    [esp+10Ch+var_F0]
                    fmul    ds:flt_46F5E0
                    fld     dword ptr [esi+4]
                    fsub    ds:flt_46F220
                    faddp   st(1), st
                    fstp    [esp+10Ch+damage]; angle
                  }
                  effect_spawn_blood_splatter((float *)_ESI + 2, damageb, 0.0);
                  --v20;
                }
                while ( v20 );
                __asm
                {
                  fld     dword ptr [esi+4]
                  fsub    ds:flt_46F220
                }
                __asm
                {
                  fadd    ds:flt_46F378
                  fstp    [esp+10Ch+damage]; angle
                }
                effect_spawn_blood_splatter((float *)_ESI + 2, damagec, 0.0);
              }
              else
              {
                __asm
                {
                  fld     bonus_freeze_timer
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x4100) != 0 )
                {
                  v22 = 2;
                  do
                  {
                    __asm
                    {
                      fld     dword ptr [esi+4]
                      fsub    ds:flt_46F220
                    }
                    __asm { fstp    [esp+10Ch+damage]; angle }
                    effect_spawn_blood_splatter((float *)_ESI + 2, damaged, 0.0);
                    if ( (crt_rand() & 7) == 2 )
                    {
                      __asm
                      {
                        fld     dword ptr [esi+4]
                        fsub    ds:flt_46F220
                      }
                      __asm
                      {
                        fadd    ds:flt_46F378
                        fstp    [esp+10Ch+damage]; angle
                      }
                      effect_spawn_blood_splatter((float *)_ESI + 2, damagee, 0.0);
                    }
                    --v22;
                  }
                  while ( v22 );
                }
              }
            }
            _EBX = 152 * v17;
            if ( creature_hitbox_size[38 * v17] == 1098907648 )
              ++highscore_record_shots_hit;
            if ( perk_count_get(perk_id_bloody_mess_quick_learner) )
            {
              v246 = 30;
              v24 = -30;
              do
              {
                v214 = v24 + crt_rand() % (v246 - v24);
                __asm
                {
                  fild    [esp+104h+var_F0]
                  fstp    [esp+104h+var_58]
                }
                v215 = v24 + crt_rand() % (v246 - v24);
                __asm
                {
                  fild    [esp+108h+var_F0]
                  fld     [esp+108h+var_58]
                  fadd    dword ptr [ebx+49BF4Ch]
                  fstp    [esp+108h+pos]
                  fadd    dword ptr [ebx+49BF50h]
                  fstp    [esp+108h+var_1C]
                }
                fx_queue_add_random(&pos);
                v216 = v24 + crt_rand() % (v246 - v24);
                __asm
                {
                  fild    [esp+108h+var_F0]
                  fstp    [esp+108h+var_28]
                }
                v217 = v24 + crt_rand() % (v246 - v24);
                __asm
                {
                  fild    [esp+10Ch+var_F0]
                  fld     [esp+10Ch+var_28]
                  fadd    dword ptr [ebx+49BF4Ch]
                  fstp    [esp+10Ch+var_48]
                  fadd    dword ptr [ebx+49BF50h]
                  fstp    [esp+10Ch+var_44]
                }
                fx_queue_add_random(&v288);
                v24 -= 10;
                v246 += 10;
              }
              while ( v24 > -60 );
              v17 = v226;
            }
            v25 = *((_DWORD *)_ESI + 8);
            if ( v25 != 45 && v25 != 6 && v25 != 25 )
            {
              *((_DWORD *)_ESI + 9) = 1048576000;
              v218 = crt_rand() & 3;
              __asm
              {
                fild    [esp+104h+var_F0]
                fld     dword ptr [esi+4]
                fsub    ds:flt_46F220
                fld     st
                fcos
                fmul    st, st(2)
                fadd    dword ptr [edi]
                fstp    dword ptr [edi]
              }
              *_EDI = _ET1;
              __asm
              {
                fsin
                fmul    st, st(1)
                fadd    dword ptr [esi+0Ch]
                fstp    dword ptr [esi+0Ch]
              }
              *((float *)_ESI + 3) = _ET1;
              __asm { fstp    st }
            }
            __asm
            {
              fld     dword ptr [esi+10h]
              fsub    dword ptr [edi]
              fld     dword ptr [esi+14h]
              fsub    dword ptr [edi+4]
              fld     st
              fmul    st, st(1)
              fld     st(2)
              fmul    st, st(3)
              faddp   st(1), st
              fsqrt
              fstp    st(2)
              fstp    st
              fcom    ds:flt_46F2BC
              fnstsw  ax
            }
            if ( (_AX & 0x100) != 0 )
            {
              __asm
              {
                fstp    st
                fld     ds:flt_46F2BC
              }
            }
            __asm
            {
              fld     ds:flt_46F2C4
              fdiv    st, st(1)
            }
            v29 = *((_DWORD *)_ESI + 8);
            _EDX = 31 * v29;
            __asm
            {
              fmul    weapon_projectile_damage_scale[edx*4]
              fmul    ds:flt_46F4B0
              fadd    ds:flt_46F260
              fstp    [esp+104h+var_D8]
              fstp    st
            }
            switch ( v29 )
            {
              case 22:
                FUN_0042f270((float *)_ESI + 2, 1.5, 0.1);
                FUN_0042f540((int)(_ESI + 8), 0.80000001);
                break;
              case 21:
                if ( shock_chain_links_left > 0 && i == shock_chain_projectile_id )
                {
                  --shock_chain_links_left;
                  nearest = creature_find_nearest((float *)_ESI + 2, v17, 100.0);
                  bonus_spawn_guard = 1;
                  _EDX = 19 * nearest;
                  __asm
                  {
                    fld     creature_pos_x[edx*8]
                    fsub    dword ptr [ebx+49BF4Ch]
                    fld     creature_pos_y[edx*8]
                  }
                  __asm
                  {
                    fsub    dword ptr [ebx+49BF50h]
                    fxch    st(1)
                    fpatan
                    fsub    ds:flt_46F220
                    fsub    ds:flt_46F378
                    fstp    [esp+110h+radius]; angle
                  }
                  shock_chain_projectile_id = projectile_spawn((float *)_ESI + 2, radiusc, 21, v17);
                  bonus_spawn_guard = 0;
                }
                FUN_0042f270((float *)_ESI + 2, 1.2, 0.40000001);
                FUN_0042f540((int)(_ESI + 8), 1.2);
                break;
              case 23:
                FUN_0042f270((float *)_ESI + 2, 1.0, 1.0);
                FUN_0042f540((int)(_ESI + 8), 2.2);
                sfx_play_panned(sfx_shockwave);
                break;
              case 28:
                __asm
                {
                  fld     dword ptr [ebx+49BF6Ch]
                  fmul    ds:flt_46F24C
                }
                v33 = 0;
                bonus_spawn_guard = 1;
                angle = 0;
                __asm
                {
                  fadd    ds:flt_46F224
                  fstp    [esp+104h+var_F0]
                }
                do
                {
                  __asm { fild    [esp+104h+angle] }
                  __asm
                  {
                    fmul    ds:flt_46F4EC
                    fst     [esp+10Ch+angle]
                    fcos
                  }
                  __asm
                  {
                    fmul    [esp+114h+var_F0]
                    fld     [esp+114h+angle]
                    fsin
                    fmul    [esp+114h+var_F0]
                    fstp    [esp+114h+var_34]
                    fadd    dword ptr [edi]
                    fstp    [esp+114h+var_88]
                    fld     [esp+114h+var_34]
                    fadd    dword ptr [edi+4]
                    fstp    [esp+114h+var_84]
                  }
                  projectile_spawn(&v273, angleb, 9, -100);
                  angle = ++v33;
                }
                while ( v33 < 12 );
                bonus_spawn_guard = 0;
                sfx_play_panned(sfx_explosion_medium);
                sfx_play_panned(sfx_shockwave);
                FUN_0042f330((float *)_ESI + 2, 1.5, 1065353216);
                FUN_0042f330((float *)_ESI + 2, 1.0, 1065353216);
                v17 = v226;
                break;
              case 24:
                FUN_0042f080((float *)_ESI + 2);
                __asm
                {
                  fld     dword ptr [ebx+49BF6Ch]
                  fmul    ds:flt_46F630
                }
                *((_DWORD *)_ESI + 9) = 1048576000;
                __asm { fst     dword ptr [ebx+49BF6Ch] }
                *(float *)(_EBX + 4833132) = _ET1;
                __asm
                {
                  fcomp   ds:flt_46F230
                  fnstsw  ax
                }
                if ( (_AX & 0x100) != 0 )
                  creature_handle_death(v17, 1);
                break;
              case 19:
                __asm
                {
                  fld     [esp+104h+arg2]
                  fmul    ds:flt_46F248
                  fld     [esp+104h+var_C8]
                  fmul    ds:flt_46F248
                  fstp    [esp+104h+var_14]
                  fadd    dword ptr [ebx+49BF4Ch]
                  fstp    dword ptr [ebx+49BF4Ch]
                }
                *(float *)(_EBX + 4833100) = _ET1;
                __asm
                {
                  fld     [esp+104h+var_14]
                  fadd    dword ptr [ebx+49BF50h]
                  fstp    dword ptr [ebx+49BF50h]
                }
                *(float *)(_EBX + 4833104) = _ET1;
                break;
              case 41:
                creature_collision_flag[_EBX] = 1;
                break;
            }
            __asm
            {
              fld     [esp+104h+var_D8]
              fmul    ds:flt_46F62C
              fst     [esp+104h+var_D8]
              fcomp   ds:flt_46F228
              fnstsw  ax
            }
            if ( (_AX & 0x4100) == 0 )
            {
              __asm
              {
                fld     dword ptr [ebx+49BF5Ch]
                fcomp   ds:flt_46F228
                fnstsw  ax
              }
              if ( (_AX & 0x4100) == 0 )
              {
                __asm
                {
                  fld     dword ptr [esi+30h]
                  fsub    ds:flt_46F224
                  fst     [esp+104h+var_EC]
                  fst     dword ptr [esi+30h]
                }
                *((float *)_ESI + 12) = _ET1;
                __asm
                {
                  fcomp   ds:flt_46F228
                  fld     dword ptr [esi+4]
                  fsub    ds:flt_46F220
                  fnstsw  ax
                  fcos
                }
                __asm
                {
                  fld     st
                  fmul    dword ptr [esi+2Ch]
                }
                if ( (_AX & 0x4100) != 0 )
                {
                  __asm { fstp    [esp+104h+var_98] }
                  __asm { fmul    dword ptr [esi+2Ch] }
                  __asm { fstp    [esp+114h+var_94] }
                  creature_apply_damage(v17, v248, 1, &v269);
                  if ( *((_DWORD *)_ESI + 9) != 1048576000 )
                    *((_DWORD *)_ESI + 9) = 1048576000;
                }
                else
                {
                  __asm { fstp    [esp+104h+impulse] }
                  __asm { fmul    dword ptr [esi+2Ch] }
                  __asm { fstp    [esp+114h+var_74] }
                  creature_apply_damage(v17, v227, 1, &impulse);
                  __asm
                  {
                    fld     dword ptr [esi+30h]
                    fsub    dword ptr [ebx+49BF5Ch]
                  }
                  __asm { fstp    dword ptr [esi+30h] }
                  *((float *)_ESI + 12) = _ET1;
                }
              }
            }
            if ( *((_DWORD *)_ESI + 12) == 1065353216 )
            {
              v43 = *((_DWORD *)_ESI + 9);
              *((_DWORD *)_ESI + 12) = 0;
              if ( v43 != 1048576000 )
                *((_DWORD *)_ESI + 9) = 1048576000;
            }
            creature_state_flag[_EBX] = 1;
            crt_rand();
            v44 = *((_DWORD *)_ESI + 8);
            if ( v44 == 6 || v44 == 45 )
            {
              perk_count_get(perk_id_bloody_mess_quick_learner);
              v230 = 6;
              do
              {
                v220 = crt_rand() % 100;
                __asm
                {
                  fild    [esp+104h+var_F0]
                  fmul    ds:flt_46F628
                  fcom    ds:flt_46F25C
                  fnstsw  ax
                }
                if ( (_AX & 0x4100) == 0 )
                {
                  __asm { fstp    st }
                  v221 = crt_rand() % 90 + 10;
                  __asm
                  {
                    fild    [esp+104h+var_F0]
                    fmul    ds:flt_46F628
                  }
                }
                __asm
                {
                  fcom    ds:flt_46F278
                  fnstsw  ax
                }
                if ( (_AX & 0x4100) == 0 )
                {
                  __asm { fstp    st }
                  v222 = crt_rand() % 80 + 20;
                  __asm
                  {
                    fild    [esp+104h+var_F0]
                    fmul    ds:flt_46F628
                  }
                }
                __asm
                {
                  fld     dword ptr [esi+4]
                  fsub    ds:flt_46F220
                }
                __asm
                {
                  fld     st
                  fcos
                }
                delta = 0.0;
                v266 = 0.0;
                __asm
                {
                  fmul    st, st(2)
                  fmul    ds:flt_46F2B4
                  fstp    [esp+110h+var_D8]
                  fsin
                  fmul    st, st(1)
                  fmul    ds:flt_46F2B4
                  fstp    [esp+110h+angle]
                  fstp    st
                  fld     [esp+110h+var_D8]
                  fadd    dword ptr [ebx+49BF4Ch]
                  fstp    [esp+110h+vel]
                  fld     [esp+110h+angle]
                  fadd    dword ptr [ebx+49BF50h]
                  fstp    [esp+110h+var_AC]
                }
                vec2_add_inplace(v17, &vel, &delta);
                crt_rand();
                __asm
                {
                  fld     bonus_freeze_timer
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x4100) == 0 )
                {
                  __asm
                  {
                    fld     [esp+104h+var_D8]
                    fadd    dword ptr [edi]
                    fstp    [esp+104h+var_A0]
                    fld     [esp+104h+angle]
                    fadd    dword ptr [edi+4]
                    fstp    [esp+104h+var_9C]
                  }
                  v223 = crt_rand() % 100;
                  __asm
                  {
                    fild    [esp+108h+var_F0]
                    fmul    ds:flt_46F300
                    fld     dword ptr [esi+4]
                    fsub    ds:flt_46F220
                    faddp   st(1), st
                    fstp    [esp+108h+var_108]; angle
                  }
                  effect_spawn_freeze_shard(&v267, v181);
                }
                __asm
                {
                  fld     [esp+104h+var_D8]
                  fadd    dword ptr [ebx+49BF4Ch]
                }
                __asm
                {
                  fstp    [esp+108h+var_B8]
                  fld     [esp+108h+angle]
                  fadd    dword ptr [ebx+49BF50h]
                  fstp    [esp+108h+var_B4]
                }
                fx_queue_add_random(&v261);
                --v230;
              }
              while ( v230 );
            }
            else
            {
              __asm
              {
                fld     bonus_freeze_timer
                fcomp   ds:flt_46F228
                fnstsw  ax
              }
              if ( (_AX & 0x4100) != 0 )
              {
                _EBX = (float *)((char *)&creature_pos_x + _EBX);
                v47 = 3;
                do
                {
                  v229 = crt_rand() % 20 - 10;
                  __asm
                  {
                    fild    [esp+108h+var_EC]
                    fmul    ds:flt_46F628
                    fld     dword ptr [esi+4]
                    fsub    ds:flt_46F220
                    faddp   st(1), st
                    fld     st
                    fcos
                    fmul    ds:flt_46F2B4
                    fstp    [esp+108h+var_D8]
                    fsin
                    fmul    ds:flt_46F2B4
                    fstp    [esp+108h+angle]
                  }
                  fx_queue_add_random(_EBX);
                  __asm
                  {
                    fld     [esp+108h+var_D8]
                    fmul    ds:flt_46F338
                    fld     [esp+108h+angle]
                    fmul    ds:flt_46F338
                  }
                  __asm
                  {
                    fstp    [esp+10Ch+var_4C]
                    fadd    dword ptr [ebx]
                    fstp    [esp+10Ch+var_70]
                    fld     [esp+10Ch+var_4C]
                    fadd    dword ptr [ebx+4]
                    fstp    [esp+10Ch+var_6C]
                  }
                  fx_queue_add_random(&v279);
                  __asm
                  {
                    fld     [esp+10Ch+var_D8]
                    fadd    st, st
                    fld     [esp+10Ch+angle]
                    fadd    st, st
                  }
                  __asm
                  {
                    fstp    [esp+110h+var_3C]
                    fadd    dword ptr [ebx]
                    fstp    [esp+110h+var_80]
                    fld     [esp+110h+var_3C]
                    fadd    dword ptr [ebx+4]
                    fstp    [esp+110h+var_7C]
                  }
                  fx_queue_add_random(&v275);
                  __asm
                  {
                    fld     [esp+110h+var_D8]
                    fmul    ds:flt_46F624
                    fld     [esp+110h+angle]
                    fmul    ds:flt_46F624
                  }
                  __asm
                  {
                    fstp    [esp+114h+var_2C]
                    fadd    dword ptr [ebx]
                    fstp    [esp+114h+var_90]
                    fld     [esp+114h+var_2C]
                    fadd    dword ptr [ebx+4]
                    fstp    [esp+114h+var_8C]
                  }
                  fx_queue_add_random(&v271);
                  --v47;
                }
                while ( v47 );
              }
              else
              {
                v228 = crt_rand() % 100;
                __asm
                {
                  fild    [esp+108h+var_EC]
                  fmul    ds:flt_46F300
                  fld     dword ptr [esi+4]
                  fsub    ds:flt_46F220
                  faddp   st(1), st
                  fstp    [esp+108h+var_108]; angle
                }
                effect_spawn_freeze_shard((float *)_ESI + 2, v180);
              }
            }
            if ( demo_mode_active || byte_4CC8D4 || config_game_mode == 2 )
            {
              if ( weapon_ammo_class[31 * *((_DWORD *)_ESI + 8)] == 4 )
              {
                sfx_play_panned(sfx_shock_hit_01);
              }
              else
              {
                LODWORD(radiusd) = sfx_bullet_hit_01 + crt_rand() % 6;
                sfx_play_panned(radiusd);
              }
            }
            else
            {
              sfx_play_exclusive(music_track_extra_0);
            }
            __asm
            {
              fld     dword ptr [esi+30h]
              fcomp   ds:flt_46F228
              fnstsw  ax
            }
            if ( (_AX & 0x4100) != 0 )
              break;
            v14 = v258;
          }
          v13 = v244;
          v257 = 0.0;
          arg2 = 0.0;
        }
        LODWORD(v14) += 3;
        v258 = v14;
      }
      while ( SLODWORD(v14) < v13 );
    }
  }
  _ESI = secondary_proj_vel_y;
  do
  {
    if ( !*((_BYTE *)_ESI - 24) )
      goto LABEL_208;
    if ( *((_DWORD *)_ESI + 1) == 3 )
    {
      __asm
      {
        fld     frame_dt
        fmul    ds:flt_46F248
      }
      camera_shake_pulses = 4;
      __asm
      {
        fadd    dword ptr [esi-4]
        fst     dword ptr [esi-4]
      }
      *(_ESI - 1) = _ET1;
      __asm
      {
        fcomp   ds:flt_46F224
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
      {
        __asm
        {
          fld     dword ptr [esi]
          fmul    ds:flt_46F2B0
        }
        memset(rgba, 0, 12);
        __asm { fstp    [esp+10Ch+w] }
        rgba[3] = 0.25;
        fx_queue_add(16, _ESI - 3, wb, wb, 0.0, rgba);
        *((_BYTE *)_ESI - 24) = 0;
      }
      __asm
      {
        fld     dword ptr [esi]
        fmul    dword ptr [esi-4]
      }
      v61 = 0;
      _EDI = creature_pos_y;
      __asm
      {
        fmul    ds:flt_46F290
        fstp    [esp+104h+w]
      }
      do
      {
        if ( *((_BYTE *)_EDI - 24) )
        {
          __asm
          {
            fld     dword ptr [edi+0Ch]
            fcomp   ds:flt_46F228
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
          {
            __asm
            {
              fld     dword ptr [edi-4]
              fsub    dword ptr [esi-0Ch]
            }
            __asm
            {
              fld     st
              fld     dword ptr [edi]
              fsub    dword ptr [esi-8]
              fst     [esp+104h+var_D0]
              fld     st
              fmul    st, st(1)
              fld     st(2)
              fmul    st, st(3)
              faddp   st(1), st
              fsqrt
              fstp    st(2)
              fstp    st
              fcomp   [esp+104h+w]
              fnstsw  ax
            }
            if ( (_AX & 0x100) != 0 )
            {
              __asm { fstp    [esp+104h+var_C0] }
              v260 = v253;
              j_FUN_00452f1d(&v259);
              __asm
              {
                fld     [esp+104h+var_C0]
                fmul    ds:flt_46F2FC
              }
              __asm
              {
                fstp    [esp+10Ch+var_B8]
                fld     [esp+10Ch+var_BC]
                fmul    ds:flt_46F2FC
              }
              __asm
              {
                fstp    [esp+110h+var_B4]
                fld     frame_dt
                fmul    dword ptr [esi]
                fmul    ds:flt_46F620
                fstp    [esp+110h+radius]; damage
              }
              creature_apply_damage(v61, radiuse, 3, &v261);
              __asm
              {
                fld     dword ptr [edi+0Ch]
                fcomp   ds:flt_46F228
              }
              __asm { fnstsw  ax }
              if ( (_AX & 0x4100) != 0 )
              {
                fx_queue_add_random(_EDI - 1);
                fx_queue_add_random(_EDI - 1);
                creature_handle_death(v61, 1);
              }
            }
            else
            {
              __asm { fstp    st }
            }
          }
        }
        _EDI += 38;
        ++v61;
      }
      while ( (int)_EDI < (int)flt_4AA350 );
      goto LABEL_208;
    }
    __asm
    {
      fld     frame_dt
      fld     st
      fmul    dword ptr [esi-4]
    }
    _EBX = _ESI - 3;
    __asm { fstp    [esp+10Ch+var_A0] }
    __asm
    {
      fmul    dword ptr [esi]
      fstp    [esp+110h+var_9C]
    }
    FUN_0041e270(_ESI - 3, &v267);
    v67 = *((_DWORD *)_ESI + 1);
    if ( v67 == 1 )
    {
      __asm
      {
        fld     dword ptr [esi]
        fld     dword ptr [esi-4]
        fld     st(1)
        fmulp   st(2), st
        fld     st
        fmul    st, st(1)
        faddp   st(2), st
        fxch    st(1)
        fsqrt
        fxch    st(1)
        fstp    st
        fcomp   ds:flt_46F2D4
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
      {
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F248
        }
LABEL_149:
        __asm
        {
          fadd    ds:flt_46F224
          fld     st
          fmul    dword ptr [esi-4]
          fstp    dword ptr [esi-4]
        }
        *(_ESI - 1) = _ET1;
        __asm
        {
          fmul    dword ptr [esi]
          fstp    dword ptr [esi]
        }
        *_ESI = _ET1;
        goto LABEL_150;
      }
      goto LABEL_150;
    }
    if ( v67 == 4 )
    {
      __asm
      {
        fld     dword ptr [esi]
        fld     dword ptr [esi-4]
        fld     st(1)
        fmulp   st(2), st
        fld     st
        fmul    st, st(1)
        faddp   st(2), st
        fxch    st(1)
        fsqrt
        fxch    st(1)
        fstp    st
        fcomp   ds:flt_46F61C
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
      {
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F25C
        }
        goto LABEL_149;
      }
LABEL_150:
      __asm
      {
        fld     dword ptr [esi-10h]
        fsub    frame_dt
      }
      goto LABEL_157;
    }
    if ( v67 != 2 )
      goto LABEL_158;
    if ( !creature_pool[152 * *((_DWORD *)_ESI + 3)] )
      *((_DWORD *)_ESI + 3) = creature_find_nearest(_ESI - 3, -1, 0.0);
    __asm { fld     dword ptr [ebx] }
    _EDX = 19 * *((_DWORD *)_ESI + 3);
    __asm
    {
      fsub    creature_pos_x[edx*8]
      fld     dword ptr [esi-8]
      fsub    creature_pos_y[edx*8]
      fxch    st(1)
    }
    __asm
    {
      fpatan
      fsub    ds:flt_46F220
      fst     dword ptr [esi-14h]
    }
    *(_ESI - 5) = _ET1;
    __asm
    {
      fsub    ds:flt_46F220
      fcos
      fmul    frame_dt
      fmul    ds:flt_46F618
      fadd    dword ptr [esi-4]
      fstp    dword ptr [esi-4]
    }
    *(_ESI - 1) = _ET1;
    __asm
    {
      fld     dword ptr [esi-14h]
      fsub    ds:flt_46F220
      fsin
      fmul    frame_dt
      fmul    ds:flt_46F618
      fadd    dword ptr [esi]
      fstp    dword ptr [esi]
    }
    *_ESI = _ET1;
    __asm
    {
      fld     dword ptr [esi]
      fld     dword ptr [esi-4]
      fld     st(1)
      fmulp   st(2), st
      fld     st
      fmul    st, st(1)
      faddp   st(2), st
      fxch    st(1)
      fsqrt
      fxch    st(1)
      fstp    st
      fcomp   ds:flt_46F584
      fnstsw  ax
    }
    if ( (_AX & 0x4100) == 0 )
    {
      __asm
      {
        fld     dword ptr [esi-14h]
        fsub    ds:flt_46F220
        fcos
        fmul    frame_dt
        fmul    ds:flt_46F618
        fsubr   dword ptr [esi-4]
        fstp    dword ptr [esi-4]
      }
      *(_ESI - 1) = _ET1;
      __asm
      {
        fld     dword ptr [esi-14h]
        fsub    ds:flt_46F220
        fsin
        fmul    frame_dt
        fmul    ds:flt_46F618
        fsubr   dword ptr [esi]
        fstp    dword ptr [esi]
      }
      *_ESI = _ET1;
    }
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F24C
      fsubr   dword ptr [esi-10h]
    }
LABEL_157:
    __asm { fstp    dword ptr [esi-10h] }
    *(_ESI - 4) = _ET1;
LABEL_158:
    v254 = *(_DWORD *)(_ESI - 1) & 0x7FFFFFFF;
    wc = *(_DWORD *)_ESI & 0x7FFFFFFF;
    v258 = *_ESI;
    __asm
    {
      fld     [esp+104h+w]
      fadd    [esp+104h+var_D0]
      fmul    frame_dt
      fmul    ds:flt_46F300
      fsubr   dword ptr [esi+8]
      fst     dword ptr [esi+8]
    }
    _ESI[2] = _ET1;
    __asm
    {
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x100) != 0 )
    {
      __asm
      {
        fld     dword ptr [esi-14h]
        fadd    ds:flt_46F220
      }
      __asm { fcos }
      __asm
      {
        fst     [esp+110h+var_30]
        fld     [esp+110h+var_30]
        fmul    ds:flt_46F3A4
        fstp    [esp+110h+vel]
        fmul    ds:flt_46F3A4
        fstp    [esp+110h+var_AC]
        fld     dword ptr [esi-14h]
        fsub    ds:flt_46F220
        fld     st
        fcos
        fstp    [esp+110h+var_40]
        fsin
        fld     [esp+110h+var_40]
        fmul    ds:flt_46F298
        fstp    [esp+110h+var_50]
        fmul    ds:flt_46F298
        fld     dword ptr [ebx]
        fsub    [esp+110h+var_50]
        fstp    [esp+110h+delta]
        fld     dword ptr [esi-8]
        fsub    st, st(1)
        fstp    [esp+110h+var_A4]
        fstp    st
      }
      v82 = fx_spawn_sprite(&delta, &vel, 14.0);
      _ESI[2] = 0.059999999;
      sprite_effect_color_a[11 * v82] = 1048576000;
    }
    v83 = creature_find_in_radius(_ESI - 3, 8.0, 0);
    if ( v83 == -1 )
      goto LABEL_206;
    _EDI = 152 * v83;
    if ( creature_hitbox_size[38 * v83] == 1098907648 )
      ++highscore_record_shots_hit;
    __asm
    {
      fld     bonus_freeze_timer
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
      we = crt_rand() % 20 - 10;
      __asm
      {
        fild    [esp+104h+w]
        fstp    [esp+104h+var_18]
      }
      wf = crt_rand() % 20 - 10;
      __asm
      {
        fild    [esp+104h+w]
        fld     [esp+104h+var_18]
        fadd    dword ptr [edi+49BF4Ch]
      }
      __asm
      {
        fstp    [esp+108h+var_90]
        fadd    dword ptr [edi+49BF50h]
        fstp    [esp+108h+var_8C]
      }
      fx_queue_add_random(&v271);
      wg = crt_rand() % 20 - 10;
      __asm
      {
        fild    [esp+108h+w]
        fstp    [esp+108h+var_38]
      }
      wh = crt_rand() % 20 - 10;
      __asm
      {
        fild    [esp+108h+w]
        fld     [esp+108h+var_38]
        fadd    dword ptr [edi+49BF4Ch]
      }
      __asm
      {
        fstp    [esp+10Ch+var_80]
        fadd    dword ptr [edi+49BF50h]
        fstp    [esp+10Ch+var_7C]
      }
      fx_queue_add_random(&v275);
      wi = crt_rand() % 20 - 10;
      __asm
      {
        fild    [esp+10Ch+w]
        fstp    [esp+10Ch+var_28]
      }
      wj = crt_rand() % 20 - 10;
      __asm
      {
        fild    [esp+10Ch+w]
        fld     [esp+10Ch+var_28]
        fadd    dword ptr [edi+49BF4Ch]
      }
      __asm
      {
        fstp    [esp+110h+var_70]
        fadd    dword ptr [edi+49BF50h]
        fstp    [esp+110h+var_6C]
      }
      fx_queue_add_random(&v279);
    }
    else
    {
      v231 = 4;
      do
      {
        wd = crt_rand() % 612;
        __asm
        {
          fild    [esp+108h+w]
          fmul    ds:flt_46F300
          fstp    [esp+108h+var_108]; angle
        }
        effect_spawn_freeze_shard(_ESI - 3, v182);
        --v231;
      }
      while ( v231 );
    }
    v86 = *((_DWORD *)_ESI + 1);
    v245 = 150.0;
    switch ( v86 )
    {
      case 1:
        __asm
        {
          fld     dword ptr [esi-10h]
          fmul    ds:flt_46F2BC
        }
        __asm
        {
          fadd    ds:flt_46F2D4
          fstp    [esp+104h+var_DC]
        }
        if ( config_detail_preset >= 3 )
          effect_spawn_explosion_burst(_ESI - 3, 0.40000001);
        goto LABEL_176;
      case 2:
        __asm
        {
          fld     dword ptr [esi-10h]
          fmul    ds:flt_46F2B4
          fadd    ds:flt_46F290
        }
        break;
      case 4:
        __asm
        {
          fld     dword ptr [esi-10h]
          fmul    ds:flt_46F2B4
          fadd    ds:flt_46F2EC
        }
        break;
      default:
        goto LABEL_176;
    }
    __asm { fstp    [esp+104h+var_DC] }
LABEL_176:
    if ( demo_mode_active || byte_4CC8D4 || config_game_mode == 2 )
      sfx_play_panned(sfx_explosion_medium);
    else
      sfx_play_exclusive(music_track_extra_0);
    __asm
    {
      fld     frame_dt
      fdivr   ds:flt_46F224
    }
    creature_state_flag[152 * v83] = 1;
    __asm
    {
      fld     st
      fmul    dword ptr [esi-4]
      fstp    [esp+114h+var_98]
      fmul    dword ptr [esi]
      fstp    [esp+114h+var_94]
    }
    creature_apply_damage(v83, v245, 3, &v269);
    v87 = *((_DWORD *)_ESI + 1);
    switch ( v87 )
    {
      case 1:
        __asm
        {
          fld     bonus_freeze_timer
          fcomp   ds:flt_46F228
        }
        *((_DWORD *)_ESI + 1) = 3;
        *(_ESI - 1) = 0.0;
        *_ESI = 1.0;
        __asm { fnstsw  ax }
        if ( (_AX & 0x4100) != 0 )
        {
          v90 = 20;
          do
          {
            wl = crt_rand() % 628;
            __asm
            {
              fild    [esp+104h+w]
              fmul    ds:flt_46F300
              fstp    [esp+104h+var_E8]
            }
            wm = crt_rand() % 90;
            __asm
            {
              fild    [esp+104h+w]
              fld     [esp+104h+var_E8]
              fcos
            }
            __asm
            {
              fmul    st, st(1)
              fstp    [esp+108h+var_58]
              fld     [esp+108h+var_E8]
              fsin
              fmulp   st(1), st
              fld     [esp+108h+var_58]
              fadd    dword ptr [edi+49BF4Ch]
              fstp    [esp+108h+impulse]
              fadd    dword ptr [edi+49BF50h]
              fstp    [esp+108h+var_74]
            }
            fx_queue_add_random(&impulse);
            --v90;
          }
          while ( v90 );
        }
        else
        {
          v89 = 8;
          do
          {
            wk = crt_rand() % 612;
            __asm
            {
              fild    [esp+108h+w]
              fmul    ds:flt_46F300
              fstp    [esp+108h+var_108]; angle
            }
            effect_spawn_freeze_shard(_ESI - 3, v183);
            --v89;
          }
          while ( v89 );
        }
        break;
      case 2:
        __asm
        {
          fld     bonus_freeze_timer
          fcomp   ds:flt_46F228
        }
        *((_DWORD *)_ESI + 1) = 3;
        *(_ESI - 1) = 0.0;
        *_ESI = 0.34999999;
        __asm { fnstsw  ax }
        if ( (_AX & 0x4100) != 0 )
        {
          v93 = 10;
          do
          {
            wo = crt_rand() % 628;
            __asm
            {
              fild    [esp+104h+w]
              fmul    ds:flt_46F300
              fstp    [esp+104h+var_E8]
            }
            wp = crt_rand() % 64;
            __asm
            {
              fild    [esp+104h+w]
              fld     [esp+104h+var_E8]
              fcos
            }
            __asm
            {
              fmul    st, st(1)
              fstp    [esp+108h+angle]
              fld     [esp+108h+var_E8]
              fsin
              fmulp   st(1), st
              fld     [esp+108h+angle]
              fadd    dword ptr [edi+49BF4Ch]
              fstp    [esp+108h+var_88]
              fadd    dword ptr [edi+49BF50h]
              fstp    [esp+108h+var_84]
            }
            fx_queue_add_random(&v273);
            --v93;
          }
          while ( v93 );
        }
        else
        {
          v92 = 8;
          do
          {
            wn = crt_rand() % 612;
            __asm
            {
              fild    [esp+108h+w]
              fmul    ds:flt_46F300
              fstp    [esp+108h+var_108]; angle
            }
            effect_spawn_freeze_shard(_ESI - 3, v184);
            --v92;
          }
          while ( v92 );
        }
        break;
      case 4:
        __asm
        {
          fld     bonus_freeze_timer
          fcomp   ds:flt_46F228
        }
        *((_DWORD *)_ESI + 1) = 3;
        *(_ESI - 1) = 0.0;
        *_ESI = 0.25;
        __asm { fnstsw  ax }
        if ( (_AX & 0x4100) != 0 )
        {
          v97 = 3;
          do
          {
            wr = crt_rand() % 628;
            __asm
            {
              fild    [esp+104h+w]
              fmul    ds:flt_46F300
              fstp    [esp+104h+var_E8]
            }
            ws = crt_rand() % 44;
            __asm
            {
              fild    [esp+104h+w]
              fld     [esp+104h+var_E8]
              fcos
            }
            __asm
            {
              fmul    st, st(1)
              fstp    [esp+108h+var_D8]
              fld     [esp+108h+var_E8]
              fsin
              fmulp   st(1), st
              fld     [esp+108h+var_D8]
              fadd    dword ptr [edi+49BF4Ch]
              fstp    [esp+108h+var_48]
              fadd    dword ptr [edi+49BF50h]
              fstp    [esp+108h+var_44]
            }
            fx_queue_add_random(&v288);
            --v97;
          }
          while ( v97 );
        }
        else
        {
          v95 = (float *)((char *)&creature_pos_x + _EDI);
          v96 = 8;
          do
          {
            wq = crt_rand() % 612;
            __asm
            {
              fild    [esp+108h+w]
              fmul    ds:flt_46F300
              fstp    [esp+108h+var_108]; angle
            }
            effect_spawn_freeze_shard(v95, v185);
            --v96;
          }
          while ( v96 );
        }
        break;
    }
    v98 = 0;
    v232 = 0;
    do
    {
      wt = crt_rand() % 800;
      __asm { fild    [esp+108h+w] }
      __asm
      {
        fmul    ds:flt_46F2FC
        fild    [esp+110h+var_EC]
        fmul    ds:flt_46F614
        fld     st
        fcos
        fstp    [esp+110h+var_68]
        fsin
        fld     st(1)
        fmul    [esp+110h+var_68]
        fstp    [esp+110h+pos]
        fmul    st, st(1)
        fstp    [esp+110h+var_1C]
        fstp    st
      }
      v232 = ++v98;
      sprite_effect_color_a[11 * fx_spawn_sprite(_ESI - 3, &pos, 14.0)] = 1052602532;
    }
    while ( v98 < 10 );
LABEL_206:
    __asm
    {
      fld     dword ptr [esi-10h]
      fcomp   ds:flt_46F228
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
      *((_DWORD *)_ESI + 1) = 3;
      *(_ESI - 1) = 0.0;
      *_ESI = 0.5;
    }
LABEL_208:
    _ESI += 11;
  }
  while ( (int)_ESI < (int)flt_4965F0 );
  _ECX = (float *)sprite_effect_pos_y;
  do
  {
    if ( *((_BYTE *)_ECX - 28) )
    {
      __asm
      {
        fld     frame_dt
        fld     st
        fmul    dword ptr [ecx+4]
        fstp    [esp+104h+var_68]
        fmul    dword ptr [ecx+8]
        fld     [esp+104h+var_68]
        fadd    dword ptr [ecx-4]
        fstp    dword ptr [ecx-4]
      }
      *(_ECX - 1) = _ET1;
      __asm
      {
        fadd    dword ptr [ecx]
        fstp    dword ptr [ecx]
      }
      *_ECX = _ET1;
      __asm
      {
        fld     frame_dt
        fmul    ds:flt_46F248
        fadd    dword ptr [ecx-8]
        fstp    dword ptr [ecx-8]
      }
      *(_ECX - 2) = _ET1;
      __asm
      {
        fld     dword ptr [ecx-0Ch]
        fsub    frame_dt
        fst     dword ptr [ecx-0Ch]
      }
      *(_ECX - 3) = _ET1;
      __asm
      {
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
        *((_BYTE *)_ECX - 28) = 0;
      __asm
      {
        fld     frame_dt
        fmul    ds:flt_46F384
        fadd    dword ptr [ecx+0Ch]
        fstp    dword ptr [ecx+0Ch]
      }
      _ECX[3] = _ET1;
    }
    _ECX += 11;
  }
  while ( (int)_ECX < (int)flt_49AA3C );
  v238 = 0;
  _ESI = (struct _SYSTEMTIME *)&particle_vel_y;
  while ( 2 )
  {
    if ( LOBYTE(_ESI[-1].wYear) )
    {
      __asm { fld     frame_dt }
      if ( LOBYTE(_ESI[2].wYear) == 8 )
      {
        __asm
        {
          fmul    ds:flt_46F610
          fsubr   dword ptr [esi+14h]
          fstp    dword ptr [esi+14h]
        }
        *(float *)&_ESI[1].wDayOfWeek = _ET1;
        __asm
        {
          fld     frame_dt
          fmul    ds:flt_46F288
          fadd    dword ptr [esi+1Ch]
          fstp    dword ptr [esi+1Ch]
        }
        *(float *)&_ESI[1].wSecond = _ET1;
        if ( !HIBYTE(_ESI[-1].wYear) )
          goto LABEL_226;
        __asm
        {
          fld     dword ptr [esi+14h]
          fcomp   ds:flt_46F60C
          fld     frame_dt
          fld     st
          fmul    dword ptr [esi-4]
          fnstsw  ax
        }
        if ( (_AX & 0x4100) == 0 )
        {
          __asm { fstp    [esp+104h+var_68] }
          __asm
          {
            fmul    dword ptr [esi]
            fld     dword ptr [esi+14h]
            fld     [esp+108h+var_68]
            fmul    st, st(1)
          }
          __asm
          {
            fstp    [esp+110h+var_B8]
            fxch    st(1)
            fmul    st, st(1)
            fstp    [esp+110h+var_B4]
            fstp    st
          }
          FUN_0041e270((float *)&_ESI[-1].wDayOfWeek, &v261);
          goto LABEL_226;
        }
        __asm
        {
          fstp    [esp+104h+var_30]
          fmul    dword ptr [esi]
          fld     [esp+104h+var_30]
          fmul    ds:flt_46F3AC
          fstp    [esp+104h+var_40]
          fmul    ds:flt_46F3AC
          fld     dword ptr [esi+14h]
          fld     [esp+104h+var_40]
          fmul    st, st(1)
          fstp    [esp+104h+var_50]
          fxch    st(1)
          fmul    st, st(1)
          fxch    st(1)
          fstp    st
          fld     [esp+104h+var_50]
        }
LABEL_225:
        __asm
        {
          fadd    dword ptr [esi-0Ch]
          fstp    dword ptr [esi-0Ch]
        }
        *(float *)&_ESI[-1].wDayOfWeek = _ET1;
        __asm
        {
          fadd    dword ptr [esi-8]
          fstp    dword ptr [esi-8]
        }
        *(float *)&_ESI[-1].wHour = _ET1;
      }
      else
      {
        __asm
        {
          fmul    ds:flt_46F34C
          fsubr   dword ptr [esi+14h]
          fstp    dword ptr [esi+14h]
        }
        *(float *)&_ESI[1].wDayOfWeek = _ET1;
        __asm
        {
          fld     frame_dt
          fadd    dword ptr [esi+1Ch]
          fstp    dword ptr [esi+1Ch]
        }
        *(float *)&_ESI[1].wSecond = _ET1;
        __asm
        {
          fld     dword ptr [esi+14h]
          fcomp   ds:flt_46F60C
          fld     frame_dt
          fld     st
          fmul    dword ptr [esi-4]
          fnstsw  ax
        }
        if ( (_AX & 0x4100) != 0 )
        {
          __asm
          {
            fstp    [esp+104h+var_28]
            fmul    dword ptr [esi]
            fld     [esp+104h+var_28]
            fmul    ds:flt_46F624
            fstp    [esp+104h+var_58]
            fmul    ds:flt_46F624
            fld     [esp+104h+var_58]
            fmul    ds:flt_46F60C
            fstp    [esp+104h+var_90]
            fmul    ds:flt_46F60C
            fld     [esp+104h+var_90]
          }
          goto LABEL_225;
        }
        __asm { fstp    [esp+104h+var_18] }
        __asm
        {
          fmul    dword ptr [esi]
          fld     [esp+108h+var_18]
          fmul    ds:flt_46F624
        }
        __asm
        {
          fstp    [esp+110h+var_38]
          fmul    ds:flt_46F624
          fld     dword ptr [esi+14h]
          fld     [esp+110h+var_38]
          fmul    st, st(1)
          fstp    [esp+110h+var_A0]
          fxch    st(1)
          fmul    st, st(1)
          fstp    [esp+110h+var_9C]
          fstp    st
        }
        FUN_0041e270((float *)&_ESI[-1].wDayOfWeek, &v267);
      }
LABEL_226:
      wYear = _ESI[2].wYear;
      __asm { fld     dword ptr [esi+14h] }
      if ( wYear )
      {
        __asm
        {
          fcomp   ds:flt_46F2A4
          fnstsw  ax
        }
        if ( (_AX & 0x4100) == 0 )
          goto LABEL_235;
        LOBYTE(_ESI[-1].wYear) = 0;
        if ( LOBYTE(_ESI[2].wYear) == 8 )
        {
          v119 = *(_DWORD *)&_ESI[2].wDayOfWeek;
          if ( v119 != -1 )
          {
            if ( creature_pool[152 * v119] )
            {
              v120 = crt_rand();
              sfx_play_panned(*(&creature_type_sfx_a0
                              + 17 * *(&creature_type_id + 38 * *(_DWORD *)&_ESI[2].wDayOfWeek)
                              + v120 % 3));
            }
            creature_handle_death(*(_DWORD *)&_ESI[2].wDayOfWeek, 0);
          }
        }
      }
      else
      {
        __asm
        {
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4100) != 0 )
        {
          LOBYTE(_ESI[-1].wYear) = 0;
          goto LABEL_281;
        }
LABEL_235:
        if ( HIBYTE(_ESI[-1].wYear) == 1 )
        {
          if ( !wYear )
          {
            wu = crt_rand() % 100 - 50;
            __asm
            {
              fild    [esp+104h+w]
              fmul    ds:flt_46F608
              fmul    dword ptr [esi+14h]
              fmul    frame_dt
              fmul    ds:flt_46F604
            }
            goto LABEL_241;
          }
          if ( wYear == 8 )
          {
            wv = crt_rand() % 100 - 50;
            __asm
            {
              fild    [esp+104h+w]
              fmul    ds:flt_46F608
              fmul    dword ptr [esi+14h]
              fmul    frame_dt
              fmul    ds:flt_46F560
              fsubr   dword ptr [esi+18h]
              fst     dword ptr [esi+18h]
            }
            *(float *)&_ESI[1].wHour = _ET1;
            __asm
            {
              fcos
              fmul    ds:flt_46F4AC
              fstp    dword ptr [esi-4]
            }
            *(float *)&_ESI[-1].wSecond = _ET1;
            __asm
            {
              fld     dword ptr [esi+18h]
              fsin
              fmul    ds:flt_46F4AC
            }
          }
          else
          {
            ww = crt_rand() % 100 - 50;
            __asm
            {
              fild    [esp+104h+w]
              fmul    ds:flt_46F608
              fmul    dword ptr [esi+14h]
              fmul    frame_dt
              fmul    ds:flt_46F560
            }
LABEL_241:
            __asm
            {
              fsubr   dword ptr [esi+18h]
              fst     dword ptr [esi+18h]
            }
            *(float *)&_ESI[1].wHour = _ET1;
            __asm
            {
              fcos
              fmul    ds:flt_46F600
              fstp    dword ptr [esi-4]
            }
            *(float *)&_ESI[-1].wSecond = _ET1;
            __asm
            {
              fld     dword ptr [esi+18h]
              fsin
              fmul    ds:flt_46F600
            }
          }
          __asm { fstp    dword ptr [esi] }
          *(float *)&_ESI->wYear = _ET1;
        }
        __asm
        {
          fld     dword ptr [esi+14h]
          fcomp   ds:flt_46F224
          fnstsw  ax
        }
        if ( (_AX & 0x4100) != 0 )
          __asm { fld     dword ptr [esi+14h] }
        else
          __asm { fld     ds:flt_46F224 }
        __asm { fstp    dword ptr [esi+10h] }
        *(float *)&_ESI[1].wYear = _ET1;
        __asm
        {
          fld     dword ptr [esi+14h]
          fmul    ds:flt_46F62C
          fsubr   ds:flt_46F224
          fst     dword ptr [esi+4]
        }
        *(float *)&_ESI->wDayOfWeek = _ET1;
        __asm { fstp    dword ptr [esi+8] }
        *(float *)&_ESI->wHour = _ET1;
        if ( HIBYTE(_ESI[-1].wYear) )
        {
          __asm
          {
            fld     dword ptr [esi+14h]
            fmul    ds:flt_46F268
          }
          _EDI = (float *)&_ESI[-1].wDayOfWeek;
          __asm { fstp    [esp+10Ch+damage]; radius }
          v131 = creature_find_in_radius((float *)&_ESI[-1].wDayOfWeek, damagef, 0);
          if ( v131 != -1 )
          {
            HIBYTE(_ESI[-1].wYear) = 0;
            if ( LOBYTE(_ESI[2].wYear) == 8 )
            {
              v132 = creature_pos_y[38 * v131];
              *_EDI = *(&creature_pos_x + 38 * v131);
              _EDI[1] = v132;
              *(_DWORD *)&_ESI[-1].wSecond = 0;
              *(_DWORD *)&_ESI->wYear = 0;
              creature_state_flag[152 * v131] = 0;
              *(_DWORD *)&_ESI[2].wDayOfWeek = v131;
            }
            else
            {
              __asm
              {
                fld     dword ptr [esi+18h]
                fcomp   ds:flt_46F3B0
                fnstsw  ax
              }
              if ( (_AX & 0x4100) == 0 )
              {
                do
                {
                  __asm
                  {
                    fld     dword ptr [esi+18h]
                    fsub    ds:flt_46F3B0
                    fst     dword ptr [esi+18h]
                  }
                  *(float *)&_ESI[1].wHour = _ET1;
                  __asm
                  {
                    fcomp   ds:flt_46F3B0
                    fnstsw  ax
                  }
                }
                while ( (_AX & 0x4100) == 0 );
              }
              __asm
              {
                fld     dword ptr [esi+18h]
                fcomp   ds:flt_46F228
                fnstsw  ax
              }
              if ( (_AX & 0x100) != 0 )
              {
                do
                {
                  __asm
                  {
                    fld     dword ptr [esi+18h]
                    fadd    ds:flt_46F3B0
                    fst     dword ptr [esi+18h]
                  }
                  *(float *)&_ESI[1].wHour = _ET1;
                  __asm
                  {
                    fcomp   ds:flt_46F228
                    fnstsw  ax
                  }
                }
                while ( (_AX & 0x100) != 0 );
              }
              __asm
              {
                fld     frame_dt
                fld     st
                fmul    dword ptr [esi-4]
              }
              __asm
              {
                fstp    [esp+104h+var_80]
                fmul    dword ptr [esi]
                fld     dword ptr [edi]
                fsub    [esp+104h+var_80]
              }
              _EDI = 152 * v131;
              __asm { fstp    [esp+104h+var_70] }
              _EBP = &creature_pos_x + 38 * v131;
              __asm
              {
                fsubr   dword ptr [esi-8]
                fld     [esp+104h+var_70]
                fsub    dword ptr [ebp+0]
                fstp    [esp+104h+var_98]
                fsub    dword ptr [ebp+4]
                fld     [esp+104h+var_98]
                fpatan
                fcom    ds:flt_46F3B0
                fnstsw  ax
              }
              if ( (_AX & 0x4100) == 0 )
              {
                do
                {
                  __asm
                  {
                    fsub    ds:flt_46F3B0
                    fcom    ds:flt_46F3B0
                    fnstsw  ax
                  }
                }
                while ( (_AX & 0x4100) == 0 );
              }
              __asm
              {
                fcom    ds:flt_46F228
                fnstsw  ax
              }
              if ( (_AX & 0x100) != 0 )
              {
                do
                {
                  __asm
                  {
                    fadd    ds:flt_46F3B0
                    fcom    ds:flt_46F228
                    fnstsw  ax
                  }
                }
                while ( (_AX & 0x100) != 0 );
              }
              __asm
              {
                fcomp   dword ptr [esi+18h]
                fld     dword ptr [esi+18h]
                fnstsw  ax
              }
              if ( (_AX & 0x100) != 0 )
                __asm { fsub    ds:flt_46F5FC }
              else
                __asm { fadd    ds:flt_46F5FC }
              __asm { fstp    dword ptr [esi+18h] }
              *(float *)&_ESI[1].wHour = _ET1;
              __asm
              {
                fld     dword ptr [esi+18h]
                fcos
                fmul    ds:flt_46F600
                fstp    dword ptr [esi-4]
              }
              *(float *)&_ESI[-1].wSecond = _ET1;
              __asm
              {
                fld     dword ptr [esi+18h]
                fsin
                fmul    ds:flt_46F600
                fstp    dword ptr [esi]
              }
              *(float *)&_ESI->wYear = _ET1;
              v149 = crt_rand();
              creature_state_flag[152 * v131] = 1;
              vel = 0.0;
              v264 = 0.0;
              wx = v149 % 10;
              __asm { fild    [esp+104h+w] }
              __asm
              {
                fmul    ds:flt_46F2FC
                fld     st
                fmul    dword ptr [esi-4]
                fstp    dword ptr [esi-4]
              }
              *(float *)&_ESI[-1].wSecond = _ET1;
              __asm
              {
                fmul    dword ptr [esi]
                fstp    dword ptr [esi]
              }
              *(float *)&_ESI->wYear = _ET1;
              __asm
              {
                fld     dword ptr [esi+14h]
                fmul    ds:flt_46F260
                fstp    [esp+110h+radius]; damage
              }
              creature_apply_damage(v131, radiusf, 4, &vel);
              __asm
              {
                fld     dword ptr [edi+49BF78h]
                fadd    dword ptr [edi+49BF7Ch]
              }
              __asm
              {
                fadd    dword ptr [edi+49BF74h]
                fcomp   ds:flt_46F5F8
                fnstsw  ax
              }
              if ( (_AX & 0x4100) == 0 )
              {
                __asm
                {
                  fld     dword ptr [esi+14h]
                  fmul    ds:flt_46F300
                  fsubr   ds:flt_46F224
                  fld     st
                  fmul    dword ptr [edi+49BF74h]
                  fstp    dword ptr [edi+49BF74h]
                }
                *(&creature_tint_r + 38 * v131) = _ET1;
                __asm
                {
                  fld     st
                  fmul    dword ptr [edi+49BF78h]
                  fstp    dword ptr [edi+49BF78h]
                }
                creature_tint_g[38 * v131] = _ET1;
                __asm
                {
                  fmul    dword ptr [edi+49BF7Ch]
                  fstp    dword ptr [edi+49BF7Ch]
                }
                creature_tint_b[38 * v131] = _ET1;
                __asm
                {
                  fld     dword ptr [edi+49BF74h]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x100) != 0 )
                {
                  *(&creature_tint_r + 38 * v131) = 0.0;
                }
                else
                {
                  __asm
                  {
                    fld     dword ptr [edi+49BF74h]
                    fcomp   ds:flt_46F224
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) == 0 )
                    *(&creature_tint_r + 38 * v131) = 1.0;
                }
                __asm
                {
                  fld     dword ptr [edi+49BF78h]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x100) != 0 )
                {
                  creature_tint_g[38 * v131] = 0;
                }
                else
                {
                  __asm
                  {
                    fld     dword ptr [edi+49BF78h]
                    fcomp   ds:flt_46F224
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) == 0 )
                    creature_tint_g[38 * v131] = 1065353216;
                }
                __asm
                {
                  fld     dword ptr [edi+49BF7Ch]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x100) != 0 )
                {
                  creature_tint_b[38 * v131] = 0;
                }
                else
                {
                  __asm
                  {
                    fld     dword ptr [edi+49BF7Ch]
                    fcomp   ds:flt_46F224
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) == 0 )
                    creature_tint_b[38 * v131] = 1065353216;
                }
                __asm
                {
                  fld     dword ptr [edi+49BF80h]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x100) != 0 )
                {
                  creature_tint_a[38 * v131] = 0;
                }
                else
                {
                  __asm
                  {
                    fld     dword ptr [edi+49BF80h]
                    fcomp   ds:flt_46F224
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) == 0 )
                    creature_tint_a[38 * v131] = 1065353216;
                }
              }
              if ( !(v238 % 3) )
              {
                v255 = crt_rand() % 60 - 30;
                wy = crt_rand() % 60 - 30;
                __asm
                {
                  fild    [esp+108h+w]
                  fild    [esp+108h+var_D0]
                }
                __asm
                {
                  fstp    [esp+110h+delta]
                  fstp    [esp+110h+var_A4]
                }
                sprite_effect_color_a[11 * fx_spawn_sprite(&creature_pos_x + 38 * v131, &delta, 13.0)] = 1060320051;
              }
              fx_queue_add_random(&creature_pos_x + 38 * v131);
              __asm
              {
                fld     dword ptr [esi-4]
                fld     dword ptr [esi]
              }
              __asm { fstp    [esp+104h+var_74] }
              v233 = frame_dt;
              __asm
              {
                fmul    [esp+104h+var_EC]
                fld     [esp+104h+var_74]
                fmul    [esp+104h+var_EC]
                fstp    [esp+104h+var_84]
                fadd    dword ptr [ebp+0]
                fstp    dword ptr [ebp+0]
              }
              *_EBP = _ET1;
              __asm
              {
                fld     [esp+104h+var_84]
                fadd    dword ptr [ebp+4]
                fstp    dword ptr [ebp+4]
              }
              _EBP[1] = _ET1;
            }
          }
        }
      }
    }
LABEL_281:
    _ESI = (struct _SYSTEMTIME *)((char *)_ESI + 56);
    ++v238;
    if ( (int)_ESI < (int)&local_system_time )
      continue;
    break;
  }
}

// projectile_render @ 0x00422C70
// renders projectiles/secondary projectiles and related beam/trail effects
void projectile_render()
{
  int v0; // edx
  int v1; // edx
  int v2; // edi
  float *v3; // esi
  long double v4; // st7
  float v5; // ecx
  long double v6; // st7
  long double v7; // st7
  double v8; // st6
  double v9; // st6
  int v10; // eax
  char *v11; // esi
  int v12; // eax
  int v13; // edx
  int v14; // eax
  double v15; // st7
  double v16; // st6
  float v17; // eax
  float v18; // edx
  float v19; // edi
  double v20; // st7
  float v21; // ebx
  double v22; // st6
  double v23; // st7
  double v24; // st7
  float v25; // ecx
  double v26; // st7
  double v27; // st5
  double v28; // st5
  double v29; // st7
  double v30; // st5
  double v31; // st5
  double v32; // st7
  double v33; // st5
  double v34; // st5
  double v35; // st7
  long double v36; // st7
  int v37; // eax
  int v38; // edx
  float *v39; // esi
  int v40; // eax
  double v41; // st6
  double v42; // st4
  int v43; // ebx
  long double v44; // st7
  int v45; // edx
  float v46; // edi
  double v47; // st7
  int v48; // eax
  int v49; // edx
  double v50; // st7
  int v51; // eax
  int v52; // edx
  double v53; // st6
  double v54; // st4
  int v55; // ebx
  long double v56; // st7
  int v57; // edx
  float v58; // edi
  double v59; // st7
  int v60; // eax
  double v61; // st7
  int v62; // edx
  int v63; // eax
  double v64; // st6
  double v65; // st5
  int v66; // ebx
  long double v67; // st7
  int v68; // edx
  float v69; // edi
  double v70; // st7
  int v71; // eax
  int v72; // edx
  double v73; // st7
  int v74; // eax
  double v75; // st7
  int v76; // eax
  double v77; // st6
  double v78; // st5
  int v79; // ebx
  long double v80; // st7
  int v81; // edx
  float v82; // edi
  double v83; // st7
  int v84; // eax
  double v85; // st7
  int v86; // edx
  double v87; // st6
  double v88; // st5
  int v89; // ebx
  long double v90; // st7
  int v91; // edx
  float v92; // edi
  double v93; // st7
  int v94; // eax
  double v95; // st7
  int v96; // edx
  double v97; // st7
  int v98; // edx
  double v99; // st7
  double v100; // st7
  int v101; // eax
  double v102; // st7
  float v103; // ebp
  _DWORD *v104; // ebx
  char v105; // al
  float v106; // edi
  int v107; // eax
  double v108; // st6
  double v109; // st5
  int v110; // eax
  int v111; // edx
  int v112; // edx
  double v113; // st7
  float v114; // eax
  double v115; // st6
  double v116; // st7
  int v117; // edx
  double v118; // st7
  int v119; // eax
  double v120; // st6
  double v121; // st5
  long double v122; // st7
  int v123; // eax
  double v124; // st6
  double v125; // st5
  long double v126; // st7
  int v127; // eax
  double v128; // st7
  double v129; // st7
  double v130; // st7
  int v131; // edx
  int v132; // eax
  int v133; // edx
  double v134; // st7
  int v135; // edx
  double v136; // st7
  double v137; // st7
  double v138; // st7
  double v139; // st7
  int v140; // eax
  double v141; // st7
  int v142; // edx
  int v143; // eax
  int v144; // edx
  double v145; // st7
  int v146; // eax
  float v147; // edi
  double v148; // st7
  float *v149; // ebp
  int v150; // edx
  bool v151; // zf
  int v152; // edi
  double v153; // st7
  double v154; // st7
  double v155; // st6
  int v156; // eax
  double v157; // st7
  int v158; // eax
  double v159; // st7
  int v160; // edx
  int v161; // eax
  float *v162; // esi
  double v163; // st7
  int v164; // eax
  long double v165; // st7
  int v166; // edx
  long double v167; // st7
  int v168; // eax
  long double v169; // st7
  long double v170; // st7
  int v171; // edx
  long double v172; // st7
  int v173; // eax
  double v174; // st7
  int v175; // edx
  int v176; // edx
  double v177; // st7
  char *v178; // esi
  double v179; // st7
  double v180; // st6
  int v181; // eax
  int v182; // edx
  float *v183; // esi
  int v184; // eax
  int v185; // eax
  double v186; // st7
  double v187; // st6
  int v188; // edx
  float v189; // eax
  double v190; // st7
  double v191; // st6
  float *v192; // esi
  int v193; // edx
  long double v194; // st7
  int v195; // eax
  double v196; // st6
  char *v197; // esi
  int v198; // eax
  double v199; // st7
  double v200; // st6
  int v201; // edx
  int v202; // eax
  float v203; // edx
  double v204; // st7
  double v205; // st6
  int v206; // eax
  double v207; // st7
  double v208; // st6
  int v209; // edx
  char *v210; // esi
  int v211; // eax
  int v212; // eax
  long double v213; // st7
  int v214; // edx
  double v215; // st6
  float v216; // eax
  int v217; // edx
  long double v218; // st7
  int v219; // eax
  double v220; // st6
  int v221; // eax
  long double v222; // st7
  double v223; // st6
  float v224[3]; // [esp+4ACh] [ebp-1BCh] BYREF
  float v225; // [esp+4B8h] [ebp-1B0h]
  float v226; // [esp+4BCh] [ebp-1ACh]
  int v227; // [esp+4C0h] [ebp-1A8h]
  float v228; // [esp+4C4h] [ebp-1A4h]
  float v229; // [esp+4C8h] [ebp-1A0h]
  float v230; // [esp+4CCh] [ebp-19Ch]
  float v231; // [esp+4D0h] [ebp-198h]
  float v232; // [esp+4D4h] [ebp-194h]
  float v233; // [esp+4D8h] [ebp-190h]
  float v234; // [esp+4DCh] [ebp-18Ch]
  float v235; // [esp+4E0h] [ebp-188h]
  float v236; // [esp+4E4h] [ebp-184h]
  float v237; // [esp+4E8h] [ebp-180h]
  float v238; // [esp+4ECh] [ebp-17Ch]
  int v239; // [esp+4F0h] [ebp-178h]
  float v240; // [esp+4F4h] [ebp-174h]
  float v241; // [esp+4F8h] [ebp-170h]
  float v242; // [esp+4FCh] [ebp-16Ch]
  float v243; // [esp+500h] [ebp-168h]
  float v244; // [esp+504h] [ebp-164h]
  float v245; // [esp+508h] [ebp-160h]
  float v246; // [esp+50Ch] [ebp-15Ch]
  float v247; // [esp+510h] [ebp-158h] BYREF
  float v248; // [esp+514h] [ebp-154h]
  float v249; // [esp+518h] [ebp-150h]
  float v250; // [esp+51Ch] [ebp-14Ch]
  float v251; // [esp+520h] [ebp-148h]
  float v252; // [esp+524h] [ebp-144h]
  float v253; // [esp+528h] [ebp-140h]
  float v254; // [esp+52Ch] [ebp-13Ch]
  float radius; // [esp+530h] [ebp-138h]
  float v256; // [esp+534h] [ebp-134h]
  float v257; // [esp+538h] [ebp-130h]
  float v258; // [esp+53Ch] [ebp-12Ch]
  float v259; // [esp+540h] [ebp-128h]
  float v260; // [esp+544h] [ebp-124h]
  float v261; // [esp+548h] [ebp-120h]
  float v262; // [esp+54Ch] [ebp-11Ch]
  float v263; // [esp+550h] [ebp-118h]
  float v264; // [esp+554h] [ebp-114h]
  float v265; // [esp+558h] [ebp-110h]
  float v266; // [esp+55Ch] [ebp-10Ch]
  float v267; // [esp+560h] [ebp-108h]
  float v268; // [esp+564h] [ebp-104h]
  float v269; // [esp+568h] [ebp-100h]
  float v270; // [esp+56Ch] [ebp-FCh]
  float v271; // [esp+570h] [ebp-F8h]
  float v272; // [esp+574h] [ebp-F4h]
  float v273; // [esp+578h] [ebp-F0h]
  float v274; // [esp+57Ch] [ebp-ECh]
  float v275; // [esp+580h] [ebp-E8h]
  float v276; // [esp+584h] [ebp-E4h]
  float v277; // [esp+58Ch] [ebp-DCh]
  float v278; // [esp+590h] [ebp-D8h]
  float v279; // [esp+594h] [ebp-D4h]
  float v280; // [esp+598h] [ebp-D0h]
  float v281; // [esp+59Ch] [ebp-CCh]
  float v282; // [esp+5A0h] [ebp-C8h]
  float v283; // [esp+5A4h] [ebp-C4h]
  float v284; // [esp+5A8h] [ebp-C0h]
  float v285; // [esp+5ACh] [ebp-BCh]
  float v286; // [esp+5B0h] [ebp-B8h]
  float v287; // [esp+5B4h] [ebp-B4h]
  float v288; // [esp+5B8h] [ebp-B0h]
  float v289; // [esp+5BCh] [ebp-ACh]
  float v290; // [esp+5C4h] [ebp-A4h]
  float v291; // [esp+5CCh] [ebp-9Ch]
  float v292; // [esp+5D4h] [ebp-94h]
  float v293; // [esp+5DCh] [ebp-8Ch]
  float v294; // [esp+5E4h] [ebp-84h]
  float v295; // [esp+5E8h] [ebp-80h]
  float v296; // [esp+5ECh] [ebp-7Ch]
  float v297; // [esp+5F0h] [ebp-78h]
  float v298; // [esp+5F4h] [ebp-74h]
  float v299; // [esp+5F8h] [ebp-70h]
  float v300; // [esp+5FCh] [ebp-6Ch]
  float v301; // [esp+600h] [ebp-68h]
  float v302; // [esp+604h] [ebp-64h]
  float v303; // [esp+60Ch] [ebp-5Ch]
  float v304; // [esp+614h] [ebp-54h]
  float v305; // [esp+61Ch] [ebp-4Ch]
  float v306; // [esp+624h] [ebp-44h]
  float v307; // [esp+634h] [ebp-34h]
  float v308; // [esp+63Ch] [ebp-2Ch]
  float v309; // [esp+644h] [ebp-24h]
  float v310; // [esp+64Ch] [ebp-1Ch]
  float v311; // [esp+654h] [ebp-14h]
  float v312; // [esp+65Ch] [ebp-Ch]
  float v313; // [esp+664h] [ebp-4h]
  float v314; // [esp+66Ch] [ebp+4h]
  float v315; // [esp+670h] [ebp+8h]
  float v316; // [esp+678h] [ebp+10h]

  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  v0 = *(_DWORD *)grim_interface_ptr;
  v234 = v314 * 0.5;
  (*(void (__thiscall **)(int, int, _DWORD, _DWORD, float))(v0 + 276))(
    grim_interface_ptr,
    1065353216,
    0,
    0,
    COERCE_FLOAT(LODWORD(v234)));
  v1 = *(_DWORD *)grim_interface_ptr;
  v231 = v314 * 0.2;
  (*(void (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, float))(v1 + 280))(
    grim_interface_ptr,
    2,
    0,
    0,
    0,
    COERCE_FLOAT(LODWORD(v231)));
  (*(void (__thiscall **)(int, int, _DWORD, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 280))(
    grim_interface_ptr,
    3,
    0,
    0,
    0,
    COERCE_FLOAT(LODWORD(v231)));
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    bullet_trail_texture,
    0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1056964608);
  v2 = 0;
  if ( config_player_count > 0 )
  {
    v3 = (float *)player_aim_heading;
    do
    {
      if ( *(v3 - 183) > 0.0 )
      {
        v4 = *v3 - 1.5707964;
        v5 = *(v3 - 186);
        v243 = *(v3 - 187);
        v244 = v5;
        v238 = sin(v4);
        v260 = v238 * 512.0;
        v273 = cos(v4) * 512.0 + *(v3 - 187);
        v274 = v260 + *(v3 - 186);
        v6 = v4 - 0.150915;
        v257 = cos(v6) * 15.0;
        v243 = v243 + v257;
        v244 = v5 + sin(v6) * 15.0;
        v7 = cos(*v3) * 1.1;
        v270 = sin(*v3) * 1.1;
        v8 = v243 + *(float *)&camera_offset_x;
        v231 = v244 + *(float *)&camera_offset_y;
        v289 = v231;
        v296 = v231;
        v249 = v8 - v7;
        v250 = v231 - v270;
        v263 = v8 + v7;
        v264 = v231 + v270;
        v9 = v273 + *(float *)&camera_offset_x;
        v231 = v274 + *(float *)&camera_offset_y;
        v254 = v231;
        v242 = v231;
        v10 = (int)*(&player_perk_counts + perk_id_sharpshooter);
        v261 = v9 + v7;
        v262 = v231 + v270;
        v265 = v9 - v7;
        v266 = v231 - v270;
        if ( v10 > 0 )
        {
          (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
            grim_interface_ptr,
            20,
            2,
            LODWORD(v224[1]),
            LODWORD(v224[2]),
            COERCE_FLOAT(LODWORD(v225)));
          (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
          (*(void (__thiscall **)(int, float, float, float, float, float, float, float, float))(*(_DWORD *)grim_interface_ptr
                                                                                              + 312))(
            grim_interface_ptr,
            COERCE_FLOAT(LODWORD(v249)),
            COERCE_FLOAT(LODWORD(v250)),
            COERCE_FLOAT(LODWORD(v263)),
            COERCE_FLOAT(LODWORD(v264)),
            COERCE_FLOAT(LODWORD(v261)),
            COERCE_FLOAT(LODWORD(v262)),
            COERCE_FLOAT(LODWORD(v265)),
            COERCE_FLOAT(LODWORD(v266)));
          (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
          (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
            grim_interface_ptr,
            20,
            6,
            LODWORD(v224[1]),
            LODWORD(v224[2]),
            COERCE_FLOAT(LODWORD(v225)));
        }
      }
      ++v2;
      v3 += 216;
    }
    while ( v2 < config_player_count );
  }
  v231 = 0.0;
  (*(void (__thiscall **)(int, _DWORD, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 280))(
    grim_interface_ptr,
    0,
    1056964608,
    1056964608,
    1056964608,
    0);
  (*(void (__thiscall **)(int, int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 280))(
    grim_interface_ptr,
    1,
    1056964608,
    1056964608,
    1056964608,
    0);
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    2,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  v11 = (char *)&projectile_vel_y;
  do
  {
    if ( *(v11 - 28) )
    {
      v12 = *((_DWORD *)v11 + 1);
      if ( v12 <= 7 || v12 == 29 )
      {
        if ( !v12 )
          *(v11 - 28) = 0;
        v307 = *((float *)v11 + 2);
        if ( v307 <= 1.0 )
        {
          if ( v307 < 0.0 )
            v307 = 0.0;
        }
        else
        {
          v307 = 1.0;
        }
        v13 = *(_DWORD *)grim_interface_ptr;
        v231 = v307 * v314;
        (*(void (__thiscall **)(int, int, int, int, int, float))(v13 + 280))(
          grim_interface_ptr,
          2,
          1056964608,
          1056964608,
          1056964608,
          COERCE_FLOAT(LODWORD(v231)));
        (*(void (__thiscall **)(int, int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 280))(
          grim_interface_ptr,
          3,
          1056964608,
          1056964608,
          1056964608,
          COERCE_FLOAT(LODWORD(v231)));
        v14 = *((_DWORD *)v11 + 1);
        switch ( v14 )
        {
          case 2:
            v15 = *(float *)&camera_offset_x + *((float *)v11 - 3);
            v230 = *(float *)&camera_offset_y + *((float *)v11 - 2);
            v312 = v230;
            v16 = v15 - *((float *)v11 - 1);
            v309 = v230;
            v269 = v16;
            v17 = v269;
            v270 = v230 - *(float *)v11;
            v18 = v270;
            v273 = v15 + *((float *)v11 - 1);
            v19 = v273;
            v274 = v230 + *(float *)v11;
            v20 = *(float *)&camera_offset_x + *((float *)v11 - 5);
            v21 = v274;
            v230 = *(float *)&camera_offset_y + *((float *)v11 - 4);
            v311 = v230;
            v265 = v20 + *((float *)v11 - 1);
            v22 = v230 + *(float *)v11;
            v241 = v265;
            v266 = v22;
            v23 = v20 - *((float *)v11 - 1);
            v242 = v266;
            v310 = v230;
            v261 = v23;
            v24 = v230 - *(float *)v11;
            v253 = v261;
            v262 = v24;
            v25 = v262;
            break;
          case 1:
            v26 = *((float *)v11 - 1) * 1.2;
            v263 = v26;
            v240 = *(float *)v11 * 1.2;
            v264 = v240;
            v27 = *(float *)&camera_offset_x + *((float *)v11 - 3);
            v230 = *(float *)&camera_offset_y + *((float *)v11 - 2);
            v308 = v230;
            v313 = v230;
            v306 = v240;
            v243 = v27 - v263;
            v17 = v243;
            v244 = v230 - v240;
            v18 = v244;
            v249 = v26;
            v250 = v240;
            v278 = v27 + v249;
            v19 = v278;
            v279 = v230 + v240;
            v21 = v279;
            v28 = *(float *)&camera_offset_x + *((float *)v11 - 5);
            *(float *)&v239 = v28;
            v230 = *(float *)&camera_offset_y + *((float *)v11 - 4);
            v303 = v230;
            v286 = v28 + v26;
            v241 = v286;
            v287 = v230 + v240;
            v242 = v287;
            v304 = v240;
            v251 = *(float *)&v239 - v26;
            v305 = v230;
            v253 = v251;
            v252 = v230 - v240;
            v25 = v252;
            break;
          case 6:
            (*(void (__thiscall **)(int, int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 280))(
              grim_interface_ptr,
              2,
              1045220557,
              1056964608,
              1065353216,
              COERCE_FLOAT(LODWORD(v307)));
            (*(void (__thiscall **)(int, int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 280))(
              grim_interface_ptr,
              3,
              1045220557,
              1056964608,
              1065353216,
              COERCE_FLOAT(LODWORD(v307)));
            v29 = *((float *)v11 - 1) * 1.1;
            v284 = v29;
            v240 = *(float *)v11 * 1.1;
            v285 = v240;
            v30 = *(float *)&camera_offset_x + *((float *)v11 - 3);
            v230 = *(float *)&camera_offset_y + *((float *)v11 - 2);
            v292 = v230;
            v293 = v230;
            v291 = v240;
            v282 = v30 - v284;
            v17 = v282;
            v283 = v230 - v240;
            v18 = v283;
            v245 = v29;
            v246 = v240;
            v267 = v30 + v245;
            v19 = v267;
            v268 = v230 + v240;
            v21 = v268;
            v31 = *(float *)&camera_offset_x + *((float *)v11 - 5);
            *(float *)&v239 = v31;
            v230 = *(float *)&camera_offset_y + *((float *)v11 - 4);
            v290 = v230;
            radius = v31 + v29;
            v241 = radius;
            v256 = v230 + v240;
            v242 = v256;
            v294 = v240;
            v300 = v230;
            v232 = *(float *)&v239 - v29;
            v253 = v232;
            v233 = v230 - v240;
            v25 = v233;
            break;
          default:
            v32 = *((float *)v11 - 1) * 0.69999999;
            v235 = v32;
            v240 = *(float *)v11 * 0.69999999;
            v236 = v240;
            v33 = *(float *)&camera_offset_x + *((float *)v11 - 3);
            v230 = *(float *)&camera_offset_y + *((float *)v11 - 2);
            v298 = v230;
            v302 = v230;
            v277 = v240;
            v295 = v33 - v235;
            v17 = v295;
            v296 = v230 - v240;
            v18 = v296;
            v288 = v32;
            v289 = v240;
            v257 = v33 + v288;
            v19 = v257;
            v258 = v230 + v240;
            v21 = v258;
            v34 = *(float *)&camera_offset_x + *((float *)v11 - 5);
            *(float *)&v239 = v34;
            v230 = *(float *)&camera_offset_y + *((float *)v11 - 4);
            v281 = v230;
            v259 = v34 + v32;
            v241 = v259;
            v260 = v230 + v240;
            v242 = v260;
            v272 = v240;
            v237 = *(float *)&v239 - v32;
            v276 = v230;
            v253 = v237;
            v238 = v230 - v240;
            v25 = v238;
            break;
        }
        (*(void (__thiscall **)(int, float, float, float, float, float, float, float, float))(*(_DWORD *)grim_interface_ptr
                                                                                            + 312))(
          grim_interface_ptr,
          COERCE_FLOAT(LODWORD(v17)),
          COERCE_FLOAT(LODWORD(v18)),
          COERCE_FLOAT(LODWORD(v19)),
          COERCE_FLOAT(LODWORD(v21)),
          COERCE_FLOAT(LODWORD(v241)),
          COERCE_FLOAT(LODWORD(v242)),
          COERCE_FLOAT(LODWORD(v253)),
          COERCE_FLOAT(LODWORD(v25)));
      }
    }
    v11 += 64;
  }
  while ( (int)v11 < (int)particle_scale_z );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    2,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    particles_texture,
    0);
  effect_select_texture(13);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  if ( *(float *)&player_muzzle_flash_alpha[216 * render_overlay_player_index] > 0.0 )
  {
    v35 = *(float *)&player_aim_heading[216 * render_overlay_player_index] - 1.5707964;
    v225 = *(float *)&grim_interface_ptr;
    v36 = v35 - 0.150915;
    v37 = *(_DWORD *)grim_interface_ptr;
    v237 = cos(v36) * 15.0;
    v238 = sin(v36) * 15.0;
    v225 = v314 * *(float *)&player_muzzle_flash_alpha[216 * render_overlay_player_index];
    (*(void (__stdcall **)(int, int, int, float))(v37 + 276))(
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v225)));
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v225 = 160.0;
    v224[2] = 160.0;
    LODWORD(v224[1]) = grim_interface_ptr;
    v38 = *(_DWORD *)grim_interface_ptr;
    v224[1] = v238 + *(float *)&player_pos_y[216 * render_overlay_player_index] + *(float *)&camera_offset_y - 80.0;
    v224[0] = v237 + *(float *)&player_pos_x[216 * render_overlay_player_index] + *(float *)&camera_offset_x - 80.0;
    (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v38 + 284))(
      LODWORD(v224[0]),
      LODWORD(v224[1]),
      1126170624,
      1126170624);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  }
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v39 = (float *)&projectile_pos_y;
  do
  {
    if ( !*((_BYTE *)v39 - 12) )
      goto LABEL_76;
    v40 = *((_DWORD *)v39 + 5);
    if ( v40 != 9 && v40 != 11 && v40 != 26 && v40 != 24 && v40 != 28 )
      goto LABEL_76;
    if ( *((_DWORD *)v39 + 6) != 1053609165 )
    {
      v100 = v39[6] * 2.5;
      if ( v100 <= 1.0 )
      {
        if ( v100 < 0.0 )
          v100 = 0.0;
      }
      else
      {
        v100 = 1.0;
      }
      v101 = *(_DWORD *)grim_interface_ptr;
      v225 = v100 * v314;
      (*(void (__stdcall **)(int, int, int, float))(v101 + 276))(
        1065353216,
        1065353216,
        1065353216,
        COERCE_FLOAT(LODWORD(v225)));
      v102 = *(float *)&camera_offset_y + *v39;
      v225 = 56.0;
      v224[2] = 56.0;
      LODWORD(v224[1]) = grim_interface_ptr;
      v98 = *(_DWORD *)grim_interface_ptr;
      v224[1] = v102 - 28.0;
      v99 = *(float *)&camera_offset_x + *(v39 - 1) - 28.0;
      goto LABEL_75;
    }
    if ( v40 != 9 )
    {
      if ( v40 == 11 )
      {
        v53 = v39[2] - *v39;
        v54 = v39[1] - *(v39 - 1);
        v55 = (int)(__int64)sqrt(v53 * v53 + v54 * v54) / (int)(__int64)(v39[8] * 2.0999999);
        if ( v55 > 3 )
          v55 = 3;
        v56 = *(v39 - 2) + 1.5707964;
        v225 = *(float *)&grim_interface_ptr;
        v57 = *(_DWORD *)grim_interface_ptr;
        v245 = cos(v56) * v39[8] * 2.0999999;
        v230 = sin(v56) * v39[8] * 2.0999999;
        v225 = v314 * 0.40000001;
        (*(void (__stdcall **)(int, int, int, float))(v57 + 276))(
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v225)));
        v58 = 0.0;
        v232 = 0.0;
        if ( v55 > 0 )
        {
          do
          {
            v59 = (double)SLODWORD(v232);
            v225 = 12.0;
            v224[2] = 12.0;
            LODWORD(v224[1]) = grim_interface_ptr;
            v60 = *(_DWORD *)grim_interface_ptr;
            v224[1] = v59 * v230 + *v39 + *(float *)&camera_offset_y - 6.0;
            LODWORD(v224[0]) = grim_interface_ptr;
            v224[0] = v59 * v245 + *(v39 - 1) + *(float *)&camera_offset_x - 6.0;
            (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v60 + 284))(
              LODWORD(v224[0]),
              LODWORD(v224[1]),
              1094713344,
              1094713344);
            ++LODWORD(v58);
            v232 = v58;
          }
          while ( SLODWORD(v58) < v55 );
        }
        (*(void (__thiscall **)(int, int, int, int, float, float, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v234)),
          COERCE_FLOAT(LODWORD(v226)),
          v227,
          COERCE_FLOAT(LODWORD(v228)));
        v61 = *(float *)&camera_offset_y + *v39;
        v228 = 16.0;
        v227 = 1098907648;
        v226 = *(float *)&grim_interface_ptr;
        v62 = *(_DWORD *)grim_interface_ptr;
        v226 = v61 - 8.0;
        v225 = *(float *)&camera_offset_x + *(v39 - 1) - 8.0;
        (*(void (__stdcall **)(float, float, int, int))(v62 + 284))(
          COERCE_FLOAT(LODWORD(v225)),
          COERCE_FLOAT(LODWORD(v226)),
          1098907648,
          1098907648);
        v63 = *(_DWORD *)grim_interface_ptr;
        v228 = v316 * 0.15000001;
        v227 = 1065353216;
        v226 = 1.0;
        v225 = 1.0;
      }
      else
      {
        if ( v40 == 28 )
        {
          v64 = v39[2] - *v39;
          v65 = v39[1] - *(v39 - 1);
          v66 = (int)(__int64)sqrt(v65 * v65 + v64 * v64) / (int)(__int64)(v39[8] * 3.5);
          if ( v66 > 18 )
            v66 = 18;
          v67 = *(v39 - 2) + 1.5707964;
          v68 = *(_DWORD *)grim_interface_ptr;
          v245 = cos(v67) * v39[8] * 2.5999999;
          v230 = sin(v67) * v39[8] * 2.5999999;
          v231 = v314 * 0.40000001;
          (*(void (__stdcall **)(int, int, int, float))(v68 + 276))(
            1065353216,
            1065353216,
            1065353216,
            COERCE_FLOAT(LODWORD(v231)));
          v69 = 0.0;
          v232 = 0.0;
          if ( v66 > 0 )
          {
            do
            {
              v70 = (double)SLODWORD(v232);
              v225 = 44.0;
              v224[2] = 44.0;
              LODWORD(v224[1]) = grim_interface_ptr;
              v71 = *(_DWORD *)grim_interface_ptr;
              v224[1] = v70 * v230 + *v39 + *(float *)&camera_offset_y - 22.0;
              LODWORD(v224[0]) = grim_interface_ptr;
              v224[0] = v70 * v245 + *(v39 - 1) + *(float *)&camera_offset_x - 22.0;
              (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v71 + 284))(
                LODWORD(v224[0]),
                LODWORD(v224[1]),
                1110441984,
                1110441984);
              ++LODWORD(v69);
              v232 = v69;
            }
            while ( SLODWORD(v69) < v66 );
          }
          v72 = *(_DWORD *)grim_interface_ptr;
          v225 = v314 * 0.44999999;
          (*(void (__stdcall **)(int, int, int, float, float))(v72 + 276))(
            1065353216,
            1065353216,
            1065353216,
            COERCE_FLOAT(LODWORD(v225)),
            COERCE_FLOAT(LODWORD(v226)));
          v73 = *(float *)&camera_offset_y + *v39;
          v226 = 84.0;
          v225 = 84.0;
          LODWORD(v224[2]) = grim_interface_ptr;
          v74 = *(_DWORD *)grim_interface_ptr;
          v224[2] = v73 - 42.0;
          v224[1] = *(float *)&camera_offset_x + *(v39 - 1) - 42.0;
          (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v74 + 284))(
            LODWORD(v224[1]),
            LODWORD(v224[2]),
            1118306304,
            1118306304);
          v226 = v231;
          v52 = *(_DWORD *)grim_interface_ptr;
          goto LABEL_54;
        }
        if ( v40 == 26 )
        {
          v77 = v39[2] - *v39;
          v78 = v39[1] - *(v39 - 1);
          v79 = (int)(__int64)sqrt(v78 * v78 + v77 * v77) / (int)(__int64)(v39[8] * 2.0999999);
          if ( v79 > 3 )
            v79 = 3;
          v80 = *(v39 - 2) + 1.5707964;
          v225 = *(float *)&grim_interface_ptr;
          v81 = *(_DWORD *)grim_interface_ptr;
          v245 = cos(v80) * v39[8] * 2.0999999;
          v230 = sin(v80) * v39[8] * 2.0999999;
          v225 = v314 * 0.40000001;
          (*(void (__stdcall **)(int, int, int, float))(v81 + 276))(
            1050253722,
            1065353216,
            1050253722,
            COERCE_FLOAT(LODWORD(v225)));
          v82 = 0.0;
          v232 = 0.0;
          if ( v79 > 0 )
          {
            do
            {
              v83 = (double)SLODWORD(v232);
              v225 = 12.0;
              v224[2] = 12.0;
              LODWORD(v224[1]) = grim_interface_ptr;
              v84 = *(_DWORD *)grim_interface_ptr;
              v224[1] = v83 * v230 + *v39 + *(float *)&camera_offset_y - 6.0;
              LODWORD(v224[0]) = grim_interface_ptr;
              v224[0] = v83 * v245 + *(v39 - 1) + *(float *)&camera_offset_x - 6.0;
              (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v84 + 284))(
                LODWORD(v224[0]),
                LODWORD(v224[1]),
                1094713344,
                1094713344);
              ++LODWORD(v82);
              v232 = v82;
            }
            while ( SLODWORD(v82) < v79 );
          }
          (*(void (__thiscall **)(int, int, int, int, float, float, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            1050253722,
            1065353216,
            1050253722,
            COERCE_FLOAT(LODWORD(v234)),
            COERCE_FLOAT(LODWORD(v226)),
            v227,
            COERCE_FLOAT(LODWORD(v228)));
          v85 = *(float *)&camera_offset_y + *v39;
          v228 = 16.0;
          v227 = 1098907648;
          v226 = *(float *)&grim_interface_ptr;
          v86 = *(_DWORD *)grim_interface_ptr;
          v226 = v85 - 8.0;
          v225 = *(float *)&camera_offset_x + *(v39 - 1) - 8.0;
          (*(void (__stdcall **)(float, float, int, int))(v86 + 284))(
            COERCE_FLOAT(LODWORD(v225)),
            COERCE_FLOAT(LODWORD(v226)),
            1098907648,
            1098907648);
          v63 = *(_DWORD *)grim_interface_ptr;
          v228 = v316 * 0.15000001;
          v227 = 1050253722;
          v226 = 1.0;
        }
        else
        {
          v87 = v39[2] - *v39;
          v88 = v39[1] - *(v39 - 1);
          v89 = (int)(__int64)sqrt(v88 * v88 + v87 * v87) / (int)(__int64)(v39[8] * 2.0999999);
          if ( v89 > 3 )
            v89 = 3;
          v90 = *(v39 - 2) + 1.5707964;
          v225 = *(float *)&grim_interface_ptr;
          v91 = *(_DWORD *)grim_interface_ptr;
          v245 = cos(v90) * v39[8] * 2.0999999;
          v230 = sin(v90) * v39[8] * 2.0999999;
          v225 = v314 * 0.40000001;
          (*(void (__stdcall **)(int, int, int, float))(v91 + 276))(
            1050253722,
            1050253722,
            1065353216,
            COERCE_FLOAT(LODWORD(v225)));
          v92 = 0.0;
          v232 = 0.0;
          if ( v89 > 0 )
          {
            do
            {
              v93 = (double)SLODWORD(v232);
              v225 = 12.0;
              v224[2] = 12.0;
              LODWORD(v224[1]) = grim_interface_ptr;
              v94 = *(_DWORD *)grim_interface_ptr;
              v224[1] = v93 * v230 + *v39 + *(float *)&camera_offset_y - 6.0;
              LODWORD(v224[0]) = grim_interface_ptr;
              v224[0] = v93 * v245 + *(v39 - 1) + *(float *)&camera_offset_x - 6.0;
              (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v94 + 284))(
                LODWORD(v224[0]),
                LODWORD(v224[1]),
                1094713344,
                1094713344);
              ++LODWORD(v92);
              v232 = v92;
            }
            while ( SLODWORD(v92) < v89 );
          }
          (*(void (__thiscall **)(int, int, int, int, float, float, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            1050253722,
            1050253722,
            1065353216,
            COERCE_FLOAT(LODWORD(v234)),
            COERCE_FLOAT(LODWORD(v226)),
            v227,
            COERCE_FLOAT(LODWORD(v228)));
          v95 = *(float *)&camera_offset_y + *v39;
          v228 = 16.0;
          v227 = 1098907648;
          v226 = *(float *)&grim_interface_ptr;
          v96 = *(_DWORD *)grim_interface_ptr;
          v226 = v95 - 8.0;
          v225 = *(float *)&camera_offset_x + *(v39 - 1) - 8.0;
          (*(void (__stdcall **)(float, float, int, int))(v96 + 284))(
            COERCE_FLOAT(LODWORD(v225)),
            COERCE_FLOAT(LODWORD(v226)),
            1098907648,
            1098907648);
          v63 = *(_DWORD *)grim_interface_ptr;
          v228 = v316 * 0.15000001;
          v227 = 1065353216;
          v226 = 0.30000001;
        }
        v225 = 0.30000001;
      }
      (*(void (__stdcall **)(float))(v63 + 276))(COERCE_FLOAT(LODWORD(v225)));
      if ( !config_fx_detail_flag1 )
        goto LABEL_76;
      v97 = *(float *)&camera_offset_y + *v39;
      v225 = 120.0;
      v224[2] = 120.0;
      LODWORD(v224[1]) = grim_interface_ptr;
      v98 = *(_DWORD *)grim_interface_ptr;
      v224[1] = v97 - 60.0;
      v99 = *(float *)&camera_offset_x + *(v39 - 1) - 60.0;
LABEL_75:
      v224[0] = v99;
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, float))(v98 + 284))(
        LODWORD(v224[0]),
        LODWORD(v224[1]),
        LODWORD(v224[2]),
        COERCE_FLOAT(LODWORD(v225)));
      goto LABEL_76;
    }
    v41 = v39[2] - *v39;
    v42 = v39[1] - *(v39 - 1);
    v43 = (int)(__int64)sqrt(v41 * v41 + v42 * v42) / (int)(__int64)(v39[8] * 2.5);
    if ( v43 > 8 )
      v43 = 8;
    v44 = *(v39 - 2) + 1.5707964;
    v225 = *(float *)&grim_interface_ptr;
    v45 = *(_DWORD *)grim_interface_ptr;
    v245 = cos(v44) * v39[8] * 2.5;
    v230 = sin(v44) * v39[8] * 2.5;
    v225 = v314 * 0.40000001;
    (*(void (__stdcall **)(int, int, int, float))(v45 + 276))(
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v225)));
    v46 = 0.0;
    v232 = 0.0;
    if ( v43 > 0 )
    {
      do
      {
        v47 = (double)SLODWORD(v232);
        v225 = 22.0;
        v224[2] = 22.0;
        LODWORD(v224[1]) = grim_interface_ptr;
        v48 = *(_DWORD *)grim_interface_ptr;
        v224[1] = v47 * v230 + *v39 + *(float *)&camera_offset_y - 11.0;
        LODWORD(v224[0]) = grim_interface_ptr;
        v224[0] = v47 * v245 + *(v39 - 1) + *(float *)&camera_offset_x - 11.0;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v48 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          1102053376,
          1102053376);
        ++LODWORD(v46);
        v232 = v46;
      }
      while ( SLODWORD(v46) < v43 );
    }
    v49 = *(_DWORD *)grim_interface_ptr;
    v225 = v314 * 0.44999999;
    (*(void (__stdcall **)(int, int, int, float, float))(v49 + 276))(
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v225)),
      COERCE_FLOAT(LODWORD(v226)));
    v50 = *(float *)&camera_offset_y + *v39;
    v226 = 56.0;
    v225 = 56.0;
    LODWORD(v224[2]) = grim_interface_ptr;
    v51 = *(_DWORD *)grim_interface_ptr;
    v224[2] = v50 - 28.0;
    v224[1] = *(float *)&camera_offset_x + *(v39 - 1) - 28.0;
    (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v51 + 284))(
      LODWORD(v224[1]),
      LODWORD(v224[2]),
      1113587712,
      1113587712);
    v52 = *(_DWORD *)grim_interface_ptr;
    v226 = v315 * 0.30000001;
LABEL_54:
    (*(void (__stdcall **)(int, int, int))(v52 + 276))(1065353216, 1065353216, 1065353216);
    if ( config_fx_detail_flag1 )
    {
      v75 = *(float *)&camera_offset_y + *v39;
      v225 = 256.0;
      v224[2] = 256.0;
      LODWORD(v224[1]) = grim_interface_ptr;
      v76 = *(_DWORD *)grim_interface_ptr;
      v224[1] = v75 - 128.0;
      v224[0] = *(float *)&camera_offset_x + *(v39 - 1) - 128.0;
      (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v76 + 284))(
        LODWORD(v224[0]),
        LODWORD(v224[1]),
        1132462080,
        1132462080);
    }
LABEL_76:
    v39 += 16;
  }
  while ( (int)v39 < (int)&particle_vel_x );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  v231 = 1.0;
  if ( perk_count_get(perk_id_ion_gun_master) )
    v231 = 1.2;
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    projectile_texture,
    0);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v103 = v314;
  *(float *)&v239 = 0.0;
  v104 = &projectile_origin_y;
  while ( 2 )
  {
    v105 = *((_BYTE *)v104 - 20);
    LODWORD(v106) = v104 - 5;
    LODWORD(v240) = v104 - 5;
    if ( v105 )
    {
      v107 = v104[3];
      if ( v107 == 19 )
      {
        if ( v104[4] == 1053609165 )
        {
          v108 = *(float *)v104 - *((float *)v104 - 2);
          v109 = *((float *)v104 - 1) - *((float *)v104 - 3);
          v225 = *((float *)v104 - 4);
          v110 = *(_DWORD *)grim_interface_ptr;
          v235 = sqrt(v109 * v109 + v108 * v108) * 0.0099999998;
          (*(void (__thiscall **)(int, float))(v110 + 252))(grim_interface_ptr, COERCE_FLOAT(LODWORD(v225)));
          (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 2, 0);
          v111 = *(_DWORD *)grim_interface_ptr;
          v225 = v314 * 0.69999999;
          (*(void (__stdcall **)(int, int, int, float))(v111 + 276))(
            1036831949,
            1058642330,
            1045220557,
            COERCE_FLOAT(LODWORD(v225)));
          v112 = *(_DWORD *)grim_interface_ptr;
          v267 = v235 * 16.0;
          v113 = v235 * 8.0;
          v114 = v267;
          goto LABEL_84;
        }
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, *(v104 - 4));
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 2, 0);
        v116 = *((float *)v104 + 4) * 2.5;
        if ( v116 <= 1.0 )
        {
          if ( v116 < 0.0 )
            v116 = 0.0;
        }
        else
        {
          v116 = 1.0;
        }
        v117 = *(_DWORD *)grim_interface_ptr;
        v225 = v116 * v314;
        (*(void (__stdcall **)(int, int, int, float))(v117 + 276))(
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v225)));
        v118 = *(float *)&camera_offset_y + *((float *)v104 - 2);
        v225 = 56.0;
        v224[2] = 56.0;
        LODWORD(v224[1]) = grim_interface_ptr;
        v119 = *(_DWORD *)grim_interface_ptr;
        v224[1] = v118 - 28.0;
        v224[0] = *(float *)&camera_offset_x + *((float *)v104 - 3) - 28.0;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v119 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          1113587712,
          1113587712);
      }
      else
      {
        if ( v107 == 29 )
        {
          if ( v104[4] != 1053609165 )
            goto LABEL_153;
          v120 = *(float *)v104 - *((float *)v104 - 2);
          v121 = *((float *)v104 - 1) - *((float *)v104 - 3);
          v122 = sqrt(v121 * v121 + v120 * v120);
          v235 = v122;
          if ( v122 > 20.0 )
            v235 = 20.0;
          (*(void (__thiscall **)(int, _DWORD, float, int, float, float))(*(_DWORD *)grim_interface_ptr + 252))(
            grim_interface_ptr,
            *(v104 - 4),
            COERCE_FLOAT(LODWORD(v226)),
            v227,
            COERCE_FLOAT(LODWORD(v228)),
            COERCE_FLOAT(LODWORD(v229)));
          (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, 3);
          v229 = v103;
          v228 = 1.0;
          v227 = 1065353216;
          v123 = *(_DWORD *)grim_interface_ptr;
          v226 = 1.0;
        }
        else
        {
          if ( v107 != 25 )
          {
            if ( v107 == 22 || v107 == 21 || v107 == 23 || v107 == 45 )
            {
              if ( v104[4] == 1053609165 )
              {
                if ( v107 == 22 )
                {
                  v235 = 1.05;
                }
                else if ( v107 == 21 )
                {
                  v235 = 2.2;
                }
                else
                {
                  v235 = 0.80000001;
                  if ( v107 != 45 )
                    v235 = 3.5;
                }
                (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 2, 2);
                v128 = *((float *)v104 - 3) - *((float *)v104 - 1);
                v225 = COERCE_FLOAT(&v247);
                v263 = v128;
                v129 = *((float *)v104 - 2) - *(float *)v104;
                v247 = v263;
                v264 = v129;
                v248 = v264;
                radius = sqrt(v263 * v263 + v264 * v264);
                j_FUN_00452f1d(&v247);
                if ( v104[3] == 45 )
                  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
                    grim_interface_ptr,
                    1065353216,
                    1058642330,
                    1036831949,
                    COERCE_FLOAT(LODWORD(v103)));
                else
                  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
                    grim_interface_ptr,
                    1056964608,
                    1058642330,
                    1065353216,
                    COERCE_FLOAT(LODWORD(v103)));
                (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, 2);
                v267 = v235 * 16.0;
                v265 = *(float *)&camera_offset_x + *((float *)v104 - 1) - v267;
                v266 = *(float *)&camera_offset_y + *(float *)v104 - v267;
                if ( radius <= 256.0 )
                {
                  v245 = 0.0;
                  v282 = radius;
                }
                else
                {
                  v282 = 256.0;
                  v245 = radius - 256.0;
                }
                v130 = v235 * 3.0999999;
                v232 = v130;
                if ( v130 > 9.0 )
                  v232 = 9.0;
                v286 = v245;
                if ( v245 < (double)radius )
                {
                  v234 = v235 * 32.0;
                  do
                  {
                    if ( v104[3] == 45 )
                    {
                      v131 = *(_DWORD *)grim_interface_ptr;
                      v225 = (v245 - v286) / v282 * v314;
                      (*(void (__stdcall **)(int, int, int, float))(v131 + 276))(
                        1065353216,
                        1058642330,
                        1036831949,
                        COERCE_FLOAT(LODWORD(v225)));
                    }
                    else
                    {
                      v132 = *(_DWORD *)grim_interface_ptr;
                      v225 = (v245 - v286) / v282 * v314;
                      (*(void (__stdcall **)(int, int, int, float))(v132 + 276))(
                        1056964608,
                        1058642330,
                        1065353216,
                        COERCE_FLOAT(LODWORD(v225)));
                    }
                    v225 = v234;
                    v224[2] = v234;
                    LODWORD(v224[1]) = grim_interface_ptr;
                    v133 = *(_DWORD *)grim_interface_ptr;
                    v224[1] = v248 * v245 + v266;
                    v224[0] = v247 * v245 + v265;
                    (*(void (__stdcall **)(_DWORD, _DWORD, float, float))(v133 + 284))(
                      LODWORD(v224[0]),
                      LODWORD(v224[1]),
                      COERCE_FLOAT(LODWORD(v234)),
                      COERCE_FLOAT(LODWORD(v234)));
                    v134 = v232 + v245;
                    v245 = v134;
                  }
                  while ( v134 < radius );
                }
                v106 = v240;
                (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(
                  grim_interface_ptr,
                  *(_DWORD *)(LODWORD(v240) + 4));
                v103 = v314;
                (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
                  grim_interface_ptr,
                  1065353216,
                  1065353216,
                  1060320051,
                  COERCE_FLOAT(LODWORD(v314)));
                v135 = *(_DWORD *)grim_interface_ptr;
                v234 = v235 * 32.0;
                v136 = *(float *)&camera_offset_y + *(float *)(LODWORD(v240) + 12);
                v225 = v234;
                v224[2] = v234;
                v224[1] = v136 - v267;
                v224[0] = *(float *)&camera_offset_x + *(float *)(LODWORD(v240) + 8) - v267;
                (*(void (__stdcall **)(_DWORD, _DWORD, float, float))(v135 + 284))(
                  LODWORD(v224[0]),
                  LODWORD(v224[1]),
                  COERCE_FLOAT(LODWORD(v234)),
                  COERCE_FLOAT(LODWORD(v234)));
              }
              else
              {
                (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(
                  grim_interface_ptr,
                  *(v104 - 4));
                (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, 2);
                v137 = *((float *)v104 + 4) * 2.5;
                v232 = v137;
                if ( v137 <= 1.0 )
                {
                  if ( v232 < 0.0 )
                    v232 = 0.0;
                }
                else
                {
                  v232 = 1.0;
                }
                v138 = *((float *)v104 - 3) - *((float *)v104 - 1);
                v225 = COERCE_FLOAT(&v247);
                v261 = v138;
                v139 = *((float *)v104 - 2) - *(float *)v104;
                v247 = v261;
                v262 = v139;
                v248 = v262;
                radius = sqrt(v261 * v261 + v262 * v262);
                j_FUN_00452f1d(&v247);
                v140 = v104[3];
                if ( v140 == 22 )
                {
                  v235 = 1.05;
                }
                else if ( v140 == 21 )
                {
                  v235 = 2.2;
                }
                else
                {
                  v235 = 0.80000001;
                  if ( v140 != 45 )
                    v235 = 3.5;
                }
                (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, 2);
                v267 = v235 * 16.0;
                v265 = *(float *)&camera_offset_x + *((float *)v104 - 1) - v267;
                v266 = *(float *)&camera_offset_y + *(float *)v104 - v267;
                if ( radius <= 256.0 )
                {
                  v230 = 0.0;
                  v284 = radius;
                }
                else
                {
                  v284 = 256.0;
                  v230 = radius - 256.0;
                }
                v141 = v235 * 3.0999999;
                v251 = v141;
                if ( v141 > 9.0 )
                  v251 = 9.0;
                v278 = v230;
                if ( v230 < (double)radius )
                {
                  v234 = v235 * 32.0;
                  do
                  {
                    if ( v104[3] == 45 )
                    {
                      v142 = *(_DWORD *)grim_interface_ptr;
                      v225 = (v230 - v278) / v284 * v232 * v314;
                      (*(void (__stdcall **)(int, int, int, float))(v142 + 276))(
                        1065353216,
                        1058642330,
                        1036831949,
                        COERCE_FLOAT(LODWORD(v225)));
                    }
                    else
                    {
                      v143 = *(_DWORD *)grim_interface_ptr;
                      v225 = (v230 - v278) / v284 * v232 * v314;
                      (*(void (__stdcall **)(int, int, int, float))(v143 + 276))(
                        1056964608,
                        1058642330,
                        1065353216,
                        COERCE_FLOAT(LODWORD(v225)));
                    }
                    v225 = v234;
                    v224[2] = v234;
                    LODWORD(v224[1]) = grim_interface_ptr;
                    v144 = *(_DWORD *)grim_interface_ptr;
                    v224[1] = v230 * v248 + v266;
                    v224[0] = v230 * v247 + v265;
                    (*(void (__stdcall **)(_DWORD, _DWORD, float, float))(v144 + 284))(
                      LODWORD(v224[0]),
                      LODWORD(v224[1]),
                      COERCE_FLOAT(LODWORD(v234)),
                      COERCE_FLOAT(LODWORD(v234)));
                    v145 = v251 + v230;
                    v230 = v145;
                  }
                  while ( v145 < radius );
                }
                v146 = *(_DWORD *)grim_interface_ptr;
                v251 = v232 * v314;
                v147 = v251;
                (*(void (__thiscall **)(int, int, int, int, float))(v146 + 276))(
                  grim_interface_ptr,
                  1056964608,
                  1058642330,
                  1065353216,
                  COERCE_FLOAT(LODWORD(v251)));
                v148 = *(float *)&camera_offset_y + *(float *)(LODWORD(v240) + 12);
                v225 = 32.0;
                v224[2] = 32.0;
                LODWORD(v224[1]) = grim_interface_ptr;
                v149 = (float *)(LODWORD(v240) + 8);
                v150 = *(_DWORD *)grim_interface_ptr;
                v224[1] = v148 - 16.0;
                v224[0] = *(float *)&camera_offset_x + *(float *)(LODWORD(v240) + 8) - 16.0;
                (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v150 + 284))(
                  LODWORD(v224[0]),
                  LODWORD(v224[1]),
                  1107296256,
                  1107296256);
                (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
                  grim_interface_ptr,
                  1056964608,
                  1058642330,
                  1065353216,
                  COERCE_FLOAT(LODWORD(v147)));
                v151 = *(_DWORD *)(LODWORD(v240) + 32) == 45;
                radius = v235 * v231 * 40.0;
                if ( !v151 )
                {
                  v152 = creature_find_in_radius(v149, radius, 1);
                  if ( v152 != -1 )
                  {
                    v234 = v235 * 32.0;
                    do
                    {
                      (*(void (__thiscall **)(int, _DWORD, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 268))(
                        grim_interface_ptr,
                        0,
                        1059061760,
                        0);
                      (*(void (__thiscall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 268))(
                        grim_interface_ptr,
                        1,
                        1059061760,
                        1048576000);
                      (*(void (__thiscall **)(int, int, int, int))(*(_DWORD *)grim_interface_ptr + 268))(
                        grim_interface_ptr,
                        2,
                        1059061760,
                        1048576000);
                      (*(void (__thiscall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 268))(
                        grim_interface_ptr,
                        3,
                        1059061760,
                        0);
                      v225 = COERCE_FLOAT(&v247);
                      v237 = *(&creature_pos_x + 38 * v152) - *v149;
                      v153 = creature_pos_y[38 * v152] - *(float *)(LODWORD(v240) + 12);
                      v247 = v237;
                      v238 = v153;
                      v248 = v238;
                      j_FUN_00452f1d(&v247);
                      v251 = v247;
                      v247 = -v248;
                      v248 = v251;
                      v273 = *(float *)&camera_offset_x + *v149;
                      v274 = *(float *)&camera_offset_y + *(float *)(LODWORD(v240) + 12);
                      v154 = v247 * v235;
                      v251 = v235 * v251;
                      v272 = v251;
                      v276 = v251 * 10.0;
                      v243 = v273 - v154 * 10.0;
                      v277 = v251;
                      v244 = v274 - v276;
                      v281 = v276;
                      v249 = v273 + v154 * 10.0;
                      v250 = v276 + v274;
                      v269 = *(float *)&camera_offset_x + *(&creature_pos_x + 38 * v152);
                      v155 = *(float *)&camera_offset_y + creature_pos_y[38 * v152];
                      v241 = v269;
                      v253 = v269;
                      v270 = v155;
                      v242 = v270;
                      v254 = v270;
                      v302 = v251;
                      v294 = v251;
                      v298 = v276;
                      v156 = *(_DWORD *)grim_interface_ptr;
                      v241 = v154 * 10.0 + v269;
                      v242 = v276 + v270;
                      v300 = v276;
                      v253 = v269 - v154 * 10.0;
                      v254 = v270 - v276;
                      (*(void (__thiscall **)(int, float, float, float, float, float, float, float, float))(v156 + 312))(
                        grim_interface_ptr,
                        COERCE_FLOAT(LODWORD(v243)),
                        COERCE_FLOAT(LODWORD(v244)),
                        COERCE_FLOAT(LODWORD(v249)),
                        COERCE_FLOAT(LODWORD(v250)),
                        COERCE_FLOAT(LODWORD(v241)),
                        COERCE_FLOAT(LODWORD(v242)),
                        COERCE_FLOAT(LODWORD(v253)),
                        COERCE_FLOAT(LODWORD(v254)));
                      v157 = v247 * v235;
                      v251 = v248 * v235;
                      v291 = v251;
                      v293 = v251;
                      v304 = v251;
                      v290 = v251 * 4.0;
                      v306 = v251;
                      v158 = *(_DWORD *)grim_interface_ptr;
                      v241 = v241 + v157 * 4.0;
                      v242 = v290 + v242;
                      v292 = v290;
                      v253 = v253 - v157 * 4.0;
                      v254 = v254 - v290;
                      v225 = v254;
                      v224[2] = v253;
                      v305 = v290;
                      v224[1] = v242;
                      v224[0] = v241;
                      v243 = v243 - v157 * 4.0;
                      v244 = v244 - v290;
                      v303 = v290;
                      v249 = v249 + v157 * 4.0;
                      v250 = v290 + v250;
                      (*(void (__thiscall **)(int, float, float, float, float, float, float, float, float))(v158 + 312))(
                        grim_interface_ptr,
                        COERCE_FLOAT(LODWORD(v243)),
                        COERCE_FLOAT(LODWORD(v244)),
                        COERCE_FLOAT(LODWORD(v249)),
                        COERCE_FLOAT(LODWORD(v250)),
                        COERCE_FLOAT(LODWORD(v241)),
                        COERCE_FLOAT(LODWORD(v242)),
                        COERCE_FLOAT(LODWORD(v253)),
                        COERCE_FLOAT(LODWORD(v254)));
                      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(
                        grim_interface_ptr,
                        4,
                        2);
                      v159 = *(float *)&camera_offset_y + creature_pos_y[38 * v152];
                      v225 = v234;
                      v224[2] = v234;
                      LODWORD(v224[1]) = grim_interface_ptr;
                      v160 = *(_DWORD *)grim_interface_ptr;
                      v224[1] = v159 - v267;
                      v224[0] = *(float *)&camera_offset_x + *(&creature_pos_x + 38 * v152) - v267;
                      (*(void (__stdcall **)(_DWORD, _DWORD, float, float))(v160 + 284))(
                        LODWORD(v224[0]),
                        LODWORD(v224[1]),
                        COERCE_FLOAT(LODWORD(v234)),
                        COERCE_FLOAT(LODWORD(v234)));
                      v152 = creature_find_in_radius(v149, radius, v152 + 1);
                    }
                    while ( v152 != -1 );
                  }
                }
                v103 = v314;
                v106 = v240;
              }
            }
            goto LABEL_153;
          }
          if ( v104[4] != 1053609165 )
            goto LABEL_153;
          v124 = *(float *)v104 - *((float *)v104 - 2);
          v125 = *((float *)v104 - 1) - *((float *)v104 - 3);
          v126 = sqrt(v125 * v125 + v124 * v124);
          v235 = v126;
          if ( v126 > 20.0 )
            v235 = 20.0;
          v225 = *(float *)&grim_interface_ptr;
          v127 = *(_DWORD *)grim_interface_ptr;
          v225 = (double)v239 * 0.1 - (double)quest_spawn_timeline * 0.1;
          (*(void (__thiscall **)(int, float, float, int, float, float))(v127 + 252))(
            grim_interface_ptr,
            COERCE_FLOAT(LODWORD(v225)),
            COERCE_FLOAT(LODWORD(v226)),
            v227,
            COERCE_FLOAT(LODWORD(v228)),
            COERCE_FLOAT(LODWORD(v229)));
          (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, 6);
          v229 = v103;
          v228 = 0.80000001;
          v227 = 1061997773;
          v123 = *(_DWORD *)grim_interface_ptr;
          v226 = 0.80000001;
        }
        (*(void (**)(void))(v123 + 276))();
        v114 = v235;
        v113 = v235 * 0.5;
        v112 = *(_DWORD *)grim_interface_ptr;
LABEL_84:
        v115 = *(float *)&camera_offset_y + *((float *)v104 - 2);
        v225 = v114;
        v224[2] = v114;
        v224[1] = v115 - v113;
        v224[0] = *(float *)&camera_offset_x + *((float *)v104 - 3) - v113;
        (*(void (__stdcall **)(_DWORD, _DWORD, float, float))(v112 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          COERCE_FLOAT(LODWORD(v114)),
          COERCE_FLOAT(LODWORD(v114)));
      }
    }
LABEL_153:
    v104 += 16;
    ++v239;
    if ( (int)v104 < (int)particle_scale_x )
      continue;
    break;
  }
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  LODWORD(v224[0]) = 1;
  v161 = *(_DWORD *)grim_interface_ptr;
  v278 = (double)survival_elapsed_ms * 0.001 * 9.0;
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(v161 + 32))(
    grim_interface_ptr,
    19,
    1,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  *(float *)&v239 = 0.0;
  v162 = (float *)&projectile_pos_y;
  do
  {
    if ( *((_BYTE *)v162 - 12) && *((_DWORD *)v162 + 5) == 41 )
    {
      if ( *((_DWORD *)v162 + 6) == 1053609165 )
      {
        (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v103)));
        v163 = *(float *)&camera_offset_y + *v162;
        v225 = 60.0;
        v224[2] = 60.0;
        LODWORD(v224[1]) = grim_interface_ptr;
        v164 = *(_DWORD *)grim_interface_ptr;
        v224[1] = v163 - 30.0;
        v224[0] = *(float *)&camera_offset_x + *(v162 - 1) - 30.0;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v164 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          1114636288,
          1114636288);
        v165 = *(v162 - 2) + 1.5707964;
        v225 = 60.0;
        v224[2] = 60.0;
        LODWORD(v224[1]) = grim_interface_ptr;
        v166 = *(_DWORD *)grim_interface_ptr;
        v224[1] = sin(v165) * 15.0 + *(float *)&camera_offset_y + *v162 - 30.0;
        LODWORD(v224[0]) = grim_interface_ptr;
        v224[0] = cos(v165) * 15.0 + *(float *)&camera_offset_x + *(v162 - 1) - 30.0;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v166 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          1114636288,
          1114636288);
        v225 = 52.0;
        v224[2] = 52.0;
        LODWORD(v224[1]) = grim_interface_ptr;
        v167 = (double)v239 + v278;
        v168 = *(_DWORD *)grim_interface_ptr;
        v234 = v167;
        v169 = cos(v167);
        v224[1] = sin(v234) * 11.0 + *(float *)&camera_offset_y + *v162 - 31.0;
        v224[0] = *(float *)&camera_offset_x + *(v162 - 1) - 31.0 + v169 * v169;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v168 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          1112539136,
          1112539136);
        v170 = v234 + 2.0943952;
        v225 = 62.0;
        v224[2] = 62.0;
        LODWORD(v224[1]) = grim_interface_ptr;
        v171 = *(_DWORD *)grim_interface_ptr;
        v231 = sin(v170);
        v224[1] = *(float *)&camera_offset_y + *v162 - 31.0 + v231 * 10.0;
        LODWORD(v224[0]) = grim_interface_ptr;
        v224[0] = cos(v170) * 10.0 + *(float *)&camera_offset_x + *(v162 - 1) - 31.0;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v171 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          1115160576,
          1115160576);
        v172 = v234 + 4.1887903;
        v225 = 62.0;
        v224[2] = 62.0;
        LODWORD(v224[1]) = grim_interface_ptr;
        v173 = *(_DWORD *)grim_interface_ptr;
        v224[1] = sin(v172) * v231 + *(float *)&camera_offset_y + *v162 - 31.0;
        LODWORD(v224[0]) = grim_interface_ptr;
        v224[0] = cos(v172) * 10.0 + *(float *)&camera_offset_x + *(v162 - 1) - 31.0;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(v173 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          1115160576,
          1115160576);
      }
      else
      {
        v174 = v162[6] * 2.5;
        v232 = v174;
        if ( v174 <= 1.0 )
        {
          if ( v232 < 0.0 )
            v232 = 0.0;
        }
        else
        {
          v232 = 1.0;
        }
        v175 = *(_DWORD *)grim_interface_ptr;
        v225 = v232 * v314;
        (*(void (__stdcall **)(int, int, int, float))(v175 + 276))(
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v225)));
        v176 = *(_DWORD *)grim_interface_ptr;
        v231 = v232 * 40.0 + 32.0;
        v225 = v231;
        v224[2] = v231;
        v177 = v232 * 20.0 + 16.0;
        v224[1] = *(float *)&camera_offset_y + *v162 - v177;
        v224[0] = *(float *)&camera_offset_x + *(v162 - 1) - v177;
        (*(void (__stdcall **)(_DWORD, _DWORD, float, float))(v176 + 284))(
          LODWORD(v224[0]),
          LODWORD(v224[1]),
          COERCE_FLOAT(LODWORD(v231)),
          COERCE_FLOAT(LODWORD(v231)));
      }
    }
    v162 += 16;
    ++v239;
  }
  while ( (int)v162 < (int)&particle_vel_x );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    2,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    particles_texture,
    0);
  effect_select_texture(13);
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v103)));
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v178 = projectile_pool;
  do
  {
    if ( *v178 && *(_DWORD *)(LODWORD(v106) + 32) == 45 && *((_DWORD *)v178 + 9) == 1053609165 )
    {
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(
        grim_interface_ptr,
        *((_DWORD *)v178 + 1));
      v179 = *(float *)&camera_offset_x + *((float *)v178 + 2);
      v180 = *(float *)&camera_offset_y + *((float *)v178 + 3);
      v225 = 64.0;
      v224[2] = 64.0;
      v272 = v180;
      v181 = *(_DWORD *)grim_interface_ptr;
      v237 = v179 - 32.0;
      v238 = v272 - 32.0;
      (*(void (__thiscall **)(int, float, float, int, int))(v181 + 284))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v237)),
        COERCE_FLOAT(LODWORD(v238)),
        1115684864,
        1115684864);
    }
    v178 += 64;
  }
  while ( (int)v178 < (int)particle_pool );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  v182 = *(_DWORD *)grim_interface_ptr;
  v231 = v314 * 0.89999998;
  (*(void (__thiscall **)(int, int, int, int, float))(v182 + 276))(
    grim_interface_ptr,
    1061997773,
    1061997773,
    1061997773,
    COERCE_FLOAT(LODWORD(v231)));
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_49BB30, 0);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v183 = (float *)&projectile_pos_y;
  do
  {
    if ( *((_BYTE *)v183 - 12) )
    {
      if ( *((_DWORD *)v183 + 6) == 1053609165 )
      {
        v184 = *((_DWORD *)v183 + 5);
        if ( v184 != 9 && v184 != 11 && v184 != 19 )
        {
          (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(
            grim_interface_ptr,
            *((_DWORD *)v183 - 2));
          v185 = *((_DWORD *)v183 + 5);
          if ( v185 == 1 )
          {
            v186 = *(float *)&camera_offset_x + *(v183 - 1);
            v187 = *(float *)&camera_offset_y + *v183;
            v225 = 6.0;
            v224[2] = 6.0;
            v272 = v187;
            v188 = *(_DWORD *)grim_interface_ptr;
            v237 = v186 - 3.0;
            v238 = v272 - 3.0;
            v224[1] = v238;
            v189 = v237;
          }
          else
          {
            v190 = *(float *)&camera_offset_x + *(v183 - 1);
            v191 = *(float *)&camera_offset_y + *v183;
            if ( v185 == 4 )
            {
              v276 = v191;
              v225 = 8.0;
              v188 = *(_DWORD *)grim_interface_ptr;
              v224[2] = 8.0;
              v259 = v190 - 4.0;
              v260 = v276 - 4.0;
              v224[1] = v260;
              v189 = v259;
            }
            else
            {
              v277 = v191;
              v225 = 4.0;
              v188 = *(_DWORD *)grim_interface_ptr;
              v224[2] = 4.0;
              v257 = v190 - 2.0;
              v258 = v277 - 2.0;
              v224[1] = v258;
              v189 = v257;
            }
          }
          (*(void (__stdcall **)(float, _DWORD, _DWORD, float))(v188 + 284))(
            COERCE_FLOAT(LODWORD(v189)),
            LODWORD(v224[1]),
            LODWORD(v224[2]),
            COERCE_FLOAT(LODWORD(v225)));
        }
      }
    }
    v183 += 16;
  }
  while ( (int)v183 < (int)&particle_vel_x );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  if ( config_fx_detail_flag1 )
  {
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      LODWORD(v224[1]),
      LODWORD(v224[2]),
      COERCE_FLOAT(LODWORD(v225)));
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      2,
      LODWORD(v224[1]),
      LODWORD(v224[2]),
      COERCE_FLOAT(LODWORD(v225)));
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      particles_texture,
      0);
    effect_select_texture(13);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v192 = (float *)&secondary_proj_angle;
    do
    {
      if ( *((_BYTE *)v192 - 4) )
      {
        v193 = *(_DWORD *)grim_interface_ptr;
        v225 = v314 * 0.47999999;
        (*(void (__stdcall **)(int, int, int, float))(v193 + 276))(
          1065353216,
          1065353216,
          1065353216,
          COERCE_FLOAT(LODWORD(v225)));
        v194 = *v192 - 1.5707964;
        v225 = 140.0;
        v224[2] = 140.0;
        v195 = *(_DWORD *)grim_interface_ptr;
        v271 = cos(v194);
        v275 = v271 * 5.0;
        v196 = *(float *)&camera_offset_x + v192[2];
        v277 = *(float *)&camera_offset_y + v192[3];
        v280 = v196 - v275;
        v237 = v280 - 70.0;
        v238 = v277 - sin(v194) * 5.0 - 70.0;
        (*(void (__stdcall **)(float, float, int, int))(v195 + 284))(
          COERCE_FLOAT(LODWORD(v237)),
          COERCE_FLOAT(LODWORD(v238)),
          1124859904,
          1124859904);
      }
      v192 += 11;
    }
    while ( (int)v192 < (int)&dword_4965DC );
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      LODWORD(v224[1]),
      LODWORD(v224[2]),
      COERCE_FLOAT(LODWORD(v225)));
  }
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1061997773,
    1061997773,
    1061997773,
    COERCE_FLOAT(LODWORD(v231)));
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    projectile_texture,
    0);
  (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, 3);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v197 = secondary_proj_pos_y;
  while ( 2 )
  {
    if ( *(v197 - 16) && *((_DWORD *)v197 + 3) != 3 )
    {
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(
        grim_interface_ptr,
        *((_DWORD *)v197 - 3));
      v198 = *((_DWORD *)v197 + 3);
      switch ( v198 )
      {
        case 1:
          v199 = *(float *)&camera_offset_x + *((float *)v197 - 1);
          v200 = *(float *)&camera_offset_y + *(float *)v197;
          v225 = v231;
          v224[2] = 0.80000001;
          v224[1] = 0.80000001;
          v272 = v200;
          v201 = *(_DWORD *)grim_interface_ptr;
          v224[0] = 0.80000001;
          v237 = v199 - 7.0;
          v238 = v272 - 7.0;
          (*(void (__thiscall **)(int, int, int, int, float, float, int, float))(v201 + 276))(
            grim_interface_ptr,
            1061997773,
            1061997773,
            1061997773,
            COERCE_FLOAT(LODWORD(v231)),
            COERCE_FLOAT(LODWORD(v226)),
            v227,
            COERCE_FLOAT(LODWORD(v228)));
          v228 = 14.0;
          v227 = 1096810496;
          v202 = *(_DWORD *)grim_interface_ptr;
          v226 = v241;
          v203 = v240;
          goto LABEL_199;
        case 2:
          v204 = *(float *)&camera_offset_x + *((float *)v197 - 1);
          v205 = *(float *)&camera_offset_y + *(float *)v197;
          v225 = v231;
          v224[2] = 0.80000001;
          v224[1] = 0.80000001;
          v276 = v205;
          v206 = *(_DWORD *)grim_interface_ptr;
          v224[0] = 0.80000001;
          v259 = v204 - 5.0;
          v260 = v276 - 5.0;
          (*(void (__thiscall **)(int, int, int, int, float))(v206 + 276))(
            grim_interface_ptr,
            1061997773,
            1061997773,
            1061997773,
            COERCE_FLOAT(LODWORD(v231)));
          (*(void (__thiscall **)(int, float, float, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
            grim_interface_ptr,
            COERCE_FLOAT(LODWORD(v259)),
            COERCE_FLOAT(LODWORD(v260)),
            1092616192,
            1092616192);
          break;
        case 4:
          v207 = *(float *)&camera_offset_x + *((float *)v197 - 1);
          v208 = *(float *)&camera_offset_y + *(float *)v197;
          v225 = v231;
          v224[2] = 0.80000001;
          v224[1] = 0.80000001;
          v277 = v208;
          v209 = *(_DWORD *)grim_interface_ptr;
          v224[0] = 0.80000001;
          v257 = v207 - 4.0;
          v258 = v277 - 4.0;
          (*(void (__thiscall **)(int, int, int, int, float, float, int, float))(v209 + 276))(
            grim_interface_ptr,
            1061997773,
            1061997773,
            1061997773,
            COERCE_FLOAT(LODWORD(v231)),
            COERCE_FLOAT(LODWORD(v226)),
            v227,
            COERCE_FLOAT(LODWORD(v228)));
          v228 = 8.0;
          v227 = 1090519040;
          v202 = *(_DWORD *)grim_interface_ptr;
          v226 = v261;
          v203 = v260;
LABEL_199:
          (*(void (__stdcall **)(float))(v202 + 284))(COERCE_FLOAT(LODWORD(v203)));
          break;
      }
    }
    v197 += 44;
    if ( (int)v197 < (int)&flt_4965E8 )
      continue;
    break;
  }
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  if ( !config_fx_detail_flag1 )
    return;
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    2,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    particles_texture,
    0);
  effect_select_texture(13);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v210 = secondary_proj_pos_y;
  while ( 2 )
  {
    if ( *(v210 - 16) )
    {
      v211 = *((_DWORD *)v210 + 3);
      switch ( v211 )
      {
        case 4:
          v212 = *(_DWORD *)grim_interface_ptr;
          v225 = v314 * 0.15800001;
          BYTE1(v224[2]) = 0;
          HIWORD(v224[2]) = 16256;
          strcpy((char *)v224, "333?333?");
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, float, float, int, float))(v212 + 276))(
            LODWORD(v224[0]),
            LODWORD(v224[1]),
            LODWORD(v224[2]),
            COERCE_FLOAT(LODWORD(v225)),
            COERCE_FLOAT(LODWORD(v226)),
            v227,
            COERCE_FLOAT(LODWORD(v228)));
          v213 = *((float *)v210 - 3) - 1.5707964;
          v228 = 30.0;
          v227 = 1106247680;
          v214 = *(_DWORD *)grim_interface_ptr;
          v274 = cos(v213);
          v277 = v274 * 9.0;
          v215 = *(float *)&camera_offset_x + *((float *)v210 - 1);
          v280 = *(float *)&camera_offset_y + *(float *)v210;
          v283 = v215 - v277;
          v240 = v283 - 15.0;
          v241 = v280 - sin(v213) * 9.0 - 15.0;
          v226 = v241;
          v216 = v240;
          goto LABEL_210;
        case 1:
          v217 = *(_DWORD *)grim_interface_ptr;
          v225 = v314 * 0.68000001;
          (*(void (__stdcall **)(int, int, int, float))(v217 + 276))(
            1065353216,
            1065353216,
            1065353216,
            COERCE_FLOAT(LODWORD(v225)));
          v218 = *((float *)v210 - 3) - 1.5707964;
          v225 = 60.0;
          v224[2] = 60.0;
          v219 = *(_DWORD *)grim_interface_ptr;
          v301 = cos(v218);
          v297 = v301 * 9.0;
          v220 = *(float *)&camera_offset_x + *((float *)v210 - 1);
          v294 = *(float *)&camera_offset_y + *(float *)v210;
          v299 = v220 - v297;
          v259 = v299 - 30.0;
          v260 = v294 - sin(v218) * 9.0 - 30.0;
          (*(void (__stdcall **)(float, float, int, int))(v219 + 284))(
            COERCE_FLOAT(LODWORD(v259)),
            COERCE_FLOAT(LODWORD(v260)),
            1114636288,
            1114636288);
          break;
        case 2:
          v221 = *(_DWORD *)grim_interface_ptr;
          v225 = v314 * 0.57999998;
          (*(void (__stdcall **)(int, int, int, float, float, int, float))(v221 + 276))(
            1065353216,
            1065353216,
            1065353216,
            COERCE_FLOAT(LODWORD(v225)),
            COERCE_FLOAT(LODWORD(v226)),
            v227,
            COERCE_FLOAT(LODWORD(v228)));
          v222 = *((float *)v210 - 3) - 1.5707964;
          v228 = 40.0;
          v227 = 1109393408;
          v214 = *(_DWORD *)grim_interface_ptr;
          v292 = cos(v222);
          v291 = v292 * 9.0;
          v223 = *(float *)&camera_offset_x + *((float *)v210 - 1);
          v295 = *(float *)&camera_offset_y + *(float *)v210;
          v293 = v223 - v291;
          v260 = v293 - 20.0;
          v261 = v295 - sin(v222) * 9.0 - 20.0;
          v226 = v261;
          v216 = v260;
LABEL_210:
          (*(void (__stdcall **)(float))(v214 + 284))(COERCE_FLOAT(LODWORD(v216)));
          break;
      }
    }
    v210 += 44;
    if ( (int)v210 < (int)&flt_4965E8 )
      continue;
    break;
  }
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    LODWORD(v224[1]),
    LODWORD(v224[2]),
    COERCE_FLOAT(LODWORD(v225)));
}

// sub_425D80 @ 0x00425D80
int __cdecl sub_425D80(int a1)
{
  int v1; // esi
  char *v2; // ecx
  double v3; // st6
  double v4; // st5

  v1 = 0;
  v2 = creature_pool;
  while ( 1 )
  {
    if ( *v2 )
    {
      v3 = *((float *)v2 + 6) - creature_pos_y[38 * a1];
      v4 = *((float *)v2 + 5) - *((float *)&creature_pos_x + 38 * a1);
      if ( sqrt(v4 * v4 + v3 * v3) < 45.0 )
        break;
    }
    v2 += 152;
    ++v1;
    if ( (int)v2 >= (int)byte_4AA338 )
      return 0;
  }
  if ( creature_collision_flag[152 * v1] && *(float *)&creature_health[38 * a1] < 150.0 )
    creature_collision_flag[152 * a1] = 1;
  if ( creature_collision_flag[152 * a1] )
  {
    if ( *(float *)&creature_health[38 * v1] < 150.0 )
      creature_collision_flag[152 * v1] = 1;
  }
  return v1;
}

// player_take_damage @ 0x00425E50
// applies player damage with perk modifiers, SFX, and retaliation effects
void player_take_damage(int player_index, float damage)
{
  bool v5; // bl
  int v10; // ebx
  int v15; // eax
  int v16; // eax
  float v21; // [esp+0h] [ebp-28h]
  int v22; // [esp+1Ch] [ebp-Ch]
  float v23; // [esp+1Ch] [ebp-Ch]
  float v24; // [esp+1Ch] [ebp-Ch]
  float impulse[2]; // [esp+20h] [ebp-8h] BYREF
  char player_indexa; // [esp+2Ch] [ebp+4h]
  int player_indexb; // [esp+2Ch] [ebp+4h]

  if ( perk_count_get(perk_id_death_clock) )
    return;
  if ( perk_count_get(perk_id_tough_reloader) && player_reload_active[864 * player_index] )
  {
    __asm
    {
      fld     [esp+18h+damage]
      fmul    ds:flt_46F24C
      fstp    [esp+18h+damage]
    }
  }
  survival_reward_damage_seen = 1;
  v22 = 1065353216;
  _EDI = 216 * player_index;
  __asm
  {
    fld     dword ptr [edi+490BC8h]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x4100) == 0 )
    return;
  __asm
  {
    fld     player_health
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  v5 = (_AX & 0x4100) != 0;
  if ( perk_count_get(perk_id_thick_skinned) )
    v22 = 1059749626;
  player_indexa = 0;
  if ( !perk_count_get(perk_id_ninja) )
  {
    if ( perk_count_get(perk_id_dodger) && !(crt_rand() % 5) )
    {
      player_indexa = 1;
      goto LABEL_18;
    }
LABEL_14:
    if ( perk_count_get(perk_id_highlander) )
    {
      if ( !(crt_rand() % 10) )
        player_health[_EDI] = 0;
    }
    else
    {
      __asm
      {
        fld     [esp+18h+var_C]
        fmul    [esp+18h+damage]
        fsubr   dword ptr [edi+4908D4h]
        fstp    dword ptr [edi+4908D4h]
      }
      *(float *)(_EDI * 4 + 4786388) = _ET1;
    }
    goto LABEL_18;
  }
  if ( crt_rand() % 3 )
    goto LABEL_14;
  player_indexa = 1;
LABEL_18:
  __asm
  {
    fld     dword ptr [edi+4908D4h]
    fcomp   ds:flt_46F228
    fnstsw  ax
  }
  if ( (_AX & 0x100) != 0 )
  {
    __asm
    {
      fld     frame_dt
      fmul    ds:flt_46F2E0
    }
    __asm
    {
      fsubr   dword ptr [edi+4908C0h]
      fstp    dword ptr [edi+4908C0h]
    }
    *(float *)(_EDI * 4 + 4786368) = _ET1;
    if ( v5 )
      return;
    if ( perk_count_get(perk_id_final_revenge) )
    {
      _EBP = &player_pos_x[_EDI];
      effect_spawn_explosion_burst((float *)&player_pos_x[_EDI], 1.8);
      bonus_spawn_guard = 1;
      v10 = 0;
      _ESI = creature_pool;
      do
      {
        if ( *_ESI )
        {
          __asm
          {
            fld     dword ptr [esi+14h]
            fsub    dword ptr [ebp+0]
            fstp    [esp+1Ch+var_C]
          }
          LODWORD(v23) &= ~0x80000000;
          __asm
          {
            fld     [esp+1Ch+var_C]
            fcomp   ds:flt_46F46C
            fnstsw  ax
          }
          if ( (_AX & 0x4100) != 0 )
          {
            __asm
            {
              fld     dword ptr [esi+18h]
              fsub    dword ptr [edi+4908C8h]
              fstp    [esp+1Ch+var_C]
            }
            LODWORD(v24) &= ~0x80000000;
            __asm
            {
              fld     [esp+1Ch+var_C]
              fcomp   ds:flt_46F46C
              fnstsw  ax
            }
            if ( (_AX & 0x4100) != 0 )
            {
              __asm
              {
                fld     dword ptr [esi+14h]
                fsub    dword ptr [ebp+0]
                fld     dword ptr [esi+18h]
                fsub    dword ptr [ebp+4]
                fld     st
                fmul    st, st(1)
                fld     st(2)
                fmul    st, st(3)
                faddp   st(1), st
                fsqrt
                fstp    st(2)
                fstp    st
                fsubr   ds:flt_46F46C
                fcom    ds:flt_46F228
                fnstsw  ax
              }
              if ( (_AX & 0x4100) != 0 )
              {
                __asm { fstp    st }
              }
              else
              {
                __asm { fmul    ds:flt_46F288 }
                impulse[0] = 0.0;
                impulse[1] = 0.0;
                __asm { fstp    [esp+28h+var_28]; damage }
                creature_apply_damage(v10, v21, 3, impulse);
              }
            }
          }
        }
        _ESI += 152;
        ++v10;
      }
      while ( (int)_ESI < (int)byte_4AA338 );
      bonus_spawn_guard = 0;
      sfx_play_panned(sfx_explosion_large);
      sfx_play_panned(sfx_shockwave);
    }
    else
    {
      v15 = crt_rand() % 2;
      sfx_play_panned(COERCE_FLOAT(sfx_trooper_die_01 + v15));
    }
  }
  else
  {
    v16 = crt_rand();
    sfx_play_panned(COERCE_FLOAT(sfx_trooper_inpain_01 + v16 % 3));
    if ( v5 )
      return;
  }
  if ( !player_indexa )
  {
    if ( !perk_count_get(perk_id_unstoppable) )
    {
      player_indexb = crt_rand() % 100 - 50;
      __asm
      {
        fild    [esp+18h+player_index]
        fmul    ds:flt_46F670
        fadd    dword ptr [edi+4908DCh]
        fstp    dword ptr [edi+4908DCh]
      }
      *(float *)(_EDI * 4 + 4786396) = _ET1;
      __asm
      {
        fld     [esp+18h+damage]
        fmul    ds:flt_46F300
        fadd    dword ptr [edi+490B68h]
        fst     dword ptr [edi+490B68h]
      }
      *(float *)(_EDI * 4 + 4787048) = _ET1;
      __asm
      {
        fcomp   ds:flt_46F4E0
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        player_spread_heat[_EDI] = 1056293519;
    }
    __asm
    {
      fld     dword ptr [edi+4908D4h]
      fcomp   ds:flt_46F2B4
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 && (crt_rand() & 7) == 3 )
      player_low_health_timer[_EDI] = 0;
  }
}

// creature_update_all @ 0x00426220
// primary creature update loop: AI, movement, attacks, and animation phase
void creature_update_all()
{
  int v0; // esi
  int v8; // eax
  int v9; // eax
  int v10; // eax
  __int16 v11; // ax
  int v12; // eax
  char v15; // bl
  int v22; // ebp
  int v30; // edx
  int v31; // eax
  int v32; // eax
  bool v34; // zf
  int v35; // eax
  int v43; // eax
  int v44; // edx
  int v57; // eax
  int v60; // eax
  int v61; // edx
  float v65; // eax
  float v67; // edx
  float *v75; // edx
  int v80; // ecx
  int v93; // eax
  int v94; // edx
  int v99; // eax
  int v139; // ecx
  int v142; // eax
  int v154; // eax
  char v155; // al
  float v156; // eax
  int v157; // ebx
  int v158; // ebx
  int v159; // ebx
  int v162; // eax
  float v169; // [esp-10h] [ebp-A8h]
  float v170; // [esp-10h] [ebp-A8h]
  float *v171; // [esp-4h] [ebp-9Ch]
  float *v172; // [esp-4h] [ebp-9Ch]
  float damage; // [esp+0h] [ebp-98h]
  float damagea; // [esp+0h] [ebp-98h]
  float damageb; // [esp+0h] [ebp-98h]
  float angle; // [esp+4h] [ebp-94h]
  float anglea; // [esp+4h] [ebp-94h]
  float angleb; // [esp+4h] [ebp-94h]
  float anglec; // [esp+4h] [ebp-94h]
  float angled; // [esp+4h] [ebp-94h]
  float rate; // [esp+8h] [ebp-90h]
  float ratea; // [esp+8h] [ebp-90h]
  int rateb; // [esp+8h] [ebp-90h]
  int creature_id; // [esp+1Ch] [ebp-7Ch]
  int v185; // [esp+20h] [ebp-78h]
  float v188; // [esp+28h] [ebp-70h]
  int v189; // [esp+2Ch] [ebp-6Ch]
  int v190; // [esp+30h] [ebp-68h]
  int v191; // [esp+38h] [ebp-60h]
  int v192; // [esp+3Ch] [ebp-5Ch]
  int v193; // [esp+3Ch] [ebp-5Ch]
  int v194; // [esp+3Ch] [ebp-5Ch]
  float v195; // [esp+40h] [ebp-58h] BYREF
  float v197[2]; // [esp+48h] [ebp-50h] BYREF
  float impulse[2]; // [esp+50h] [ebp-48h] BYREF
  float v199[2]; // [esp+58h] [ebp-40h] BYREF
  float v200[2]; // [esp+60h] [ebp-38h] BYREF
  float v201[2]; // [esp+68h] [ebp-30h] BYREF
  float pos[2]; // [esp+70h] [ebp-28h] BYREF
  float v203[2]; // [esp+78h] [ebp-20h] BYREF
  float v204[2]; // [esp+80h] [ebp-18h] BYREF

  v0 = 0;
  ++creature_update_tick;
  creature_active_count = 0;
  for ( creature_id = 0; ; v0 = creature_id )
  {
    _ESI = 19 * v0;
    if ( creature_pool[8 * _ESI] )
    {
      __asm { fld     creature_hit_flash_timer[esi*8] }
      __asm { fcomp   ds:flt_46F228 }
      ++creature_active_count;
      __asm { fnstsw  ax }
      if ( (_AX & 0x4100) == 0 )
      {
        __asm
        {
          fld     creature_hit_flash_timer[esi*8]
          fsub    frame_dt
          fstp    creature_hit_flash_timer[esi*8]
        }
        creature_hit_flash_timer[2 * _ESI] = _ET1;
      }
      __asm
      {
        fld     bonus_freeze_timer
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
      {
        __asm
        {
          fld     creature_health[esi*8]
          fcomp   ds:flt_46F228
        }
        _EDI = 8 * _ESI + 4833116;
        __asm { fnstsw  ax }
        if ( (_AX & 0x4100) != 0 && creature_hitbox_size[2 * _ESI] == 1098907648 )
        {
          __asm
          {
            fld     creature_hitbox_size[esi*8]
            fsub    frame_dt
            fstp    creature_hitbox_size[esi*8]
          }
          creature_hitbox_size[2 * _ESI] = _ET1;
        }
        v8 = creature_flags[2 * _ESI];
        if ( (v8 & 2) != 0 )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F2F0
          }
          v197[0] = 0.0;
          v197[1] = 0.0;
          __asm { fstp    [esp+98h+damage] }
          creature_apply_damage(creature_id, damage, 0, v197);
        }
        else if ( (v8 & 1) != 0 )
        {
          __asm
          {
            fld     frame_dt
            fmul    ds:flt_46F384
          }
          impulse[0] = 0.0;
          impulse[1] = 0.0;
          __asm { fstp    [esp+98h+damage]; damage }
          creature_apply_damage(creature_id, damagea, 0, impulse);
        }
        if ( SLOBYTE(creature_flags[2 * _ESI]) < 0 )
        {
          v9 = creature_link_index[2 * _ESI];
          if ( v9 >= 0 )
          {
            v12 = v9 - frame_dt_ms;
            creature_link_index[2 * _ESI] = v12;
            if ( v12 <= 0 )
              creature_link_index[2 * _ESI] = -700 - (crt_rand() & 0x3FF);
          }
          else
          {
            v10 = frame_dt_ms + v9;
            creature_link_index[2 * _ESI] = v10;
            if ( v10 >= 0 )
            {
              v11 = crt_rand();
              creature_ai_mode[2 * _ESI] = 7;
              creature_link_index[2 * _ESI] = (v11 & 0x1FF) + 500;
            }
          }
        }
        __asm
        {
          fld     dword ptr [edi]
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4100) != 0 && creature_hitbox_size[2 * _ESI] == 1098907648 )
        {
          __asm
          {
            fld     creature_hitbox_size[esi*8]
            fsub    frame_dt
            fstp    creature_hitbox_size[esi*8]
          }
          creature_hitbox_size[2 * _ESI] = _ET1;
        }
        v15 = creature_target_player[8 * _ESI];
        _EDI = 8 * _ESI + 4833100;
        _ECX = 864 * v15;
        __asm
        {
          fld     dword ptr [ecx+4908C4h]
          fsub    dword ptr [edi]
          fld     dword ptr [ecx+4908C8h]
          fsub    dword ptr [edi+4]
          fld     st(1)
          fmulp   st(2), st
          fld     st
          fmul    st, st(1)
          faddp   st(2), st
          fxch    st(1)
          fsqrt
        }
        __asm
        {
          fxch    st(1)
          fstp    st
          fstp    [esp+8Ch+var_78]
        }
        if ( !(creature_update_tick % 70) )
          goto LABEL_31;
        if ( config_player_count == 2 )
        {
          _EDX = &player2_health[_ECX / 0xFFFFFFFC];
          __asm
          {
            fld     dword ptr [edx]
            fcomp   ds:flt_46F228
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
          {
            _EAX = &player2_pos_x[_ECX / 0xFFFFFFFC];
            __asm
            {
              fld     dword ptr [eax]
              fsub    dword ptr [edi]
              fld     dword ptr [eax+4]
              fsub    dword ptr [edi+4]
              fld     st(1)
              fmulp   st(2), st
              fld     st
              fmul    st, st(1)
              faddp   st(2), st
              fxch    st(1)
              fsqrt
              fxch    st(1)
              fstp    st
              fst     [esp+8Ch+var_6C]
              fcomp   [esp+8Ch+var_78]
              fnstsw  ax
            }
            if ( (BYTE1(_EAX) & 1) != 0 )
            {
              v185 = v189;
              creature_target_player[8 * _ESI] = 1 - v15;
            }
          }
        }
        else
        {
          __asm
          {
            fld     player_pos_x
            fsub    dword ptr [edi]
            fld     player_pos_y
            fsub    dword ptr [edi+4]
            fld     st(1)
            fmulp   st(2), st
            fld     st
            fmul    st, st(1)
            faddp   st(2), st
            fxch    st(1)
            fsqrt
            fxch    st(1)
            fstp    st
            fstp    [esp+8Ch+var_6C]
          }
        }
        v15 = creature_target_player[8 * _ESI];
        __asm { fld     player_pos_x }
        _ECX = 864 * v15;
        _EAX = 19 * player_auto_target[_ECX / 4];
        __asm
        {
          fsub    creature_pos_x[eax*8]
          fld     player_pos_y
          fsub    creature_pos_y[eax*8]
        }
        __asm
        {
          fld     st(1)
          fmulp   st(2), st
          fld     st
          fmul    st, st(1)
          faddp   st(2), st
          fxch    st(1)
          fsqrt
          fxch    st(1)
          fstp    st
          fcomp   [esp+8Ch+var_6C]
          fnstsw  ax
        }
        if ( (_EAX & 0x4100) != 0 )
        {
LABEL_31:
          v22 = creature_id;
        }
        else
        {
          v22 = creature_id;
          player_auto_target[216 * v15] = creature_id;
        }
        __asm
        {
          fld     dword ptr [ecx+4908D4h]
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4100) != 0 )
          creature_target_player[8 * _ESI] = 1 - v15;
        _EBX = 8 * _ESI + 4833096;
        if ( creature_hitbox_size[2 * _ESI] == 1098907648 )
        {
          if ( creature_collision_flag[8 * _ESI] )
          {
            __asm
            {
              fld     creature_collision_timer[esi*8]
              fsub    frame_dt
              fcom    ds:flt_46F228
              fst     creature_collision_timer[esi*8]
            }
            creature_collision_timer[2 * _ESI] = _ET1;
            __asm { fnstsw  ax }
            if ( (_AX & 0x100) != 0 )
            {
              __asm { fadd    ds:flt_46F24C }
              _EAX = (float *)(8 * _ESI + 4833116);
              creature_state_flag[8 * _ESI] = 1;
              __asm { fstp    creature_collision_timer[esi*8] }
              creature_collision_timer[2 * _ESI] = _ET1;
              __asm
              {
                fld     dword ptr [eax]
                fsub    ds:flt_46F360
                fst     dword ptr [eax]
              }
              *_EAX = _ET1;
              __asm
              {
                fcomp   ds:flt_46F228
                fnstsw  ax
              }
              if ( (BYTE1(_EAX) & 1) != 0 )
              {
                ++plaguebearer_infection_count;
                creature_handle_death(v22, 1);
                v30 = crt_rand() % 2;
                sfx_play_panned(*(&creature_type_sfx_b0 + 17 * *(&creature_type_id + 2 * _ESI) + v30));
              }
              fx_queue_add_random((float *)(8 * _ESI + 4833100));
            }
            else
            {
              __asm { fstp    st }
            }
          }
          __asm { fild    creature_phase_seed[esi*8] }
          v31 = evil_eyes_target_creature;
          creature_force_target[8 * _ESI] = 0;
          v188 = 1.0;
          __asm
          {
            fmul    ds:flt_46F688
            fmul    ds:flt_46F378
            fstp    [esp+8Ch+var_74]
          }
          if ( v22 != v31 )
          {
            v32 = creature_ai_mode[2 * _ESI];
            if ( v32 )
            {
              switch ( v32 )
              {
                case 8:
                  __asm
                  {
                    fld     [esp+8Ch+var_74]
                    fcos
                  }
                  _EAX = 864 * creature_target_player[8 * _ESI];
                  __asm
                  {
                    fmul    [esp+8Ch+var_78]
                    fmul    ds:flt_46F34C
                    fadd    dword ptr [eax+4908C4h]
                    fstp    creature_target_x[esi*8]
                  }
                  creature_target_x[2 * _ESI] = _ET1;
                  __asm
                  {
                    fld     [esp+8Ch+var_74]
                    fsin
                    fmul    [esp+8Ch+var_78]
                    fmul    ds:flt_46F34C
                    fadd    dword ptr [eax+4908C8h]
                    fstp    creature_target_y[esi*8]
                  }
                  creature_target_y[2 * _ESI] = _ET1;
                  break;
                case 1:
                  __asm
                  {
                    fld     [esp+8Ch+var_78]
                    fcomp   ds:flt_46F618
                    fnstsw  ax
                  }
                  v34 = (_AX & 0x4100) == 0;
                  v35 = 27 * creature_target_player[8 * _ESI];
                  if ( v34 )
                    goto LABEL_49;
                  __asm
                  {
                    fld     [esp+8Ch+var_74]
                    fcos
                  }
                  _EAX = 864 * creature_target_player[8 * _ESI];
                  __asm
                  {
                    fmul    [esp+8Ch+var_78]
                    fmul    ds:flt_46F3AC
                    fadd    dword ptr [eax+4908C4h]
                    fstp    creature_target_x[esi*8]
                  }
                  creature_target_x[2 * _ESI] = _ET1;
                  __asm
                  {
                    fld     [esp+8Ch+var_74]
                    fsin
                    fmul    [esp+8Ch+var_78]
                    fmul    ds:flt_46F3AC
                    fadd    dword ptr [eax+4908C8h]
                    fstp    creature_target_y[esi*8]
                  }
                  creature_target_y[2 * _ESI] = _ET1;
                  break;
                case 3:
                  _ECX = 152 * creature_link_index[2 * _ESI];
                  __asm
                  {
                    fld     dword ptr [ecx+49BF5Ch]
                    fcomp   ds:flt_46F228
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) != 0 )
                  {
                    creature_ai_mode[2 * _ESI] = 0;
                  }
                  else
                  {
                    __asm
                    {
                      fld     dword ptr [ecx+49BF4Ch]
                      fadd    creature_target_offset_x[esi*8]
                      fstp    creature_target_x[esi*8]
                    }
                    creature_target_x[2 * _ESI] = _ET1;
                    __asm
                    {
                      fld     dword ptr [ecx+49BF50h]
                      fadd    creature_target_offset_y[esi*8]
                      fstp    creature_target_y[esi*8]
                    }
                    creature_target_y[2 * _ESI] = _ET1;
                  }
                  break;
                case 5:
                  _ECX = 152 * creature_link_index[2 * _ESI];
                  __asm
                  {
                    fld     dword ptr [ecx+49BF5Ch]
                    fcomp   ds:flt_46F228
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) != 0 )
                  {
                    creature_ai_mode[2 * _ESI] = 0;
                    v199[0] = 0.0;
                    v199[1] = 0.0;
                    creature_apply_damage(creature_id, 1000.0, 1, v199);
                  }
                  else
                  {
                    __asm
                    {
                      fld     dword ptr [ecx+49BF4Ch]
                      fadd    creature_target_offset_x[esi*8]
                      fstp    creature_target_x[esi*8]
                    }
                    creature_target_x[2 * _ESI] = _ET1;
                    __asm
                    {
                      fld     dword ptr [ecx+49BF50h]
                      fadd    creature_target_offset_y[esi*8]
                      fstp    creature_target_y[esi*8]
                    }
                    creature_target_y[2 * _ESI] = _ET1;
                    __asm
                    {
                      fld     creature_target_x[esi*8]
                      fsub    dword ptr [edi]
                      fld     creature_target_y[esi*8]
                      fsub    dword ptr [edi+4]
                      fld     st
                      fmul    st, st(1)
                      fld     st(2)
                      fmul    st, st(3)
                      faddp   st(1), st
                      fsqrt
                      fstp    st(2)
                      fstp    st
                      fcom    ds:flt_46F2AC
                      fnstsw  ax
                    }
                    if ( (_AX & 0x4100) != 0 )
                    {
                      __asm
                      {
                        fmul    ds:flt_46F680
                        fstp    [esp+8Ch+var_70]
                      }
                    }
                    else
                    {
                      __asm { fstp    st }
                    }
                  }
                  break;
              }
            }
            else
            {
              __asm
              {
                fld     [esp+8Ch+var_78]
                fcomp   ds:flt_46F618
                fnstsw  ax
              }
              v34 = (_AX & 0x4100) == 0;
              v35 = 27 * creature_target_player[8 * _ESI];
              if ( !v34 )
              {
                __asm
                {
                  fld     [esp+8Ch+var_74]
                  fcos
                }
                _EAX = 864 * creature_target_player[8 * _ESI];
                __asm
                {
                  fmul    [esp+8Ch+var_78]
                  fmul    ds:flt_46F684
                  fadd    dword ptr [eax+4908C4h]
                  fstp    creature_target_x[esi*8]
                }
                creature_target_x[2 * _ESI] = _ET1;
                __asm
                {
                  fld     [esp+8Ch+var_74]
                  fsin
                  fmul    [esp+8Ch+var_78]
                  fmul    ds:flt_46F684
                  fadd    dword ptr [eax+4908C8h]
                  fstp    creature_target_y[esi*8]
                }
                creature_target_y[2 * _ESI] = _ET1;
                goto LABEL_61;
              }
LABEL_49:
              v43 = 8 * v35;
              v44 = player_pos_y[v43];
              LODWORD(creature_target_x[2 * _ESI]) = player_pos_x[v43];
              LODWORD(creature_target_y[2 * _ESI]) = v44;
            }
LABEL_61:
            v57 = creature_ai_mode[2 * _ESI];
            switch ( v57 )
            {
              case 4:
                _EAX = 19 * creature_link_index[2 * _ESI];
                __asm
                {
                  fld     creature_health[eax*8]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_EAX & 0x4100) != 0 )
                {
                  creature_ai_mode[2 * _ESI] = 0;
                  v200[0] = 0.0;
                  v200[1] = 0.0;
                  creature_apply_damage(creature_id, 1000.0, 1, v200);
                }
                else
                {
                  __asm
                  {
                    fld     [esp+8Ch+var_78]
                    fcomp   ds:flt_46F618
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) != 0 )
                  {
                    __asm
                    {
                      fld     [esp+8Ch+var_74]
                      fcos
                    }
                    _EAX = 864 * creature_target_player[8 * _ESI];
                    __asm
                    {
                      fmul    [esp+8Ch+var_78]
                      fmul    ds:flt_46F684
                      fadd    dword ptr [eax+4908C4h]
                      fstp    creature_target_x[esi*8]
                    }
                    creature_target_x[2 * _ESI] = _ET1;
                    __asm
                    {
                      fld     [esp+8Ch+var_74]
                      fsin
                      fmul    [esp+8Ch+var_78]
                      fmul    ds:flt_46F684
                      fadd    dword ptr [eax+4908C8h]
                      fstp    creature_target_y[esi*8]
                    }
                    creature_target_y[2 * _ESI] = _ET1;
                  }
                  else
                  {
                    v60 = 216 * creature_target_player[8 * _ESI];
                    v61 = player_pos_y[v60];
                    LODWORD(creature_target_x[2 * _ESI]) = player_pos_x[v60];
                    LODWORD(creature_target_y[2 * _ESI]) = v61;
                  }
                }
                goto LABEL_78;
              case 7:
                if ( (creature_flags[2 * _ESI] & 0x80) != 0 && creature_link_index[2 * _ESI] > 0 )
                {
                  v65 = creature_pos_y[2 * _ESI];
                  creature_target_x[2 * _ESI] = *(&creature_pos_x + 2 * _ESI);
                  creature_target_y[2 * _ESI] = v65;
LABEL_78:
                  __asm
                  {
                    fld     creature_target_x[esi*8]
                    fsub    dword ptr [edi]
                    fld     creature_target_y[esi*8]
                    fsub    dword ptr [edi+4]
                    fld     st
                    fmul    st, st(1)
                    fld     st(2)
                    fmul    st, st(3)
                    faddp   st(1), st
                    fsqrt
                    fstp    st(2)
                    fstp    st
                    fcomp   ds:flt_46F2EC
                    fnstsw  ax
                  }
                  if ( (_AX & 0x100) != 0 )
                    creature_force_target[8 * _ESI] = 1;
                  __asm
                  {
                    fld     creature_target_x[esi*8]
                    fsub    dword ptr [edi]
                    fld     creature_target_y[esi*8]
                    fsub    dword ptr [edi+4]
                    fld     st
                    fmul    st, st(1)
                    fld     st(2)
                    fmul    st, st(3)
                    faddp   st(1), st
                    fsqrt
                    fstp    st(2)
                    fstp    st
                    fcomp   ds:flt_46F67C
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) == 0 )
                    creature_force_target[8 * _ESI] = 1;
                  if ( creature_force_target[8 * _ESI] || creature_ai_mode[2 * _ESI] == 2 )
                  {
                    v75 = (float *)&player_pos_x[216 * creature_target_player[8 * _ESI]];
                    creature_target_x[2 * _ESI] = *v75;
                    creature_target_y[2 * _ESI] = v75[1];
                  }
                  __asm
                  {
                    fld     creature_target_x[esi*8]
                    fsub    dword ptr [edi]
                    fld     creature_target_y[esi*8]
                    fsub    dword ptr [edi+4]
                    fxch    st(1)
                    fpatan
                    fadd    ds:flt_46F220
                    fst     creature_target_heading[esi*8]
                  }
                  *(&creature_target_heading + 2 * _ESI) = _ET1;
                  __asm
                  {
                    fld     bonus_energizer_timer
                    fcomp   ds:flt_46F228
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) == 0 )
                  {
                    __asm
                    {
                      fld     creature_max_health[esi*8]
                      fcomp   ds:flt_46F2D4
                      fnstsw  ax
                    }
                    if ( (_AX & 0x100) != 0 )
                      goto LABEL_88;
                  }
                  if ( creature_collision_flag[8 * _ESI] )
                  {
LABEL_88:
                    __asm
                    {
                      fadd    ds:flt_46F378
                      fstp    creature_target_heading[esi*8]
                    }
                    *(&creature_target_heading + 2 * _ESI) = _ET1;
                  }
                  else
                  {
                    __asm { fstp    st }
                  }
                  v80 = creature_flags[2 * _ESI];
                  if ( (v80 & 4) != 0 )
                  {
                    __asm
                    {
                      fld     dword ptr [edi]
                      fcomp   creature_size[esi*8]
                      fnstsw  ax
                    }
                    if ( (_AX & 0x100) != 0 )
                      *(&creature_pos_x + 2 * _ESI) = *(&creature_size + 2 * _ESI);
                    __asm
                    {
                      fld     creature_pos_y[esi*8]
                      fcomp   creature_size[esi*8]
                      fnstsw  ax
                    }
                    if ( (_AX & 0x100) != 0 )
                      creature_pos_y[2 * _ESI] = *(&creature_size + 2 * _ESI);
                    __asm
                    {
                      fld     ds:flt_46F678
                      fsub    creature_size[esi*8]
                      fcom    dword ptr [edi]
                      fnstsw  ax
                    }
                    if ( (_AX & 0x100) != 0 )
                    {
                      __asm { fst     dword ptr [edi] }
                      *(&creature_pos_x + 2 * _ESI) = _ET1;
                    }
                    __asm
                    {
                      fcom    creature_pos_y[esi*8]
                      fnstsw  ax
                    }
                    if ( (_AX & 0x100) != 0 )
                    {
                      __asm { fstp    creature_pos_y[esi*8] }
                      creature_pos_y[2 * _ESI] = _ET1;
                    }
                    else
                    {
                      __asm { fstp    st }
                    }
                    if ( (v80 & 0x40) != 0 )
                    {
                      __asm
                      {
                        fld     creature_move_speed[esi*8]
                        fmul    ds:flt_46F364
                      }
                      _EBX = (float *)(8 * _ESI + 4833124);
                      __asm
                      {
                        fmul    ds:flt_46F25C
                        fstp    [esp+90h+rate]; rate
                      }
                      angle_approach(_EBX, *(&creature_target_heading + 2 * _ESI), rate);
                      __asm
                      {
                        fstp    st
                        fld     dword ptr [ebx]
                        fsub    ds:flt_46F220
                      }
                      v171 = (float *)(8 * _ESI + 4833108);
                      __asm
                      {
                        fld     st
                        fcos
                      }
                      __asm
                      {
                        fmul    frame_dt
                        fmul    [esp+0A4h+var_70]
                        fmul    creature_move_speed[esi*8]
                        fmul    ds:flt_46F4B0
                        fstp    dword ptr [eax]
                      }
                      *v171 = _ET1;
                      __asm
                      {
                        fsin
                        fmul    frame_dt
                        fmul    [esp+0A4h+var_70]
                        fmul    creature_move_speed[esi*8]
                        fmul    ds:flt_46F4B0
                        fstp    creature_vel_y[esi*8]
                      }
                      creature_vel_y[2 * _ESI] = _ET1;
                      vec2_add_inplace(creature_id, (float *)(8 * _ESI + 4833100), v171);
                    }
                    else
                    {
                      creature_vel_y[2 * _ESI] = 0;
                      creature_vel_x[2 * _ESI] = 0;
                    }
                    _EAX = 3 * creature_link_index[2 * _ESI];
                    __asm
                    {
                      fld     creature_spawn_slot_timer[eax*8]
                      fsub    frame_dt
                    }
                    _ECX = 24 * creature_link_index[2 * _ESI] + 4739024;
                    __asm
                    {
                      fcom    ds:flt_46F228
                      fst     dword ptr [ecx+10h]
                    }
                    *(float *)(_ECX + 16) = _ET1;
                    __asm { fnstsw  ax }
                    if ( (_EAX & 0x100) != 0 )
                    {
                      __asm { fadd    dword ptr [ecx+0Ch] }
                      v93 = *(_DWORD *)(_ECX + 4);
                      v94 = *(_DWORD *)(_ECX + 8);
                      __asm { fstp    dword ptr [ecx+10h] }
                      *(float *)(_ECX + 16) = _ET1;
                      if ( v94 > v93 )
                      {
                        *(_DWORD *)(_ECX + 4) = v93 + 1;
                        creature_spawn_template(*(_DWORD *)(_ECX + 20), (float *)(8 * _ESI + 4833100), -100.0);
                      }
                    }
                    else
                    {
                      __asm { fstp    st }
                    }
                  }
                  else if ( creature_ai_mode[2 * _ESI] != 7 )
                  {
                    __asm
                    {
                      fld     creature_move_speed[esi*8]
                      fmul    ds:flt_46F364
                    }
                    _EBX = (float *)(8 * _ESI + 4833124);
                    __asm
                    {
                      fmul    ds:flt_46F25C
                      fstp    [esp+90h+rate]; rate
                    }
                    angle_approach(_EBX, *(&creature_target_heading + 2 * _ESI), ratea);
                    __asm
                    {
                      fstp    st
                      fld     dword ptr [ebx]
                      fsub    ds:flt_46F220
                    }
                    v172 = (float *)(8 * _ESI + 4833108);
                    __asm
                    {
                      fld     st
                      fcos
                      fmul    frame_dt
                      fmul    [esp+0A0h+var_70]
                      fmul    creature_move_speed[esi*8]
                      fmul    ds:flt_46F4B0
                      fstp    dword ptr [eax]
                    }
                    *v172 = _ET1;
                    __asm { fsin }
                    __asm
                    {
                      fmul    frame_dt
                      fmul    [esp+0A4h+var_70]
                      fmul    creature_move_speed[esi*8]
                      fmul    ds:flt_46F4B0
                      fstp    creature_vel_y[esi*8]
                    }
                    creature_vel_y[2 * _ESI] = _ET1;
                    vec2_add_inplace(creature_id, (float *)(8 * _ESI + 4833100), v172);
                  }
                  if ( perk_count_get(perk_id_plaguebearer) && plaguebearer_infection_count < 60 )
                    sub_425D80(creature_id);
                  __asm
                  {
                    fld     ds:flt_46F4B0
                    fdiv    creature_size[esi*8]
                  }
                  v99 = creature_flags[2 * _ESI];
                  if ( (v99 & 4) == 0 || (v99 & 0x40) != 0 )
                  {
                    if ( creature_ai_mode[2 * _ESI] == 7 )
                    {
                      __asm { fstp    st }
                    }
                    else
                    {
                      _EDX = 17 * *(&creature_type_id + 2 * _ESI);
                      __asm
                      {
                        fld     creature_type_anim_rate[edx*4]
                        fmul    creature_move_speed[esi*8]
                        fmul    frame_dt
                        fmulp   st(1), st
                        fmul    [esp+8Ch+var_70]
                        fmul    ds:flt_46F524
                        fadd    creature_anim_phase[esi*8]
                        fst     creature_anim_phase[esi*8]
                      }
                      creature_anim_phase[2 * _ESI] = _ET1;
                      __asm
                      {
                        fcomp   ds:flt_46F658
                        fnstsw  ax
                      }
                      if ( (_AX & 0x4100) == 0 )
                      {
                        do
                        {
                          __asm
                          {
                            fld     creature_anim_phase[esi*8]
                            fsub    ds:flt_46F658
                            fst     creature_anim_phase[esi*8]
                          }
                          creature_anim_phase[2 * _ESI] = _ET1;
                          __asm
                          {
                            fcomp   ds:flt_46F658
                            fnstsw  ax
                          }
                        }
                        while ( (_AX & 0x4100) == 0 );
                      }
                    }
                  }
                  else
                  {
                    _ECX = 17 * *(&creature_type_id + 2 * _ESI);
                    __asm
                    {
                      fld     creature_type_anim_rate[ecx*4]
                      fmul    creature_move_speed[esi*8]
                      fmul    frame_dt
                      fmulp   st(1), st
                      fmul    [esp+8Ch+var_70]
                      fmul    ds:flt_46F2A0
                      fadd    creature_anim_phase[esi*8]
                      fst     creature_anim_phase[esi*8]
                    }
                    creature_anim_phase[2 * _ESI] = _ET1;
                    __asm
                    {
                      fcomp   ds:flt_46F360
                      fnstsw  ax
                    }
                    if ( (_AX & 0x4100) == 0 )
                    {
                      __asm { fld     creature_anim_phase[esi*8] }
                      do
                      {
                        __asm
                        {
                          fsub    ds:flt_46F360
                          fld     st
                          fxch    st(1)
                          fcomp   ds:flt_46F360
                          fnstsw  ax
                        }
                      }
                      while ( (_AX & 0x4100) == 0 );
                      __asm { fstp    creature_anim_phase[esi*8] }
                      creature_anim_phase[2 * _ESI] = _ET1;
                    }
                  }
                  __asm
                  {
                    fld     creature_attack_cooldown[esi*8]
                    fcomp   ds:flt_46F228
                  }
                  _EBP = 8 * _ESI + 4833176;
                  __asm { fnstsw  ax }
                  if ( (_AX & 0x4100) != 0 )
                  {
                    creature_attack_cooldown[2 * _ESI] = 0.0;
                  }
                  else
                  {
                    __asm
                    {
                      fld     dword ptr [ebp+0]
                      fsub    frame_dt
                      fstp    dword ptr [ebp+0]
                    }
                    creature_attack_cooldown[2 * _ESI] = _ET1;
                  }
                  __asm { fld     dword ptr [edi] }
                  _EAX = &player_pos_x[216 * creature_target_player[8 * _ESI]];
                  __asm
                  {
                    fsub    dword ptr [eax]
                    fld     dword ptr [edi+4]
                    fsub    dword ptr [eax+4]
                    fld     st
                    fmul    st, st(1)
                    fld     st(2)
                    fmul    st, st(3)
                    faddp   st(1), st
                    fsqrt
                    fstp    st(2)
                    fstp    st
                    fst     [esp+8Ch+var_74]
                    fcomp   ds:flt_46F2C4
                    fnstsw  ax
                  }
                  if ( (BYTE1(_EAX) & 1) != 0 )
                  {
                    if ( perk_count_get(perk_id_radioactive) )
                    {
                      __asm
                      {
                        fld     frame_dt
                        fmul    ds:flt_46F338
                        fsubr   creature_collision_timer[esi*8]
                        fst     creature_collision_timer[esi*8]
                      }
                      creature_collision_timer[2 * _ESI] = _ET1;
                      __asm
                      {
                        fcomp   ds:flt_46F228
                        fnstsw  ax
                      }
                      if ( (_AX & 0x100) != 0 )
                      {
                        _ECX = 8 * _ESI + 4833116;
                        __asm
                        {
                          fld     dword ptr [ecx]
                          fcomp   ds:flt_46F228
                          fnstsw  ax
                        }
                        if ( (_AX & 0x4100) == 0 )
                        {
                          __asm
                          {
                            fld     ds:flt_46F2C4
                            fsub    [esp+8Ch+var_74]
                          }
                          creature_collision_timer[2 * _ESI] = 1056964608;
                          creature_state_flag[8 * _ESI] = 1;
                          __asm
                          {
                            fmul    ds:flt_46F258
                            fsubr   dword ptr [ecx]
                            fst     dword ptr [ecx]
                          }
                          creature_health[2 * _ESI] = _ET1;
                          __asm
                          {
                            fcomp   ds:flt_46F228
                            fnstsw  ax
                          }
                          if ( (_AX & 0x100) != 0 )
                          {
                            if ( *(&creature_type_id + 2 * _ESI) == 1 )
                            {
                              creature_health[2 * _ESI] = 1065353216;
                            }
                            else
                            {
                              __asm
                              {
                                fild    player_experience
                                fadd    creature_reward_value[esi*8]
                              }
                              player_experience[0] = _ftol();
                              _EAX = (float *)(8 * _ESI + 4833096);
                              __asm
                              {
                                fld     dword ptr [eax]
                                fsub    frame_dt
                                fstp    dword ptr [eax]
                              }
                              *_EAX = _ET1;
                            }
                          }
                          fx_queue_add_random((float *)(8 * _ESI + 4833100));
                        }
                      }
                    }
                  }
                  __asm
                  {
                    fld     [esp+8Ch+var_74]
                    fcomp   ds:flt_46F2AC
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) == 0 )
                  {
                    if ( (creature_flags[2 * _ESI] & 0x10) != 0 )
                    {
                      __asm
                      {
                        fld     dword ptr [ebp+0]
                        fcomp   ds:flt_46F228
                        fnstsw  ax
                      }
                      if ( (_AX & 0x4100) != 0 )
                      {
                        projectile_spawn((float *)(8 * _ESI + 4833100), *(&creature_heading + 2 * _ESI), 9, creature_id);
                        __asm
                        {
                          fld     dword ptr [ebp+0]
                          fadd    ds:flt_46F224
                        }
                        v169 = sfx_shock_fire;
                        __asm { fstp    dword ptr [ebp+0] }
                        creature_attack_cooldown[2 * _ESI] = _ET1;
                        sfx_play_panned(v169);
                      }
                    }
                    if ( (creature_flags[2 * _ESI] & 0x100) != 0 )
                    {
                      __asm
                      {
                        fld     dword ptr [ebp+0]
                        fcomp   ds:flt_46F228
                        fnstsw  ax
                      }
                      if ( (_AX & 0x4100) != 0 )
                      {
                        projectile_spawn(
                          (float *)(8 * _ESI + 4833100),
                          *(&creature_heading + 2 * _ESI),
                          *(&creature_orbit_radius + 2 * _ESI),
                          creature_id);
                        v191 = crt_rand() & 3;
                        __asm { fild    [esp+0A0h+var_60] }
                        v170 = sfx_plasmaminigun_fire;
                        __asm
                        {
                          fmul    ds:flt_46F628
                          fadd    creature_orbit_angle[esi*8]
                          fadd    dword ptr [ebp+0]
                          fstp    dword ptr [ebp+0]
                        }
                        creature_attack_cooldown[2 * _ESI] = _ET1;
                        sfx_play_panned(v170);
                      }
                    }
                  }
                  __asm
                  {
                    fld     [esp+8Ch+var_74]
                    fcomp   ds:flt_46F2B4
                    fnstsw  ax
                  }
                  if ( (_AX & 0x100) != 0 )
                  {
                    __asm
                    {
                      fld     dword ptr [edi]
                      fsub    creature_vel_x[esi*8]
                      fstp    dword ptr [edi]
                    }
                    *(&creature_pos_x + 2 * _ESI) = _ET1;
                    __asm
                    {
                      fld     dword ptr [edi+4]
                      fsub    creature_vel_y[esi*8]
                      fstp    dword ptr [edi+4]
                    }
                    creature_pos_y[2 * _ESI] = _ET1;
                    __asm
                    {
                      fld     creature_max_health[esi*8]
                      fcomp   ds:flt_46F674
                      fnstsw  ax
                    }
                    if ( (_AX & 0x100) != 0 )
                    {
                      __asm
                      {
                        fld     bonus_energizer_timer
                        fcomp   ds:flt_46F228
                        fnstsw  ax
                      }
                      if ( (_AX & 0x4100) == 0 )
                      {
                        __asm
                        {
                          fild    player_experience
                          fadd    creature_reward_value[esi*8]
                        }
                        player_experience[0] = _ftol();
                        effect_spawn_burst((float *)(8 * _ESI + 4833100), 6);
                        sfx_play_panned(sfx_ui_bonus);
                        bonus_spawn_guard = 1;
                        creature_handle_death(creature_id, 0);
                        bonus_spawn_guard = 0;
                      }
                    }
                  }
                  _ECX = 8 * _ESI + 4833132;
                  __asm
                  {
                    fld     dword ptr [ecx]
                    fcomp   ds:flt_46F230
                    fnstsw  ax
                  }
                  if ( (_AX & 0x4100) == 0 )
                  {
                    __asm
                    {
                      fld     [esp+8Ch+var_74]
                      fcomp   ds:flt_46F4B0
                      fnstsw  ax
                    }
                    if ( (_AX & 0x100) == 0 )
                      goto LABEL_191;
                    _EDX = 864 * creature_target_player[8 * _ESI];
                    __asm
                    {
                      fld     dword ptr [edx+4908D4h]
                      fcomp   ds:flt_46F228
                      fnstsw  ax
                    }
                    if ( (_AX & 0x4100) == 0 )
                    {
                      __asm
                      {
                        fld     bonus_energizer_timer
                        fcomp   ds:flt_46F228
                        fnstsw  ax
                      }
                      if ( (_AX & 0x4100) != 0 )
                      {
                        __asm
                        {
                          fld     dword ptr [ebp+0]
                          fcomp   ds:flt_46F228
                          fnstsw  ax
                        }
                        if ( (_AX & 0x4100) != 0 )
                        {
                          v139 = crt_rand() % 2;
                          sfx_play_panned(*(&creature_type_sfx_b0 + 17 * *(&creature_type_id + 2 * _ESI) + v139));
                          if ( perk_count_get(perk_id_mr_melee) )
                          {
                            v201[0] = 0.0;
                            v201[1] = 0.0;
                            creature_apply_damage(creature_id, 25.0, 2, v201);
                          }
                          _ECX = 864 * creature_target_player[8 * _ESI];
                          __asm
                          {
                            fld     dword ptr [ecx+490BC8h]
                            fcomp   ds:flt_46F228
                            fnstsw  ax
                          }
                          if ( (_AX & 0x4100) != 0 )
                          {
                            if ( perk_count_get(perk_id_toxic_avenger) )
                            {
                              v142 = creature_flags[2 * _ESI];
                              LOBYTE(v142) = v142 | 3;
                              goto LABEL_158;
                            }
                            if ( perk_count_get(perk_id_veins_of_poison) )
                            {
                              v142 = creature_flags[2 * _ESI];
                              LOBYTE(v142) = v142 | 1;
LABEL_158:
                              creature_flags[2 * _ESI] = v142;
                            }
                          }
                          player_take_damage(creature_target_player[8 * _ESI], *(&creature_contact_damage + 2 * _ESI));
                          _EAX = &player_pos_x[216 * creature_target_player[8 * _ESI]];
                          __asm
                          {
                            fld     dword ptr [eax+4]
                            fsub    dword ptr [edi+4]
                            fld     dword ptr [eax]
                            fsub    dword ptr [edi]
                          }
                          __asm
                          {
                            fstp    [esp+94h+var_58]
                            fstp    [esp+94h+var_54]
                          }
                          j_FUN_00452f1d(&v195);
                          __asm
                          {
                            fld     [esp+8Ch+var_58]
                            fmul    ds:flt_46F248
                            fld     [esp+8Ch+var_54]
                          }
                          __asm { fmul    ds:flt_46F248 }
                          _EAX = &player_pos_x[216 * creature_target_player[8 * _ESI]];
                          __asm
                          {
                            fadd    dword ptr [eax+4]
                            fxch    st(1)
                            fadd    dword ptr [eax]
                            fstp    [esp+90h+pos]
                            fstp    [esp+90h+var_24]
                          }
                          fx_queue_add_random(pos);
                          __asm
                          {
                            fld     dword ptr [ebp+0]
                            fadd    ds:flt_46F224
                          }
                          __asm { fstp    dword ptr [ebp+0] }
                          creature_attack_cooldown[2 * _ESI] = _ET1;
                        }
                        if ( player_plaguebearer_active[864 * creature_target_player[8 * _ESI]] )
                        {
                          _ECX = 8 * _ESI + 4833116;
                          __asm
                          {
                            fld     dword ptr [ecx]
                            fcomp   ds:flt_46F66C
                            fnstsw  ax
                          }
                          if ( (_AX & 0x100) != 0 && plaguebearer_infection_count < 50 )
                            creature_collision_flag[8 * _ESI] = 1;
                        }
                      }
                    }
                  }
                  __asm
                  {
                    fld     [esp+8Ch+var_74]
                    fcomp   ds:flt_46F4B0
                    fnstsw  ax
                  }
                  if ( (_AX & 0x100) != 0 )
                  {
                    _EAX = 8 * _ESI + 4833132;
                    __asm
                    {
                      fld     dword ptr [eax]
                      fcomp   ds:flt_46F4B0
                      fnstsw  ax
                    }
                    if ( (_EAX & 0x4100) != 0 )
                    {
                      _EAX = (float *)(8 * _ESI + 4833096);
                      creature_health[2 * _ESI] = 0;
                      __asm
                      {
                        fld     dword ptr [eax]
                        fsub    frame_dt
                        fstp    dword ptr [eax]
                      }
                      *_EAX = _ET1;
                    }
                  }
                  goto LABEL_191;
                }
                __asm
                {
                  fld     creature_orbit_radius[esi*8]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x4100) == 0 && (creature_flags[2 * _ESI] & 0x80) == 0 )
                {
                  __asm
                  {
                    fld     creature_orbit_radius[esi*8]
                    fsub    frame_dt
                  }
                  v67 = creature_pos_y[2 * _ESI];
                  creature_target_x[2 * _ESI] = *(&creature_pos_x + 2 * _ESI);
                  creature_target_y[2 * _ESI] = v67;
                  __asm { fstp    creature_orbit_radius[esi*8] }
                  *(&creature_orbit_radius + 2 * _ESI) = _ET1;
                  goto LABEL_78;
                }
                break;
              case 6:
                _ECX = 152 * creature_link_index[2 * _ESI];
                __asm
                {
                  fld     dword ptr [ecx+49BF5Ch]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x4100) == 0 )
                {
                  __asm
                  {
                    fld     creature_orbit_angle[esi*8]
                    fadd    creature_heading[esi*8]
                    fld     st
                    fcos
                    fmul    creature_orbit_radius[esi*8]
                    fadd    dword ptr [ecx+49BF4Ch]
                    fstp    creature_target_x[esi*8]
                  }
                  creature_target_x[2 * _ESI] = _ET1;
                  __asm
                  {
                    fsin
                    fmul    creature_orbit_radius[esi*8]
                    fadd    dword ptr [ecx+49BF50h]
                    fstp    creature_target_y[esi*8]
                  }
                  creature_target_y[2 * _ESI] = _ET1;
                  goto LABEL_78;
                }
                break;
              default:
                goto LABEL_78;
            }
            creature_ai_mode[2 * _ESI] = 0;
            goto LABEL_78;
          }
        }
        else
        {
          __asm
          {
            fld     dword ptr [ebx]
            fcomp   ds:flt_46F228
            fld     frame_dt
            fnstsw  ax
          }
          if ( (_AX & 0x4100) != 0 )
          {
            __asm
            {
              fmul    ds:flt_46F2B4
              fsubr   dword ptr [ebx]
              fstp    dword ptr [ebx]
            }
            creature_hitbox_size[2 * _ESI] = _ET1;
          }
          else
          {
            __asm
            {
              fmul    ds:flt_46F2E0
              fsubr   dword ptr [ebx]
              fstp    [esp+8Ch+var_68]
              fld     [esp+8Ch+var_68]
              fcomp   ds:flt_46F228
            }
            creature_hitbox_size[2 * _ESI] = v190;
            __asm { fnstsw  ax }
            if ( (_AX & 0x4100) != 0 )
            {
              if ( config_fx_toggle )
                goto LABEL_176;
              v154 = creature_flags[2 * _ESI];
              if ( (v154 & 4) == 0 || (v154 & 0x40) != 0 )
              {
                __asm
                {
                  fld     creature_size[esi*8]
                  fmul    ds:flt_46F24C
                }
                v156 = *(&creature_heading + 2 * _ESI);
                rateb = *(&creature_type_id + 2 * _ESI);
                anglea = *(&creature_size + 2 * _ESI);
                __asm
                {
                  fst     [esp+94h+var_8]
                  fld     dword ptr [edi]
                  fsub    [esp+94h+var_8]
                }
                __asm
                {
                  fstp    [esp+0A0h+var_18]
                  fld     dword ptr [edi+4]
                  fsub    st, st(1)
                  fstp    [esp+0A0h+var_14]
                  fstp    st
                }
                v155 = fx_queue_add_rotated(v204, (float *)(8 * _ESI + 4833140), v156, anglea, rateb);
              }
              else
              {
                __asm
                {
                  fld     creature_size[esi*8]
                  fmul    ds:flt_46F24C
                }
                angle = *(&creature_size + 2 * _ESI);
                damageb = *(&creature_heading + 2 * _ESI);
                __asm
                {
                  fst     [esp+98h+var_10]
                  fld     dword ptr [edi]
                  fsub    [esp+98h+var_10]
                }
                __asm
                {
                  fstp    [esp+0A0h+var_20]
                  fld     dword ptr [edi+4]
                  fsub    st, st(1)
                  fstp    [esp+0A0h+var_1C]
                  fstp    st
                }
                v155 = fx_queue_add_rotated(v203, (float *)(8 * _ESI + 4833140), damageb, angle, 7);
              }
              if ( v155 )
              {
LABEL_176:
                ++creature_kill_count;
                if ( !config_fx_toggle && (creature_flags[2 * _ESI] & 4) != 0 )
                {
                  v157 = 8;
                  do
                  {
                    v192 = crt_rand() % 612;
                    __asm
                    {
                      fild    [esp+94h+var_5C]
                      fmul    ds:flt_46F300
                      fstp    [esp+94h+angle]; angle
                    }
                    effect_spawn_blood_splatter((float *)(8 * _ESI + 4833100), angleb, 0.0);
                    --v157;
                  }
                  while ( v157 );
                  v158 = 6;
                  do
                  {
                    v193 = crt_rand() % 612;
                    __asm
                    {
                      fild    [esp+94h+var_5C]
                      fmul    ds:flt_46F300
                      fstp    [esp+94h+angle]; angle
                    }
                    effect_spawn_blood_splatter((float *)(8 * _ESI + 4833100), anglec, -0.07);
                    --v158;
                  }
                  while ( v158 );
                  v159 = 5;
                  do
                  {
                    v194 = crt_rand() % 612;
                    __asm
                    {
                      fild    [esp+94h+var_5C]
                      fmul    ds:flt_46F300
                      fstp    [esp+94h+angle]; angle
                    }
                    effect_spawn_blood_splatter((float *)(8 * _ESI + 4833100), angled, -0.12);
                    --v159;
                  }
                  while ( v159 );
                }
                _EDX = cv_bodiesFade;
                __asm
                {
                  fld     dword ptr [edx+0Ch]
                  fcomp   ds:flt_46F228
                  fnstsw  ax
                }
                if ( (_AX & 0x4000) != 0 )
                  creature_pool[8 * _ESI] = 0;
              }
              else
              {
                creature_hitbox_size[2 * _ESI] = 981668463;
              }
            }
            else
            {
              v162 = creature_flags[2 * _ESI];
              if ( (v162 & 4) == 0 || (v162 & 0x40) != 0 )
              {
                __asm
                {
                  fld     creature_heading[esi*8]
                  fsub    ds:flt_46F220
                }
                _EAX = (float *)(8 * _ESI + 4833108);
                __asm
                {
                  fld     st
                  fcos
                  fmul    [esp+8Ch+var_68]
                  fmul    frame_dt
                  fmul    ds:flt_46F298
                  fstp    dword ptr [eax]
                }
                *_EAX = _ET1;
                __asm
                {
                  fsin
                  fmul    [esp+8Ch+var_68]
                  fmul    frame_dt
                  fmul    ds:flt_46F298
                  fstp    creature_vel_y[esi*8]
                }
                creature_vel_y[2 * _ESI] = _ET1;
                __asm
                {
                  fld     dword ptr [edi]
                  fsub    dword ptr [eax]
                  fstp    dword ptr [edi]
                }
                *(&creature_pos_x + 2 * _ESI) = _ET1;
                __asm
                {
                  fld     dword ptr [edi+4]
                  fsub    dword ptr [eax+4]
                  fstp    dword ptr [edi+4]
                }
                creature_pos_y[2 * _ESI] = _ET1;
              }
              else
              {
                creature_vel_x[2 * _ESI] = 0;
                creature_vel_y[2 * _ESI] = 0;
              }
            }
          }
        }
      }
    }
LABEL_191:
    if ( ++creature_id >= 384 )
      break;
  }
}

// fx_queue_add_random @ 0x00427700
// spawns a random fx_queue_add entry (effect ids 3..7) with grayscale color/size
void fx_queue_add_random(float *pos)
{
  double v1; // st7
  int v2; // eax
  float w; // [esp+0h] [ebp-10h]
  float rotation; // [esp+4h] [ebp-Ch]
  float v5[2]; // [esp+8h] [ebp-8h] BYREF

  if ( !config_fx_toggle )
  {
    if ( (byte_4912B0 & 1) == 0 )
    {
      qmemcpy(&fx_queue_random_color_r, "fff?fff?fff?", 12);
      byte_4912B0 |= 1u;
      fx_queue_random_color_a = 1061662228;
      crt_atexit(nullsub_42);
    }
    *(float *)&fx_queue_random_color_b = (double)(crt_rand() & 0xF) * 0.0099999998 + 0.83999997;
    fx_queue_random_color_g = fx_queue_random_color_b;
    fx_queue_random_color_r = *(float *)&fx_queue_random_color_b;
    w = (double)(crt_rand() % 24 - 12) + 30.0;
    rotation = (double)(crt_rand() % 628) * 0.0099999998;
    v1 = w * 0.5;
    v5[0] = v1;
    v5[0] = *pos - v5[0];
    v5[1] = pos[1] - v1;
    v2 = crt_rand();
    fx_queue_add(v2 % 5 + 3, v5, w, w, rotation, &fx_queue_random_color_r);
  }
}

// nullsub_42 @ 0x00427830
void __cdecl nullsub_42()
{
  ;
}

// fx_queue_add_rotated @ 0x00427840
// pushes a rotated sprite into DAT_004aaf3c (capped at 0x40); returns 1 on success
int fx_queue_add_rotated(float *pos, float *rgba, float rotation, float scale, int effect_id)
{
  int v5; // edx
  int result; // eax
  float *v7; // eax
  double v8; // st7

  if ( !terrain_texture_failed )
  {
    v5 = fx_queue_rotated;
    if ( fx_queue_rotated == 63 )
    {
      LOBYTE(result) = 0;
      return result;
    }
    v7 = (float *)&fx_rotated_color_r[4 * fx_queue_rotated];
    *v7 = *rgba;
    v7[1] = rgba[1];
    v7[2] = rgba[2];
    v7[3] = rgba[3];
    if ( *(float *)(cv_terrainBodiesTransparency + 12) == 0.0 )
      v8 = fx_rotated_color_a[4 * v5] * 0.80000001;
    else
      v8 = 1.0 / *(float *)(cv_terrainBodiesTransparency + 12) * fx_rotated_color_a[4 * v5];
    fx_rotated_color_a[4 * v5] = v8;
    fx_rotated_rotation[v5] = rotation;
    fx_rotated_effect_id[v5] = effect_id;
    fx_rotated_scale[v5] = scale;
    fx_rotated_pos_x[2 * v5] = *(_DWORD *)pos;
    result = *((_DWORD *)pos + 1);
    fx_rotated_pos_y[2 * v5] = result;
    fx_queue_rotated = v5 + 1;
    if ( v5 + 1 >= 64 )
      fx_queue_rotated = 63;
  }
  LOBYTE(result) = 1;
  return result;
}

// fx_queue_render @ 0x00427920
// bakes FX queues (DAT_004aaf18/DAT_004aaf3c) into the ground render target (terrain_render_target) and clears them
void fx_queue_render()
{
  int v0; // esi
  float *v1; // ebp
  float *v2; // edi
  int v3; // eax
  float v4; // ebx
  double v5; // st7
  double v6; // st7
  double v7; // st7
  int v8; // esi
  float *v9; // ebx
  _DWORD *v10; // edi
  int v11; // eax
  float v12; // ebp
  double v13; // st7
  int v14; // edi
  int *v15; // esi
  int v16; // esi
  float *v17; // ebp
  float *v18; // edi
  int v19; // eax
  float v20; // ebx
  double v21; // st7
  double v22; // st7
  double v23; // st7
  int v24; // esi
  float *v25; // ebp
  _DWORD *v26; // edi
  int v27; // eax
  float v28; // ecx
  double v29; // st7
  float v30; // [esp+E4h] [ebp-40h]
  float v31; // [esp+E4h] [ebp-40h]
  float v32; // [esp+E4h] [ebp-40h]
  float v33; // [esp+E4h] [ebp-40h]
  float v34; // [esp+E4h] [ebp-40h]
  int v35; // [esp+E8h] [ebp-3Ch]
  int v36; // [esp+E8h] [ebp-3Ch]
  int v37; // [esp+E8h] [ebp-3Ch]
  float v38; // [esp+E8h] [ebp-3Ch]
  int v39; // [esp+E8h] [ebp-3Ch]
  float v40; // [esp+E8h] [ebp-3Ch]
  float v41; // [esp+E8h] [ebp-3Ch]
  int v42; // [esp+E8h] [ebp-3Ch]
  int v43; // [esp+E8h] [ebp-3Ch]
  float v44; // [esp+E8h] [ebp-3Ch]
  int v45; // [esp+E8h] [ebp-3Ch]
  float v46; // [esp+E8h] [ebp-3Ch]
  int v47; // [esp+ECh] [ebp-38h]
  int v48; // [esp+ECh] [ebp-38h]
  int v49; // [esp+ECh] [ebp-38h]
  float v50; // [esp+ECh] [ebp-38h]
  int v51; // [esp+ECh] [ebp-38h]
  int v52; // [esp+ECh] [ebp-38h]
  int v53; // [esp+ECh] [ebp-38h]
  int v54; // [esp+ECh] [ebp-38h]
  int v55; // [esp+F0h] [ebp-34h]
  int v56; // [esp+F0h] [ebp-34h]
  float v57; // [esp+F0h] [ebp-34h]
  float v58; // [esp+F0h] [ebp-34h]
  int v59; // [esp+F0h] [ebp-34h]
  float v60; // [esp+F0h] [ebp-34h]
  float v61; // [esp+F0h] [ebp-34h]
  int v62; // [esp+F0h] [ebp-34h]
  int v63; // [esp+F0h] [ebp-34h]
  int v64; // [esp+F0h] [ebp-34h]
  float v65; // [esp+F0h] [ebp-34h]
  float v66; // [esp+F0h] [ebp-34h]
  int v67; // [esp+F0h] [ebp-34h]
  float v68; // [esp+F0h] [ebp-34h]
  float v69; // [esp+104h] [ebp-20h]
  float v70; // [esp+108h] [ebp-1Ch]
  float v71; // [esp+108h] [ebp-1Ch]
  int v72; // [esp+10Ch] [ebp-18h]
  float v73; // [esp+10Ch] [ebp-18h]
  float v74; // [esp+10Ch] [ebp-18h]
  int v75; // [esp+110h] [ebp-14h]
  int v76; // [esp+114h] [ebp-10h]
  int v77; // [esp+114h] [ebp-10h]
  int v78; // [esp+114h] [ebp-10h]
  int v79; // [esp+118h] [ebp-Ch]
  int v80; // [esp+118h] [ebp-Ch]
  int v81; // [esp+118h] [ebp-Ch]
  int v82; // [esp+11Ch] [ebp-8h]
  int v83; // [esp+11Ch] [ebp-8h]
  int v84; // [esp+120h] [ebp-4h]
  int v85; // [esp+120h] [ebp-4h]

  v69 = 1.0 / *(float *)config_texture_scale;
  v70 = 1.0 / ((double)terrain_texture_width / *(float *)config_texture_scale * 0.5);
  if ( terrain_texture_failed )
  {
    if ( fx_queue_rotated > 0 )
    {
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        bodyset_texture,
        0);
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 19, 1);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v36,
        v47,
        v55);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v0 = 0;
      if ( fx_queue_rotated > 0 )
      {
        v1 = (float *)fx_rotated_pos_x;
        v2 = (float *)&fx_rotated_color_b;
        do
        {
          v3 = creature_type_corpse_frame[17 * fx_rotated_effect_id[v0]];
          v4 = effect_uv4_v[2 * v3];
          dword_4965D8 = effect_uv4[2 * v3];
          dword_4965DC = LODWORD(v4);
          *(float *)&v76 = *(float *)&effect_uv4[2 * v3] + 0.25;
          v5 = effect_uv4_v[2 * v3] + 0.25;
          dword_4965E0 = v76;
          *(float *)&v79 = v5;
          dword_4965E4 = v79;
          (*(void (__thiscall **)(int, int, float, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
            grim_interface_ptr,
            dword_4965D8,
            COERCE_FLOAT(LODWORD(v4)),
            v76,
            v79);
          v57 = v2[1] * 0.5;
          (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            *((_DWORD *)v2 - 2),
            *((_DWORD *)v2 - 1),
            *(_DWORD *)v2,
            LODWORD(v57));
          v58 = fx_rotated_rotation[v0] - 1.5707964;
          (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v58));
          *(float *)&v72 = *v1 + 2.0;
          v6 = v1[1] + 2.0;
          dword_4965D8 = v72;
          *(float *)&v75 = v6;
          v7 = fx_rotated_scale[v0] * 1.04;
          dword_4965DC = v75;
          v71 = v7;
          v38 = *(float *)&v75 + *(float *)&camera_offset_y;
          v30 = *(float *)&v72 + *(float *)&camera_offset_x;
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v30),
            LODWORD(v38),
            LODWORD(v71),
            LODWORD(v71));
          ++v0;
          v2 += 4;
          v1 += 2;
        }
        while ( v0 < fx_queue_rotated );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v37,
        v48,
        v56);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v39,
        v49,
        v59);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v8 = 0;
      if ( fx_queue_rotated > 0 )
      {
        v9 = (float *)fx_rotated_pos_x;
        v10 = &fx_rotated_color_b;
        do
        {
          v11 = creature_type_corpse_frame[17 * fx_rotated_effect_id[v8]];
          v12 = effect_uv4_v[2 * v11];
          dword_4965D8 = effect_uv4[2 * v11];
          dword_4965DC = LODWORD(v12);
          *(float *)&v77 = *(float *)&effect_uv4[2 * v11] + 0.25;
          v13 = effect_uv4_v[2 * v11] + 0.25;
          dword_4965E0 = v77;
          *(float *)&v80 = v13;
          dword_4965E4 = v80;
          (*(void (__thiscall **)(int, int, float, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
            grim_interface_ptr,
            dword_4965D8,
            COERCE_FLOAT(LODWORD(v12)),
            v77,
            v80);
          (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            *(v10 - 2),
            *(v10 - 1),
            *v10,
            v10[1]);
          v60 = fx_rotated_rotation[v8] - 1.5707964;
          (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v60));
          v40 = *(float *)&camera_offset_y + v9[1];
          v31 = *(float *)&camera_offset_x + *v9;
          (*(void (__stdcall **)(_DWORD, _DWORD, float, float))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v31),
            LODWORD(v40),
            fx_rotated_scale[v8],
            fx_rotated_scale[v8]);
          ++v8;
          v10 += 4;
          v9 += 2;
        }
        while ( v8 < fx_queue_rotated );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    }
  }
  else if ( fx_queue_rotated || fx_queue_count )
  {
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 48))(grim_interface_ptr, terrain_render_target);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      particles_texture,
      0);
    if ( fx_queue_count > 0 )
    {
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
        grim_interface_ptr,
        0,
        0,
        1065353216,
        1065353216);
      v14 = 0;
      if ( fx_queue_count > 0 )
      {
        v15 = fx_queue_rotation;
        do
        {
          (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, v15 + 5);
          (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, *v15);
          effect_select_texture(*(v15 - 1));
          v61 = v69 * *((float *)v15 + 3);
          v50 = v69 * *((float *)v15 + 4);
          v41 = (*((float *)v15 + 2) - *((float *)v15 + 3) * 0.5) * v69;
          v32 = (*((float *)v15 + 1) - *((float *)v15 + 4) * 0.5) * v69;
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v32),
            LODWORD(v41),
            LODWORD(v50),
            LODWORD(v61));
          ++v14;
          v15 += 10;
        }
        while ( v14 < fx_queue_count );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    }
    if ( fx_queue_rotated > 0 )
    {
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        bodyset_texture,
        0);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        1,
        v35,
        v51,
        v62);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v42,
        v52,
        v63);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v16 = 0;
      if ( fx_queue_rotated > 0 )
      {
        v17 = (float *)fx_rotated_pos_x;
        v18 = (float *)&fx_rotated_color_b;
        do
        {
          v19 = creature_type_corpse_frame[17 * fx_rotated_effect_id[v16]];
          v20 = effect_uv4_v[2 * v19];
          dword_4965D8 = effect_uv4[2 * v19];
          dword_4965DC = LODWORD(v20);
          *(float *)&v82 = *(float *)&effect_uv4[2 * v19] + 0.25;
          v21 = effect_uv4_v[2 * v19] + 0.25;
          dword_4965E0 = v82;
          *(float *)&v84 = v21;
          dword_4965E4 = v84;
          (*(void (__thiscall **)(int, int, float, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
            grim_interface_ptr,
            dword_4965D8,
            COERCE_FLOAT(LODWORD(v20)),
            v82,
            v84);
          v65 = v18[1] * 0.5;
          (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            *((_DWORD *)v18 - 2),
            *((_DWORD *)v18 - 1),
            *(_DWORD *)v18,
            LODWORD(v65));
          v66 = fx_rotated_rotation[v16] - 1.5707964;
          (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v66));
          *(float *)&v78 = *v17 - 0.5;
          v22 = v17[1] - 0.5;
          dword_4965D8 = v78;
          *(float *)&v81 = v22;
          v23 = v69 * fx_rotated_scale[v16];
          dword_4965DC = v81;
          v73 = v23 * 1.064;
          v44 = *(float *)&v81 * v69 - v70;
          v33 = *(float *)&v78 * v69 - v70;
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v33),
            LODWORD(v44),
            LODWORD(v73),
            LODWORD(v73));
          ++v16;
          v18 += 4;
          v17 += 2;
        }
        while ( v16 < fx_queue_rotated );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v43,
        v53,
        v64);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v45,
        v54,
        v67);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v24 = 0;
      if ( fx_queue_rotated > 0 )
      {
        v25 = (float *)fx_rotated_pos_x;
        v26 = &fx_rotated_color_b;
        do
        {
          v27 = creature_type_corpse_frame[17 * fx_rotated_effect_id[v24]];
          v28 = effect_uv4_v[2 * v27];
          dword_4965D8 = effect_uv4[2 * v27];
          dword_4965DC = LODWORD(v28);
          *(float *)&v83 = *(float *)&effect_uv4[2 * v27] + 0.25;
          v29 = effect_uv4_v[2 * v27] + 0.25;
          dword_4965E0 = v83;
          *(float *)&v85 = v29;
          dword_4965E4 = v85;
          (*(void (__thiscall **)(int, int, float, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
            grim_interface_ptr,
            dword_4965D8,
            COERCE_FLOAT(LODWORD(v28)),
            v83,
            v85);
          (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            *(v26 - 2),
            *(v26 - 1),
            *v26,
            v26[1]);
          v68 = fx_rotated_rotation[v24] - 1.5707964;
          (*(void (__stdcall **)(_DWORD))(*(_DWORD *)grim_interface_ptr + 252))(LODWORD(v68));
          v74 = v69 * fx_rotated_scale[v24];
          v46 = v69 * v25[1] - v70;
          v34 = v69 * *v25 - v70;
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v34),
            LODWORD(v46),
            LODWORD(v74),
            LODWORD(v74));
          ++v24;
          v26 += 4;
          v25 += 2;
        }
        while ( v24 < fx_queue_rotated );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    }
    fx_queue_count = 0;
    fx_queue_rotated = 0;
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 48))(grim_interface_ptr, -1);
  }
}

// creature_alloc_slot @ 0x00428140
// finds a free creature entry in DAT_0049bf38 and seeds defaults
int creature_alloc_slot()
{
  int v0; // edi
  char *v1; // eax
  int v3; // eax

  v0 = 0;
  v1 = creature_pool;
  do
  {
    if ( !*v1 )
    {
      creature_flags[38 * v0] = 0;
      creature_phase_seed[38 * v0] = crt_rand() & 0x17F;
      v3 = creature_spawned_count + 1;
      dword_49BFAC[38 * v0] = 0;
      creature_anim_phase[38 * v0] = 0.0;
      creature_spawned_count = v3;
      return v0;
    }
    v1 += 152;
    ++v0;
  }
  while ( (int)v1 < (int)byte_4AA338 );
  if ( *(float *)(cv_verbose + 12) != 0.0 )
    console_printf(&console_log_queue, aNoFreeCreature);
  return 384;
}

// FUN_004281e0 @ 0x004281E0
// [binja] void* sub_4281e0()
void *FUN_004281e0()
{
  void *result; // eax

  result = creature_flags;
  do
  {
    *((char *)result - 140) = 0;
    if ( (*(_BYTE *)result & 4) != 0 )
      creature_spawn_slot_table[6 * *((_DWORD *)result - 5)] = 0;
    result = (char *)result + 152;
  }
  while ( (int)result < (int)&unk_4AA3C4 );
  return result;
}

// creatures_none_active @ 0x00428210
// returns low byte 1 when no active creature entries exist (0 otherwise); sets DAT_0048700c
uint creatures_none_active()
{
  uint result; // eax

  result = (uint)creature_pool;
  while ( !*(_BYTE *)result )
  {
    result += 152;
    if ( (int)result >= (int)byte_4AA338 )
    {
      LOBYTE(result) = 1;
      creatures_any_active_flag = 1;
      return result;
    }
  }
  creatures_any_active_flag = 0;
  LOBYTE(result) = 0;
  return result;
}

// creature_spawn @ 0x00428240
// allocates a creature slot and seeds position, type, and tint defaults
int creature_spawn(float *pos, float *tint_rgba, int type_id)
{
  int v3; // edi
  int v4; // esi
  double v5; // st7
  int v6; // eax
  float *v7; // edx
  int v8; // ecx
  double v10; // st7

  v3 = creature_alloc_slot();
  v4 = 152 * v3;
  *(float *)((char *)&creature_pos_x + v4) = *pos;
  creature_pos_y[v4 / 4u] = pos[1];
  *(int *)((char *)&creature_type_id + v4) = type_id;
  creature_ai_mode[v4 / 4u] = 0;
  creature_collision_flag[v4] = 0;
  creature_collision_timer[v4 / 4u] = 0;
  creature_pool[v4] = 1;
  creature_force_target[v4] = 0;
  creature_state_flag[v4] = 1;
  creature_hitbox_size[v4 / 4u] = 1098907648;
  v5 = (double)survival_elapsed_ms;
  creature_vel_x[v4 / 4u] = 0;
  creature_vel_y[v4 / 4u] = 0;
  *(float *)(v4 + 4833116) = v5 * 0.0001 + 10.0;
  *(float *)(v4 + 4833124) = (double)(crt_rand() % 314) * 0.0099999998;
  *(float *)(v4 + 4833172) = (double)survival_elapsed_ms * 0.000010000001 + 2.5;
  v6 = crt_rand();
  creature_attack_cooldown[v4 / 4u] = 0.0;
  v7 = &creature_tint_r + 38 * v3;
  *(float *)(v4 + 4833180) = (float)(v6 % 30 + 140);
  *v7 = *tint_rgba;
  v7[1] = tint_rgba[1];
  v7[2] = tint_rgba[2];
  v8 = creature_health[38 * v3];
  v7[3] = tint_rgba[3];
  v10 = (double)survival_elapsed_ms;
  *(float *)((char *)&creature_contact_damage + v4) = 4.0;
  LODWORD(creature_max_health[v4 / 4u]) = v8;
  *(float *)(v4 + 4833132) = v10 * 0.000010000001 + 47.0;
  return v3;
}

// player_render_overlays @ 0x00428390
// renders per-player overlays/indicators using DAT_004908** tables
void player_render_overlays()
{
  int v0; // esi
  float v1; // edx
  double v2; // st7
  double v3; // st7
  double v4; // st7
  int v5; // edx
  long double v6; // st7
  int v7; // edi
  float v8; // edx
  int *v9; // esi
  double v10; // st7
  double v11; // st7
  double v12; // st7
  int v13; // eax
  int v14; // edx
  float *v15; // edi
  double v16; // st7
  double v17; // st7
  double v18; // st7
  int v19; // edx
  double v20; // st7
  int v21; // edx
  double v22; // st7
  double v23; // st7
  int v24; // ecx
  float *v25; // ecx
  long double v26; // st7
  int v27; // edx
  long double v28; // st7
  long double v29; // st7
  long double v30; // st6
  long double v31; // st7
  double v32; // st7
  double v33; // st7
  double v34; // st7
  double v35; // st7
  int v36; // edi
  double v37; // st7
  int v38; // edi
  int *v39; // esi
  double v40; // st6
  double v41; // st4
  double v42; // st7
  double v43; // st7
  float v44; // [esp+2C4h] [ebp-4Ch]
  float v45; // [esp+2C4h] [ebp-4Ch]
  int v46; // [esp+2C4h] [ebp-4Ch]
  float v47; // [esp+2C4h] [ebp-4Ch]
  float v48; // [esp+2C4h] [ebp-4Ch]
  float v49; // [esp+2C4h] [ebp-4Ch]
  float v50; // [esp+2C4h] [ebp-4Ch]
  float v51; // [esp+2C4h] [ebp-4Ch]
  int v52; // [esp+2C8h] [ebp-48h]
  int v53; // [esp+2C8h] [ebp-48h]
  float v54; // [esp+2C8h] [ebp-48h]
  int v55; // [esp+2C8h] [ebp-48h]
  float v56; // [esp+2C8h] [ebp-48h]
  int v57; // [esp+2C8h] [ebp-48h]
  int v58; // [esp+2C8h] [ebp-48h]
  int v59; // [esp+2C8h] [ebp-48h]
  float v60; // [esp+2C8h] [ebp-48h]
  float v61; // [esp+2C8h] [ebp-48h]
  int v62; // [esp+2C8h] [ebp-48h]
  int v63; // [esp+2C8h] [ebp-48h]
  int v64; // [esp+2C8h] [ebp-48h]
  int v65; // [esp+2C8h] [ebp-48h]
  float v66; // [esp+2C8h] [ebp-48h]
  float v67; // [esp+2C8h] [ebp-48h]
  int v68; // [esp+2C8h] [ebp-48h]
  int v69; // [esp+2C8h] [ebp-48h]
  int v70; // [esp+2C8h] [ebp-48h]
  float v71; // [esp+2C8h] [ebp-48h]
  int v72; // [esp+2C8h] [ebp-48h]
  int v73; // [esp+2CCh] [ebp-44h]
  int v74; // [esp+2CCh] [ebp-44h]
  int v75; // [esp+2CCh] [ebp-44h]
  int v76; // [esp+2CCh] [ebp-44h]
  int v77; // [esp+2CCh] [ebp-44h]
  int v78; // [esp+2CCh] [ebp-44h]
  int v79; // [esp+2CCh] [ebp-44h]
  int v80; // [esp+2CCh] [ebp-44h]
  int v81; // [esp+2CCh] [ebp-44h]
  int v82; // [esp+2CCh] [ebp-44h]
  int v83; // [esp+2CCh] [ebp-44h]
  int v84; // [esp+2CCh] [ebp-44h]
  int v85; // [esp+2CCh] [ebp-44h]
  float v86; // [esp+2CCh] [ebp-44h]
  int v87; // [esp+2CCh] [ebp-44h]
  int v88; // [esp+2CCh] [ebp-44h]
  int v89; // [esp+2D0h] [ebp-40h]
  float v90; // [esp+2D0h] [ebp-40h]
  int v91; // [esp+2D0h] [ebp-40h]
  int v92; // [esp+2D0h] [ebp-40h]
  float v93; // [esp+2D0h] [ebp-40h]
  int v94; // [esp+2D0h] [ebp-40h]
  int v95; // [esp+2D0h] [ebp-40h]
  float v96; // [esp+2D0h] [ebp-40h]
  float v97; // [esp+2D0h] [ebp-40h]
  int v98; // [esp+2D0h] [ebp-40h]
  int v99; // [esp+2D0h] [ebp-40h]
  int v100; // [esp+2D0h] [ebp-40h]
  int v101; // [esp+2D0h] [ebp-40h]
  float v102; // [esp+2D0h] [ebp-40h]
  float v103; // [esp+2D0h] [ebp-40h]
  float v104; // [esp+2D0h] [ebp-40h]
  float v105; // [esp+2D0h] [ebp-40h]
  int v106; // [esp+2D0h] [ebp-40h]
  int v107; // [esp+2D0h] [ebp-40h]
  int v108; // [esp+2D0h] [ebp-40h]
  float v109; // [esp+2D0h] [ebp-40h]
  float v110; // [esp+2D0h] [ebp-40h]
  int v111; // [esp+2D0h] [ebp-40h]
  int v112; // [esp+2D0h] [ebp-40h]
  int v113; // [esp+2D0h] [ebp-40h]
  float v114; // [esp+2E4h] [ebp-2Ch]
  float v115; // [esp+2E8h] [ebp-28h]
  float v116; // [esp+2E8h] [ebp-28h]
  float v117; // [esp+2ECh] [ebp-24h]
  float v118; // [esp+2ECh] [ebp-24h]
  int v119; // [esp+2ECh] [ebp-24h]
  int v120; // [esp+2ECh] [ebp-24h]
  int v121; // [esp+2ECh] [ebp-24h]
  float v122; // [esp+2ECh] [ebp-24h]
  int v123; // [esp+2F0h] [ebp-20h]
  float v124; // [esp+2F0h] [ebp-20h]
  float v125; // [esp+2F0h] [ebp-20h]
  float v126; // [esp+2F0h] [ebp-20h]
  int v127; // [esp+2F4h] [ebp-1Ch]
  float v128; // [esp+2F4h] [ebp-1Ch]
  float v129; // [esp+2F8h] [ebp-18h]
  int v130; // [esp+2F8h] [ebp-18h]
  float v131; // [esp+2F8h] [ebp-18h]
  float v132; // [esp+2F8h] [ebp-18h]
  float v133; // [esp+2F8h] [ebp-18h]
  float v134; // [esp+2FCh] [ebp-14h]
  float v135; // [esp+2FCh] [ebp-14h]
  float v136; // [esp+2FCh] [ebp-14h]
  int v137; // [esp+2FCh] [ebp-14h]
  float v138; // [esp+2FCh] [ebp-14h]
  float v139; // [esp+2FCh] [ebp-14h]
  float v140; // [esp+2FCh] [ebp-14h]
  float v141; // [esp+2FCh] [ebp-14h]
  int v142; // [esp+300h] [ebp-10h]
  float v143; // [esp+300h] [ebp-10h]
  float v144; // [esp+300h] [ebp-10h]
  float v145; // [esp+300h] [ebp-10h]
  int v146; // [esp+304h] [ebp-Ch]
  float v147; // [esp+304h] [ebp-Ch]
  float v148; // [esp+304h] [ebp-Ch]
  float v149; // [esp+304h] [ebp-Ch]
  float v150; // [esp+308h] [ebp-8h] BYREF
  float v151; // [esp+30Ch] [ebp-4h]

  v114 = ui_transition_alpha;
  if ( !byte_48727C
    && ui_transition_alpha > 0.0
    && game_state_id != 20
    && game_state_id != 22
    && game_state_prev != 20
    && game_state_prev != 22 )
  {
    if ( perk_count_get(perk_id_radioactive) )
    {
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 19, 5);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        2,
        v53,
        v73,
        v89);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        particles_texture,
        0);
      effect_select_texture(16);
      v90 = ((sin(flt_47EA4C) + 1.0) * 0.1875 + 0.25) * v114;
      (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1050253722,
        1058642330,
        1050253722,
        LODWORD(v90));
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v54 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index] - 50.0;
      v44 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - 50.0;
      (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v44),
        LODWORD(v54),
        1120403456,
        1120403456);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    }
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_48287C,
      0);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      1,
      v52,
      v74,
      v91);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v55,
      v75,
      v92);
    if ( *(float *)&player_health[216 * render_overlay_player_index] <= 0.0 )
    {
      if ( player_state_table[216 * render_overlay_player_index] >= 0.0 )
        v0 = (__int64)((1.0 - player_state_table[216 * render_overlay_player_index] * 0.0625) * 20.0 + 32.0);
      else
        v0 = 52;
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v1 = effect_uv8_v[2 * v0];
      dword_4965D8 = effect_uv8[2 * v0];
      dword_4965DC = LODWORD(v1);
      v150 = *(float *)&effect_uv8[2 * v0] + 0.125;
      v2 = effect_uv8_v[2 * v0] + 0.125;
      dword_4965E0 = LODWORD(v150);
      v151 = v2;
      dword_4965E4 = LODWORD(v151);
      (*(void (__thiscall **)(int, int, float, float, float))(*(_DWORD *)grim_interface_ptr + 256))(
        grim_interface_ptr,
        dword_4965D8,
        COERCE_FLOAT(LODWORD(v1)),
        COERCE_FLOAT(LODWORD(v150)),
        COERCE_FLOAT(LODWORD(v151)));
      v93 = v114 * 0.34999999;
      (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v93));
      (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 252))(
        grim_interface_ptr,
        player_aim_heading[216 * render_overlay_player_index]);
      v3 = *(float *)&player_size[216 * render_overlay_player_index] * 0.5;
      v150 = v3;
      v134 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index];
      *(float *)&v142 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v150;
      dword_4965D8 = v142;
      *(float *)&v146 = v134 - v3;
      v4 = *(float *)&player_size[216 * render_overlay_player_index] * 1.03;
      dword_4965DC = v146;
      v117 = v4;
      v56 = *(float *)&v146 + 1.0;
      v45 = *(float *)&v142 + 1.0;
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v45),
        LODWORD(v56),
        LODWORD(v117),
        LODWORD(v117));
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v57,
        v76,
        v94);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v58,
        v77,
        v95);
      if ( config_player_count == 1 )
      {
        v96 = v114;
        v78 = 1065353216;
        v5 = *(_DWORD *)grim_interface_ptr;
        v59 = 1065353216;
      }
      else
      {
        v5 = *(_DWORD *)grim_interface_ptr;
        v96 = v114;
        if ( !render_overlay_player_index )
        {
          v78 = 1065353216;
          v59 = 1050253722;
          v46 = 1050253722;
LABEL_19:
          (*(void (__stdcall **)(int, int, int, float))(v5 + 276))(v46, v59, v78, COERCE_FLOAT(LODWORD(v96)));
          (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
          (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
            grim_interface_ptr,
            dword_4965D8,
            dword_4965DC,
            player_size[216 * render_overlay_player_index],
            player_size[216 * render_overlay_player_index]);
          (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
          return;
        }
        v78 = 1051931443;
        v59 = 1057803469;
      }
      v46 = 1065353216;
      goto LABEL_19;
    }
    v6 = *(float *)&player_aim_heading[216 * render_overlay_player_index] + 1.5707964;
    v7 = (__int64)(*((float *)&player_move_phase + 216 * render_overlay_player_index) + 0.5);
    v143 = cos(v6) * *(float *)&player_muzzle_flash_alpha[216 * render_overlay_player_index] * 12.0;
    v147 = sin(v6) * *(float *)&player_muzzle_flash_alpha[216 * render_overlay_player_index] * 12.0;
    v97 = v114 * 0.34999999;
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v97));
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 252))(
      grim_interface_ptr,
      player_heading[216 * render_overlay_player_index]);
    v8 = effect_uv8_v[2 * v7];
    v9 = (int *)(8 * v7 + 4788240);
    dword_4965D8 = effect_uv8[2 * v7];
    dword_4965DC = LODWORD(v8);
    v150 = *(float *)&effect_uv8[2 * v7] + 0.125;
    v10 = effect_uv8_v[2 * v7] + 0.125;
    dword_4965E0 = LODWORD(v150);
    v151 = v10;
    dword_4965E4 = LODWORD(v151);
    (*(void (__thiscall **)(int, int, float, float, float))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      dword_4965D8,
      COERCE_FLOAT(LODWORD(v8)),
      COERCE_FLOAT(LODWORD(v150)),
      COERCE_FLOAT(LODWORD(v151)));
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v11 = *(float *)&player_size[216 * render_overlay_player_index] * 0.5 - 2.0;
    v150 = v11;
    v135 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index];
    *(float *)&v123 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v150;
    dword_4965D8 = v123;
    *(float *)&v127 = v135 - v11;
    v12 = *(float *)&player_size[216 * render_overlay_player_index] * 1.02;
    dword_4965DC = v127;
    v129 = v12;
    v60 = *(float *)&v127 + 1.0;
    v47 = *(float *)&v123 + 1.0;
    (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
      LODWORD(v47),
      LODWORD(v60),
      LODWORD(v129),
      LODWORD(v129));
    v13 = dword_491090[2 * v7];
    v14 = dword_491094[2 * v7];
    v15 = (float *)(8 * v7 + 4788368);
    dword_4965D8 = v13;
    dword_4965DC = v14;
    v150 = *v15 + 0.125;
    v16 = v15[1] + 0.125;
    dword_4965E0 = LODWORD(v150);
    v151 = v16;
    dword_4965E4 = LODWORD(v151);
    (*(void (__thiscall **)(int, int, int, float, float))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      v13,
      v14,
      COERCE_FLOAT(LODWORD(v150)),
      COERCE_FLOAT(LODWORD(v151)));
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 252))(
      grim_interface_ptr,
      player_aim_heading[216 * render_overlay_player_index]);
    v17 = *(float *)&player_size[216 * render_overlay_player_index] * 0.5;
    v150 = v17;
    v136 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index];
    v150 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v150;
    *(float *)&v130 = v150 + v143;
    dword_4965D8 = v130;
    *(float *)&v137 = v136 - v17 + v147;
    v18 = *(float *)&player_size[216 * render_overlay_player_index] * 1.03;
    dword_4965DC = v137;
    v118 = v18;
    v61 = *(float *)&v137 + 1.0;
    v48 = *(float *)&v130 + 1.0;
    (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
      LODWORD(v48),
      LODWORD(v61),
      LODWORD(v118),
      LODWORD(v118));
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_48287C,
      0);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v62,
      v79,
      v98);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v63,
      v80,
      v99);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v114)));
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 252))(
      grim_interface_ptr,
      player_heading[216 * render_overlay_player_index]);
    v19 = v9[1];
    dword_4965D8 = *v9;
    dword_4965DC = v19;
    v150 = *(float *)v9 + 0.125;
    v151 = *((float *)v9 + 1) + 0.125;
    dword_4965E0 = LODWORD(v150);
    dword_4965E4 = LODWORD(v151);
    (*(void (__thiscall **)(int, int, int, float, float))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      dword_4965D8,
      v19,
      COERCE_FLOAT(LODWORD(v150)),
      COERCE_FLOAT(LODWORD(v151)));
    v20 = *(float *)&player_size[216 * render_overlay_player_index] * 0.5;
    v119 = player_size[216 * render_overlay_player_index];
    v150 = v20;
    v138 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index];
    v150 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v150;
    dword_4965D8 = LODWORD(v150);
    v151 = v138 - v20;
    dword_4965DC = LODWORD(v151);
    (*(void (__thiscall **)(int, float, float, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v150)),
      COERCE_FLOAT(LODWORD(v151)),
      v119,
      v119);
    (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      COERCE_FLOAT(LODWORD(v114)));
    if ( config_player_count > 1 )
    {
      if ( render_overlay_player_index )
        (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1057803469,
          1051931443,
          COERCE_FLOAT(LODWORD(v114)));
      else
        (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1050253722,
          1050253722,
          1065353216,
          COERCE_FLOAT(LODWORD(v114)));
    }
    v21 = *((_DWORD *)v15 + 1);
    dword_4965D8 = *(_DWORD *)v15;
    dword_4965DC = v21;
    v150 = *v15 + 0.125;
    v22 = v15[1] + 0.125;
    dword_4965E0 = LODWORD(v150);
    v151 = v22;
    dword_4965E4 = LODWORD(v151);
    (*(void (__thiscall **)(int, int, int, float, float))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      dword_4965D8,
      v21,
      COERCE_FLOAT(LODWORD(v150)),
      COERCE_FLOAT(LODWORD(v151)));
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 252))(
      grim_interface_ptr,
      player_aim_heading[216 * render_overlay_player_index]);
    v23 = *(float *)&player_size[216 * render_overlay_player_index] * 0.5;
    v120 = player_size[216 * render_overlay_player_index];
    v150 = v23;
    v139 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index];
    v150 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v150;
    v150 = v150 + v143;
    dword_4965D8 = LODWORD(v150);
    v151 = v139 - v23 + v147;
    dword_4965DC = LODWORD(v151);
    (*(void (__thiscall **)(int, float, float, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v150)),
      COERCE_FLOAT(LODWORD(v151)),
      v120,
      v120);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    v24 = render_overlay_player_index;
    if ( *(float *)&player_shield_timer[216 * render_overlay_player_index] > 0.0 )
    {
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v64,
        v81,
        v100);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        2,
        v65,
        v82,
        v101);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        particles_texture,
        0);
      effect_select_texture(2);
      v25 = (float *)&player_shield_timer[216 * render_overlay_player_index];
      v26 = (sin(flt_47EA4C) + 1.0) * 0.25 + *v25;
      if ( *v25 < 1.0 )
        v26 = v26 * *v25;
      if ( v26 > 1.0 )
        v26 = 1.0;
      v131 = v26 * v114;
      v102 = v131 * 0.40000001;
      (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1052161719,
        1060418741,
        1065353216,
        LODWORD(v102));
      v27 = *(_DWORD *)grim_interface_ptr;
      v115 = sin(flt_47EA4C * 3.0) + 17.5;
      v28 = *(float *)&player_aim_heading[216 * render_overlay_player_index] - 1.5707964;
      v150 = cos(v28) * 3.0;
      v151 = sin(v28) * 3.0;
      v103 = flt_47EA4C + flt_47EA4C;
      (*(void (__stdcall **)(_DWORD))(v27 + 252))(LODWORD(v103));
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v124 = v115 + v115;
      v66 = v151 + *(float *)&player_pos_y[216 * render_overlay_player_index] + *(float *)&camera_offset_y - v115;
      v49 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v115 + v150;
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v49),
        LODWORD(v66),
        LODWORD(v124),
        LODWORD(v124));
      v104 = v131 * 0.30000001;
      (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        1052161719,
        1060418741,
        1065353216,
        LODWORD(v104));
      v116 = sin(flt_47EA4C * 3.0) * 4.0 + 24.0;
      v105 = flt_47EA4C * -2.0;
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, LODWORD(v105));
      v125 = v116 + v116;
      v67 = v151 + *(float *)&player_pos_y[216 * render_overlay_player_index] + *(float *)&camera_offset_y - v116;
      v50 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v116 + v150;
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v50),
        LODWORD(v67),
        LODWORD(v125),
        LODWORD(v125));
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v68,
        v83,
        v106);
      v24 = render_overlay_player_index;
    }
    if ( (byte_4D7A94[124 * player_weapon_id[216 * v24]] & 8) == 0 )
    {
      v29 = *(float *)&player_aim_heading[216 * v24] + 1.5707964;
      v30 = cos(v29);
      v144 = v30 * *(float *)&player_muzzle_flash_alpha[216 * v24] * 12.0 - v30 * 21.0;
      v31 = sin(v29);
      v148 = v31 * *(float *)&player_muzzle_flash_alpha[216 * v24] * 12.0 - v31 * 21.0;
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        dword_48F7E0,
        0);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        2,
        v64,
        v84,
        v107);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        2,
        v69,
        v85,
        v108);
      (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
        grim_interface_ptr,
        0,
        0,
        1065353216,
        1065353216);
      v32 = *(float *)&player_muzzle_flash_alpha[216 * render_overlay_player_index] * 0.80000001;
      if ( v32 > 1.0 )
        v32 = 1.0;
      v109 = v32 * v114;
      (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v109));
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 252))(
        grim_interface_ptr,
        player_aim_heading[216 * render_overlay_player_index]);
      v33 = *(float *)&player_size[216 * render_overlay_player_index];
      if ( (byte_4D7A94[124 * player_weapon_id[216 * render_overlay_player_index]] & 4) != 0 )
      {
        v34 = v33 * 0.25;
        v150 = v34;
        v140 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index];
        v150 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v150;
        v150 = v150 + v144;
        dword_4965D8 = LODWORD(v150);
        v151 = v140 - v34 + v148;
        v35 = *(float *)&player_size[216 * render_overlay_player_index] * 0.5;
        dword_4965DC = LODWORD(v151);
        v36 = *(_DWORD *)grim_interface_ptr;
        v132 = v35;
        v110 = v132;
        v86 = v132;
      }
      else
      {
        v37 = v33 * 0.5;
        v121 = player_size[216 * render_overlay_player_index];
        v150 = v37;
        v110 = *(float *)&v121;
        v86 = *(float *)&v121;
        v141 = *(float *)&camera_offset_y + *(float *)&player_pos_y[216 * render_overlay_player_index];
        v150 = *(float *)&camera_offset_x + *(float *)&player_pos_x[216 * render_overlay_player_index] - v150;
        v150 = v150 + v144;
        dword_4965D8 = LODWORD(v150);
        v151 = v141 - v37 + v148;
        dword_4965DC = LODWORD(v151);
        v36 = *(_DWORD *)grim_interface_ptr;
      }
      (*(void (__stdcall **)(float, float, float, float))(v36 + 284))(
        COERCE_FLOAT(LODWORD(v150)),
        COERCE_FLOAT(LODWORD(v151)),
        COERCE_FLOAT(LODWORD(v86)),
        COERCE_FLOAT(LODWORD(v110)));
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    }
    if ( perk_count_get(perk_id) )
    {
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v64,
        v81,
        v111);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        2,
        v70,
        v87,
        v112);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        projectile_texture,
        0);
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, 2);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v38 = 0;
      if ( config_player_count > 0 )
      {
        v39 = player_auto_target;
        do
        {
          if ( *((float *)v39 - 162) > 0.25 )
          {
            v40 = creature_pos_y[38 * *v39] - *((float *)v39 - 194);
            v41 = *(&creature_pos_x + 38 * *v39) - *((float *)v39 - 195);
            if ( sqrt(v40 * v40 + v41 * v41) <= 80.0 )
            {
              v145 = *(&creature_pos_x + 38 * *v39) - *((float *)v39 - 195);
              v42 = creature_pos_y[38 * *v39] - *((float *)v39 - 194);
              v150 = v145;
              v149 = v42;
              v151 = v149;
              v133 = sqrt(v149 * v149 + v145 * v145);
              j_FUN_00452f1d(&v150);
              v126 = *(float *)&camera_offset_x + *((float *)v39 - 195) - 16.0;
              v128 = *(float *)&camera_offset_y + *((float *)v39 - 194) - 16.0;
              (*(void (__stdcall **)(int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
                1056964608,
                1058642330,
                1065353216,
                COERCE_FLOAT(LODWORD(v114)));
              v122 = 0.0;
              if ( v133 > 0.0 )
              {
                do
                {
                  v71 = v151 * v122 + v128;
                  v51 = v150 * v122 + v126;
                  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
                    LODWORD(v51),
                    LODWORD(v71),
                    1107296256,
                    1107296256);
                  v43 = v122 + 8.0;
                  v122 = v43;
                }
                while ( v43 < v133 );
              }
            }
          }
          ++v38;
          v39 += 216;
        }
        while ( v38 < config_player_count );
      }
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    }
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v64,
      v81,
      v111);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v72,
      v88,
      v113);
  }
}

// bonus_label_for_entry @ 0x00429580
// returns the label string for a bonus entry (formatting weapon/score cases)
char *__cdecl sub_429580(int *a1)
{
  int v1; // eax
  const char *v2; // eax

  v1 = *a1;
  if ( *a1 == 3 )
  {
    v2 = (const char *)weapon_table_entry(a1[6]);
    crt_sprintf(byte_49679C, "%s", v2);
    return byte_49679C;
  }
  else if ( v1 == 1 )
  {
    crt_sprintf(byte_49679C, "%s: %d", (const char *)dword_4853E4, a1[6]);
    return byte_49679C;
  }
  else
  {
    return (char *)bonus_meta_table[5 * v1];
  }
}

// bonus_render @ 0x004295F0
// renders bonus icons and labels from the pickup pool
void bonus_render()
{
  int *v0; // esi
  double v1; // st7
  double v3; // st7
  unsigned __int8 v4; // c0
  unsigned __int8 v5; // c3
  double v6; // st6
  int v7; // edi
  double v8; // st7
  double v9; // st7
  double v10; // st7
  long double v11; // st7
  double v12; // st7
  int v13; // ebx
  int *v14; // esi
  double v15; // st7
  double v16; // st7
  long double v17; // st7
  int *v18; // edi
  float *v19; // ebp
  int v20; // esi
  int *v21; // ecx
  double v22; // st6
  double v23; // st4
  char *v24; // edi
  double v25; // st7
  double v26; // st6
  int v27; // edi
  char *v28; // esi
  long double v29; // st7
  float *v30; // esi
  double v31; // st7
  char *v32; // esi
  long double v33; // st7
  long double v34; // st7
  float *v35; // esi
  double v36; // st7
  double v37; // st7
  double v38; // st7
  double v39; // st7
  float *v40; // esi
  double v41; // st7
  float v42; // [esp+2E0h] [ebp-54h]
  int v43; // [esp+2E4h] [ebp-50h]
  int v44; // [esp+2E4h] [ebp-50h]
  float v45; // [esp+2E4h] [ebp-50h]
  float v46; // [esp+2E8h] [ebp-4Ch]
  float v47; // [esp+2E8h] [ebp-4Ch]
  float v48; // [esp+2E8h] [ebp-4Ch]
  float v49; // [esp+2E8h] [ebp-4Ch]
  float v50; // [esp+2E8h] [ebp-4Ch]
  float v51; // [esp+2E8h] [ebp-4Ch]
  int v52; // [esp+2E8h] [ebp-4Ch]
  float v53; // [esp+2E8h] [ebp-4Ch]
  float v54; // [esp+2E8h] [ebp-4Ch]
  int v55; // [esp+2E8h] [ebp-4Ch]
  float v56; // [esp+2E8h] [ebp-4Ch]
  int v57; // [esp+2ECh] [ebp-48h]
  int v58; // [esp+2ECh] [ebp-48h]
  int v59; // [esp+2ECh] [ebp-48h]
  int v60; // [esp+2ECh] [ebp-48h]
  int v61; // [esp+2ECh] [ebp-48h]
  float v62; // [esp+2ECh] [ebp-48h]
  float v63; // [esp+2ECh] [ebp-48h]
  float v64; // [esp+2ECh] [ebp-48h]
  int v65; // [esp+2ECh] [ebp-48h]
  int v66; // [esp+2ECh] [ebp-48h]
  int v67; // [esp+2ECh] [ebp-48h]
  float v68; // [esp+2ECh] [ebp-48h]
  int v69; // [esp+2ECh] [ebp-48h]
  int v70; // [esp+2ECh] [ebp-48h]
  float v71; // [esp+2ECh] [ebp-48h]
  float v72; // [esp+2ECh] [ebp-48h]
  int v73; // [esp+2ECh] [ebp-48h]
  int v74; // [esp+2ECh] [ebp-48h]
  int v75; // [esp+2ECh] [ebp-48h]
  float v76; // [esp+2ECh] [ebp-48h]
  float v77; // [esp+2ECh] [ebp-48h]
  int v78; // [esp+2ECh] [ebp-48h]
  float v79; // [esp+2ECh] [ebp-48h]
  int v80; // [esp+2F0h] [ebp-44h]
  int v81; // [esp+2F0h] [ebp-44h]
  int v82; // [esp+2F0h] [ebp-44h]
  int v83; // [esp+2F0h] [ebp-44h]
  int v84; // [esp+2F0h] [ebp-44h]
  float v85; // [esp+2F0h] [ebp-44h]
  int v86; // [esp+2F0h] [ebp-44h]
  int v87; // [esp+2F0h] [ebp-44h]
  int v88; // [esp+2F0h] [ebp-44h]
  int v89; // [esp+2F0h] [ebp-44h]
  int v90; // [esp+2F0h] [ebp-44h]
  float v91; // [esp+2F0h] [ebp-44h]
  int v92; // [esp+2F0h] [ebp-44h]
  int v93; // [esp+2F0h] [ebp-44h]
  int v94; // [esp+2F4h] [ebp-40h]
  int v95; // [esp+2F4h] [ebp-40h]
  int v96; // [esp+2F4h] [ebp-40h]
  int v97; // [esp+2F4h] [ebp-40h]
  float v98; // [esp+2F4h] [ebp-40h]
  int v99; // [esp+2F4h] [ebp-40h]
  float v100; // [esp+2F4h] [ebp-40h]
  int v101; // [esp+2F4h] [ebp-40h]
  int v102; // [esp+2F4h] [ebp-40h]
  int v103; // [esp+2F4h] [ebp-40h]
  int v104; // [esp+2F4h] [ebp-40h]
  int v105; // [esp+2F4h] [ebp-40h]
  float v106; // [esp+2F4h] [ebp-40h]
  int v107; // [esp+2F4h] [ebp-40h]
  int v108; // [esp+2F4h] [ebp-40h]
  float v109; // [esp+2F4h] [ebp-40h]
  float v110; // [esp+2F4h] [ebp-40h]
  int v111; // [esp+308h] [ebp-2Ch]
  int v112; // [esp+308h] [ebp-2Ch]
  float v113; // [esp+30Ch] [ebp-28h]
  float v114; // [esp+30Ch] [ebp-28h]
  float v115; // [esp+30Ch] [ebp-28h]
  float v116; // [esp+310h] [ebp-24h]
  float v117; // [esp+310h] [ebp-24h]
  float v118; // [esp+310h] [ebp-24h]
  float v119; // [esp+310h] [ebp-24h]
  float v120; // [esp+310h] [ebp-24h]
  float v121; // [esp+310h] [ebp-24h]
  float v122; // [esp+310h] [ebp-24h]
  float v123; // [esp+310h] [ebp-24h]
  float v124; // [esp+310h] [ebp-24h]
  float v125; // [esp+314h] [ebp-20h]
  float v126; // [esp+314h] [ebp-20h]
  float v127; // [esp+314h] [ebp-20h]
  int *v128; // [esp+314h] [ebp-20h]
  float v129; // [esp+318h] [ebp-1Ch]
  float v130; // [esp+318h] [ebp-1Ch]
  float v131; // [esp+318h] [ebp-1Ch]
  float v132; // [esp+31Ch] [ebp-18h] BYREF
  float v133; // [esp+320h] [ebp-14h]
  float v134; // [esp+324h] [ebp-10h]
  float v135; // [esp+328h] [ebp-Ch]
  int v136; // [esp+32Ch] [ebp-8h]
  int v137; // [esp+330h] [ebp-4h]
  int retaddr; // [esp+334h] [ebp+0h]

  v132 = 0.47;
  v133 = 1.0;
  if ( ui_transition_alpha > 0.0
    && game_state_id != 20
    && game_state_id != 22
    && game_state_prev != 20
    && game_state_prev != 22 )
  {
    flt_4AAF5C = frame_dt * 1.3 + flt_4AAF5C;
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      particles_texture,
      0);
    effect_select_texture(16);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v57,
      v80,
      v94);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      2,
      v58,
      v81,
      v95);
    v136 = 1060320051;
    v132 = 0.69999999;
    v137 = 1061997773;
    v135 = 1.0;
    v133 = 0.80000001;
    v134 = 1.0;
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v59,
      v82,
      v96);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v60,
      v83,
      v97);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      bonus_texture,
      0);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    v136 = 1065353216;
    v137 = 1065353216;
    retaddr = 1065353216;
    v132 = 1.0;
    v133 = 1.0;
    v134 = 1.0;
    v135 = 1.0;
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v111 = 0;
    v0 = bonus_time_left;
    do
    {
      if ( *(v0 - 2) )
      {
        v1 = 1.0;
        if ( *(float *)v0 < 2.0 )
        {
          v3 = *(float *)v0;
          if ( v4 | v5 )
            v1 = v3 * 0.5;
          else
            v1 = v3 * 0.25;
        }
        v6 = *((float *)v0 + 1) - *(float *)v0;
        if ( v6 < 0.5 )
        {
          v125 = v6;
          v1 = v125 + v125;
        }
        v135 = v1 * 0.89999998 * v113;
        if ( v132 >= 0.0 )
        {
          if ( v132 > 1.0 )
            v132 = 1.0;
        }
        else
        {
          v132 = 0.0;
        }
        if ( v133 >= 0.0 )
        {
          if ( v133 > 1.0 )
            v133 = 1.0;
        }
        else
        {
          v133 = 0.0;
        }
        if ( v134 >= 0.0 )
        {
          if ( v134 > 1.0 )
            v134 = 1.0;
        }
        else
        {
          v134 = 0.0;
        }
        if ( v135 >= 0.0 )
        {
          if ( v135 > 1.0 )
            v135 = 1.0;
        }
        else
        {
          v135 = 0.0;
        }
        (*(void (__thiscall **)(int, float *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &v132);
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, 0);
        v62 = *(float *)&camera_offset_y + *((float *)v0 + 3) - 16.0;
        v46 = *(float *)&camera_offset_x + *((float *)v0 + 2) - 16.0;
        (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v46),
          LODWORD(v62),
          1107296256,
          1107296256);
        v7 = bonus_meta_icon_id[5 * *(v0 - 2)];
        if ( v7 >= 0 )
        {
          if ( *(float *)v0 >= 0.5 )
          {
            v9 = *((float *)v0 + 1) - *(float *)v0;
            if ( v9 >= 0.5 )
              v8 = 1.0;
            else
              v8 = v9 + v9;
          }
          else
          {
            v8 = *(float *)v0 + *(float *)v0;
          }
          v135 = v113;
          v116 = v8 * v113;
          if ( v132 >= 0.0 )
          {
            if ( v132 > 1.0 )
              v132 = 1.0;
          }
          else
          {
            v132 = 0.0;
          }
          if ( v133 >= 0.0 )
          {
            if ( v133 > 1.0 )
              v133 = 1.0;
          }
          else
          {
            v133 = 0.0;
          }
          if ( v134 >= 0.0 )
          {
            if ( v134 > 1.0 )
              v134 = 1.0;
          }
          else
          {
            v134 = 0.0;
          }
          if ( v113 > 1.0 )
            v135 = 1.0;
          (*(void (__thiscall **)(int, float *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &v132);
          v10 = (double)v111;
          v126 = v10;
          v11 = sin(v10 + flt_4AAF5C);
          crt_ci_pow();
          v117 = (2.0 * 0.25 + 0.75) * v116;
          (*(void (__usercall **)(int@<ecx>, float *, long double@<st0>))(*(_DWORD *)grim_interface_ptr + 272))(
            grim_interface_ptr,
            &v132,
            v11);
          v98 = sin(v126 - (double)survival_elapsed_ms * 0.003) * 0.2;
          (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, LODWORD(v98));
          if ( *(v0 - 2) == 1 && v0[4] == 1000 )
            (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, v7 + 1);
          else
            (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(grim_interface_ptr, 4, v7);
          v129 = v117 * 32.0;
          v12 = v117 * 16.0;
          v63 = *(float *)&camera_offset_y + *((float *)v0 + 3) - v12;
          v47 = *(float *)&camera_offset_x + *((float *)v0 + 2) - v12;
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v47),
            LODWORD(v63),
            LODWORD(v129),
            LODWORD(v129));
        }
      }
      v0 += 7;
      ++v111;
    }
    while ( (int)v0 < (int)&highscore_table );
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    v13 = 0;
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      ui_weapon_icons_texture,
      0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v112 = 0;
    v14 = bonus_time_left;
    do
    {
      if ( *(v14 - 2) == 3 )
      {
        if ( *(float *)v14 >= 0.5 )
        {
          v16 = *((float *)v14 + 1) - *(float *)v14;
          if ( v16 >= 0.5 )
            v15 = 1.0;
          else
            v15 = v16 + v16;
        }
        else
        {
          v15 = *(float *)v14 + *(float *)v14;
        }
        v118 = v15 * v113;
        v135 = v118;
        (*(void (__thiscall **)(int, float *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &v132);
        v17 = sin(flt_4AAF5C);
        crt_ci_pow();
        v119 = (2.0 * 0.25 + 0.75) * v118;
        (*(void (__usercall **)(int@<ecx>, float *, long double@<st0>))(*(_DWORD *)grim_interface_ptr + 272))(
          grim_interface_ptr,
          &v132,
          v17);
        v100 = sin((double)v112 - (double)survival_elapsed_ms * 0.003);
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, LODWORD(v100));
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 264))(
          grim_interface_ptr,
          8,
          2,
          1,
          2 * effect_subrect_frame_table[31 * v14[4]]);
        v127 = v119 * 30.0;
        v85 = v119 * 60.0;
        v64 = *(float *)&camera_offset_y + *((float *)v14 + 3) - v119 * 15.0;
        v48 = *(float *)&camera_offset_x + *((float *)v14 + 2) - v127;
        (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v48),
          LODWORD(v64),
          LODWORD(v85),
          LODWORD(v127));
      }
      v14 += 7;
      ++v112;
    }
    while ( (int)v14 < (int)&highscore_table );
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1056964608,
      v61,
      v84,
      v99);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    if ( config_player_count > 0 )
    {
      v18 = dword_4AAF60;
      v19 = (float *)player_aim_x;
      v128 = dword_4AAF60;
      while ( 1 )
      {
        if ( *(v19 - 11) > 0.0 )
        {
          v20 = 0;
          v21 = bonus_pool;
          while ( 1 )
          {
            if ( *v21 )
            {
              v22 = v19[1] - *((float *)v21 + 5);
              v23 = *v19 - *((float *)v21 + 4);
              if ( sqrt(v22 * v22 + v23 * v23) < 24.0 )
                break;
            }
            v21 += 7;
            ++v20;
            if ( (int)v21 >= (int)&quest_spawn_count )
            {
              *v18 = 0;
              goto LABEL_73;
            }
          }
          if ( game_state_id == 9 )
            *v18 += frame_dt_ms;
          v24 = bonus_label_for_entry((int *)(28 * v20 + 4729160));
          v120 = *(float *)&camera_offset_x + *v19 + 16.0;
          v114 = *(float *)&camera_offset_y + v19[1] - 7.0;
          v25 = (double)(*(int (__stdcall **)(char *))(*(_DWORD *)grim_interface_ptr + 332))(v24);
          v26 = (double)*(int *)config_screen_width;
          if ( v25 + v120 > v26 )
            v120 = v26 - v25;
          (*(void (__thiscall **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
            grim_interface_ptr,
            COERCE_FLOAT(LODWORD(v120)),
            COERCE_FLOAT(LODWORD(v114)),
            v24);
          v18 = v128;
LABEL_73:
          if ( *v18 > 650 && perk_count_get(perk_id_telekinetic) && !bonus_state[28 * v20] )
            break;
        }
        ++v13;
        v19 += 216;
        v128 = ++v18;
        if ( v13 >= config_player_count )
          goto LABEL_84;
      }
      bonus_apply(v13, (float *)&bonus_pool[7 * v20]);
      bonus_state[28 * v20] = 1;
      bonus_time_left[7 * v20] = 1056964608;
      dword_4AAF60[v13] = 0;
    }
LABEL_84:
    if ( config_fx_detail_flag1 )
    {
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v65,
        v86,
        v101);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        2,
        v66,
        v87,
        v102);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        particles_texture,
        0);
      effect_select_texture(13);
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        1032134328);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v27 = 0;
      v28 = particle_style_id;
      do
      {
        if ( *(v28 - 48) && !(v27 % 2) && *v28 != 8 )
        {
          v29 = (sin((1.0 - *((float *)v28 - 3)) * 1.5707964) + 0.1) * 55.0 + 4.0;
          if ( v29 < 16.0 )
            v29 = 16.0;
          v130 = v29 + v29;
          v68 = *(float *)&camera_offset_y + *((float *)v28 - 10) - v29;
          v49 = *(float *)&camera_offset_x + *((float *)v28 - 11) - v29;
          (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v49),
            LODWORD(v68),
            LODWORD(v130),
            LODWORD(v130));
        }
        v28 += 56;
        ++v27;
      }
      while ( (int)v28 < (int)secondary_proj_pos_y );
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v67,
        v88,
        v103);
    }
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v65,
      v86,
      v101);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      2,
      v69,
      v89,
      v104);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      particles_texture,
      0);
    effect_select_texture(12);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v30 = (float *)&particle_spin;
    do
    {
      if ( *((_BYTE *)v30 - 44) && *((_BYTE *)v30 + 4) != 8 )
      {
        (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, *(_DWORD *)v30);
        (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          *((_DWORD *)v30 - 6),
          *((_DWORD *)v30 - 5),
          *((_DWORD *)v30 - 4),
          *((_DWORD *)v30 - 3));
        v31 = sin((1.0 - *(v30 - 2)) * 1.5707964) * 24.0;
        if ( *((_BYTE *)v30 + 4) == 1 )
          v31 = v31 * 0.80000001;
        if ( v31 < 2.0 )
          v31 = 2.0;
        v131 = v31 + v31;
        v71 = *(float *)&camera_offset_y + *(v30 - 9) - v31;
        v50 = *(float *)&camera_offset_x + *(v30 - 10) - v31;
        (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v50),
          LODWORD(v71),
          LODWORD(v131),
          LODWORD(v131));
      }
      v30 += 14;
    }
    while ( (int)v30 < (int)&secondary_proj_pos_x );
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    effect_select_texture(2);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v32 = particle_style_id;
    do
    {
      if ( *(v32 - 48) && *v32 == 8 )
      {
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          *((_DWORD *)v32 - 4));
        v33 = sin(*((float *)v32 - 1)) * 3.0;
        v121 = 15.0 - v33;
        v34 = (v33 + 15.0) * *((float *)v32 - 7) * 7.0;
        v122 = v121 * *((float *)v32 - 7) * 7.0;
        v106 = v34 + v34;
        v91 = v122 + v122;
        v72 = *(float *)&camera_offset_y + *((float *)v32 - 10) - v34;
        v51 = *(float *)&camera_offset_x + *((float *)v32 - 11) - v122;
        (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v51),
          LODWORD(v72),
          LODWORD(v91),
          LODWORD(v106));
      }
      v32 += 56;
    }
    while ( (int)v32 < (int)secondary_proj_pos_y );
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      6,
      v70,
      v90,
      v105);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      19,
      5,
      v73,
      v92,
      v107);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      20,
      2,
      v74,
      v93,
      v108);
    (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
      grim_interface_ptr,
      0,
      0,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v35 = (float *)&secondary_proj_vel_x;
    do
    {
      if ( *((_BYTE *)v35 - 20) && *((_DWORD *)v35 + 2) == 3 )
      {
        v109 = 1.0 - *v35;
        (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          1065353216,
          1058642330,
          1036831949,
          LODWORD(v109));
        v36 = v35[1] * *v35 * 64.0;
        v123 = v36;
        v37 = v36 * 0.5;
        v76 = *(float *)&camera_offset_y + *(v35 - 1) - v37;
        v53 = *(float *)&camera_offset_x + *(v35 - 2) - v37;
        (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v53),
          LODWORD(v76),
          LODWORD(v123),
          LODWORD(v123));
        v110 = (1.0 - *v35) * 0.30000001;
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1058642330,
          1036831949,
          LODWORD(v110));
        v38 = v35[1] * *v35 * 200.0;
        v124 = v38;
        v39 = v38 * 0.5;
        v77 = *(float *)&camera_offset_y + *(v35 - 1) - v39;
        v54 = *(float *)&camera_offset_x + *(v35 - 2) - v39;
        (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v54),
          LODWORD(v77),
          LODWORD(v124),
          LODWORD(v124));
      }
      v35 += 11;
    }
    while ( (int)v35 < (int)&flt_4965EC );
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 20, 6);
    if ( config_fx_detail_flag2 )
    {
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v43,
        v52,
        v75);
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        20,
        6,
        v44,
        v55,
        v78);
      (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
        grim_interface_ptr,
        particles_texture,
        0);
      v79 = flt_49124C + 0.25;
      v56 = flt_491248 + 0.25;
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 256))(
        LODWORD(flt_491248),
        LODWORD(flt_49124C),
        LODWORD(v56),
        LODWORD(v79));
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v40 = (float *)sprite_effect_scale;
      do
      {
        if ( *((_BYTE *)v40 - 40) )
        {
          v115 = *v40;
          (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(
            grim_interface_ptr,
            *((_DWORD *)v40 - 5));
          (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            *((_DWORD *)v40 - 9),
            *((_DWORD *)v40 - 8),
            *((_DWORD *)v40 - 7),
            *((_DWORD *)v40 - 6));
          v41 = v115 * 0.5;
          v45 = *(float *)&camera_offset_y + *(v40 - 3) - v41;
          v42 = *(float *)&camera_offset_x + *(v40 - 4) - v41;
          (*(void (__stdcall **)(_DWORD, _DWORD, float, float))(*(_DWORD *)grim_interface_ptr + 284))(
            LODWORD(v42),
            LODWORD(v45),
            COERCE_FLOAT(LODWORD(v115)),
            COERCE_FLOAT(LODWORD(v115)));
        }
        v40 += 11;
      }
      while ( (int)v40 < (int)flt_49AA48 );
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    }
    effects_render();
  }
}

// audio_resume_all @ 0x0042A5F0
// resume active audio channels
int audio_resume_all()
{
  char v0; // fps^1
  double v1; // st7
  bool v2; // c0
  char v3; // c2
  bool v4; // c3
  int result; // eax

  audio_resume_channels();
  HIWORD(result) = HIWORD(cv_verbose);
  v1 = *(float *)(cv_verbose + 12);
  v2 = v1 < 0.0;
  v3 = 0;
  v4 = v1 == 0.0;
  BYTE1(result) = v0;
  if ( v1 != 0.0 )
    console_printf(&console_log_queue, aRestored);
  audio_suspend_flag = 0;
  LOBYTE(result) = 1;
  return result;
}

// audio_suspend_all @ 0x0042A630
// suspend active audio channels
void audio_suspend_all()
{
  audio_suspend_channels();
  if ( *(float *)(cv_verbose + 12) != 0.0 )
    console_printf(&console_log_queue, aSuspended);
  audio_suspend_flag = 1;
}

// texture_get_or_load @ 0x0042A670
// lookup texture handle; load if missing (name + path)
int texture_get_or_load(char *name, char *path)
{
  int result; // eax

  result = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, name);
  if ( result == -1 )
  {
    if ( (*(unsigned __int8 (__thiscall **)(int, char *, char *))(*(_DWORD *)grim_interface_ptr + 180))(
           grim_interface_ptr,
           name,
           path) )
    {
      if ( *(float *)(cv_silentloads + 12) == 0.0 )
        console_printf(&console_log_queue, "...loading texture '%s' ok\n", path);
      return (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, name);
    }
    else
    {
      console_printf(&console_log_queue, "...loading texture '%s' failed\n", path);
      return -1;
    }
  }
  return result;
}

// texture_get_or_load_alt @ 0x0042A700
// duplicate of texture_get_or_load (callers are mostly .jaz assets)
int texture_get_or_load_alt(char *name, char *path)
{
  int result; // eax

  result = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, name);
  if ( result == -1 )
  {
    if ( (*(unsigned __int8 (__thiscall **)(int, char *, char *))(*(_DWORD *)grim_interface_ptr + 180))(
           grim_interface_ptr,
           name,
           name) )
    {
      if ( *(float *)(cv_silentloads + 12) == 0.0 )
        console_printf(&console_log_queue, "...loading texture '%s' ok\n", name);
      return (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, name);
    }
    else
    {
      console_printf(&console_log_queue, "...loading texture '%s' failed\n", name);
      return -1;
    }
  }
  return result;
}

// console_cmd_load_texture @ 0x0042A780
// console command handler for loadtexture; calls texture_get_or_load(name, path)
void console_cmd_load_texture()
{
  char *v0; // eax
  char *v1; // [esp-4h] [ebp-4h]

  if ( console_cmd_argc_get() == 2 )
  {
    v1 = console_cmd_arg_get(2);
    v0 = console_cmd_arg_get(2);
    texture_get_or_load(v0, v1);
  }
  else
  {
    console_printf(&console_log_queue, aLoadtextureTex);
  }
}

// console_cmd_set_resource_paq @ 0x0042A7C0
// console command handler for setresourcepaq; validates file and updates Grim config id 0x10
void console_cmd_set_resource_paq()
{
  char *v0; // eax
  FILE *v1; // eax
  char *v2; // eax
  char *v3; // eax
  char *v4; // eax

  if ( console_cmd_argc_get() == 2 )
  {
    v0 = console_cmd_arg_get(1);
    v1 = crt_fopen(v0, file_mode_read_binary);
    if ( v1 )
    {
      crt_fclose(v1);
      v3 = console_cmd_arg_get(1);
      (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 16);
      v4 = console_cmd_arg_get(1);
      console_printf(&console_log_queue, "Set resource paq to '%s'\n", v4);
    }
    else
    {
      v2 = console_cmd_arg_get(1);
      console_printf(&console_log_queue, "File '%s' not found.\n", v2);
    }
  }
  else
  {
    console_printf(&console_log_queue, aSetresourcepaq_0);
  }
}

// console_cmd_tell_time_survived @ 0x0042A860
// console command handler for telltimesurvived; prints survived time in seconds
void console_cmd_tell_time_survived()
{
  console_printf(
    &console_log_queue,
    "Survived: %i seconds.\n",
    (unsigned int)(__int64)((double)survival_elapsed_ms * 0.001));
}

// console_cmd_open_url @ 0x0042A890
// console command handler for openurl; converts to wide and calls HlinkNavigateString
void console_cmd_open_url()
{
  char *v0; // eax
  char *v1; // eax
  WCHAR WideCharStr[260]; // [esp+0h] [ebp-208h] BYREF

  if ( console_cmd_argc_get() == 2 )
  {
    v0 = console_cmd_arg_get(1);
    MultiByteToWideChar(0, 0, v0, -1, WideCharStr, 260);
    if ( HlinkNavigateString(0, WideCharStr) >= 0 )
    {
      v1 = console_cmd_arg_get(1);
      console_printf(&console_log_queue, "Launching web browser (%s)..\n", v1);
    }
    else
    {
      console_printf(&console_log_queue, aFailedToLaunch_0);
    }
  }
  else
  {
    console_printf(&console_log_queue, aOpenurlUrl);
  }
}

// console_cmd_snd_freq_adjustment @ 0x0042A930
// console command handler for sndfreqadjustment; toggles DAT_004807a8 and prints status
void console_cmd_snd_freq_adjustment()
{
  bool v0; // zf

  v0 = byte_4807A8 != 0;
  byte_4807A8 = byte_4807A8 == 0;
  if ( v0 )
    console_printf(&console_log_queue, aSoundFrequency_0);
  else
    console_printf(&console_log_queue, aSoundFrequency);
}

// reg_read_dword_default @ 0x0042A980
// reads a registry DWORD or writes fallback to output
int reg_read_dword_default(HKEY key, char *name, unsigned int *out, unsigned int fallback)
{
  unsigned int *v4; // esi
  DWORD cbData; // [esp+4h] [ebp-4h] BYREF

  v4 = out;
  cbData = 4;
  if ( RegQueryValueExA(key, name, 0, (LPDWORD)&out, (LPBYTE)out, &cbData) )
    *v4 = fallback;
  return 0;
}

// reg_write_dword @ 0x0042A9C0
// writes a registry DWORD
int reg_write_dword(HKEY key, char *name, unsigned int value)
{
  return RegSetValueExA(key, name, 0, 4u, (const BYTE *)&value, 4u) != 0 ? 0x80004005 : 0;
}

// init_audio_and_terrain @ 0x0042A9F0
// sound init + terrain texture setup
void init_audio_and_terrain()
{
  char *v0; // ecx
  char *ArgList; // [esp+18h] [ebp-4h]

  ArgList = v0;
  console_printf(&console_log_queue, aInitGrimSucces);
  console_printf(&console_log_queue, asc_4711C0);
  console_printf(&console_log_queue, asc_4740FC);
  console_printf(&console_log_queue, aSoundInit);
  console_printf(&console_log_queue, asc_4740FC);
  if ( byte_4AAEEA )
    console_printf(&console_log_queue, aNoSoundsSelect);
  else
    byte_4AAEEA = (unsigned __int8)sfx_system_init() == 0;
  console_printf(&console_log_queue, asc_4711C0);
  terrain_texture_width = 1024;
  terrain_texture_height = 1024;
  if ( *(float *)config_texture_scale >= 0.5 )
  {
    if ( *(float *)config_texture_scale > 4.0 )
      *(_DWORD *)config_texture_scale = 1082130432;
  }
  else
  {
    *(_DWORD *)config_texture_scale = 1056964608;
  }
  if ( terrain_texture_failed )
    goto LABEL_14;
  if ( !(*(unsigned __int8 (__thiscall **)(int, char *, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 172))(
          grim_interface_ptr,
          aGround,
          (__int64)(1024.0 / *(float *)config_texture_scale),
          (__int64)(1024.0 / *(float *)config_texture_scale)) )
  {
    ArgList = *(char **)config_texture_scale;
    *(float *)config_texture_scale = *(float *)config_texture_scale + *(float *)config_texture_scale;
    if ( (*(unsigned __int8 (__fastcall **)(int, _DWORD, char *, _DWORD, _DWORD))(*(_DWORD *)grim_interface_ptr + 172))(
           grim_interface_ptr,
           (unsigned __int64)(__int64)((double)terrain_texture_width / *(float *)config_texture_scale) >> 32,
           aGround,
           (__int64)((double)terrain_texture_width / *(float *)config_texture_scale),
           (__int64)((double)terrain_texture_height / *(float *)config_texture_scale)) )
    {
      console_printf(&console_log_queue, aCreatedTerrain);
    }
    else
    {
      *(_DWORD *)config_texture_scale = ArgList;
      terrain_texture_failed = 1;
      console_printf(&console_log_queue, aFailedToCreate);
      console_printf(&console_log_queue, aEnteringSafemo);
    }
  }
  if ( terrain_texture_failed )
LABEL_14:
    console_printf(&console_log_queue, aRunningInSafem);
  console_flush_log(console_log_filename, ArgList);
}

// game_startup_init_prelude @ 0x0042B090
// prelude called by game_startup_init; handles core init, dates, registry time, and terrain reset
void game_startup_init_prelude()
{
  int v0; // [esp+40h] [ebp-20h]
  int v1; // [esp+44h] [ebp-1Ch]
  int v2; // [esp+44h] [ebp-1Ch]
  int v3; // [esp+44h] [ebp-1Ch]
  int v4; // [esp+48h] [ebp-18h]
  int v5; // [esp+48h] [ebp-18h]
  int v6; // [esp+48h] [ebp-18h]
  int v7; // [esp+4Ch] [ebp-14h]
  int v8; // [esp+4Ch] [ebp-14h]
  HKEY phkResult; // [esp+50h] [ebp-10h] BYREF
  DWORD Type; // [esp+54h] [ebp-Ch] BYREF
  LARGE_INTEGER PerformanceCount; // [esp+58h] [ebp-8h] BYREF

  dword_4AAEE4 = strdup_malloc(szPassword);
  (*(void (__thiscall **)(int, int, char))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 18, 1);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    v1,
    v4,
    v7);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    v2,
    v5,
    v8);
  effect_uv_tables_init();
  console_flush_log(console_log_filename, (char *)phkResult);
  console_printf(&console_log_queue, aEnteringCrimso);
  perks_init_database();
  weapon_table_init();
  game_core_init();
  GetLocalTime(&local_system_time);
  if ( local_system_time.wMonth == 9 )
  {
    if ( local_system_time.wDay != 12 )
      goto LABEL_10;
    goto LABEL_9;
  }
  if ( local_system_time.wMonth != 11 )
  {
    if ( local_system_time.wMonth != 12 || local_system_time.wDay != 18 )
      goto LABEL_10;
    goto LABEL_9;
  }
  if ( local_system_time.wDay == 8 )
  {
LABEL_9:
    byte_4AAED8 = 1;
    texture_get_or_load(aBalloon, aBalloonTga);
  }
LABEL_10:
  byte_4AAED8 = 0;
  console_printf(&console_log_queue, aUnloadedResour);
  (*(void (__thiscall **)(int, int, int, int, int, CHAR *))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    16,
    v0,
    v3,
    v6,
    szPassword);
  PerformanceCount.QuadPart = local_system_time.wMilliseconds;
  QueryPerformanceCounter(&PerformanceCount);
  crt_srand(PerformanceCount.LowPart);
  gameplay_reset_state();
  byte_4AAED9 = 1;
  terrain_generate_random();
  byte_4AAED9 = 0;
  if ( !RegCreateKeyExA(HKEY_CURRENT_USER, aSoftware10tons, 0, 0, 0, 0xF003Fu, 0, &phkResult, 0) )
  {
    reg_read_dword_default(phkResult, aTimeplayed, &Type, 0);
    *(_DWORD *)&dword_48718C = Type;
    RegCloseKey(phkResult);
  }
}

// sub_42B250 @ 0x0042B250
void __cdecl __noreturn sub_42B250()
{
  console_printf(&console_log_queue, aBeginthreadSou);
  audio_init_music();
  audio_init_sfx();
  byte_4AAF85 = 1;
  byte_4AAF8C = 1;
  console_printf(&console_log_queue, aEndthreadSound);
  crt_endthread();
}

// game_startup_init @ 0x0042B290
// startup init: logs, builds perks/weapons, seeds UI/effects, loads registry time; triggers intro music then switches to crimson_theme
void game_startup_init()
{
  double v0; // st7
  char v1; // cl
  __int64 v2; // rax
  int v3; // esi
  double v4; // st7
  int v5; // esi
  int v6; // eax
  int v7; // esi
  int v8; // eax
  int v9; // esi
  int v10; // eax
  unsigned __int8 v12; // c0
  unsigned __int8 v13; // c3
  int v14; // edi
  double v15; // st7
  double v16; // st7
  unsigned __int8 v18; // c0
  unsigned __int8 v19; // c3
  double v20; // st7
  __int64 v21; // rax
  int v22; // esi
  double v23; // st7
  double v24; // st7
  int v25; // esi
  int v26; // eax
  int v27; // esi
  int v28; // eax
  double v29; // st7
  int v30; // esi
  int v31; // eax
  int v32; // esi
  int v33; // eax
  int v34; // esi
  int v35; // eax
  __int64 v36; // rax
  int v37; // esi
  double v38; // st7
  float v39; // [esp+ECh] [ebp-2Ch]
  float v40; // [esp+ECh] [ebp-2Ch]
  int v41; // [esp+F0h] [ebp-28h]
  float v42; // [esp+F0h] [ebp-28h]
  float v43; // [esp+F0h] [ebp-28h]
  float v44; // [esp+F0h] [ebp-28h]
  float v45; // [esp+F0h] [ebp-28h]
  float v46; // [esp+F0h] [ebp-28h]
  float v47; // [esp+F0h] [ebp-28h]
  float v48; // [esp+F0h] [ebp-28h]
  float v49; // [esp+F0h] [ebp-28h]
  int v50; // [esp+F4h] [ebp-24h]
  float v51; // [esp+F4h] [ebp-24h]
  int v52; // [esp+F4h] [ebp-24h]
  int v53; // [esp+F4h] [ebp-24h]
  float v54; // [esp+F4h] [ebp-24h]
  int v55; // [esp+F4h] [ebp-24h]
  float v56; // [esp+F4h] [ebp-24h]
  float v57; // [esp+F4h] [ebp-24h]
  float v58; // [esp+F4h] [ebp-24h]
  int v59; // [esp+F4h] [ebp-24h]
  float v60; // [esp+F4h] [ebp-24h]
  int v61; // [esp+F8h] [ebp-20h]
  char *v62; // [esp+F8h] [ebp-20h]
  int v63; // [esp+F8h] [ebp-20h]
  int v64; // [esp+F8h] [ebp-20h]
  char *v65; // [esp+F8h] [ebp-20h]
  int v66; // [esp+F8h] [ebp-20h]
  int v67; // [esp+F8h] [ebp-20h]
  float v68; // [esp+F8h] [ebp-20h]
  char *v69; // [esp+F8h] [ebp-20h]
  int v70; // [esp+FCh] [ebp-1Ch]
  int v71; // [esp+FCh] [ebp-1Ch]
  int v72; // [esp+FCh] [ebp-1Ch]
  float v73; // [esp+FCh] [ebp-1Ch]
  float v74; // [esp+FCh] [ebp-1Ch]
  float v75; // [esp+FCh] [ebp-1Ch]
  int v76; // [esp+FCh] [ebp-1Ch]
  int v77; // [esp+FCh] [ebp-1Ch]
  int v78; // [esp+FCh] [ebp-1Ch]
  float v79; // [esp+FCh] [ebp-1Ch]
  int v80; // [esp+FCh] [ebp-1Ch]
  float console_state; // [esp+100h] [ebp-18h]
  void *console_statea; // [esp+100h] [ebp-18h]
  void *console_stateb; // [esp+100h] [ebp-18h]
  void *console_statec; // [esp+100h] [ebp-18h]
  int v85; // [esp+104h] [ebp-14h]
  int v86; // [esp+108h] [ebp-10h]
  float v87; // [esp+10Ch] [ebp-Ch]
  float v88[2]; // [esp+110h] [ebp-8h] BYREF

  v0 = ((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 60))(grim_interface_ptr);
  frame_dt = v0;
  if ( v0 > 0.1 )
    frame_dt = 0.1;
  if ( byte_473A60 )
    byte_473A60 = 0;
  v1 = byte_4AAF9C;
  if ( !byte_4AAF9C )
  {
    load_textures_step();
    v1 = byte_4AAF9C;
  }
  if ( byte_473A60 || !byte_4AAF86 )
  {
    if ( !v1 )
      goto LABEL_94;
  }
  else
  {
    texture_get_or_load(aSplashreflexiv, aLoadSplashrefl);
    texture_get_or_load(aSplash10tons, aLoadSplash10to);
    game_startup_init_prelude();
    crt_beginthread(sub_42B250, 0, 0);
    byte_4AAF86 = 0;
    byte_4AAF9C = 1;
    if ( flt_4AAF90 > 0.5 )
      flt_4AAF90 = 0.5;
  }
  if ( byte_4AAF8C && byte_4AAF9D )
  {
    if ( dword_4AAF98 < 5 )
    {
      ++dword_4AAF98;
      Sleep(5u);
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 44))(
        grim_interface_ptr,
        0,
        0,
        0,
        1065353216);
      audio_update();
      console_update(SLODWORD(console_state));
      FUN_00401dd0(console_statea);
      if ( *(float *)(cv_showFPS + 12) != 0.0 )
      {
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1058642330);
        v2 = (__int64)((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 64))(grim_interface_ptr);
        v3 = *(_DWORD *)grim_interface_ptr;
        if ( (int)v2 < 400 )
        {
          v70 = (__int64)((double (*)(void))*(_DWORD *)(v3 + 64))();
          v62 = aD_0;
          LODWORD(v88[0]) = *(_DWORD *)config_screen_width - 45;
          v51 = (float)(config_screen_height - 24);
          v4 = (double)(*(_DWORD *)config_screen_width - 45);
        }
        else
        {
          v70 = (__int64)((double (*)(void))*(_DWORD *)(v3 + 64))();
          v62 = a400;
          LODWORD(v88[0]) = *(_DWORD *)config_screen_width - 51;
          v51 = (float)(config_screen_height - 24);
          v4 = (double)(*(_DWORD *)config_screen_width - 51);
        }
        v42 = v4;
        (*(void (__cdecl **)(int, _DWORD, float, char *, int))(v3 + 328))(
          grim_interface_ptr,
          LODWORD(v42),
          COERCE_FLOAT(LODWORD(v51)),
          v62,
          v70);
      }
      if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 16) )
        (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 56);
      return;
    }
    if ( flt_4AAF90 > 14.0 )
    {
      (*(void (__thiscall **)(int, int, int, int, int, void (*)()))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        45,
        v41,
        v50,
        v61,
        console_hotkey_update);
      v5 = *(_DWORD *)grim_interface_ptr;
      v6 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
             grim_interface_ptr,
             aSplashreflexiv);
      (*(void (__thiscall **)(int, int))(v5 + 188))(grim_interface_ptr, v6);
      v7 = *(_DWORD *)grim_interface_ptr;
      v8 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, aSplash10tons);
      (*(void (__thiscall **)(int, int))(v7 + 188))(grim_interface_ptr, v8);
      sfx_mute_all(music_track_intro_id);
      if ( (unsigned __int8)game_is_full_version() )
      {
        sfx_play_exclusive(music_track_crimson_theme_id);
      }
      else
      {
        sfx_play_exclusive(music_track_crimsonquest_id);
        demo_mode_start();
      }
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 44))(
        grim_interface_ptr,
        0,
        0,
        0,
        1065353216);
      return;
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 1)
      || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 57)
      || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 28)
      || (unsigned __int8)input_primary_just_pressed()
      || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 92))(grim_interface_ptr, 1) )
    {
      byte_4AAF94 = 1;
    }
    else if ( !byte_4AAED9 )
    {
      if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 41) )
        console_set_open(console_open_flag == 0);
      dword_47EA48 = LODWORD(frame_dt);
      flt_47EA4C = flt_47EA4C + frame_dt;
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 44))(
        grim_interface_ptr,
        0,
        0,
        0,
        1065353216);
      if ( !byte_4AAF85 )
      {
LABEL_81:
        console_update(SLODWORD(console_state));
        FUN_00401dd0(console_stateb);
        if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 16)
          && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 56)
          || byte_47EA50 )
        {
          return;
        }
        goto LABEL_86;
      }
      if ( !(unsigned __int8)sfx_is_unmuted(music_track_intro_id) )
        sfx_play_exclusive(music_track_intro_id);
      flt_4AAF90 = frame_dt * 1.1 + flt_4AAF90;
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        21,
        1,
        v52,
        v63,
        v71);
      flt_4AAF90 = flt_4AAF90 - 2.0;
      if ( byte_4AAF94 )
      {
        if ( flt_4AAF90 >= 1.0 && (flt_4AAF90 < 5.0 || flt_4AAF90 >= 7.0 && flt_4AAF90 < 11.0) )
          flt_4AAF90 = frame_dt * 4.0 + flt_4AAF90;
        else
          flt_4AAF90 = 16.0;
      }
      v9 = 64;
      (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
        grim_interface_ptr,
        0,
        0,
        1065353216,
        1065353216);
      (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
      if ( flt_4AAF90 <= 1.0 || flt_4AAF90 >= 5.0 )
      {
        if ( flt_4AAF90 <= 6.0 )
          goto LABEL_53;
        v10 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                grim_interface_ptr,
                aSplashreflexiv);
        v9 = 256;
      }
      else
      {
        v9 = 128;
        v10 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                grim_interface_ptr,
                aSplash10tons);
      }
      if ( v10 >= 0 )
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, v10, 0);
LABEL_53:
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      if ( v12 | v13 )
      {
        if ( flt_4AAF90 < 2.0 )
        {
          if ( flt_4AAF90 < 4.0 )
            goto LABEL_66;
          goto LABEL_60;
        }
      }
      else if ( flt_4AAF90 < 2.0 )
      {
        v73 = flt_4AAF90 - 1.0;
        (*(void (__stdcall **)(int, int, int, _DWORD, float, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v73),
          COERCE_FLOAT(LODWORD(console_state)),
          v85,
          v86);
        v14 = *(_DWORD *)grim_interface_ptr;
        console_state = (float)(config_screen_height / 2 - v9 / 2);
        v15 = (double)(*(_DWORD *)config_screen_width / 2 - 256);
LABEL_79:
        v75 = v15;
        (*(void (__stdcall **)(_DWORD))(v14 + 284))(LODWORD(v75));
        goto LABEL_80;
      }
      if ( flt_4AAF90 < 4.0 )
      {
LABEL_58:
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1065353216);
        v14 = *(_DWORD *)grim_interface_ptr;
        console_state = (float)(config_screen_height / 2 - v9 / 2);
        v15 = (double)(*(_DWORD *)config_screen_width / 2 - 256);
        goto LABEL_79;
      }
LABEL_60:
      if ( flt_4AAF90 < 5.0 )
      {
        v16 = 1.0 - (flt_4AAF90 - 4.0);
        v88[0] = v16;
        if ( v16 >= 0.0 )
        {
          if ( v88[0] > 1.0 )
            v88[0] = 1.0;
        }
        else
        {
          v88[0] = 0.0;
        }
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v88[0]));
        v14 = *(_DWORD *)grim_interface_ptr;
        console_state = (float)(config_screen_height / 2 - v9 / 2);
        v15 = (double)(*(_DWORD *)config_screen_width / 2 - 256);
        goto LABEL_79;
      }
LABEL_66:
      if ( v18 | v19 )
      {
        if ( flt_4AAF90 < 8.0 )
        {
          if ( flt_4AAF90 < 10.0 )
            goto LABEL_80;
          goto LABEL_73;
        }
      }
      else if ( flt_4AAF90 < 8.0 )
      {
        v74 = flt_4AAF90 - 6.0 - 1.0;
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v74));
        v14 = *(_DWORD *)grim_interface_ptr;
        console_state = (float)(config_screen_height / 2 - v9 / 2);
        v15 = (double)(*(_DWORD *)config_screen_width / 2 - 256);
        goto LABEL_79;
      }
      if ( flt_4AAF90 < 10.0 )
        goto LABEL_58;
LABEL_73:
      if ( flt_4AAF90 < 11.0 )
      {
        v20 = 1.0 - (flt_4AAF90 - 6.0 - 4.0);
        v88[0] = v20;
        if ( v20 >= 0.0 )
        {
          if ( v88[0] > 1.0 )
            v88[0] = 1.0;
        }
        else
        {
          v88[0] = 0.0;
        }
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v88[0]));
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v88[0]));
        v14 = *(_DWORD *)grim_interface_ptr;
        console_state = (float)(config_screen_height / 2 - v9 / 2);
        v15 = (double)(*(_DWORD *)config_screen_width / 2 - 256);
        goto LABEL_79;
      }
LABEL_80:
      flt_4AAF90 = flt_4AAF90 + 2.0;
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        21,
        2,
        v53,
        v64,
        v72);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      audio_update();
      goto LABEL_81;
    }
LABEL_86:
    if ( *(float *)(cv_showFPS + 12) != 0.0 )
    {
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        1058642330);
      v21 = (__int64)((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 64))(grim_interface_ptr);
      v22 = *(_DWORD *)grim_interface_ptr;
      if ( (int)v21 < 400 )
      {
        v76 = (__int64)((double (*)(void))*(_DWORD *)(v22 + 64))();
        v65 = aD_0;
        LODWORD(v88[0]) = *(_DWORD *)config_screen_width - 45;
        v54 = (float)(config_screen_height - 24);
        v23 = (double)(*(_DWORD *)config_screen_width - 45);
      }
      else
      {
        v76 = (__int64)((double (*)(void))*(_DWORD *)(v22 + 64))();
        v65 = a400;
        LODWORD(v88[0]) = *(_DWORD *)config_screen_width - 51;
        v54 = (float)(config_screen_height - 24);
        v23 = (double)(*(_DWORD *)config_screen_width - 51);
      }
      v43 = v23;
      (*(void (__cdecl **)(int, _DWORD, float, char *, int))(v22 + 328))(
        grim_interface_ptr,
        LODWORD(v43),
        COERCE_FLOAT(LODWORD(v54)),
        v65,
        v76);
    }
    return;
  }
  if ( byte_4AAF8C )
  {
    v24 = flt_4AAF90 - frame_dt;
    flt_4AAF90 = v24;
    if ( v24 < 0.0 )
    {
      flt_4AAF90 = 0.0;
      byte_4AAF9D = 1;
      v25 = *(_DWORD *)grim_interface_ptr;
      v26 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, aLoading);
      (*(void (__thiscall **)(int, int))(v25 + 188))(grim_interface_ptr, v26);
      v27 = *(_DWORD *)grim_interface_ptr;
      v28 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, aLogoEsrb);
      (*(void (__thiscall **)(int, int))(v27 + 188))(grim_interface_ptr, v28);
    }
    goto LABEL_95;
  }
LABEL_94:
  flt_4AAF90 = flt_4AAF90 + frame_dt;
LABEL_95:
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 44))(
    grim_interface_ptr,
    0,
    0,
    0,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v55,
    v66,
    v77);
  v29 = flt_4AAF90 + flt_4AAF90;
  v87 = v29;
  if ( v29 <= 1.0 )
  {
    if ( v87 < 0.0 )
      v87 = 0.0;
  }
  else
  {
    v87 = 1.0;
  }
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v87)));
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  v30 = *(_DWORD *)grim_interface_ptr;
  v31 = (*(int (__thiscall **)(int, char *, _DWORD))(*(_DWORD *)grim_interface_ptr + 192))(
          grim_interface_ptr,
          aLogoEsrb,
          0);
  (*(void (__thiscall **)(int, int))(v30 + 196))(grim_interface_ptr, v31);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v56 = flt_471144 - 128.0 - 1.0;
  v44 = screen_width_f - 256.0 - 1.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v44),
    LODWORD(v56),
    1132462080,
    1124073472);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  v32 = *(_DWORD *)grim_interface_ptr;
  v33 = (*(int (__thiscall **)(int, char *, _DWORD))(*(_DWORD *)grim_interface_ptr + 192))(
          grim_interface_ptr,
          aLoading,
          0);
  (*(void (__thiscall **)(int, int))(v32 + 196))(grim_interface_ptr, v33);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v57 = flt_471144 * 0.5 + 16.0;
  v45 = screen_width_f * 0.5 + 128.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v45),
    LODWORD(v57),
    1124073472,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v34 = *(_DWORD *)grim_interface_ptr;
  v35 = (*(int (__thiscall **)(int, char *, _DWORD))(*(_DWORD *)grim_interface_ptr + 192))(
          grim_interface_ptr,
          aClLogo,
          0);
  (*(void (__thiscall **)(int, int))(v34 + 196))(grim_interface_ptr, v35);
  v58 = flt_471144 * 0.5 - 32.0;
  v46 = screen_width_f * 0.5 - 256.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v46),
    LODWORD(v58),
    1140850688,
    1115684864);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v87)));
  if ( *(float *)(cv_silentloads + 12) == 0.0 )
  {
    v79 = v87 * 0.69999999;
    (*(void (__stdcall **)(int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v79));
    v47 = flt_471144 * 0.5 + 32.0;
    v39 = screen_width_f * 0.5 - 246.0;
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v39),
      LODWORD(v47),
      aGrimGfxDD,
      dword_4AAF88,
      dword_473A5C - 1);
    v48 = flt_471144 * 0.5 + 45.0;
    v40 = screen_width_f * 0.5 - 246.0;
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v40),
      LODWORD(v48),
      aGrimSfxDD,
      dword_4CC8D8,
      81);
  }
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v59,
    v67,
    v78);
  flt_496604 = v87 * 0.69999999;
  (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4965F8);
  v88[0] = -4.0;
  v88[1] = flt_471144 * 0.5 - 68.0;
  v68 = screen_width_f + 8.0;
  (*(void (__thiscall **)(int, float *, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    v88,
    LODWORD(v68),
    1124073472);
  console_update(SLODWORD(console_state));
  FUN_00401dd0(console_statec);
  if ( *(float *)(cv_showFPS + 12) != 0.0 )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1058642330);
    v36 = (__int64)((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 64))(grim_interface_ptr);
    v37 = *(_DWORD *)grim_interface_ptr;
    if ( (int)v36 < 400 )
    {
      v80 = (__int64)((double (*)(void))*(_DWORD *)(v37 + 64))();
      v69 = aD_0;
      LODWORD(v88[0]) = *(_DWORD *)config_screen_width - 45;
      v60 = (float)(config_screen_height - 24);
      v38 = (double)(*(_DWORD *)config_screen_width - 45);
    }
    else
    {
      v80 = (__int64)((double (*)(void))*(_DWORD *)(v37 + 64))();
      v69 = a400;
      LODWORD(v88[0]) = *(_DWORD *)config_screen_width - 51;
      v60 = (float)(config_screen_height - 24);
      v38 = (double)(*(_DWORD *)config_screen_width - 51);
    }
    v49 = v38;
    (*(void (__cdecl **)(int, _DWORD, float, char *, int))(v37 + 328))(
      grim_interface_ptr,
      LODWORD(v49),
      COERCE_FLOAT(LODWORD(v60)),
      v69,
      v80);
  }
  Sleep(0x32u);
}

// console_cmd_snd_add_game_tune @ 0x0042C360
// console command handler for snd_addGameTune; loads music\%s and queues the track
void console_cmd_snd_add_game_tune()
{
  char *v0; // eax
  int track; // eax
  char Buffer[1024]; // [esp+0h] [ebp-400h] BYREF

  if ( console_cmd_argc_get() == 2 )
  {
    v0 = console_cmd_arg_get(1);
    crt_sprintf(Buffer, "music\\%s", v0);
    track = music_load_track(Buffer);
    if ( track >= 0 )
      music_queue_track(track);
  }
  else
  {
    console_printf(&console_log_queue, aSndAddgametune_0);
  }
}

// console_cmd_set_gamma_ramp @ 0x0042C3D0
// console command handler for setGammaRamp; parses float and calls grim_set_config_var(0x1c)
void console_cmd_set_gamma_ramp()
{
  char *v0; // eax
  char *ArgList_4; // [esp+18h] [ebp-8h]
  float v2; // [esp+1Ch] [ebp-4h]

  if ( console_cmd_argc_get() == 2 )
  {
    v0 = console_cmd_arg_get(1);
    v2 = crt_atof_l(v0, ArgList_4);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 28, LODWORD(v2));
    console_printf(&console_log_queue, "Gamma ramp regenerated and multiplied with %f\n", v2);
  }
  else
  {
    console_printf(&console_log_queue, aSetgammarampSc);
    console_printf(&console_log_queue, aCommandAdjusts);
  }
}

// crimsonland_main @ 0x0042C450
// primary game init/run/shutdown sequence
int crimsonland_main()
{
  uint v0; // eax
  int v2; // esi
  char v3; // al
  int v4; // eax
  const CHAR *v5; // eax
  int v6; // edx
  int *v7; // ecx
  int *v8; // eax
  int v9; // edx
  int v10; // [esp+180h] [ebp-440h]
  int v11; // [esp+180h] [ebp-440h]
  int v12; // [esp+180h] [ebp-440h]
  int v13; // [esp+180h] [ebp-440h]
  int v14; // [esp+180h] [ebp-440h]
  int v15; // [esp+180h] [ebp-440h]
  int v16; // [esp+180h] [ebp-440h]
  int v17; // [esp+180h] [ebp-440h]
  int v18; // [esp+180h] [ebp-440h]
  int v19; // [esp+180h] [ebp-440h]
  int v20; // [esp+180h] [ebp-440h]
  int v21; // [esp+180h] [ebp-440h]
  int v22; // [esp+184h] [ebp-43Ch]
  int v23; // [esp+184h] [ebp-43Ch]
  int v24; // [esp+184h] [ebp-43Ch]
  int v25; // [esp+184h] [ebp-43Ch]
  int v26; // [esp+184h] [ebp-43Ch]
  int v27; // [esp+184h] [ebp-43Ch]
  int v28; // [esp+184h] [ebp-43Ch]
  int v29; // [esp+184h] [ebp-43Ch]
  int v30; // [esp+184h] [ebp-43Ch]
  int v31; // [esp+184h] [ebp-43Ch]
  int v32; // [esp+184h] [ebp-43Ch]
  int v33; // [esp+184h] [ebp-43Ch]
  int v34; // [esp+184h] [ebp-43Ch]
  int v35; // [esp+184h] [ebp-43Ch]
  int v36; // [esp+188h] [ebp-438h]
  int v37; // [esp+188h] [ebp-438h]
  int v38; // [esp+188h] [ebp-438h]
  int v39; // [esp+188h] [ebp-438h]
  int v40; // [esp+188h] [ebp-438h]
  int v41; // [esp+188h] [ebp-438h]
  int v42; // [esp+188h] [ebp-438h]
  int v43; // [esp+188h] [ebp-438h]
  int v44; // [esp+188h] [ebp-438h]
  int v45; // [esp+188h] [ebp-438h]
  int v46; // [esp+188h] [ebp-438h]
  int v47; // [esp+188h] [ebp-438h]
  int v48; // [esp+188h] [ebp-438h]
  int v49; // [esp+188h] [ebp-438h]
  int v50; // [esp+188h] [ebp-438h]
  int v51; // [esp+18Ch] [ebp-434h]
  int v52; // [esp+18Ch] [ebp-434h]
  int v53; // [esp+18Ch] [ebp-434h]
  int v54; // [esp+18Ch] [ebp-434h]
  int v55; // [esp+18Ch] [ebp-434h]
  int v56; // [esp+18Ch] [ebp-434h]
  int v57; // [esp+18Ch] [ebp-434h]
  int v58; // [esp+18Ch] [ebp-434h]
  int v59; // [esp+18Ch] [ebp-434h]
  int v60; // [esp+18Ch] [ebp-434h]
  char *v61; // [esp+190h] [ebp-430h]
  char *v62; // [esp+190h] [ebp-430h]
  char *v63; // [esp+190h] [ebp-430h]
  char *v64; // [esp+190h] [ebp-430h]
  char *v65; // [esp+190h] [ebp-430h]
  char *v66; // [esp+190h] [ebp-430h]
  char *v67; // [esp+190h] [ebp-430h]
  char *v68; // [esp+190h] [ebp-430h]
  char *v69; // [esp+190h] [ebp-430h]
  char *v70; // [esp+190h] [ebp-430h]
  char *v71; // [esp+190h] [ebp-430h]
  char *v72; // [esp+190h] [ebp-430h]
  char *v73; // [esp+190h] [ebp-430h]
  HKEY phkResult; // [esp+19Ch] [ebp-424h] BYREF
  int version; // [esp+1A0h] [ebp-420h] BYREF
  char v76[16]; // [esp+1A4h] [ebp-41Ch] BYREF
  char Buffer[12]; // [esp+1B4h] [ebp-40Ch] BYREF
  WCHAR WideCharStr[512]; // [esp+1C0h] [ebp-400h] BYREF

  v0 = FUN_004623b2(0);
  crt_srand(v0);
  version = 0;
  if ( dx_get_version(&version, Buffer, 10) < 0 )
  {
    if ( MessageBoxA(0, aUnknownDirectx, szAgent, 4u) == 7 )
      return 0;
  }
  else if ( (unsigned int)version < 0x80100 )
  {
    if ( MessageBoxA(0, Text, szAgent, 0x23u) == 6 )
    {
      MultiByteToWideChar(0, 0, MultiByteStr, -1, WideCharStr, 260);
      if ( HlinkNavigateString(0, WideCharStr) < 0 )
      {
        MessageBoxA(0, aFailedToLaunch, szAgent, 0);
        return 0;
      }
    }
    return 0;
  }
  crt_getcwd(game_base_path, 0x103u);
  GetCommandLineA();
  dword_473A64 = 123;
  v2 = Direct3DCreate8(220);
  console_printf(&console_log_queue, aCrimsonland_0);
  console_printf(&console_log_queue, asc_474D54);
  console_printf(&console_log_queue, asc_4711C0);
  console_flush_log(console_log_filename, v61);
  if ( !v2 )
  {
    MessageBoxA(0, aDirectx81NotDe, szAgent, 0);
    return 0;
  }
  (*(void (__stdcall **)(int))(*(_DWORD *)v2 + 8))(v2);
  console_printf(&console_log_queue, "Game base path: '%s'\n", game_base_path);
  console_flush_log(console_log_filename, v62);
  config_ensure_file();
  console_register_command(aSetgammaramp, console_cmd_set_gamma_ramp);
  console_register_command(aSndAddgametune, console_cmd_snd_add_game_tune);
  console_register_command(aGenerateterrai, console_cmd_generate_terrain);
  console_register_command(aTelltimesurviv, console_cmd_tell_time_survived);
  console_register_command(aSetresourcepaq, console_cmd_set_resource_paq);
  console_register_command(aLoadtexture, console_cmd_load_texture);
  console_register_command(aOpenurl, console_cmd_open_url);
  console_register_command(aSndfreqadjustm, console_cmd_snd_freq_adjustment);
  memset(&SubKey, 0, 0xFCu);
  unk_4853CC = 0;
  unk_4853CE = 0;
  qmemcpy(&SubKey, "Software\\Sock", 13);
  grim_interface_ptr = grim_load_interface(dll_name);
  console_printf(&console_log_queue, asc_4740FC);
  console_printf(&console_log_queue, aGrim2dApi);
  console_printf(&console_log_queue, asc_4740FC);
  console_printf(&console_log_queue, aInitiatingGrim);
  console_flush_log(console_log_filename, v63);
  qmemcpy(&byte_4852DD, "etPlugins\\Default\\", 18);
  if ( !grim_interface_ptr )
  {
    console_printf(&console_log_queue, aDevDllNotFound);
    grim_interface_ptr = grim_load_interface(aGrimDll);
  }
  console_flush_log(console_log_filename, v64);
  if ( !grim_interface_ptr )
  {
    MessageBoxA(0, aGrimDllIsCorru, aGrim, 0);
    return 0;
  }
  console_printf(&console_log_queue, aInterfaceCreat);
  console_printf(&console_log_queue, aRegisteringCor);
  register_core_cvars();
  if ( dword_473A64 != 123 )
    grim_interface_ptr = 0;
  console_flush_log(console_log_filename, v65);
  console_printf(&console_log_queue, aLoadingConfigP);
  config_load_presets();
  game_load_status();
  game_sequence_load();
  console_flush_log(console_log_filename, v66);
  console_printf(&console_log_queue, aInvokingGrimCo);
  console_flush_log(console_log_filename, v67);
  v3 = (*(int (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 16))(grim_interface_ptr);
  grim_config_invoked = 1;
  if ( !v3 )
  {
    config_sync_from_grim();
    grim_config_invoked = 0;
    (**(void (__thiscall ***)(int))grim_interface_ptr)(grim_interface_ptr);
    return 0;
  }
  config_sync_from_grim();
  grim_config_invoked = 0;
  config_load_presets();
  console_printf(&console_log_queue, aSettingSystemS);
  console_flush_log(console_log_filename, v68);
  terrain_texture_failed = *(_BYTE *)(*(int (__thiscall **)(int, char *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                                       grim_interface_ptr,
                                       v76,
                                       84);
  byte_4AAEEA = *(_BYTE *)(*(int (__thiscall **)(int, char *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                            grim_interface_ptr,
                            v76,
                            83);
  *(_DWORD *)config_texture_scale = *(_DWORD *)(*(int (__thiscall **)(int, char *, int))(*(_DWORD *)grim_interface_ptr
                                                                                       + 36))(
                                                 grim_interface_ptr,
                                                 v76,
                                                 89);
  if ( *(float *)config_texture_scale != 0.5
    && *(float *)config_texture_scale != 1.0
    && *(float *)config_texture_scale != 2.0
    && *(float *)config_texture_scale != 4.0 )
  {
    *(_DWORD *)config_texture_scale = 1065353216;
  }
  LOBYTE(config_blob[0]) = byte_4AAEEA;
  config_windowed = *(_BYTE *)(*(int (__thiscall **)(int, char *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                                grim_interface_ptr,
                                v76,
                                8);
  if ( terrain_texture_failed )
    console_printf(&console_log_queue, aUsingSafemodeF);
  else
    console_printf(&console_log_queue, aUsingPrimaryBa);
  if ( !grim_interface_ptr )
    console_printf(&console_log_queue, aUsingDeveloper);
  console_flush_log(console_log_filename, v69);
  (*(void (__thiscall **)(int, int, int, _DWORD, int, void (*)()))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    45,
    v10,
    0,
    v36,
    game_startup_init);
  (*(void (__thiscall **)(int, int, int, int, int, void (*)()))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    5,
    v11,
    v22,
    v37,
    audio_suspend_all);
  (*(void (__thiscall **)(int, int, int, int, int, int (*)()))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    6,
    v12,
    v23,
    v38,
    audio_resume_all);
  LOBYTE(v13) = 1;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    66,
    v13,
    v24,
    v39,
    v51);
  console_printf(&console_log_queue, aSettingSystemS);
  (*(void (__thiscall **)(int, int, int, int, int, CHAR *))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    7,
    v14,
    v25,
    v40,
    szAgent);
  *(_DWORD *)config_screen_width = *(_DWORD *)(*(int (__thiscall **)(int, char *, int))(*(_DWORD *)grim_interface_ptr
                                                                                      + 36))(
                                                grim_interface_ptr,
                                                v76,
                                                41);
  v4 = *(_DWORD *)(*(int (__thiscall **)(int, char *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                    grim_interface_ptr,
                    v76,
                    42);
  config_screen_height = v4;
  if ( config_windowed )
    console_printf(
      &console_log_queue,
      "...selected windowed mode, window size %dx%d",
      *(_DWORD *)config_screen_width,
      v4);
  else
    console_printf(
      &console_log_queue,
      "...selected fullscreen mode %dx%dx%d",
      *(_DWORD *)config_screen_width,
      v4,
      config_display_bpp);
  byte_4AAEDA = BYTE1(config_blob[0]);
  LOBYTE(v15) = 1;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    11,
    v15,
    v26,
    v41,
    v52);
  console_printf(&console_log_queue, aUsingKeyboard);
  LOBYTE(v16) = 1;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    12,
    v16,
    v27,
    v42,
    v53);
  console_printf(&console_log_queue, aUsingMouse);
  LOBYTE(v17) = 1;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    14,
    v17,
    v28,
    v43,
    v54);
  console_printf(&console_log_queue, aUsingJoystick);
  console_printf(&console_log_queue, aInitiatingGrim_0);
  if ( !(*(unsigned __int8 (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 20))(grim_interface_ptr) )
  {
    console_printf(&console_log_queue, aCriticalFailur);
    v5 = (const CHAR *)(*(int (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 40))(grim_interface_ptr);
    MessageBoxA(0, v5, aCrimsonland_1, 0);
    (**(void (__thiscall ***)(int))grim_interface_ptr)(grim_interface_ptr);
    return 0;
  }
  console_exec_line(aExecAutoexecTx);
  LOBYTE(v18) = 1;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    18,
    v18,
    v29,
    v44,
    v55);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    v30,
    v45,
    v56);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    v31,
    v46,
    v57);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1065353216,
    v32,
    v47,
    v58);
  screen_width_f = (float)*(int *)config_screen_width;
  flt_471144 = (float)config_screen_height;
  *((float *)console_register_cvar(aVWidth, a800) + 3) = (float)*(int *)config_screen_width;
  *((float *)console_register_cvar(aVHeight, a600) + 3) = (float)config_screen_height;
  init_audio_and_terrain();
  (*(void (__thiscall **)(int, int, int, int, int, char *))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    16,
    v19,
    v33,
    v48,
    aCrimsonPaq);
  console_printf(&console_log_queue, aSetResourcePaq);
  texture_get_or_load(aBackplasma, aLoadBackplasma);
  texture_get_or_load(aMockup, aLoadMockupJaz);
  texture_get_or_load(aLogoEsrb, aLoadEsrbMature);
  texture_get_or_load(aLoading, aLoadLoadingJaz);
  texture_get_or_load(aClLogo, aLoadLogoCrimso);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 44))(
    grim_interface_ptr,
    0,
    0,
    0,
    1065353216);
  LOBYTE(v20) = 1;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    54,
    v20,
    v34,
    v49,
    v59);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 44))(
    grim_interface_ptr,
    0,
    0,
    0,
    1065353216);
  LOBYTE(v21) = 1;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    54,
    v21,
    v35,
    v50,
    v60);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 44))(
    grim_interface_ptr,
    0,
    0,
    0,
    1065353216);
  v6 = dword_473A30;
  key_char_count = 0;
  memset(&key_char_buffer, 0, dword_473A30);
  (*(void (__thiscall **)(int, void *, int *, int))(*(_DWORD *)grim_interface_ptr + 84))(
    grim_interface_ptr,
    &key_char_buffer,
    &key_char_count,
    v6);
  config_sync_from_grim();
  v7 = &player_move_key_backward;
  v8 = &config_p1_axis_move_x;
  do
  {
    v9 = *(v8 - 12);
    v8 += 16;
    *(v7 - 1) = v9;
    *v7 = *(v8 - 27);
    v7[1] = *(v8 - 26);
    v7[2] = *(v8 - 25);
    v7[3] = *(v8 - 24);
    v7[4] = *(v8 - 23);
    v7[5] = *(v8 - 22);
    v7[6] = *(v8 - 21);
    v7[7] = *(v8 - 20);
    v7[9] = *(v8 - 19);
    v7[8] = *(v8 - 18);
    v7[11] = *(v8 - 17);
    v7[10] = *(v8 - 16);
    v7 += 216;
  }
  while ( (int)v8 < (int)dword_4805C0 );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 28))(grim_interface_ptr);
  if ( RegCreateKeyExA(HKEY_CURRENT_USER, aSoftware10tons, 0, 0, 0, 0xF003Fu, 0, &phkResult, 0) )
  {
    console_printf(&console_log_queue, aKameliWasNotHa);
  }
  else
  {
    reg_write_dword(phkResult, aTimeplayed, *(unsigned int *)&dword_48718C);
    RegCloseKey(phkResult);
  }
  game_save_status();
  console_printf(&console_log_queue, aLeavingCrimson);
  if ( dword_4AAEE4 )
    crt_free(dword_4AAEE4);
  console_flush_log(console_log_filename, v70);
  audio_shutdown_all();
  console_printf(&console_log_queue, aShutdownGrim);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 24))(grim_interface_ptr);
  console_flush_log(console_log_filename, v71);
  (**(void (__thiscall ***)(int))grim_interface_ptr)(grim_interface_ptr);
  console_printf(&console_log_queue, aWavingTheGrimR);
  console_flush_log(console_log_filename, v72);
  if ( !dword_4D11F0 && byte_4D11F8 && lpMultiByteStr )
  {
    Sleep(0xC8u);
    memset(WideCharStr, 0, sizeof(WideCharStr));
    MultiByteToWideChar(0, 1u, lpMultiByteStr, strlen(lpMultiByteStr), WideCharStr, 511);
    if ( HlinkNavigateString(0, WideCharStr) < 0 )
      console_printf(&console_log_queue, "Failed to open browser at '%s'.\n", lpMultiByteStr);
    byte_4D11F8 = 0;
  }
  console_flush_log(console_log_filename, v73);
  return 0;
}

// sub_42D0E0 @ 0x0042D0E0
void __cdecl __noreturn sub_42D0E0()
{
  unsigned __int8 *v0; // ebp
  DWORD v1; // ebx
  std::codecvt_base *v2; // ecx
  char *v3; // edi
  char v4; // al
  bool v5; // cc
  void *v6; // esi
  void *v7; // edx
  void *v8; // eax
  BOOL v9; // edi
  BOOL v10; // eax
  DWORD v11; // ecx
  DWORD v12; // esi
  BOOL v13; // eax
  DWORD LastError; // eax
  signed int v15; // edi
  char *v16; // ebx
  int v17; // [esp-8h] [ebp-178h]
  DWORD v18; // [esp-4h] [ebp-174h]
  char *v19; // [esp+0h] [ebp-170h]
  char v20; // [esp+13h] [ebp-15Dh]
  unsigned __int8 *v21; // [esp+14h] [ebp-15Ch]
  HINTERNET v22; // [esp+14h] [ebp-15Ch]
  DWORD dwError; // [esp+18h] [ebp-158h] BYREF
  HINTERNET hFile; // [esp+1Ch] [ebp-154h]
  DWORD dwNumberOfBytesRead; // [esp+20h] [ebp-150h] BYREF
  int v26; // [esp+24h] [ebp-14Ch]
  DWORD dwHeadersLength; // [esp+28h] [ebp-148h] BYREF
  HINTERNET hInternet; // [esp+2Ch] [ebp-144h]
  int v29; // [esp+30h] [ebp-140h]
  CHAR szServerName[64]; // [esp+34h] [ebp-13Ch] BYREF
  LPCSTR lpszAcceptTypes[11]; // [esp+74h] [ebp-FCh] BYREF
  byte record[72]; // [esp+A0h] [ebp-D0h] BYREF
  _BYTE arg2[64]; // [esp+E8h] [ebp-88h] BYREF
  _BYTE v34[72]; // [esp+128h] [ebp-48h] BYREF

  console_printf(&console_log_queue, aBeginthreadHig);
  console_flush_log(console_log_filename, v19);
  qmemcpy(v34, &highscore_active_record, sizeof(v34));
  dword_4D11F0 = 1;
  v20 = 0;
  hInternet = 0;
  hFile = 0;
  dwNumberOfBytesRead = 0;
  lpszAcceptTypes[0] = aImageGif;
  lpszAcceptTypes[1] = aImageXXbitmap;
  lpszAcceptTypes[2] = aImageJpeg;
  lpszAcceptTypes[3] = aImagePjpeg;
  lpszAcceptTypes[4] = aApplicationVnd;
  lpszAcceptTypes[5] = aApplicationVnd_0;
  lpszAcceptTypes[6] = aApplicationMsw;
  lpszAcceptTypes[7] = aApplicationXCo;
  lpszAcceptTypes[8] = aApplicationOct;
  lpszAcceptTypes[9] = asc_475278;
  lpszAcceptTypes[10] = 0;
  dwHeadersLength = strlen(szHeaders);
  v0 = (unsigned __int8 *)operator new(0x8000u);
  BYTE2(config_blob[0]) = 0;
  config_score_load_gate = 0;
  j_highscore_load_table();
  config_score_load_gate = 1;
  memset(v0, 0, 0x8000u);
  *v0 = 66;
  v0[1] = 72;
  v0[2] = -13;
  v0[3] = -123;
  if ( config_name_slot_selected )
    v0[4] = 1;
  else
    v0[4] = 0;
  if ( !(unsigned __int8)game_is_full_version() )
    v0[4] = 0;
  v0[5] = 0;
  if ( config_hardcore )
    v0[6] = 5;
  else
    v0[6] = config_game_mode;
  v0[7] = quest_stage_major[0];
  v0[8] = quest_stage_minor;
  v0[9] = config_player_count;
  strcpy((char *)v0 + 10, &config_saved_name_0[27 * config_name_slot_selected]);
  memset(record, 0, sizeof(record));
  v1 = strlen((const char *)v0 + 10) + 11;
  strcpy((char *)record, default_player_name);
  record[68] = 0;
  record[70] = 124;
  record[71] = -1;
  LOBYTE(v26) = 0;
  *(_DWORD *)&record[56] = crt_rand() & 0xFEE050F;
  if ( (unsigned __int8)game_is_full_version() )
  {
    v29 = 0;
    if ( (int)dword_4C395C > 0 )
    {
      v2 = (std::codecvt_base *)&v0[v1];
      v3 = byte_482B54;
      v21 = &v0[v1];
      dwError = (DWORD)byte_482B54;
      do
      {
        v4 = *v3;
        if ( !*v3 || (v4 & 2) != 0 || (v4 & 1) == 0 )
        {
          if ( sub_43AA60(v2) )
          {
            FUN_0043aa90(v3 - 68, arg2);
            qmemcpy(v21, arg2, 0x40u);
            v3 = (char *)dwError;
            v1 += 64;
            v21 += 64;
            LOBYTE(v26) = v26 + 1;
          }
          else
          {
            console_printf(&console_log_queue, aDetectedAPoten);
          }
        }
        v2 = dword_4C395C;
        v3 += 72;
        v5 = ++v29 < (int)dword_4C395C;
        dwError = (DWORD)v3;
      }
      while ( v5 );
    }
  }
  if ( (unsigned __int8)game_is_full_version() )
    v0[5] = v26;
  v6 = InternetOpenA(szAgent, 0, 0, 0, 0);
  v22 = v6;
  if ( !v6 )
  {
    console_printf(&console_log_queue, aOnlineScoresIn);
    goto LABEL_45;
  }
  memset(szServerName, 0, sizeof(szServerName));
  qmemcpy(szServerName, "scores.crimsonland.com", 22);
  v7 = InternetConnectA(v6, szServerName, 0x50u, szUserName, szPassword, 3u, 0x44000000u, 0x1289u);
  memset(szServerName, 0, sizeof(szServerName));
  hInternet = v7;
  qmemcpy(szServerName, "/scoring_v2_7.php", 17);
  if ( v7 )
  {
    v8 = HttpOpenRequestA(v7, szVerb, szServerName, szVersion, szReferrer, lpszAcceptTypes, 0x4000000u, 0x1289u);
    hFile = v8;
    if ( v8 )
    {
      v9 = HttpSendRequestA(v8, szHeaders, dwHeadersLength, v0, v1);
      console_printf(&console_log_queue, "<-- Sending %d scores in %d bytes.\n", (unsigned __int8)v26, v1);
      if ( !v9 )
      {
        console_printf(&console_log_queue, aOnlineScoresHt);
        goto LABEL_45;
      }
      memset(v0, 0, 0x8000u);
      v10 = InternetReadFile(hFile, v0, 0x400u, &dwNumberOfBytesRead);
      v11 = dwNumberOfBytesRead;
      v12 = dwNumberOfBytesRead;
      if ( !v10 )
      {
LABEL_31:
        console_printf(&console_log_queue, aOnlineScoresIn_0);
        LastError = GetLastError();
        console_printf(&console_log_queue, "Reason: %d\n", LastError);
        dwHeadersLength = 0x8000;
        InternetGetLastResponseInfoA(&dwError, (LPSTR)v0, &dwHeadersLength);
        console_printf(&console_log_queue, "Or: %s\n", v0);
LABEL_32:
        v6 = v22;
        goto LABEL_45;
      }
      while ( (int)(v12 + 1024) <= 0x8000 )
      {
        if ( !v11 )
          goto LABEL_34;
        v13 = InternetReadFile(hFile, &v0[v12], 0x400u, &dwNumberOfBytesRead);
        v11 = dwNumberOfBytesRead;
        v12 += dwNumberOfBytesRead;
        if ( !v13 )
          goto LABEL_31;
      }
      console_printf(&console_log_queue, aWarningReceivi);
LABEL_34:
      console_printf(&console_log_queue, aOnlineScoresBe);
      if ( *v0 == 21 )
      {
        v17 = v0[2];
        v15 = v0[1] + v17;
        console_printf(&console_log_queue, "<-- %d scores (%d+%d) received in %d bytes.\n", v15, v0[1], v17, v12);
        if ( v12 - 3 != 68 * v15 )
        {
          console_printf(
            &console_log_queue,
            "! Invalid number of bytes received (%d should be %d).\n",
            v12 - 3,
            68 * v15);
          v0[512] = 0;
          console_printf(&console_log_queue, "->%s<-\n", v0);
          goto LABEL_32;
        }
        console_printf(&console_log_queue, aSavingScores);
        if ( v15 > 0 )
        {
          v16 = (char *)(v0 + 3);
          dwError = v15;
          do
          {
            qmemcpy(record, v16, 0x44u);
            record[68] = 1;
            record[69] = config_hardcore != 0 ? 0x75 : 0;
            highscore_save_record(record);
            v16 += 68;
            --dwError;
          }
          while ( dwError );
        }
      }
      else
      {
        v0[512] = 0;
        console_printf(&console_log_queue, "invalid feedback (%d bytes).\n", v12);
        console_printf(&console_log_queue, "<-- (%d %d)\n", *v0, v0[1]);
        console_printf(&console_log_queue, "->%s<-\n", (const char *)v0);
      }
      console_printf(&console_log_queue, aOnlineScoresSc);
      v6 = v22;
      v20 = 1;
    }
    else
    {
      console_printf(&console_log_queue, aOnlineScoresHt_0);
    }
  }
  else
  {
    console_printf(&console_log_queue, aOnlineScoresIn_1);
  }
LABEL_45:
  console_printf(&console_log_queue, aOnlineScoresCl);
  crt_free(v0);
  if ( hFile )
    InternetCloseHandle(hFile);
  if ( hInternet )
    InternetCloseHandle(hInternet);
  if ( v6 )
    InternetCloseHandle(v6);
  j_highscore_load_table();
  qmemcpy(&highscore_active_record, v34, 0x48u);
  if ( v20 )
  {
    if ( byte_4D11F9 )
      v18 = 20;
    else
      v18 = 300;
    Sleep(v18);
    dword_4D11F0 = 5;
    if ( byte_4D11F9 )
      Sleep(0x14u);
    else
      Sleep(0x12Cu);
    dword_4D11F0 = 0;
  }
  else
  {
    if ( byte_4D11F9 )
      Sleep(0x14u);
    else
      Sleep(0x12Cu);
    dword_4D11F0 = 6;
  }
  console_printf(&console_log_queue, aEndthreadHighS);
  crt_endthread();
}

// sub_42D8A0 @ 0x0042D8A0
void __cdecl __noreturn sub_42D8A0()
{
  void *v0; // ebx
  char *v1; // ebp
  void *v2; // edx
  void *v3; // eax
  BOOL v4; // esi
  BOOL v5; // eax
  DWORD v6; // ecx
  DWORD v7; // esi
  BOOL v8; // eax
  DWORD LastError; // eax
  char *v10; // esi
  char *v11; // edi
  char *v12; // eax
  char *v13; // eax
  char *v14; // eax
  char *v15; // eax
  char *v16; // [esp+0h] [ebp-A0h]
  char *v17; // [esp+0h] [ebp-A0h]
  char *v18; // [esp+0h] [ebp-A0h]
  char v19; // [esp+13h] [ebp-8Dh]
  DWORD dwNumberOfBytesRead; // [esp+14h] [ebp-8Ch] BYREF
  DWORD dwHeadersLength; // [esp+18h] [ebp-88h] BYREF
  HINTERNET hInternet; // [esp+1Ch] [ebp-84h]
  HINTERNET v23; // [esp+20h] [ebp-80h]
  char ArgList[4]; // [esp+24h] [ebp-7Ch]
  int v25; // [esp+28h] [ebp-78h]
  int v26; // [esp+2Ch] [ebp-74h]
  CHAR szServerName[64]; // [esp+30h] [ebp-70h] BYREF
  LPCSTR lpszAcceptTypes[11]; // [esp+70h] [ebp-30h] BYREF
  DWORD dwError; // [esp+9Ch] [ebp-4h] BYREF

  dword_4D11F0 = 1;
  console_printf(&console_log_queue, aBeginthreadVer);
  console_flush_log(console_log_filename, v16);
  v0 = 0;
  v19 = 0;
  v23 = 0;
  dwNumberOfBytesRead = 0;
  lpszAcceptTypes[0] = aImageGif;
  lpszAcceptTypes[1] = aImageXXbitmap;
  lpszAcceptTypes[2] = aImageJpeg;
  lpszAcceptTypes[3] = aImagePjpeg;
  lpszAcceptTypes[4] = aApplicationVnd;
  lpszAcceptTypes[5] = aApplicationVnd_0;
  lpszAcceptTypes[6] = aApplicationMsw;
  lpszAcceptTypes[7] = aApplicationXCo;
  lpszAcceptTypes[8] = aApplicationOct;
  lpszAcceptTypes[9] = asc_475278;
  lpszAcceptTypes[10] = 0;
  dwHeadersLength = strlen(szHeaders);
  v1 = (char *)operator new(0x8000u);
  memset(v1, 0, 0x8000u);
  hInternet = InternetOpenA(szAgent, 0, 0, 0, 0);
  if ( hInternet )
  {
    memset(szServerName, 0, sizeof(szServerName));
    strcpy(szServerName, aWwwCrimsonland);
    v2 = InternetConnectA(hInternet, szServerName, 0x50u, szUserName, szPassword, 3u, 0x44000000u, 0x1289u);
    memset(szServerName, 0, sizeof(szServerName));
    v23 = v2;
    qmemcpy(szServerName, "/ra_version.php", 15);
    if ( v2 )
    {
      v3 = HttpOpenRequestA(v2, szVerb, szServerName, szVersion, szReferrer, lpszAcceptTypes, 0x4000000u, 0x1289u);
      v0 = v3;
      if ( v3 )
      {
        v4 = HttpSendRequestA(v3, szHeaders, dwHeadersLength, v1, 0);
        console_printf(&console_log_queue, aConnectingServ_0);
        if ( v4 )
        {
          console_printf(&console_log_queue, aReceivingData);
          memset(v1, 0, 0x8000u);
          v5 = InternetReadFile(v0, v1, 0x400u, &dwNumberOfBytesRead);
          v6 = dwNumberOfBytesRead;
          v7 = dwNumberOfBytesRead;
          if ( v5 )
          {
            while ( (int)(v7 + 1024) <= 0x8000 )
            {
              if ( !v6 )
                goto LABEL_13;
              v8 = InternetReadFile(v0, &v1[v7], 0x400u, &dwNumberOfBytesRead);
              v6 = dwNumberOfBytesRead;
              v7 += dwNumberOfBytesRead;
              if ( !v8 )
                goto LABEL_11;
            }
            console_printf(&console_log_queue, aWarningReceivi);
LABEL_13:
            console_printf(&console_log_queue, aVersionCheckBe);
            console_flush_log(console_log_filename, v17);
            if ( strstr(v1, SubStr) == v1 )
            {
              console_printf(&console_log_queue, aDataSeemsOk);
              v10 = 0;
              v11 = 0;
              v12 = strchr(v1, 34);
              if ( v12 )
              {
                v10 = v12 + 1;
                v13 = strchr(v12 + 1, 34);
                if ( v13 )
                {
                  *v13 = 0;
                  v14 = strchr(v13 + 1, 67);
                  if ( v14 )
                  {
                    v11 = v14;
                    v15 = strchr(v14, 60);
                    if ( v15 )
                    {
                      *v15 = 0;
                      v19 = 1;
                      lpMultiByteStr = strdup_malloc(v10);
                      FUN_00462ba0(v11, arg2);
                      if ( *(int *)ArgList > 1 || v25 > 9 || v26 > 94 )
                        console_printf(
                          &console_log_queue,
                          "There is a newer version available. (v%d.%d.%d)\n",
                          *(_DWORD *)ArgList,
                          v25,
                          v26);
                      else
                        lpMultiByteStr = 0;
                    }
                  }
                }
              }
              console_flush_log(console_log_filename, v18);
              console_printf(&console_log_queue, "Link: '%s'\n", v10);
              console_printf(&console_log_queue, "Newest Version: '%s'\n", v11);
              console_printf(&console_log_queue, "Local Version: '%s'\n", aCrimsonland199);
            }
            else
            {
              console_printf(&console_log_queue, aDataNotOk, v1);
              console_printf(&console_log_queue, "Received: '%s'\n", v1);
            }
            console_flush_log(console_log_filename, v18);
          }
          else
          {
LABEL_11:
            console_printf(&console_log_queue, aVersionCheckIn_0);
            LastError = GetLastError();
            console_printf(&console_log_queue, "Reason: %d\n", LastError);
            dwHeadersLength = 0x8000;
            InternetGetLastResponseInfoA(&dwError, v1, &dwHeadersLength);
            console_printf(&console_log_queue, "Or: %s\n", v1);
          }
        }
        else
        {
          console_printf(&console_log_queue, aVersionCheckHt);
        }
      }
      else
      {
        console_printf(&console_log_queue, aVersionCheckHt_0);
      }
    }
    else
    {
      console_printf(&console_log_queue, aVersionCheckIn_1);
    }
  }
  else
  {
    console_printf(&console_log_queue, aVersionCheckIn);
  }
  console_printf(&console_log_queue, aVersionCheckCl);
  crt_free(v1);
  if ( v0 )
    InternetCloseHandle(v0);
  if ( v23 )
    InternetCloseHandle(v23);
  if ( hInternet )
    InternetCloseHandle(hInternet);
  Sleep(0x12Cu);
  if ( v19 )
  {
    dword_4D11F0 = 5;
    Sleep(0x12Cu);
    dword_4D11F0 = 0;
    byte_4D11F8 = 1;
  }
  else
  {
    dword_4D11F0 = 6;
    byte_4D11F8 = 0;
  }
  console_printf(&console_log_queue, aEndthreadVersi);
  console_flush_log(console_log_filename, v17);
  crt_endthread();
}

// sub_42DE10 @ 0x0042DE10
int sub_42DE10()
{
  char *v0; // esi
  int v1; // edi
  int result; // eax

  v0 = (char *)&effect_pool_quad_data;
  v1 = 512;
  do
  {
    result = FUN_004010f0((int)v0, 28, 4, (int (__thiscall *)(int))Iostream_init::Iostream_init);
    v0 += 188;
    --v1;
  }
  while ( v1 );
  return result;
}

// nullsub_117 @ 0x0042DE50
void nullsub_117()
{
  ;
}

// nullsub_118 @ 0x0042DE70
void nullsub_118()
{
  ;
}

// effect_init_entry @ 0x0042DE80
// initializes an effect entry to default values
void effect_init_entry(void *entry)
{
  _DWORD *v1; // eax
  int v2; // ecx

  *((_DWORD *)entry + 11) = 0;
  *((_DWORD *)entry + 9) = 0;
  *((_DWORD *)entry + 5) = 0;
  *((_DWORD *)entry + 12) = 1065353216;
  *((_DWORD *)entry + 13) = 1065353216;
  *((_DWORD *)entry + 6) = 1065353216;
  *((_DWORD *)entry + 14) = 1065353216;
  *((_DWORD *)entry + 15) = 1065353216;
  v1 = (char *)entry + 80;
  v2 = 4;
  do
  {
    v1[2] = -1;
    *v1 = 1056964608;
    v1[1] = 1065353216;
    v1 += 7;
    --v2;
  }
  while ( v2 );
}

// effect_defaults_reset @ 0x0042DF10
// resets global effect template values
void effect_defaults_reset()
{
  _DWORD *v0; // esi

  effect_template_color_r = 1065353216;
  effect_template_color_g = 1065353216;
  effect_template_color_b = 1065353216;
  effect_template_color_a = 1065353216;
  dword_4AB1B0 = 0;
  effect_template_flags = 1;
  effect_template_rotation = 0;
  effect_template_scale = 1065353216;
  effect_template_age = 0;
  effect_template_lifetime = 1056964608;
  effect_template_half_height = 1107296256;
  effect_template_half_width = 1107296256;
  dword_4AB1B4 = 0;
  effect_template_rotation_step = 1.0;
  effect_template_scale_step = 1065353216;
  effect_template_vel_x = 0;
  effect_template_vel_y = 0;
  dword_4AB268 = 0;
  dword_4AB3E8 = (int)&unk_4AB3EC;
  effect_init_entry(effect_pool_pos_x);
  v0 = &unk_4AB4A4;
  do
  {
    *v0 = v0 + 1;
    effect_init_entry(v0 - 46);
    v0 += 47;
  }
  while ( (int)v0 < (int)&dword_4C2B2C );
  dword_4C2A70 = (int)&unk_4C2A74;
  effect_init_entry(entry);
  effect_free_list_head = (int)effect_pool_pos_x;
  dword_4C2B34 = 0;
}

// effect_free @ 0x0042E080
// returns an effect entry to the free list
void effect_free(void *entry)
{
  *((_DWORD *)entry + 46) = effect_free_list_head;
  *((_DWORD *)entry + 11) = 0;
  effect_free_list_head = (int)entry;
}

// effect_select_texture @ 0x0042E0A0
// selects effect texture page based on effect id
void effect_select_texture(int effect_id)
{
  int v1; // ecx

  v1 = effect_id_table[2 * effect_id];
  switch ( v1 )
  {
    case 16:
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(
        grim_interface_ptr,
        16,
        effect_id_frame[2 * effect_id]);
      break;
    case 32:
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(
        grim_interface_ptr,
        8,
        effect_id_frame[2 * effect_id]);
      break;
    case 64:
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(
        grim_interface_ptr,
        4,
        effect_id_frame[2 * effect_id]);
      break;
    case 128:
      (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 260))(
        grim_interface_ptr,
        2,
        effect_id_frame[2 * effect_id]);
      break;
  }
}

// effect_spawn @ 0x0042E120
// allocates an effect entry and assigns quad UVs
void *effect_spawn(int effect_id, float *pos)
{
  void *result; // eax
  int v4; // ebp
  int v5; // edx
  double v6; // st7
  double v7; // st7
  int v8; // ecx
  double v9; // st7
  double v10; // st7
  int v11; // ecx
  double v12; // st7
  double v13; // st7
  int v14; // ecx
  double v15; // st7
  double v16; // st7
  int v17; // ecx
  float v18; // [esp+0h] [ebp-10h]
  float v19; // [esp+0h] [ebp-10h]
  float v20; // [esp+0h] [ebp-10h]
  float v21; // [esp+0h] [ebp-10h]
  float v22; // [esp+0h] [ebp-10h]
  float v23; // [esp+0h] [ebp-10h]
  float v24; // [esp+0h] [ebp-10h]
  float v25; // [esp+0h] [ebp-10h]
  float v26; // [esp+0h] [ebp-10h]
  float v27; // [esp+0h] [ebp-10h]
  float v28; // [esp+0h] [ebp-10h]
  float v29; // [esp+0h] [ebp-10h]
  float v30; // [esp+0h] [ebp-10h]
  float v31; // [esp+0h] [ebp-10h]
  float v32; // [esp+0h] [ebp-10h]
  float v33; // [esp+0h] [ebp-10h]
  float v34; // [esp+4h] [ebp-Ch]
  float v35; // [esp+4h] [ebp-Ch]
  float v36; // [esp+4h] [ebp-Ch]
  float v37; // [esp+4h] [ebp-Ch]
  float v38; // [esp+4h] [ebp-Ch]
  float v39; // [esp+4h] [ebp-Ch]
  float v40; // [esp+4h] [ebp-Ch]
  float v41; // [esp+4h] [ebp-Ch]
  float v42; // [esp+4h] [ebp-Ch]
  float v43; // [esp+4h] [ebp-Ch]
  float v44; // [esp+4h] [ebp-Ch]
  float v45; // [esp+4h] [ebp-Ch]
  float v46; // [esp+4h] [ebp-Ch]
  float v47; // [esp+4h] [ebp-Ch]
  float v48; // [esp+4h] [ebp-Ch]
  float v49; // [esp+4h] [ebp-Ch]
  float v50; // [esp+4h] [ebp-Ch]
  float v51; // [esp+4h] [ebp-Ch]
  float v52; // [esp+4h] [ebp-Ch]
  float v53; // [esp+4h] [ebp-Ch]
  float v54; // [esp+4h] [ebp-Ch]
  float v55; // [esp+4h] [ebp-Ch]
  float v56; // [esp+4h] [ebp-Ch]
  float v57; // [esp+4h] [ebp-Ch]

  if ( config_detail_preset <= 2 && (dword_4C2B38++ & 1) != 0 )
    return &unk_4AB270;
  result = (void *)effect_free_list_head;
  v4 = effect_id_table[2 * effect_id];
  v5 = effect_id_frame[2 * effect_id];
  if ( *(_DWORD *)(effect_free_list_head + 184) )
    effect_free_list_head = *(_DWORD *)(effect_free_list_head + 184);
  else
    result = &unk_4AB270;
  qmemcpy((char *)result + 12, &effect_template_vel_x, 0x3Cu);
  *(float *)result = *pos;
  *((float *)result + 1) = pos[1];
  *((_BYTE *)result + 8) = effect_id;
  switch ( v4 )
  {
    case 16:
      *((_DWORD *)result + 23) = effect_uv16[2 * v5];
      *((float *)result + 24) = effect_uv16_v[2 * v5];
      v18 = -*(float *)&effect_template_half_width;
      v34 = -*(float *)&effect_template_half_height;
      *((float *)result + 18) = v18;
      *((float *)result + 19) = v34;
      v19 = effect_uv_step_16 + *(float *)&effect_uv16[2 * v5];
      v35 = effect_uv16_v[2 * v5];
      *((float *)result + 30) = v19;
      *((float *)result + 31) = v35;
      v36 = -*(float *)&effect_template_half_height;
      *((_DWORD *)result + 25) = effect_template_half_width;
      *((float *)result + 26) = v36;
      v20 = effect_uv_step_16 + *(float *)&effect_uv16[2 * v5];
      v6 = effect_uv_step_16 + effect_uv16_v[2 * v5];
      *((float *)result + 37) = v20;
      v37 = v6;
      *((float *)result + 38) = v37;
      v38 = *(float *)&effect_template_half_height;
      *((_DWORD *)result + 32) = effect_template_half_width;
      *((float *)result + 33) = v38;
      v7 = effect_uv_step_16 + effect_uv16_v[2 * v5];
      *((float *)result + 44) = *(float *)&effect_uv16[2 * v5];
      v39 = v7;
      *((float *)result + 45) = v39;
      v21 = -*(float *)&effect_template_half_width;
      v8 = effect_template_half_height;
      *((float *)result + 39) = v21;
      *((_DWORD *)result + 40) = v8;
      break;
    case 32:
      *((_DWORD *)result + 23) = effect_uv8[2 * v5];
      *((float *)result + 24) = effect_uv8_v[2 * v5];
      v22 = -*(float *)&effect_template_half_width;
      v40 = -*(float *)&effect_template_half_height;
      *((float *)result + 18) = v22;
      *((float *)result + 19) = v40;
      v23 = effect_uv_step_8 + *(float *)&effect_uv8[2 * v5];
      v41 = effect_uv8_v[2 * v5];
      *((float *)result + 30) = v23;
      *((float *)result + 31) = v41;
      v42 = -*(float *)&effect_template_half_height;
      *((_DWORD *)result + 25) = effect_template_half_width;
      *((float *)result + 26) = v42;
      v24 = effect_uv_step_8 + *(float *)&effect_uv8[2 * v5];
      v9 = effect_uv_step_8 + effect_uv8_v[2 * v5];
      *((float *)result + 37) = v24;
      v43 = v9;
      *((float *)result + 38) = v43;
      v44 = *(float *)&effect_template_half_height;
      *((_DWORD *)result + 32) = effect_template_half_width;
      *((float *)result + 33) = v44;
      v10 = effect_uv_step_8 + effect_uv8_v[2 * v5];
      *((float *)result + 44) = *(float *)&effect_uv8[2 * v5];
      v45 = v10;
      *((float *)result + 45) = v45;
      v25 = -*(float *)&effect_template_half_width;
      v11 = effect_template_half_height;
      *((float *)result + 39) = v25;
      *((_DWORD *)result + 40) = v11;
      break;
    case 64:
      *((_DWORD *)result + 23) = effect_uv4[2 * v5];
      *((float *)result + 24) = effect_uv4_v[2 * v5];
      v26 = -*(float *)&effect_template_half_width;
      v46 = -*(float *)&effect_template_half_height;
      *((float *)result + 18) = v26;
      *((float *)result + 19) = v46;
      v27 = effect_uv_step_4 + *(float *)&effect_uv4[2 * v5];
      v47 = effect_uv4_v[2 * v5];
      *((float *)result + 30) = v27;
      *((float *)result + 31) = v47;
      v48 = -*(float *)&effect_template_half_height;
      *((_DWORD *)result + 25) = effect_template_half_width;
      *((float *)result + 26) = v48;
      v28 = effect_uv_step_4 + *(float *)&effect_uv4[2 * v5];
      v12 = effect_uv_step_4 + effect_uv4_v[2 * v5];
      *((float *)result + 37) = v28;
      v49 = v12;
      *((float *)result + 38) = v49;
      v50 = *(float *)&effect_template_half_height;
      *((_DWORD *)result + 32) = effect_template_half_width;
      *((float *)result + 33) = v50;
      v13 = effect_uv_step_4 + effect_uv4_v[2 * v5];
      *((float *)result + 44) = *(float *)&effect_uv4[2 * v5];
      v51 = v13;
      *((float *)result + 45) = v51;
      v29 = -*(float *)&effect_template_half_width;
      v14 = effect_template_half_height;
      *((float *)result + 39) = v29;
      *((_DWORD *)result + 40) = v14;
      break;
    case 128:
      *((_DWORD *)result + 23) = effect_uv2[2 * v5];
      *((_DWORD *)result + 24) = effect_uv2_v[2 * v5];
      v30 = -*(float *)&effect_template_half_width;
      v52 = -*(float *)&effect_template_half_height;
      *((float *)result + 18) = v30;
      *((float *)result + 19) = v52;
      v31 = effect_uv_step_2 + *(float *)&effect_uv2[2 * v5];
      v53 = *(float *)&effect_uv2_v[2 * v5];
      *((float *)result + 30) = v31;
      *((float *)result + 31) = v53;
      v54 = -*(float *)&effect_template_half_height;
      *((_DWORD *)result + 25) = effect_template_half_width;
      *((float *)result + 26) = v54;
      v32 = effect_uv_step_2 + *(float *)&effect_uv2[2 * v5];
      v15 = effect_uv_step_2 + *(float *)&effect_uv2_v[2 * v5];
      *((float *)result + 37) = v32;
      v55 = v15;
      *((float *)result + 38) = v55;
      v56 = *(float *)&effect_template_half_height;
      *((_DWORD *)result + 32) = effect_template_half_width;
      *((float *)result + 33) = v56;
      v16 = effect_uv_step_2 + *(float *)&effect_uv2_v[2 * v5];
      *((float *)result + 44) = *(float *)&effect_uv2[2 * v5];
      v57 = v16;
      *((float *)result + 45) = v57;
      v33 = -*(float *)&effect_template_half_width;
      v17 = effect_template_half_height;
      *((float *)result + 39) = v33;
      *((_DWORD *)result + 40) = v17;
      break;
  }
  return result;
}

// effects_update @ 0x0042E710
// ticks active effects and frees expired entries
void effects_update()
{
  int *v0; // esi
  int v1; // ecx
  double v2; // st7
  float w; // [esp+0h] [ebp-20h]
  float h; // [esp+4h] [ebp-1Ch]
  float v5; // [esp+14h] [ebp-Ch]
  float v6; // [esp+18h] [ebp-8h]

  v0 = (int *)&effect_pool_age;
  do
  {
    v1 = v0[2];
    if ( v1 )
    {
      v5 = frame_dt + *(float *)v0;
      *(float *)v0 = v5;
      if ( v5 < (double)*((float *)v0 + 1) )
      {
        if ( v5 >= 0.0 )
        {
          v6 = frame_dt * *((float *)v0 - 6);
          v2 = frame_dt * *((float *)v0 - 5);
          *((float *)v0 - 9) = v6 + *((float *)v0 - 9);
          *((float *)v0 - 8) = v2 + *((float *)v0 - 8);
          if ( (v1 & 4) != 0 )
            *((float *)v0 - 4) = frame_dt * *((float *)v0 + 7) + *((float *)v0 - 4);
          if ( (v1 & 8) != 0 )
            *((float *)v0 - 3) = frame_dt * *((float *)v0 + 8) + *((float *)v0 - 3);
          if ( (v1 & 0x10) != 0 )
            *((float *)v0 + 6) = 1.0 - v5 / *((float *)v0 + 1);
        }
      }
      else
      {
        if ( (v1 & 0x80u) != 0 )
        {
          if ( (v1 & 0x100) != 0 )
            v0[6] = 1051931443;
          else
            v0[6] = 1061997773;
          h = *((float *)v0 - 1) + *((float *)v0 - 1);
          w = *((float *)v0 - 2) + *((float *)v0 - 2);
          fx_queue_add(*((unsigned __int8 *)v0 - 28), (float *)v0 - 9, w, h, *((float *)v0 - 4), (float *)v0 + 3);
        }
        effect_free(v0 - 9);
      }
    }
    v0 += 47;
  }
  while ( (int)v0 < (int)&perk_id_long_distance_runner );
}

// effects_render @ 0x0042E820
// renders active effects (rotated quads)
void effects_render()
{
  float *v0; // esi
  int v1; // ecx
  long double v2; // st7
  long double v3; // st6
  double v4; // st7
  float *v5; // esi
  int v6; // ecx
  long double v7; // st7
  long double v8; // st6
  double v9; // st7
  int v10; // [esp+48h] [ebp-34h]
  int v11; // [esp+48h] [ebp-34h]
  int v12; // [esp+48h] [ebp-34h]
  int v13; // [esp+4Ch] [ebp-30h]
  int v14; // [esp+4Ch] [ebp-30h]
  int v15; // [esp+4Ch] [ebp-30h]
  int v16; // [esp+50h] [ebp-2Ch]
  int v17; // [esp+50h] [ebp-2Ch]
  int v18; // [esp+50h] [ebp-2Ch]
  int v19; // [esp+58h] [ebp-24h]
  int v20; // [esp+58h] [ebp-24h]
  int v21; // [esp+5Ch] [ebp-20h] BYREF
  float v22; // [esp+60h] [ebp-1Ch]
  float v23; // [esp+64h] [ebp-18h] BYREF
  float v24; // [esp+68h] [ebp-14h]
  float v25; // [esp+6Ch] [ebp-10h] BYREF
  float v26; // [esp+70h] [ebp-Ch]
  float v27; // [esp+74h] [ebp-8h]
  float v28; // [esp+78h] [ebp-4h]

  (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 19, 5);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    v10,
    v13,
    v16);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
    grim_interface_ptr,
    particles_texture,
    0);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v0 = (float *)&effect_pool_color_g;
  do
  {
    v1 = *((_DWORD *)v0 - 2);
    if ( v1 && *(v0 - 4) >= 0.0 && (v1 & 0x40) != 0 )
    {
      v22 = *(v0 - 8);
      v2 = cos(v22);
      v25 = v2;
      v3 = sin(v22);
      v26 = -v3;
      v27 = v3;
      v25 = v25 * *(v0 - 7);
      v26 = v26 * *(v0 - 7);
      v27 = v27 * *(v0 - 7);
      v28 = v2 * *(v0 - 7);
      HIBYTE(v19) = (__int64)(v0[2] * 255.0);
      BYTE2(v19) = (__int64)(*(v0 - 1) * 255.0);
      BYTE1(v19) = (__int64)(*v0 * 255.0);
      v4 = *(float *)&camera_offset_x + *(v0 - 13);
      LOBYTE(v19) = (__int64)(v0[1] * 255.0);
      v21 = v19;
      v23 = v4;
      v24 = *(float *)&camera_offset_y + *(v0 - 12);
      (*(void (__thiscall **)(int, float *, int, float *, float *, int *))(*(_DWORD *)grim_interface_ptr + 308))(
        grim_interface_ptr,
        v0 + 5,
        4,
        &v23,
        &v25,
        &v21);
    }
    v0 += 47;
  }
  while ( (int)v0 < (int)&perk_id_pyrokinetic );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    2,
    v11,
    v14,
    v17);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v5 = (float *)&effect_pool_color_g;
  do
  {
    v6 = *((_DWORD *)v5 - 2);
    if ( v6 && *(v5 - 4) >= 0.0 && (v6 & 0x40) == 0 )
    {
      v22 = *(v5 - 8);
      v7 = cos(v22);
      v25 = v7;
      v8 = sin(v22);
      v26 = -v8;
      v27 = v8;
      v25 = v25 * *(v5 - 7);
      v26 = v26 * *(v5 - 7);
      v27 = v27 * *(v5 - 7);
      v28 = v7 * *(v5 - 7);
      HIBYTE(v20) = (__int64)(v5[2] * 255.0);
      BYTE2(v20) = (__int64)(*(v5 - 1) * 255.0);
      BYTE1(v20) = (__int64)(*v5 * 255.0);
      v9 = *(float *)&camera_offset_x + *(v5 - 13);
      LOBYTE(v20) = (__int64)(v5[1] * 255.0);
      v21 = v20;
      v23 = v9;
      v24 = *(float *)&camera_offset_y + *(v5 - 12);
      (*(void (__thiscall **)(int, float *, int, float *, float *, int *))(*(_DWORD *)grim_interface_ptr + 308))(
        grim_interface_ptr,
        v5 + 5,
        4,
        &v23,
        &v25,
        &v21);
    }
    v5 += 47;
  }
  while ( (int)v5 < (int)&perk_id_pyrokinetic );
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    v12,
    v15,
    v18);
}

// effect_spawn_blood_splatter @ 0x0042EB10
// spawns blood splatter particles (effect id 7)
void effect_spawn_blood_splatter(float *pos, float angle, float age)
{
  long double v3; // st7
  int v4; // edi
  char v5; // al
  float v6; // [esp+0h] [ebp-18h]
  float v7; // [esp+4h] [ebp-14h]
  float anglea; // [esp+20h] [ebp+8h]

  if ( !config_fx_toggle )
  {
    *(float *)&effect_template_lifetime = 0.25 - age;
    v3 = angle + 3.1415927;
    effect_template_color_r = 1065353216;
    effect_template_color_g = 1065353216;
    effect_template_flags = 201;
    effect_template_color_b = 1065353216;
    effect_template_color_a = 1056964608;
    effect_template_scale_step = 0;
    effect_template_age = LODWORD(age);
    v4 = 2;
    v6 = cos(v3);
    v7 = sin(v3);
    do
    {
      anglea = v3;
      *(float *)&effect_template_rotation = (double)((crt_rand() & 0x3F) - 32) * 0.1 + anglea;
      *(float *)&effect_template_half_width = (float)((crt_rand() & 7) + 1);
      effect_template_half_height = effect_template_half_width;
      *(float *)&effect_template_vel_x = (double)((crt_rand() & 0x3F) + 100) * v6;
      v5 = crt_rand();
      effect_template_rotation_step = 0.0;
      *(float *)&effect_template_vel_y = (double)((v5 & 0x3F) + 100) * v7;
      *(float *)&effect_template_scale_step = (double)(crt_rand() & 0x7F) * 0.029999999 + 0.1;
      effect_spawn(7, pos);
      --v4;
    }
    while ( v4 );
  }
}

// effect_spawn_freeze_shard @ 0x0042EC80
// spawns a random freeze shard effect (ids 8..10) around the given angle
void effect_spawn_freeze_shard(float *pos, float angle)
{
  char v2; // al
  int v3; // eax
  float anglea; // [esp+1Ch] [ebp+8h]

  effect_template_color_r = 1065353216;
  effect_template_flags = 461;
  effect_template_color_g = 1065353216;
  effect_template_color_b = 1065353216;
  effect_template_color_a = 1056964608;
  v2 = crt_rand();
  effect_template_age = 0;
  effect_template_half_width = 1090519040;
  effect_template_half_height = 1090519040;
  *(float *)&effect_template_lifetime = (double)(v2 & 0xF) * 0.0099999998 + 0.2;
  anglea = angle + 3.1415927;
  *(float *)&effect_template_rotation = (double)(crt_rand() % 100) * 0.0099999998 + anglea;
  *(float *)&effect_template_half_width = (float)(crt_rand() % 5 + 7);
  effect_template_half_height = effect_template_half_width;
  *(float *)&effect_template_vel_x = cos(anglea) * 114.0;
  *(float *)&effect_template_vel_y = sin(anglea) * 114.0;
  effect_template_rotation_step = ((double)(crt_rand() % 20) * 0.1 - 1.0) * 4.0;
  *(float *)&effect_template_scale_step = (double)-(crt_rand() & 0xF) * 0.1;
  v3 = crt_rand();
  effect_spawn(v3 % 3 + 8, pos);
}

// effect_spawn_freeze_shatter @ 0x0042EE00
// four-way shatter burst (id 0xe) plus extra freeze shards
void effect_spawn_freeze_shatter(float *pos, float angle)
{
  int v2; // esi
  long double v3; // st7
  int v4; // esi
  float v5; // [esp+0h] [ebp-20h]
  int v6; // [esp+Ch] [ebp-14h]

  effect_template_color_r = 1065353216;
  v2 = 0;
  effect_template_flags = 93;
  effect_template_color_g = 1065353216;
  effect_template_color_b = 1065353216;
  effect_template_color_a = 1056964608;
  effect_template_age = 0;
  effect_template_lifetime = 1066192077;
  effect_template_scale_step = 0;
  v6 = 0;
  do
  {
    v3 = (double)v6 * 1.5707964 + angle;
    *(float *)&effect_template_rotation = v3;
    *(float *)&effect_template_vel_x = cos(v3) * 42.0;
    *(float *)&effect_template_vel_y = sin(*(float *)&effect_template_rotation) * 42.0;
    *(float *)&effect_template_half_width = (float)(crt_rand() % 10 + 18);
    effect_template_half_height = effect_template_half_width;
    effect_template_rotation_step = ((double)(crt_rand() % 20) * 0.1 - 1.0) * 1.9;
    effect_spawn(14, pos);
    v6 = ++v2;
  }
  while ( v2 < 4 );
  v4 = 4;
  do
  {
    v5 = (double)(crt_rand() % 612) * 0.0099999998;
    effect_spawn_freeze_shard(pos, v5);
    --v4;
  }
  while ( v4 );
}

// effect_spawn_burst @ 0x0042EF60
// generic burst loop for effect id 0
void effect_spawn_burst(float *pos, int count)
{
  int v2; // esi

  v2 = count;
  effect_template_color_r = 1053609165;
  effect_template_flags = 29;
  effect_template_color_g = 1056964608;
  effect_template_color_b = 1065353216;
  effect_template_color_a = 1056964608;
  effect_template_age = 0;
  effect_template_lifetime = 1056964608;
  effect_template_half_width = 1107296256;
  effect_template_half_height = 1107296256;
  if ( count > 0 )
  {
    do
    {
      *(float *)&effect_template_rotation = (double)(crt_rand() & 0x7F) * 0.049087387;
      *(float *)&effect_template_vel_x = (float)((crt_rand() & 0x7F) - 64);
      *(float *)&effect_template_vel_y = (float)((crt_rand() & 0x7F) - 64);
      *(float *)&effect_template_scale_step = (double)(crt_rand() % 100) * 0.0099999998 + 0.1;
      effect_spawn(0, pos);
      --v2;
    }
    while ( v2 );
  }
}

// FUN_0042f080 @ 0x0042F080
// [binja] void* sub_42f080(float* arg1)
void *FUN_0042f080(float *arg1)
{
  int v1; // esi
  void *result; // eax

  effect_template_color_r = 1050253722;
  effect_template_flags = 25;
  effect_template_color_g = 1058642330;
  effect_template_color_b = 1063675494;
  effect_template_color_a = 1065353216;
  effect_template_age = 0;
  effect_template_lifetime = 1050253722;
  effect_template_half_width = 1108344832;
  effect_template_half_height = 1108344832;
  effect_template_rotation = 0;
  effect_template_vel_x = 0;
  effect_template_vel_y = 0;
  effect_template_scale_step = -1065353216;
  effect_spawn(1, arg1);
  effect_template_color_b = 1065353216;
  effect_template_color_r = 1053609165;
  effect_template_flags = 29;
  effect_template_color_g = 1056964608;
  effect_template_color_a = 1056964608;
  effect_template_age = 0;
  effect_template_lifetime = 1050253722;
  effect_template_half_width = 1107296256;
  effect_template_half_height = 1107296256;
  v1 = 4;
  if ( config_detail_preset < 3 )
    v1 = 2;
  do
  {
    *(float *)&effect_template_rotation = (double)(crt_rand() & 0x7F) * 0.049087387;
    *(float *)&effect_template_vel_x = (double)((crt_rand() & 0x7F) - 64) * 1.4;
    *(float *)&effect_template_vel_y = (double)((crt_rand() & 0x7F) - 64) * 1.4;
    *(float *)&effect_template_scale_step = (double)(crt_rand() % 100) * 0.0099999998 + 0.1;
    result = effect_spawn(0, arg1);
    --v1;
  }
  while ( v1 );
  return result;
}

// FUN_0042f270 @ 0x0042F270
// [binja] void* sub_42f270(float* arg1, float arg2, float arg3)
void *FUN_0042f270(float *arg1, float arg2, float arg3)
{
  effect_template_color_g = 1058642330;
  *(float *)&effect_template_lifetime = arg3 * 0.80000001;
  effect_template_color_r = 1058642330;
  *(float *)&effect_template_scale_step = arg2 * 45.0;
  effect_template_flags = 25;
  effect_template_color_b = 1063675494;
  effect_template_color_a = 1065353216;
  effect_template_age = 0;
  effect_template_half_width = 1082130432;
  effect_template_half_height = 1082130432;
  effect_template_rotation = 0;
  effect_template_vel_x = 0;
  effect_template_vel_y = 0;
  return effect_spawn(1, arg1);
}

// FUN_0042f330 @ 0x0042F330
// [binja] void* sub_42f330(float* arg1, float arg2, int32_t arg3)
void *FUN_0042f330(float *arg1, float arg2, int arg3)
{
  *(float *)&effect_template_scale_step = arg2 * 45.0;
  effect_template_color_b = 1050253722;
  effect_template_color_r = 1063675494;
  effect_template_color_g = 1058642330;
  effect_template_flags = 25;
  effect_template_color_a = 1065353216;
  effect_template_age = 1036831949;
  effect_template_lifetime = arg3;
  effect_template_half_width = 1082130432;
  effect_template_half_height = 1082130432;
  effect_template_rotation = 0;
  effect_template_vel_x = 0;
  effect_template_vel_y = 0;
  return effect_spawn(1, arg1);
}

// FUN_0042f3f0 @ 0x0042F3F0
// [binja] void* sub_42f3f0(float* arg1, float arg2, float arg3)
void *FUN_0042f3f0(float *arg1, float arg2, float arg3)
{
  float v3; // edi
  void *result; // eax
  double v5; // st7
  float pos; // [esp+4h] [ebp-10h] BYREF
  float v7; // [esp+8h] [ebp-Ch]
  int v8; // [esp+Ch] [ebp-8h]
  int v9; // [esp+10h] [ebp-4h]
  float arg3a; // [esp+20h] [ebp+Ch]

  pos = 1.0;
  v3 = arg3;
  v7 = 0.89999998;
  v8 = 1036831949;
  v9 = 1065353216;
  effect_template_color_r = 1065353216;
  result = (void *)1065353216;
  effect_template_flags = 25;
  effect_template_color_g = 1063675494;
  effect_template_color_b = 1036831949;
  effect_template_color_a = 1065353216;
  effect_template_half_width = 1082130432;
  effect_template_half_height = 1082130432;
  effect_template_rotation = 0;
  effect_template_vel_x = 0;
  effect_template_vel_y = 0;
  effect_template_scale_step = 1113325568;
  if ( SLODWORD(arg3) > 0 )
  {
    do
    {
      arg3a = (double)(crt_rand() & 0x1FF) * 0.001953125 * 6.2831855;
      v5 = (double)(crt_rand() % (__int64)arg2);
      pos = cos(arg3a) * v5 + *arg1;
      v7 = sin(arg3a) * v5 + arg1[1];
      *(float *)&effect_template_age = (double)-(unsigned __int8)crt_rand() * 0.0012000001;
      *(float *)&effect_template_lifetime = 0.1 - *(float *)&effect_template_age;
      result = effect_spawn(0, &pos);
      --LODWORD(v3);
    }
    while ( v3 != 0.0 );
  }
  return result;
}

// FUN_0042f540 @ 0x0042F540
// [binja] int32_t sub_42f540(int32_t arg1, float arg2)
int FUN_0042f540(int arg1, float arg2)
{
  double v2; // st7
  __int64 v3; // rax
  int v4; // esi
  float arg2a; // [esp+18h] [ebp+8h]

  effect_template_color_r = 1053609165;
  arg2a = arg2 * 0.80000001;
  v2 = arg2a * 0.69999999;
  effect_template_color_a = 1056964608;
  effect_template_flags = 29;
  effect_template_color_g = 1056964608;
  *(float *)&effect_template_lifetime = v2;
  effect_template_color_b = 1065353216;
  effect_template_age = 0;
  if ( v2 > 1.1 )
    effect_template_lifetime = 1066192077;
  *(float *)&effect_template_half_width = arg2a * 32.0;
  effect_template_half_height = effect_template_half_width;
  v3 = (__int64)(arg2a * 5.0);
  if ( config_detail_preset < 3 )
    LODWORD(v3) = (int)v3 / 2;
  if ( (int)v3 > 0 )
  {
    v4 = v3;
    do
    {
      *(float *)&effect_template_rotation = (double)(crt_rand() & 0x7F) * 0.049087387;
      *(float *)&effect_template_vel_x = (double)((crt_rand() & 0x7F) - 64) * arg2a * 1.4;
      *(float *)&effect_template_vel_y = (double)((crt_rand() & 0x7F) - 64) * arg2a * 1.4;
      *(float *)&effect_template_scale_step = ((double)(crt_rand() % 100) * 0.0099999998 + 0.1) * arg2a;
      LODWORD(v3) = effect_spawn(0, (float *)arg1);
      --v4;
    }
    while ( v4 );
  }
  return v3;
}

// effect_spawn_explosion_burst @ 0x0042F6C0
// spawns explosion burst and shockwave particles
void effect_spawn_explosion_burst(float *pos, float scale)
{
  int v3; // edi
  double v4; // st7
  int v5; // eax
  int v6; // edi
  int v7; // [esp+0h] [ebp-14h]
  float *posa; // [esp+18h] [ebp+4h]

  *(float *)&effect_template_scale_step = scale * 25.0;
  effect_template_color_r = 1058642330;
  effect_template_flags = 25;
  effect_template_color_g = 1058642330;
  effect_template_color_b = 1058642330;
  effect_template_color_a = 1065353216;
  effect_template_lifetime = 1051931443;
  effect_template_age = -1110651699;
  effect_template_half_width = 1107296256;
  effect_template_half_height = 1107296256;
  effect_template_rotation = 0;
  effect_template_vel_x = 0;
  effect_template_vel_y = 0;
  effect_spawn(1, pos);
  effect_template_color_b = 1036831949;
  effect_template_color_r = 1036831949;
  effect_template_flags = 93;
  effect_template_color_g = 1036831949;
  effect_template_color_a = 1065353216;
  effect_template_rotation = 0;
  effect_template_vel_x = 0;
  effect_template_vel_y = 0;
  if ( config_detail_preset > 3 )
  {
    v3 = 0;
    posa = 0;
    do
    {
      effect_template_half_width = 1107296256;
      effect_template_half_height = 1107296256;
      v4 = (double)(int)posa * 0.2;
      *(float *)&effect_template_age = v4 - 0.5;
      *(float *)&effect_template_lifetime = v4 + 0.60000002;
      v5 = crt_rand();
      effect_template_rotation_step = 1.4;
      *(float *)&v7 = scale * 5.0;
      effect_template_scale_step = v7;
      *(float *)&effect_template_rotation = (double)(v5 % 614) * 0.02;
      effect_spawn(17, pos);
      posa = (float *)++v3;
    }
    while ( v3 < 2 );
  }
  *(float *)&effect_template_scale_step = scale * 45.0;
  effect_template_color_r = 1065353216;
  effect_template_flags = 25;
  effect_template_color_g = 1065353216;
  effect_template_color_b = 1065353216;
  effect_template_color_a = 1065353216;
  effect_template_age = 0;
  effect_template_lifetime = 1050253722;
  effect_template_half_width = 1107296256;
  effect_template_half_height = 1107296256;
  effect_template_rotation = 0;
  effect_template_vel_x = 0;
  effect_template_vel_y = 0;
  effect_spawn(0, pos);
  effect_template_color_b = 1065353216;
  effect_template_color_r = 1065353216;
  effect_template_flags = 29;
  effect_template_color_g = 1065353216;
  effect_template_color_a = 1065353216;
  effect_template_lifetime = 1060320051;
  effect_template_age = 0;
  effect_template_half_width = 1107296256;
  effect_template_half_height = 1107296256;
  if ( config_detail_preset >= 2 )
    v6 = (config_detail_preset >= 4) + 3;
  else
    v6 = 1;
  if ( v6 > 0 )
  {
    do
    {
      *(float *)&effect_template_rotation = (double)(crt_rand() % 314) * 0.02;
      *(float *)&effect_template_vel_x = (float)(2 * (crt_rand() & 0x3F) - 64);
      *(float *)&effect_template_vel_y = (float)(2 * (crt_rand() & 0x3F) - 64);
      *(float *)&effect_template_scale_step = (double)(((unsigned __int8)crt_rand() - 3) & 7) * scale;
      effect_template_rotation_step = (float)(((unsigned __int8)crt_rand() + 3) & 7);
      effect_spawn(12, pos);
      --v6;
    }
    while ( v6 );
  }
}

// sub_42FA90 @ 0x0042FA90
// [binja] int32_t sub_42fae0()
int sub_42FA90()
{
  FUN_0042faa0();
  return crt_atexit(sub_42FAF0);
}

// FUN_0042faa0 @ 0x0042FAA0
// [binja] int32_t sub_42faa0()
int FUN_0042faa0()
{
  int result; // eax

  crt_ehvec_ctor(perk_meta_table, 0x14u, 128, sub_42FAC0, FUN_00412410);
  return result;
}

// sub_42FAC0 @ 0x0042FAC0
void __thiscall sub_42FAC0(_DWORD *this)
{
  *(this + 2) = 3;
  *(this + 4) = -1;
  *this = 0;
  *(this + 1) = 0;
  *((_BYTE *)this + 12) = 0;
}

// sub_42FAF0 @ 0x0042FAF0
void __cdecl sub_42FAF0()
{
  crt_ehvec_dtor(perk_meta_table, 0x14u, 128, (void (__thiscall *)(void *))FUN_00412410);
}

// perk_can_offer @ 0x0042FB10
// returns nonzero when perk is eligible for selection
int perk_can_offer(int perk_index)
{
  int result; // eax

  result = config_game_mode;
  if ( (config_game_mode != 3
     || !config_hardcore
     || quest_stage_minor != 10
     || *(_DWORD *)quest_stage_major != 2
     || perk_index != perk_id_poison_bullets
     && perk_index != perk_id_veins_of_poison
     && perk_index != perk_id_plaguebearer)
    && (config_player_count != 2 || (perk_flags_table[20 * perk_index] & 2) != 0) )
  {
    if ( config_game_mode != 3 || (result = 5 * perk_index, (perk_flags_table[20 * perk_index] & 1) != 0) )
    {
      result = perk_prereq_table[5 * perk_index];
      if ( result == -1 )
      {
        LOBYTE(result) = 1;
        return result;
      }
      if ( (int)*(&player_perk_counts + result) > 0 )
      {
        LOBYTE(result) = 1;
        return result;
      }
      result = game_is_full_version();
      if ( !(_BYTE)result
        && perk_index != perk_id_living_fortress
        && perk_index != perk_id_man_bomb
        && perk_index != perk_id_fire_caugh )
      {
        result = perk_id_tough_reloader;
      }
    }
  }
  LOBYTE(result) = 0;
  return result;
}

// perk_select_random @ 0x0042FBD0
// randomly selects an eligible perk index
int perk_select_random()
{
  int v0; // edi
  int v1; // esi

  v0 = 1;
  while ( 1 )
  {
    v1 = crt_rand() % dword_4C2C38 + 1;
    if ( perk_available_table[20 * v1] )
    {
      if ( (unsigned __int8)perk_can_offer(v1) )
        break;
    }
    if ( ++v0 > 1000 )
    {
      console_printf(&console_log_queue, aPerkRandomizer_0);
      return perk_id_instant_winner;
    }
  }
  return v1;
}

// perks_rebuild_available @ 0x0042FC30
// rebuilds perk availability/unlock flags
void perks_rebuild_available()
{
  int v0; // ecx
  char *v1; // eax
  int v2; // edi
  _BYTE *v3; // eax
  int v4; // esi
  int v5; // edx
  int v6; // eax
  int v7; // ecx
  int *v8; // edx
  int v9; // eax

  v0 = dword_4C2C38 + 1;
  if ( dword_4C2C38 + 1 > 0 )
  {
    v1 = perk_available_table;
    do
    {
      *v1 = 0;
      v1 += 20;
      --v0;
    }
    while ( v0 );
  }
  v2 = 5 * perk_id_antiperk;
  v3 = &unk_4C2C60;
  perk_available_table[20 * perk_id_antiperk] = 0;
  do
  {
    *v3 = 1;
    v3 += 20;
  }
  while ( (int)v3 < (int)byte_4C2E7C );
  v4 = quest_unlock_index;
  v5 = 5 * perk_id_living_fortress;
  v6 = perk_id_fire_caugh;
  perk_available_table[20 * perk_id_man_bomb] = 1;
  perk_available_table[4 * v5] = 1;
  perk_available_table[20 * v6] = 1;
  perk_available_table[20 * perk_id_tough_reloader] = 1;
  v7 = 0;
  if ( v4 > 0 )
  {
    v8 = quest_unlock_perk_id;
    do
    {
      if ( (int)v8 >= (int)&dword_484FE8 )
        break;
      v9 = *v8;
      ++v7;
      v8 += 11;
      perk_available_table[20 * v9] = 1;
    }
    while ( v7 < v4 );
  }
  perk_available_table[4 * v2] = 0;
}

// perk_count_get @ 0x0042FCF0
// returns perk count from DAT_00490968
int perk_count_get(int perk_id)
{
  return (int)*(&player_perk_counts + perk_id);
}

// sub_42FD00 @ 0x0042FD00
char *__cdecl sub_42FD00(const char *a1, int a2)
{
  unsigned int v2; // kr08_4
  char *v3; // ebx
  int v4; // edi
  signed int i; // esi
  char v6; // al
  _BYTE v8[2]; // [esp+12h] [ebp-2h] BYREF

  v2 = strlen(a1) + 1;
  v8[1] = 0;
  v3 = (char *)operator new(v2);
  strcpy(v3, a1);
  v4 = a2;
  for ( i = 0; i < (int)(v2 - 1); ++i )
  {
    v8[0] = v3[i];
    v4 -= (*(int (__thiscall **)(int, _BYTE *))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, v8);
    if ( v4 < 0 )
    {
      do
        v6 = v3[--i];
      while ( v6 != 32 );
      v4 = a2;
      v3[i] = 10;
    }
  }
  return v3;
}

// perks_init_database @ 0x0042FD90
// builds the perk table (ids, names, descriptions)
void perks_init_database()
{
  char *v0; // eax
  int v1; // ecx
  int v2; // edx
  int v3; // eax

  perk_id_antiperk = 0;
  perk_meta_table[0] = (int)sub_42FD00(aAntiperk, 256);
  perk_desc_table[0] = (int)sub_42FD00(aYouShouldnTBeS, 256);
  perk_id_bloody_mess_quick_learner = 1;
  dword_4C3640 = (int)sub_42FD00(aBloodyMess, 256);
  dword_4C3648 = (int)sub_42FD00(aMoreTheMerrier, 256);
  dword_4C3644 = (int)sub_42FD00(aQuickLearner, 256);
  v0 = sub_42FD00(aYouLearnThings, 256);
  dword_4C364C = (int)v0;
  if ( config_fx_toggle )
  {
    v1 = 5 * perk_id_bloody_mess_quick_learner;
    perk_meta_table[v1] = dword_4C3644;
    perk_desc_table[v1] = (int)v0;
  }
  else
  {
    v2 = dword_4C3648;
    v3 = 5 * perk_id_bloody_mess_quick_learner;
    perk_meta_table[v3] = dword_4C3640;
    perk_desc_table[v3] = v2;
  }
  perk_id_sharpshooter = 2;
  dword_4C2C68 = (int)sub_42FD00(aSharpshooter, 256);
  dword_4C2C6C = (int)sub_42FD00(aMiraculouslyYo, 256);
  perk_id_fastloader = 3;
  dword_4C2C7C = (int)sub_42FD00(aFastloader, 256);
  dword_4C2C80 = (int)sub_42FD00(aManYouSureKnow, 256);
  perk_id_lean_mean_exp_machine = 4;
  dword_4C2C90 = (int)sub_42FD00(aLeanMeanExpMac, 256);
  dword_4C2C94 = (int)sub_42FD00(aWhyKillForExpe, 256);
  perk_id_long_distance_runner = 5;
  dword_4C2CA4 = (int)sub_42FD00(aLongDistanceRu, 256);
  dword_4C2CA8 = (int)sub_42FD00(aYouMoveLikeATr, 256);
  perk_id_pyrokinetic = 6;
  dword_4C2CB8 = (int)sub_42FD00(aPyrokinetic, 256);
  dword_4C2CBC = (int)sub_42FD00(aYouSeeFlamesEv, 256);
  perk_id_instant_winner = 7;
  dword_4C2CCC = (int)sub_42FD00(aInstantWinner, 256);
  dword_4C2CD0 = (int)sub_42FD00(a2500Experience, 256);
  dword_4C2CD4 |= 4u;
  perk_id_grim_deal = 8;
  dword_4C2CE8 = 0;
  dword_4C2CE0 = (int)sub_42FD00(aGrimDeal, 256);
  dword_4C2CE4 = (int)sub_42FD00(aILlMakeYouADea, 256);
  perk_id_alternate_weapon = 9;
  dword_4C2CFC = 1;
  dword_4C2CF4 = (int)sub_42FD00(aAlternateWeapo, 256);
  dword_4C2CF8 = (int)sub_42FD00(aEverFanciedAbo, 256);
  perk_id_plaguebearer = 10;
  dword_4C2D08 = (int)sub_42FD00(aPlaguebearer, 256);
  dword_4C2D0C = (int)sub_42FD00(aYouCarryAHorri, 256);
  perk_id_evil_eyes = 11;
  dword_4C2D1C = (int)sub_42FD00(aEvilEyes, 256);
  dword_4C2D20 = (int)sub_42FD00(aNoLivingNorDea, 256);
  perk_id_ammo_maniac = 12;
  dword_4C2D30 = (int)sub_42FD00(aAmmoManiac, 256);
  dword_4C2D34 = (int)sub_42FD00(aYouSqueezeAndY, 256);
  perk_id_radioactive = 13;
  dword_4C2D44 = (int)sub_42FD00(aRadioactive, 256);
  dword_4C2D48 = (int)sub_42FD00(aYouAreTheRadio, 256);
  perk_id_fastshot = 14;
  dword_4C2D58 = (int)sub_42FD00(aFastshot, 256);
  dword_4C2D5C = (int)sub_42FD00(aFunnyHowYouMak, 256);
  perk_id_fatal_lottery = 15;
  dword_4C2D74 = 4;
  dword_4C2D6C = (int)sub_42FD00(aFatalLottery, 256);
  dword_4C2D70 = (int)sub_42FD00(aFiftyFiftyChan, 256);
  perk_id_random_weapon = 16;
  dword_4C2D88 = 5;
  dword_4C2D80 = (int)sub_42FD00(aRandomWeapon, 256);
  dword_4C2D84 = (int)sub_42FD00(aHereHaveThisWe, 256);
  perk_id_mr_melee = 17;
  dword_4C2D94 = (int)sub_42FD00(aMrMelee, 256);
  dword_4C2D98 = (int)sub_42FD00(aYouMasterTheAr, 256);
  perk_id_anxious_loader = 18;
  dword_4C2DA8 = (int)sub_42FD00(aAnxiousLoader, 256);
  dword_4C2DAC = (int)sub_42FD00(aWhenYouCanTSta, 256);
  perk_id_final_revenge = 19;
  dword_4C2DC4 = 0;
  dword_4C2DBC = (int)sub_42FD00(aFinalRevenge, 256);
  dword_4C2DC0 = (int)sub_42FD00(aPickThisAndYou, 256);
  perk_id_telekinetic = 20;
  dword_4C2DD0 = (int)sub_42FD00(aTelekinetic, 256);
  dword_4C2DD4 = (int)sub_42FD00(aPickingUpBonus, 256);
  perk_id_perk_expert = 21;
  dword_4C2DE4 = (int)sub_42FD00(aPerkExpert, 256);
  dword_4C2DE8 = (int)sub_42FD00(aYouSureKnowHow, 256);
  perk_id_unstoppable = 22;
  dword_4C2DF8 = (int)sub_42FD00(aUnstoppable, 256);
  dword_4C2DFC = (int)sub_42FD00(aMonstersCanTSl, 256);
  perk_id_regression_bullets = 23;
  dword_4C2E0C = (int)sub_42FD00(aRegressionBull, 256);
  dword_4C2E10 = (int)sub_42FD00(aAttemptToShoot, 256);
  perk_id_infernal_contract = 24;
  dword_4C2E20 = (int)sub_42FD00(aInfernalContra, 256);
  dword_4C2E24 = (int)sub_42FD00(aInExchangeForY, 256);
  perk_id_poison_bullets = 25;
  dword_4C2E34 = (int)sub_42FD00(aPoisonBullets, 256);
  dword_4C2E38 = (int)sub_42FD00(aYouTendToExpli, 256);
  perk_id_dodger = 26;
  dword_4C2E48 = (int)sub_42FD00(aDodger, 256);
  dword_4C2E4C = (int)sub_42FD00(aItSeemsSoStupi, 256);
  perk_id_bonus_magnet = 27;
  dword_4C2E5C = (int)sub_42FD00(aBonusMagnet, 256);
  dword_4C2E60 = (int)sub_42FD00(aYouSomehowSeem, 256);
  perk_id_uranium_filled_bullets = 28;
  dword_4C2E70 = (int)sub_42FD00(aUraniumFilledB, 256);
  dword_4C2E74 = (int)sub_42FD00(aYourBulletsHav, 256);
  perk_id_doctor = 29;
  dword_4C2E84 = (int)sub_42FD00(aDoctor, 256);
  dword_4C2E88 = (int)sub_42FD00(aWithASingleGla, 256);
  perk_id_monster_vision = 30;
  dword_4C2E98 = (int)sub_42FD00(aMonsterVision, 256);
  dword_4C2E9C = (int)sub_42FD00(aWithYourNewlyE, 256);
  perk_id_hot_tempered = 31;
  dword_4C2EAC = (int)sub_42FD00(aHotTempered, 256);
  dword_4C2EB0 = (int)sub_42FD00(aItLiterallyBoi, 256);
  perk_id_bonus_economist = 32;
  dword_4C2EC0 = (int)sub_42FD00(aBonusEconomist, 256);
  dword_4C2EC4 = (int)sub_42FD00(aYourBonusPower, 256);
  perk_id = 0;
  perk_id_thick_skinned = 33;
  dword_4C2ED4 = (int)sub_42FD00(aThickSkinned, 256);
  dword_4C2ED8 = (int)sub_42FD00(aTrade13OfYourH, 256);
  perk_id_barrel_greaser = 34;
  dword_4C2EE8 = (int)sub_42FD00(aBarrelGreaser, 256);
  dword_4C2EEC = (int)sub_42FD00(aAfterStudyingA, 256);
  perk_id_ammunition_within = 35;
  dword_4C2EFC = (int)sub_42FD00(aAmmunitionWith, 256);
  dword_4C2F00 = (int)sub_42FD00(aEmptyClipDoesn, 256);
  perk_id_veins_of_poison = 36;
  dword_4C2F10 = (int)sub_42FD00(aVeinsOfPoison, 256);
  dword_4C2F14 = (int)sub_42FD00(aAStrongPoisonR, 256);
  perk_id_toxic_avenger = 37;
  dword_4C2F24 = (int)sub_42FD00(aToxicAvenger, 256);
  dword_4C2F28 = (int)sub_42FD00(aYouStartedOutJ, 256);
  perk_id_regeneration = 38;
  dword_4C2F34 = perk_id_veins_of_poison;
  dword_4C2F38 = (int)sub_42FD00(aRegeneration, 256);
  dword_4C2F3C = (int)sub_42FD00(aYourHealthRepl, 256);
  perk_id_pyromaniac = 39;
  dword_4C2F4C = (int)sub_42FD00(aPyromaniac, 256);
  dword_4C2F50 = (int)sub_42FD00(aYouJustEnjoyUs, 256);
  perk_id_ninja = 40;
  dword_4C2F60 = (int)sub_42FD00(aNinja, 256);
  dword_4C2F64 = (int)sub_42FD00(aYouVeTakenYour, 256);
  dword_4C2F70 = perk_id_dodger;
  perk_id_highlander = 41;
  dword_4C2F7C = 0;
  dword_4C2F74 = (int)sub_42FD00(aHighlander, 256);
  dword_4C2F78 = (int)sub_42FD00(aYouAreImmortal, 256);
  perk_id_jinxed = 42;
  dword_4C2F88 = (int)sub_42FD00(aJinxed, 256);
  dword_4C2F8C = (int)sub_42FD00(aThingsHappenNe, 256);
  perk_id_perk_master = 43;
  dword_4C2F9C = (int)sub_42FD00(aPerkMaster, 256);
  dword_4C2FA0 = (int)sub_42FD00(aBeingThePerkEx, 256);
  dword_4C2FAC = perk_id_perk_expert;
  perk_id_reflex_boosted = 44;
  dword_4C2FB0 = (int)sub_42FD00(aReflexBoosted, 256);
  dword_4C2FB4 = (int)sub_42FD00(aToYouTheWorldS, 256);
  perk_id_greater_regeneration = 45;
  dword_4C2FC4 = (int)sub_42FD00(aGreaterRegener, 256);
  dword_4C2FC8 = (int)sub_42FD00(aYourHealthRepl_0, 256);
  perk_id_breathing_room = 46;
  dword_4C2FD4 = perk_id_regeneration;
  dword_4C2FE0 = 2;
  dword_4C2FD8 = (int)sub_42FD00(aBreathingRoom, 256);
  dword_4C2FDC = (int)sub_42FD00(aTrade23rdsOfYo, 256);
  perk_id_death_clock = 47;
  dword_4C2FEC = (int)sub_42FD00(aDeathClock, 256);
  dword_4C2FF0 = (int)sub_42FD00(aYouDieExactlyI, 256);
  perk_id_my_favourite_weapon = 48;
  dword_4C3000 = (int)sub_42FD00(aMyFavouriteWea, 256);
  dword_4C3004 = (int)sub_42FD00(aYouVeGrownVery, 256);
  perk_id_bandage = 49;
  dword_4C3014 = (int)sub_42FD00(aBandage, 256);
  dword_4C3018 = (int)sub_42FD00(aHereEatThisBan, 256);
  perk_id_angry_reloader = 50;
  dword_4C3028 = (int)sub_42FD00(aAngryReloader, 256);
  dword_4C302C = (int)sub_42FD00(aYouHateItWhenY, 256);
  perk_id_ion_gun_master = 51;
  dword_4C303C = (int)sub_42FD00(aIonGunMaster, 256);
  dword_4C3040 = (int)sub_42FD00(aYouReGoodWithI, 256);
  perk_id_stationary_reloader = 52;
  dword_4C3050 = (int)sub_42FD00(aStationaryRelo, 256);
  dword_4C3054 = (int)sub_42FD00(aItSIncrediblyH, 256);
  perk_id_man_bomb = 53;
  dword_4C3064 = (int)sub_42FD00(aManBomb, 256);
  dword_4C3068 = (int)sub_42FD00(aYouHaveTheAbil, 256);
  perk_id_fire_caugh = 54;
  dword_4C3078 = (int)sub_42FD00(aFireCaugh, 256);
  dword_4C307C = (int)sub_42FD00(aYouHaveAFireba, 256);
  perk_id_living_fortress = 55;
  dword_4C308C = (int)sub_42FD00(aLivingFortress, 256);
  dword_4C3090 = (int)sub_42FD00(aItComesATimeIn, 256);
  perk_id_tough_reloader = 56;
  dword_4C30A0 = (int)sub_42FD00(aToughReloader, 256);
  dword_4C30A4 = (int)sub_42FD00(aDamageReceived, 256);
  perk_id_lifeline_50_50 = 57;
  dword_4C30B4 = (int)sub_42FD00(aLifeline5050, 256);
  dword_4C30B8 = (int)sub_42FD00(aTheComputerRem, 256);
  dword_4C2C38 = 57;
  dword_4C2B8C = 58;
  perks_rebuild_available();
}

// quest_meta_init_entry @ 0x00430A20
// initializes a quest metadata entry (name copy, terrain ids, defaults) and updates quest_meta_cursor
int __cdecl sub_430A20(int a1, int a2, int a3, char *Source)
{
  int result; // eax
  int v5; // ecx

  if ( *(_DWORD *)(a1 + 12) )
  {
    crt_free(*(LPVOID *)(a1 + 12));
    console_printf((int)&console_log_queue, aQuestOverwritt);
  }
  *(_DWORD *)(a1 + 12) = strdup_malloc(Source);
  result = a2;
  *(_DWORD *)(a1 + 32) = perk_id_antiperk;
  v5 = 2 * a2 - 2;
  *(_DWORD *)(a1 + 36) = 0;
  *(_DWORD *)a1 = a2;
  *(_DWORD *)(a1 + 4) = a3;
  *(_DWORD *)(a1 + 16) = v5;
  if ( a3 <= 5 )
  {
    *(_DWORD *)(a1 + 20) = 2 * a2 - 1;
    *(_DWORD *)(a1 + 24) = v5;
  }
  else
  {
    *(_DWORD *)(a1 + 20) = v5;
    *(_DWORD *)(a1 + 24) = 2 * a2 - 1;
  }
  if ( a2 >= 5 )
  {
    *(_DWORD *)(a1 + 16) = a3 % 4;
    *(_DWORD *)(a1 + 20) = 1;
    *(_DWORD *)(a1 + 24) = 3;
    *(_DWORD *)(a1 + 28) = 5;
  }
  quest_meta_cursor = a1;
  return result;
}

// creature_spawn_slot_alloc @ 0x00430AD0
// returns first free spawn slot index (creature_spawn_slot_table[i].owner == NULL); returns 0x1f if none free
int creature_spawn_slot_alloc()
{
  int result; // eax
  int *v1; // ecx

  result = 0;
  v1 = creature_spawn_slot_table;
  while ( *v1 )
  {
    v1 += 6;
    ++result;
    if ( (int)v1 >= (int)&SubKey )
      return 31;
  }
  return result;
}

// creature_spawn_template @ 0x00430AF0
// spawns creature(s) from template id; heading -100 uses a random heading
void *creature_spawn_template(int template_id, float *pos, float heading)
{
  int v3; // ebp
  char *v5; // esi
  int v6; // ecx
  int v7; // eax
  long double v8; // st7
  int v9; // ecx
  int v10; // eax
  long double v11; // st7
  double v12; // st7
  int v13; // eax
  long double v14; // st7
  long double v15; // st7
  _DWORD *v16; // edx
  int v17; // eax
  int v18; // eax
  double v19; // st7
  int v21; // kr00_4
  double v22; // st7
  long double v23; // st7
  long double v24; // st7
  _DWORD *v25; // edx
  int v26; // eax
  double v27; // st7
  int v28; // eax
  double v29; // st7
  int v30; // eax
  double v31; // st7
  int v32; // eax
  double v33; // st7
  int v34; // ecx
  int v35; // eax
  double v36; // st7
  int v37; // eax
  char **v38; // eax
  int v39; // eax
  char **v40; // eax
  int v41; // eax
  char **v42; // eax
  int v43; // eax
  char **v44; // eax
  long double v45; // st7
  int v46; // eax
  char **v47; // eax
  int v48; // eax
  char **v49; // eax
  int v50; // eax
  char **v51; // eax
  int v52; // eax
  char **v53; // eax
  int v54; // eax
  double v55; // st7
  double v56; // st7
  int v57; // eax
  double v58; // st7
  double v59; // st7
  double v60; // st7
  int v61; // eax
  int v62; // eax
  double v63; // st7
  double v64; // st7
  int v65; // eax
  double v66; // st7
  double v67; // st7
  int v68; // eax
  int v69; // eax
  double v70; // st7
  int v71; // eax
  int v72; // eax
  double v73; // st7
  int v74; // eax
  int v75; // eax
  double v76; // st7
  int v77; // eax
  double v78; // st7
  int v79; // eax
  double v80; // st7
  int v81; // eax
  double v82; // st7
  int v83; // eax
  double v84; // st7
  int v85; // eax
  int v86; // eax
  double v87; // st7
  int v88; // eax
  double v89; // st7
  double v90; // st7
  double v91; // st7
  char *v92; // edx
  int v93; // eax
  char *v94; // edx
  double v95; // st7
  double v96; // st7
  int v97; // eax
  char **v98; // eax
  double v99; // st7
  double v100; // st7
  int v101; // [esp+10h] [ebp-48h]
  int i; // [esp+10h] [ebp-48h]
  int j; // [esp+10h] [ebp-48h]
  int k; // [esp+10h] [ebp-48h]
  int m; // [esp+10h] [ebp-48h]
  int n; // [esp+10h] [ebp-48h]
  int v107; // [esp+18h] [ebp-40h]
  float v108; // [esp+18h] [ebp-40h]
  float v109; // [esp+18h] [ebp-40h]
  float v110; // [esp+18h] [ebp-40h]
  float v111; // [esp+18h] [ebp-40h]
  float v112; // [esp+18h] [ebp-40h]
  float v113; // [esp+18h] [ebp-40h]
  float v114; // [esp+1Ch] [ebp-3Ch]
  float v115; // [esp+20h] [ebp-38h]
  float v116; // [esp+24h] [ebp-34h]
  float v117; // [esp+28h] [ebp-30h]
  float v118; // [esp+28h] [ebp-30h]
  float v119; // [esp+28h] [ebp-30h]
  float v120; // [esp+28h] [ebp-30h]
  float v121; // [esp+28h] [ebp-30h]
  float v122; // [esp+28h] [ebp-30h]
  float v123; // [esp+28h] [ebp-30h]
  float v124; // [esp+2Ch] [ebp-2Ch]
  float v125; // [esp+2Ch] [ebp-2Ch]
  float v126; // [esp+2Ch] [ebp-2Ch]
  float v127; // [esp+2Ch] [ebp-2Ch]
  float v128; // [esp+2Ch] [ebp-2Ch]
  float v129; // [esp+2Ch] [ebp-2Ch]
  float v130; // [esp+2Ch] [ebp-2Ch]
  float v131; // [esp+2Ch] [ebp-2Ch]
  float v132; // [esp+30h] [ebp-28h]
  float v133; // [esp+30h] [ebp-28h]
  float v134; // [esp+38h] [ebp-20h]
  float v135; // [esp+38h] [ebp-20h]
  float v136; // [esp+3Ch] [ebp-1Ch]
  float v137; // [esp+3Ch] [ebp-1Ch]
  float *posa; // [esp+60h] [ebp+8h]
  float *posb; // [esp+60h] [ebp+8h]
  int posc; // [esp+60h] [ebp+8h]
  int posd; // [esp+60h] [ebp+8h]
  int pose; // [esp+60h] [ebp+8h]
  int posf; // [esp+60h] [ebp+8h]
  int posg; // [esp+60h] [ebp+8h]
  int posh; // [esp+60h] [ebp+8h]
  int posi; // [esp+60h] [ebp+8h]
  float *posj; // [esp+60h] [ebp+8h]

  v3 = creature_alloc_slot();
  if ( heading == -100.0 )
    heading = (double)(crt_rand() % 628) * 0.0099999998;
  v107 = 38 * v3;
  v5 = &creature_pool[152 * v3];
  *((_DWORD *)v5 + 36) = 0;
  *((float *)v5 + 5) = *pos;
  v6 = *((_DWORD *)pos + 1);
  *((_DWORD *)v5 + 7) = 0;
  *((_DWORD *)v5 + 6) = v6;
  v5[9] = 0;
  *((_DWORD *)v5 + 3) = 0;
  *v5 = 1;
  v5[76] = 0;
  v5[8] = 1;
  *((_DWORD *)v5 + 4) = 1098907648;
  *((_DWORD *)v5 + 8) = 0;
  v7 = crt_rand();
  *((_DWORD *)v5 + 24) = 0;
  *((float *)v5 + 11) = (double)(v7 % 314) * 0.0099999998;
  if ( template_id == 18 )
  {
    *((_DWORD *)v5 + 15) = 1059481190;
    *((_DWORD *)v5 + 27) = 2;
    *((_DWORD *)v5 + 16) = 1062836634;
    *((_DWORD *)v5 + 9) = 1128792064;
    *((_DWORD *)v5 + 23) = 1074580685;
    *((_DWORD *)v5 + 17) = 1064849900;
    *((_DWORD *)v5 + 25) = 1142292480;
    *((_DWORD *)v5 + 13) = 1113325568;
    *((_DWORD *)v5 + 18) = 1065353216;
    *((_DWORD *)v5 + 22) = 1096810496;
    *((_DWORD *)v5 + 10) = 1128792064;
    for ( posa = 0; (int)posa < 8; posa = (float *)((char *)posa + 1) )
    {
      v8 = (double)(int)posa * 0.78539819;
      v5 = (char *)(152 * creature_alloc_slot() + 4833080);
      *((_DWORD *)v5 + 36) = 3;
      *((_DWORD *)v5 + 30) = v3;
      *((float *)v5 + 31) = cos(v8) * 100.0;
      *((float *)v5 + 32) = sin(v8) * 100.0;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 7) = 0;
      *((_DWORD *)v5 + 8) = 0;
      v5[9] = 0;
      *((_DWORD *)v5 + 15) = 1050924811;
      *((_DWORD *)v5 + 9) = 1109393408;
      *((_DWORD *)v5 + 10) = 1109393408;
      *((_DWORD *)v5 + 16) = 1058441004;
      *((_DWORD *)v5 + 17) = 1054481580;
      *((_DWORD *)v5 + 3) = 0;
      *v5 = 1;
      v5[8] = 1;
      *((_DWORD *)v5 + 4) = 1098907648;
      *((_DWORD *)v5 + 24) = 0;
      *((_DWORD *)v5 + 27) = 2;
      *((_DWORD *)v5 + 23) = 1075419546;
      *((_DWORD *)v5 + 25) = 1114636288;
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 13) = 1112014848;
      *((_DWORD *)v5 + 22) = 1082130432;
    }
    goto LABEL_15;
  }
  v9 = template_id;
  switch ( template_id )
  {
    case 25:
      *((_DWORD *)v5 + 15) = 1064514355;
      *((_DWORD *)v5 + 27) = 2;
      *((_DWORD *)v5 + 16) = 1057803469;
      *((_DWORD *)v5 + 9) = 1112014848;
      *((_DWORD *)v5 + 23) = 1081291571;
      *((_DWORD *)v5 + 17) = 1052602532;
      *((_DWORD *)v5 + 25) = 1133903872;
      *((_DWORD *)v5 + 13) = 1113325568;
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 22) = 1109393408;
      *((_DWORD *)v5 + 10) = 1112014848;
      for ( posb = 0; (int)posb < 5; posb = (float *)((char *)posb + 1) )
      {
        v10 = creature_alloc_slot();
        v11 = (double)(int)posb * 1.2566371;
        v5 = (char *)(152 * v10 + 4833080);
        *((_DWORD *)v5 + 36) = 5;
        *((_DWORD *)v5 + 30) = v3;
        *((float *)v5 + 31) = cos(v11) * 110.0;
        *((float *)v5 + 32) = sin(v11) * 110.0;
        v108 = creature_target_offset_x[38 * v10] + *pos;
        v12 = creature_target_offset_y[38 * v10] + pos[1];
        *((_DWORD *)v5 + 7) = 0;
        *((float *)v5 + 5) = v108;
        v114 = v12;
        *((_DWORD *)v5 + 8) = 0;
        *((float *)v5 + 6) = v114;
        *((_DWORD *)v5 + 9) = 1130102784;
        *((_DWORD *)v5 + 10) = 1130102784;
        *((_DWORD *)v5 + 15) = 1060529766;
        *((_DWORD *)v5 + 16) = 1054028596;
        v5[9] = 0;
        *((_DWORD *)v5 + 17) = 1049498747;
        *((_DWORD *)v5 + 3) = 0;
        *v5 = 1;
        v5[8] = 1;
        *((_DWORD *)v5 + 4) = 1098907648;
        *((_DWORD *)v5 + 24) = 0;
        *((_DWORD *)v5 + 27) = 2;
        *((_DWORD *)v5 + 23) = 1081291571;
        *((_DWORD *)v5 + 25) = 1114636288;
        *((_DWORD *)v5 + 18) = 1058642330;
        *((_DWORD *)v5 + 13) = 1112014848;
        *((_DWORD *)v5 + 22) = 1108082688;
      }
      break;
    case 17:
      *((_DWORD *)v5 + 27) = 1;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 36) = 1;
      *((_DWORD *)v5 + 15) = 1065185444;
      *((_DWORD *)v5 + 16) = 1065185444;
      *((_DWORD *)v5 + 9) = 1153138688;
      *((_DWORD *)v5 + 23) = 1074161254;
      *((_DWORD *)v5 + 17) = 1045891645;
      *((_DWORD *)v5 + 25) = 1148846080;
      *((_DWORD *)v5 + 13) = 1116340224;
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 22) = 1125515264;
      *((_DWORD *)v5 + 10) = 1153138688;
      v101 = 2;
      posc = -256;
      do
      {
        v13 = creature_alloc_slot();
        creature_target_offset_x[38 * v13] = (float)posc;
        v5 = (char *)(152 * v13 + 4833080);
        v14 = (double)v101 * 0.39269909;
        *((_DWORD *)v5 + 36) = 3;
        *((_DWORD *)v5 + 30) = v3;
        *((_DWORD *)v5 + 32) = -1015021568;
        v132 = cos(v14);
        v134 = v132 * 256.0;
        v115 = v134 + *pos;
        v15 = sin(v14) * 256.0 + pos[1];
        *((float *)v5 + 5) = v115;
        *((_DWORD *)v5 + 7) = 0;
        v16 = (_DWORD *)(152 * v13 + 4833140);
        v116 = v15;
        *v16 = 1058642330;
        *((float *)v5 + 6) = v116;
        v16[1] = 1058642330;
        *((_DWORD *)v5 + 8) = 0;
        v16[2] = 1050589266;
        *((_DWORD *)v5 + 9) = 1114636288;
        *((_DWORD *)v5 + 25) = 1114636288;
        *((_DWORD *)v5 + 10) = 1114636288;
        v16[3] = 1065353216;
        v5[9] = 0;
        *((_DWORD *)v5 + 3) = 0;
        *v5 = 1;
        v5[8] = 1;
        *((_DWORD *)v5 + 4) = 1098907648;
        *((_DWORD *)v5 + 24) = 0;
        *((_DWORD *)v5 + 27) = 1;
        *((_DWORD *)v5 + 23) = 1075419546;
        *((_DWORD *)v5 + 13) = 1112014848;
        *((_DWORD *)v5 + 22) = 1096810496;
        v3 = v13;
        posc += 64;
        v101 += 2;
      }
      while ( posc < 0 );
LABEL_14:
      creature_link_index[v107] = v13;
      break;
    case 19:
      *((_DWORD *)v5 + 27) = 2;
      v21 = terrain_texture_height;
      *((_DWORD *)v5 + 36) = 2;
      *((_DWORD *)v5 + 5) = -1054867456;
      v124 = (float)(v21 / 2);
      *((_DWORD *)v5 + 15) = 1058642330;
      *((float *)v5 + 6) = v124;
      *((_DWORD *)v5 + 16) = 1061997773;
      *((_DWORD *)v5 + 17) = 1063843267;
      *((_DWORD *)v5 + 9) = 1128792064;
      *((_DWORD *)v5 + 23) = 0x40000000;
      *((_DWORD *)v5 + 25) = 1142292480;
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 13) = 1109393408;
      *((_DWORD *)v5 + 22) = 1101004800;
      posd = 2;
      v136 = sin(0.0);
      v137 = v136 * 256.0;
      v117 = cos(0.0) * 256.0 + *pos;
      v22 = v137 + pos[1];
      *((_DWORD *)v5 + 10) = 1128792064;
      *((float *)v5 + 5) = v117;
      *((_DWORD *)v5 + 36) = 6;
      v125 = v22;
      *((float *)v5 + 6) = v125;
      do
      {
        v13 = creature_alloc_slot();
        v23 = (double)posd * 0.34906587;
        v5 = (char *)(152 * v13 + 4833080);
        *((_DWORD *)v5 + 36) = 6;
        *((_DWORD *)v5 + 30) = v3;
        *((_DWORD *)v5 + 33) = 1078530011;
        *((_DWORD *)v5 + 34) = 1092616192;
        v135 = cos(v23);
        v133 = v135 * 256.0;
        v118 = v133 + *pos;
        v24 = sin(v23) * 256.0 + pos[1];
        *((float *)v5 + 5) = v118;
        *((_DWORD *)v5 + 7) = 0;
        v126 = v24;
        *((_DWORD *)v5 + 9) = 1114636288;
        *((float *)v5 + 6) = v126;
        *((_DWORD *)v5 + 8) = 0;
        v25 = (_DWORD *)(152 * v13 + 4833140);
        *((_DWORD *)v5 + 25) = 1114636288;
        *((_DWORD *)v5 + 10) = 1114636288;
        *v25 = 1053609165;
        v25[1] = 1060320051;
        v5[9] = 0;
        v25[2] = 1038174126;
        *((_DWORD *)v5 + 3) = 0;
        *v5 = 1;
        v25[3] = 1065353216;
        v5[8] = 1;
        *((_DWORD *)v5 + 4) = 1098907648;
        *((_DWORD *)v5 + 24) = 0;
        *((_DWORD *)v5 + 27) = 2;
        *((_DWORD *)v5 + 23) = 0x40000000;
        *((_DWORD *)v5 + 13) = 1112014848;
        *((_DWORD *)v5 + 22) = 1082130432;
        v3 = v13;
        posd += 2;
      }
      while ( posd < 22 );
      goto LABEL_14;
    case 20:
      *((_DWORD *)v5 + 27) = 2;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 36) = 2;
      *((_DWORD *)v5 + 15) = 1060320051;
      *((_DWORD *)v5 + 16) = 1061997773;
      *((_DWORD *)v5 + 9) = 1153138688;
      *((_DWORD *)v5 + 23) = 0x40000000;
      *((_DWORD *)v5 + 17) = 1050589266;
      *((_DWORD *)v5 + 25) = 1142292480;
      *((_DWORD *)v5 + 13) = 1112014848;
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 22) = 1109393408;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 10) = 1153138688;
      for ( i = 0; i > -576; i -= 64 )
      {
        for ( pose = 128; pose <= 256; pose += 64 )
        {
          v26 = 19 * creature_alloc_slot();
          creature_target_offset_y[2 * v26] = (float)pose;
          v5 = (char *)(8 * v26 + 4833080);
          *((_DWORD *)v5 + 36) = 5;
          *((_DWORD *)v5 + 11) = 0;
          *((_DWORD *)v5 + 37) = 0;
          *((_DWORD *)v5 + 30) = v3;
          v109 = (float)i;
          *((float *)v5 + 31) = v109;
          v119 = *pos + creature_target_offset_x[2 * v26];
          v27 = creature_target_offset_y[2 * v26] + pos[1];
          *((_DWORD *)v5 + 7) = 0;
          *((float *)v5 + 5) = v119;
          v127 = v27;
          *((_DWORD *)v5 + 8) = 0;
          *((float *)v5 + 6) = v127;
          *((_DWORD *)v5 + 15) = 1053609165;
          *((_DWORD *)v5 + 9) = 1109393408;
          *((_DWORD *)v5 + 10) = 1109393408;
          *((_DWORD *)v5 + 16) = 1060320051;
          *((_DWORD *)v5 + 17) = 1038174126;
          v5[9] = 0;
          *((_DWORD *)v5 + 3) = 0;
          *v5 = 1;
          v5[8] = 1;
          *((_DWORD *)v5 + 4) = 1098907648;
          *((_DWORD *)v5 + 24) = 0;
          *((_DWORD *)v5 + 27) = 2;
          *((_DWORD *)v5 + 23) = 0x40000000;
          *((_DWORD *)v5 + 25) = 1114636288;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 13) = 1112014848;
          *((_DWORD *)v5 + 22) = 1082130432;
        }
      }
      break;
    case 21:
      *((_DWORD *)v5 + 27) = 2;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 36) = 2;
      *((_DWORD *)v5 + 15) = 1065353216;
      *((_DWORD *)v5 + 16) = 1065353216;
      *((_DWORD *)v5 + 9) = 1153138688;
      *((_DWORD *)v5 + 23) = 0x40000000;
      *((_DWORD *)v5 + 17) = 1065353216;
      *((_DWORD *)v5 + 25) = 1142292480;
      *((_DWORD *)v5 + 13) = 1114636288;
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 22) = 1109393408;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 10) = 1153138688;
      for ( j = 0; j > -576; j -= 64 )
      {
        for ( posf = 128; posf <= 256; posf += 64 )
        {
          v28 = creature_alloc_slot();
          creature_target_offset_y[38 * v28] = (float)posf;
          v5 = (char *)(152 * v28 + 4833080);
          *((_DWORD *)v5 + 36) = 4;
          *((_DWORD *)v5 + 11) = 0;
          *((_DWORD *)v5 + 37) = 0;
          *((_DWORD *)v5 + 30) = v3;
          v110 = (float)j;
          *((float *)v5 + 31) = v110;
          v120 = *pos + creature_target_offset_x[38 * v28];
          v29 = creature_target_offset_y[38 * v28] + pos[1];
          *((_DWORD *)v5 + 7) = 0;
          *((float *)v5 + 5) = v120;
          v128 = v29;
          *((_DWORD *)v5 + 8) = 0;
          *((float *)v5 + 6) = v128;
          *((_DWORD *)v5 + 9) = 1109393408;
          *((_DWORD *)v5 + 10) = 1109393408;
          *((_DWORD *)v5 + 15) = 1053609165;
          *((_DWORD *)v5 + 16) = 1060320051;
          v5[9] = 0;
          *((_DWORD *)v5 + 17) = 1038174126;
          *((_DWORD *)v5 + 3) = 0;
          *v5 = 1;
          v5[8] = 1;
          *((_DWORD *)v5 + 4) = 1098907648;
          *((_DWORD *)v5 + 24) = 0;
          *((_DWORD *)v5 + 27) = 2;
          *((_DWORD *)v5 + 23) = 0x40000000;
          *((_DWORD *)v5 + 25) = 1114636288;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 13) = 1112014848;
          *((_DWORD *)v5 + 22) = 1082130432;
        }
      }
      break;
    case 23:
      *((_DWORD *)v5 + 27) = 3;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 15) = 1065353216;
      *((_DWORD *)v5 + 16) = 1065353216;
      *((_DWORD *)v5 + 36) = 2;
      *((_DWORD *)v5 + 9) = 1153138688;
      *((_DWORD *)v5 + 17) = 1065353216;
      *((_DWORD *)v5 + 23) = 0x40000000;
      *((_DWORD *)v5 + 25) = 1142292480;
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 13) = 1114636288;
      *((_DWORD *)v5 + 22) = 1109393408;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 10) = 1153138688;
      for ( k = 0; k > -576; k -= 64 )
      {
        for ( posg = 128; posg <= 256; posg += 64 )
        {
          v30 = creature_alloc_slot();
          creature_target_offset_y[38 * v30] = (float)posg;
          v5 = (char *)(152 * v30 + 4833080);
          *((_DWORD *)v5 + 36) = 4;
          *((_DWORD *)v5 + 11) = 0;
          *((_DWORD *)v5 + 37) = 0;
          *((_DWORD *)v5 + 30) = v3;
          v111 = (float)k;
          *((float *)v5 + 31) = v111;
          v121 = creature_target_offset_x[38 * v30] + *pos;
          v31 = creature_target_offset_y[38 * v30] + pos[1];
          *((_DWORD *)v5 + 7) = 0;
          *((float *)v5 + 5) = v121;
          v129 = v31;
          *((_DWORD *)v5 + 8) = 0;
          *((float *)v5 + 6) = v129;
          *((_DWORD *)v5 + 9) = 1109393408;
          *((_DWORD *)v5 + 10) = 1109393408;
          *((_DWORD *)v5 + 15) = 1053609165;
          *((_DWORD *)v5 + 16) = 1060320051;
          v5[9] = 0;
          *((_DWORD *)v5 + 17) = 1038174126;
          *((_DWORD *)v5 + 3) = 0;
          *v5 = 1;
          v5[8] = 1;
          *((_DWORD *)v5 + 4) = 1098907648;
          *((_DWORD *)v5 + 24) = 0;
          *((_DWORD *)v5 + 27) = 3;
          *((_DWORD *)v5 + 23) = 0x40000000;
          *((_DWORD *)v5 + 25) = 1114636288;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 13) = 1112014848;
          *((_DWORD *)v5 + 22) = 1082130432;
        }
      }
      break;
    case 22:
      *((_DWORD *)v5 + 27) = 1;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 15) = 1065353216;
      *((_DWORD *)v5 + 16) = 1065353216;
      *((_DWORD *)v5 + 36) = 2;
      *((_DWORD *)v5 + 9) = 1153138688;
      *((_DWORD *)v5 + 17) = 1065353216;
      *((_DWORD *)v5 + 23) = 0x40000000;
      *((_DWORD *)v5 + 25) = 1142292480;
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 13) = 1115684864;
      *((_DWORD *)v5 + 22) = 1109393408;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 10) = 1153138688;
      for ( m = 0; m > -576; m -= 64 )
      {
        for ( posh = 128; posh <= 256; posh += 64 )
        {
          v32 = creature_alloc_slot();
          creature_target_offset_y[38 * v32] = (float)posh;
          v5 = (char *)(152 * v32 + 4833080);
          *((_DWORD *)v5 + 36) = 4;
          *((_DWORD *)v5 + 11) = 0;
          *((_DWORD *)v5 + 37) = 0;
          *((_DWORD *)v5 + 30) = v3;
          v112 = (float)m;
          *((float *)v5 + 31) = v112;
          v122 = creature_target_offset_x[38 * v32] + *pos;
          v33 = creature_target_offset_y[38 * v32] + pos[1];
          *((_DWORD *)v5 + 7) = 0;
          *((float *)v5 + 5) = v122;
          v130 = v33;
          *((_DWORD *)v5 + 8) = 0;
          *((float *)v5 + 6) = v130;
          *((_DWORD *)v5 + 9) = 1109393408;
          *((_DWORD *)v5 + 10) = 1109393408;
          *((_DWORD *)v5 + 15) = 1053609165;
          *((_DWORD *)v5 + 16) = 1060320051;
          v5[9] = 0;
          *((_DWORD *)v5 + 17) = 1038174126;
          *((_DWORD *)v5 + 3) = 0;
          *v5 = 1;
          v5[8] = 1;
          *((_DWORD *)v5 + 4) = 1098907648;
          *((_DWORD *)v5 + 24) = 0;
          *((_DWORD *)v5 + 27) = 1;
          *((_DWORD *)v5 + 23) = 0x40000000;
          *((_DWORD *)v5 + 25) = 1114636288;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 13) = 1114636288;
          *((_DWORD *)v5 + 22) = 1082130432;
        }
      }
      break;
    case 15:
      *((_DWORD *)v5 + 27) = 2;
      *((float *)v5 + 5) = *pos;
      *((float *)v5 + 6) = pos[1];
      *((_DWORD *)v5 + 27) = 2;
      *((_DWORD *)v5 + 15) = 1059732848;
      *((_DWORD *)v5 + 16) = 1053105848;
      *((_DWORD *)v5 + 36) = 0;
      *((_DWORD *)v5 + 9) = 1101004800;
      *((_DWORD *)v5 + 17) = 1048877990;
      *((_DWORD *)v5 + 23) = 1077516698;
      *((_DWORD *)v5 + 25) = 1114636288;
      *((_DWORD *)v5 + 18) = 1057971241;
      *((_DWORD *)v5 + 13) = 1112014848;
      *((_DWORD *)v5 + 22) = 1108082688;
      *((_DWORD *)v5 + 10) = 1101004800;
      break;
    default:
      switch ( template_id )
      {
        case 24:
          *((_DWORD *)v5 + 27) = 2;
          *((float *)v5 + 5) = *pos;
          v34 = *((_DWORD *)pos + 1);
          *((_DWORD *)v5 + 36) = 2;
          *((_DWORD *)v5 + 15) = 1060320051;
          *((_DWORD *)v5 + 6) = v34;
          *((_DWORD *)v5 + 16) = 1061997773;
          *((_DWORD *)v5 + 9) = 1140457472;
          *((_DWORD *)v5 + 23) = 0x40000000;
          *((_DWORD *)v5 + 17) = 1050589266;
          *((_DWORD *)v5 + 25) = 1142292480;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 13) = 1109393408;
          *((_DWORD *)v5 + 22) = 1109393408;
          *((float *)v5 + 5) = *pos;
          *((float *)v5 + 6) = pos[1];
          *((_DWORD *)v5 + 10) = 1140457472;
          for ( n = 0; n > -576; n -= 64 )
          {
            for ( posi = 128; posi <= 256; posi += 64 )
            {
              v35 = creature_alloc_slot();
              creature_target_offset_y[38 * v35] = (float)posi;
              v5 = (char *)(152 * v35 + 4833080);
              *((_DWORD *)v5 + 36) = 3;
              *((_DWORD *)v5 + 11) = 0;
              *((_DWORD *)v5 + 37) = 0;
              *((_DWORD *)v5 + 30) = v3;
              v113 = (float)n;
              *((float *)v5 + 31) = v113;
              v123 = creature_target_offset_x[38 * v35] + *pos;
              v36 = creature_target_offset_y[38 * v35] + pos[1];
              *((_DWORD *)v5 + 7) = 0;
              *((float *)v5 + 5) = v123;
              v131 = v36;
              *((_DWORD *)v5 + 8) = 0;
              *((float *)v5 + 6) = v131;
              *((_DWORD *)v5 + 9) = 1132593152;
              *((_DWORD *)v5 + 10) = 1132593152;
              *((_DWORD *)v5 + 15) = 1060529766;
              *((_DWORD *)v5 + 16) = 1054028596;
              v5[9] = 0;
              *((_DWORD *)v5 + 17) = 1049498747;
              *((_DWORD *)v5 + 3) = 0;
              *v5 = 1;
              v5[8] = 1;
              *((_DWORD *)v5 + 4) = 1098907648;
              *((_DWORD *)v5 + 24) = 0;
              *((_DWORD *)v5 + 27) = 2;
              *((_DWORD *)v5 + 23) = 1081291571;
              *((_DWORD *)v5 + 25) = 1114636288;
              *((_DWORD *)v5 + 18) = 1058642330;
              *((_DWORD *)v5 + 13) = 1112014848;
              *((_DWORD *)v5 + 22) = 1108082688;
            }
          }
          goto LABEL_16;
        case 1:
          *((_DWORD *)v5 + 27) = 4;
          *((_DWORD *)v5 + 35) = 8;
          *((_DWORD *)v5 + 13) = 1117782016;
          *((_DWORD *)v5 + 9) = 1137180672;
          *((_DWORD *)v5 + 23) = 0x40000000;
          *((_DWORD *)v5 + 25) = 1148846080;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 15) = 1061997773;
          *((_DWORD *)v5 + 16) = 1060320051;
          *((_DWORD *)v5 + 17) = 1053609165;
          *((_DWORD *)v5 + 22) = 1099431936;
          goto LABEL_17;
        case 10:
          *((_DWORD *)v5 + 27) = 2;
          *((_DWORD *)v5 + 35) = 4;
          v37 = creature_spawn_slot_alloc();
          *((_DWORD *)v5 + 30) = v37;
          v38 = (char **)(24 * v37 + 4739024);
          v38[4] = (char *)0x40000000;
          v38[1] = 0;
          v38[2] = (char *)100;
          v38[3] = (char *)1084227584;
          v38[5] = (char *)50;
          *v38 = v5;
          *((_DWORD *)v5 + 13) = 1113325568;
          *((_DWORD *)v5 + 9) = 1148846080;
          *((_DWORD *)v5 + 23) = 1069547520;
          *((_DWORD *)v5 + 25) = 1161527296;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 15) = 1061997773;
          *((_DWORD *)v5 + 16) = 1060320051;
          *((_DWORD *)v5 + 17) = 1053609165;
          *((_DWORD *)v5 + 22) = 0;
          goto LABEL_16;
        case 11:
          *((_DWORD *)v5 + 27) = 2;
          *((_DWORD *)v5 + 35) = 4;
          v39 = creature_spawn_slot_alloc();
          *((_DWORD *)v5 + 30) = v39;
          v40 = (char **)(24 * v39 + 4739024);
          v40[4] = (char *)0x40000000;
          v40[1] = 0;
          v40[2] = (char *)100;
          v40[3] = (char *)1086324736;
          v40[5] = (char *)60;
          *v40 = v5;
          *((_DWORD *)v5 + 13) = 1115815936;
          *((_DWORD *)v5 + 9) = 1163575296;
          *((_DWORD *)v5 + 23) = 1069547520;
          *((_DWORD *)v5 + 25) = 1167867904;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 15) = 1063675494;
          *((_DWORD *)v5 + 16) = 1036831949;
          *((_DWORD *)v5 + 17) = 1036831949;
          *((_DWORD *)v5 + 22) = 0;
          goto LABEL_16;
        case 16:
          *((_DWORD *)v5 + 27) = 2;
          *((_DWORD *)v5 + 35) = 4;
          v41 = creature_spawn_slot_alloc();
          *((_DWORD *)v5 + 30) = v41;
          v42 = (char **)(24 * v41 + 4739024);
          v42[4] = (char *)1069547520;
          v42[1] = 0;
          v42[2] = (char *)100;
          v42[3] = (char *)1075000115;
          v42[5] = (char *)50;
          *v42 = v5;
          *((_DWORD *)v5 + 13) = 1107296256;
          *((_DWORD *)v5 + 9) = 1112014848;
          *((_DWORD *)v5 + 23) = 1077097267;
          *((_DWORD *)v5 + 25) = 1145569280;
          break;
        case 14:
          *((_DWORD *)v5 + 27) = 2;
          *((_DWORD *)v5 + 35) = 4;
          v43 = creature_spawn_slot_alloc();
          *((_DWORD *)v5 + 30) = v43;
          posj = 0;
          v44 = (char **)(24 * v43 + 4739024);
          v44[4] = (char *)1069547520;
          v44[1] = 0;
          v44[2] = (char *)64;
          v44[3] = (char *)1065772646;
          v44[5] = (char *)28;
          *v44 = v5;
          *((_DWORD *)v5 + 13) = 1107296256;
          *((_DWORD *)v5 + 9) = 1112014848;
          *((_DWORD *)v5 + 23) = 1077097267;
          *((_DWORD *)v5 + 25) = 1167867904;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 15) = 1063675494;
          *((_DWORD *)v5 + 16) = 1061997773;
          *((_DWORD *)v5 + 17) = 1053609165;
          *((_DWORD *)v5 + 22) = 0;
          do
          {
            v45 = (double)(int)posj * 0.2617994;
            v5 = (char *)(152 * creature_alloc_slot() + 4833080);
            *((_DWORD *)v5 + 36) = 3;
            *((_DWORD *)v5 + 11) = 0;
            *((_DWORD *)v5 + 37) = 0;
            *((_DWORD *)v5 + 30) = v3;
            *((float *)v5 + 31) = cos(v45) * 100.0;
            *((float *)v5 + 32) = sin(v45) * 100.0;
            *((float *)v5 + 5) = *pos;
            *((float *)v5 + 6) = pos[1];
            *((_DWORD *)v5 + 7) = 0;
            *((_DWORD *)v5 + 8) = 0;
            v5[9] = 0;
            *((_DWORD *)v5 + 15) = 1065353216;
            *((_DWORD *)v5 + 9) = 1109393408;
            *((_DWORD *)v5 + 10) = 1109393408;
            *((_DWORD *)v5 + 16) = 1050253722;
            *((_DWORD *)v5 + 17) = 1050253722;
            *((_DWORD *)v5 + 3) = 0;
            *v5 = 1;
            v5[8] = 1;
            *((_DWORD *)v5 + 4) = 1098907648;
            *((_DWORD *)v5 + 24) = 0;
            *((_DWORD *)v5 + 27) = 2;
            *((_DWORD *)v5 + 23) = 1082130432;
            *((_DWORD *)v5 + 25) = 1135542272;
            *((_DWORD *)v5 + 18) = 1065353216;
            *((_DWORD *)v5 + 13) = 1108082688;
            *((_DWORD *)v5 + 22) = 1106247680;
            posj = (float *)((char *)posj + 1);
          }
          while ( (int)posj < 24 );
          goto LABEL_16;
        case 12:
          *((_DWORD *)v5 + 27) = 2;
          *((_DWORD *)v5 + 35) = 4;
          v46 = creature_spawn_slot_alloc();
          *((_DWORD *)v5 + 30) = v46;
          v47 = (char **)(24 * v46 + 4739024);
          v47[4] = (char *)1069547520;
          v47[1] = 0;
          v47[2] = (char *)100;
          v47[3] = (char *)0x40000000;
          v47[5] = (char *)49;
          *v47 = v5;
          *((_DWORD *)v5 + 13) = 1107296256;
          *((_DWORD *)v5 + 9) = 1112014848;
          *((_DWORD *)v5 + 23) = 1077097267;
          *((_DWORD *)v5 + 25) = 1148846080;
          break;
        case 13:
          *((_DWORD *)v5 + 27) = 2;
          *((_DWORD *)v5 + 35) = 4;
          v48 = creature_spawn_slot_alloc();
          *((_DWORD *)v5 + 30) = v48;
          v49 = (char **)(24 * v48 + 4739024);
          v49[4] = (char *)0x40000000;
          v49[1] = 0;
          v49[2] = (char *)100;
          v49[3] = (char *)1086324736;
          v49[5] = (char *)49;
          *v49 = v5;
          *((_DWORD *)v5 + 13) = 1107296256;
          *((_DWORD *)v5 + 9) = 1112014848;
          *((_DWORD *)v5 + 23) = 1067869798;
          *((_DWORD *)v5 + 25) = 1148846080;
          break;
        default:
          switch ( template_id )
          {
            case 9:
              *((_DWORD *)v5 + 27) = 2;
              *((_DWORD *)v5 + 35) = 4;
              v50 = creature_spawn_slot_alloc();
              *((_DWORD *)v5 + 30) = v50;
              v51 = (char **)(24 * v50 + 4739024);
              v51[4] = (char *)1065353216;
              v51[1] = 0;
              v51[2] = (char *)16;
              v51[3] = (char *)0x40000000;
              v51[5] = (char *)29;
              *v51 = v5;
              *((_DWORD *)v5 + 13) = 1109393408;
              *((_DWORD *)v5 + 9) = 1138819072;
              *((_DWORD *)v5 + 23) = 0x40000000;
              *((_DWORD *)v5 + 25) = 1148846080;
              *((_DWORD *)v5 + 18) = 1065353216;
              *((_DWORD *)v5 + 15) = 1065353216;
              *((_DWORD *)v5 + 16) = 1065353216;
              *((_DWORD *)v5 + 17) = 1065353216;
              *((_DWORD *)v5 + 22) = 0;
              goto LABEL_16;
            case 7:
              *((_DWORD *)v5 + 27) = 2;
              *((_DWORD *)v5 + 35) = 4;
              v52 = creature_spawn_slot_alloc();
              *((_DWORD *)v5 + 30) = v52;
              v53 = (char **)(24 * v52 + 4739024);
              v53[4] = (char *)1065353216;
              v53[1] = 0;
              v53[2] = (char *)100;
              v53[3] = (char *)1074580685;
              break;
            case 8:
              *((_DWORD *)v5 + 27) = 2;
              *((_DWORD *)v5 + 35) = 4;
              v54 = creature_spawn_slot_alloc();
              *((_DWORD *)v5 + 30) = v54;
              v53 = (char **)(24 * v54 + 4739024);
              v53[4] = (char *)1065353216;
              v53[1] = 0;
              v53[2] = (char *)100;
              v53[3] = (char *)1077097267;
              break;
            default:
              switch ( template_id )
              {
                case 26:
                  *((_DWORD *)v5 + 27) = 2;
                  *((_DWORD *)v5 + 13) = 1112014848;
                  *((_DWORD *)v5 + 36) = 1;
                  *((_DWORD *)v5 + 9) = 1112014848;
                  *((_DWORD *)v5 + 23) = 1075419546;
                  *((_DWORD *)v5 + 25) = 1123680256;
                  *((_DWORD *)v5 + 18) = 1065353216;
                  v55 = (double)(crt_rand() % 40);
                  break;
                case 27:
                  *((_DWORD *)v5 + 27) = 3;
                  *((_DWORD *)v5 + 13) = 1112014848;
                  *((_DWORD *)v5 + 36) = 1;
                  *((_DWORD *)v5 + 9) = 1109393408;
                  *((_DWORD *)v5 + 23) = 1075419546;
                  *((_DWORD *)v5 + 25) = 1123680256;
                  *((_DWORD *)v5 + 18) = 1065353216;
                  v55 = (double)(crt_rand() % 40);
                  break;
                case 28:
                  *((_DWORD *)v5 + 27) = 1;
                  *((_DWORD *)v5 + 13) = 1112014848;
                  *((_DWORD *)v5 + 36) = 1;
                  *((_DWORD *)v5 + 9) = 1112014848;
                  *((_DWORD *)v5 + 23) = 1075419546;
                  *((_DWORD *)v5 + 25) = 1123680256;
                  *((_DWORD *)v5 + 18) = 1065353216;
                  v55 = (double)(crt_rand() % 40);
                  break;
                default:
                  switch ( template_id )
                  {
                    case 'A':
                      *((_DWORD *)v5 + 27) = 0;
                      v57 = crt_rand();
                      *((_DWORD *)v5 + 18) = 1065353216;
                      v58 = (double)(v57 % 30 + 40);
                      *((float *)v5 + 13) = v58;
                      *((float *)v5 + 9) = v58 * 1.1428572 + 10.0;
                      *((float *)v5 + 23) = v58 * 0.0024999999 + 0.89999998;
                      *((float *)v5 + 25) = v58 + v58 + 50.0;
                      v59 = (double)(crt_rand() % 40) * 0.0099999998 + 0.60000002;
                      *((float *)v5 + 15) = v59;
                      *((float *)v5 + 16) = v59;
                      *((float *)v5 + 17) = v59;
                      *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                      goto LABEL_16;
                    case '1':
                      *((_DWORD *)v5 + 27) = 1;
                      v60 = (double)(crt_rand() % 30 + 40);
                      *((float *)v5 + 13) = v60;
                      *((float *)v5 + 9) = v60 * 1.1428572 + 10.0;
                      v61 = crt_rand();
                      *((_DWORD *)v5 + 18) = 1065353216;
                      *((float *)v5 + 23) = (double)(v61 % 18) * 0.1 + 1.1;
                      *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                      v62 = crt_rand();
                      *((_DWORD *)v5 + 17) = 1052938076;
                      v63 = (double)(v62 % 30) * 0.0099999998 + 0.60000002;
                      *((float *)v5 + 15) = v63;
                      *((float *)v5 + 16) = v63;
                      break;
                    case '2':
                      *((_DWORD *)v5 + 27) = 3;
                      v64 = (double)(crt_rand() % 25 + 40);
                      *((float *)v5 + 13) = v64;
                      *((float *)v5 + 9) = v64 + 10.0;
                      v65 = crt_rand();
                      *((_DWORD *)v5 + 18) = 1065353216;
                      *((float *)v5 + 23) = (double)(v65 % 17) * 0.1 + 1.1;
                      *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                      v66 = (double)(crt_rand() % 40) * 0.0099999998 + 0.60000002;
                      *((float *)v5 + 15) = v66;
                      *((float *)v5 + 16) = v66;
                      *((float *)v5 + 17) = v66;
                      break;
                    default:
                      switch ( template_id )
                      {
                        case 51:
                          *((_DWORD *)v5 + 27) = 3;
                          v67 = (double)(crt_rand() % 15 + 45);
                          *((float *)v5 + 13) = v67;
                          *((float *)v5 + 9) = v67 * 1.1428572 + 20.0;
                          v68 = crt_rand();
                          *((_DWORD *)v5 + 18) = 1065353216;
                          *((float *)v5 + 23) = (double)(v68 % 18) * 0.1 + 1.1;
                          *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                          v69 = crt_rand();
                          *((_DWORD *)v5 + 16) = 1056964608;
                          *((_DWORD *)v5 + 17) = 1056964608;
                          *((float *)v5 + 15) = (double)(v69 % 40) * 0.0099999998 + 0.60000002;
                          *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                          goto LABEL_16;
                        case 52:
                          *((_DWORD *)v5 + 27) = 3;
                          v70 = (double)(crt_rand() % 20 + 40);
                          *((float *)v5 + 13) = v70;
                          *((float *)v5 + 9) = v70 * 1.1428572 + 20.0;
                          v71 = crt_rand();
                          *((_DWORD *)v5 + 18) = 1065353216;
                          *((float *)v5 + 23) = (double)(v71 % 18) * 0.1 + 1.1;
                          *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                          v72 = crt_rand();
                          *((_DWORD *)v5 + 15) = 1056964608;
                          *((_DWORD *)v5 + 17) = 1056964608;
                          *((float *)v5 + 16) = (double)(v72 % 40) * 0.0099999998 + 0.60000002;
                          *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                          goto LABEL_16;
                        case 32:
                          *((_DWORD *)v5 + 27) = 2;
                          v73 = (double)(crt_rand() % 30 + 40);
                          *((float *)v5 + 13) = v73;
                          *((float *)v5 + 9) = v73 * 1.1428572 + 20.0;
                          v74 = crt_rand();
                          *((_DWORD *)v5 + 18) = 1065353216;
                          *((_DWORD *)v5 + 15) = 1050253722;
                          *((float *)v5 + 23) = (double)(v74 % 18) * 0.1 + 1.1;
                          *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                          v75 = crt_rand();
                          *((_DWORD *)v5 + 17) = 1050253722;
                          *((float *)v5 + 16) = (double)(v75 % 40) * 0.0099999998 + 0.60000002;
                          *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                          goto LABEL_16;
                        case 3:
                          *((_DWORD *)v5 + 27) = 3;
                          v76 = (double)(crt_rand() % 15 + 38);
                          *((float *)v5 + 13) = v76;
                          *((float *)v5 + 9) = v76 * 1.1428572 + 20.0;
                          v77 = crt_rand();
                          *((_DWORD *)v5 + 18) = 1065353216;
                          *((_DWORD *)v5 + 15) = 1058642330;
                          *((_DWORD *)v5 + 16) = 1058642330;
                          *((float *)v5 + 23) = (double)(v77 % 18) * 0.1 + 1.1;
                          *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                          *((float *)v5 + 17) = (double)(crt_rand() % 25) * 0.0099999998 + 0.80000001;
                          if ( *((float *)v5 + 15) >= 0.0 )
                          {
                            if ( *((float *)v5 + 15) > 1.0 )
                              *((_DWORD *)v5 + 15) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 15) = 0;
                          }
                          if ( *((float *)v5 + 16) >= 0.0 )
                          {
                            if ( *((float *)v5 + 16) > 1.0 )
                              *((_DWORD *)v5 + 16) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 16) = 0;
                          }
                          if ( *((float *)v5 + 17) >= 0.0 )
                          {
                            if ( *((float *)v5 + 17) > 1.0 )
                              *((_DWORD *)v5 + 17) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 17) = 0;
                          }
                          if ( *((float *)v5 + 18) >= 0.0 )
                          {
                            if ( *((float *)v5 + 18) > 1.0 )
                              *((_DWORD *)v5 + 18) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 18) = 0;
                          }
                          break;
                        case 5:
                          *((_DWORD *)v5 + 27) = 4;
                          v78 = (double)(crt_rand() % 15 + 38);
                          *((float *)v5 + 13) = v78;
                          *((float *)v5 + 9) = v78 * 1.1428572 + 20.0;
                          v79 = crt_rand();
                          *((_DWORD *)v5 + 18) = 1065353216;
                          *((_DWORD *)v5 + 15) = 1058642330;
                          *((_DWORD *)v5 + 16) = 1058642330;
                          *((float *)v5 + 23) = (double)(v79 % 18) * 0.1 + 1.1;
                          *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                          *((float *)v5 + 17) = (double)(crt_rand() % 25) * 0.0099999998 + 0.80000001;
                          if ( *((float *)v5 + 15) >= 0.0 )
                          {
                            if ( *((float *)v5 + 15) > 1.0 )
                              *((_DWORD *)v5 + 15) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 15) = 0;
                          }
                          if ( *((float *)v5 + 16) >= 0.0 )
                          {
                            if ( *((float *)v5 + 16) > 1.0 )
                              *((_DWORD *)v5 + 16) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 16) = 0;
                          }
                          if ( *((float *)v5 + 17) >= 0.0 )
                          {
                            if ( *((float *)v5 + 17) > 1.0 )
                              *((_DWORD *)v5 + 17) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 17) = 0;
                          }
                          if ( *((float *)v5 + 18) >= 0.0 )
                          {
                            if ( *((float *)v5 + 18) > 1.0 )
                              *((_DWORD *)v5 + 18) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 18) = 0;
                          }
                          break;
                        case 4:
                          *((_DWORD *)v5 + 27) = 1;
                          v80 = (double)(crt_rand() % 15 + 38);
                          *((float *)v5 + 13) = v80;
                          *((float *)v5 + 9) = v80 * 1.1428572 + 20.0;
                          v81 = crt_rand();
                          *((_DWORD *)v5 + 18) = 1065353216;
                          *((_DWORD *)v5 + 15) = 1059816735;
                          *((_DWORD *)v5 + 16) = 1059816735;
                          *((_DWORD *)v5 + 17) = 1065353216;
                          *((float *)v5 + 23) = (double)(v81 % 18) * 0.1 + 1.1;
                          *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                          *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                          goto LABEL_16;
                        case 6:
                          *((_DWORD *)v5 + 27) = 2;
                          v82 = (double)(crt_rand() % 15 + 38);
                          *((float *)v5 + 13) = v82;
                          *((float *)v5 + 9) = v82 * 1.1428572 + 20.0;
                          v83 = crt_rand();
                          *((_DWORD *)v5 + 18) = 1065353216;
                          *((_DWORD *)v5 + 15) = 1058642330;
                          *((_DWORD *)v5 + 16) = 1058642330;
                          *((float *)v5 + 23) = (double)(v83 % 18) * 0.1 + 1.1;
                          *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                          *((float *)v5 + 17) = (double)(crt_rand() % 25) * 0.0099999998 + 0.80000001;
                          if ( *((float *)v5 + 15) >= 0.0 )
                          {
                            if ( *((float *)v5 + 15) > 1.0 )
                              *((_DWORD *)v5 + 15) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 15) = 0;
                          }
                          if ( *((float *)v5 + 16) >= 0.0 )
                          {
                            if ( *((float *)v5 + 16) > 1.0 )
                              *((_DWORD *)v5 + 16) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 16) = 0;
                          }
                          if ( *((float *)v5 + 17) >= 0.0 )
                          {
                            if ( *((float *)v5 + 17) > 1.0 )
                              *((_DWORD *)v5 + 17) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 17) = 0;
                          }
                          if ( *((float *)v5 + 18) >= 0.0 )
                          {
                            if ( *((float *)v5 + 18) > 1.0 )
                              *((_DWORD *)v5 + 18) = 1065353216;
                          }
                          else
                          {
                            *((_DWORD *)v5 + 18) = 0;
                          }
                          break;
                        default:
                          switch ( template_id )
                          {
                            case 53:
                              *((_DWORD *)v5 + 27) = 4;
                              v84 = (double)(crt_rand() % 10 + 30);
                              *((float *)v5 + 13) = v84;
                              *((float *)v5 + 9) = v84 * 1.1428572 + 20.0;
                              v85 = crt_rand();
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((_DWORD *)v5 + 17) = 1061997773;
                              *((float *)v5 + 23) = (double)(v85 % 18) * 0.1 + 1.1;
                              *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                              v86 = crt_rand();
                              *((_DWORD *)v5 + 15) = 1061997773;
                              *((float *)v5 + 16) = (double)(v86 % 20) * 0.0099999998 + 0.80000001;
                              *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                              goto LABEL_16;
                            case 46:
                              *((_DWORD *)v5 + 27) = 1;
                              v87 = (double)(crt_rand() % 30 + 40);
                              *((float *)v5 + 13) = v87;
                              *((float *)v5 + 9) = v87 * 1.1428572 + 20.0;
                              v88 = crt_rand();
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((float *)v5 + 23) = (double)(v88 % 18) * 0.1 + 1.1;
                              *((float *)v5 + 25) = *((float *)v5 + 13) + *((float *)v5 + 13) + 50.0;
                              *((float *)v5 + 15) = (double)(crt_rand() % 40) * 0.0099999998 + 0.60000002;
                              *((float *)v5 + 16) = (double)(crt_rand() % 40) * 0.0099999998 + 0.60000002;
                              *((float *)v5 + 17) = (double)(crt_rand() % 40) * 0.0099999998 + 0.60000002;
                              *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                              goto LABEL_16;
                            case 54:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 13) = 1112014848;
                              *((_DWORD *)v5 + 36) = 7;
                              *((_DWORD *)v5 + 34) = 1069547520;
                              *((_DWORD *)v5 + 9) = 1092616192;
                              *((_DWORD *)v5 + 23) = 1072064102;
                              *((_DWORD *)v5 + 25) = 1125515264;
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((float *)v5 + 16) = (double)(crt_rand() % 5) * 0.0099999998 + 0.64999998;
                              *((_DWORD *)v5 + 15) = 1059481190;
                              *((_DWORD *)v5 + 17) = 1064514355;
                              *((_DWORD *)v5 + 22) = 1109393408;
                              goto LABEL_16;
                            case 29:
                              *((_DWORD *)v5 + 27) = 2;
                              v89 = (double)(crt_rand() % 20 + 35);
                              *((float *)v5 + 13) = v89;
                              *((float *)v5 + 9) = v89 * 1.1428572 + 10.0;
                              *((float *)v5 + 23) = (double)(crt_rand() % 15) * 0.1 + 1.1;
                              *((float *)v5 + 25) = (float)(crt_rand() % 100 + 50);
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((float *)v5 + 15) = (double)(crt_rand() % 50) * 0.001 + 0.60000002;
                              *((float *)v5 + 16) = (double)(crt_rand() % 50) * 0.0099999998 + 0.5;
                              *((float *)v5 + 17) = (double)(crt_rand() % 50) * 0.001 + 0.60000002;
                              *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                              goto LABEL_16;
                            case 30:
                              *((_DWORD *)v5 + 27) = 2;
                              v90 = (double)(crt_rand() % 30 + 35);
                              *((float *)v5 + 13) = v90;
                              *((float *)v5 + 9) = v90 * 2.2857144 + 10.0;
                              *((float *)v5 + 23) = (double)(crt_rand() % 17) * 0.1 + 1.5;
                              *((float *)v5 + 25) = (float)(crt_rand() % 200 + 50);
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((float *)v5 + 15) = (double)(crt_rand() % 50) * 0.001 + 0.60000002;
                              *((float *)v5 + 16) = (double)(crt_rand() % 50) * 0.001 + 0.60000002;
                              *((float *)v5 + 17) = (double)(crt_rand() % 50) * 0.0099999998 + 0.5;
                              *((float *)v5 + 22) = (double)(crt_rand() % 30) + 4.0;
                              goto LABEL_16;
                            case 31:
                              *((_DWORD *)v5 + 27) = 2;
                              v91 = (double)(crt_rand() % 30 + 45);
                              *((float *)v5 + 13) = v91;
                              *((float *)v5 + 9) = v91 * 3.7142856 + 30.0;
                              *((float *)v5 + 23) = (double)(crt_rand() % 21) * 0.1 + 1.6;
                              *((float *)v5 + 25) = (float)(crt_rand() % 200 + 80);
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((float *)v5 + 15) = (double)(crt_rand() % 50) * 0.0099999998 + 0.5;
                              *((float *)v5 + 16) = (double)(crt_rand() % 50) * 0.001 + 0.60000002;
                              *((float *)v5 + 17) = (double)(crt_rand() % 50) * 0.001 + 0.60000002;
                              *((float *)v5 + 22) = (double)(crt_rand() % 35) + 8.0;
                              goto LABEL_16;
                            case 36:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 9) = 1101004800;
                              *((_DWORD *)v5 + 23) = 0x40000000;
                              *((_DWORD *)v5 + 25) = 1121714176;
                              *((_DWORD *)v5 + 15) = 1036831949;
                              *((_DWORD *)v5 + 16) = 1060320051;
                              *((_DWORD *)v5 + 17) = 1038174126;
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((_DWORD *)v5 + 13) = 1112014848;
                              *((_DWORD *)v5 + 22) = 1082130432;
                              goto LABEL_17;
                            case 37:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 9) = 1103626240;
                              *((_DWORD *)v5 + 23) = 1075838976;
                              *((_DWORD *)v5 + 25) = 1123680256;
                              *((_DWORD *)v5 + 15) = 1036831949;
                              *((_DWORD *)v5 + 16) = 1061997773;
                              *((_DWORD *)v5 + 17) = 1038174126;
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((_DWORD *)v5 + 13) = 1106247680;
                              *((_DWORD *)v5 + 22) = 1077936128;
                              goto LABEL_17;
                            case 38:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 9) = 1112014848;
                              *((_DWORD *)v5 + 23) = 1074580685;
                              *((_DWORD *)v5 + 25) = 1123680256;
                              *((_DWORD *)v5 + 15) = 1058642330;
                              *((_DWORD *)v5 + 16) = 1061997773;
                              *((_DWORD *)v5 + 17) = 1058642330;
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((_DWORD *)v5 + 13) = 1110704128;
                              *((_DWORD *)v5 + 22) = 1092616192;
                              goto LABEL_17;
                            case 39:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 9) = 1112014848;
                              *((_DWORD *)v5 + 23) = 1074161254;
                              *((_DWORD *)v5 + 35) = 1024;
                              *((_DWORD *)v5 + 25) = 1123680256;
                              *((_DWORD *)v5 + 15) = 1065353216;
                              *((_DWORD *)v5 + 16) = 1061997773;
                              *((_DWORD *)v5 + 17) = 1036831949;
                              *((_DWORD *)v5 + 18) = 1065353216;
                              *((_WORD *)v5 + 60) = 3;
                              *((_WORD *)v5 + 61) = 5;
                              *((_DWORD *)v5 + 13) = 1110704128;
                              *((_DWORD *)v5 + 22) = 1092616192;
                              goto LABEL_17;
                            case 33:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 9) = 1112801280;
                              v92 = v5 + 60;
                              *((_DWORD *)v5 + 23) = 1071225242;
                              *((_DWORD *)v5 + 25) = 1123024896;
                              *((_DWORD *)v5 + 15) = 1060320051;
                              *((_DWORD *)v5 + 16) = 1036831949;
                              *((_DWORD *)v5 + 17) = 1057132380;
                              v93 = 1056964608;
                              break;
                            case 34:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 9) = 1103626240;
                              *((_DWORD *)v5 + 23) = 1071225242;
                              *((_DWORD *)v5 + 25) = 1125515264;
                              *((_DWORD *)v5 + 15) = 1036831949;
                              *((_DWORD *)v5 + 16) = 1060320051;
                              *((_DWORD *)v5 + 17) = 1057132380;
                              *((_DWORD *)v5 + 18) = 1028443341;
                              *((_DWORD *)v5 + 13) = 1112014848;
                              *((_DWORD *)v5 + 22) = 1090519040;
                              goto LABEL_17;
                            case 35:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 9) = 1084227584;
                              *((_DWORD *)v5 + 23) = 1071225242;
                              *((_DWORD *)v5 + 25) = 1127481344;
                              *((_DWORD *)v5 + 15) = 1036831949;
                              *((_DWORD *)v5 + 16) = 1060320051;
                              *((_DWORD *)v5 + 17) = 1057132380;
                              *((_DWORD *)v5 + 18) = 1025758986;
                              *((_DWORD *)v5 + 13) = 1110704128;
                              *((_DWORD *)v5 + 22) = 1090519040;
                              goto LABEL_17;
                            case 40:
                              *((_DWORD *)v5 + 27) = 2;
                              *((_DWORD *)v5 + 9) = 1112014848;
                              v92 = v5 + 60;
                              *((_DWORD *)v5 + 23) = 1071225242;
                              *((_DWORD *)v5 + 25) = 1125515264;
                              *((_DWORD *)v5 + 15) = 1060320051;
                              *((_DWORD *)v5 + 16) = 1036831949;
                              *((_DWORD *)v5 + 17) = 1057132380;
                              v93 = 1065353216;
                              break;
                            default:
                              switch ( template_id )
                              {
                                case 41:
                                  *((_DWORD *)v5 + 27) = 2;
                                  *((_DWORD *)v5 + 9) = 1145569280;
                                  *((_DWORD *)v5 + 23) = 1075838976;
                                  *((_DWORD *)v5 + 25) = 1138819072;
                                  *((_DWORD *)v5 + 15) = 1061997773;
                                  *((_DWORD *)v5 + 16) = 1061997773;
                                  *((_DWORD *)v5 + 17) = 1061997773;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1116471296;
                                  *((_DWORD *)v5 + 22) = 1101004800;
                                  goto LABEL_17;
                                case 42:
                                  *((_DWORD *)v5 + 27) = 2;
                                  *((_DWORD *)v5 + 9) = 1112014848;
                                  *((_DWORD *)v5 + 23) = 1078355558;
                                  *((_DWORD *)v5 + 25) = 1133903872;
                                  *((_DWORD *)v5 + 15) = 1050253722;
                                  *((_DWORD *)v5 + 16) = 1050253722;
                                  *((_DWORD *)v5 + 17) = 1050253722;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1114636288;
                                  *((_DWORD *)v5 + 22) = 1090519040;
                                  goto LABEL_17;
                                case 43:
                                  *((_DWORD *)v5 + 27) = 2;
                                  *((_DWORD *)v5 + 9) = 1106247680;
                                  v94 = v5 + 60;
                                  *((_DWORD *)v5 + 23) = 1080452710;
                                  *((_DWORD *)v5 + 25) = 1138819072;
                                  *((_DWORD *)v5 + 15) = 1065353216;
                                  *((_DWORD *)v5 + 16) = 1050253722;
                                  *((_DWORD *)v5 + 17) = 1050253722;
                                  break;
                                case 44:
                                  *((_DWORD *)v5 + 27) = 2;
                                  *((_DWORD *)v5 + 9) = 1164804096;
                                  *((_DWORD *)v5 + 23) = 0x40000000;
                                  *((_DWORD *)v5 + 25) = 1153138688;
                                  *((_DWORD *)v5 + 15) = 1062836634;
                                  *((_DWORD *)v5 + 16) = 1045220557;
                                  *((_DWORD *)v5 + 17) = 1045220557;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1117782016;
                                  *((_DWORD *)v5 + 22) = 1109393408;
                                  goto LABEL_17;
                                case 45:
                                  *((_DWORD *)v5 + 27) = 2;
                                  *((_DWORD *)v5 + 9) = 1110704128;
                                  *((_DWORD *)v5 + 23) = 1078355558;
                                  *((_DWORD *)v5 + 25) = 1128792064;
                                  *((_DWORD *)v5 + 15) = 0;
                                  *((_DWORD *)v5 + 16) = 1063675494;
                                  *((_DWORD *)v5 + 17) = 1061997773;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1108869120;
                                  *((_DWORD *)v5 + 22) = 1077936128;
                                  *((_DWORD *)v5 + 36) = 2;
                                  goto LABEL_17;
                                case 47:
                                  *((_DWORD *)v5 + 27) = 1;
                                  *((_DWORD *)v5 + 9) = 1101004800;
                                  *((_DWORD *)v5 + 23) = 1075838976;
                                  *((_DWORD *)v5 + 25) = 1125515264;
                                  *((_DWORD *)v5 + 15) = 1061997773;
                                  *((_DWORD *)v5 + 16) = 1061997773;
                                  *((_DWORD *)v5 + 17) = 1061997773;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1110704128;
                                  *((_DWORD *)v5 + 22) = 1082130432;
                                  goto LABEL_17;
                                case 48:
                                  *((_DWORD *)v5 + 27) = 1;
                                  *((_DWORD *)v5 + 9) = 1148846080;
                                  *((_DWORD *)v5 + 23) = 0x40000000;
                                  *((_DWORD *)v5 + 25) = 1137180672;
                                  *((_DWORD *)v5 + 15) = 1063675494;
                                  *((_DWORD *)v5 + 16) = 1061997773;
                                  *((_DWORD *)v5 + 17) = 1036831949;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1115815936;
                                  *((_DWORD *)v5 + 22) = 1092616192;
                                  goto LABEL_17;
                                case 59:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 9) = 1150681088;
                                  *((_DWORD *)v5 + 23) = 0x40000000;
                                  *((_DWORD *)v5 + 25) = 1165623296;
                                  *((_DWORD *)v5 + 15) = 1063675494;
                                  *((_DWORD *)v5 + 16) = 0;
                                  *((_DWORD *)v5 + 17) = 0;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1116471296;
                                  *((_DWORD *)v5 + 22) = 1101004800;
                                  goto LABEL_17;
                                case 60:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 35) = 256;
                                  *((_DWORD *)v5 + 33) = 1053609165;
                                  *((_DWORD *)v5 + 34) = 26;
                                  *((_DWORD *)v5 + 9) = 1128792064;
                                  *((_DWORD *)v5 + 23) = 0x40000000;
                                  *((_DWORD *)v5 + 25) = 1128792064;
                                  *((_DWORD *)v5 + 15) = 1063675494;
                                  *((_DWORD *)v5 + 16) = 1036831949;
                                  *((_DWORD *)v5 + 17) = 1036831949;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1109393408;
                                  *((_DWORD *)v5 + 22) = 1101004800;
                                  *((_DWORD *)v5 + 36) = 2;
                                  goto LABEL_17;
                                case 61:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 9) = 1116471296;
                                  *((_DWORD *)v5 + 23) = 1076258406;
                                  *((_DWORD *)v5 + 25) = 1123024896;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  v95 = (double)(crt_rand() % 20) * 0.0099999998 + 0.80000001;
                                  *((float *)v5 + 15) = v95;
                                  *((float *)v5 + 17) = v95;
                                  *((float *)v5 + 16) = v95;
                                  v96 = (double)(crt_rand() % 7 + 45);
                                  *((float *)v5 + 13) = v96;
                                  *((float *)v5 + 22) = v96 * 0.22;
                                  goto LABEL_16;
                                case 62:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 9) = 1148846080;
                                  *((_DWORD *)v5 + 23) = 1077097267;
                                  *((_DWORD *)v5 + 25) = 1140457472;
                                  *((_DWORD *)v5 + 15) = 1065353216;
                                  *((_DWORD *)v5 + 16) = 1065353216;
                                  *((_DWORD *)v5 + 17) = 1065353216;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1115684864;
                                  *((_DWORD *)v5 + 22) = 1109393408;
                                  goto LABEL_17;
                                case 0:
                                  *((_DWORD *)v5 + 27) = 0;
                                  *((_DWORD *)v5 + 35) = 68;
                                  *((_DWORD *)v5 + 9) = 1174720512;
                                  *((_DWORD *)v5 + 23) = 1067869798;
                                  *((_DWORD *)v5 + 25) = 1171144704;
                                  *((_DWORD *)v5 + 15) = 1058642330;
                                  *((_DWORD *)v5 + 16) = 1058642330;
                                  *((_DWORD *)v5 + 17) = 1065353216;
                                  *((_DWORD *)v5 + 18) = 1061997773;
                                  *((_DWORD *)v5 + 13) = 1115684864;
                                  *((_DWORD *)v5 + 22) = 1112014848;
                                  v97 = creature_spawn_slot_alloc();
                                  *((_DWORD *)v5 + 30) = v97;
                                  v98 = (char **)(24 * v97 + 4739024);
                                  v98[4] = (char *)1065353216;
                                  v98[1] = 0;
                                  v98[2] = (char *)812;
                                  v98[3] = (char *)1060320051;
                                  v98[5] = (char *)65;
                                  *v98 = v5;
                                  goto LABEL_16;
                                case 56:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 35) = 128;
                                  *((_DWORD *)v5 + 30) = 0;
                                  *((_DWORD *)v5 + 9) = 1112014848;
                                  *((_DWORD *)v5 + 23) = 1083808154;
                                  *((_DWORD *)v5 + 25) = 1138262016;
                                  *((_DWORD *)v5 + 15) = 1065353216;
                                  *((_DWORD *)v5 + 16) = 1061158912;
                                  *((_DWORD *)v5 + 17) = 1036831949;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((float *)v5 + 13) = (float)(crt_rand() % 4 + 41);
                                  *((_DWORD *)v5 + 22) = 1092616192;
                                  goto LABEL_16;
                                case 55:
                                  *((_DWORD *)v5 + 27) = 4;
                                  *((_DWORD *)v5 + 35) = 256;
                                  *((_DWORD *)v5 + 30) = 0;
                                  *((_DWORD *)v5 + 9) = 1112014848;
                                  *((_DWORD *)v5 + 23) = 1078774989;
                                  *((_DWORD *)v5 + 25) = 1138262016;
                                  *((_DWORD *)v5 + 15) = 1065353216;
                                  *((_DWORD *)v5 + 16) = 1061158912;
                                  *((_DWORD *)v5 + 17) = 1036831949;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((float *)v5 + 13) = (float)(crt_rand() % 4 + 41);
                                  *((_DWORD *)v5 + 22) = 1092616192;
                                  goto LABEL_16;
                                case 57:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 35) = 128;
                                  *((_DWORD *)v5 + 30) = 0;
                                  *((_DWORD *)v5 + 9) = 1082130432;
                                  *((_DWORD *)v5 + 23) = 1083808154;
                                  *((_DWORD *)v5 + 25) = 1112014848;
                                  *((_DWORD *)v5 + 15) = 1061997773;
                                  *((_DWORD *)v5 + 16) = 1059481190;
                                  *((_DWORD *)v5 + 17) = 1036831949;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((float *)v5 + 13) = (float)(crt_rand() % 4 + 26);
                                  *((_DWORD *)v5 + 22) = 1092616192;
                                  goto LABEL_16;
                                case 58:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 35) = 16;
                                  *((_DWORD *)v5 + 33) = 1063675494;
                                  *((_DWORD *)v5 + 34) = 9;
                                  *((_DWORD *)v5 + 9) = 1166843904;
                                  *((_DWORD *)v5 + 23) = 0x40000000;
                                  *((_DWORD *)v5 + 25) = 1166843904;
                                  *((_DWORD *)v5 + 15) = 1065353216;
                                  *((_DWORD *)v5 + 16) = 1065353216;
                                  *((_DWORD *)v5 + 17) = 1065353216;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1115684864;
                                  *((_DWORD *)v5 + 22) = 1112014848;
                                  goto LABEL_17;
                                case 63:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 9) = 1128792064;
                                  v94 = v5 + 60;
                                  *((_DWORD *)v5 + 23) = 1075000115;
                                  *((_DWORD *)v5 + 25) = 1129447424;
                                  *((_DWORD *)v5 + 15) = 1060320051;
                                  *((_DWORD *)v5 + 16) = 1053609165;
                                  *((_DWORD *)v5 + 17) = 1036831949;
                                  break;
                                case 64:
                                  *((_DWORD *)v5 + 27) = 3;
                                  *((_DWORD *)v5 + 9) = 1116471296;
                                  *((_DWORD *)v5 + 23) = 1074580685;
                                  *((_DWORD *)v5 + 25) = 1126170624;
                                  *((_DWORD *)v5 + 15) = 1056964608;
                                  *((_DWORD *)v5 + 16) = 1058642330;
                                  *((_DWORD *)v5 + 17) = 1063675494;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1110704128;
                                  *((_DWORD *)v5 + 22) = 1084227584;
                                  goto LABEL_17;
                                case 66:
                                  *((_DWORD *)v5 + 27) = 0;
                                  *((_DWORD *)v5 + 9) = 1128792064;
                                  *((_DWORD *)v5 + 23) = 1071225242;
                                  *((_DWORD *)v5 + 25) = 1126170624;
                                  strcpy(v5 + 60, "fff?fff?fff?");
                                  v5[73] = 0;
                                  *((_WORD *)v5 + 37) = 16256;
                                  *((_DWORD *)v5 + 13) = 1110704128;
                                  *((_DWORD *)v5 + 22) = 1097859072;
                                  goto LABEL_17;
                                case 67:
                                  *((_DWORD *)v5 + 27) = 0;
                                  *((_DWORD *)v5 + 9) = 1157234688;
                                  *((_DWORD *)v5 + 23) = 1074161254;
                                  *((_DWORD *)v5 + 25) = 1139146752;
                                  *((_DWORD *)v5 + 15) = 1045220557;
                                  *((_DWORD *)v5 + 16) = 1058642330;
                                  *((_DWORD *)v5 + 17) = 1036831949;
                                  *((_DWORD *)v5 + 18) = 1065353216;
                                  *((_DWORD *)v5 + 13) = 1116471296;
                                  *((_DWORD *)v5 + 22) = 1097859072;
                                  goto LABEL_16;
                                default:
                                  goto LABEL_15;
                              }
                              *((_DWORD *)v94 + 3) = 1065353216;
                              *((_DWORD *)v5 + 13) = 1108082688;
                              *((_DWORD *)v5 + 22) = 1101004800;
                              goto LABEL_17;
                          }
                          *((_DWORD *)v92 + 3) = v93;
                          *((_DWORD *)v5 + 13) = 1113325568;
                          *((_DWORD *)v5 + 22) = 1090519040;
                          goto LABEL_17;
                      }
                      *((float *)v5 + 22) = (double)(crt_rand() % 10) + 4.0;
                      goto LABEL_16;
                  }
                  *((float *)v5 + 22) = *((float *)v5 + 13) * 0.14 + 4.0;
                  goto LABEL_16;
              }
              v56 = v55 * 0.0099999998 + 0.5;
              *((float *)v5 + 15) = v56;
              *((float *)v5 + 16) = v56;
              *((_DWORD *)v5 + 17) = 1065353216;
              *((_DWORD *)v5 + 22) = 1084227584;
              goto LABEL_16;
          }
          v53[5] = (char *)29;
          *v53 = v5;
          *((_DWORD *)v5 + 13) = 1112014848;
          *((_DWORD *)v5 + 9) = 1148846080;
          *((_DWORD *)v5 + 23) = 0x40000000;
          *((_DWORD *)v5 + 25) = 1161527296;
          *((_DWORD *)v5 + 18) = 1065353216;
          *((_DWORD *)v5 + 15) = 1065353216;
          *((_DWORD *)v5 + 16) = 1065353216;
          *((_DWORD *)v5 + 17) = 1065353216;
          *((_DWORD *)v5 + 22) = 0;
          goto LABEL_16;
      }
      *((_DWORD *)v5 + 18) = 1065353216;
      *((_DWORD *)v5 + 15) = 1063675494;
      *((_DWORD *)v5 + 16) = 1061997773;
      *((_DWORD *)v5 + 17) = 1053609165;
      *((_DWORD *)v5 + 22) = 0;
      goto LABEL_16;
  }
LABEL_15:
  *((_DWORD *)v5 + 27) = 2;
  *((_DWORD *)v5 + 9) = 1101004800;
  console_printf(&console_log_queue, aUnhandledCreat);
LABEL_16:
  v9 = template_id;
LABEL_17:
  if ( !demo_mode_active
    && *((float *)v5 + 5) > 0.0
    && (double)terrain_texture_width > *((float *)v5 + 5)
    && *((float *)v5 + 6) > 0.0
    && (double)terrain_texture_height > *((float *)v5 + 6) )
  {
    effect_spawn_burst((float *)v5 + 5, 8);
    v9 = template_id;
  }
  *((_DWORD *)v5 + 10) = *((_DWORD *)v5 + 9);
  v17 = *((_DWORD *)v5 + 35);
  if ( (v17 & 0x10) == 0 && *((_DWORD *)v5 + 27) == 3 && (v17 & 0x80u) == 0 )
  {
    LOBYTE(v17) = v17 | 0x80;
    *((_DWORD *)v5 + 35) = v17;
    *((_DWORD *)v5 + 30) = 0;
    *((float *)v5 + 23) = *((float *)v5 + 23) * 1.2;
  }
  if ( v9 == 56 && config_hardcore )
    *((float *)v5 + 23) = *((float *)v5 + 23) * 0.69999999;
  *((float *)v5 + 11) = heading;
  if ( config_hardcore
    || (v5[140] & 4) != 0
    && (creature_spawn_slot_interval[6 * *((_DWORD *)v5 + 30)] = creature_spawn_slot_interval[6 * *((_DWORD *)v5 + 30)]
                                                               + 0.2,
        config_hardcore) )
  {
    dword_487194 = 0;
    *((float *)v5 + 23) = *((float *)v5 + 23) * 1.05;
    *((float *)v5 + 22) = *((float *)v5 + 22) * 1.4;
    *((float *)v5 + 9) = *((float *)v5 + 9) * 1.2;
    if ( (v5[140] & 4) != 0 )
    {
      v18 = *((_DWORD *)v5 + 30);
      v19 = creature_spawn_slot_interval[6 * v18] - 0.2;
      creature_spawn_slot_interval[6 * v18] = v19;
      if ( v19 < 0.1 )
      {
        creature_spawn_slot_interval[6 * v18] = 0.1;
        return v5;
      }
    }
  }
  else if ( dword_487194 > 0 )
  {
    switch ( dword_487194 )
    {
      case 1:
        *((float *)v5 + 25) = *((float *)v5 + 25) * 0.89999998;
        *((float *)v5 + 23) = *((float *)v5 + 23) * 0.94999999;
        *((float *)v5 + 22) = *((float *)v5 + 22) * 0.94999999;
        v99 = *((float *)v5 + 9) * 0.94999999;
        break;
      case 2:
        *((float *)v5 + 25) = *((float *)v5 + 25) * 0.85000002;
        *((float *)v5 + 23) = *((float *)v5 + 23) * 0.89999998;
        *((float *)v5 + 22) = *((float *)v5 + 22) * 0.89999998;
        v99 = *((float *)v5 + 9) * 0.89999998;
        break;
      case 3:
        *((float *)v5 + 25) = *((float *)v5 + 25) * 0.85000002;
        *((float *)v5 + 23) = *((float *)v5 + 23) * 0.80000001;
        *((float *)v5 + 22) = *((float *)v5 + 22) * 0.80000001;
        v99 = *((float *)v5 + 9) * 0.80000001;
        break;
      case 4:
        *((float *)v5 + 25) = *((float *)v5 + 25) * 0.80000001;
        *((float *)v5 + 23) = *((float *)v5 + 23) * 0.69999999;
        *((float *)v5 + 22) = *((float *)v5 + 22) * 0.69999999;
        v99 = *((float *)v5 + 9) * 0.69999999;
        break;
      default:
        *((float *)v5 + 25) = *((float *)v5 + 25) * 0.80000001;
        *((float *)v5 + 23) = *((float *)v5 + 23) * 0.60000002;
        *((float *)v5 + 22) = *((float *)v5 + 22) * 0.5;
        v99 = *((float *)v5 + 9) * 0.5;
        break;
    }
    *((float *)v5 + 9) = v99;
    if ( (v5[140] & 4) != 0 )
    {
      v100 = (double)dword_487194 * 0.34999999;
      if ( v100 > 3.0 )
        v100 = 3.0;
      creature_spawn_slot_interval[6 * *((_DWORD *)v5 + 30)] = v100
                                                             + creature_spawn_slot_interval[6 * *((_DWORD *)v5 + 30)];
    }
  }
  return v5;
}

// quest_spawn_table_empty @ 0x00434220
// returns 1 when the quest spawn table has no pending entries
int quest_spawn_table_empty()
{
  int result; // eax
  int *v1; // ecx

  result = quest_spawn_count - 1;
  if ( quest_spawn_count - 1 < 0 )
  {
LABEL_5:
    LOBYTE(result) = 1;
  }
  else
  {
    v1 = (int *)(24 * result + 4741052);
    while ( *v1 <= 0 )
    {
      --result;
      v1 -= 6;
      if ( result < 0 )
        goto LABEL_5;
    }
    LOBYTE(result) = 0;
  }
  return result;
}

// quest_spawn_timeline_update @ 0x00434250
// updates quest spawn entries based on the quest timer
void quest_spawn_timeline_update()
{
  int v0; // esi
  int v1; // edi
  int v2; // ebx
  int v3; // ebp
  _DWORD *i; // eax
  int j; // esi
  int v6; // edx
  float v7; // [esp-4h] [ebp-30h]
  int v8; // [esp+10h] [ebp-1Ch]
  float v9; // [esp+14h] [ebp-18h]
  float v10; // [esp+18h] [ebp-14h]
  float pos[2]; // [esp+24h] [ebp-8h] BYREF

  if ( creatures_any_active_flag )
    v0 = frame_dt_ms + dword_4C3654;
  else
    v0 = 0;
  v1 = quest_spawn_count;
  v2 = 0;
  v3 = 0;
  dword_4C3654 = v0;
  if ( quest_spawn_count > 0 )
  {
    for ( i = &unk_4857B8;
          (int)i[1] <= 0
       || *i >= quest_spawn_timeline && (!creatures_any_active_flag || v0 <= 3000 || quest_spawn_timeline <= 1700);
          i += 6 )
    {
      if ( ++v3 >= quest_spawn_count )
        return;
    }
    for ( j = 24 * v3 + 4741032; ; j += 24 )
    {
      v9 = 0.0;
      v10 = 0.0;
      if ( *(int *)(j + 20) > 0 )
      {
        v8 = 0;
        do
        {
          if ( *(float *)j < 0.0 || (double)terrain_texture_width < *(float *)j )
          {
            v10 = (float)v8;
            if ( (v2 & 1) != 0 )
              v10 = -v10;
          }
          else
          {
            v9 = (float)v8;
            if ( (v2 & 1) != 0 )
              v9 = -v9;
          }
          v6 = *(_DWORD *)(j + 12);
          v7 = *(float *)(j + 8);
          pos[0] = v9 + *(float *)j;
          pos[1] = v10 + *(float *)(j + 4);
          creature_spawn_template(v6, pos, v7);
          ++v2;
          v8 += 40;
        }
        while ( v2 < *(_DWORD *)(j + 20) );
        v1 = quest_spawn_count;
      }
      v2 = 0;
      *(_DWORD *)(j + 20) = 0;
      creatures_any_active_flag = 0;
      if ( v3 >= v1 - 1 || *(_DWORD *)(j + 16) != *(_DWORD *)(j + 40) )
        break;
      ++v3;
    }
  }
}

// quest_database_advance_slot @ 0x004343C0
// advances quest database tier/index (wraps every 10)
void quest_database_advance_slot(int *tier, int *index)
{
  int v2; // ecx
  bool v3; // sf

  v2 = *index + 1;
  v3 = *index - 9 < 0;
  *index = v2;
  if ( v3 == __OFSUB__(v2, 10) )
  {
    ++*tier;
    *index = 0;
  }
}

// quest_build_fallback @ 0x004343E0
// fills a default quest spawn table when no quest builder is present
_DWORD *__cdecl sub_4343E0(int a1, _DWORD *a2)
{
  double v2; // st7
  double v3; // st7
  float v5; // [esp+4h] [ebp-4h]
  float v6; // [esp+4h] [ebp-4h]

  console_printf((int)&console_log_queue, aGeneratingAFal);
  v2 = (double)terrain_texture_height * 0.5;
  *(_DWORD *)a1 = -1035468800;
  v5 = v2;
  *(float *)(a1 + 4) = v5;
  *(_DWORD *)(a1 + 12) = 64;
  *(_DWORD *)(a1 + 16) = 500;
  *(_DWORD *)(a1 + 20) = 10;
  v3 = (double)terrain_texture_height;
  *(_DWORD *)(a1 + 24) = -1035468800;
  v6 = v3 * 0.5;
  *(float *)(a1 + 28) = v6;
  *(_DWORD *)(a1 + 36) = 64;
  *(_DWORD *)(a1 + 40) = 5000;
  *(_DWORD *)(a1 + 44) = 20;
  *a2 = 2;
  return a2;
}

// quest_build_nagolipoli @ 0x00434480
// quest builder for Tier 5 Quest 9 (Nagolipoli)
_DWORD *__cdecl sub_434480(int a1, _DWORD *a2)
{
  int v2; // esi
  int v3; // eax
  double v4; // st7
  long double v5; // st7
  int v6; // eax
  int v7; // edx
  int v8; // esi
  int v9; // eax
  double v10; // st7
  long double v11; // st7
  int v12; // ebx
  _DWORD *v13; // ecx
  int i; // edi
  int v15; // eax
  _DWORD *v16; // ecx
  int v18; // ecx
  int v19; // eax
  int v20; // esi
  int v21; // ecx
  int v22; // eax
  int v23; // esi
  int v24; // eax
  double v25; // st7
  _DWORD *v26; // eax
  int v27; // ecx
  int v28; // esi
  int v29; // eax
  _DWORD *v30; // eax
  _DWORD *v31; // eax
  _DWORD *v32; // eax
  int v34; // [esp+10h] [ebp-20h]
  int v35; // [esp+10h] [ebp-20h]
  int v36; // [esp+10h] [ebp-20h]
  int v37; // [esp+10h] [ebp-20h]
  int v38; // [esp+18h] [ebp-18h]
  float v39; // [esp+2Ch] [ebp-4h]
  float v40; // [esp+2Ch] [ebp-4h]
  int v41; // [esp+34h] [ebp+4h]

  v2 = 0;
  v34 = 0;
  v3 = a1 + 4;
  do
  {
    v4 = (double)v34;
    ++v2;
    v3 += 24;
    v34 = v2;
    v5 = v4 * 0.78539819;
    *(float *)(v3 - 28) = cos(v5) * 128.0;
    *(float *)(v3 - 24) = sin(v5) * 128.0;
    *(float *)(v3 - 28) = *(float *)(v3 - 28) + 512.0;
    *(float *)(v3 - 24) = *(float *)(v3 - 24) + 512.0;
    *(_DWORD *)(v3 - 16) = 64;
    *(float *)(v3 - 20) = v5;
    *(_DWORD *)(v3 - 12) = 2000;
    *(_DWORD *)(v3 - 8) = 1;
  }
  while ( v2 < 8 );
  v6 = 3 * v2;
  v7 = 0;
  v35 = 0;
  v8 = v2 + 12;
  v9 = a1 + 8 * v6 + 4;
  do
  {
    v10 = (double)v35;
    v9 += 24;
    v35 = ++v7;
    v11 = v10 * 0.52359879;
    *(float *)(v9 - 28) = cos(v11) * 178.0;
    *(float *)(v9 - 24) = sin(v11) * 178.0;
    *(float *)(v9 - 28) = *(float *)(v9 - 28) + 512.0;
    *(float *)(v9 - 24) = *(float *)(v9 - 24) + 512.0;
    *(_DWORD *)(v9 - 16) = 64;
    *(float *)(v9 - 20) = v11;
    *(_DWORD *)(v9 - 12) = 8000;
    *(_DWORD *)(v9 - 8) = 1;
  }
  while ( v7 < 12 );
  v12 = 0;
  v13 = (_DWORD *)(a1 + 24 * v8);
  for ( i = 13000; i < 38600; i += 800 )
  {
    *v13 = -1031798784;
    v13[1] = -1031798784;
    v13[3] = 28;
    v13[2] = 1065749138;
    v15 = v12 / 8 + 1;
    v13[4] = i;
    v13[5] = v15;
    v16 = v13 + 6;
    *v16 = 1149763584;
    v16[1] = -1031798784;
    v16[3] = 28;
    v16[2] = -1081734510;
    v16[4] = i;
    v16[5] = v15;
    v16 += 6;
    *v16 = -1031798784;
    v16[1] = 1149763584;
    v16[3] = 28;
    v16[2] = -1081734510;
    v16[4] = i;
    v16[5] = v15;
    v16 += 6;
    v8 += 4;
    *v16 = 1149763584;
    v16[1] = 1149763584;
    v16[3] = 28;
    v16[2] = 1081824210;
    v16[4] = i;
    v16[5] = v15;
    v13 = v16 + 6;
    ++v12;
  }
  v36 = 0;
  v18 = 160 * (5 * v12 + 150);
  v19 = a1 + 24 * v8 + 8;
  v20 = v8 + 6;
  do
  {
    *(_DWORD *)(v19 - 8) = 1115684864;
    v19 += 24;
    v39 = (double)v36 * 85.333336 + 256.0;
    *(float *)(v19 - 28) = v39;
    *(_DWORD *)(v19 - 20) = 10;
    *(_DWORD *)(v19 - 24) = 0;
    *(_DWORD *)(v19 - 16) = v18;
    *(_DWORD *)(v19 - 12) = 1;
    v18 += 100;
    ++v36;
  }
  while ( v36 < 6 );
  v21 = 0;
  v37 = 0;
  v38 = 800 * v12;
  v41 = 800 * v12 + 25000;
  v22 = 3 * v20;
  v23 = v20 + 6;
  v24 = a1 + 8 * v22 + 8;
  do
  {
    v25 = (double)v37;
    *(_DWORD *)(v24 - 8) = 1148190720;
    v24 += 24;
    v37 = ++v21;
    v40 = v25 * 85.333336 + 256.0;
    *(float *)(v24 - 28) = v40;
    *(_DWORD *)(v24 - 20) = 10;
    *(_DWORD *)(v24 - 24) = 0;
    *(_DWORD *)(v24 - 16) = v41;
    *(_DWORD *)(v24 - 12) = 1;
    v41 += 100;
  }
  while ( v21 < 6 );
  v26 = (_DWORD *)(a1 + 24 * v23);
  *v26 = 1140850688;
  v26[1] = 1132462080;
  v26[3] = 11;
  v26[2] = 1078530011;
  v27 = 160 * (5 * v12 + 175);
  v28 = v23 + 1;
  v26[4] = v27;
  v26[5] = 1;
  v29 = 3 * v28++;
  v30 = (_DWORD *)(a1 + 8 * v29);
  *v30 = 1140850688;
  v30[1] = 1145044992;
  v30[3] = 11;
  v30[2] = 1078530011;
  v30[4] = v27;
  v30[5] = 1;
  v31 = (_DWORD *)(a1 + 24 * v28);
  *v31 = 1140850688;
  v31[1] = 1149763584;
  v31[3] = 28;
  v31[2] = 1081824210;
  ++v28;
  v31[4] = v38 + 28500;
  v31[5] = 8;
  v32 = (_DWORD *)(a1 + 24 * v28);
  *v32 = 1140850688;
  v32[1] = -1031798784;
  v32[3] = 28;
  v32[2] = 1081824210;
  v32[4] = v38 + 28500;
  v32[5] = 8;
  *a2 = v28 + 1;
  return a2;
}

// quest_build_monster_blues @ 0x00434860
// quest builder for Tier 5 Quest 8 (Monster Blues)
_DWORD *__cdecl sub_434860(int a1, _DWORD *a2)
{
  double v2; // st7
  double v3; // st7
  int v4; // esi
  int v5; // edi
  _DWORD *v6; // ecx
  int v7; // eax
  float v9; // [esp+Ch] [ebp-4h]
  float v10; // [esp+Ch] [ebp-4h]

  v2 = (double)terrain_texture_height * 0.5;
  *(_DWORD *)a1 = -1035468800;
  v9 = v2;
  *(float *)(a1 + 4) = v9;
  *(_DWORD *)(a1 + 12) = 4;
  *(_DWORD *)(a1 + 16) = 500;
  *(_DWORD *)(a1 + 20) = 10;
  v3 = (double)terrain_texture_height;
  *(_DWORD *)(a1 + 24) = 1149648896;
  v10 = v3 * 0.5;
  *(float *)(a1 + 28) = v10;
  *(_DWORD *)(a1 + 36) = 6;
  *(_DWORD *)(a1 + 40) = 7500;
  *(_DWORD *)(a1 + 44) = 10;
  *(_DWORD *)(a1 + 48) = 1140850688;
  *(_DWORD *)(a1 + 52) = 1149763584;
  *(_DWORD *)(a1 + 60) = 3;
  *(_DWORD *)(a1 + 64) = 17500;
  *(_DWORD *)(a1 + 68) = 12;
  *(_DWORD *)(a1 + 72) = 1140850688;
  *(_DWORD *)(a1 + 76) = -1031798784;
  *(_DWORD *)(a1 + 84) = 3;
  *(_DWORD *)(a1 + 88) = 17500;
  *(_DWORD *)(a1 + 92) = 12;
  v4 = 0;
  v5 = 27500;
  v6 = (_DWORD *)(a1 + 108);
  do
  {
    *(v6 - 3) = -1031798784;
    *(v6 - 2) = 1140850688;
    if ( v4 % 4 )
      *v6 = v4 % 4 != 1 ? 5 : 3;
    else
      *v6 = 6;
    v6[1] = v5;
    v5 += 900;
    v6 += 6;
    v7 = v4 / 8 + 2;
    ++v4;
    *(v6 - 4) = v7;
  }
  while ( v4 < 64 );
  *a2 = 68;
  return a2;
}

// quest_build_the_gathering @ 0x004349C0
// quest builder for Tier 5 Quest 10 (The Gathering)
_DWORD *__cdecl sub_4349C0(_DWORD *a1, _DWORD *a2)
{
  *a1 = 1132462080;
  a1[1] = 1140850688;
  a1[3] = 1;
  a1[4] = 500;
  a1[5] = 1;
  a1[6] = 1145044992;
  a1[7] = 1140850688;
  a1[9] = 1;
  a1[10] = 9500;
  a1[11] = 2;
  a1[12] = 1132462080;
  a1[13] = 1140850688;
  a1[15] = 58;
  a1[16] = 15500;
  a1[17] = 2;
  a1[18] = 1145044992;
  a1[19] = 1140850688;
  a1[21] = 58;
  a1[22] = 24500;
  a1[23] = 2;
  a1[24] = 1132462080;
  a1[25] = 1140850688;
  a1[27] = 0;
  a1[28] = 30500;
  a1[29] = 2;
  a1[30] = 1145044992;
  a1[31] = 1140850688;
  a1[33] = 0;
  a1[34] = 39500;
  a1[35] = 2;
  a1[36] = 1115684864;
  a1[37] = 1115684864;
  a1[39] = 60;
  a1[40] = 54500;
  a1[41] = 2;
  a1[42] = 1148190720;
  a1[43] = 1115684864;
  a1[45] = 60;
  a1[46] = 54500;
  a1[47] = 1;
  a1[48] = 1115684864;
  a1[49] = 1148190720;
  a1[51] = 60;
  a1[52] = 54500;
  a1[53] = 2;
  a1[54] = 1148190720;
  a1[55] = 1148190720;
  a1[57] = 60;
  a1[58] = 54500;
  a1[59] = 1;
  a1[60] = -1023410176;
  a1[61] = 1140850688;
  a1[63] = 58;
  a1[64] = 90500;
  a1[65] = 6;
  a1[66] = 1150287872;
  a1[67] = 1140850688;
  a1[69] = 1;
  a1[70] = 99500;
  a1[71] = 4;
  a1[72] = 1150287872;
  a1[73] = 1140850688;
  a1[75] = 1;
  a1[76] = 109500;
  a1[77] = 2;
  *a2 = 13;
  return a1;
}

// quest_build_army_of_three @ 0x00434CA0
// quest builder for Tier 5 Quest 7 (Army of Three)
_DWORD *__cdecl sub_434CA0(_DWORD *a1, _DWORD *a2)
{
  *a1 = -1031798784;
  a1[1] = 1132462080;
  a1[3] = 21;
  a1[4] = 500;
  a1[5] = 1;
  a1[6] = -1031798784;
  a1[7] = 1140850688;
  a1[9] = 21;
  a1[10] = 5500;
  a1[11] = 1;
  a1[12] = -1031798784;
  a1[13] = 1145044992;
  a1[15] = 21;
  a1[16] = 15000;
  a1[17] = 1;
  a1[18] = -1031798784;
  a1[19] = 1145044992;
  a1[21] = 23;
  a1[22] = 19500;
  a1[23] = 1;
  a1[24] = -1031798784;
  a1[25] = 1140850688;
  a1[27] = 23;
  a1[28] = 22500;
  a1[29] = 1;
  a1[30] = -1031798784;
  a1[31] = 1132462080;
  a1[33] = 23;
  a1[34] = 26500;
  a1[35] = 1;
  a1[36] = -1031798784;
  a1[37] = 1132462080;
  a1[39] = 22;
  a1[40] = 35500;
  a1[41] = 1;
  a1[42] = -1031798784;
  a1[43] = 1140850688;
  a1[45] = 22;
  a1[46] = 39500;
  a1[47] = 1;
  a1[48] = -1031798784;
  a1[49] = 1145044992;
  a1[51] = 22;
  a1[52] = 42500;
  a1[53] = 1;
  a1[54] = 1140850688;
  a1[55] = 1150287872;
  a1[57] = 21;
  a1[58] = 52500;
  a1[59] = 3;
  a1[60] = 1140850688;
  a1[61] = -1015021568;
  a1[63] = 23;
  a1[64] = 56500;
  a1[65] = 3;
  *a2 = 11;
  return a1;
}

// quest_build_knee_deep_in_the_dead @ 0x00434F00
// quest builder for Tier 5 Quest 5 (Knee-deep in the Dead)
int *__cdecl sub_434F00(int a1, int *a2)
{
  double v2; // st7
  int v3; // ebp
  int v4; // esi
  int v5; // eax
  int i; // ecx
  double v7; // st7
  double v8; // st7
  double v9; // st7
  double v10; // st7
  double v11; // st7
  double v12; // st7
  float v14; // [esp+14h] [ebp-2Ch]
  float v15; // [esp+14h] [ebp-2Ch]
  float v16; // [esp+1Ch] [ebp-24h]
  float v17; // [esp+24h] [ebp-1Ch]
  float v18; // [esp+2Ch] [ebp-14h]
  float v19; // [esp+34h] [ebp-Ch]
  float v20; // [esp+3Ch] [ebp-4h]

  v2 = (double)terrain_texture_height * 0.5;
  *(_DWORD *)a1 = -1035468800;
  v14 = v2;
  *(float *)(a1 + 4) = v14;
  *(_DWORD *)(a1 + 12) = 67;
  *(_DWORD *)(a1 + 16) = 100;
  *(_DWORD *)(a1 + 20) = 1;
  v3 = 0;
  v4 = 1;
  v5 = a1 + 24;
  for ( i = 500; i < 96500; i += 1500 )
  {
    if ( !(v3 % 8) )
    {
      v7 = (double)terrain_texture_height;
      *(_DWORD *)v5 = -1035468800;
      ++v4;
      v5 += 24;
      v15 = v7 * 0.5;
      *(float *)(v5 - 20) = v15;
      *(_DWORD *)(v5 - 12) = 67;
      *(_DWORD *)(v5 - 8) = i - 2;
      *(_DWORD *)(v5 - 4) = 1;
    }
    v8 = (double)terrain_texture_height;
    *(_DWORD *)v5 = -1035468800;
    v16 = v8 * 0.5;
    *(float *)(v5 + 4) = v16;
    *(_DWORD *)(v5 + 12) = 65;
    *(_DWORD *)(v5 + 16) = i;
    *(_DWORD *)(v5 + 20) = (v3 > 32) + 1;
    ++v4;
    v5 += 24;
    if ( i > 12500 )
    {
      v9 = (double)terrain_texture_height;
      *(_DWORD *)v5 = -1035468800;
      ++v4;
      v5 += 24;
      v17 = v9 * 0.5 + 158.0;
      *(float *)(v5 - 20) = v17;
      *(_DWORD *)(v5 - 12) = 65;
      *(_DWORD *)(v5 - 8) = i + 500;
      *(_DWORD *)(v5 - 4) = 1;
    }
    if ( i > 24500 )
    {
      v10 = (double)terrain_texture_height;
      *(_DWORD *)v5 = -1035468800;
      ++v4;
      v5 += 24;
      v18 = v10 * 0.5 - 158.0;
      *(float *)(v5 - 20) = v18;
      *(_DWORD *)(v5 - 12) = 65;
      *(_DWORD *)(v5 - 8) = i + 1000;
      *(_DWORD *)(v5 - 4) = 1;
    }
    if ( i > 36500 )
    {
      v11 = (double)terrain_texture_height;
      *(_DWORD *)v5 = -1035468800;
      ++v4;
      v5 += 24;
      v19 = v11 * 0.5 - 258.0;
      *(float *)(v5 - 20) = v19;
      *(_DWORD *)(v5 - 12) = 66;
      *(_DWORD *)(v5 - 8) = i + 1300;
      *(_DWORD *)(v5 - 4) = 1;
    }
    if ( i > 48500 )
    {
      v12 = (double)terrain_texture_height;
      *(_DWORD *)v5 = -1035468800;
      ++v4;
      v5 += 24;
      v20 = v12 * 0.5 + 258.0;
      *(float *)(v5 - 20) = v20;
      *(_DWORD *)(v5 - 12) = 66;
      *(_DWORD *)(v5 - 8) = i + 300;
      *(_DWORD *)(v5 - 4) = 1;
    }
    ++v3;
  }
  *a2 = v4;
  return a2;
}

// quest_build_the_gang_wars @ 0x00435120
// quest builder for Tier 5 Quest 4 (The Gang Wars)
_DWORD *__cdecl sub_435120(int a1, _DWORD *a2)
{
  double v2; // st7
  double v3; // st7
  int v4; // esi
  int v5; // eax
  int v6; // edx
  double v7; // st7
  int v8; // edx
  int v9; // eax
  double v10; // st7
  float v12; // [esp+14h] [ebp-4h]
  float v13; // [esp+14h] [ebp-4h]
  float v14; // [esp+14h] [ebp-4h]
  float v15; // [esp+14h] [ebp-4h]

  v2 = (double)terrain_texture_height * 0.5;
  *(_DWORD *)a1 = -1021968384;
  v12 = v2;
  *(float *)(a1 + 4) = v12;
  *(_DWORD *)(a1 + 12) = 18;
  *(_DWORD *)(a1 + 16) = 100;
  *(_DWORD *)(a1 + 20) = 1;
  v3 = (double)terrain_texture_height;
  *(_DWORD *)(a1 + 24) = 1150468096;
  v4 = 10;
  v13 = v3 * 0.5;
  *(float *)(a1 + 28) = v13;
  *(_DWORD *)(a1 + 36) = 18;
  *(_DWORD *)(a1 + 40) = 2500;
  *(_DWORD *)(a1 + 44) = 1;
  v5 = a1 + 64;
  v6 = 5500;
  do
  {
    v7 = (double)terrain_texture_height;
    *(_DWORD *)(v5 - 16) = 1150468096;
    v5 += 24;
    v14 = v7 * 0.5;
    *(float *)(v5 - 36) = v14;
    *(_DWORD *)(v5 - 28) = 18;
    *(_DWORD *)(v5 - 24) = v6;
    *(_DWORD *)(v5 - 20) = 2;
    v6 += 4000;
    --v4;
  }
  while ( v4 );
  *(_DWORD *)(a1 + 288) = 1140850688;
  *(_DWORD *)(a1 + 292) = 1150287872;
  *(_DWORD *)(a1 + 300) = 19;
  *(_DWORD *)(a1 + 304) = 50500;
  *(_DWORD *)(a1 + 308) = 1;
  v8 = 59500;
  v9 = a1 + 328;
  do
  {
    v10 = (double)terrain_texture_height;
    *(_DWORD *)(v9 - 16) = -1021968384;
    v9 += 24;
    v15 = v10 * 0.5;
    *(float *)(v9 - 36) = v15;
    *(_DWORD *)(v9 - 28) = 18;
    *(_DWORD *)(v9 - 24) = v8;
    *(_DWORD *)(v9 - 20) = 2;
    v8 += 4000;
  }
  while ( v8 < 99500 );
  *(_DWORD *)(a1 + 552) = 1140850688;
  *(_DWORD *)(a1 + 556) = 1150287872;
  *(_DWORD *)(a1 + 564) = 19;
  *(_DWORD *)(a1 + 568) = 107500;
  *(_DWORD *)(a1 + 572) = 3;
  *a2 = 24;
  return a2;
}

// quest_build_the_fortress @ 0x004352D0
// quest builder for Tier 5 Quest 3 (The Fortress)
int *__cdecl sub_4352D0(int a1, int *a2)
{
  double v2; // st7
  int v4; // ecx
  int v5; // eax
  int v6; // edx
  int v7; // ebp
  int v8; // ecx
  int v9; // esi
  int *result; // eax
  float v11; // [esp+14h] [ebp-Ch]
  float v12; // [esp+14h] [ebp-Ch]
  float v13; // [esp+18h] [ebp-8h]
  float v14; // [esp+1Ch] [ebp-4h]
  int v15; // [esp+24h] [ebp+4h]
  int v16; // [esp+24h] [ebp+4h]

  v2 = (double)terrain_texture_height * 0.5;
  *(_DWORD *)a1 = -1035468800;
  v11 = v2;
  v15 = 512;
  *(float *)(a1 + 4) = v11;
  *(_DWORD *)(a1 + 12) = 64;
  *(_DWORD *)(a1 + 16) = 100;
  *(_DWORD *)(a1 + 20) = 6;
  v4 = 1100;
  v5 = a1 + 40;
  v6 = 8;
  do
  {
    *(_DWORD *)(v5 - 16) = 1145044992;
    v5 += 24;
    v12 = (double)v15 * 0.125 + 256.0;
    *(float *)(v5 - 36) = v12;
    *(_DWORD *)(v5 - 28) = 9;
    *(_DWORD *)(v5 - 24) = v4;
    *(_DWORD *)(v5 - 20) = 1;
    v4 += 600;
    v15 += 512;
  }
  while ( v4 < 5300 );
  *(_DWORD *)(a1 + 192) = 1124073472;
  *(_DWORD *)(a1 + 196) = 1140850688;
  *(_DWORD *)(a1 + 204) = 14;
  v7 = 384;
  *(_DWORD *)(a1 + 208) = 6500;
  *(_DWORD *)(a1 + 212) = 1;
  v16 = 384;
  do
  {
    v8 = 1;
    v9 = 600 * v6 + 5500;
    result = (int *)(a1 + 24 * v6 + 16);
    do
    {
      if ( v8 != 1 || v7 != 1152 && v7 != 1536 )
      {
        ++v6;
        v13 = (double)v16 * 0.16666667 + 256.0;
        *((float *)result - 4) = v13;
        v14 = 512.0 - (double)(384 * v8) * 0.16666667;
        *((float *)result - 3) = v14;
        v7 = v16;
        *(result - 1) = 10;
        *result = v9;
        result[1] = 1;
        v9 += 600;
        result += 6;
      }
      ++v8;
    }
    while ( v8 <= 6 );
    v7 += 384;
    v16 = v7;
  }
  while ( v7 <= 2304 );
  *a2 = v6;
  return result;
}

// quest_build_cross_fire @ 0x00435480
// quest builder for Tier 5 Quest 6 (Cross Fire)
_DWORD *__cdecl sub_435480(int a1, _DWORD *a2)
{
  double v2; // st7
  float v4; // [esp+8h] [ebp-4h]

  v2 = (double)terrain_texture_height * 0.5;
  *(_DWORD *)a1 = 1149648896;
  v4 = v2;
  *(float *)(a1 + 4) = v4;
  *(_DWORD *)(a1 + 12) = 64;
  *(_DWORD *)(a1 + 16) = 100;
  *(_DWORD *)(a1 + 20) = 6;
  *(_DWORD *)(a1 + 24) = -1038090240;
  *(_DWORD *)(a1 + 28) = 1140850688;
  *(_DWORD *)(a1 + 36) = 60;
  *(_DWORD *)(a1 + 40) = 5500;
  *(_DWORD *)(a1 + 44) = 4;
  *(_DWORD *)(a1 + 48) = -1038090240;
  *(_DWORD *)(a1 + 52) = 1140850688;
  *(_DWORD *)(a1 + 60) = 60;
  *(_DWORD *)(a1 + 64) = 15500;
  *(_DWORD *)(a1 + 68) = 6;
  *(_DWORD *)(a1 + 72) = 1140850688;
  *(_DWORD *)(a1 + 76) = 1140850688;
  *(_DWORD *)(a1 + 84) = 1;
  *(_DWORD *)(a1 + 88) = 18500;
  *(_DWORD *)(a1 + 92) = 2;
  *(_DWORD *)(a1 + 96) = -1027080192;
  *(_DWORD *)(a1 + 100) = 1140850688;
  *(_DWORD *)(a1 + 108) = 60;
  *(_DWORD *)(a1 + 112) = 25500;
  *(_DWORD *)(a1 + 116) = 8;
  *(_DWORD *)(a1 + 120) = 1140850688;
  *(_DWORD *)(a1 + 124) = 1150287872;
  *(_DWORD *)(a1 + 132) = 64;
  *(_DWORD *)(a1 + 136) = 26000;
  *(_DWORD *)(a1 + 140) = 6;
  *(_DWORD *)(a1 + 144) = 1140850688;
  *(_DWORD *)(a1 + 148) = -1023410176;
  *(_DWORD *)(a1 + 156) = 64;
  *(_DWORD *)(a1 + 160) = 26000;
  *(_DWORD *)(a1 + 164) = 6;
  *a2 = 7;
  return a2;
}

// quest_build_the_beating @ 0x00435610
// quest builder for Tier 5 Quest 1 (The Beating)
int __cdecl sub_435610(int a1, _DWORD *a2)
{
  int v3; // ebx
  double v4; // st7
  int v5; // edi
  int v6; // ebp
  int v7; // ecx
  int v8; // eax
  double v9; // st7
  double v10; // st7
  int v11; // ebx
  int v12; // edi
  int v13; // ecx
  double v14; // st7
  int v15; // ebx
  int v16; // edi
  int v17; // ecx
  double v18; // st7
  int v19; // ebx
  int v20; // edi
  int v21; // ecx
  int result; // eax
  float v23; // [esp+10h] [ebp-10h]
  float v24; // [esp+10h] [ebp-10h]
  float v25; // [esp+10h] [ebp-10h]
  float v26; // [esp+14h] [ebp-Ch]
  float v27; // [esp+14h] [ebp-Ch]
  float v28; // [esp+14h] [ebp-Ch]
  float v29; // [esp+14h] [ebp-Ch]
  float v30; // [esp+18h] [ebp-8h]
  float v31; // [esp+18h] [ebp-8h]
  float v32; // [esp+1Ch] [ebp-4h]
  float v33; // [esp+1Ch] [ebp-4h]
  int v34; // [esp+24h] [ebp+4h]
  int v35; // [esp+24h] [ebp+4h]
  int v36; // [esp+24h] [ebp+4h]
  int v37; // [esp+24h] [ebp+4h]

  *(_DWORD *)a1 = 1132462080;
  *(_DWORD *)(a1 + 4) = 1132462080;
  *(_DWORD *)(a1 + 12) = 39;
  *(_DWORD *)(a1 + 16) = 500;
  *(_DWORD *)(a1 + 20) = 1;
  v3 = 10000;
  v23 = (float)(terrain_texture_width + 32);
  v4 = (double)(terrain_texture_height / 2);
  *(float *)(a1 + 24) = v23;
  v5 = 64;
  v6 = 8;
  v26 = v4;
  *(float *)(a1 + 28) = v26;
  *(_DWORD *)(a1 + 36) = 41;
  *(_DWORD *)(a1 + 40) = 8000;
  *(_DWORD *)(a1 + 44) = 3;
  v7 = a1 + 64;
  do
  {
    v7 += 24;
    v8 = v5 + terrain_texture_width;
    v5 += 32;
    v24 = (float)v8;
    v9 = (double)(terrain_texture_height / 2);
    *(float *)(v7 - 40) = v24;
    v27 = v9;
    *(float *)(v7 - 36) = v27;
    *(_DWORD *)(v7 - 28) = 37;
    *(_DWORD *)(v7 - 24) = v3;
    *(_DWORD *)(v7 - 20) = 8;
    v3 += 100;
    --v6;
  }
  while ( v6 );
  v34 = terrain_texture_height / 2;
  *(_DWORD *)(a1 + 240) = -1040187392;
  v10 = (double)v34;
  v11 = -64;
  v12 = 20000;
  v13 = a1 + 280;
  v35 = -64;
  v28 = v10;
  *(float *)(a1 + 244) = v28;
  *(_DWORD *)(a1 + 252) = 41;
  *(_DWORD *)(a1 + 256) = 18000;
  *(_DWORD *)(a1 + 260) = 3;
  do
  {
    v11 -= 32;
    v25 = (float)v35;
    v13 += 24;
    v14 = (double)(terrain_texture_height / 2);
    *(float *)(v13 - 40) = v25;
    v35 = v11;
    v29 = v14;
    *(float *)(v13 - 36) = v29;
    *(_DWORD *)(v13 - 28) = 37;
    *(_DWORD *)(v13 - 24) = v12;
    *(_DWORD *)(v13 - 20) = 8;
    v12 += 100;
  }
  while ( v11 > -320 );
  v15 = -64;
  v16 = 40000;
  v17 = a1 + 472;
  v36 = -64;
  do
  {
    v15 -= 42;
    v17 += 24;
    v30 = (float)(terrain_texture_width / 2);
    v18 = (double)v36;
    v36 = v15;
    *(float *)(v17 - 40) = v30;
    v32 = v18;
    *(float *)(v17 - 36) = v32;
    *(_DWORD *)(v17 - 28) = 15;
    *(_DWORD *)(v17 - 24) = v16;
    *(_DWORD *)(v17 - 20) = 4;
    v16 += 100;
  }
  while ( v15 > -316 );
  v19 = 0;
  v20 = 40000;
  v21 = a1 + 616;
  do
  {
    v21 += 24;
    v37 = v19 + terrain_texture_width + 44;
    v19 += 32;
    v31 = (float)(terrain_texture_width / 2);
    *(float *)(v21 - 40) = v31;
    v33 = (float)v37;
    result = LODWORD(v33);
    *(float *)(v21 - 36) = v33;
    *(_DWORD *)(v21 - 28) = 18;
    *(_DWORD *)(v21 - 24) = v20;
    *(_DWORD *)(v21 - 20) = 2;
    v20 += 100;
  }
  while ( v20 < 40600 );
  *a2 = 31;
  return result;
}

// quest_build_the_spanking_of_the_dead @ 0x004358A0
// quest builder for Tier 5 Quest 2 (The Spanking Of The Dead)
_DWORD *__cdecl sub_4358A0(_DWORD *a1, _DWORD *a2)
{
  int v3; // esi
  int v4; // edx
  float *v5; // ecx
  double v6; // st7
  long double v7; // st7
  double v8; // st6
  double v9; // st6
  float v11; // [esp+Ch] [ebp-8h]
  float v12; // [esp+10h] [ebp-4h]
  int v13; // [esp+18h] [ebp+4h]
  float v14; // [esp+18h] [ebp+4h]

  *a1 = 1132462080;
  a1[1] = 1140850688;
  a1[3] = 39;
  a1[4] = 500;
  a1[5] = 1;
  a1[6] = 1145044992;
  a1[7] = 1140850688;
  a1[9] = 39;
  v3 = 0;
  a1[10] = 500;
  a1[11] = 1;
  v13 = 0;
  v4 = 5000;
  v5 = (float *)(a1 + 15);
  do
  {
    v6 = (double)v13;
    v5 += 6;
    ++v3;
    v14 = v6;
    v7 = v6 * 0.33333334;
    v8 = v14 * 3.8;
    v13 = v3;
    v9 = 512.0 - v8;
    v11 = cos(v7) * v9 + 512.0;
    *(v5 - 9) = v11;
    v12 = sin(v7) * v9 + 512.0;
    *(v5 - 8) = v12;
    *(v5 - 7) = v7;
    *((_DWORD *)v5 - 6) = 65;
    *((_DWORD *)v5 - 5) = v4;
    *((_DWORD *)v5 - 4) = 1;
    v4 += 300;
  }
  while ( v4 < 43400 );
  a1[780] = 1151336448;
  a1[781] = 1140850688;
  a1[783] = 66;
  a1[784] = 300 * v3 + 10000;
  a1[785] = 16;
  a1[786] = -1015021568;
  a1[787] = 1140850688;
  a1[789] = 66;
  a1[790] = 300 * v3 + 20000;
  a1[791] = 16;
  *a2 = 132;
  return a2;
}

// quest_build_hidden_evil @ 0x00435A30
// quest builder for Tier 3 Quest 4 (Hidden Evil)
int __cdecl sub_435A30(int a1, _DWORD *a2)
{
  double v2; // st7
  double v3; // st7
  double v4; // st7
  double v5; // st7
  double v6; // st7
  float v8; // [esp+4h] [ebp-8h]
  float v9; // [esp+4h] [ebp-8h]
  float v10; // [esp+4h] [ebp-8h]
  float v11; // [esp+4h] [ebp-8h]
  float v12; // [esp+4h] [ebp-8h]
  float v13; // [esp+8h] [ebp-4h]
  float v14; // [esp+8h] [ebp-4h]
  float v15; // [esp+8h] [ebp-4h]
  float v16; // [esp+8h] [ebp-4h]
  float v17; // [esp+8h] [ebp-4h]

  v8 = (float)(terrain_texture_width / 2);
  v2 = (double)(terrain_texture_height + 64);
  *(float *)a1 = v8;
  v13 = v2;
  *(float *)(a1 + 4) = v13;
  *(_DWORD *)(a1 + 12) = 33;
  *(_DWORD *)(a1 + 16) = 500;
  *(_DWORD *)(a1 + 20) = 50;
  v9 = (float)(terrain_texture_width / 2);
  v3 = (double)(terrain_texture_height + 64);
  *(float *)(a1 + 24) = v9;
  v14 = v3;
  *(float *)(a1 + 28) = v14;
  *(_DWORD *)(a1 + 36) = 34;
  *(_DWORD *)(a1 + 40) = 15000;
  *(_DWORD *)(a1 + 44) = 30;
  v10 = (float)(terrain_texture_width / 2);
  v4 = (double)(terrain_texture_height + 64);
  *(float *)(a1 + 48) = v10;
  v15 = v4;
  *(float *)(a1 + 52) = v15;
  *(_DWORD *)(a1 + 60) = 35;
  *(_DWORD *)(a1 + 64) = 25000;
  *(_DWORD *)(a1 + 68) = 20;
  v11 = (float)(terrain_texture_width / 2);
  v5 = (double)(terrain_texture_height + 64);
  *(float *)(a1 + 72) = v11;
  v16 = v5;
  *(float *)(a1 + 76) = v16;
  *(_DWORD *)(a1 + 84) = 35;
  *(_DWORD *)(a1 + 88) = 30000;
  *(_DWORD *)(a1 + 92) = 30;
  v12 = (float)(terrain_texture_width / 2);
  v6 = (double)(terrain_texture_height + 64);
  *(float *)(a1 + 96) = v12;
  v17 = v6;
  *(float *)(a1 + 100) = v17;
  *(_DWORD *)(a1 + 108) = 34;
  *(_DWORD *)(a1 + 112) = 35000;
  *(_DWORD *)(a1 + 116) = 30;
  *a2 = 5;
  return LODWORD(v17);
}

// quest_build_land_hostile @ 0x00435BD0
// quest builder for Tier 1 Quest 1 (Land Hostile)
_DWORD *__cdecl sub_435BD0(int a1, _DWORD *a2)
{
  double v2; // st7
  float v4; // [esp+4h] [ebp-8h]
  float v5; // [esp+8h] [ebp-4h]

  v4 = (float)(terrain_texture_width / 2);
  v2 = (double)(terrain_texture_height + 64);
  *(float *)a1 = v4;
  v5 = v2;
  *(float *)(a1 + 4) = v5;
  *(_DWORD *)(a1 + 12) = 38;
  *(_DWORD *)(a1 + 16) = 500;
  *(_DWORD *)(a1 + 20) = 1;
  *(_DWORD *)(a1 + 24) = -1031798784;
  *(_DWORD *)(a1 + 28) = 1149763584;
  *(_DWORD *)(a1 + 36) = 38;
  *(_DWORD *)(a1 + 40) = 2500;
  *(_DWORD *)(a1 + 44) = 2;
  *(_DWORD *)(a1 + 48) = -1031798784;
  *(_DWORD *)(a1 + 52) = -1031798784;
  *(_DWORD *)(a1 + 60) = 38;
  *(_DWORD *)(a1 + 64) = 6500;
  *(_DWORD *)(a1 + 68) = 3;
  *(_DWORD *)(a1 + 72) = 1149763584;
  *(_DWORD *)(a1 + 76) = -1031798784;
  *(_DWORD *)(a1 + 84) = 38;
  *(_DWORD *)(a1 + 88) = 11500;
  *(_DWORD *)(a1 + 92) = 4;
  *a2 = 4;
  return a2;
}

// quest_build_minor_alien_breach @ 0x00435CC0
// quest builder for Tier 1 Quest 2 (Minor Alien Breach)
int __cdecl sub_435CC0(_DWORD *a1, int *a2)
{
  int v2; // edi
  int v3; // ebx
  float *v4; // ecx
  double v5; // st7
  int result; // eax
  int v7; // esi
  double v8; // st7
  double v9; // st7
  int v10; // eax
  float v11; // [esp+10h] [ebp-20h]
  float v12; // [esp+14h] [ebp-1Ch]
  float v13; // [esp+18h] [ebp-18h]
  float v14; // [esp+1Ch] [ebp-14h]
  float v15; // [esp+20h] [ebp-10h]
  float v16; // [esp+24h] [ebp-Ch]
  float v17; // [esp+2Ch] [ebp-4h]

  *a1 = 1132462080;
  a1[1] = 1132462080;
  a1[3] = 38;
  v2 = 2;
  a1[4] = 1000;
  a1[5] = 2;
  a1[6] = 1132462080;
  a1[7] = 1124073472;
  a1[9] = 38;
  a1[10] = 1700;
  a1[11] = 2;
  v3 = 2;
  v4 = (float *)(a1 + 12);
  do
  {
    v4 += 6;
    v11 = (float)(terrain_texture_width + 64);
    v5 = (double)(terrain_texture_height / 2);
    *(v4 - 6) = v11;
    v12 = v5;
    *(v4 - 5) = v12;
    *((_DWORD *)v4 - 3) = 38;
    result = 5 * (5 * v3 - 10);
    v7 = 720 * (5 * v3 - 10);
    *((_DWORD *)v4 - 2) = v7;
    *((_DWORD *)v4 - 1) = 1;
    ++v2;
    if ( v3 > 6 )
    {
      ++v2;
      v13 = (float)(terrain_texture_width + 64);
      result = LODWORD(v13);
      v8 = (double)(terrain_texture_height / 2 - 256);
      *v4 = v13;
      v4 += 6;
      v14 = v8;
      *(v4 - 5) = v14;
      *((_DWORD *)v4 - 3) = 38;
      *((_DWORD *)v4 - 2) = v7;
      *((_DWORD *)v4 - 1) = 1;
    }
    if ( v3 == 13 )
    {
      ++v2;
      v4 += 6;
      v15 = (float)(terrain_texture_width / 2);
      v9 = (double)(terrain_texture_height + 64);
      *(v4 - 6) = v15;
      v16 = v9;
      *(v4 - 5) = v16;
      *((_DWORD *)v4 - 3) = 41;
      *((_DWORD *)v4 - 2) = 39600;
      *((_DWORD *)v4 - 1) = 1;
    }
    else if ( v3 <= 10 )
    {
      goto LABEL_8;
    }
    v10 = terrain_texture_height / 2 + 256;
    *v4 = -64.0;
    ++v2;
    v4 += 6;
    v17 = (float)v10;
    result = LODWORD(v17);
    *(v4 - 5) = v17;
    *((_DWORD *)v4 - 3) = 38;
    *((_DWORD *)v4 - 2) = v7;
    *((_DWORD *)v4 - 1) = 1;
LABEL_8:
    ++v3;
  }
  while ( v3 <= 17 );
  *a2 = v2;
  return result;
}

// quest_build_alien_squads @ 0x00435EA0
// quest builder for Tier 1 Quest 8 (Alien Squads)
int *__cdecl sub_435EA0(_DWORD *a1, int *a2)
{
  int v2; // edx
  _DWORD *v3; // eax
  int i; // ecx
  _DWORD *v5; // eax

  *a1 = -1015021568;
  a1[1] = 1132462080;
  a1[3] = 18;
  a1[4] = 1500;
  a1[5] = 1;
  a1[6] = -1015021568;
  a1[7] = 1145044992;
  a1[9] = 18;
  a1[10] = 2500;
  a1[11] = 1;
  a1[12] = 1145044992;
  a1[13] = -1015021568;
  a1[15] = 18;
  a1[16] = 5500;
  a1[17] = 1;
  a1[18] = 1145044992;
  a1[19] = 1151336448;
  a1[21] = 18;
  a1[22] = 8500;
  a1[23] = 1;
  a1[24] = 1151336448;
  a1[25] = 1151336448;
  a1[27] = 18;
  a1[28] = 14500;
  a1[29] = 1;
  a1[30] = 1151336448;
  a1[31] = 1145044992;
  a1[33] = 18;
  a1[34] = 18500;
  a1[35] = 1;
  a1[36] = -1015021568;
  a1[37] = 1132462080;
  a1[39] = 18;
  a1[40] = 25000;
  a1[41] = 1;
  a1[42] = -1015021568;
  a1[43] = 1145044992;
  a1[45] = 18;
  a1[46] = 30000;
  a1[47] = 1;
  v2 = 8;
  v3 = a1 + 48;
  for ( i = 36200; i < 83000; i += 1800 )
  {
    *v3 = -1031798784;
    v3[1] = -1031798784;
    v3[3] = 38;
    v3[4] = i - 400;
    v3[5] = 1;
    v5 = v3 + 6;
    v2 += 2;
    *v5 = 1149763584;
    v5[1] = 1149763584;
    v5[3] = 38;
    v5[4] = i;
    v5[5] = 1;
    v3 = v5 + 6;
  }
  *a2 = v2;
  return a2;
}

// quest_build_zombie_masters @ 0x004360A0
// quest builder for Tier 3 Quest 10 (Zombie Masters)
_DWORD *__cdecl sub_4360A0(_DWORD *a1, _DWORD *a2)
{
  *a1 = 1132462080;
  a1[1] = 1132462080;
  a1[3] = 0;
  a1[4] = 1000;
  a1[5] = config_player_count;
  a1[6] = 1140850688;
  a1[7] = 1132462080;
  a1[9] = 0;
  a1[10] = 6000;
  a1[11] = 1;
  a1[12] = 1145044992;
  a1[13] = 1132462080;
  a1[15] = 0;
  a1[16] = 14000;
  a1[17] = config_player_count;
  a1[18] = 1145044992;
  a1[19] = 1145044992;
  a1[21] = 0;
  a1[22] = 18000;
  a1[23] = 1;
  *a2 = 4;
  return a2;
}

// quest_build_8_legged_terror @ 0x00436120
// quest builder for Tier 1 Quest 10 (8-legged Terror)
_DWORD *__cdecl sub_436120(int a1, int *a2)
{
  int v2; // edx
  _DWORD *result; // eax
  int i; // ecx
  _DWORD *v5; // eax

  *(float *)a1 = (float)(terrain_texture_width - 256);
  v2 = 1;
  result = (_DWORD *)(a1 + 24);
  *(float *)(a1 + 4) = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 12) = 58;
  *(_DWORD *)(a1 + 16) = 1000;
  *(_DWORD *)(a1 + 20) = 1;
  for ( i = 6000; i < 36800; i += 2200 )
  {
    *result = -1043857408;
    result[1] = -1043857408;
    result[3] = 61;
    result[4] = i;
    result[5] = config_player_count;
    v5 = result + 6;
    *v5 = 1149444096;
    v5[1] = -1043857408;
    v5[3] = 61;
    v5[4] = i;
    v5[5] = 1;
    v5 += 6;
    *v5 = -1043857408;
    v5[1] = 1149444096;
    v5[3] = 61;
    v5[4] = i;
    v5[5] = config_player_count;
    v5 += 6;
    v2 += 4;
    *v5 = 1149444096;
    v5[1] = 1149444096;
    v5[3] = 61;
    v5[4] = i;
    v5[5] = 1;
    result = v5 + 6;
  }
  *a2 = v2;
  return result;
}

// quest_build_ghost_patrols @ 0x00436200
// quest builder for Tier 2 Quest 9 (Ghost Patrols)
int __cdecl sub_436200(int a1, _DWORD *a2)
{
  int v2; // ebx
  int v3; // esi
  int v4; // edi
  int result; // eax

  v2 = 2500;
  v3 = a1 + 36;
  *(float *)a1 = (float)(terrain_texture_width + 128);
  v4 = 0;
  *(float *)(a1 + 4) = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 12) = 43;
  *(_DWORD *)(a1 + 16) = 1500;
  *(_DWORD *)(a1 + 20) = 2;
  do
  {
    if ( v4 % 2 )
      *(_DWORD *)(v3 - 12) = 1150287872;
    else
      *(_DWORD *)(v3 - 12) = -1023410176;
    v3 += 24;
    ++v4;
    *(float *)(v3 - 32) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v3 - 24) = 25;
    *(_DWORD *)(v3 - 20) = v2;
    *(_DWORD *)(v3 - 16) = 1;
    v2 += 2500;
  }
  while ( v2 < 32500 );
  *(_DWORD *)(a1 + 312) = -1014759424;
  *(float *)(a1 + 316) = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 324) = 43;
  *(_DWORD *)(a1 + 328) = 2500 * v4 - 2500;
  *(_DWORD *)(a1 + 332) = 1;
  *(_DWORD *)(a1 + 336) = -1023410176;
  *(float *)(a1 + 340) = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 348) = 24;
  result = 500 * (5 * v4 + 15);
  *(_DWORD *)(a1 + 352) = result;
  *(_DWORD *)(a1 + 356) = 1;
  *a2 = 15;
  return result;
}

// quest_build_the_random_factor @ 0x00436350
// quest builder for Tier 1 Quest 6 (The Random Factor)
int __cdecl sub_436350(int a1, _DWORD *a2)
{
  int v2; // esi
  int i; // edi
  int v4; // ecx
  int v5; // esi
  int v6; // ecx
  int v7; // eax
  int result; // eax
  int v9; // et2
  int v10; // ecx

  v2 = 0;
  for ( i = 1500; i < 101500; i += 10000 )
  {
    v4 = a1 + 24 * v2;
    *(float *)v4 = (float)(terrain_texture_width + 64);
    v5 = v2 + 1;
    *(float *)(v4 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v4 + 12) = 29;
    *(_DWORD *)(v4 + 16) = i;
    *(_DWORD *)(v4 + 20) = 2 * config_player_count + 4;
    v6 = a1 + 24 * v5;
    *(_DWORD *)v6 = -1031798784;
    v2 = v5 + 1;
    *(float *)(v6 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v6 + 12) = 29;
    *(_DWORD *)(v6 + 16) = i + 200;
    *(_DWORD *)(v6 + 20) = 6;
    v7 = crt_rand();
    v9 = v7 % 5;
    result = v7 / 5;
    if ( v9 == 3 )
    {
      v10 = a1 + 24 * v2++;
      *(float *)v10 = (float)(terrain_texture_width / 2);
      *(_DWORD *)(v10 + 4) = 1149763584;
      *(_DWORD *)(v10 + 12) = 41;
      *(_DWORD *)(v10 + 16) = i;
      result = config_player_count;
      *(_DWORD *)(v10 + 20) = config_player_count;
    }
  }
  *a2 = v2;
  return result;
}

// quest_build_spider_wave_syndrome @ 0x00436440
// quest builder for Tier 1 Quest 7 (Spider Wave Syndrome)
int __cdecl sub_436440(int a1, _DWORD *a2)
{
  int v2; // esi
  int i; // edi
  int v4; // ecx
  int result; // eax

  v2 = 0;
  for ( i = 1500; i < 100500; i += 5500 )
  {
    v4 = a1 + 24 * v2;
    *(_DWORD *)v4 = -1031798784;
    ++v2;
    *(float *)(v4 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v4 + 12) = 64;
    *(_DWORD *)(v4 + 16) = i;
    result = 2 * config_player_count + 6;
    *(_DWORD *)(v4 + 20) = result;
  }
  *a2 = v2;
  return result;
}

// quest_build_nesting_grounds @ 0x004364A0
// quest builder for Tier 1 Quest 9 (Nesting Grounds)
_DWORD *__cdecl sub_4364A0(int a1, _DWORD *a2)
{
  *(float *)a1 = (float)(terrain_texture_width / 2);
  *(float *)(a1 + 4) = (float)(terrain_texture_height + 64);
  *(_DWORD *)(a1 + 12) = 29;
  *(_DWORD *)(a1 + 16) = 1500;
  *(_DWORD *)(a1 + 20) = 2 * config_player_count + 6;
  *(_DWORD *)(a1 + 24) = 1132462080;
  *(_DWORD *)(a1 + 28) = 1132462080;
  *(_DWORD *)(a1 + 36) = 9;
  *(_DWORD *)(a1 + 40) = 8000;
  *(_DWORD *)(a1 + 44) = 1;
  *(_DWORD *)(a1 + 48) = 1140850688;
  *(_DWORD *)(a1 + 52) = 1140850688;
  *(_DWORD *)(a1 + 60) = 9;
  *(_DWORD *)(a1 + 64) = 13000;
  *(_DWORD *)(a1 + 68) = 1;
  *(_DWORD *)(a1 + 72) = 1145044992;
  *(_DWORD *)(a1 + 76) = 1145044992;
  *(_DWORD *)(a1 + 84) = 9;
  *(_DWORD *)(a1 + 88) = 18000;
  *(_DWORD *)(a1 + 92) = 1;
  *(float *)(a1 + 96) = (float)(terrain_texture_width / 2);
  *(float *)(a1 + 100) = (float)(terrain_texture_height + 64);
  *(_DWORD *)(a1 + 108) = 29;
  *(_DWORD *)(a1 + 112) = 25000;
  *(_DWORD *)(a1 + 116) = 2 * config_player_count + 6;
  *(float *)(a1 + 120) = (float)(terrain_texture_width / 2);
  *(float *)(a1 + 124) = (float)(terrain_texture_height + 64);
  *(_DWORD *)(a1 + 132) = 29;
  *(_DWORD *)(a1 + 136) = 39000;
  *(_DWORD *)(a1 + 140) = 3 * config_player_count + 3;
  *(_DWORD *)(a1 + 144) = 1136656384;
  *(_DWORD *)(a1 + 148) = 1140850688;
  *(_DWORD *)(a1 + 156) = 9;
  *(_DWORD *)(a1 + 160) = 41100;
  *(_DWORD *)(a1 + 164) = 1;
  *(_DWORD *)(a1 + 168) = 1142947840;
  *(_DWORD *)(a1 + 172) = 1140850688;
  *(_DWORD *)(a1 + 180) = 9;
  *(_DWORD *)(a1 + 184) = 42100;
  *(_DWORD *)(a1 + 188) = 1;
  *(_DWORD *)(a1 + 192) = 1140850688;
  *(_DWORD *)(a1 + 196) = 1142947840;
  *(_DWORD *)(a1 + 204) = 9;
  *(_DWORD *)(a1 + 208) = 43100;
  *(_DWORD *)(a1 + 212) = 1;
  *(_DWORD *)(a1 + 216) = 1140850688;
  *(_DWORD *)(a1 + 220) = 1140850688;
  *(_DWORD *)(a1 + 228) = 8;
  *(_DWORD *)(a1 + 232) = 44100;
  *(_DWORD *)(a1 + 236) = 1;
  *(float *)(a1 + 240) = (float)(terrain_texture_width / 2);
  *(float *)(a1 + 244) = (float)(terrain_texture_height + 64);
  *(_DWORD *)(a1 + 252) = 30;
  *(_DWORD *)(a1 + 256) = 50000;
  *(_DWORD *)(a1 + 260) = 2 * config_player_count + 5;
  *(float *)(a1 + 264) = (float)(terrain_texture_width / 2);
  *(float *)(a1 + 268) = (float)(terrain_texture_height + 64);
  *(_DWORD *)(a1 + 276) = 31;
  *(_DWORD *)(a1 + 280) = 55000;
  *(_DWORD *)(a1 + 284) = 2 * config_player_count + 2;
  *a2 = 12;
  return a2;
}

// quest_build_alien_dens @ 0x00436720
// quest builder for Tier 1 Quest 5 (Alien Dens)
_DWORD *__cdecl sub_436720(_DWORD *a1, _DWORD *a2)
{
  *a1 = 1132462080;
  a1[1] = 1132462080;
  a1[3] = 8;
  a1[4] = 1500;
  a1[5] = 1;
  a1[6] = 1145044992;
  a1[7] = 1145044992;
  a1[9] = 8;
  a1[10] = 1500;
  a1[11] = 1;
  a1[12] = 1140850688;
  a1[13] = 1140850688;
  a1[15] = 8;
  a1[16] = 23500;
  a1[17] = config_player_count;
  a1[18] = 1132462080;
  a1[19] = 1145044992;
  a1[21] = 8;
  a1[22] = 38500;
  a1[23] = 1;
  a1[24] = 1145044992;
  a1[25] = 1132462080;
  a1[27] = 8;
  a1[28] = 38500;
  a1[29] = 1;
  *a2 = 5;
  return a2;
}

// quest_build_arachnoid_farm @ 0x00436820
// quest builder for Tier 2 Quest 3 (Arachnoid Farm)
int __cdecl sub_436820(int a1, int *a2)
{
  int v2; // edx
  int v3; // ecx
  int v4; // esi
  int v5; // eax
  double v6; // st7
  int v7; // edi
  int v8; // esi
  int v9; // eax
  double v10; // st7
  int v11; // esi
  int v12; // edx
  int result; // eax
  double v14; // st7
  int v15; // [esp+10h] [ebp-Ch]
  int v16; // [esp+10h] [ebp-Ch]
  int v17; // [esp+10h] [ebp-Ch]
  float v18; // [esp+14h] [ebp-8h]
  float v19; // [esp+14h] [ebp-8h]
  float v20; // [esp+14h] [ebp-8h]

  v2 = config_player_count;
  v3 = 0;
  v15 = 0;
  if ( config_player_count + 4 > 0 )
  {
    v4 = 500;
    v5 = a1 + 16;
    do
    {
      v6 = (double)v15;
      ++v3;
      v5 += 24;
      v15 = v3;
      v18 = v6 * 102.4 + 256.0;
      *(float *)(v5 - 40) = v18;
      *(_DWORD *)(v5 - 36) = 1132462080;
      *(_DWORD *)(v5 - 28) = 10;
      *(_DWORD *)(v5 - 24) = v4;
      *(_DWORD *)(v5 - 20) = 1;
      v2 = config_player_count;
      v4 += 500;
    }
    while ( v3 < config_player_count + 4 );
  }
  v7 = 0;
  v16 = 0;
  if ( v2 + 4 > 0 )
  {
    v8 = 10500;
    v9 = a1 + 24 * v3 + 16;
    do
    {
      ++v3;
      v9 += 24;
      ++v7;
      v10 = (double)v16 * 102.4;
      v16 = v7;
      v19 = v10 + 256.0;
      *(float *)(v9 - 40) = v19;
      *(_DWORD *)(v9 - 36) = 1145044992;
      *(_DWORD *)(v9 - 28) = 10;
      *(_DWORD *)(v9 - 24) = v8;
      *(_DWORD *)(v9 - 20) = 1;
      v2 = config_player_count;
      v8 += 500;
    }
    while ( v7 < config_player_count + 4 );
  }
  v11 = 0;
  v17 = 0;
  if ( v2 + 7 <= 0 )
  {
    *a2 = v3;
    return (int)a2;
  }
  else
  {
    v12 = 40500;
    result = a1 + 24 * v3 + 16;
    do
    {
      ++v3;
      result += 24;
      ++v11;
      v14 = (double)v17 * 64.0;
      v17 = v11;
      v20 = v14 + 256.0;
      *(float *)(result - 40) = v20;
      *(_DWORD *)(result - 36) = 1140850688;
      *(_DWORD *)(result - 28) = 16;
      *(_DWORD *)(result - 24) = v12;
      *(_DWORD *)(result - 20) = 1;
      v12 += 3500;
    }
    while ( v11 < config_player_count + 7 );
    *a2 = v3;
  }
  return result;
}

// quest_build_gauntlet @ 0x004369A0
// quest builder for Tier 4 Quest 7 (Gauntlet)
char __cdecl sub_4369A0(int a1, int *a2)
{
  int v2; // edx
  int v3; // esi
  int v4; // ecx
  int v5; // edi
  int v6; // eax
  double v7; // st7
  int v8; // edi
  int v9; // ebx
  int v10; // ecx
  int v11; // ecx
  int v12; // ebx
  int v13; // edi
  int v14; // eax
  double v15; // st7
  char result; // al
  int v17; // [esp+4h] [ebp-8h]
  int v18; // [esp+8h] [ebp-4h]
  int v19; // [esp+8h] [ebp-4h]
  int v20; // [esp+10h] [ebp+4h]

  v2 = config_player_count;
  v3 = 0;
  v17 = 0;
  if ( config_hardcore )
  {
    v2 = config_player_count + 4;
    config_player_count += 4;
  }
  v4 = a1;
  v18 = v2 + 9;
  if ( v2 + 9 > 0 )
  {
    v5 = 0;
    v6 = a1 + 12;
    do
    {
      v6 += 24;
      v7 = (double)v17 * 6.2831855;
      *(float *)(v6 - 36) = cos(v7 / (double)v18) * 158.0 + 512.0;
      v17 = ++v3;
      *(float *)(v6 - 32) = sin(v7 / (double)(config_player_count + 9)) * 158.0 + 512.0;
      *(_DWORD *)(v6 - 24) = 10;
      *(_DWORD *)(v6 - 20) = v5;
      *(_DWORD *)(v6 - 16) = 1;
      v2 = config_player_count;
      v5 += 200;
      v18 = config_player_count + 9;
    }
    while ( v3 < config_player_count + 9 );
  }
  if ( v2 + 9 > 0 )
  {
    v8 = 2;
    v9 = 4000;
    v10 = a1 + 24 * v3;
    do
    {
      v11 = v10 + 72;
      *(float *)(v11 - 72) = (float)(terrain_texture_width + 64);
      v10 = v11 + 24;
      *(float *)(v10 - 92) = (float)(terrain_texture_width / 2);
      *(_DWORD *)(v10 - 84) = 65;
      *(_DWORD *)(v10 - 80) = v9;
      *(_DWORD *)(v10 - 76) = v8;
      *(_DWORD *)(v10 - 72) = -1031798784;
      *(float *)(v10 - 68) = (float)(terrain_texture_width / 2);
      *(_DWORD *)(v10 - 60) = 65;
      *(_DWORD *)(v10 - 56) = v9;
      *(_DWORD *)(v10 - 52) = v8;
      *(float *)(v10 - 48) = (float)(terrain_texture_width / 2);
      *(float *)(v10 - 44) = (float)(terrain_texture_width + 64);
      *(_DWORD *)(v10 - 36) = 65;
      *(_DWORD *)(v10 - 32) = v9;
      *(_DWORD *)(v10 - 28) = v8;
      v3 += 4;
      *(float *)(v10 - 24) = (float)(terrain_texture_width / 2);
      *(_DWORD *)(v10 - 20) = -1031798784;
      *(_DWORD *)(v10 - 12) = 65;
      *(_DWORD *)(v10 - 8) = v9;
      *(_DWORD *)(v10 - 4) = v8;
      v2 = config_player_count;
      v9 += 5500;
      ++v8;
    }
    while ( v8 - 2 < config_player_count + 9 );
    v4 = a1;
  }
  v12 = 0;
  v20 = 0;
  v19 = v2 + 17;
  if ( v2 + 17 > 0 )
  {
    v13 = 42500;
    v14 = v4 + 24 * v3 + 12;
    do
    {
      v14 += 24;
      v15 = (double)v20 * 6.2831855;
      *(float *)(v14 - 36) = cos(v15 / (double)v19) * 258.0 + 512.0;
      ++v3;
      v20 = ++v12;
      *(float *)(v14 - 32) = sin(v15 / (double)(config_player_count + 17)) * 258.0 + 512.0;
      *(_DWORD *)(v14 - 24) = 10;
      *(_DWORD *)(v14 - 20) = v13;
      *(_DWORD *)(v14 - 16) = 1;
      v2 = config_player_count;
      v13 += 500;
      v19 = config_player_count + 17;
    }
    while ( v12 < config_player_count + 17 );
  }
  result = config_hardcore;
  if ( config_hardcore )
    config_player_count = v2 - 4;
  else
    result = (char)a2;
  *a2 = v3;
  return result;
}

// quest_build_syntax_terror @ 0x00436C10
// quest builder for Tier 4 Quest 8 (Syntax Terror)
int __cdecl sub_436C10(int a1, _DWORD *a2)
{
  int v2; // ebp
  int result; // eax
  int v4; // ecx
  int v5; // edi
  int v6; // edx
  int v7; // esi
  int v8; // edx
  int v9; // ebx
  int v10; // ecx
  int v11; // eax
  int v12; // [esp+4h] [ebp-1Ch]
  int v13; // [esp+8h] [ebp-18h]
  int v14; // [esp+Ch] [ebp-14h]
  int v15; // [esp+10h] [ebp-10h]
  int v16; // [esp+14h] [ebp-Ch]
  int v17; // [esp+18h] [ebp-8h]
  int v18; // [esp+1Ch] [ebp-4h]

  v2 = 0;
  v12 = 0;
  if ( config_hardcore )
    config_player_count += 4;
  result = config_player_count;
  v4 = 0;
  v5 = 1500;
  v6 = 5321;
  v13 = 0;
  v15 = 1500;
  v14 = 5321;
  do
  {
    v7 = 0;
    if ( result + 9 > 0 )
    {
      v8 = v4 * v6;
      v16 = v8;
      v9 = 1221;
      v18 = v4 * (76 * v4 * v4 + 27);
      v10 = a1 + 24 * v2 + 12;
      while ( 1 )
      {
        v10 += 24;
        v11 = v9;
        v9 += 21;
        *(float *)(v10 - 36) = (float)((v8 + v7 * (76 * v7 * v7 + 236)) % 896 + 64);
        v2 = v12 + 1;
        v17 = (v18 + v7 * v11) % 896 + 64;
        ++v7;
        ++v12;
        *(float *)(v10 - 32) = (float)v17;
        *(_DWORD *)(v10 - 24) = 7;
        *(_DWORD *)(v10 - 20) = v5;
        *(_DWORD *)(v10 - 16) = 1;
        result = config_player_count;
        v5 += 300;
        if ( v7 >= config_player_count + 9 )
          break;
        v8 = v16;
      }
      v6 = v14;
      v4 = v13;
    }
    v6 += 53;
    ++v4;
    v5 = v15 + 30000;
    v13 = v4;
    v14 = v6;
    v15 += 30000;
  }
  while ( v6 < 5533 );
  if ( config_hardcore )
  {
    config_player_count = result - 4;
    result = (int)a2;
  }
  *a2 = v2;
  return result;
}

// quest_build_spider_spawns @ 0x00436D70
// quest builder for Tier 2 Quest 2 (Spider Spawns)
_DWORD *__cdecl sub_436D70(_DWORD *a1, _DWORD *a2)
{
  *a1 = 1124073472;
  a1[1] = 1124073472;
  a1[3] = 16;
  a1[4] = 1500;
  a1[5] = 1;
  a1[6] = 1147142144;
  a1[7] = 1147142144;
  a1[9] = 16;
  a1[10] = 1500;
  a1[11] = 1;
  a1[12] = 1147142144;
  a1[13] = 1124073472;
  a1[15] = 16;
  a1[16] = 1500;
  a1[17] = 1;
  a1[18] = 1124073472;
  a1[19] = 1147142144;
  a1[21] = 16;
  a1[22] = 1500;
  a1[23] = 1;
  a1[24] = -1031798784;
  a1[25] = 1140850688;
  a1[27] = 56;
  a1[28] = 3000;
  a1[29] = 2;
  a1[30] = 1140850688;
  a1[31] = 1140850688;
  a1[33] = 10;
  a1[34] = 18000;
  a1[35] = 1;
  a1[36] = 1138753536;
  a1[37] = 1138753536;
  a1[39] = 16;
  a1[40] = 20500;
  a1[41] = 1;
  a1[42] = 1141899264;
  a1[43] = 1138753536;
  a1[45] = 16;
  a1[46] = 26000;
  a1[47] = 1;
  a1[48] = 1149763584;
  a1[49] = 1140850688;
  a1[51] = 56;
  a1[52] = 21000;
  a1[53] = 2;
  a1[54] = 1141899264;
  a1[55] = 1141899264;
  a1[57] = 16;
  a1[58] = 31500;
  a1[59] = 1;
  a1[60] = 1138753536;
  a1[61] = 1141899264;
  a1[63] = 16;
  a1[64] = 22000;
  a1[65] = 1;
  *a2 = 11;
  return a2;
}

// quest_build_two_fronts @ 0x00436EE0
// quest builder for Tier 2 Quest 4 (Two Fronts)
_DWORD *__cdecl sub_436EE0(_DWORD *a1, _DWORD *a2)
{
  int v3; // ebx
  int i; // esi
  int v5; // edi
  _DWORD *v6; // ecx
  _DWORD *v7; // ecx

  v3 = 0;
  for ( i = 0; i < 40; ++i )
  {
    a1 += 12;
    *((float *)a1 - 12) = (float)(terrain_texture_width + 64);
    *((float *)a1 - 11) = (float)(terrain_texture_width / 2);
    *(a1 - 9) = 26;
    *(a1 - 8) = 2000 * i + 1000;
    *(a1 - 7) = 1;
    *(a1 - 6) = -1031798784;
    *((float *)a1 - 5) = (float)(terrain_texture_width / 2);
    *(a1 - 3) = 27;
    *(a1 - 2) = 400 * (5 * i + 5);
    *(a1 - 1) = 1;
    v3 += 2;
    if ( i == 10 || i == 20 )
    {
      *a1 = 1132462080;
      v5 = 2000 * i + 2500;
      a1[1] = 1132462080;
      a1[3] = 10;
      a1[4] = v5;
      a1[5] = 1;
      v6 = a1 + 6;
      *v6 = 1145044992;
      v6[1] = 1145044992;
      v6[3] = 7;
      v6[4] = v5;
      v6[5] = 1;
      v3 += 2;
      a1 = v6 + 6;
    }
    if ( i == 30 )
    {
      *a1 = 1145044992;
      a1[1] = 1132462080;
      a1[3] = 10;
      a1[4] = 62500;
      a1[5] = 1;
      v7 = a1 + 6;
      *v7 = 1132462080;
      v7[1] = 1145044992;
      v7[3] = 7;
      v7[4] = 62500;
      v7[5] = 1;
      v3 += 2;
      a1 = v7 + 6;
    }
  }
  *a2 = v3;
  return a2;
}

// quest_build_survival_of_the_fastest @ 0x00437060
// quest builder for Tier 2 Quest 7 (Survival Of The Fastest)
int __cdecl sub_437060(float *a1, _DWORD *a2)
{
  int v3; // ecx
  int v4; // edx
  float *v5; // eax
  double v6; // st7
  int v7; // esi
  float *v8; // edx
  int v9; // esi
  float *v10; // edx
  int v11; // esi
  float *v12; // edx
  int v13; // ebp
  float *v14; // edx
  double v15; // st7
  int v17; // [esp+10h] [ebp-Ch]
  int v18; // [esp+10h] [ebp-Ch]
  int v19; // [esp+10h] [ebp-Ch]
  int v20; // [esp+10h] [ebp-Ch]
  int v21; // [esp+10h] [ebp-Ch]
  float v22; // [esp+14h] [ebp-8h]
  float v23; // [esp+14h] [ebp-8h]
  float v24; // [esp+14h] [ebp-8h]
  float v25; // [esp+18h] [ebp-4h]
  float v26; // [esp+18h] [ebp-4h]
  int v27; // [esp+20h] [ebp+4h]
  int v28; // [esp+20h] [ebp+4h]
  int v29; // [esp+20h] [ebp+4h]
  int v30; // [esp+20h] [ebp+4h]

  v3 = 256;
  v4 = 500;
  v17 = 256;
  v5 = a1 + 4;
  do
  {
    v6 = (double)v17;
    v3 += 72;
    v5 += 6;
    v17 = v3;
    v22 = v6;
    *(v5 - 10) = v22;
    *(v5 - 9) = 256.0;
    *((_DWORD *)v5 - 7) = 16;
    *((_DWORD *)v5 - 6) = v4;
    *((_DWORD *)v5 - 5) = 1;
    v4 += 900;
  }
  while ( v3 < 688 );
  v7 = 256;
  v18 = 5900;
  v27 = 256;
  v8 = a1 + 40;
  do
  {
    v7 += 72;
    *(v8 - 4) = 688.0;
    v8 += 6;
    v25 = (float)v27;
    v27 = v7;
    *(v8 - 9) = v25;
    *((_DWORD *)v8 - 7) = 16;
    *((_DWORD *)v8 - 6) = v18;
    *((_DWORD *)v8 - 5) = 1;
    v18 += 900;
  }
  while ( v7 < 688 );
  v28 = 688;
  v9 = 4;
  v19 = 11300;
  v10 = a1 + 76;
  do
  {
    v10 += 6;
    v23 = (float)v28;
    *(v10 - 10) = v23;
    *(v10 - 9) = 688.0;
    *((_DWORD *)v10 - 7) = 16;
    *((_DWORD *)v10 - 6) = v19;
    *((_DWORD *)v10 - 5) = 1;
    v28 -= 72;
    --v9;
    v19 += 900;
  }
  while ( v9 );
  v29 = 688;
  v11 = 4;
  v20 = 14900;
  v12 = a1 + 100;
  do
  {
    *(v12 - 4) = 400.0;
    v12 += 6;
    v26 = (float)v29;
    *(v12 - 9) = v26;
    *((_DWORD *)v12 - 7) = 16;
    *((_DWORD *)v12 - 6) = v20;
    *((_DWORD *)v12 - 5) = 1;
    v29 -= 72;
    --v11;
    v20 += 900;
  }
  while ( v11 );
  v21 = 18500;
  v13 = 400;
  v30 = 400;
  v14 = a1 + 124;
  do
  {
    v15 = (double)v30;
    v13 += 72;
    v14 += 6;
    v30 = v13;
    v24 = v15;
    *(v14 - 10) = v24;
    *(v14 - 9) = 400.0;
    *((_DWORD *)v14 - 7) = 16;
    *((_DWORD *)v14 - 6) = v21;
    *((_DWORD *)v14 - 5) = 1;
    v21 += 900;
  }
  while ( v13 < 544 );
  a1[132] = 128.0;
  a1[133] = 128.0;
  *((_DWORD *)a1 + 135) = 16;
  *((_DWORD *)a1 + 136) = 22300;
  *((_DWORD *)a1 + 137) = 1;
  a1[138] = 896.0;
  a1[139] = 128.0;
  *((_DWORD *)a1 + 141) = 7;
  *((_DWORD *)a1 + 142) = 22300;
  *((_DWORD *)a1 + 143) = 1;
  a1[144] = 128.0;
  a1[145] = 896.0;
  *((_DWORD *)a1 + 147) = 7;
  *((_DWORD *)a1 + 148) = 24300;
  *((_DWORD *)a1 + 149) = 1;
  a1[150] = 896.0;
  a1[151] = 896.0;
  *((_DWORD *)a1 + 153) = 16;
  *((_DWORD *)a1 + 154) = 24300;
  *((_DWORD *)a1 + 155) = 1;
  *a2 = 26;
  return 26;
}

// quest_build_spideroids @ 0x004373C0
// quest builder for Tier 2 Quest 10 (Spideroids)
int *__cdecl sub_4373C0(int *a1, int *a2)
{
  int *result; // eax
  int v3; // esi
  int *v4; // eax

  result = a1;
  *a1 = 1149763584;
  a1[1] = 1140850688;
  a1[3] = 1;
  a1[4] = 1000;
  a1[5] = 1;
  a1[6] = -1031798784;
  a1[7] = 1140850688;
  a1[9] = 1;
  a1[10] = 3000;
  a1[11] = 1;
  a1[12] = 1149763584;
  a1[13] = 1132462080;
  a1[15] = 1;
  a1[16] = 6000;
  a1[17] = 1;
  v3 = 3;
  if ( config_hardcore )
  {
    a1[18] = 1149763584;
    a1[19] = 1144946688;
    a1[21] = 1;
    a1[22] = 9000;
    a1[23] = 1;
    a1[24] = 1140850688;
    a1[25] = 1149763584;
    a1[27] = 1;
    a1[28] = 9000;
    a1[29] = 1;
    v3 = 5;
  }
  if ( config_player_count >= 2 || config_hardcore )
  {
    v4 = &a1[6 * v3];
    *v4 = -1031798784;
    v4[1] = 1144946688;
    v4[3] = 1;
    v4[4] = 9000;
    v4[5] = 1;
    *a2 = v3 + 1;
    return a2;
  }
  else
  {
    *a2 = v3;
  }
  return result;
}

// quest_build_evil_zombies_at_large @ 0x004374A0
// quest builder for Tier 2 Quest 6 (Evil Zombies At Large)
int __cdecl sub_4374A0(int a1, _DWORD *a2)
{
  int v3; // ebx
  int v4; // esi
  int v5; // edi
  int result; // eax

  v3 = 0;
  v4 = 4;
  v5 = 1500;
  do
  {
    a1 += 96;
    *(float *)(a1 - 96) = (float)(terrain_texture_width + 64);
    *(float *)(a1 - 92) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(a1 - 84) = 65;
    *(_DWORD *)(a1 - 80) = v5;
    *(_DWORD *)(a1 - 76) = v4;
    *(_DWORD *)(a1 - 72) = -1031798784;
    *(float *)(a1 - 68) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(a1 - 60) = 65;
    *(_DWORD *)(a1 - 56) = v5;
    *(_DWORD *)(a1 - 52) = v4;
    *(float *)(a1 - 48) = (float)(terrain_texture_width / 2);
    *(float *)(a1 - 44) = (float)(terrain_texture_width + 64);
    *(_DWORD *)(a1 - 36) = 65;
    *(_DWORD *)(a1 - 32) = v5;
    *(_DWORD *)(a1 - 28) = v4;
    v3 += 4;
    *(float *)(a1 - 24) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(a1 - 20) = -1031798784;
    *(_DWORD *)(a1 - 12) = 65;
    *(_DWORD *)(a1 - 8) = v5;
    *(_DWORD *)(a1 - 4) = v4;
    v5 += 5500;
    result = ++v4 - 4;
  }
  while ( v4 - 4 < 10 );
  *a2 = v3;
  return result;
}

// quest_build_everred_pastures @ 0x004375A0
// quest builder for Tier 2 Quest 1 (Everred Pastures)
_DWORD *__cdecl sub_4375A0(int a1, _DWORD *a2)
{
  int v3; // ebx
  int v4; // ebp
  int v5; // edi
  int v6; // ecx
  int v7; // esi
  int v8; // ecx

  v3 = 0;
  v4 = 0;
  do
  {
    v5 = v4 + 1;
    v6 = a1 + 72;
    *(float *)(v6 - 72) = (float)(terrain_texture_width + 64);
    a1 = v6 + 24;
    *(float *)(a1 - 92) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(a1 - 84) = 50;
    v7 = 13000 * v4 + 1500;
    *(_DWORD *)(a1 - 80) = v7;
    *(_DWORD *)(a1 - 76) = v4 + 1;
    *(_DWORD *)(a1 - 72) = -1031798784;
    *(float *)(a1 - 68) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(a1 - 60) = 51;
    *(_DWORD *)(a1 - 56) = v7;
    *(_DWORD *)(a1 - 52) = v4 + 1;
    *(float *)(a1 - 48) = (float)(terrain_texture_width / 2);
    *(float *)(a1 - 44) = (float)(terrain_texture_width + 64);
    *(_DWORD *)(a1 - 36) = 52;
    *(_DWORD *)(a1 - 32) = v7;
    *(_DWORD *)(a1 - 28) = v4 + 1;
    v3 += 4;
    *(float *)(a1 - 24) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(a1 - 20) = -1031798784;
    *(_DWORD *)(a1 - 12) = 53;
    *(_DWORD *)(a1 - 8) = v7;
    *(_DWORD *)(a1 - 4) = v4 + 1;
    if ( v4 == 3 )
    {
      v8 = a1 + 24;
      *(float *)(v8 - 24) = (float)(terrain_texture_width / 2);
      *(_DWORD *)(v8 - 20) = -1031798784;
      *(_DWORD *)(v8 - 12) = 27;
      *(_DWORD *)(v8 - 8) = 40500;
      *(_DWORD *)(v8 - 4) = 8;
      v3 += 2;
      a1 = v8 + 24;
      *(float *)(a1 - 24) = (float)(terrain_texture_width / 2);
      *(_DWORD *)(a1 - 20) = 1149763584;
      *(_DWORD *)(a1 - 12) = 27;
      *(_DWORD *)(a1 - 8) = 40500;
      *(_DWORD *)(a1 - 4) = 8;
    }
    ++v4;
  }
  while ( v5 < 8 );
  *a2 = v3;
  return a2;
}

// quest_build_lizard_kings @ 0x00437710
// quest builder for Tier 3 Quest 2 (Lizard Kings)
_DWORD *__cdecl sub_437710(_DWORD *a1, _DWORD *a2)
{
  int v3; // ecx
  int v4; // edx
  float *v5; // eax
  double v6; // st7
  int v8; // [esp+14h] [ebp+4h]

  *a1 = 1150287872;
  a1[1] = 1140850688;
  v3 = 1500;
  a1[3] = 17;
  a1[4] = 1500;
  a1[5] = 1;
  a1[6] = -1023410176;
  a1[7] = 1140850688;
  a1[9] = 17;
  a1[10] = 1500;
  a1[11] = 1;
  a1[12] = 1150287872;
  a1[13] = 1147142144;
  a1[15] = 17;
  a1[16] = 1500;
  v4 = 0;
  a1[17] = 1;
  v8 = 0;
  v5 = (float *)(a1 + 21);
  do
  {
    v6 = (double)v8;
    v5 += 6;
    *(v5 - 9) = cos(v6 * 0.34906587) * 256.0 + 512.0;
    *(v5 - 8) = sin(v6 * 0.34906587) * 256.0 + 512.0;
    *((_DWORD *)v5 - 6) = 49;
    *((_DWORD *)v5 - 5) = v3;
    *((_DWORD *)v5 - 4) = 1;
    v3 += 900;
    v8 = ++v4;
    *(v5 - 7) = v6 * -0.34906587;
  }
  while ( v4 < 28 );
  *a2 = 31;
  return a2;
}

// quest_build_sweep_stakes @ 0x00437810
// quest builder for Tier 2 Quest 5 (Sweep Stakes)
_DWORD *__cdecl sub_437810(int a1, _DWORD *a2)
{
  int v2; // esi
  int v3; // edi
  int v4; // eax
  int v5; // ecx
  double v6; // st7
  int v7; // eax
  long double v8; // st7
  long double v9; // st7
  double v10; // st6
  int v11; // eax
  int v13; // [esp+10h] [ebp-18h]
  float v14; // [esp+14h] [ebp-14h]
  float v15; // [esp+18h] [ebp-10h]
  float v16; // [esp+1Ch] [ebp-Ch]
  float v17; // [esp+20h] [ebp-8h]
  int v18; // [esp+2Ch] [ebp+4h]

  v2 = 2000;
  v3 = 2000;
  v18 = a1 + 16;
  do
  {
    v4 = crt_rand();
    v5 = 84;
    v6 = (double)(v4 % 612);
    v7 = v18;
    v13 = 84;
    v18 += 96;
    v8 = v6 * 0.0099999998;
    v14 = cos(v8);
    v9 = sin(v8);
    do
    {
      v10 = (double)v13;
      v5 += 42;
      v7 += 24;
      v13 = v5;
      v17 = v10 * v14;
      v15 = v17 + 512.0;
      *(float *)(v7 - 40) = v15;
      v16 = v10 * v9 + 512.0;
      *(float *)(v7 - 36) = v16;
      *(_DWORD *)(v7 - 28) = 54;
      *(_DWORD *)(v7 - 24) = v2;
      *(_DWORD *)(v7 - 20) = 1;
      *(float *)(v7 - 32) = atan2(*(float *)(v7 - 36) - 512.0, *(float *)(v7 - 40) - 512.0) - 1.5707964;
    }
    while ( v5 < 252 );
    v11 = v3;
    v3 -= 80;
    v2 += v11;
  }
  while ( v3 > 720 );
  *a2 = 64;
  return a2;
}

// quest_build_deja_vu @ 0x00437920
// quest builder for Tier 3 Quest 9 (Deja vu)
_DWORD *__cdecl sub_437920(int a1, _DWORD *a2)
{
  int v2; // esi
  int v3; // ebp
  int v4; // edx
  int v5; // ecx
  int v6; // eax
  long double v7; // st7
  long double v8; // st7
  double v9; // st6
  int v11; // [esp+10h] [ebp-18h]
  float v12; // [esp+14h] [ebp-14h]
  float v13; // [esp+18h] [ebp-10h]
  float v14; // [esp+1Ch] [ebp-Ch]
  float v15; // [esp+20h] [ebp-8h]
  int v16; // [esp+2Ch] [ebp+4h]

  v2 = 2000;
  v11 = 2000;
  v3 = a1 + 16;
  do
  {
    v4 = crt_rand() % 612;
    v5 = 84;
    v6 = v3;
    v3 += 96;
    v16 = 84;
    v7 = (double)v4 * 0.0099999998;
    v12 = cos(v7);
    v8 = sin(v7);
    do
    {
      v9 = (double)v16;
      v5 += 42;
      v6 += 24;
      v16 = v5;
      v15 = v9 * v12;
      v13 = v15 + 512.0;
      *(float *)(v6 - 40) = v13;
      v14 = v9 * v8 + 512.0;
      *(float *)(v6 - 36) = v14;
      *(_DWORD *)(v6 - 28) = 13;
      *(_DWORD *)(v6 - 24) = v2;
      *(_DWORD *)(v6 - 20) = 1;
    }
    while ( v5 < 252 );
    v2 += v11;
    v11 -= 80;
  }
  while ( v11 > 560 );
  *a2 = 72;
  return a2;
}

// quest_build_target_practice @ 0x00437A00
// quest builder for Tier 1 Quest 3 (Target Practice)
int __cdecl sub_437A00(int a1, _DWORD *a2)
{
  int v2; // ebx
  int v3; // edi
  int v4; // esi
  double v5; // st7
  int result; // eax
  float v7; // [esp+10h] [ebp-10h]
  float v8; // [esp+14h] [ebp-Ch]
  float v9; // [esp+18h] [ebp-8h]
  float v10; // [esp+24h] [ebp+4h]

  v2 = 2000;
  v3 = 2000;
  v4 = a1 + 16;
  do
  {
    v10 = (double)(crt_rand() % 612) * 0.0099999998;
    v4 += 24;
    v5 = (double)(32 * (crt_rand() % 8 + 2));
    v9 = cos(v10) * v5;
    v7 = v9 + 512.0;
    *(float *)(v4 - 40) = v7;
    v8 = v5 * sin(v10) + 512.0;
    *(float *)(v4 - 36) = v8;
    *(_DWORD *)(v4 - 28) = 54;
    *(_DWORD *)(v4 - 24) = v2;
    *(_DWORD *)(v4 - 20) = 1;
    result = v3;
    *(float *)(v4 - 32) = atan2(*(float *)(v4 - 36) - 512.0, *(float *)(v4 - 40) - 512.0) - 1.5707964;
    if ( v3 < 1100 )
      result = 1100;
    v3 -= 50;
    v2 += result;
  }
  while ( v3 > 500 );
  *a2 = 30;
  return result;
}

// quest_build_major_alien_breach @ 0x00437AF0
// quest builder for Tier 4 Quest 1 (Major Alien Breach)
_DWORD *__cdecl sub_437AF0(_DWORD *a1, _DWORD *a2)
{
  int v3; // edx
  int v4; // ecx
  int i; // esi
  _DWORD *v6; // eax

  v3 = 0;
  v4 = 4000;
  for ( i = 0; i < 1500; i += 15 )
  {
    *a1 = 1149763584;
    a1[1] = 1140850688;
    a1[3] = 32;
    a1[4] = v4;
    a1[5] = 2;
    v6 = a1 + 6;
    v3 += 2;
    *v6 = 1140850688;
    v6[1] = -1031798784;
    v6[3] = 32;
    v6[4] = v4;
    v6[5] = 2;
    v4 += 2000 - i;
    a1 = v6 + 6;
    if ( v4 < 1000 )
      v4 = 1000;
  }
  *a2 = v3;
  return a2;
}

// quest_build_land_of_lizards @ 0x00437BA0
// quest builder for Tier 2 Quest 8 (Land Of Lizards)
_DWORD *__cdecl sub_437BA0(_DWORD *a1, _DWORD *a2)
{
  *a1 = 1132462080;
  a1[1] = 1132462080;
  a1[3] = 14;
  a1[4] = 2000;
  a1[5] = 1;
  a1[6] = 1145044992;
  a1[7] = 1132462080;
  a1[9] = 14;
  a1[10] = 12000;
  a1[11] = 1;
  a1[12] = 1132462080;
  a1[13] = 1145044992;
  a1[15] = 14;
  a1[16] = 22000;
  a1[17] = 1;
  a1[18] = 1145044992;
  a1[19] = 1145044992;
  a1[21] = 14;
  a1[22] = 32000;
  a1[23] = 1;
  *a2 = 4;
  return a2;
}

// quest_build_the_lizquidation @ 0x00437C70
// quest builder for Tier 3 Quest 6 (The Lizquidation)
int __cdecl sub_437C70(int a1, _DWORD *a2)
{
  int v2; // ecx
  int i; // edi
  int v4; // ebx
  int v5; // esi
  int v6; // ecx
  int v7; // esi
  int result; // eax
  int v9; // esi

  v2 = 0;
  for ( i = 0; i < 10; ++i )
  {
    v4 = 8000 * i + 1500;
    v5 = a1 + 24 * v2;
    *(float *)v5 = (float)(terrain_texture_width + 64);
    v6 = v2 + 1;
    *(float *)(v5 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v5 + 12) = 46;
    *(_DWORD *)(v5 + 16) = v4;
    *(_DWORD *)(v5 + 20) = i + 6;
    v7 = a1 + 24 * v6;
    *(_DWORD *)v7 = -1031798784;
    result = terrain_texture_width / 2;
    v2 = v6 + 1;
    *(float *)(v7 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v7 + 12) = 46;
    *(_DWORD *)(v7 + 16) = v4;
    *(_DWORD *)(v7 + 20) = i + 6;
    if ( i == 4 )
    {
      v9 = a1 + 24 * v2;
      *(float *)v9 = (float)(terrain_texture_width + 128);
      result = terrain_texture_width / 2;
      ++v2;
      *(float *)(v9 + 4) = (float)(terrain_texture_width / 2);
      *(_DWORD *)(v9 + 12) = 43;
      *(_DWORD *)(v9 + 16) = 1500;
      *(_DWORD *)(v9 + 20) = 2;
    }
  }
  *a2 = v2;
  return result;
}

// quest_build_zombie_time @ 0x00437D70
// quest builder for Tier 4 Quest 2 (Zombie Time)
int __cdecl sub_437D70(int a1, _DWORD *a2)
{
  int v2; // esi
  int i; // edi
  int v4; // ecx
  int v5; // esi
  int v6; // ecx
  int result; // eax

  v2 = 0;
  for ( i = 1500; i < 97500; i += 8000 )
  {
    v4 = a1 + 24 * v2;
    *(float *)v4 = (float)(terrain_texture_width + 64);
    v5 = v2 + 1;
    *(float *)(v4 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v4 + 12) = 65;
    *(_DWORD *)(v4 + 16) = i;
    *(_DWORD *)(v4 + 20) = 8;
    v6 = a1 + 24 * v5;
    *(_DWORD *)v6 = -1031798784;
    result = terrain_texture_width / 2;
    v2 = v5 + 1;
    *(float *)(v6 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v6 + 12) = 65;
    *(_DWORD *)(v6 + 16) = i;
    *(_DWORD *)(v6 + 20) = 8;
  }
  *a2 = v2;
  return result;
}

// quest_build_frontline_assault @ 0x00437E10
// quest builder for Tier 1 Quest 4 (Frontline Assault)
int __cdecl sub_437E10(_DWORD *a1, _DWORD *a2)
{
  int v3; // esi
  int v4; // edi
  int i; // ebx
  int result; // eax
  bool v7; // zf
  _DWORD *v8; // ecx

  v3 = 0;
  v4 = 2500;
  for ( i = 2; i < 22; ++i )
  {
    *(float *)a1 = (float)(terrain_texture_width / 2);
    a1[1] = 1149763584;
    if ( i > 4 )
    {
      if ( i < 10 )
        a1[3] = 26;
      else
        a1[3] = 38;
    }
    else
    {
      a1[3] = 38;
    }
    a1 += 6;
    result = v4 * i - 5000;
    ++v3;
    *(a1 - 2) = result;
    *(a1 - 1) = 1;
    if ( i > 4 )
    {
      *a1 = -1031798784;
      a1[1] = -1031798784;
      a1[3] = 38;
      a1[4] = result;
      a1[5] = 1;
      ++v3;
      a1 += 6;
    }
    v7 = i == 10;
    if ( i > 10 )
    {
      *a1 = 1149763584;
      a1[1] = -1031798784;
      a1[3] = 38;
      a1[4] = result;
      a1[5] = 1;
      ++v3;
      a1 += 6;
      v7 = i == 10;
    }
    if ( v7 )
    {
      *a1 = 1149763584;
      a1[1] = 1140850688;
      result = 2 * (5 * v4 - 2500);
      a1[3] = 41;
      a1[4] = result;
      a1[5] = 1;
      v8 = a1 + 6;
      *v8 = -1031798784;
      v8[1] = 1140850688;
      v8[3] = 41;
      v8[4] = result;
      v8[5] = 1;
      v3 += 2;
      a1 = v8 + 6;
    }
    v4 -= 50;
    if ( v4 < 1800 )
      v4 = 1800;
  }
  *a2 = v3;
  return result;
}

// quest_build_the_collaboration @ 0x00437F30
// quest builder for Tier 4 Quest 4 (The Collaboration)
_DWORD *__cdecl sub_437F30(int a1, _DWORD *a2)
{
  int v2; // esi
  int i; // edi
  int v4; // ebx
  int v5; // ecx
  int v6; // esi
  int v7; // ecx
  int v8; // ecx
  int v9; // ecx
  _DWORD *result; // eax
  int v11; // [esp+10h] [ebp-4h]

  v2 = 0;
  v11 = 0;
  for ( i = 1500; i < 177500; i += 11000 )
  {
    v4 = (__int64)((double)v11 * 0.80000001 + 7.0);
    v5 = a1 + 24 * v2;
    *(float *)v5 = (float)(terrain_texture_width + 64);
    v6 = v2 + 1;
    *(float *)(v5 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v5 + 12) = 26;
    *(_DWORD *)(v5 + 16) = i;
    *(_DWORD *)(v5 + 20) = v4;
    v7 = a1 + 24 * v6;
    *(float *)(v7 + 4) = (float)(terrain_texture_width + 64);
    ++v6;
    *(float *)v7 = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v7 + 12) = 27;
    *(_DWORD *)(v7 + 16) = i;
    *(_DWORD *)(v7 + 20) = v4;
    v8 = a1 + 24 * v6;
    *(_DWORD *)v8 = -1031798784;
    ++v6;
    *(float *)(v8 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v8 + 12) = 28;
    *(_DWORD *)(v8 + 16) = i;
    *(_DWORD *)(v8 + 20) = v4;
    v9 = 3 * v6;
    v2 = v6 + 1;
    result = (_DWORD *)(a1 + 8 * v9);
    ++v11;
    *result = 1140850688;
    result[1] = -1031798784;
    result[3] = 65;
    result[4] = i;
    result[5] = v4;
  }
  *a2 = v2;
  return result;
}

// quest_build_the_blighting @ 0x00438050
// quest builder for Tier 3 Quest 1 (The Blighting)
int __cdecl sub_438050(int a1, int *a2)
{
  int v2; // ebx
  int v3; // ebp
  int v4; // edi
  int v5; // esi
  int v6; // ecx
  int v7; // eax
  int result; // eax
  int v9; // edx
  double v10; // st7
  int v11; // [esp+8h] [ebp-8h]

  *(float *)a1 = (float)(terrain_texture_width + 128);
  v2 = 26;
  *(float *)(a1 + 4) = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 12) = 43;
  *(_DWORD *)(a1 + 16) = 1500;
  *(_DWORD *)(a1 + 20) = 2;
  *(_DWORD *)(a1 + 24) = -1023410176;
  *(float *)(a1 + 28) = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 36) = 43;
  *(_DWORD *)(a1 + 40) = 1500;
  *(_DWORD *)(a1 + 44) = 2;
  *(_DWORD *)(a1 + 52) = 1124073472;
  *(_DWORD *)(a1 + 48) = 1147142144;
  *(_DWORD *)(a1 + 60) = 7;
  *(_DWORD *)(a1 + 64) = 2000;
  *(_DWORD *)(a1 + 68) = 1;
  *(_DWORD *)(a1 + 76) = 1124073472;
  *(_DWORD *)(a1 + 72) = 1124073472;
  *(_DWORD *)(a1 + 84) = 7;
  *(_DWORD *)(a1 + 88) = 2000;
  *(_DWORD *)(a1 + 92) = 1;
  *(_DWORD *)(a1 + 100) = 1147142144;
  *(_DWORD *)(a1 + 96) = 1124073472;
  *(_DWORD *)(a1 + 108) = 7;
  *(_DWORD *)(a1 + 112) = 2000;
  *(_DWORD *)(a1 + 116) = 1;
  *(_DWORD *)(a1 + 124) = 1147142144;
  *(_DWORD *)(a1 + 120) = 1147142144;
  *(_DWORD *)(a1 + 132) = 7;
  *(_DWORD *)(a1 + 136) = 2000;
  *(_DWORD *)(a1 + 140) = 1;
  v3 = 0;
  v4 = 6;
  v5 = 4000;
  v11 = 0;
  v6 = a1 + 144;
  do
  {
    v7 = v3 % 2;
    if ( v3 == 2 || v3 == 4 )
    {
      *(_DWORD *)v6 = -1023410176;
      ++v4;
      v6 += 24;
      *(float *)(v6 - 20) = (float)(terrain_texture_width / 2);
      *(_DWORD *)(v6 - 12) = 43;
      *(_DWORD *)(v6 - 8) = v5;
      *(_DWORD *)(v6 - 4) = 4;
    }
    if ( v3 == 3 || v3 == 5 )
    {
      *(_DWORD *)v6 = 1150287872;
      ++v4;
      v6 += 24;
      *(float *)(v6 - 20) = (float)(terrain_texture_width / 2);
      *(_DWORD *)(v6 - 12) = 43;
      *(_DWORD *)(v6 - 8) = v5;
      *(_DWORD *)(v6 - 4) = 4;
    }
    if ( v7 )
    {
      if ( v7 == 1 )
        v2 = 28;
    }
    else
    {
      v2 = 26;
    }
    result = v3 / 5;
    v9 = v3 % 5;
    if ( v3 % 5 )
    {
      if ( v9 == 1 )
      {
        *(_DWORD *)v6 = -1031798784;
        result = terrain_texture_width / 2;
        *(float *)(v6 + 4) = (float)(terrain_texture_width / 2);
      }
      else
      {
        if ( v9 == 2 )
        {
          *(float *)(v6 + 4) = (float)(terrain_texture_width + 64);
          result = terrain_texture_width / 2;
          v10 = (double)(terrain_texture_width / 2);
        }
        else
        {
          if ( v9 != 3 )
            goto LABEL_22;
          *(_DWORD *)(v6 + 4) = -1031798784;
          result = terrain_texture_width / 2;
          v10 = (double)(terrain_texture_width / 2);
        }
        *(float *)v6 = v10;
      }
    }
    else
    {
      *(float *)v6 = (float)(terrain_texture_width + 64);
      result = terrain_texture_width / 2;
      *(float *)(v6 + 4) = (float)(terrain_texture_width / 2);
    }
    *(_DWORD *)(v6 + 12) = v2;
    *(_DWORD *)(v6 + 16) = v5;
    *(_DWORD *)(v6 + 20) = 12;
    ++v4;
    v6 += 24;
    v5 += 15000;
LABEL_22:
    v5 += 1000;
    v3 = ++v11;
  }
  while ( v11 < 8 );
  *a2 = v4;
  return result;
}

// quest_build_the_annihilation @ 0x004382C0
// quest builder for Tier 4 Quest 9 (The Annihilation)
_DWORD *__cdecl sub_4382C0(int a1, _DWORD *a2)
{
  int v2; // esi
  int v3; // ebx
  int v4; // edi
  float *v5; // ecx
  char v6; // bl
  int v7; // edi
  int v8; // esi
  float *v9; // ecx

  v2 = 500;
  *(_DWORD *)a1 = 1124073472;
  v3 = 0;
  v4 = 0;
  v5 = (float *)(a1 + 36);
  *(float *)(a1 + 4) = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 12) = 43;
  *(_DWORD *)(a1 + 16) = 500;
  *(_DWORD *)(a1 + 20) = 2;
  do
  {
    *(v5 - 2) = (float)(v4 / 12 + 128);
    if ( (v3 & 1) != 0 )
      *(v5 - 3) = 896.0;
    else
      *(v5 - 3) = 832.0;
    *(_DWORD *)v5 = 7;
    *((_DWORD *)v5 + 1) = v2;
    *((_DWORD *)v5 + 2) = 1;
    v2 += 500;
    v4 += 768;
    v5 += 6;
    ++v3;
  }
  while ( v3 < 12 );
  v6 = 0;
  v7 = 0;
  v8 = 45000;
  v9 = (float *)(a1 + 324);
  do
  {
    *(v9 - 2) = (float)(v7 / 12 + 128);
    if ( (v6 & 1) != 0 )
      *(v9 - 3) = 832.0;
    else
      *(v9 - 3) = 896.0;
    *(_DWORD *)v9 = 7;
    *((_DWORD *)v9 + 1) = v8;
    *((_DWORD *)v9 + 2) = 1;
    v9 += 6;
    v8 += 300;
    ++v6;
    v7 += 768;
  }
  while ( v8 < 48600 );
  *a2 = 25;
  return a2;
}

// quest_build_the_massacre @ 0x004383E0
// quest builder for Tier 4 Quest 5 (The Massacre)
int __cdecl sub_4383E0(float *a1, _DWORD *a2)
{
  int v3; // ebp
  int v4; // ebx
  int i; // edi
  int v6; // esi
  int v7; // edx
  int result; // eax
  bool v9; // zf
  signed int v10; // ebx

  v3 = 0;
  v4 = 0;
  for ( i = 1500; i < 91500; i += 5000 )
  {
    v6 = v4 + 1;
    a1 += 6;
    *(a1 - 6) = (float)(terrain_texture_width + 64);
    v7 = v4 + 3;
    result = terrain_texture_width / 2;
    ++v3;
    v10 = v4 & 0x80000001;
    v9 = v10 == 0;
    *(a1 - 5) = (float)(terrain_texture_width / 2);
    *((_DWORD *)a1 - 3) = 65;
    *((_DWORD *)a1 - 2) = i;
    *((_DWORD *)a1 - 1) = v7;
    if ( v10 < 0 )
      v9 = (((_BYTE)v10 - 1) | 0xFFFFFFFE) == -1;
    if ( v9 )
    {
      *a1 = (float)(terrain_texture_width + 128);
      result = terrain_texture_width / 2;
      ++v3;
      a1 += 6;
      *(a1 - 5) = (float)(terrain_texture_width / 2);
      *((_DWORD *)a1 - 3) = 43;
      *((_DWORD *)a1 - 2) = i;
      *((_DWORD *)a1 - 1) = v6;
    }
    v4 = v6;
  }
  *a2 = v3;
  return result;
}

// quest_build_the_killing @ 0x004384A0
// quest builder for Tier 3 Quest 3 (The Killing)
_DWORD *__cdecl sub_4384A0(int a1, _DWORD *a2)
{
  int v3; // ebx
  int v4; // edi
  int v5; // ebp
  int v6; // edx
  int v7; // edx
  double v8; // st7
  int v9; // esi
  int i; // [esp+10h] [ebp-4h]

  v3 = 0;
  v4 = 2000;
  v5 = 26;
  for ( i = 0; i < 10; ++i )
  {
    crt_rand();
    v6 = i % 3;
    if ( i % 3 )
    {
      if ( v6 == 1 )
      {
        v5 = 27;
      }
      else if ( v6 == 2 )
      {
        v5 = 28;
      }
    }
    else
    {
      v5 = 26;
    }
    crt_rand();
    v7 = i % 5;
    if ( !(i % 5) )
    {
      *(float *)a1 = (float)(terrain_texture_width + 64);
      v8 = (double)(terrain_texture_width / 2);
LABEL_12:
      *(float *)(a1 + 4) = v8;
      *(_DWORD *)(a1 + 12) = v5;
      *(_DWORD *)(a1 + 16) = v4;
      *(_DWORD *)(a1 + 20) = 12;
      goto LABEL_19;
    }
    switch ( v7 )
    {
      case 1:
        *(_DWORD *)a1 = -1031798784;
        v8 = (double)(terrain_texture_width / 2);
        goto LABEL_12;
      case 2:
        *(float *)(a1 + 4) = (float)(terrain_texture_width + 64);
        *(float *)a1 = (float)(terrain_texture_width / 2);
        *(_DWORD *)(a1 + 12) = v5;
        *(_DWORD *)(a1 + 16) = v4;
        *(_DWORD *)(a1 + 20) = 12;
        break;
      case 3:
        *(_DWORD *)(a1 + 4) = -1031798784;
        *(float *)a1 = (float)(terrain_texture_width / 2);
        *(_DWORD *)(a1 + 12) = v5;
        *(_DWORD *)(a1 + 16) = v4;
        *(_DWORD *)(a1 + 20) = 12;
        break;
      case 4:
        *(float *)(a1 + 4) = (float)(crt_rand() % 768 + 128);
        v9 = a1 + 24;
        *(float *)(v9 - 24) = (float)(crt_rand() % 768 + 128);
        *(_DWORD *)(v9 - 12) = 7;
        *(_DWORD *)(v9 - 8) = v4;
        *(_DWORD *)(v9 - 4) = 3;
        *(float *)(v9 + 4) = (float)(crt_rand() % 768 + 128);
        a1 = v9 + 24;
        v3 += 2;
        *(float *)(a1 - 24) = (float)(crt_rand() % 768 + 128);
        *(_DWORD *)(a1 - 12) = 7;
        *(_DWORD *)(a1 - 8) = v4 + 1000;
        *(_DWORD *)(a1 - 4) = 3;
        *(float *)(a1 + 4) = (float)(crt_rand() % 768 + 128);
        *(float *)a1 = (float)(crt_rand() % 768 + 128);
        *(_DWORD *)(a1 + 12) = 7;
        *(_DWORD *)(a1 + 16) = v4 + 2000;
        *(_DWORD *)(a1 + 20) = 3;
        break;
      default:
        goto LABEL_20;
    }
LABEL_19:
    ++v3;
    a1 += 24;
    v4 += 5000;
LABEL_20:
    v4 += 1000;
  }
  *a2 = v3;
  return a2;
}

// quest_build_lizard_zombie_pact @ 0x00438700
// quest builder for Tier 4 Quest 3 (Lizard Zombie Pact)
int __cdecl sub_438700(int a1, _DWORD *a2)
{
  int v3; // ecx
  int v4; // edi
  int v5; // ebx
  int v6; // esi
  int v7; // ecx
  int v8; // esi
  int result; // eax
  int v10; // esi
  int v11; // edx
  int v12; // edi
  int v13; // ecx
  double v14; // st7
  int v15; // eax
  int v16; // [esp+10h] [ebp-4h]
  int v17; // [esp+18h] [ebp+4h]

  v3 = 0;
  v4 = 0;
  v5 = 1500;
  v16 = 0;
  do
  {
    v6 = a1 + 24 * v3;
    *(float *)v6 = (float)(terrain_texture_width + 64);
    v7 = v3 + 1;
    *(float *)(v6 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v6 + 12) = 65;
    *(_DWORD *)(v6 + 16) = v5;
    *(_DWORD *)(v6 + 20) = 6;
    v8 = a1 + 24 * v7;
    *(_DWORD *)v8 = -1031798784;
    *(float *)(v8 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v8 + 12) = 65;
    *(_DWORD *)(v8 + 16) = v5;
    *(_DWORD *)(v8 + 20) = 6;
    result = v4 / 5;
    v3 = v7 + 1;
    if ( !(v4 % 5) )
    {
      v10 = a1 + 24 * v3;
      *(_DWORD *)v10 = 1135738880;
      v11 = v4 / 5;
      v12 = 180 * (v4 / 5);
      v13 = v3 + 1;
      v14 = (double)(v12 + 256);
      v17 = v12 + 384;
      v4 = v16;
      *(float *)(v10 + 4) = v14;
      *(_DWORD *)(v10 + 12) = 12;
      *(_DWORD *)(v10 + 16) = v5;
      *(_DWORD *)(v10 + 20) = v11 + 1;
      v15 = 3 * v13;
      v3 = v13 + 1;
      result = a1 + 8 * v15;
      *(_DWORD *)result = 1135738880;
      *(float *)(result + 4) = (float)v17;
      *(_DWORD *)(result + 12) = 12;
      *(_DWORD *)(result + 16) = v5;
      *(_DWORD *)(result + 20) = v11 + 2;
    }
    v5 += 7000;
    v16 = ++v4;
  }
  while ( v5 < 113500 );
  *a2 = v3;
  return result;
}

// quest_build_lizard_raze @ 0x00438840
// quest builder for Tier 3 Quest 8 (Lizard Raze)
_DWORD *__cdecl sub_438840(int a1, _DWORD *a2)
{
  int v2; // ecx
  int i; // edi
  int v4; // esi
  int v5; // ecx
  int v6; // esi
  int v7; // edx
  int v8; // ecx
  _DWORD *v9; // eax
  int v10; // eax
  _DWORD *v11; // eax
  _DWORD *result; // eax

  v2 = 0;
  for ( i = 1500; i < 91500; i += 6000 )
  {
    v4 = a1 + 24 * v2;
    *(float *)v4 = (float)(terrain_texture_width + 64);
    v5 = v2 + 1;
    *(float *)(v4 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v4 + 12) = 46;
    *(_DWORD *)(v4 + 16) = i;
    *(_DWORD *)(v4 + 20) = 6;
    v6 = a1 + 24 * v5;
    *(_DWORD *)v6 = -1031798784;
    v2 = v5 + 1;
    *(float *)(v6 + 4) = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v6 + 12) = 46;
    *(_DWORD *)(v6 + 16) = i;
    *(_DWORD *)(v6 + 20) = 6;
  }
  v7 = 3 * v2;
  v8 = v2 + 1;
  v9 = (_DWORD *)(a1 + 8 * v7);
  *v9 = 1124073472;
  v9[1] = 1132462080;
  v9[3] = 12;
  v9[4] = 10000;
  v9[5] = 1;
  v10 = 3 * v8++;
  v11 = (_DWORD *)(a1 + 8 * v10);
  *v11 = 1124073472;
  v11[1] = 1136656384;
  v11[3] = 12;
  v11[4] = 10000;
  v11[5] = 1;
  result = (_DWORD *)(a1 + 24 * v8);
  *result = 1124073472;
  result[1] = 1140850688;
  result[3] = 12;
  result[4] = 10000;
  result[5] = 1;
  *a2 = v8 + 1;
  return result;
}

// quest_build_surrounded_by_reptiles @ 0x00438940
// quest builder for Tier 3 Quest 5 (Surrounded By Reptiles)
_DWORD *__cdecl sub_438940(float *a1, _DWORD *a2)
{
  float *v2; // eax
  int v3; // ecx
  int i; // edx
  double v5; // st7
  float *v6; // eax
  int j; // edx
  double v8; // st7
  int v10; // [esp+Ch] [ebp-4h]
  int v11; // [esp+Ch] [ebp-4h]

  v2 = a1;
  v3 = 0;
  v10 = 0;
  for ( i = 1000; i < 5000; i += 800 )
  {
    *v2 = 256.0;
    v3 += 2;
    v2 += 12;
    v5 = (double)v10 * 0.2 + 256.0;
    v10 += 512;
    *(v2 - 11) = v5;
    *((_DWORD *)v2 - 9) = 13;
    *((_DWORD *)v2 - 8) = i;
    *((_DWORD *)v2 - 7) = 1;
    *(v2 - 6) = 768.0;
    *(v2 - 5) = v5;
    *((_DWORD *)v2 - 3) = 13;
    *((_DWORD *)v2 - 2) = i;
    *((_DWORD *)v2 - 1) = 1;
  }
  v11 = 0;
  v6 = &a1[6 * v3];
  for ( j = 8000; j < 12000; j += 800 )
  {
    v6[1] = 256.0;
    v3 += 2;
    v6 += 12;
    v8 = (double)v11 * 0.2 + 256.0;
    v11 += 512;
    *(v6 - 12) = v8;
    *((_DWORD *)v6 - 9) = 13;
    *((_DWORD *)v6 - 8) = j;
    *((_DWORD *)v6 - 7) = 1;
    *(v6 - 5) = 768.0;
    *(v6 - 6) = v8;
    *((_DWORD *)v6 - 3) = 13;
    *((_DWORD *)v6 - 2) = j;
    *((_DWORD *)v6 - 1) = 1;
  }
  *a2 = v3;
  return a2;
}

// quest_build_the_unblitzkrieg @ 0x00438A40
// quest builder for Tier 4 Quest 6 (The Unblitzkrieg)
_DWORD *__cdecl sub_438A40(int a1, _DWORD *a2)
{
  int v2; // ecx
  int v3; // edi
  int v4; // ebp
  int v5; // esi
  double v6; // st7
  int v7; // eax
  int v8; // edx
  int v9; // ebp
  int v10; // edi
  int v11; // esi
  int v12; // eax
  int v13; // edi
  int v14; // ebp
  _DWORD *v15; // eax
  int v16; // eax
  int v17; // edi
  int v18; // esi
  int v19; // eax
  int v20; // ebp
  int v21; // edi
  int v22; // esi
  int v23; // eax
  int v24; // ebp
  int v25; // edi
  int v26; // esi
  int v27; // eax
  int v28; // ebp
  int v29; // edi
  int v30; // esi
  int v31; // eax
  int v32; // ebp
  int v33; // edi
  int v34; // esi
  int v35; // eax
  int v36; // ebp
  int v37; // edi
  int v38; // esi
  int v40; // [esp+10h] [ebp-8h]
  int v41; // [esp+10h] [ebp-8h]
  int v42; // [esp+10h] [ebp-8h]
  int v43; // [esp+10h] [ebp-8h]
  int v44; // [esp+10h] [ebp-8h]
  int v45; // [esp+10h] [ebp-8h]
  int v46; // [esp+10h] [ebp-8h]

  v2 = 500;
  v3 = 0;
  v4 = 0;
  v5 = a1 + 12;
  do
  {
    *(_DWORD *)(v5 - 12) = 1145962496;
    v6 = (double)(v4 / 10 + 200);
    v4 += 624;
    *(float *)(v5 - 8) = v6;
    v5 += 24;
    v7 = (v3++ & 1) != 0 ? 13 : 7;
    *(_DWORD *)(v5 - 24) = v7;
    *(_DWORD *)(v5 - 20) = v2;
    *(_DWORD *)(v5 - 16) = 1;
    v2 += 1800;
  }
  while ( v4 < 6240 );
  v8 = 3 * v3;
  v9 = 0;
  v10 = v3 + 10;
  v40 = 0;
  v11 = a1 + 8 * v8 + 12;
  do
  {
    *(float *)(v11 - 12) = (float)(824 - v9 / 10);
    *(_DWORD *)(v11 - 8) = 1145962496;
    v11 += 24;
    v9 += 624;
    *(_DWORD *)(v11 - 24) = (v40 & 1) != 0 ? 13 : 7;
    *(_DWORD *)(v11 - 20) = v2;
    *(_DWORD *)(v11 - 16) = 1;
    v2 += 1500;
    ++v40;
  }
  while ( v9 < 6240 );
  v12 = 3 * v10;
  v13 = v10 + 1;
  v14 = 0;
  v15 = (_DWORD *)(a1 + 8 * v12);
  v41 = 0;
  *v15 = 1140850688;
  v15[1] = 1140850688;
  v15[4] = v2;
  v15[3] = 7;
  v15[5] = 1;
  v16 = 3 * v13;
  v17 = v13 + 10;
  v18 = a1 + 8 * v16 + 12;
  do
  {
    *(_DWORD *)(v18 - 12) = 1128792064;
    *(float *)(v18 - 8) = (float)(824 - v14 / 10);
    v18 += 24;
    v14 += 624;
    *(_DWORD *)(v18 - 24) = (v41 & 1) != 0 ? 13 : 7;
    *(_DWORD *)(v18 - 20) = v2;
    *(_DWORD *)(v18 - 16) = 1;
    v2 += 1200;
    ++v41;
  }
  while ( v14 < 6240 );
  v19 = 3 * v17;
  v20 = 0;
  v21 = v17 + 10;
  v42 = 0;
  v22 = a1 + 8 * v19 + 12;
  do
  {
    *(float *)(v22 - 12) = (float)(v20 / 10 + 200);
    *(_DWORD *)(v22 - 8) = 1128792064;
    v22 += 24;
    v20 += 624;
    *(_DWORD *)(v22 - 24) = (v42 & 1) != 0 ? 13 : 7;
    *(_DWORD *)(v22 - 20) = v2;
    *(_DWORD *)(v22 - 16) = 1;
    v2 += 800;
    ++v42;
  }
  while ( v20 < 6240 );
  v23 = 3 * v21;
  v24 = 0;
  v25 = v21 + 10;
  v43 = 0;
  v26 = a1 + 8 * v23 + 12;
  do
  {
    *(_DWORD *)(v26 - 12) = 1145962496;
    *(float *)(v26 - 8) = (float)(v24 / 10 + 200);
    v26 += 24;
    v24 += 624;
    *(_DWORD *)(v26 - 24) = (v43 & 1) != 0 ? 13 : 7;
    *(_DWORD *)(v26 - 20) = v2;
    *(_DWORD *)(v26 - 16) = 1;
    v2 += 800;
    ++v43;
  }
  while ( v24 < 6240 );
  v27 = 3 * v25;
  v28 = 0;
  v29 = v25 + 10;
  v44 = 0;
  v30 = a1 + 8 * v27 + 12;
  do
  {
    *(float *)(v30 - 12) = (float)(824 - v28 / 10);
    *(_DWORD *)(v30 - 8) = 1145962496;
    v30 += 24;
    v28 += 624;
    *(_DWORD *)(v30 - 24) = (v44 & 1) != 0 ? 13 : 7;
    *(_DWORD *)(v30 - 20) = v2;
    *(_DWORD *)(v30 - 16) = 1;
    v2 += 700;
    ++v44;
  }
  while ( v28 < 6240 );
  v31 = 3 * v29;
  v32 = 0;
  v33 = v29 + 10;
  v45 = 0;
  v34 = a1 + 8 * v31 + 12;
  do
  {
    *(_DWORD *)(v34 - 12) = 1128792064;
    *(float *)(v34 - 8) = (float)(824 - v32 / 10);
    v34 += 24;
    v32 += 624;
    *(_DWORD *)(v34 - 24) = (v45 & 1) != 0 ? 13 : 7;
    *(_DWORD *)(v34 - 20) = v2;
    *(_DWORD *)(v34 - 16) = 1;
    v2 += 700;
    ++v45;
  }
  while ( v32 < 6240 );
  v35 = 3 * v33;
  v36 = 0;
  v37 = v33 + 10;
  v46 = 0;
  v38 = a1 + 8 * v35 + 12;
  do
  {
    *(float *)(v38 - 12) = (float)(v36 / 10 + 200);
    *(_DWORD *)(v38 - 8) = 1128792064;
    v38 += 24;
    v36 += 624;
    *(_DWORD *)(v38 - 24) = (v46 & 1) != 0 ? 13 : 7;
    *(_DWORD *)(v38 - 20) = v2;
    *(_DWORD *)(v38 - 16) = 1;
    v2 += 800;
    ++v46;
  }
  while ( v36 < 6240 );
  *a2 = v37;
  return a2;
}

// quest_build_the_end_of_all @ 0x00438E10
// quest builder for Tier 4 Quest 10 (The End of All)
int *__cdecl sub_438E10(float *a1, int *a2)
{
  int v3; // esi
  int v4; // edx
  float *v5; // ecx
  double v6; // st7
  long double v7; // st7
  int v8; // edi
  int v9; // ecx
  int v10; // esi
  int v11; // edx
  float *v12; // ecx
  char v13; // dl
  double v14; // st7
  int v15; // edx
  float *v16; // ecx
  int v17; // edi
  double v18; // st7
  long double v19; // st7
  int v20; // edx
  float *v21; // ecx
  double v22; // st7
  long double v23; // st7
  int v24; // ecx
  char v25; // dl
  int v26; // esi
  int v27; // eax
  int v28; // edi
  double v29; // st7
  int v31; // [esp+10h] [ebp+4h]
  int v32; // [esp+10h] [ebp+4h]
  int v33; // [esp+10h] [ebp+4h]
  int v34; // [esp+10h] [ebp+4h]
  int v35; // [esp+10h] [ebp+4h]

  *a1 = 128.0;
  a1[1] = 128.0;
  *((_DWORD *)a1 + 3) = 60;
  *((_DWORD *)a1 + 4) = 3000;
  *((_DWORD *)a1 + 5) = 1;
  a1[6] = 896.0;
  a1[7] = 128.0;
  *((_DWORD *)a1 + 9) = 60;
  *((_DWORD *)a1 + 10) = 6000;
  *((_DWORD *)a1 + 11) = 1;
  a1[12] = 128.0;
  a1[13] = 896.0;
  *((_DWORD *)a1 + 15) = 60;
  *((_DWORD *)a1 + 16) = 9000;
  *((_DWORD *)a1 + 17) = 1;
  a1[18] = 896.0;
  a1[19] = 896.0;
  *((_DWORD *)a1 + 21) = 60;
  v3 = 0;
  *((_DWORD *)a1 + 22) = 12000;
  *((_DWORD *)a1 + 23) = 1;
  v31 = 0;
  v4 = 13000;
  v5 = a1 + 27;
  do
  {
    v6 = (double)v31;
    v5 += 6;
    v31 = ++v3;
    v7 = v6 * 1.0471976;
    *(v5 - 9) = cos(v7) * 80.0 + 512.0;
    *(v5 - 8) = sin(v7) * 80.0 + 512.0;
    *((_DWORD *)v5 - 6) = 7;
    *((_DWORD *)v5 - 5) = v4;
    *((_DWORD *)v5 - 4) = 1;
    v4 += 300;
  }
  while ( v4 < 14800 );
  v8 = 18000;
  a1[60] = 512.0;
  a1[61] = 512.0;
  v9 = 3 * v3;
  *((_DWORD *)a1 + 63) = 11;
  v10 = 256;
  v32 = 256;
  v11 = 100 * v9 + 13000;
  v12 = a1 + 69;
  *((_DWORD *)a1 + 64) = v11;
  *((_DWORD *)a1 + 65) = 1;
  v13 = 0;
  do
  {
    if ( (v13 & 1) != 0 )
      *(v12 - 3) = 1152.0;
    else
      *(v12 - 3) = -128.0;
    v14 = (double)v32;
    v12 += 6;
    v10 += 128;
    ++v13;
    v32 = v10;
    *(v12 - 8) = v14;
    *((_DWORD *)v12 - 6) = 60;
    *((_DWORD *)v12 - 5) = v8;
    *((_DWORD *)v12 - 4) = 2;
    v8 += 1000;
  }
  while ( v10 < 768 );
  v15 = 43000;
  v33 = 0;
  v16 = a1 + 93;
  v17 = 21;
  do
  {
    v16 += 6;
    v18 = (double)v33++ * 1.0471976;
    v19 = v18 + 0.52359879;
    *(v16 - 9) = cos(v19) * 80.0 + 512.0;
    *(v16 - 8) = sin(v19) * 80.0 + 512.0;
    *((_DWORD *)v16 - 6) = 7;
    *((_DWORD *)v16 - 5) = v15;
    *((_DWORD *)v16 - 4) = 1;
    v15 += 300;
  }
  while ( v15 < 44800 );
  if ( config_hardcore )
  {
    v34 = 0;
    v20 = 62800;
    v21 = a1 + 129;
    v17 = 33;
    do
    {
      v21 += 6;
      v22 = (double)v34++ + 1.0;
      v23 = v22 * 0.52359879;
      *(v21 - 9) = cos(v23) * 180.0 + 512.0;
      *(v21 - 8) = sin(v23) * 180.0 + 512.0;
      *((_DWORD *)v21 - 6) = 7;
      *((_DWORD *)v21 - 5) = v20;
      *((_DWORD *)v21 - 4) = 1;
      v20 += 500;
    }
    while ( v20 < 68800 );
  }
  v24 = 256;
  v25 = 0;
  v26 = 48000;
  v27 = (int)&a1[6 * v17 + 3];
  v35 = 256;
  v28 = v17 + 4;
  do
  {
    if ( (v25 & 1) != 0 )
      *(_DWORD *)(v27 - 12) = 1150287872;
    else
      *(_DWORD *)(v27 - 12) = -1023410176;
    v29 = (double)v35;
    v27 += 24;
    v24 += 128;
    ++v25;
    v35 = v24;
    *(float *)(v27 - 32) = v29;
    *(_DWORD *)(v27 - 24) = 60;
    *(_DWORD *)(v27 - 20) = v26;
    *(_DWORD *)(v27 - 16) = 2;
    v26 += 1000;
  }
  while ( v24 < 768 );
  *a2 = v28;
  return a2;
}

// quest_build_spiders_inc @ 0x004390D0
// quest builder for Tier 3 Quest 7 (Spiders Inc.)
int __cdecl sub_4390D0(int a1, int *a2)
{
  int v3; // ebx
  int v4; // esi
  int v5; // ebp
  int v6; // edi
  int v7; // esi
  int v8; // edi
  int result; // eax
  int v10; // [esp+10h] [ebp+4h]

  *(float *)(a1 + 4) = (float)(terrain_texture_width + 64);
  *(float *)a1 = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 12) = 56;
  *(_DWORD *)(a1 + 16) = 500;
  *(_DWORD *)(a1 + 20) = 1;
  *(float *)(a1 + 28) = (float)(terrain_texture_width + 64);
  *(float *)(a1 + 24) = (float)(terrain_texture_width / 2 + 64);
  *(_DWORD *)(a1 + 36) = 56;
  *(_DWORD *)(a1 + 40) = 500;
  *(_DWORD *)(a1 + 44) = 1;
  *(_DWORD *)(a1 + 52) = -1031798784;
  v3 = 17000;
  v10 = 0;
  *(float *)(a1 + 48) = (float)(terrain_texture_width / 2);
  *(_DWORD *)(a1 + 60) = 64;
  *(_DWORD *)(a1 + 64) = 500;
  *(_DWORD *)(a1 + 68) = 4;
  v4 = 3;
  do
  {
    v5 = v10 / 2 + 3;
    v6 = a1 + 24 * v4;
    *(float *)(v6 + 4) = (float)(terrain_texture_width + 64);
    v7 = v4 + 1;
    *(float *)v6 = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v6 + 12) = 56;
    *(_DWORD *)(v6 + 16) = v3;
    *(_DWORD *)(v6 + 20) = v5;
    v8 = a1 + 24 * v7;
    *(_DWORD *)(v8 + 4) = -1031798784;
    result = terrain_texture_width / 2;
    v4 = v7 + 1;
    *(float *)v8 = (float)(terrain_texture_width / 2);
    *(_DWORD *)(v8 + 12) = 56;
    *(_DWORD *)(v8 + 16) = v3;
    *(_DWORD *)(v8 + 20) = v5;
    v3 += 6000;
    ++v10;
  }
  while ( v3 < 107000 );
  *a2 = v4;
  return result;
}

// quest_database_init @ 0x00439230
// builds the quest metadata table and registers quest builders
void quest_database_init()
{
  int index; // [esp+10h] [ebp-8h] BYREF
  int tier; // [esp+14h] [ebp-4h] BYREF

  index = 0;
  tier = 0;
  quest_meta_init_entry((int)quest_selected_meta, 1, 1, aLandHostile);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 120000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_land_hostile;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aMinorAlienBrea);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 120000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_minor_alien_breach;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTargetPractice);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 65000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_target_practice;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aFrontlineAssau);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_frontline_assault;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aAlienDens);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 180000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_alien_dens;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheRandomFacto);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_random_factor;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aSpiderWaveSynd);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 240000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_spider_wave_syndrome;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aAlienSquads);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 180000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_alien_squads;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aNestingGrounds);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 240000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_nesting_grounds;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, a8LeggedTerror);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 240000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_8_legged_terror;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aEverredPasture);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_everred_pastures;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aSpiderSpawns);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_spider_spawns;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aArachnoidFarm);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 240000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_arachnoid_farm;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTwoFronts);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 240000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_two_fronts;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aSweepStakes);
  *(_DWORD *)(quest_meta_cursor + 40) = 6;
  *(_DWORD *)(quest_meta_cursor + 8) = 35000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_sweep_stakes;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aEvilZombiesAtL);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 180000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_evil_zombies_at_large;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aSurvivalOfTheF);
  *(_DWORD *)(quest_meta_cursor + 40) = 5;
  *(_DWORD *)(quest_meta_cursor + 8) = 120000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_survival_of_the_fastest;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aLandOfLizards);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 180000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_land_of_lizards;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aGhostPatrols);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 180000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_ghost_patrols;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aSpideroids);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 360000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_spideroids;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheBlighting);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_blighting;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aLizardKings);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 180000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_lizard_kings;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheKilling);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_killing;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aHiddenEvil);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_hidden_evil;
  quest_monster_vision_meta = quest_meta_cursor;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aSurroundedByRe);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_surrounded_by_reptiles;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheLizquidatio);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_lizquidation;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aSpidersInc);
  *(_DWORD *)(quest_meta_cursor + 40) = 11;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_spiders_inc;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aLizardRaze);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_lizard_raze;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aDejaVu);
  *(_DWORD *)(quest_meta_cursor + 40) = 6;
  *(_DWORD *)(quest_meta_cursor + 8) = 120000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_deja_vu;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aZombieMasters);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_zombie_masters;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aMajorAlienBrea);
  *(_DWORD *)(quest_meta_cursor + 40) = 18;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_major_alien_breach;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aZombieTime);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_zombie_time;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aLizardZombiePa);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_lizard_zombie_pact;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheCollaborati);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 360000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_collaboration;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheMassacre);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_massacre;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheUnblitzkrie);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 600000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_unblitzkrieg;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aGauntlet);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_gauntlet;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aSyntaxTerror);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_syntax_terror;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheAnnihilatio);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 300000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_annihilation;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheEndOfAll);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_end_of_all;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheBeating);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_beating;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheSpankingOfT);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_spanking_of_the_dead;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheFortress);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_fortress;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheGangWars);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_gang_wars;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aKneeDeepInTheD);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_knee_deep_in_the_dead;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aCrossFire);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_cross_fire;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aArmyOfThree);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_army_of_three;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aMonsterBlues);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_monster_blues;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aNagolipoli);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_nagolipoli;
  quest_database_advance_slot(&tier, &index);
  quest_meta_init_entry(44 * (index + 10 * tier) + 4736816, tier + 1, index + 1, aTheGathering);
  *(_DWORD *)(quest_meta_cursor + 40) = 1;
  *(_DWORD *)(quest_meta_cursor + 8) = 480000;
  *(_DWORD *)(quest_meta_cursor + 28) = quest_build_the_gathering;
  quest_database_advance_slot(&tier, &index);
  quest_unlock_weapon_id[0] = 2;
  dword_484780 = 3;
  dword_4847AC = 0;
  dword_4847D8 = 8;
  dword_484804 = 0;
  dword_484830 = 5;
  dword_48485C = 0;
  dword_484888 = 6;
  dword_4848B4 = 0;
  dword_4848E0 = 12;
  dword_48490C = 0;
  dword_484938 = 9;
  dword_484964 = 0;
  dword_484990 = 21;
  dword_4849BC = 0;
  dword_4849E8 = 7;
  dword_484A14 = 0;
  dword_484A40 = 4;
  dword_484A6C = 0;
  dword_484A98 = 11;
  dword_484AC4 = 0;
  dword_484AF0 = 10;
  dword_484B1C = 0;
  dword_484B48 = 13;
  dword_484B74 = 0;
  dword_484BA0 = 15;
  dword_484BCC = 0;
  dword_484BF8 = 18;
  dword_484C24 = 0;
  dword_484C50 = 20;
  dword_484C7C = 0;
  dword_484CA8 = 19;
  dword_484CD4 = 0;
  dword_484D00 = 14;
  dword_484D2C = 0;
  dword_484D58 = 17;
  dword_484D84 = 0;
  dword_484DB0 = 22;
  dword_484DDC = 0;
  dword_484E08 = 23;
  quest_unlock_perk_id[0] = perk_id_antiperk;
  dword_48477C = perk_id_antiperk;
  dword_4847A8 = 28;
  dword_4847D4 = perk_id_antiperk;
  dword_484800 = 29;
  dword_48482C = perk_id_antiperk;
  dword_484858 = 30;
  dword_484884 = perk_id_antiperk;
  dword_4848B0 = 31;
  dword_4848DC = perk_id_antiperk;
  dword_484908 = 32;
  dword_484934 = perk_id_antiperk;
  dword_484960 = 33;
  dword_48498C = perk_id_antiperk;
  dword_4849B8 = 34;
  dword_4849E4 = perk_id_antiperk;
  dword_484A10 = 35;
  dword_484A3C = perk_id_antiperk;
  dword_484A68 = 36;
  dword_484A94 = perk_id_antiperk;
  dword_484AC0 = 37;
  dword_484AEC = perk_id_antiperk;
  dword_484B18 = 38;
  dword_484B44 = perk_id_antiperk;
  dword_484B70 = 39;
  dword_484B9C = perk_id_antiperk;
  dword_484BC8 = 40;
  dword_484BF4 = perk_id_antiperk;
  dword_484C20 = 41;
  dword_484C4C = perk_id_antiperk;
  dword_484C78 = 42;
  dword_484CA4 = perk_id_antiperk;
  dword_484CD0 = 43;
  dword_484CFC = perk_id_antiperk;
  dword_484D28 = 44;
  dword_484D54 = perk_id_antiperk;
  dword_484D80 = 45;
  dword_484DAC = perk_id_antiperk;
  dword_484DD8 = 46;
  dword_484E04 = perk_id_antiperk;
  dword_484E34 = 31;
  dword_484E30 = perk_id_antiperk;
  dword_484E60 = 0;
  dword_484E5C = 47;
  dword_484E8C = 0;
  dword_484E88 = 48;
  dword_484EB8 = 30;
  dword_484EB4 = perk_id_antiperk;
  dword_484EE4 = 0;
  dword_484EE0 = 49;
  dword_484F10 = 0;
  dword_484F0C = 50;
  dword_484F3C = 0;
  dword_484F38 = perk_id_antiperk;
  dword_484F68 = 0;
  dword_484F64 = 51;
  dword_484F94 = 0;
  dword_484F90 = 52;
  dword_484FC0 = 28;
  dword_484FBC = perk_id_antiperk;
}

// quest_start_selected @ 0x0043A790
// resets quest state, selects quest metadata, and runs its builder
void quest_start_selected(int tier, int index)
{
  int v2; // esi
  void (__cdecl *v3)(void *, int *); // ebp
  int v4; // edi
  int v5; // ebp
  int *v6; // eax
  int v7; // edx
  int v8; // esi
  int v9; // ecx
  int v10; // esi
  float v11; // [esp+10h] [ebp-8h]
  float v12; // [esp+14h] [ebp-4h]

  FUN_004281e0();
  quest_spawn_count = 0;
  quest_spawn_timeline = 0;
  dword_487244 = 0;
  fx_queue_rotated = 0;
  fx_queue_count = 0;
  highscore_full_version_marker = 0;
  survival_elapsed_ms = 0;
  highscore_score_xp = 0;
  highscore_record_quest_minor = 0;
  highscore_record_quest_major = 0;
  highscore_record_game_mode = 0;
  highscore_record_weapon_id = 0;
  creature_kill_count = 0;
  highscore_record_shots_hit = 0;
  highscore_record_shots_fired = 0;
  byte_487081 = 0;
  highscore_year_offset = 0;
  highscore_month = 0;
  highscore_day = 0;
  highscore_flags = 0;
  dword_487078 = crt_rand() & 0xFEE050F;
  projectile_reset_pools();
  v11 = (double)terrain_texture_width * 0.5;
  *(float *)player_pos_x = v11;
  v12 = (double)terrain_texture_height * 0.5;
  *(float *)player_pos_y = v12;
  v2 = 11 * (index + 10 * tier - 11);
  terrain_generate(&quest_selected_meta[v2]);
  weapon_assign_player(0, quest_start_weapon_id[v2]);
  weapon_assign_player(1, quest_start_weapon_id[v2]);
  console_printf(&console_log_queue, "Setup tier %d quest %d.\n", tier, index);
  v3 = (void (__cdecl *)(void *, int *))quest_selected_meta[v2 + 7];
  if ( v3 )
    v3(&quest_spawn_table, &quest_spawn_count);
  else
    quest_build_fallback((int)&quest_spawn_table, &quest_spawn_count);
  v4 = 0;
  v5 = 0;
  dword_486FD4 = 0;
  dword_487030 = 0;
  if ( quest_spawn_count > 0 )
  {
    v6 = (int *)&unk_4857BC;
    v7 = quest_spawn_count;
    do
    {
      if ( config_hardcore )
      {
        v8 = *v6;
        if ( *v6 > 1 )
        {
          v9 = *(v6 - 2);
          if ( v9 != 60 )
          {
            if ( v9 == 43 )
              v10 = v8 + 2;
            else
              v10 = v8 + 8;
            *v6 = v10;
          }
        }
      }
      v4 += *v6;
      if ( v5 < *(v6 - 1) )
        v5 = *(v6 - 1);
      v6 += 6;
      --v7;
    }
    while ( v7 );
    dword_487030 = v5;
    dword_486FD4 = v4;
  }
}

// highscore_date_checksum @ 0x0043A950
// computes a week-of-year style checksum for high score validation
int highscore_date_checksum(int year, int month, int day)
{
  int v3; // edx
  int v4; // ecx
  int v5; // edi
  int v6; // ecx

  v3 = (14 - month) / 12;
  v4 = year - v3 + 4800;
  v5 = 365 * v4 + v4 / 400 + (153 * (month + 12 * v3) - 457) / 5 - v4 / 100;
  v6 = (v4 / 4 + v5 + day - 32045 - (v4 / 4 + v5 + day - 32045) % 7 + 31741) % 146097 % 36524 % 1461;
  return (v6 / 1460 + (v6 - v6 / 1460) % 365) / 7 + 1;
}

// sub_43AA60 @ 0x0043AA60
char __thiscall sub_43AA60(std::codecvt_base *this)
{
  if ( !game_is_full_version(this) )
    console_printf((int)&console_log_queue, aPotentiallyIll);
  return 1;
}

// FUN_0043aa90 @ 0x0043AA90
// [binja] void* sub_43aa90(void* arg1, void* arg2)
void *FUN_0043aa90(void *arg1, void *arg2)
{
  void *result; // eax

  result = strcpy((char *)arg2, (const char *)arg1);
  *((_DWORD *)arg2 + 8) = *((_DWORD *)arg1 + 8);
  *((_DWORD *)arg2 + 9) = *((_DWORD *)arg1 + 9);
  *((_BYTE *)arg2 + 40) = *((_BYTE *)arg1 + 40);
  *((_BYTE *)arg2 + 41) = *((_BYTE *)arg1 + 41);
  *((_BYTE *)arg2 + 42) = *((_BYTE *)arg1 + 42);
  *((_BYTE *)arg2 + 43) = *((_BYTE *)arg1 + 43);
  *((_DWORD *)arg2 + 11) = *((_DWORD *)arg1 + 11);
  *((_DWORD *)arg2 + 13) = *((_DWORD *)arg1 + 13);
  *((_DWORD *)arg2 + 12) = *((_DWORD *)arg1 + 12);
  *((_DWORD *)arg2 + 14) = *((_DWORD *)arg1 + 14);
  *((_DWORD *)arg2 + 15) = 0;
  return result;
}

// highscore_read_record @ 0x0043AB10
// reads and validates a high score record from a file
char *highscore_read_record(char *buffer, FILE *fp)
{
  int v2; // ebp
  unsigned int i; // ecx
  char *v5; // ecx
  int v6; // edi
  int ptr; // [esp+Ch] [ebp-4h] BYREF

  v2 = 0;
  ptr = 0;
  crt_fread(buffer, 0x48u, 1u, fp);
  if ( (fp->_flag & 0x10) != 0 )
    return 0;
  crt_fread(&ptr, 4u, 1u, fp);
  for ( i = 0; i < 0x48; ++i )
    buffer[i] += -6 - i * (5 * i + 1);
  v5 = buffer;
  v6 = 72;
  do
  {
    v2 += 7 * *v5 * (_DWORD)&v5[3 - (_DWORD)buffer];
    ++v5;
    --v6;
  }
  while ( v6 );
  if ( ptr == v2 )
    return buffer;
  buffer[31] = 0;
  console_printf(&console_log_queue, "WARN: checksum failure on score by %s\n", buffer);
  return 0;
}

// highscore_record_equals @ 0x0043ABD0
// compares high score record metadata and name for equality
int highscore_record_equals(byte *left, byte *right)
{
  int result; // eax

  result = (int)left;
  if ( *((_DWORD *)left + 9) == *((_DWORD *)right + 9) )
  {
    if ( *((_DWORD *)left + 8) == *((_DWORD *)right + 8) )
    {
      if ( left[40] == right[40] )
      {
        if ( *((_DWORD *)left + 13) == *((_DWORD *)right + 13) )
        {
          if ( *((_DWORD *)left + 12) == *((_DWORD *)right + 12) )
          {
            if ( *((_DWORD *)left + 11) == *((_DWORD *)right + 11) )
            {
              result = strcmp((const char *)left, (const char *)right);
              if ( result )
                LOBYTE(result) = 0;
              else
                return 1;
            }
            else
            {
              LOBYTE(result) = 0;
            }
          }
          else
          {
            LOBYTE(result) = 0;
          }
        }
        else
        {
          LOBYTE(result) = 0;
        }
      }
      else
      {
        LOBYTE(result) = 0;
      }
    }
    else
    {
      LOBYTE(result) = 0;
    }
  }
  else
  {
    LOBYTE(result) = 0;
  }
  return result;
}

// highscore_update_record @ 0x0043AC70
// updates a matching record in the high score file when allowed
int highscore_update_record(char *path, byte *record)
{
  int result; // eax
  int v3; // esi
  _DWORD Buffer[18]; // [esp+8h] [ebp-48h] BYREF

  memset(Buffer, 0, sizeof(Buffer));
  strcpy((char *)Buffer, default_player_name);
  LOBYTE(Buffer[17]) = 0;
  HIWORD(Buffer[17]) = -132;
  Buffer[14] = crt_rand() & 0xFEE050F;
  result = (int)crt_fopen(path, aRB);
  v3 = result;
  if ( !result )
    goto LABEL_7;
  if ( (*(_BYTE *)(result + 12) & 0x10) != 0 )
  {
LABEL_6:
    crt_fflush((FILE *)v3);
    result = crt_fclose((FILE *)v3);
LABEL_7:
    LOBYTE(result) = 0;
    return result;
  }
  while ( !highscore_read_record((char *)Buffer, (FILE *)v3)
       || !(unsigned __int8)highscore_record_equals(record, (byte *)Buffer) )
  {
    if ( (*(_BYTE *)(v3 + 12) & 0x10) != 0 )
      goto LABEL_6;
  }
  if ( (Buffer[17] & 2) != 0 )
  {
    result = crt_fclose((FILE *)v3);
    LOBYTE(result) = 1;
  }
  else
  {
    if ( !LOBYTE(Buffer[17]) )
      record[68] = 2;
    crt_fseek((FILE *)v3, -76, 1);
    highscore_write_record(record, (FILE *)v3);
    crt_fflush((FILE *)v3);
    result = crt_fclose((FILE *)v3);
    LOBYTE(result) = 1;
  }
  return result;
}

// highscore_write_record @ 0x0043AD70
// writes a high score record with date + checksum
void highscore_write_record(byte *record, FILE *fp)
{
  int v2; // edi
  unsigned int i; // ecx
  unsigned int j; // ecx
  int ptr; // [esp+8h] [ebp-4Ch] BYREF
  _DWORD Buffer[18]; // [esp+Ch] [ebp-48h] BYREF

  ptr = 0;
  GetLocalTime(&local_system_time);
  memset(Buffer, 0, sizeof(Buffer));
  strcpy((char *)Buffer, default_player_name);
  LOBYTE(Buffer[17]) = 0;
  HIWORD(Buffer[17]) = -132;
  Buffer[14] = crt_rand() & 0xFEE050F;
  if ( !record[64] )
  {
    record[64] = local_system_time.wDay;
    record[66] = local_system_time.wMonth;
    record[67] = LOBYTE(local_system_time.wYear) + 48;
    record[65] = highscore_date_checksum(local_system_time.wYear, local_system_time.wMonth, local_system_time.wDay);
  }
  qmemcpy(Buffer, record, sizeof(Buffer));
  v2 = ptr;
  for ( i = 0; i < 0x48; ++i )
    v2 += 7 * *((char *)Buffer + i) * ((_DWORD)Buffer + i + 3 - (_DWORD)Buffer);
  ptr = v2;
  for ( j = 0; j < 0x48; ++j )
    *((_BYTE *)Buffer + j) += j * (5 * j + 1) + 6;
  crt_fwrite(Buffer, 0x48u, 1u, fp);
  crt_fwrite(&ptr, 4u, 1u, fp);
}

// highscore_compare_survival_score_desc @ 0x0043AEB0
// qsort comparator used by highscore_load_table() for survival mode; sorts descending by dword at offset 0x24
int highscore_compare_survival_score_desc(const void *a, const void *b)
{
  int v2; // eax
  int v3; // ecx

  v2 = *((_DWORD *)a + 9);
  v3 = *((_DWORD *)b + 9);
  if ( v2 <= v3 )
    return v2 < v3;
  else
    return -1;
}

// highscore_compare_rush_field32_desc @ 0x0043AED0
// qsort comparator used by highscore_load_table() for rush mode; sorts descending by dword at offset 0x20
int highscore_compare_rush_field32_desc(const void *a, const void *b)
{
  int v2; // eax
  int v3; // ecx

  v2 = *((_DWORD *)a + 8);
  v3 = *((_DWORD *)b + 8);
  if ( v2 <= v3 )
    return v2 < v3;
  else
    return -1;
}

// highscore_compare_quest_field32_asc_nonzero_first @ 0x0043AEF0
// qsort comparator used by highscore_load_table() for quest mode; sorts ascending by dword at offset 0x20, treating 0 as "missing" (sorted last)
int highscore_compare_quest_field32_asc_nonzero_first(const void *a, const void *b)
{
  int v2; // ecx
  int v4; // eax

  v2 = *((_DWORD *)a + 8);
  if ( !v2 )
    return 1;
  v4 = *((_DWORD *)b + 8);
  if ( !v4 )
    return -1;
  if ( v2 <= v4 )
    return (v2 >= v4) - 1;
  return 1;
}

// highscore_find_name_entry @ 0x0043AF30
// finds a matching name entry in the loaded high score table
byte *highscore_find_name_entry(byte *record, int count)
{
  int v2; // ebp
  const char *i; // edi

  v2 = 0;
  if ( count <= 0 )
    return 0;
  for ( i = (const char *)&highscore_table; strcmp((const char *)record, i); i += 72 )
  {
    if ( ++v2 >= count )
      return 0;
  }
  return (byte *)(72 * v2 + 4729616);
}

// highscore_load_table @ 0x0043AFA0
// loads, filters, and sorts the high score table
void highscore_load_table()
{
  char *v0; // ebx
  _BYTE *v1; // ebp
  int v2; // ebp
  FILE *v3; // ebx
  int v4; // ecx
  byte *name_entry; // eax
  float *v6; // edi
  float *v7; // eax
  float *v8; // eax
  int v9; // edx
  std::codecvt_base *v10; // esi
  int v11; // edx
  int v12; // ecx
  char v13; // al
  int v14; // edx
  int v15; // ebp
  char *v16; // edi
  char *v17; // ecx
  std::codecvt_base *v18; // edx
  int v19; // [esp+10h] [ebp-58h]
  int v20; // [esp+14h] [ebp-54h]
  int v21; // [esp+18h] [ebp-50h]
  int v22; // [esp+1Ch] [ebp-4Ch]
  int v23; // [esp+1Ch] [ebp-4Ch]
  _DWORD Buffer[18]; // [esp+20h] [ebp-48h] BYREF

  memset(Buffer, 0, sizeof(Buffer));
  strcpy((char *)Buffer, default_player_name);
  LOBYTE(Buffer[17]) = 0;
  HIWORD(Buffer[17]) = -132;
  Buffer[14] = crt_rand() & 0xFEE050F;
  v0 = highscore_build_path();
  dword_4C395C = 0;
  v1 = &unk_482B56;
  do
  {
    memset(v1 - 70, 0, 0x48u);
    strcpy(v1 - 70, default_player_name);
    *(v1 - 2) = 0;
    *v1 = 124;
    v1[1] = -1;
    *(_DWORD *)(v1 - 14) = crt_rand() & 0xFEE050F;
    v1 += 72;
  }
  while ( (int)v1 < (int)byte_484776 );
  v2 = 0;
  v3 = crt_fopen(v0, file_mode_read_binary);
  if ( v3 )
  {
    v22 = highscore_date_checksum(local_system_time.wYear, local_system_time.wMonth, local_system_time.wDay);
    while ( (v3->_flag & 0x10) == 0 )
    {
      if ( !highscore_read_record((char *)Buffer, v3) )
        continue;
      v4 = config_game_mode;
      if ( LOBYTE(Buffer[10]) != config_game_mode )
        continue;
      if ( config_game_mode == 3 )
      {
        if ( config_hardcore )
        {
          if ( BYTE1(Buffer[17]) != 117 )
            continue;
        }
        else if ( BYTE1(Buffer[17]) )
        {
          continue;
        }
      }
      if ( !config_score_load_gate && (Buffer[17] & 1) != 0 && (Buffer[17] & 2) == 0 )
        continue;
      if ( BYTE2(config_blob[0]) == 3 )
      {
        if ( local_system_time.wDay != LOBYTE(Buffer[16])
          || local_system_time.wYear - 2000 != HIBYTE(Buffer[16])
          || local_system_time.wMonth != BYTE2(Buffer[16]) )
        {
          continue;
        }
      }
      else if ( BYTE2(config_blob[0]) == 2 )
      {
        if ( v22 != BYTE1(Buffer[16]) || local_system_time.wYear != HIBYTE(Buffer[16]) + 2000 )
          continue;
      }
      else if ( BYTE2(config_blob[0]) == 1
             && (local_system_time.wMonth != BYTE2(Buffer[16]) || local_system_time.wYear - 2000 != HIBYTE(Buffer[16])) )
      {
        continue;
      }
      if ( HIBYTE(config_blob[0]) != 1 )
        goto LABEL_31;
      name_entry = highscore_find_name_entry((byte *)Buffer, v2);
      if ( !name_entry )
      {
        v4 = config_game_mode;
LABEL_31:
        if ( v2 == 99 )
        {
          v6 = &highscore_table;
          if ( v4 == 2 )
          {
            v7 = (float *)&unk_482B58;
            do
            {
              if ( *((_DWORD *)v7 + 8) < *((_DWORD *)v6 + 8) )
                v6 = v7;
              v7 += 18;
            }
            while ( (int)v7 < (int)quest_selected_meta );
          }
          else
          {
            v8 = (float *)&unk_482B58;
            if ( v4 == 3 )
            {
              do
              {
                if ( *((_DWORD *)v8 + 8) > *((_DWORD *)v6 + 8) )
                  v6 = v8;
                v8 += 18;
              }
              while ( (int)v8 < (int)quest_selected_meta );
            }
            else
            {
              do
              {
                if ( *((_DWORD *)v8 + 9) < *((_DWORD *)v6 + 9) )
                  v6 = v8;
                v8 += 18;
              }
              while ( (int)v8 < (int)quest_selected_meta );
            }
          }
          qmemcpy(v6, Buffer, 0x48u);
        }
        else
        {
          v9 = 9 * v2++;
          dword_4C395C = (std::codecvt_base *)v2;
          qmemcpy((void *)(8 * v9 + 4729616), Buffer, 0x48u);
        }
        continue;
      }
      qmemcpy(name_entry, Buffer, 0x48u);
    }
    crt_fclose(v3);
    if ( (int)dword_4C395C > 100 )
      dword_4C395C = (std::codecvt_base *)100;
    if ( config_game_mode == 2 )
    {
      crt_qsort(&highscore_table, 0x64u, 0x48u, highscore_compare_rush_field32_desc);
    }
    else if ( config_game_mode == 3 )
    {
      crt_qsort(&highscore_table, 0x64u, 0x48u, highscore_compare_quest_field32_asc_nonzero_first);
    }
    else
    {
      crt_qsort(&highscore_table, 0x64u, 0x48u, highscore_compare_survival_score_desc);
    }
    if ( config_name_slot_selected )
    {
      if ( (int)dword_4C395C > 0 )
      {
        v17 = byte_482B54;
        v18 = dword_4C395C;
        do
        {
          if ( (*v17 & 1) != 0 )
            *v17 |= 4u;
          v17 += 72;
          v18 = (std::codecvt_base *)((char *)v18 - 1);
        }
        while ( v18 );
      }
    }
    else
    {
      v10 = dword_4C395C;
      v11 = 0;
      v23 = 0;
      if ( (int)dword_4C395C > 0 )
      {
        v12 = 0;
        v21 = 0;
        while ( 1 )
        {
          v13 = byte_482B54[v12];
          v20 = v11;
          if ( (v13 & 4) == 0 && (v13 & 1) != 0 )
            break;
LABEL_72:
          ++v11;
          v12 += 72;
          v23 = v11;
          v21 = v12;
          if ( v11 >= (int)v10 )
            return;
        }
        v14 = 0;
        v19 = v12;
        v15 = 0;
        while ( 1 )
        {
          v16 = (char *)&highscore_table + v15;
          if ( (byte_482B54[v15] & 1) != 0
            && !strcmp((const char *)&highscore_table + v12, (const char *)&highscore_table + v15) )
          {
            if ( byte_482B38[v19] == 2 )
            {
              if ( *(int *)((char *)&dword_482B30 + v19) >= *((_DWORD *)v16 + 8) )
                goto LABEL_70;
            }
            else if ( *(int *)((char *)&dword_482B34 + v19) >= *((_DWORD *)v16 + 9) )
            {
              goto LABEL_70;
            }
            v20 = v14;
            v19 = v15;
          }
LABEL_70:
          v10 = dword_4C395C;
          ++v14;
          v15 += 72;
          if ( v14 >= (int)dword_4C395C )
          {
            v11 = v23;
            byte_482B54[72 * v20] |= 4u;
            v12 = v21;
            goto LABEL_72;
          }
          v12 = v21;
        }
      }
    }
  }
}

// highscore_save_record @ 0x0043B450
// saves a high score record (updates or appends)
void highscore_save_record(byte *record)
{
  char *v1; // ebx
  signed int i; // ecx
  FILE *v3; // eax
  FILE *v4; // edi

  v1 = highscore_build_path();
  if ( record )
  {
    for ( i = strlen((const char *)record) - 1; i > 0; --i )
    {
      if ( record[i] != 32 )
        break;
      record[i] = 0;
    }
    CreateDirectoryA(PathName, 0);
    if ( !byte_4871C9 )
      highscore_record_init();
    if ( (record[68] & 1) == 0 || !(unsigned __int8)highscore_update_record(v1, record) )
    {
      v3 = crt_fopen(v1, aAb);
      v4 = v3;
      if ( v3 )
      {
        highscore_write_record(record, v3);
        crt_fclose(v4);
      }
      else
      {
        console_printf(&console_log_queue, aUnableToSaveSc);
      }
    }
  }
  else
  {
    console_printf(&console_log_queue, aUnexpectedScIs);
  }
}

// highscore_save_active @ 0x0043B510
// saves the active high score record
void highscore_save_active()
{
  highscore_save_record(&highscore_active_record);
}

// highscore_rank_index @ 0x0043B520
// returns the insert index for the current run in the high score table
int highscore_rank_index()
{
  std::codecvt_base *v0; // ecx
  int result; // eax
  int *i; // edx
  int *j; // edx
  int *k; // edx

  if ( config_game_mode == 2 )
  {
    v0 = dword_4C395C;
    result = 0;
    if ( (int)dword_4C395C > 0 )
    {
      for ( i = &dword_482B30; survival_elapsed_ms <= *i; i += 18 )
      {
        if ( ++result >= (int)dword_4C395C )
          return (int)dword_4C395C;
      }
      return result;
    }
    return (int)v0;
  }
  if ( config_game_mode == 3 )
  {
    v0 = dword_4C395C;
    result = 0;
    if ( (int)dword_4C395C <= 0 )
      return (int)v0;
    for ( j = &dword_482B30; survival_elapsed_ms >= *j; j += 18 )
    {
      if ( ++result >= (int)dword_4C395C )
        return (int)dword_4C395C;
    }
  }
  else
  {
    v0 = dword_4C395C;
    result = 0;
    if ( (int)dword_4C395C <= 0 )
      return (int)v0;
    for ( k = &dword_482B34; highscore_score_xp <= *k; k += 18 )
    {
      if ( ++result >= (int)dword_4C395C )
        return (int)v0;
    }
  }
  return result;
}

// highscore_build_path @ 0x0043B5B0
// builds the high score filename for the current mode
char *highscore_build_path()
{
  unsigned int v0; // kr04_4

  if ( !byte_4C3960 )
  {
    crt_getcwd(buf, 0x1FFu);
    byte_4C395B = 0;
    byte_4C3960 = 1;
  }
  switch ( config_game_mode )
  {
    case 2:
      crt_sprintf(&byte_4C36DC, "%s\\scores5\\rush.hi", buf);
      break;
    case 1:
      crt_sprintf(&byte_4C36DC, "%s\\scores5\\survival.hi", buf);
      break;
    case 3:
      if ( config_hardcore )
        crt_sprintf(&byte_4C36DC, "%s\\scores5\\quest%d_%d.hi", buf, *(_DWORD *)quest_stage_major, quest_stage_minor);
      else
        crt_sprintf(&byte_4C36DC, "%s\\scores5\\questhc%d_%d.hi", buf, *(_DWORD *)quest_stage_major, quest_stage_minor);
      break;
    default:
      crt_sprintf(&byte_4C36DC, "scores5\\unknown.hi");
      break;
  }
  if ( config_player_count == 2 )
  {
    v0 = strlen(&byte_4C36DC) + 1;
    *(&byte_4C36DC + v0 - 4) = 95;
    *(&byte_4C36DC + v0 - 3) = 50;
    *(&byte_4C36DC + v0 - 2) = 46;
    *(&byte_4C36DC + v0 - 1) = 104;
    *(&byte_4C36DC + v0) = 105;
    byte_4C36DD[v0] = 0;
  }
  if ( config_name_slot_selected )
  {
    crt_sprintf(byte_4C365C, "%s%s", &byte_4C36DC, &config_saved_name_0[27 * config_name_slot_selected]);
    console_printf(&console_log_queue, "Opening named cache '%s'\n", byte_4C365C);
    return byte_4C365C;
  }
  else
  {
    if ( *(float *)(cv_verbose + 12) != 0.0 )
      console_printf(&console_log_queue, "Opening '%s'\n", &byte_4C36DC);
    return &byte_4C36DC;
  }
}

// highscore_record_init @ 0x0043B750
// fills the active high score record metadata for the current run
void highscore_record_init()
{
  char v0; // bl
  int v1; // eax
  int v2; // edx

  v0 = 1;
  v1 = 1;
  v2 = 1;
  do
  {
    if ( dword_48708C[v1] > dword_48708C[v2] )
    {
      v0 = v1;
      v2 = v1;
    }
    ++v1;
  }
  while ( v1 < 64 );
  highscore_record_weapon_id = v0;
  if ( highscore_record_shots_hit > highscore_record_shots_fired )
    highscore_record_shots_hit = highscore_record_shots_fired;
  highscore_record_game_mode = config_game_mode;
  highscore_record_quest_major = quest_stage_major[0];
  highscore_record_quest_minor = quest_stage_minor;
  highscore_flags = 0;
  dword_487078 = crt_rand() % 0x10000000 + 784;
  highscore_full_version_marker = config_hardcore != 0 ? 0x75 : 0;
}

// FUN_0043b810 @ 0x0043B810
// [binja] void* __fastcall sub_43b810(void* arg1)
void *FUN_0043b810(void *arg1)
{
  _DWORD *v1; // ecx
  void *result; // eax
  int v3; // esi
  _DWORD *v4; // ecx

  result = v1;
  v3 = 16;
  v1[32] = 0;
  v1[31] = 0;
  v1[30] = 0;
  v1[29] = 0;
  v1[5] = 0;
  v1[6] = 0;
  v1[7] = 0;
  v1[8] = -1082130432;
  v4 = v1 + 24;
  do
  {
    *v4-- = 0;
    --v3;
  }
  while ( v3 );
  return result;
}

// buffer_reader_init @ 0x0043B850
// initializes the buffer reader cursor and length
void buffer_reader_init(void *data, int size)
{
  dword_4C3C70 = (int)data;
  dword_4C3C74 = size;
  dword_4C3C78 = 0;
}

// buffer_reader_seek @ 0x0043B870
// sets the buffer reader cursor
void buffer_reader_seek(int offset)
{
  dword_4C3C78 = offset;
}

// buffer_reader_read_u16 @ 0x0043B880
// reads a little-endian u16 from the buffer
int buffer_reader_read_u16()
{
  int result; // eax

  HIWORD(result) = HIWORD(dword_4C3C70);
  LOWORD(result) = *(_WORD *)(dword_4C3C78 + dword_4C3C70);
  dword_4C3C78 += 2;
  return result;
}

// buffer_reader_read_u32 @ 0x0043B8A0
// reads a little-endian u32 from the buffer
uint buffer_reader_read_u32()
{
  uint result; // eax

  result = *(_DWORD *)(dword_4C3C78 + dword_4C3C70);
  dword_4C3C78 += 4;
  return result;
}

// buffer_reader_skip @ 0x0043B8C0
// advances the buffer reader cursor
void buffer_reader_skip(int count)
{
  dword_4C3C78 += count;
}

// buffer_reader_find_tag @ 0x0043B8E0
// searches the buffer for a tag and updates the cursor
int buffer_reader_find_tag(char *tag, int tag_len)
{
  int result; // eax
  int v3; // edi

  result = dword_4C3C74;
  v3 = 0;
  if ( dword_4C3C74 <= 0 )
  {
LABEL_7:
    LOBYTE(result) = 0;
  }
  else
  {
    while ( 1 )
    {
      for ( result = 0; result < tag_len; ++result )
      {
        if ( *(_BYTE *)(dword_4C3C70 + v3 + result) != tag[result] )
          break;
      }
      if ( result == tag_len )
        break;
      result = dword_4C3C74;
      if ( ++v3 >= dword_4C3C74 )
        goto LABEL_7;
    }
    LOBYTE(result) = 1;
    dword_4C3C78 = tag_len + v3;
  }
  return result;
}

// resource_pack_read_cstring @ 0x0043B940
// reads a NUL-terminated pack entry name into DAT_004c3a68
int resource_pack_read_cstring(FILE *fp)
{
  int i; // edi
  int v2; // eax

  for ( i = 0; (fp->_flag & 0x10) == 0; byte_4C3A68[i++] = v2 )
  {
    v2 = crt_getc(fp);
    if ( !v2 )
      break;
  }
  byte_4C3A68[i] = 0;
  return ((unsigned int)~fp->_flag >> 4) & 1;
}

// resource_pack_set @ 0x0043B980
// validates and sets the active resource pack path
int resource_pack_set(char *path)
{
  FILE *v1; // edx
  int result; // eax

  v1 = crt_fopen(path, file_mode_read_binary);
  result = 0;
  if ( v1 )
  {
    strcpy(&byte_4C3968, path);
    byte_4C3C6C = 1;
    result = crt_fclose(v1);
    LOBYTE(result) = 1;
  }
  else
  {
    byte_4C3968 = 0;
    byte_4C3C6C = 0;
    LOBYTE(result) = 0;
  }
  return result;
}

// resource_open_read @ 0x0043B9E0
// opens a resource from the active pack or filesystem and returns its size
int resource_open_read(byte *path, int *size_out)
{
  int *v2; // ebx
  int result; // eax
  FILE *v4; // esi

  v2 = size_out;
  if ( byte_4C3C6C )
  {
    result = (int)crt_fopen(&byte_4C3968, file_mode_read_binary);
    fp = (FILE *)result;
    if ( !result )
    {
      LOBYTE(result) = 0;
      return result;
    }
    v4 = (FILE *)result;
    crt_fseek((FILE *)result, 4, 0);
    while ( (unsigned __int8)resource_pack_read_cstring(v4) )
    {
      crt_fread(&size_out, 4u, 1u, v4);
      *v2 = (int)size_out;
      result = _strcmpi(byte_4C3A68, (const char *)path);
      if ( !result )
        goto LABEL_11;
      crt_fseek(v4, (int)size_out, 1);
    }
    crt_fclose(v4);
  }
  result = (int)crt_fopen((char *)path, file_mode_read_binary);
  fp = (FILE *)result;
  if ( !result )
  {
    LOBYTE(result) = 0;
    return result;
  }
  crt_fseek((FILE *)result, 0, 2);
  *v2 = crt_ftell(fp);
  result = crt_fseek(fp, 0, 0);
LABEL_11:
  LOBYTE(result) = 1;
  return result;
}

// resource_close @ 0x0043BAD0
// closes the current resource file handle
void resource_close()
{
  if ( fp )
    crt_fclose(fp);
}

// dsound_init @ 0x0043BAF0
// initializes DirectSound and the primary buffer
int dsound_init(void *hwnd, uint coop_level)
{
  int result; // eax
  int v3; // [esp+28h] [ebp-3Ch] BYREF
  _WORD v4[2]; // [esp+2Ch] [ebp-38h] BYREF
  int v5; // [esp+30h] [ebp-34h]
  int v6; // [esp+34h] [ebp-30h]
  unsigned __int16 v7; // [esp+38h] [ebp-2Ch]
  unsigned __int16 v8; // [esp+3Ah] [ebp-2Ah]
  __int16 v9; // [esp+3Ch] [ebp-28h]
  _DWORD v10[9]; // [esp+40h] [ebp-24h] BYREF
  __int16 v11; // [esp+70h] [ebp+Ch]
  int v12; // [esp+74h] [ebp+10h]
  unsigned __int16 v13; // [esp+78h] [ebp+14h]

  if ( ppDS8 )
    ppDS8->lpVtbl->Release(ppDS8);
  ppDS8 = 0;
  result = DirectSoundCreate8(0, &ppDS8, 0);
  if ( result >= 0 )
  {
    result = ppDS8->lpVtbl->SetCooperativeLevel(ppDS8, (HWND)hwnd, coop_level);
    if ( result >= 0 )
    {
      memset(v10, 0, sizeof(v10));
      v3 = 0;
      v10[0] = 36;
      v10[1] = 1;
      v10[2] = 0;
      v10[4] = 0;
      result = ppDS8->lpVtbl->CreateSoundBuffer(ppDS8, (LPCDSBUFFERDESC)v10, (LPDIRECTSOUNDBUFFER *)&v3, 0);
      if ( result >= 0 )
      {
        v4[0] = 1;
        v4[1] = v11;
        v8 = v13;
        v7 = v11 * (v13 >> 3);
        v9 = 0;
        v5 = v12;
        v6 = v12 * v7;
        result = (*(int (__stdcall **)(int, _WORD *))(*(_DWORD *)v3 + 56))(v3, v4);
        if ( result >= 0 )
        {
          result = v3;
          if ( v3 )
            result = (*(int (__stdcall **)(int))(*(_DWORD *)v3 + 8))(v3);
          LOBYTE(result) = 1;
        }
        else
        {
          LOBYTE(result) = 0;
        }
      }
      else
      {
        LOBYTE(result) = 0;
      }
    }
    else
    {
      LOBYTE(result) = 0;
    }
  }
  else
  {
    LOBYTE(result) = 0;
  }
  return result;
}

// dsound_restore_buffer @ 0x0043BC40
// restores a lost DirectSound buffer
int dsound_restore_buffer(void *buffer)
{
  int result; // eax
  void *v2; // esi
  int v3; // eax

  v2 = buffer;
  if ( buffer
    && (result = (*(int (__stdcall **)(void *, void **))(*(_DWORD *)buffer + 36))(buffer, &buffer), result >= 0)
    && ((unsigned __int8)buffer & 2) != 0 )
  {
    do
    {
      while ( 1 )
      {
        v3 = (*(int (__stdcall **)(void *))(*(_DWORD *)v2 + 80))(v2);
        if ( v3 != -2005401450 )
          break;
        Sleep(0xAu);
      }
    }
    while ( v3 );
    OutputDebugStringA(OutputString);
    LOBYTE(result) = 1;
  }
  else
  {
    LOBYTE(result) = 0;
  }
  return result;
}

// resource_read_alloc @ 0x0043BCA0
// reads a resource into a newly allocated buffer
int resource_read_alloc(byte *path, void **out_data, uint *out_size)
{
  int result; // eax
  FILE *v4; // ebx
  void *v5; // esi

  result = resource_open_read(path, (int *)out_size);
  if ( (_BYTE)result )
  {
    v4 = fp;
    v5 = operator new(*out_size);
    crt_fread(v5, *out_size, 1u, v4);
    resource_close();
    result = (int)out_data;
    *out_data = v5;
    LOBYTE(result) = 1;
  }
  return result;
}

// sfx_entry_load_ogg @ 0x0043BCF0
// loads an OGG sample into an sfx entry
int sfx_entry_load_ogg(void *entry, byte *path)
{
  int result; // eax
  FILE *v3; // edi
  char *v4; // esi
  unsigned __int16 v5; // ax
  int v6; // ecx
  int v7; // eax
  unsigned int v8; // eax
  void *v9; // eax
  char *v10; // edi
  int i; // eax
  unsigned int v12; // [esp-4h] [ebp-320h]
  uint v13; // [esp+0h] [ebp-31Ch]
  void *v14; // [esp+0h] [ebp-31Ch]
  size_t ElementSize; // [esp+8h] [ebp-314h] BYREF
  unsigned int v16; // [esp+2F0h] [ebp-2Ch]
  int v17; // [esp+300h] [ebp-1Ch]
  int v18; // [esp+304h] [ebp-18h]

  result = resource_open_read(path, (int *)&ElementSize);
  if ( (_BYTE)result )
  {
    v3 = fp;
    v4 = (char *)operator new(ElementSize + 8);
    crt_fread(v4 + 8, ElementSize, 1u, v3);
    resource_close();
    result = vorbis_mem_open(v4, (void *)ElementSize, v13);
    if ( (_BYTE)result )
    {
      *(_DWORD *)entry = 0;
      *((_DWORD *)entry + 1) = 0;
      *((_DWORD *)entry + 2) = 0;
      *((_DWORD *)entry + 3) = 0;
      *((_WORD *)entry + 8) = 0;
      v5 = v17;
      *((_WORD *)entry + 1) = v17;
      v6 = v18;
      *(_WORD *)entry = 1;
      v7 = 16 * v5 / 8;
      *((_WORD *)entry + 6) = v7;
      *((_DWORD *)entry + 2) = v6 * (unsigned __int16)v7;
      v8 = v16;
      v12 = v16;
      *((_DWORD *)entry + 1) = v6;
      *((_WORD *)entry + 7) = 16;
      *((_WORD *)entry + 8) = 0;
      *((_DWORD *)entry + 6) = v8;
      v9 = operator new(v12);
      v10 = (char *)*((_DWORD *)entry + 6);
      *((_DWORD *)entry + 5) = v9;
      for ( i = 1; v10; v10 -= i )
      {
        if ( !i )
          break;
        i = vorbis_read_pcm16((void *)(*((_DWORD *)entry + 5) + *((_DWORD *)entry + 6) - (_DWORD)v10), v10, (int)v14);
      }
      vorbis_mem_close(v14);
      result = sfx_entry_create_buffers((int)entry);
      LOBYTE(result) = (_BYTE)result != 0;
    }
  }
  return result;
}

// sfx_entry_seek @ 0x0043BE20
// seeks streaming sfx data and resets playback cursors
void sfx_entry_seek(int entry, int sample_offset)
{
  uint v2; // edi

  if ( *(_DWORD *)(entry + 116) )
  {
    (*(void (__stdcall **)(_DWORD, int))(**(_DWORD **)(entry + 36) + 52))(*(_DWORD *)(entry + 36), sample_offset);
    vorbis_pcm_seek((void *)sample_offset, v2);
    *(_DWORD *)(entry + 28) = 0;
    *(_DWORD *)(entry + 120) = 0;
    *(_DWORD *)(entry + 124) = 0;
    *(_DWORD *)(entry + 128) = 0;
  }
}

// sfx_entry_start_playback @ 0x0043BE60
// selects a voice/buffer and starts playback
int sfx_entry_start_playback(int entry)
{
  int v1; // edi
  _DWORD *v3; // ebp
  int v4; // esi

  v1 = entry;
  if ( !entry )
    return -1;
  v3 = (_DWORD *)(entry + 36);
  if ( (unsigned __int8)dsound_restore_buffer(*(void **)(entry + 36)) )
  {
    if ( *(_DWORD *)(v1 + 116) )
    {
LABEL_7:
      sfx_entry_seek(v1, 0);
      music_stream_fill(v1);
      music_stream_fill(v1);
      music_stream_fill(v1);
      (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, int))(*(_DWORD *)*v3 + 48))(*v3, 0, 0, 1);
      return 0;
    }
    sfx_entry_upload_buffer(v1);
  }
  if ( *(_DWORD *)(v1 + 116) )
    goto LABEL_7;
  v4 = 0;
  while ( 1 )
  {
    if ( *v3 )
    {
      (*(void (__stdcall **)(_DWORD, int *))(*(_DWORD *)*v3 + 36))(*v3, &entry);
      if ( (entry & 1) == 0 )
        break;
    }
    ++v4;
    ++v3;
    if ( v4 >= 16 )
    {
      v4 = crt_rand() % 16;
      (*(void (__stdcall **)(_DWORD))(**(_DWORD **)(v1 + 4 * v4 + 36) + 72))(*(_DWORD *)(v1 + 4 * v4 + 36));
      break;
    }
  }
  (*(void (__stdcall **)(_DWORD, int))(**(_DWORD **)(v1 + 4 * v4 + 36) + 68))(
    *(_DWORD *)(v1 + 4 * v4 + 36),
    sfx_rate_scale);
  (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, _DWORD))(**(_DWORD **)(v1 + 4 * v4 + 36) + 48))(
    *(_DWORD *)(v1 + 4 * v4 + 36),
    0,
    0,
    0);
  return v4;
}

// sfx_entry_resume @ 0x0043BF40
// restarts playback for a streaming entry
void sfx_entry_resume(int entry)
{
  if ( *(_DWORD *)(entry + 116) )
    (*(void (__stdcall **)(_DWORD, _DWORD, _DWORD, int))(**(_DWORD **)(entry + 36) + 48))(
      *(_DWORD *)(entry + 36),
      0,
      0,
      1);
}

// sfx_entry_stop @ 0x0043BF60
// stops playback for all voices
void sfx_entry_stop(int entry)
{
  int v1; // eax
  _DWORD *v2; // esi
  int v3; // edi

  if ( entry )
  {
    if ( *(_DWORD *)(entry + 116) )
    {
      v1 = *(_DWORD *)(entry + 36);
      if ( v1 )
        (*(void (__stdcall **)(int))(*(_DWORD *)v1 + 72))(v1);
    }
    else
    {
      v2 = (_DWORD *)(entry + 36);
      v3 = 16;
      do
      {
        if ( *v2 )
          (*(void (__stdcall **)(_DWORD))(*(_DWORD *)*v2 + 72))(*v2);
        ++v2;
        --v3;
      }
      while ( v3 );
    }
  }
}

// sfx_entry_set_volume @ 0x0043BFA0
// sets the volume for active voices
void sfx_entry_set_volume(int entry, float volume)
{
  int v2; // ebx
  _DWORD *v3; // edi
  float volumea; // [esp+Ch] [ebp+8h]

  volumea = (volume + 2.0) * 0.33333334;
  if ( !*(_DWORD *)(entry + 116) || *(float *)(entry + 32) != volumea )
  {
    v2 = 0;
    *(float *)(entry + 32) = volumea;
    v3 = (_DWORD *)(entry + 36);
    do
    {
      if ( *v3 )
      {
        (*(void (__stdcall **)(_DWORD, _DWORD))(*(_DWORD *)*v3 + 60))(*v3, (__int64)((1.0 - volumea) * -10000.0));
        if ( *(_DWORD *)(entry + 116) )
          break;
      }
      ++v2;
      ++v3;
    }
    while ( v2 < 16 );
  }
}

// sfx_entry_load_wav @ 0x0043C020
// loads a WAV sample into an sfx entry
int sfx_entry_load_wav(void *entry, byte *path)
{
  int result; // eax
  int Offset; // [esp+4h] [ebp-4h] BYREF

  result = resource_read_alloc(path, (void **)&path, (uint *)&Offset);
  if ( (_BYTE)result )
  {
    if ( (unsigned __int8)wav_parse_into_entry(entry, path, Offset) )
    {
      crt_free(path);
      result = sfx_entry_create_buffers((int)entry);
      LOBYTE(result) = (_BYTE)result != 0;
    }
    else
    {
      crt_free(path);
      LOBYTE(result) = 0;
    }
  }
  return result;
}

// sfx_release_entry @ 0x0043C090
// frees a sound entry (sample/voices)
void sfx_release_entry(int entry)
{
  int v1; // eax
  void *v2; // edx
  _DWORD *v3; // esi
  int v4; // ebx
  void *v5; // [esp+0h] [ebp-8h]

  if ( *(_DWORD *)(entry + 116) )
  {
    vorbis_mem_close(v5);
    crt_free(*(void **)(entry + 116));
    v1 = *(_DWORD *)(entry + 36);
    *(_DWORD *)(entry + 116) = 0;
    if ( v1 )
      (*(void (__stdcall **)(int))(*(_DWORD *)v1 + 8))(v1);
    v2 = *(void **)(entry + 20);
    *(_DWORD *)(entry + 36) = 0;
    crt_free(v2);
    *(_DWORD *)(entry + 20) = 0;
  }
  else
  {
    v3 = (_DWORD *)(entry + 96);
    v4 = 16;
    do
    {
      if ( *v3 )
        (*(void (__stdcall **)(_DWORD))(*(_DWORD *)*v3 + 8))(*v3);
      *v3-- = 0;
      --v4;
    }
    while ( v4 );
    crt_free(*(void **)(entry + 20));
    *(_DWORD *)(entry + 20) = 0;
  }
}

// wav_parse_into_entry @ 0x0043C110
// parses WAV data into an entry and copies PCM
int wav_parse_into_entry(void *entry, void *data, int size)
{
  int result; // eax
  unsigned __int16 u16; // cx
  unsigned __int16 v5; // ax
  int v6; // eax
  uint u32; // ebx
  char *v8; // eax
  char *v9; // edi

  *(_DWORD *)entry = 0;
  *((_DWORD *)entry + 1) = 0;
  *((_DWORD *)entry + 2) = 0;
  *((_DWORD *)entry + 3) = 0;
  *((_WORD *)entry + 8) = 0;
  *(_WORD *)entry = 1;
  *((_WORD *)entry + 1) = 1;
  *((_WORD *)entry + 7) = 16;
  *((_DWORD *)entry + 1) = 22050;
  *((_WORD *)entry + 6) = 2;
  *((_WORD *)entry + 8) = 0;
  *((_DWORD *)entry + 2) = 44100;
  buffer_reader_init(data, size);
  buffer_reader_seek(0);
  result = buffer_reader_find_tag(tag, 4);
  if ( (_BYTE)result )
  {
    buffer_reader_skip(4);
    buffer_reader_skip(2);
    *((_WORD *)entry + 1) = buffer_reader_read_u16();
    *((_DWORD *)entry + 1) = buffer_reader_read_u32();
    buffer_reader_skip(6);
    u16 = buffer_reader_read_u16();
    v5 = *((_WORD *)entry + 1);
    *((_WORD *)entry + 7) = u16;
    *((_WORD *)entry + 8) = 0;
    v6 = u16 * v5 / 8;
    *((_WORD *)entry + 6) = v6;
    *((_DWORD *)entry + 2) = *((_DWORD *)entry + 1) * (unsigned __int16)v6;
    buffer_reader_find_tag(aData, 4);
    u32 = buffer_reader_read_u32();
    *((_DWORD *)entry + 6) = u32;
    v8 = (char *)operator new(u32);
    *((_DWORD *)entry + 5) = v8;
    v9 = v8;
    result = u32;
    qmemcpy(v9, (char *)data + dword_4C3C78, u32);
    LOBYTE(result) = 1;
  }
  return result;
}

// sfx_entry_upload_buffer @ 0x0043C230
// uploads PCM data into a DirectSound buffer
int sfx_entry_upload_buffer(int entry)
{
  int v1; // ebx
  int result; // eax
  int v3; // [esp+20h] [ebp-4h] BYREF

  v1 = entry;
  if ( (*(int (__stdcall **)(_DWORD, _DWORD, _DWORD, int *, int *, _DWORD, _DWORD, _DWORD))(**(_DWORD **)(entry + 36)
                                                                                          + 44))(
         *(_DWORD *)(entry + 36),
         0,
         *(_DWORD *)(entry + 24),
         &entry,
         &v3,
         0,
         0,
         0) != -2005401450
    || (result = dsound_restore_buffer(*(void **)(v1 + 36)), (_BYTE)result) )
  {
    qmemcpy((void *)entry, *(const void **)(v1 + 20), *(_DWORD *)(v1 + 24));
    result = (*(int (__stdcall **)(_DWORD, int, int, _DWORD, _DWORD))(**(_DWORD **)(v1 + 36) + 76))(
               *(_DWORD *)(v1 + 36),
               entry,
               v3,
               0,
               0);
    LOBYTE(result) = 1;
  }
  return result;
}

// sfx_entry_create_buffers @ 0x0043C2B0
// creates DirectSound buffers for an sfx entry
int sfx_entry_create_buffers(int entry)
{
  int result; // eax
  int v2; // edi
  LPDIRECTSOUNDBUFFER *v3; // esi
  int v4; // esi
  _DWORD *v5; // edi
  _DWORD v6[9]; // [esp+10h] [ebp-24h] BYREF

  memset(v6, 0, sizeof(v6));
  v6[2] = *(_DWORD *)(entry + 24);
  memset(&v6[5], 0, 16);
  v6[0] = 36;
  v6[1] = 32992;
  v6[4] = entry;
  result = ppDS8->lpVtbl->CreateSoundBuffer(ppDS8, (LPCDSBUFFERDESC)v6, (LPDIRECTSOUNDBUFFER *)(entry + 36), 0);
  if ( result >= 0 )
  {
    v2 = 1;
    v3 = (LPDIRECTSOUNDBUFFER *)(entry + 40);
    do
    {
      if ( ppDS8->lpVtbl->DuplicateSoundBuffer(ppDS8, *(LPDIRECTSOUNDBUFFER *)(entry + 36), v3) < 0 )
      {
        OutputDebugStringA(aSndFailedToDup);
        LOBYTE(result) = 0;
        return result;
      }
      ++v2;
      ++v3;
    }
    while ( v2 < 16 );
    sfx_entry_upload_buffer(entry);
    v4 = 0;
    v5 = (_DWORD *)(entry + 36);
    do
    {
      *(_BYTE *)(v4 + entry + 100) = 0;
      (*(void (__stdcall **)(_DWORD))(*(_DWORD *)*v5 + 72))(*v5);
      result = (*(int (__stdcall **)(_DWORD, _DWORD))(*(_DWORD *)*v5 + 52))(*v5, 0);
      ++v4;
      ++v5;
    }
    while ( v4 < 16 );
    LOBYTE(result) = 1;
  }
  else
  {
    LOBYTE(result) = 0;
  }
  return result;
}

// music_entry_load_ogg @ 0x0043C3A0
// loads an OGG stream into a music entry
int music_entry_load_ogg(void *entry, byte *path)
{
  int result; // eax
  FILE *v3; // esi
  char *v4; // edi
  void *v5; // eax
  byte *v6; // edx
  int v7; // eax
  unsigned __int16 v8; // dx
  int v9; // eax
  void *v10; // edi
  unsigned int v11; // edx
  int v12; // eax
  uint v13; // [esp+0h] [ebp-2Ch]
  _DWORD v14[9]; // [esp+8h] [ebp-24h] BYREF

  result = resource_open_read(path, (int *)&path);
  if ( (_BYTE)result )
  {
    v3 = fp;
    v4 = (char *)operator new((unsigned int)(path + 8));
    crt_fread(v4 + 8, (uint)path, 1u, v3);
    resource_close();
    v5 = operator new(0x310u);
    v6 = path;
    *((_DWORD *)entry + 29) = v5;
    result = vorbis_mem_open(v4, v6, v13);
    if ( (_BYTE)result )
    {
      *(_DWORD *)entry = 0;
      *((_DWORD *)entry + 1) = 0;
      *((_DWORD *)entry + 2) = 0;
      *((_DWORD *)entry + 3) = 0;
      *((_WORD *)entry + 8) = 0;
      v7 = *((_DWORD *)entry + 29);
      *(_WORD *)entry = 1;
      v8 = *(_WORD *)(v7 + 756);
      *((_WORD *)entry + 1) = v8;
      *((_DWORD *)entry + 1) = *(_DWORD *)(v7 + 760);
      *((_WORD *)entry + 7) = 16;
      *((_WORD *)entry + 8) = 0;
      *((_WORD *)entry + 6) = 16 * v8 / 8;
      v9 = *((_DWORD *)entry + 1) * (unsigned __int16)(16 * v8 / 8);
      *((_DWORD *)entry + 2) = v9;
      *((_DWORD *)entry + 6) = 2 * v9;
      v10 = operator new(2 * v9);
      v11 = *((_DWORD *)entry + 6);
      *((_DWORD *)entry + 5) = v10;
      memset(v10, 0, v11);
      memset(v14, 0, sizeof(v14));
      v12 = *((_DWORD *)entry + 6);
      memset(&v14[5], 0, 16);
      v14[2] = v12;
      v14[0] = 36;
      v14[1] = 98496;
      v14[4] = entry;
      result = ppDS8->lpVtbl->CreateSoundBuffer(
                 ppDS8,
                 (LPCDSBUFFERDESC)v14,
                 (LPDIRECTSOUNDBUFFER *)((char *)entry + 36),
                 0);
      if ( result >= 0 )
      {
        *((_DWORD *)entry + 32) = 0;
        LOBYTE(result) = 1;
      }
      else
      {
        LOBYTE(result) = 0;
      }
    }
  }
  return result;
}

// music_stream_update @ 0x0043C520
// updates streaming cursor and refills if needed
void music_stream_update(int entry)
{
  _DWORD *v1; // esi
  unsigned int v2; // edx
  int v3; // eax
  int v4; // edx
  int v5; // edx
  unsigned int v6; // ecx
  int v7; // eax
  unsigned int v8; // eax

  v1 = (_DWORD *)entry;
  if ( (*(int (__stdcall **)(_DWORD, int *, _DWORD))(**(_DWORD **)(entry + 36) + 16))(
         *(_DWORD *)(entry + 36),
         &entry,
         0) >= 0 )
  {
    v2 = v1[30];
    if ( entry >= v2 )
      v3 = entry - v2;
    else
      v3 = entry + v1[6] - v2;
    v4 = v1[31];
    v1[30] = entry;
    v5 = v3 + v4;
    v6 = v3 + v1[32];
    v7 = v1[6];
    v1[31] = v5;
    v1[32] = v6;
    v8 = v7 / 4;
    if ( v6 > v8 )
    {
      v1[32] = v6 - v8;
      music_stream_fill((int)v1);
    }
  }
}

// music_stream_fill @ 0x0043C590
// decodes and writes the next music stream chunk
int music_stream_fill(int entry)
{
  int v1; // edi
  int v2; // eax
  int v3; // ecx
  int result; // eax
  int v5; // eax
  char *v6; // esi
  int pcm16; // eax
  int v8; // ecx
  int v9; // [esp+1Ch] [ebp-14h]
  int v10; // [esp+24h] [ebp-Ch] BYREF
  int v11; // [esp+28h] [ebp-8h] BYREF
  _BYTE v12[4]; // [esp+2Ch] [ebp-4h] BYREF

  v1 = entry;
  v2 = *(_DWORD *)(entry + 24);
  v3 = *(_DWORD *)(entry + 36);
  v10 = 0;
  v11 = 0;
  result = (*(int (__stdcall **)(int, _DWORD, int, int *, int *, int *, _BYTE *, _DWORD))(*(_DWORD *)v3 + 44))(
             v3,
             *(_DWORD *)(entry + 28),
             v2 / 4,
             &v10,
             &entry,
             &v11,
             v12,
             0);
  if ( result >= 0 )
  {
    if ( v11 )
    {
      OutputDebugStringA(aSndSomehowData);
      LOBYTE(result) = 0;
      return result;
    }
    v5 = entry;
    v6 = (char *)entry;
    while ( 1 )
    {
      pcm16 = vorbis_read_pcm16((void *)(v10 + v5 - (_DWORD)v6), v6, v9);
      if ( pcm16 <= 0 )
        pcm16 = vorbis_read_pcm16((void *)(v10 + entry - (_DWORD)v6), v6, v9);
      v6 -= pcm16;
      if ( (int)v6 <= 0 || !pcm16 )
        break;
      v5 = entry;
    }
    (*(void (__stdcall **)(_DWORD, int, int, _DWORD, _DWORD))(**(_DWORD **)(v1 + 36) + 76))(
      *(_DWORD *)(v1 + 36),
      v10,
      entry,
      0,
      0);
    v8 = *(_DWORD *)(v1 + 28);
    result = (v8 + entry) / *(_DWORD *)(v1 + 24);
    *(_DWORD *)(v1 + 28) = (v8 + entry) % *(_DWORD *)(v1 + 24);
  }
  LOBYTE(result) = 0;
  return result;
}

// sub_43C680 @ 0x0043C680
_DWORD *sub_43C680()
{
  int *v0; // esi
  int v1; // edi
  _DWORD *result; // eax
  void *v3; // [esp+0h] [ebp-8h]

  v0 = &sfx_entry_table;
  v1 = 128;
  do
  {
    result = FUN_0043b810(v3);
    v0 += 33;
    --v1;
  }
  while ( v1 );
  return result;
}

// sub_43C6B0 @ 0x0043C6B0
int sub_43C6B0()
{
  memset(&sfx_trooper_inpain_01, 0, 0x14Cu);
  return 0;
}

// sub_43C6E0 @ 0x0043C6E0
_DWORD *sub_43C6E0()
{
  int *v0; // esi
  int v1; // edi
  _DWORD *result; // eax
  void *v3; // [esp+0h] [ebp-8h]

  v0 = &music_entry_table;
  v1 = 128;
  do
  {
    result = FUN_0043b810(v3);
    v0 += 33;
    --v1;
  }
  while ( v1 );
  return result;
}

// sfx_release_sample @ 0x0043C700
// releases an sfx sample by id
int sfx_release_sample(int sfx_id)
{
  int result; // eax

  if ( (unsigned int)sfx_id < 0x80 && (result = 132 * sfx_id, sfx_entry_table_state[33 * sfx_id]) )
  {
    sfx_release_entry((int)&sfx_entry_table + result);
    LOBYTE(result) = 1;
  }
  else
  {
    LOBYTE(result) = 0;
  }
  return result;
}

// sfx_load_sample @ 0x0043C740
// loads an sfx sample and returns its id
int sfx_load_sample(char *path)
{
  int v2; // ebp
  int *v3; // eax
  char *v4; // edi
  char Buffer[128]; // [esp+8h] [ebp-80h] BYREF

  if ( LOBYTE(config_blob[0]) )
    return 1;
  v2 = 0;
  v3 = sfx_entry_table_state;
  while ( *v3 )
  {
    v3 += 33;
    ++v2;
    if ( (int)v3 >= (int)dword_4CC6E4 )
      return -1;
  }
  if ( v2 == -1 )
    return -1;
  v4 = path;
  if ( !strcmp(path, aOgg) )
  {
    console_printf(&console_log_queue, "Warning: sample '%s' not accepted.\n", path);
    v4 = aTrooperInpain0;
  }
  if ( strstr(v4, aOgg) )
  {
    if ( byte_4CC8D5 )
      crt_sprintf(Buffer, "%s", v4);
    else
      crt_sprintf(Buffer, "sfx\\%s", v4);
    if ( !(unsigned __int8)sfx_entry_load_ogg((void *)(132 * v2 + 5014736), (byte *)Buffer) )
    {
      console_printf(&console_log_queue, "...loading ogg sample '%s' failed\n", v4);
      return -1;
    }
  }
  else if ( !(unsigned __int8)sfx_entry_load_wav((void *)(132 * v2 + 5014736), (byte *)v4) )
  {
    console_printf(&console_log_queue, "...loading wav sample '%s' failed\n", v4);
    return -1;
  }
  if ( *(float *)(cv_silentloads + 12) == 0.0 )
    console_printf(&console_log_queue, "SFX Sample %d <- '%s' ok\n", v2, v4);
  ++dword_4CC8D8;
  return v2;
}

// music_load_track @ 0x0043C8D0
// loads a music track and returns its id
int music_load_track(char *path)
{
  int v1; // esi
  _DWORD *v2; // eax

  v1 = 0;
  ++dword_4CC8D8;
  v2 = &unk_4C42C4;
  while ( *(v2 - 24) || *v2 )
  {
    v2 += 33;
    ++v1;
    if ( (int)v2 >= (int)dword_4C84C4 )
      return -1;
  }
  if ( v1 == -1 )
    return -1;
  if ( (unsigned __int8)music_entry_load_ogg((void *)(132 * v1 + 4997712), (byte *)path) )
    console_printf(&console_log_queue, "SFX Tune %d <- '%s' ok\n", v1, path);
  else
    console_printf(&console_log_queue, "SFX Tune %d <- '%s' FAILED\n", v1, path);
  return v1;
}

// music_queue_track @ 0x0043C960
// queues a music track id
void music_queue_track(int track_id)
{
  int v1; // eax

  if ( track_id >= 0 )
  {
    v1 = dword_4CC8D0;
    music_playlist[dword_4CC8D0] = track_id;
    dword_4CC8D0 = v1 + 1;
  }
}

// music_release_track @ 0x0043C980
// releases a music track by id
int music_release_track(int track_id)
{
  int result; // eax

  if ( (unsigned int)track_id < 0x80 && (result = 132 * track_id, dword_4C4264[33 * track_id]) )
  {
    sfx_release_entry((int)&music_entry_table + result);
    LOBYTE(result) = 1;
  }
  else
  {
    LOBYTE(result) = 0;
  }
  return result;
}

// audio_init_music @ 0x0043C9C0
// loads music pack and registers music track ids
void audio_init_music()
{
  if ( !LOWORD(config_blob[0]) )
  {
    memset(sfx_mute_flags, 1u, 0x80u);
    memset(sfx_volume_table, 0, 0x200u);
    byte_4CC8D5 = resource_pack_set(aMusicPaq);
    if ( byte_4CC8D5 )
      console_printf(&console_log_queue, aSetSoundResour);
    else
      console_printf(&console_log_queue, aResourcePaqMus);
    music_track_intro_id = music_load_track(aMusicIntroOgg);
    music_track_shortie_monk_id = music_load_track(aMusicShortieMo);
    console_exec_line(aExecMusicGameT);
    music_track_crimson_theme_id = music_load_track(aMusicCrimsonTh);
    music_track_crimsonquest_id = music_load_track(aMusicCrimsonqu);
    music_track_extra_0 = music_track_crimsonquest_id + 1;
    music_track_extra_1 = music_track_crimsonquest_id + 2;
    sfx_unmuted_flag = 1;
  }
}

// audio_init_sfx @ 0x0043CAA0
// loads sfx pack and registers sound effect ids
void audio_init_sfx()
{
  DWORD Time; // edi
  DWORD v1; // eax
  int v2; // edx
  int *v3; // ecx

  if ( !LOBYTE(config_blob[0]) )
  {
    byte_4CC8D5 = resource_pack_set(aSfxPaq);
    if ( byte_4CC8D5 )
      console_printf(&console_log_queue, aSetSoundResour_0);
    else
      console_printf(&console_log_queue, aFailedToSetSou);
    Time = timeGetTime();
    sfx_trooper_inpain_01 = sfx_load_sample(aTrooperInpain0);
    sfx_trooper_inpain_02 = sfx_load_sample(aTrooperInpain0_0);
    sfx_trooper_inpain_03 = sfx_load_sample(aTrooperInpain0_1);
    sfx_trooper_die_01 = sfx_load_sample(aTrooperDie01Og);
    sfx_trooper_die_02 = sfx_load_sample(aTrooperDie02Og);
    sfx_trooper_die_03 = sfx_load_sample(aTrooperDie03Og);
    sfx_zombie_die_01 = sfx_load_sample(aZombieDie01Ogg);
    sfx_zombie_die_02 = sfx_load_sample(aZombieDie02Ogg);
    sfx_zombie_die_03 = sfx_load_sample(aZombieDie03Ogg);
    sfx_zombie_die_04 = sfx_load_sample(aZombieDie04Ogg);
    sfx_zombie_attack_01 = sfx_load_sample(aZombieAttack01);
    sfx_zombie_attack_02 = sfx_load_sample(aZombieAttack02);
    sfx_alien_die_01 = sfx_load_sample(aAlienDie01Ogg);
    sfx_alien_die_02 = sfx_load_sample(aAlienDie02Ogg);
    sfx_alien_die_03 = sfx_load_sample(aAlienDie03Ogg);
    sfx_alien_die_04 = sfx_load_sample(aAlienDie04Ogg);
    sfx_alien_attack_01 = sfx_load_sample(aAlienAttack01O);
    sfx_alien_attack_02 = sfx_load_sample(aAlienAttack02O);
    sfx_lizard_die_01 = sfx_load_sample(aLizardDie01Ogg);
    sfx_lizard_die_02 = sfx_load_sample(aLizardDie02Ogg);
    sfx_lizard_die_03 = sfx_load_sample(aLizardDie03Ogg);
    sfx_lizard_die_04 = sfx_load_sample(aLizardDie04Ogg);
    sfx_lizard_attack_01 = sfx_load_sample(aLizardAttack01);
    sfx_lizard_attack_02 = sfx_load_sample(aLizardAttack02);
    sfx_spider_die_01 = sfx_load_sample(aSpiderDie01Ogg);
    sfx_spider_die_02 = sfx_load_sample(aSpiderDie02Ogg);
    sfx_spider_die_03 = sfx_load_sample(aSpiderDie03Ogg);
    sfx_spider_die_04 = sfx_load_sample(aSpiderDie04Ogg);
    sfx_spider_attack_01 = sfx_load_sample(aSpiderAttack01);
    sfx_spider_attack_02 = sfx_load_sample(aSpiderAttack02);
    sfx_pistol_fire = sfx_load_sample(aPistolFireOgg);
    sfx_pistol_reload = sfx_load_sample(aPistolReloadOg);
    sfx_shotgun_fire = sfx_load_sample(aShotgunFireOgg);
    sfx_shotgun_reload = sfx_load_sample(aShotgunReloadO);
    sfx_autorifle_fire = sfx_load_sample(aAutorifleFireO);
    sfx_autorifle_reload = sfx_load_sample(aAutorifleReloa);
    sfx_gauss_fire = sfx_load_sample(aGaussFireOgg);
    sfx_hrpm_fire = sfx_load_sample(aHrpmFireOgg);
    LODWORD(sfx_shock_fire) = sfx_load_sample(aShockFireOgg);
    LODWORD(sfx_plasmaminigun_fire) = sfx_load_sample(aPlasmaminigunF);
    sfx_plasmashotgun_fire = sfx_load_sample(aPlasmashotgunF);
    sfx_pulse_fire = sfx_load_sample(aPulseFireOgg);
    sfx_flamer_fire_01 = sfx_load_sample(aFlamerFire01Og);
    sfx_flamer_fire_02 = sfx_load_sample(aFlamerFire02Og);
    sfx_shock_reload = sfx_load_sample(aShockReloadOgg);
    sfx_shock_fire_alt = sfx_load_sample(aShockFireOgg);
    sfx_shockminigun_fire = sfx_load_sample(aShockminigunFi);
    sfx_rocket_fire = sfx_load_sample(aRocketFireOgg);
    sfx_rocketmini_fire = sfx_load_sample(aRocketminiFire);
    sfx_autorifle_reload_alt = sfx_load_sample(aAutorifleReloa);
    sfx_bullet_hit_01 = sfx_load_sample(aBulletHit01Ogg);
    sfx_bullet_hit_02 = sfx_load_sample(aBulletHit02Ogg);
    sfx_bullet_hit_03 = sfx_load_sample(aBulletHit03Ogg);
    sfx_bullet_hit_04 = sfx_load_sample(aBulletHit04Ogg);
    sfx_bullet_hit_05 = sfx_load_sample(aBulletHit05Ogg);
    sfx_bullet_hit_06 = sfx_load_sample(aBulletHit06Ogg);
    LODWORD(sfx_shock_hit_01) = sfx_load_sample(aShockHit01Ogg);
    LODWORD(sfx_explosion_small) = sfx_load_sample(aExplosionSmall);
    LODWORD(sfx_explosion_medium) = sfx_load_sample(aExplosionMediu);
    LODWORD(sfx_explosion_large) = sfx_load_sample(aExplosionLarge);
    LODWORD(sfx_shockwave) = sfx_load_sample(aShockwaveOgg);
    sfx_questhit = sfx_load_sample(aQuesthitOgg);
    LODWORD(sfx_ui_bonus) = sfx_load_sample(aUiBonusOgg);
    sfx_trooper_inpain_01_alias_0 = sfx_trooper_inpain_01;
    LODWORD(sfx_trooper_inpain_01_alias_1) = sfx_trooper_inpain_01;
    sfx_trooper_inpain_01_alias_2 = sfx_trooper_inpain_01;
    sfx_ui_buttonclick = sfx_load_sample(aUiButtonclickO);
    sfx_ui_panelclick = sfx_load_sample(aUiPanelclickOg);
    sfx_ui_levelup = sfx_load_sample(aUiLevelupOgg);
    sfx_ui_typeclick_01 = sfx_load_sample(aUiTypeclick01O);
    sfx_ui_typeclick_02 = sfx_load_sample(aUiTypeclick02O);
    sfx_ui_typeenter = sfx_load_sample(aUiTypeenterOgg);
    sfx_ui_clink_01 = sfx_load_sample(aUiClink01Ogg);
    sfx_bloodspill_01 = sfx_load_sample(aBloodspill01Og);
    sfx_bloodspill_02 = sfx_load_sample(aBloodspill02Og);
    v1 = timeGetTime();
    v2 = 0;
    v3 = sfx_entry_table_state;
    do
    {
      if ( !*v3 )
        break;
      v3 += 33;
      ++v2;
    }
    while ( (int)v3 < (int)dword_4CC6E4 );
    console_printf(
      &console_log_queue,
      "%d samples loaded to sound library in %.2f seconds.\n",
      v2,
      (double)(int)(v1 - Time) * 0.001);
  }
}

// sfx_system_init @ 0x0043CF90
// initializes the Grim SFX system and clears per-sfx state
int sfx_system_init()
{
  int result; // eax
  HWND ForegroundWindow; // eax

  if ( LOBYTE(config_blob[0]) )
  {
    LOBYTE(result) = 1;
  }
  else
  {
    console_printf(&console_log_queue, aInitializingGr);
    ForegroundWindow = GetForegroundWindow();
    if ( (unsigned __int8)dsound_init(ForegroundWindow, 2u) )
    {
      console_printf(&console_log_queue, aInit44100Hz16B);
      console_printf(&console_log_queue, aUsingDirectsou);
      console_printf(&console_log_queue, aUsingDefaultSp);
      console_printf(&console_log_queue, aSayingHelloToT);
      memset(sfx_cooldown_table, 0, sizeof(sfx_cooldown_table));
      memset(sfx_voice_table, 0, sizeof(sfx_voice_table));
      console_printf(&console_log_queue, aInitGrimSfxDon);
      LOBYTE(result) = 1;
    }
    else
    {
      console_printf(&console_log_queue, aFailedUnableTo);
      LOWORD(config_blob[0]) = 257;
      LOBYTE(result) = 0;
    }
  }
  return result;
}

// sfx_release_all @ 0x0043D070
// releases all loaded sfx samples
void sfx_release_all()
{
  char *v0; // esi
  int *v1; // esi
  char *v2; // [esp-4h] [ebp-4h]

  if ( !LOBYTE(config_blob[0]) )
  {
    v2 = v0;
    v1 = &sfx_entry_table;
    do
    {
      sfx_release_entry((int)v1);
      v1 += 33;
    }
    while ( (int)v1 < (int)music_playlist );
    console_printf(&console_log_queue, aSfxShutdown);
    console_printf(&console_log_queue, aSfxReleased);
    console_flush_log(console_log_filename, v2);
  }
}

// music_release_all @ 0x0043D0D0
// releases all loaded music tracks
void music_release_all()
{
  char *v0; // esi
  int *v1; // esi
  char *v2; // [esp-4h] [ebp-4h]

  if ( sfx_unmuted_flag )
  {
    v2 = v0;
    v1 = &music_entry_table;
    do
    {
      sfx_release_entry((int)v1);
      v1 += 33;
    }
    while ( (int)v1 < (int)sfx_mute_flags );
    console_flush_log(console_log_filename, v2);
  }
}

// audio_shutdown_all @ 0x0043D110
// shuts down sfx + music systems
void audio_shutdown_all()
{
  sfx_release_all();
  music_release_all();
  if ( ppDS8 )
    ppDS8->lpVtbl->Release(ppDS8);
  ppDS8 = 0;
}

// sfx_play @ 0x0043D120
// plays a sound effect with centered pan
int sfx_play(int sfx_id)
{
  int *v2; // edi
  int v3; // [esp+4h] [ebp-10h]
  float volume; // [esp+8h] [ebp-Ch]
  float v5; // [esp+1Ch] [ebp+8h]

  if ( !sfx_entry_table_state[33 * sfx_id] )
    return -1;
  if ( LOBYTE(config_blob[0]) )
    return -1;
  if ( sfx_cooldown_table[sfx_id] > 0.0 )
    return -1;
  if ( demo_mode_active )
    v5 = v5 * 0.69999999;
  if ( bonus_reflex_boost_timer <= 0.0 )
  {
    sfx_rate_scale = 44100;
  }
  else if ( bonus_reflex_boost_timer <= 1.0 )
  {
    if ( bonus_reflex_boost_timer < 1.0 )
      sfx_rate_scale = (__int64)((1.0 - bonus_reflex_boost_timer + 1.0) * 22050.0);
  }
  else
  {
    sfx_rate_scale = 22050;
  }
  if ( sfx_id == sfx_flamer_fire_01 || sfx_id == sfx_flamer_fire_02 )
    sfx_cooldown_table[sfx_id] = 0.44;
  else
    sfx_cooldown_table[sfx_id] = 0.050000001;
  v2 = &sfx_entry_table + 33 * sfx_id;
  v3 = dword_4C84F4[32 * sfx_id + sfx_entry_start_playback((int)v2) + sfx_id];
  (*(void (__stdcall **)(int, _DWORD))(*(_DWORD *)v3 + 64))(v3, 0);
  volume = config_sfx_volume * v5;
  sfx_entry_set_volume((int)v2, volume);
  return sfx_id;
}

// sfx_play_panned @ 0x0043D260
// plays a sound effect with computed pan
float sfx_play_panned(float sfx_id)
{
  double v1; // st7
  __int64 v2; // rax
  int v3; // ebx
  int *v4; // edi
  int v6; // [esp+4h] [ebp-14h]
  float volume; // [esp+8h] [ebp-10h]
  float *v8; // [esp+20h] [ebp+8h]
  float v9; // [esp+24h] [ebp+Ch]

  if ( sfx_entry_table_state[33 * LODWORD(sfx_id)] )
  {
    if ( !LOBYTE(config_blob[0]) )
    {
      v1 = sfx_cooldown_table[LODWORD(sfx_id)];
      if ( v1 <= 0.0 )
      {
        if ( bonus_reflex_boost_timer <= 0.0 )
        {
          sfx_rate_scale = 44100;
        }
        else if ( bonus_reflex_boost_timer <= 1.0 )
        {
          if ( bonus_reflex_boost_timer < 1.0 )
            sfx_rate_scale = (__int64)((1.0 - bonus_reflex_boost_timer + 1.0) * 22050.0);
        }
        else
        {
          sfx_rate_scale = 22050;
        }
        if ( demo_mode_active )
          v9 = v9 * 0.69999999;
        if ( LODWORD(sfx_id) == sfx_flamer_fire_01 || LODWORD(sfx_id) == sfx_flamer_fire_02 )
          sfx_cooldown_table[LODWORD(sfx_id)] = 0.44;
        else
          sfx_cooldown_table[LODWORD(sfx_id)] = 0.050000001;
        v2 = (__int64)(((*(float *)&camera_offset_x + *v8) / (double)*(int *)config_screen_width - 0.5) * 1700.0);
        v3 = v2;
        if ( (int)v2 >= -10000 )
        {
          if ( (int)v2 > 10000 )
            v3 = 10000;
        }
        else
        {
          v3 = -10000;
        }
        v4 = &sfx_entry_table + 33 * LODWORD(sfx_id);
        v6 = dword_4C84F4[32 * LODWORD(sfx_id) + sfx_entry_start_playback((int)v4) + LODWORD(sfx_id)];
        (*(void (__stdcall **)(int, int))(*(_DWORD *)v6 + 64))(v6, v3);
        v1 = config_sfx_volume * v9;
        volume = v1;
        sfx_entry_set_volume((int)v4, volume);
      }
    }
  }
  return v1;
}

// audio_update @ 0x0043D3F0
// updates sfx cooldowns, music streams, and mute fades
void audio_update()
{
  float *v0; // ecx
  int *v1; // esi

  if ( !LOBYTE(config_blob[0]) )
  {
    v0 = sfx_cooldown_table;
    do
    {
      if ( *v0 > 0.0 )
        *v0 = *v0 - *(float *)&dword_47EA48;
      ++v0;
    }
    while ( (int)v0 < (int)sfx_voice_table );
    if ( sfx_unmuted_flag )
    {
      v1 = &music_entry_table;
      do
      {
        if ( v1[29] )
          music_stream_update((int)v1);
        v1 += 33;
      }
      while ( (int)v1 < (int)sfx_mute_flags );
      sfx_update_mute_fades();
    }
  }
}

// sfx_play_exclusive @ 0x0043D460
// mutes other sfx ids and ensures the chosen id is audible
void sfx_play_exclusive(int sfx_id)
{
  int v1; // edi
  int v2; // eax
  int i; // esi
  double v4; // st7

  if ( sfx_unmuted_flag && !LOWORD(config_blob[0]) )
  {
    v1 = sfx_id;
    if ( !byte_4824D1 )
    {
      if ( sfx_id == music_track_extra_0 )
      {
        if ( byte_4CC8D4 || !dword_4CC8D0 )
          return;
        v2 = crt_rand();
        byte_4CC8D4 = 1;
        v1 = music_playlist[v2 % dword_4CC8D0];
      }
      else
      {
        byte_4CC8D4 = 0;
      }
    }
    for ( i = 0; i < 128; ++i )
    {
      if ( i != v1 && (unsigned __int8)sfx_is_unmuted(i) )
        sfx_mute_all(i);
    }
    if ( sfx_volume_table[v1] <= 0.0 )
    {
      sfx_entry_start_playback(132 * v1 + 4997712);
      sfx_entry_set_volume(132 * v1 + 4997712, config_music_volume);
      v4 = config_music_volume;
      sfx_mute_flags[v1] = 0;
      sfx_volume_table[v1] = v4;
    }
  }
}

// sfx_mute_all @ 0x0043D550
// mutes all unmuted sfx ids (recursive)
void sfx_mute_all(int sfx_id)
{
  int i; // esi

  if ( sfx_unmuted_flag && !LOWORD(config_blob[0]) )
  {
    byte_4CC8D4 = 0;
    for ( i = 0; i < 128; ++i )
    {
      if ( i != sfx_id )
      {
        if ( (unsigned __int8)sfx_is_unmuted(i) )
          sfx_mute_all(i);
      }
    }
    sfx_mute_flags[sfx_id] = 1;
  }
}

// sfx_update_mute_fades @ 0x0043D5B0
// ramps volume up/down based on mute flags
void sfx_update_mute_fades()
{
  int v0; // ebp
  float *v1; // edi
  int *v2; // esi
  float v3; // eax
  float v4; // edx
  float volume; // [esp+8h] [ebp-8h]
  float volumea; // [esp+8h] [ebp-8h]
  _BYTE v7[4]; // [esp+Ch] [ebp-4h] BYREF

  if ( !audio_suspend_flag && sfx_unmuted_flag )
  {
    v0 = 0;
    v1 = sfx_volume_table;
    v2 = &music_entry_table;
    do
    {
      if ( v2[29] )
      {
        if ( config_music_volume > 0.0 )
        {
          if ( sfx_mute_flags[v0] )
            goto LABEL_11;
          (*(void (__stdcall **)(int, _BYTE *))(*(_DWORD *)v2[9] + 36))(v2[9], v7);
          if ( (v7[0] & 1) == 0 )
          {
            console_printf(&console_log_queue, aSndDetectedUns);
            sfx_entry_resume((int)v2);
          }
        }
        else
        {
          (*(void (__stdcall **)(int))(*(_DWORD *)v2[9] + 72))(v2[9]);
        }
        if ( sfx_mute_flags[v0] )
        {
LABEL_11:
          if ( *v1 > 0.0 )
          {
            volume = *v1 - frame_dt * 0.5;
            *v1 = volume;
            if ( volume > 0.0 )
              sfx_entry_set_volume((int)v2, volume);
            else
              sfx_entry_stop((int)v2);
          }
          if ( *v1 < 0.0 )
            *v1 = 0.0;
          goto LABEL_24;
        }
        if ( *v1 >= (double)config_music_volume )
        {
          if ( *v1 > (double)config_music_volume )
          {
            v4 = config_music_volume;
            *v1 = config_music_volume;
            v3 = v4;
            goto LABEL_23;
          }
        }
        else
        {
          volumea = frame_dt + *v1;
          *v1 = volumea;
          if ( volumea >= (double)config_music_volume )
          {
            v3 = config_music_volume;
LABEL_23:
            sfx_entry_set_volume((int)v2, v3);
            goto LABEL_24;
          }
          sfx_entry_set_volume((int)v2, volumea);
        }
      }
LABEL_24:
      v2 += 33;
      ++v0;
      ++v1;
    }
    while ( (int)v2 < (int)sfx_mute_flags );
  }
}

// audio_suspend_channels @ 0x0043D730
// iterates channels and suspends playback
void audio_suspend_channels()
{
  int *v0; // esi

  if ( sfx_unmuted_flag && !LOWORD(config_blob[0]) )
  {
    v0 = &music_entry_table;
    do
    {
      sfx_entry_stop((int)v0);
      v0 += 33;
    }
    while ( (int)v0 < (int)sfx_mute_flags );
  }
}

// audio_resume_channels @ 0x0043D770
// iterates channels and resumes playback
void audio_resume_channels()
{
  int v0; // edi
  int *v1; // esi

  if ( sfx_unmuted_flag && !LOWORD(config_blob[0]) )
  {
    v0 = 0;
    v1 = &music_entry_table;
    do
    {
      if ( !sfx_mute_flags[v0] )
        sfx_entry_resume((int)v1);
      v1 += 33;
      ++v0;
    }
    while ( (int)v1 < (int)sfx_mute_flags );
  }
}

// sfx_is_unmuted @ 0x0043D7C0
// returns nonzero when sfx id is not muted
int sfx_is_unmuted(int sfx_id)
{
  int result; // eax

  if ( sfx_unmuted_flag )
    return sfx_mute_flags[sfx_id] == 0;
  LOBYTE(result) = 0;
  return result;
}

// ui_focus_set @ 0x0043D7E0
// sets the active focus candidate; optionally resets the focus timer
void ui_focus_set(int id, char reset_timer)
{
  int v2; // eax
  int *i; // ecx

  if ( ui_focus_candidates[dword_4D11E4] != id )
  {
    if ( reset_timer )
      dword_4D11EC = 1000;
    v2 = 0;
    if ( dword_4D11E0 > 0 )
    {
      for ( i = ui_focus_candidates; *i != id; ++i )
      {
        if ( ++v2 >= dword_4D11E0 )
          return;
      }
      dword_4D11E4 = v2;
    }
  }
}

// ui_focus_update @ 0x0043D830
// handles menu focus navigation and returns 1 when the given id is focused
int ui_focus_update(int id)
{
  bool v1; // bl
  int v2; // eax
  int v3; // ecx
  int result; // eax
  int v5; // eax

  v1 = id == ui_focus_candidates[dword_4D11E4];
  if ( dword_4D11E8 == dword_480848 )
  {
    v5 = dword_4D11E0;
    if ( dword_4D11E0 >= 32 )
      v5 = 31;
    ui_focus_candidates[v5] = id;
    result = v5 + 1;
    dword_4D11E0 = result;
    LOBYTE(result) = v1;
  }
  else
  {
    dword_4D11EC -= frame_dt_ms;
    if ( dword_4D11EC < 0 )
      dword_4D11EC = 0;
    if ( !byte_4871CA
      && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 15) )
    {
      if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 42)
        || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 54) )
      {
        v2 = dword_4D11E4 - 1;
      }
      else
      {
        v2 = dword_4D11E4 + 1;
      }
      dword_4D11E4 = v2;
      dword_4D11EC = 1000;
    }
    v3 = dword_4D11E4;
    if ( dword_4D11E4 < 0 )
    {
      v3 = dword_4D11E0 - 1;
      dword_4D11E4 = dword_4D11E0 - 1;
    }
    if ( v3 > dword_4D11E0 - 1 )
      dword_4D11E4 = 0;
    dword_4D11E8 = dword_480848;
    ui_focus_candidates[0] = id;
    result = 1;
    dword_4D11E0 = 1;
    LOBYTE(result) = v1;
  }
  return result;
}

// ui_focus_draw @ 0x0043D940
// draws the focus highlight for the active menu item
void ui_focus_draw(float *xy)
{
  float v1[2]; // [esp+0h] [ebp-18h] BYREF
  _DWORD v2[4]; // [esp+8h] [ebp-10h] BYREF

  v2[0] = 1061997773;
  v2[1] = 1061997773;
  v2[2] = 1058642330;
  *(float *)&v2[3] = (double)dword_4D11EC * 0.00080000004;
  v1[0] = *xy;
  v1[1] = xy[1] + 4.0;
  (*(void (__thiscall **)(int, float *, int, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    v1,
    1086324736,
    1086324736,
    v2);
}

// FUN_0043d9b0 @ 0x0043D9B0
// [binja] int32_t sub_43d9b0(int32_t* arg1, int32_t arg2)
int FUN_0043d9b0(int *arg1, int arg2)
{
  char v3; // bl
  int v4; // eax
  double v5; // st6
  int v6; // ebp
  int v7; // eax
  int v8; // ebx
  __int64 v10; // rax
  int v11; // ecx
  int v12; // eax
  int v13; // eax
  int v14; // edi
  int result; // eax
  int v16; // edi
  float v17; // [esp+60h] [ebp-30h]
  float v18; // [esp+60h] [ebp-30h]
  int xy; // [esp+80h] [ebp-10h] BYREF
  float v20; // [esp+84h] [ebp-Ch]
  float v21; // [esp+88h] [ebp-8h]
  char arg2a; // [esp+98h] [ebp+8h]
  int arg2b; // [esp+98h] [ebp+8h]
  int arg2c; // [esp+98h] [ebp+8h]

  v3 = ui_focus_update(arg2);
  arg2a = 0;
  xy = 8 * *(_DWORD *)(arg2 + 4);
  v4 = xy;
  v5 = *(float *)arg1 - 3.0;
  v6 = arg1[1];
  v21 = *(float *)arg1;
  *(float *)&xy = v5;
  v20 = *((float *)arg1 + 1) - 1.0;
  if ( (unsigned __int8)ui_mouse_inside_rect((float *)&xy, 18, (__int64)((double)v4 + 6.0)) )
  {
    arg2a = 1;
    ui_focus_set(arg2, 0);
  }
  if ( v3 )
  {
    *(float *)&xy = *(float *)arg1 - 16.0;
    v20 = *((float *)arg1 + 1);
    ui_focus_draw((float *)&xy);
    if ( *(_BYTE *)(arg2 + 12) )
    {
      if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 205) )
      {
        v7 = *(_DWORD *)(arg2 + 4);
        v8 = *(_DWORD *)arg2 + 1;
        *(_DWORD *)arg2 = v8;
        if ( v8 > v7 )
          *(_DWORD *)arg2 = v7;
      }
      if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 203) )
      {
        if ( --*(_DWORD *)arg2 < 0 )
          *(_DWORD *)arg2 = 0;
      }
    }
  }
  if ( arg2a && (unsigned __int8)input_primary_is_down() && *(_BYTE *)(arg2 + 12) )
  {
    v10 = (__int64)((ui_mouse_x - *(float *)arg1) * 0.125);
    v11 = *(_DWORD *)(arg2 + 8);
    *(_DWORD *)arg2 = v10;
    if ( (int)v10 < v11 )
      *(_DWORD *)arg2 = v11;
    v12 = *(_DWORD *)(arg2 + 4);
    if ( *(_DWORD *)arg2 > v12 )
      *(_DWORD *)arg2 = v12;
  }
  if ( dword_478668 == -1 )
    dword_478668 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                     grim_interface_ptr,
                     aUiRecton);
  v13 = dword_47866C;
  if ( dword_47866C == -1 )
  {
    v13 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(grim_interface_ptr, aUiRectoff);
    dword_47866C = v13;
  }
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, v13, 0);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1056964608);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  v14 = 0;
  if ( *(int *)(arg2 + 4) > 0 )
  {
    arg2b = 0;
    do
    {
      v17 = (double)arg2b + v21;
      (*(void (__stdcall **)(_DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
        LODWORD(v17),
        v6,
        1090519040,
        1098907648);
      ++v14;
      arg2b += 8;
    }
    while ( v14 < *(_DWORD *)(arg2 + 4) );
  }
  result = (*(int (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  if ( *(int *)arg2 > 0 )
  {
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_478668,
      0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    v16 = 0;
    if ( *(int *)arg2 > 0 )
    {
      arg2c = 0;
      do
      {
        v18 = (double)arg2c + v21;
        (*(void (__stdcall **)(_DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
          LODWORD(v18),
          v6,
          1090519040,
          1098907648);
        ++v16;
        arg2c += 8;
      }
      while ( v16 < *(_DWORD *)arg2 );
    }
    return (*(int (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  }
  return result;
}

// ui_checkbox_update @ 0x0043DC80
// draws a checkbox widget, handles hover/focus, toggles on click
int ui_checkbox_update(float *xy, char *checkbox)
{
  int v3; // eax
  int v4; // eax
  float *v5; // edi
  int v6; // ebp
  int v7; // eax
  int result; // eax
  int v9; // esi
  int v10; // [esp+90h] [ebp-24h]
  int v11; // [esp+90h] [ebp-24h]
  int v12; // [esp+90h] [ebp-24h]
  float v13; // [esp+90h] [ebp-24h]
  int v14; // [esp+94h] [ebp-20h]
  int v15; // [esp+94h] [ebp-20h]
  int v16; // [esp+94h] [ebp-20h]
  float v17; // [esp+94h] [ebp-20h]
  char *v18; // [esp+98h] [ebp-1Ch]
  int v19; // [esp+98h] [ebp-1Ch]
  int v20; // [esp+98h] [ebp-1Ch]
  int v21; // [esp+98h] [ebp-1Ch]
  char v22; // [esp+ABh] [ebp-9h]
  float v23[2]; // [esp+ACh] [ebp-8h] BYREF
  char checkboxa; // [esp+BCh] [ebp+8h]

  v22 = 0;
  checkboxa = ui_focus_update((int)checkbox);
  v3 = *((_DWORD *)checkbox + 1);
  checkbox[2] = 0;
  if ( v3 )
  {
    v4 = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, v3);
    v5 = xy;
    if ( !(unsigned __int8)ui_mouse_inside_rect(xy, 16, v4 + 22) )
      goto LABEL_6;
  }
  else
  {
    v5 = xy;
    if ( !(unsigned __int8)ui_mouse_inside_rect(xy, 16, 16) )
      goto LABEL_6;
  }
  checkbox[2] = 1;
LABEL_6:
  if ( checkbox[1] )
    checkbox[2] = 0;
  if ( checkbox[2] )
    ui_focus_set((int)checkbox, 0);
  if ( checkboxa )
  {
    v23[0] = *v5 - 16.0;
    v23[1] = v5[1];
    ui_focus_draw(v23);
  }
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  v6 = *(_DWORD *)grim_interface_ptr;
  if ( *checkbox )
    v18 = aUiCheckon;
  else
    v18 = aUiCheckoff;
  v7 = (*(int (__stdcall **)(char *))(v6 + 192))(v18);
  (*(void (__thiscall **)(int, int))(v6 + 196))(grim_interface_ptr, v7);
  if ( !byte_4871CA
    && (checkboxa
     && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)
     || checkbox[2] && (unsigned __int8)input_primary_just_pressed()) )
  {
    v22 = 1;
    *checkbox = *checkbox == 0;
  }
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v10,
    v14,
    v19);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    *(_DWORD *)v5,
    *((_DWORD *)v5 + 1),
    1098907648,
    1098907648);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v11,
    v15,
    v20);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v12,
    v16,
    v21);
  if ( checkbox[2] )
    result = (*(int (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
               grim_interface_ptr,
               1065353216,
               1065353216,
               1065353216,
               1065353216);
  else
    result = (*(int (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
               grim_interface_ptr,
               1065353216,
               1065353216,
               1065353216,
               1060320051);
  v9 = *((_DWORD *)checkbox + 1);
  if ( v9 )
  {
    v17 = v5[1] + 1.0;
    v13 = *v5 + 22.0;
    result = (*(int (__stdcall **)(_DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 324))(
               LODWORD(v13),
               LODWORD(v17),
               v9);
  }
  LOBYTE(result) = v22;
  return result;
}

// ui_scrollbar_update @ 0x0043DEF0
// updates and renders a scroll bar (wheel, drag, key input)
void ui_scrollbar_update(float *xy, float *state)
{
  double v4; // st7
  double v5; // st7
  double v6; // st7
  double v7; // st7
  float *v8; // edi
  int v9; // ebp
  double v10; // st7
  double v11; // st6
  double v12; // st7
  float v13; // eax
  int v14; // eax
  int v15; // esi
  int v16; // ebp
  signed int v17; // esi
  signed int v18; // edi
  char v19; // al
  int v20; // esi
  int v21; // ecx
  bool v22; // cc
  float v23; // [esp+70h] [ebp-5Ch]
  float v24; // [esp+74h] [ebp-58h]
  float v25; // [esp+74h] [ebp-58h]
  float v26; // [esp+74h] [ebp-58h]
  float v27; // [esp+74h] [ebp-58h]
  float v28; // [esp+8Ch] [ebp-40h]
  float *v29; // [esp+8Ch] [ebp-40h]
  int v30; // [esp+90h] [ebp-3Ch]
  int v31; // [esp+94h] [ebp-38h]
  int v32; // [esp+98h] [ebp-34h]
  int v33; // [esp+9Ch] [ebp-30h] BYREF
  float v34; // [esp+A0h] [ebp-2Ch]
  int v35; // [esp+A4h] [ebp-28h]
  int v36; // [esp+A8h] [ebp-24h]
  float v37; // [esp+ACh] [ebp-20h] BYREF
  float v38; // [esp+B0h] [ebp-1Ch]
  float v39; // [esp+B4h] [ebp-18h] BYREF
  float v40; // [esp+B8h] [ebp-14h]
  int v41; // [esp+BCh] [ebp-10h] BYREF
  int v42; // [esp+C0h] [ebp-Ch]
  float v43; // [esp+C4h] [ebp-8h]
  int v44; // [esp+C8h] [ebp-4h]
  char xya; // [esp+D0h] [ebp+4h]
  float *xyb; // [esp+D0h] [ebp+4h]
  float xyc; // [esp+D0h] [ebp+4h]
  float *xyf; // [esp+D0h] [ebp+4h]
  float *xyg; // [esp+D0h] [ebp+4h]
  float xyd; // [esp+D0h] [ebp+4h]
  int xye; // [esp+D0h] [ebp+4h]
  float statea; // [esp+D4h] [ebp+8h]
  float *stateb; // [esp+D4h] [ebp+8h]

  *xy = (float)(__int64)*xy;
  xy[1] = (float)(__int64)xy[1];
  state[1] = NAN;
  xya = ui_focus_update((int)state);
  if ( xya )
  {
    *(float *)&v33 = *xy - 16.0;
    v34 = xy[1];
    ui_focus_draw((float *)&v33);
  }
  v4 = (double)(16 * *((_DWORD *)state + 3) + 4);
  *(float *)&v33 = 1.0;
  v34 = 1.0;
  v35 = 1065353216;
  v36 = 1065353216;
  statea = v4;
  (*(void (__thiscall **)(int, float *, int, float, int *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    xy,
    1132068864,
    COERCE_FLOAT(LODWORD(statea)),
    &v33);
  v5 = *xy + 1.0;
  v41 = 0;
  *(float *)&v33 = v5;
  v6 = xy[1] + 1.0;
  v42 = 0;
  v43 = 0.0;
  v44 = 1065353216;
  v34 = v6;
  v28 = statea - 2.0;
  (*(void (__thiscall **)(int, int *, int, float, int *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    &v33,
    1131937792,
    COERCE_FLOAT(LODWORD(v28)),
    &v41);
  if ( *((_DWORD *)state + 13) > *((_DWORD *)state + 3) )
  {
    v7 = *xy + 240.0;
    v41 = 1065353216;
    *(float *)&v33 = v7;
    v34 = xy[1];
    v42 = 1065353216;
    v43 = 1.0;
    v44 = 1061997773;
    (*(void (__thiscall **)(int, int *, int, float, int *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v33,
      1065353216,
      COERCE_FLOAT(LODWORD(statea)),
      &v41);
  }
  if ( ((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 96))(grim_interface_ptr) > 0.0 )
    *state = *state - 1.0;
  if ( ((double (__thiscall *)(int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 96))(grim_interface_ptr) < 0.0 )
    *state = *state + 1.0;
  if ( xya )
  {
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 200) )
      *state = *state - 1.0;
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 208) )
      *state = *state + 1.0;
  }
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 201) )
    *state = *state - (double)(*((_DWORD *)state + 3) - 1);
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 209) )
    *state = (double)(*((_DWORD *)state + 3) - 1) + *state;
  v9 = *((_DWORD *)state + 3);
  xyb = (float *)*((_DWORD *)state + 13);
  v8 = xyb;
  v10 = (double)((int)xyb - v9);
  if ( v10 < *state )
    *state = v10;
  if ( *state < 0.0 )
    *state = 0.0;
  v32 = (__int64)*state;
  v11 = (double)v9 / (double)(int)xyb * v28;
  xyc = v11;
  if ( v11 > v28 )
    xyc = statea - 3.0;
  v39 = *xy + 241.0;
  v40 = (statea - 3.0 - xyc) / v10 * (double)v32 + 1.0 + xy[1];
  if ( (int)v8 > v9 )
  {
    v41 = 1065353216;
    v42 = 1065353216;
    v43 = 1.0;
    v44 = 1061997773;
    v24 = xyc + 1.0;
    (*(void (__thiscall **)(int, float *, int, _DWORD, int *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v39,
      1090519040,
      LODWORD(v24),
      &v41);
    *(float *)&v33 = *xy + 240.0;
    v34 = xy[1];
    if ( (unsigned __int8)ui_mouse_inside_rect((float *)&v33, (__int64)statea, 10) )
    {
      *(float *)&v33 = v39 + 1.0;
      v41 = 1045220557;
      v42 = 1053609165;
      v43 = 0.80000001;
      v44 = 1065353216;
      v34 = v40 + 1.0;
      v25 = xyc - 1.0;
      (*(void (__thiscall **)(int, int *, int, _DWORD, int *))(*(_DWORD *)grim_interface_ptr + 208))(
        grim_interface_ptr,
        &v33,
        1086324736,
        LODWORD(v25),
        &v41);
      byte_4D11FA = 1;
      if ( (unsigned __int8)input_primary_just_pressed() )
      {
        if ( (unsigned __int8)ui_mouse_inside_rect(&v39, (__int64)xyc, 8) )
          flt_4D11FC = ui_mouse_y - xy[1] - *state / (double)*((int *)state + 13) * statea;
        else
          flt_4D11FC = 0.0;
      }
    }
    else
    {
      *(float *)&v33 = v39 + 1.0;
      v41 = 1036831949;
      v42 = 1045220557;
      v43 = 0.40000001;
      v44 = 1065353216;
      v34 = v40 + 1.0;
      v26 = xyc - 1.0;
      (*(void (__thiscall **)(int, int *, int, _DWORD, int *))(*(_DWORD *)grim_interface_ptr + 208))(
        grim_interface_ptr,
        &v33,
        1086324736,
        LODWORD(v26),
        &v41);
      if ( !(unsigned __int8)input_primary_is_down() )
      {
        byte_4D11FA = 0;
        goto LABEL_35;
      }
    }
    if ( byte_4D11FA && (unsigned __int8)input_primary_is_down() )
    {
      xyf = (float *)*((_DWORD *)state + 13);
      v12 = (ui_mouse_y - xy[1] - flt_4D11FC) / statea * (double)(int)xyf;
      xyg = (float *)((char *)xyf - *((_DWORD *)state + 3));
      *state = v12;
      xyd = (float)(int)xyg;
      if ( v12 > xyd )
        *state = xyd;
      if ( *state < 0.0 )
        *state = 0.0;
    }
  }
LABEL_35:
  v13 = xy[1];
  v37 = *xy;
  v38 = v13;
  v14 = *((_DWORD *)state + 3);
  v30 = 0;
  v37 = v37 - 2.0;
  if ( v14 > 0 )
  {
    v15 = v32;
    v31 = 4 * v32;
    while ( v30 < *((_DWORD *)state + 13) )
    {
      if ( (unsigned __int8)ui_mouse_inside_rect(&v37, 17, 240) )
      {
        xye = 1065353216;
        *((_DWORD *)state + 1) = v15;
        if ( (unsigned __int8)input_primary_just_pressed() )
          *((_DWORD *)state + 2) = v15;
      }
      else
      {
        xye = 1063675494;
        if ( *((_DWORD *)state + 2) != v15 )
          xye = 1060320051;
      }
      v16 = *(_DWORD *)(*((_DWORD *)state + 12) + v31);
      if ( *(_BYTE *)v16 == 92 )
      {
        if ( *(_BYTE *)(v16 + 1) == 103 )
        {
          (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            1060320051,
            1065353216,
            1060320051,
            xye);
          v16 += 2;
        }
      }
      else
      {
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          xye);
      }
      v17 = 0;
      stateb = 0;
      v18 = strlen((const char *)v16) + 1;
      if ( v18 > 0 )
      {
        v29 = state + 4;
        do
        {
          v19 = *(_BYTE *)(v17 + v16);
          if ( v19 == 9 || !v19 )
          {
            *(_BYTE *)(v17 + v16) = 0;
            v33 = (_DWORD)stateb * *(_DWORD *)v29;
            v27 = v38 + 2.0;
            v23 = (double)v33 + v37 + 8.0;
            (*(void (__stdcall **)(_DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 324))(
              LODWORD(v23),
              LODWORD(v27),
              v16);
            v20 = v17 + 1;
            stateb = (float *)((char *)stateb + 1);
            v16 += v20;
            v18 -= v20;
            ++v29;
            v17 = 0;
          }
          ++v17;
        }
        while ( v17 < v18 );
      }
      v21 = *((_DWORD *)state + 3);
      v38 = v38 + 16.0;
      v22 = ++v30 < v21;
      v31 += 4;
      ++v32;
      if ( !v22 )
        break;
      v15 = v32;
    }
  }
}

// ui_menu_item_update @ 0x0043E5E0
// draws a text menu item, updates hover/press state, and returns 1 when activated
int ui_menu_item_update(float *xy, int *item)
{
  int v2; // esi
  int *v3; // edi
  char v4; // bl
  float *v5; // esi
  double v6; // st7
  char v7; // al
  int result; // eax
  int v9; // [esp-4h] [ebp-14h]
  float v10[2]; // [esp+8h] [ebp-8h] BYREF
  float v11; // [esp+1Ch] [ebp+Ch]
  int v12; // [esp+24h] [ebp+14h]

  v3 = item;
  v4 = ui_focus_update((int)item);
  if ( (byte_4CC910 & 1) == 0 )
  {
    dword_4CCD40 = 1049398413;
    byte_4CC910 |= 1u;
    dword_4CCD44 = 1060418741;
    dword_4CCD48 = 1064366321;
    dword_4CCD4C = 1058642330;
    crt_atexit(nullsub_44);
  }
  if ( (byte_4CC910 & 2) == 0 )
  {
    dword_4D0E28 = 1049398413;
    byte_4CC910 |= 2u;
    dword_4D0E2C = 1060418741;
    dword_4D0E30 = 1064366321;
    dword_4D0E34 = 1065353216;
    crt_atexit(nullsub_43);
  }
  v9 = v2;
  v5 = xy;
  if ( v4 )
  {
    v10[0] = *xy - 16.0;
    v10[1] = xy[1];
    ui_focus_draw(v10);
  }
  v6 = (double)(*(int (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, *v3, v9);
  v11 = v6;
  if ( v6 <= 0.0 )
    v11 = 8.0;
  v7 = ui_mouse_inside_rect(v5, 16, (__int64)v11);
  *((_BYTE *)v3 + 4) = v7;
  if ( v7 )
  {
    ui_focus_set((int)v3, 0);
    (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4D0E28);
  }
  else
  {
    (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4CCD40);
  }
  (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    *(_DWORD *)v5,
    *((_DWORD *)v5 + 1),
    aS_0,
    *v3);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  xy = *(float **)v5;
  *(float *)&item = v5[1] + 13.0;
  (*(void (__thiscall **)(int, float **, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    &xy,
    v12,
    1065353216);
  result = (*(int (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  if ( *((_BYTE *)v3 + 6) )
  {
    if ( v4
      && ((*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)
       || *((_BYTE *)v3 + 4) && (unsigned __int8)input_primary_just_pressed()) )
    {
      result = 1;
      *((_BYTE *)v3 + 5) = 1;
    }
    else
    {
      result = 0;
      *((_BYTE *)v3 + 5) = 0;
    }
  }
  else
  {
    *((_BYTE *)v3 + 5) = 0;
  }
  if ( *((_BYTE *)v3 + 5) )
    result = sfx_play(sfx_ui_buttonclick);
  LOBYTE(result) = *((_BYTE *)v3 + 5);
  return result;
}

// nullsub_43 @ 0x0043E810
void __cdecl nullsub_43()
{
  ;
}

// nullsub_44 @ 0x0043E820
void __cdecl nullsub_44()
{
  ;
}

// ui_button_update @ 0x0043E830
// draws a UI button, updates hover/press state, and returns 1 when activated
char __cdecl sub_43E830(float *a1, int a2)
{
  int v2; // esi
  int v4; // eax
  int v5; // eax
  int v6; // eax
  float v7; // eax
  double v8; // st7
  double v9; // st7
  int v10; // eax
  int v11; // edx
  int v12; // ebp
  float v14; // [esp+ACh] [ebp-38h]
  float v15; // [esp+B0h] [ebp-34h]
  int v16; // [esp+B0h] [ebp-34h]
  int v17; // [esp+B0h] [ebp-34h]
  int v18; // [esp+B0h] [ebp-34h]
  int v19; // [esp+B4h] [ebp-30h]
  int v20; // [esp+B4h] [ebp-30h]
  int v21; // [esp+B4h] [ebp-30h]
  float v22; // [esp+B4h] [ebp-30h]
  int v23; // [esp+B8h] [ebp-2Ch]
  int v24; // [esp+B8h] [ebp-2Ch]
  int v25; // [esp+B8h] [ebp-2Ch]
  float v26; // [esp+B8h] [ebp-2Ch]
  int v27; // [esp+BCh] [ebp-28h]
  int v28; // [esp+BCh] [ebp-28h]
  float v29; // [esp+C8h] [ebp-1Ch]
  int v30; // [esp+CCh] [ebp-18h] BYREF
  float v31; // [esp+D0h] [ebp-14h]
  float v32; // [esp+D4h] [ebp-10h] BYREF
  float v33; // [esp+D8h] [ebp-Ch]
  float v34; // [esp+DCh] [ebp-8h]
  float v35; // [esp+E0h] [ebp-4h]
  float v36; // [esp+E8h] [ebp+4h]
  int v37; // [esp+E8h] [ebp+4h]

  v2 = a2;
  LOBYTE(a2) = ui_focus_update(a2);
  if ( (_BYTE)a2 )
  {
    *(float *)&v30 = *a1 - 16.0;
    v31 = a1[1];
    ui_focus_draw((float *)&v30);
  }
  v29 = (float)(*(int (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 332))(
                 grim_interface_ptr,
                 *(_DWORD *)v2);
  if ( dword_478670 == -1 )
    dword_478670 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                     grim_interface_ptr,
                     aUiButtonsm);
  if ( dword_478674 == -1 )
    dword_478674 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 192))(
                     grim_interface_ptr,
                     aUiButtonmd);
  if ( v29 < 40.0 || (v36 = 145.0, *(_BYTE *)(v2 + 20)) )
    v36 = 82.0;
  if ( *(_BYTE *)(v2 + 21) )
    v36 = 145.0;
  a1[1] = a1[1] + 2.0;
  *(_BYTE *)(v2 + 4) = ui_mouse_inside_rect(a1, 28, (__int64)v36);
  a1[1] = a1[1] - 2.0;
  if ( *(_BYTE *)(v2 + 4) )
    ui_focus_set(v2, 0);
  if ( *(_BYTE *)(v2 + 6) && (*(_BYTE *)(v2 + 4) || (_BYTE)a2 && dword_4D11EC > 800) )
    v4 = 6 * frame_dt_ms + *(_DWORD *)(v2 + 8);
  else
    v4 = -4 * frame_dt_ms + *(_DWORD *)(v2 + 8);
  *(_DWORD *)(v2 + 8) = v4;
  v5 = *(_DWORD *)(v2 + 12);
  if ( v5 > 0 )
    *(_DWORD *)(v2 + 12) = v5 - 6 * frame_dt_ms;
  if ( *(int *)(v2 + 12) < 0 )
    *(_DWORD *)(v2 + 12) = 0;
  v6 = *(_DWORD *)(v2 + 8);
  if ( v6 >= 0 )
  {
    if ( v6 > 1000 )
      *(_DWORD *)(v2 + 8) = 1000;
  }
  else
  {
    *(_DWORD *)(v2 + 8) = 0;
  }
  v7 = *(float *)(v2 + 12);
  v32 = 0.5;
  v33 = 0.5;
  v34 = 0.69999999;
  v35 = 0.0;
  *(float *)&v30 = v7;
  if ( SLODWORD(v7) > 0 )
  {
    v8 = (double)v30;
    v32 = v8 * 0.00050000002 + 0.5;
    v33 = v32;
    v9 = v8 * 0.00070000003 + 0.69999999;
    v34 = v9;
    if ( v32 > 1.0 )
      v32 = 1.0;
    if ( v33 > 1.0 )
      v33 = 1.0;
    if ( v9 > 1.0 )
      v34 = 1.0;
  }
  v30 = *(int *)(v2 + 8);
  if ( v30 > 0 )
  {
    v35 = (double)v30 * 0.001 * *(float *)(v2 + 16);
    *(float *)&v30 = *a1 + 12.0;
    v31 = a1[1] + 5.0;
    v15 = v36 - 24.0;
    (*(void (__thiscall **)(int, int *, _DWORD, int, float *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &v30,
      LODWORD(v15),
      1102053376,
      &v32);
  }
  if ( v29 < 40.0 || *(_BYTE *)(v2 + 20) )
  {
    v10 = dword_478670;
    v11 = *(_DWORD *)grim_interface_ptr;
  }
  else
  {
    v10 = dword_478674;
    v11 = *(_DWORD *)grim_interface_ptr;
  }
  (*(void (__stdcall **)(int, _DWORD))(v11 + 196))(v10, 0);
  if ( *(_BYTE *)(v2 + 21) )
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      dword_478674,
      0);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    *(_DWORD *)(v2 + 16));
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v16,
    v19,
    v23);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, float, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    *(_DWORD *)a1,
    *((_DWORD *)a1 + 1),
    COERCE_FLOAT(LODWORD(v36)),
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v17,
    v20,
    v24);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v18,
    v21,
    v25);
  if ( *(_BYTE *)(v2 + 4) )
    v26 = *(float *)(v2 + 16);
  else
    v26 = *(float *)(v2 + 16) * 0.69999999;
  (*(void (__stdcall **)(int, int, int, float, int))(*(_DWORD *)grim_interface_ptr + 276))(
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v26)),
    v27);
  v28 = *(_DWORD *)v2;
  v12 = *(_DWORD *)grim_interface_ptr;
  v22 = a1[1] + 10.0;
  v31 = *(float *)&a2 * 0.5 + *a1;
  v37 = (*(int (**)(int, _DWORD, char *, ...))(v12 + 332))(v28, LODWORD(v22), aS_0, v28) / 2;
  v14 = *(float *)&v30 - (double)v37 + 1.0;
  (*(void (__cdecl **)(int, _DWORD))(v12 + 328))(grim_interface_ptr, LODWORD(v14));
  if ( *(_BYTE *)(v2 + 6) )
    *(_BYTE *)(v2 + 5) = (_BYTE)a2
                      && ((*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(
                            grim_interface_ptr,
                            28)
                       || *(_BYTE *)(v2 + 4) && (unsigned __int8)input_primary_just_pressed());
  else
    *(_BYTE *)(v2 + 5) = 0;
  if ( *(_BYTE *)(v2 + 5) )
  {
    *(_DWORD *)(v2 + 12) = 1000;
    sfx_play(sfx_ui_buttonclick, 1.0);
  }
  return *(_BYTE *)(v2 + 5);
}

// ui_text_input_update @ 0x0043ECF0
// updates a text input field: focus, input polling, sfx, and rendering
int ui_text_input_update(float *xy, int *input_state)
{
  char v3; // al
  double v4; // st7
  char v5; // bl
  int v7; // ebx
  int v8; // eax
  double v9; // st7
  int v10; // ebp
  int result; // eax
  float v12; // [esp+60h] [ebp-3Ch]
  float v13; // [esp+64h] [ebp-38h]
  int v14; // [esp+64h] [ebp-38h]
  float v15; // [esp+64h] [ebp-38h]
  int v16; // [esp+68h] [ebp-34h]
  int v17; // [esp+6Ch] [ebp-30h]
  char v18; // [esp+83h] [ebp-19h]
  float v19; // [esp+84h] [ebp-18h] BYREF
  float v20; // [esp+88h] [ebp-14h]
  _DWORD v21[4]; // [esp+8Ch] [ebp-10h] BYREF
  float *xya; // [esp+A0h] [ebp+4h]
  float input_statea; // [esp+A4h] [ebp+8h]
  float input_stateb; // [esp+A4h] [ebp+8h]
  int input_statec; // [esp+A4h] [ebp+8h]

  v18 = 0;
  v3 = ui_focus_update((int)input_state);
  v4 = (double)input_state[3];
  v5 = v3;
  input_statea = v4;
  if ( (unsigned __int8)ui_mouse_inside_rect(xy, 18, (__int64)v4) )
    ui_focus_set((int)input_state, 0);
  if ( v5 )
  {
    v19 = *xy - 16.0;
    v20 = xy[1];
    ui_focus_draw(&v19);
  }
  *(_BYTE *)(*input_state + input_state[1] + 1) = 0;
  v7 = console_input_poll();
  if ( v7 == 13 )
  {
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28);
    (*(void (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 156);
    sfx_play(sfx_ui_typeenter);
    v18 = 1;
  }
  else
  {
    (*(void (__thiscall **)(int, int, int *, int))(*(_DWORD *)grim_interface_ptr + 84))(
      grim_interface_ptr,
      *input_state,
      input_state + 1,
      input_state[2]);
    if ( v7 )
    {
      v8 = crt_rand() % 2;
      sfx_play(sfx_ui_typeclick_01 + v8);
    }
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, float *, float, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    xy,
    COERCE_FLOAT(LODWORD(input_statea)),
    1099956224);
  v19 = *xy + 1.0;
  v9 = xy[1] + 1.0;
  memset(v21, 0, 12);
  v20 = v9;
  v21[3] = 1065353216;
  v13 = input_statea - 2.0;
  (*(void (__thiscall **)(int, float *, _DWORD, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    &v19,
    LODWORD(v13),
    1098907648,
    v21);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v14,
    v16,
    v17);
  v10 = 0;
  input_stateb = input_statea - 8.0 - 2.0;
  while ( 1 )
  {
    xya = (float *)(*(int (__stdcall **)(int))(*(_DWORD *)grim_interface_ptr + 332))(v10 + *input_state);
    if ( (double)(int)xya <= input_stateb )
      break;
    ++v10;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  v15 = xy[1] + 2.0;
  v12 = *xy + 4.0;
  (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v12),
    LODWORD(v15),
    aS_0,
    v10 + *input_state);
  input_statec = 1065353216;
  if ( sin(flt_47EA4C * 4.0) > 0.0 )
    input_statec = 1053609165;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    input_statec);
  v19 = (double)(int)xya + *xy + 4.0;
  v20 = xy[1] + 2.0;
  result = (*(int (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
             grim_interface_ptr,
             &v19,
             1065353216,
             1096810496);
  LOBYTE(result) = v18;
  return result;
}

// ui_list_widget_update @ 0x0043EFC0
// draws a list widget and updates selection/hover state
int ui_list_widget_update(float *xy, char *list)
{
  int v3; // ebp
  char v4; // bl
  int v5; // edi
  int v6; // eax
  int v8; // eax
  int v9; // ebx
  int v10; // eax
  double v11; // st7
  int v12; // ebp
  double v13; // st7
  int v14; // eax
  int v15; // ebp
  int v17; // ebp
  float *v18; // ebx
  float v19; // [esp+E0h] [ebp-3Ch]
  float v20; // [esp+E0h] [ebp-3Ch]
  float v21; // [esp+E0h] [ebp-3Ch]
  float v22; // [esp+E4h] [ebp-38h]
  int v23; // [esp+E4h] [ebp-38h]
  int v24; // [esp+E4h] [ebp-38h]
  float v25; // [esp+E4h] [ebp-38h]
  float v26; // [esp+E4h] [ebp-38h]
  float v27; // [esp+E8h] [ebp-34h]
  char *v28; // [esp+E8h] [ebp-34h]
  int v29; // [esp+E8h] [ebp-34h]
  int v30; // [esp+E8h] [ebp-34h]
  int v31; // [esp+ECh] [ebp-30h]
  int v32; // [esp+ECh] [ebp-30h]
  float v33; // [esp+100h] [ebp-1Ch]
  int arg3; // [esp+104h] [ebp-18h] BYREF
  float v35; // [esp+108h] [ebp-14h]
  float arg1; // [esp+10Ch] [ebp-10h] BYREF
  float v37; // [esp+110h] [ebp-Ch]
  int v38; // [esp+114h] [ebp-8h]
  int v39; // [esp+118h] [ebp-4h]
  float xya; // [esp+120h] [ebp+4h]
  float *xyb; // [esp+120h] [ebp+4h]
  char lista; // [esp+124h] [ebp+8h]

  v3 = 0;
  v4 = ui_focus_update((int)list);
  v5 = 0;
  for ( lista = v4; v5 < *((_DWORD *)list + 4); ++v5 )
  {
    v6 = (*(int (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 332))(
           grim_interface_ptr,
           *(_DWORD *)(*((_DWORD *)list + 3) + 4 * v5));
    if ( v6 > v3 )
      v3 = v6;
  }
  if ( *list )
  {
    if ( *((int *)list + 1) <= 0 )
    {
      v33 = 16.0;
      list[20] = 0;
      xya = (float)(v3 + 48);
    }
    else
    {
      xya = (float)(v3 + 48);
      v33 = (float)(16 * *((_DWORD *)list + 4) + 24);
      list[20] = ui_mouse_inside_rect(xy, (__int64)v33, (__int64)xya);
    }
  }
  else
  {
    v33 = 16.0;
    list[20] = 0;
    *((_DWORD *)list + 1) = 0;
    xya = (float)(v3 + 48);
  }
  if ( list[20] )
    ui_focus_set((int)list, 0);
  if ( v4 )
  {
    *(float *)&arg3 = *xy - 16.0;
    v35 = xy[1];
    ui_focus_draw((float *)&arg3);
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 200) )
    {
      if ( *((_DWORD *)list + 1) )
      {
        v8 = *((_DWORD *)list + 6) - 1;
        *((_DWORD *)list + 6) = v8;
        if ( v8 < 0 )
          *((_DWORD *)list + 6) = 0;
      }
      else
      {
        *((_DWORD *)list + 1) = 1;
      }
    }
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 208) )
    {
      if ( *((_DWORD *)list + 1) )
      {
        v9 = *((_DWORD *)list + 6) + 1;
        v10 = *((_DWORD *)list + 4) - 1;
        *((_DWORD *)list + 6) = v9;
        if ( v9 > v10 )
          *((_DWORD *)list + 6) = v10;
      }
      else
      {
        *((_DWORD *)list + 1) = 1;
      }
    }
  }
  arg1 = 1.0;
  v37 = 1.0;
  v38 = 1065353216;
  v39 = 1065353216;
  (*(void (__thiscall **)(int, float *, float, float, float *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    xy,
    COERCE_FLOAT(LODWORD(xya)),
    COERCE_FLOAT(LODWORD(v33)),
    &arg1);
  *(float *)&arg3 = *xy + 1.0;
  v11 = xy[1] + 1.0;
  arg1 = 0.0;
  v37 = 0.0;
  v38 = 0;
  v39 = 1065353216;
  v35 = v11;
  v27 = v33 - 2.0;
  v22 = xya - 2.0;
  (*(void (__stdcall **)(int *, _DWORD, _DWORD, float *))(*(_DWORD *)grim_interface_ptr + 208))(
    &arg3,
    LODWORD(v22),
    LODWORD(v27),
    &arg1);
  if ( *((int *)list + 1) > 0 || list[20] )
  {
    arg3 = *(int *)xy;
    v13 = xy[1] + 15.0;
    arg1 = 1.0;
    v35 = v13;
    v37 = 1.0;
    v38 = 1065353216;
    v39 = 1056964608;
    (*(void (__thiscall **)(int, int *, float, int, float *))(*(_DWORD *)grim_interface_ptr + 208))(
      grim_interface_ptr,
      &arg3,
      COERCE_FLOAT(LODWORD(xya)),
      1065353216,
      &arg1);
    v28 = aUiDropon;
    v12 = *(_DWORD *)grim_interface_ptr;
  }
  else
  {
    v28 = aUiDropoff;
    v12 = *(_DWORD *)grim_interface_ptr;
  }
  v14 = (*(int (__stdcall **)(char *, _DWORD))(v12 + 192))(v28, 0);
  (*(void (__thiscall **)(int, int))(v12 + 196))(grim_interface_ptr, v14);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v23,
    v29,
    v31);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v19 = xya + *xy - 16.0 - 1.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v19),
    *((_DWORD *)xy + 1),
    1098907648,
    1098907648);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v24,
    v30,
    v32);
  v15 = -2;
  if ( *list && (unsigned __int8)FUN_00403430(xy, 14, (__int64)xya) )
  {
    v15 = -1;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1064514355);
  }
  else
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1061158912);
  }
  v25 = xy[1] + 1.0;
  v20 = *xy + 4.0;
  (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v20),
    LODWORD(v25),
    aS_0,
    *(_DWORD *)(*((_DWORD *)list + 3) + 4 * *((_DWORD *)list + 2)));
  if ( *((int *)list + 1) <= 0 )
    return v15;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  v17 = 0;
  if ( *((int *)list + 4) > 0 )
  {
    v18 = 0;
    arg3 = (__int64)xya;
    xyb = 0;
    do
    {
      arg1 = *xy;
      v37 = (double)(int)(v18 + 4) + xy[1];
      if ( (unsigned __int8)FUN_00403430(&arg1, 14, arg3) )
      {
        *((_DWORD *)list + 6) = v17;
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1064514355);
      }
      else
      {
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1058642330);
      }
      if ( lista && *((_DWORD *)list + 6) == v17 )
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          1064682127);
      v26 = (double)(int)xyb + xy[1] + 17.0;
      v21 = *xy + 4.0;
      (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v21),
        LODWORD(v26),
        aS_0,
        *(_DWORD *)(*((_DWORD *)list + 3) + 4 * v17++));
      v18 += 4;
      xyb = v18;
    }
    while ( v17 < *((_DWORD *)list + 4) );
  }
  if ( !list[20] && !lista )
    *((_DWORD *)list + 1) = 0;
  return *((_DWORD *)list + 6);
}

// sub_43F550 @ 0x0043F550
void sub_43F550()
{
  int v0; // esi
  char *v1; // eax
  int v2; // eax
  int v3; // edx
  double v4; // st7
  int v5; // edi
  int v6; // esi
  int v7; // edi
  int v8; // ebp
  float v9; // [esp+A8h] [ebp-40h]
  float v10; // [esp+A8h] [ebp-40h]
  float v11; // [esp+ACh] [ebp-3Ch]
  float v12; // [esp+ACh] [ebp-3Ch]
  float v13; // [esp+B0h] [ebp-38h]
  int v14; // [esp+B4h] [ebp-34h]
  float v15; // [esp+B4h] [ebp-34h]
  int v16; // [esp+B4h] [ebp-34h]
  int v17; // [esp+B4h] [ebp-34h]
  float v18; // [esp+B4h] [ebp-34h]
  float v19; // [esp+B4h] [ebp-34h]
  float v20; // [esp+B4h] [ebp-34h]
  float v21; // [esp+B4h] [ebp-34h]
  int v22; // [esp+B8h] [ebp-30h]
  int v23; // [esp+B8h] [ebp-30h]
  int v24; // [esp+B8h] [ebp-30h]
  float v25; // [esp+B8h] [ebp-30h]
  float v26; // [esp+B8h] [ebp-30h]
  float v27; // [esp+B8h] [ebp-30h]
  float v28; // [esp+B8h] [ebp-30h]
  int v29; // [esp+BCh] [ebp-2Ch]
  int v30; // [esp+BCh] [ebp-2Ch]
  int v31; // [esp+BCh] [ebp-2Ch]
  char *v32; // [esp+BCh] [ebp-2Ch]
  float v33; // [esp+BCh] [ebp-2Ch]
  float v34; // [esp+D0h] [ebp-18h]
  int v35; // [esp+D0h] [ebp-18h]
  float v36; // [esp+D4h] [ebp-14h]
  float v37; // [esp+D8h] [ebp-10h] BYREF
  float v38; // [esp+DCh] [ebp-Ch]
  float v39; // [esp+E4h] [ebp-4h]

  if ( (byte_4D0F20 & 1) == 0 )
  {
    byte_4CC91E = 1;
    byte_4D0F20 |= 1u;
    byte_4CC92D = 0;
    byte_4CC92C = 0;
    dword_4CC928 = 1065353216;
    dword_4CC924 = 0;
    dword_4CC918 = 0;
    byte_4CC91C = 0;
    byte_4CC91D = 0;
    dword_4CC920 = 0;
    crt_atexit(nullsub_52);
  }
  dword_4CC918 = (int)aHighScores;
  if ( (byte_4D0F20 & 2) == 0 )
  {
    byte_4D0F46 = 1;
    byte_4D0F20 |= 2u;
    byte_4D0F55 = 0;
    byte_4D0F54 = 0;
    dword_4D0F50 = 1065353216;
    dword_4D0F4C = 0;
    dword_4D0F40 = 0;
    byte_4D0F44 = 0;
    byte_4D0F45 = 0;
    dword_4D0F48 = 0;
    crt_atexit(nullsub_51);
  }
  dword_4D0F40 = (int)aWeapons;
  if ( (byte_4D0F20 & 4) == 0 )
  {
    byte_4CC8FE = 1;
    byte_4D0F20 |= 4u;
    byte_4CC90D = 0;
    byte_4CC90C = 0;
    dword_4CC908 = 1065353216;
    dword_4CC904 = 0;
    dword_4CC8F8 = 0;
    byte_4CC8FC = 0;
    byte_4CC8FD = 0;
    dword_4CC900 = 0;
    crt_atexit(nullsub_50);
  }
  dword_4CC8F8 = (int)aPerks;
  if ( (byte_4D0F20 & 8) == 0 )
  {
    byte_4D0EBE = 1;
    byte_4D0F20 |= 8u;
    byte_4D0ECD = 0;
    byte_4D0ECC = 0;
    dword_4D0EC8 = 1065353216;
    dword_4D0EC4 = 0;
    dword_4D0EB8 = 0;
    byte_4D0EBC = 0;
    byte_4D0EBD = 0;
    dword_4D0EC0 = 0;
    crt_atexit(nullsub_49);
  }
  dword_4D0EB8 = (int)aCredits_0;
  if ( (byte_4D0F20 & 0x10) == 0 )
  {
    byte_4D0F66 = 1;
    byte_4D0F20 |= 0x10u;
    byte_4D0F75 = 0;
    byte_4D0F74 = 0;
    dword_4D0F70 = 1065353216;
    dword_4D0F6C = 0;
    dword_4D0F60 = 0;
    byte_4D0F64 = 0;
    byte_4D0F65 = 0;
    dword_4D0F68 = 0;
    crt_atexit(nullsub_48);
  }
  dword_4D0F60 = (int)aTypOShooter_0;
  if ( (byte_4D0F20 & 0x20) == 0 )
  {
    byte_4CCD56 = 1;
    byte_4D0F20 |= 0x20u;
    byte_4CCD65 = 0;
    byte_4CCD64 = 0;
    dword_4CCD60 = 1065353216;
    dword_4CCD5C = 0;
    dword_4CCD50 = 0;
    byte_4CCD54 = 0;
    byte_4CCD55 = 0;
    dword_4CCD58 = 0;
    crt_atexit(nullsub_47);
  }
  dword_4CCD50 = (int)aMods_0;
  if ( (byte_4D0F20 & 0x40) == 0 )
  {
    byte_4D11CE = 1;
    byte_4D0F20 |= 0x40u;
    byte_4D11DD = 0;
    byte_4D11DC = 0;
    dword_4D11D8 = 1065353216;
    dword_4D11D4 = 0;
    dword_4D11C8 = 0;
    byte_4D11CC = 0;
    byte_4D11CD = 0;
    dword_4D11D0 = 0;
    crt_atexit(nullsub_46);
  }
  dword_4D11C8 = (int)aCheckForUpdate;
  if ( byte_4D0F20 >= 0 )
  {
    byte_4CCCC6 = 1;
    byte_4D0F20 |= 0x80u;
    byte_4CCCD5 = 0;
    byte_4CCCD4 = 0;
    dword_4CCCD0 = 1065353216;
    dword_4CCCCC = 0;
    dword_4CCCC0 = 0;
    byte_4CCCC4 = 0;
    byte_4CCCC5 = 0;
    dword_4CCCC8 = 0;
    crt_atexit(nullsub_45);
  }
  dword_4CCCC0 = (int)aBack_0;
  if ( !dword_4D11F0 || dword_4D11F0 == 6 )
  {
    byte_4CCCC6 = 1;
    byte_4D11CE = 1;
    byte_4CCD56 = 1;
    byte_4D0EBE = 1;
    byte_4D0F46 = 1;
    byte_4CC91E = 1;
  }
  else
  {
    byte_4CCCC6 = 0;
    byte_4D11CE = 0;
    byte_4CCD56 = 0;
    byte_4D0EBE = 0;
    byte_4D0F46 = 0;
    byte_4CC91E = 0;
  }
  v39 = flt_48E83C + flt_48E860;
  v34 = flt_48E85C + flt_48E838 + 300.0;
  v36 = v39 + 40.0;
  v38 = v36;
  v37 = flt_48E828 - 110.0 + v34 + 52.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v38 = v36 + 16.0;
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7F4, 0);
  (*(void (__thiscall **)(int, _DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    1052770304,
    1065353216,
    1056964608);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v14,
    v22,
    v29);
  v15 = v38 - 4.0;
  v13 = v37 + 64.0 - 16.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v13),
    LODWORD(v15),
    1124073472,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v16,
    v23,
    v30);
  v38 = v38 + 48.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1047233823);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1054615798,
    v17,
    v24,
    v31);
  v0 = *(_DWORD *)&game_sequence_id / 1000 / 60;
  v35 = v0 / 60;
  v11 = v38 + 230.0;
  v9 = v37 - 38.0;
  (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v9),
    LODWORD(v11),
    aPlayedForDHour,
    v0 / 60,
    v0 % 60,
    *(_DWORD *)&game_sequence_id / 1000 - 60 * (v0 % 60));
  if ( !dword_4D11F0 )
  {
    if ( !byte_4D11F8 || lpMultiByteStr )
    {
      if ( dword_4D11D0 <= 0 )
        goto LABEL_35;
      v33 = (double)dword_4D11D0 * 0.001;
      (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        LODWORD(v33));
      v28 = v38 + 186.0;
      v20 = v37 - 38.0;
      (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v20),
        LODWORD(v28),
        aConnectTheInte);
      v2 = grim_interface_ptr;
      v3 = *(_DWORD *)grim_interface_ptr;
      v32 = aForNewCrimsonl;
      v27 = v38 + 200.0;
      v4 = v37 - 38.0;
    }
    else
    {
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1056964608,
        1058642330,
        1065353216,
        1061997773);
      v26 = v38 + 186.0;
      v19 = v37 - 40.0;
      (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v19),
        LODWORD(v26),
        aYouVeGotTheNew);
      v2 = grim_interface_ptr;
      v3 = *(_DWORD *)grim_interface_ptr;
      v32 = aOfCrimsonland;
      v27 = v38 + 200.0;
      v4 = v37 - 40.0;
    }
    v21 = v4;
    (*(void (__cdecl **)(int, _DWORD, float, char *))(v3 + 328))(v2, LODWORD(v21), COERCE_FLOAT(LODWORD(v27)), v32);
    goto LABEL_35;
  }
  Sleep(0xAu);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v1 = szPassword;
  switch ( dword_4D11F0 )
  {
    case 1:
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1045220557,
        1065353216,
        1045220557,
        1061997773);
      v1 = aConnectingServ;
      break;
    case 5:
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1053609165,
        1065353216,
        1053609165,
        1061997773);
      v1 = aDone;
      break;
    case 6:
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1036831949,
        1036831949,
        1061997773);
      v1 = aFailed;
      break;
  }
  v25 = v38 + 186.0;
  v18 = v37 - 38.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v18),
    LODWORD(v25),
    v1);
LABEL_35:
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v5 = *(_DWORD *)&dword_48718C / 1000 / 60;
  v6 = v5 / 60;
  v7 = v5 % 60;
  v8 = *(_DWORD *)&dword_48718C / 1000 - 60 * v7;
  if ( v6 != v35
    && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(grim_interface_ptr, 59) )
  {
    v12 = v38 + 230.0 - 15.0;
    v10 = v37 - 38.0;
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v10),
      LODWORD(v12),
      aTotalDh,
      v6,
      v7,
      v8);
  }
  v37 = v37 + 28.0;
  ui_button_update(&v37, (int)&dword_4CC918);
  v38 = v38 + 34.0;
  ui_button_update(&v37, (int)&dword_4D0F40);
  v38 = v38 + 34.0;
  ui_button_update(&v37, (int)&dword_4CC8F8);
  v38 = v38 + 34.0;
  ui_button_update(&v37, (int)&dword_4D0EB8);
  v37 = v37 + 124.0;
  v38 = v38 + 34.0 + 34.0 + 16.0;
  ui_button_update(&v37, (int)&dword_4CCCC0);
  v38 = v38 + 34.0;
  if ( byte_4CC91D )
  {
    ui_transition_direction = 0;
    game_state_pending = 14;
    if ( *(int *)quest_stage_major >= 1 )
    {
      if ( *(int *)quest_stage_major > 4 )
        *(_DWORD *)quest_stage_major = 4;
    }
    else
    {
      *(_DWORD *)quest_stage_major = 1;
    }
    if ( quest_stage_minor >= 1 )
    {
      if ( quest_stage_minor > 10 )
        quest_stage_minor = 10;
      j_highscore_load_table();
    }
    else
    {
      quest_stage_minor = 1;
      j_highscore_load_table();
    }
  }
  if ( byte_4D0F45 )
  {
    ui_transition_direction = 0;
    game_state_pending = 15;
  }
  if ( byte_4CC8FD )
  {
    ui_transition_direction = 0;
    game_state_pending = 16;
  }
  if ( byte_4D0F65 )
  {
    render_pass_mode = 0;
    ui_sign_crimson_update_disabled = 0;
    ui_transition_direction = 0;
    game_state_pending = 18;
    config_game_mode = 4;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    byte_48702C = 1;
  }
  if ( byte_4D0EBD )
  {
    ui_transition_direction = 0;
    game_state_pending = 17;
  }
  if ( byte_4D11CD )
  {
    dword_4D11F0 = 1;
    crt_beginthread((_beginthread_proc_type)sub_42D8A0, 0, 0);
  }
  if ( byte_4CCCC5 )
  {
    ui_transition_direction = 0;
    game_state_pending = 0;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    sfx_play_exclusive(music_track_crimson_theme_id);
  }
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1) )
  {
    ui_transition_direction = 0;
    game_state_pending = 0;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    sfx_play_exclusive(music_track_crimson_theme_id);
  }
  if ( !ui_transition_direction )
    byte_4D11F8 = 0;
}

// nullsub_45 @ 0x00440090
void __cdecl nullsub_45()
{
  ;
}

// nullsub_46 @ 0x004400A0
void __cdecl nullsub_46()
{
  ;
}

// nullsub_47 @ 0x004400B0
void __cdecl nullsub_47()
{
  ;
}

// nullsub_48 @ 0x004400C0
void __cdecl nullsub_48()
{
  ;
}

// nullsub_49 @ 0x004400D0
void __cdecl nullsub_49()
{
  ;
}

// nullsub_50 @ 0x004400E0
void __cdecl nullsub_50()
{
  ;
}

// nullsub_51 @ 0x004400F0
void __cdecl nullsub_51()
{
  ;
}

// nullsub_52 @ 0x00440100
void __cdecl nullsub_52()
{
  ;
}

// sub_440110 @ 0x00440110
int sub_440110()
{
  int v0; // edi
  int v1; // edx
  int v2; // esi
  char *v3; // eax
  int v4; // esi
  char **v5; // ecx
  char *v6; // eax
  int v7; // edx
  int v8; // ecx
  char *v9; // eax
  int v10; // ebp
  bool v11; // zf
  int v12; // ecx
  int result; // eax
  float v14; // [esp+108h] [ebp-138h]
  float v15; // [esp+10Ch] [ebp-134h]
  int v16; // [esp+10Ch] [ebp-134h]
  int v17; // [esp+10Ch] [ebp-134h]
  float v18; // [esp+10Ch] [ebp-134h]
  int v19; // [esp+10Ch] [ebp-134h]
  int v20; // [esp+10Ch] [ebp-134h]
  float v21; // [esp+10Ch] [ebp-134h]
  float v22; // [esp+10Ch] [ebp-134h]
  float v23; // [esp+110h] [ebp-130h]
  int v24; // [esp+110h] [ebp-130h]
  int v25; // [esp+110h] [ebp-130h]
  int v26; // [esp+110h] [ebp-130h]
  int v27; // [esp+110h] [ebp-130h]
  int v28; // [esp+114h] [ebp-12Ch]
  int v29; // [esp+114h] [ebp-12Ch]
  int v30; // [esp+114h] [ebp-12Ch]
  int v31; // [esp+114h] [ebp-12Ch]
  float v32; // [esp+128h] [ebp-118h] BYREF
  float v33; // [esp+12Ch] [ebp-114h]
  int v34; // [esp+130h] [ebp-110h] BYREF
  float v35; // [esp+134h] [ebp-10Ch]
  int v36; // [esp+138h] [ebp-108h] BYREF
  float v37; // [esp+13Ch] [ebp-104h]
  _BYTE v38[256]; // [esp+140h] [ebp-100h] BYREF

  v33 = flt_489DFC + flt_489E20;
  v0 = -1;
  *(float *)&v34 = flt_489E1C + flt_489DF8 + 300.0;
  v35 = v33 + 40.0;
  v33 = v35 + 10.0;
  v32 = *(float *)&v34 + flt_489DE8 + 44.0 - 110.0 - 32.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  *(float *)&v34 = COERCE_FLOAT(
                     (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 332))(
                       grim_interface_ptr,
                       aUnlockedWeapon));
  v1 = *(_DWORD *)grim_interface_ptr;
  v36 = v34 / 2;
  v15 = v32 + 132.0 - (double)(v34 / 2);
  (*(void (__stdcall **)(_DWORD, float, char *))(v1 + 324))(LODWORD(v15), COERCE_FLOAT(LODWORD(v33)), aUnlockedWeapon);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1056964608);
  *(float *)&v36 = (double)(132 - v34 / 2) + v32;
  v37 = v33 + 13.0;
  v23 = (float)v34;
  (*(void (__stdcall **)(int *, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 212))(&v36, LODWORD(v23), 1065353216);
  v2 = 0;
  v3 = &byte_4D7AE8;
  do
  {
    if ( *v3 )
      ++v2;
    v3 += 124;
  }
  while ( (int)v3 < (int)byte_4D996C );
  v33 = v33 + 20.0 + 10.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v16,
    v24,
    v28);
  v14 = v32 + 8.0;
  (*(void (**)(int, _DWORD, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v14),
    COERCE_FLOAT(LODWORD(v33)),
    aDWeaponsInData,
    v2);
  v33 = v33 + 20.0 + 8.0;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 200) )
  {
    ui_mouse_blocked = 1;
    --dword_4D1200;
  }
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 208) )
  {
    ui_mouse_blocked = 1;
    ++dword_4D1200;
  }
  if ( dword_4D1200 >= 0 )
  {
    if ( dword_4D1200 > 1 )
      dword_4D1200 = 1;
  }
  else
  {
    dword_4D1200 = 0;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v17,
    v25,
    v29);
  v32 = v32 + 10.0;
  v18 = v32 - 2.0;
  (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v18),
    COERCE_FLOAT(LODWORD(v33)),
    aWeapon);
  v4 = 0;
  v5 = (char **)v38;
  v6 = (char *)&byte_4D7AA8;
  v33 = v33 + 16.0 + 4.0;
  do
  {
    if ( v6[64] )
    {
      *v5 = v6;
      ++v4;
      ++v5;
    }
    v6 += 124;
  }
  while ( (int)v6 < (int)byte_4D992C );
  if ( (byte_4CCC51 & 1) == 0 )
  {
    dword_4CCC68 = 0;
    byte_4CCC51 |= 1u;
    dword_4CCC6C = 0;
    crt_atexit(nullsub_54);
  }
  dword_4CCC88 = (int)v38;
  dword_4CCC8C = v4;
  dword_4CCC64 = 10;
  ui_scrollbar_update(&v32, (int)&flt_4CCC58);
  if ( dword_4CCC5C != -1 )
  {
    v7 = 0;
    v8 = 1;
    v9 = &byte_4D7AE8;
    while ( 1 )
    {
      if ( *v9 )
      {
        v10 = v7++;
        if ( v10 == dword_4CCC5C )
          break;
      }
      v9 += 124;
      ++v8;
      if ( (int)v9 >= (int)byte_4D996C )
        goto LABEL_26;
    }
    v0 = v8;
  }
LABEL_26:
  v37 = flt_489DFC + flt_489E20;
  *(float *)&v34 = flt_489E1C + flt_489DF8 + 300.0;
  v35 = v37 + 40.0;
  v33 = v35 + 265.0;
  v32 = *(float *)&v34 + flt_489DE8 + 44.0 - 110.0 - 10.0;
  if ( (byte_4CCC51 & 2) == 0 )
  {
    byte_4CCC51 |= 2u;
    byte_4CC8E6 = 1;
    byte_4CC8F5 = 0;
    byte_4CC8F4 = 0;
    dword_4CC8F0 = 1065353216;
    dword_4CC8EC = 0;
    dword_4CC8E0 = 0;
    byte_4CC8E4 = 0;
    byte_4CC8E5 = 0;
    dword_4CC8E8 = 0;
    crt_atexit(nullsub_53);
  }
  dword_4CC8E0 = (int)aBack_0;
  *(float *)&v34 = v32 + 144.0;
  v35 = v33 + 8.0;
  if ( ui_button_update((float *)&v34, (int)&dword_4CC8E0) )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
  }
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v19,
    v26,
    v30);
  v37 = flt_48A114 + flt_48A138;
  *(float *)&v34 = flt_48A134 + flt_48A110 + 300.0;
  v35 = v37 + 40.0;
  v33 = v35 + 10.0;
  v32 = flt_48A100 - 16.0 + *(float *)&v34 - 240.0 - 10.0;
  if ( *(int *)config_screen_width <= 640 )
    v32 = v32 + 20.0;
  if ( v0 != -1 )
  {
    v32 = v32 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1054615798,
      v20,
      v27,
      v31);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1053609165);
    v21 = v33 - 18.0;
    (*(void (__cdecl **)(int))(*(_DWORD *)grim_interface_ptr + 328))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, _DWORD, char *, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1056964608,
      LODWORD(v21),
      aWepnoD,
      v0);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    (*(void (**)(int, float, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v32)),
      COERCE_FLOAT(LODWORD(v33)),
      aS_0,
      (char *)&weapon_table + 124 * v0);
    v32 = v32 + 32.0;
    v33 = v33 + 22.0 + 26.0;
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      ui_weapon_icons_texture,
      0);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 264))(
      grim_interface_ptr,
      8,
      2,
      1,
      2 * effect_subrect_frame_table[31 * v0]);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v22 = v33 - 16.0;
    (*(void (__stdcall **)(float, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
      COERCE_FLOAT(LODWORD(v32)),
      LODWORD(v22),
      1115684864,
      1107296256);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    v11 = weapon_ammo_class[31 * v0] == 1;
    v33 = v33 + 30.0;
    v32 = v32 - 16.0;
    if ( v11 )
      (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v32)),
        COERCE_FLOAT(LODWORD(v33)),
        aFirerateNA);
    else
      (*(void (**)(int, float, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v32)),
        COERCE_FLOAT(LODWORD(v33)),
        aFirerateDRpm,
        (unsigned int)(__int64)(60.0 / *(float *)&dword_4D7A74[31 * v0]));
    v33 = v33 + 18.0;
    (*(void (**)(int, float, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v32)),
      COERCE_FLOAT(LODWORD(v33)),
      aReloadTime1fSe,
      flt_4D7A78[31 * v0]);
    v12 = dword_4D7A70[31 * v0];
    v33 = v33 + 18.0;
    (*(void (**)(int, float, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v32)),
      COERCE_FLOAT(LODWORD(v33)),
      aClipSizeD,
      v12);
    v33 = v33 + 18.0;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  result = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1);
  if ( (_BYTE)result )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
  }
  return result;
}

// nullsub_53 @ 0x00440940
void __cdecl nullsub_53()
{
  ;
}

// nullsub_54 @ 0x00440950
void __cdecl nullsub_54()
{
  ;
}

// sub_440960 @ 0x00440960
int sub_440960()
{
  int v0; // edi
  int v1; // edx
  int v2; // esi
  _BYTE *v3; // eax
  int v4; // esi
  int *v5; // ecx
  int *v6; // eax
  int v7; // edx
  int v8; // ecx
  char *v9; // eax
  int v10; // ebp
  int v11; // esi
  int v12; // edx
  int v13; // eax
  int v14; // edi
  bool v15; // zf
  int result; // eax
  float v17; // [esp+12Ch] [ebp-238h]
  float v18; // [esp+12Ch] [ebp-238h]
  float v19; // [esp+130h] [ebp-234h]
  int v20; // [esp+130h] [ebp-234h]
  int v21; // [esp+130h] [ebp-234h]
  float v22; // [esp+130h] [ebp-234h]
  int v23; // [esp+130h] [ebp-234h]
  float v24; // [esp+130h] [ebp-234h]
  float v25; // [esp+130h] [ebp-234h]
  float v26; // [esp+130h] [ebp-234h]
  float v27; // [esp+134h] [ebp-230h]
  int v28; // [esp+134h] [ebp-230h]
  int v29; // [esp+134h] [ebp-230h]
  int v30; // [esp+134h] [ebp-230h]
  float v31; // [esp+134h] [ebp-230h]
  int v32; // [esp+138h] [ebp-22Ch]
  int v33; // [esp+138h] [ebp-22Ch]
  int v34; // [esp+138h] [ebp-22Ch]
  float v35; // [esp+14Ch] [ebp-218h] BYREF
  float v36; // [esp+150h] [ebp-214h]
  int v37; // [esp+154h] [ebp-210h] BYREF
  float v38; // [esp+158h] [ebp-20Ch]
  int v39; // [esp+15Ch] [ebp-208h] BYREF
  float v40; // [esp+160h] [ebp-204h]
  _BYTE v41[512]; // [esp+164h] [ebp-200h] BYREF

  v36 = flt_489DFC + flt_489E20;
  v0 = -1;
  *(float *)&v37 = flt_489E1C + flt_489DF8 + 300.0;
  v38 = v36 + 40.0;
  v36 = v38 + 10.0;
  v35 = *(float *)&v37 + flt_489DE8 + 44.0 - 110.0 - 32.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  *(float *)&v37 = COERCE_FLOAT(
                     (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 332))(
                       grim_interface_ptr,
                       aUnlockedPerksD));
  v1 = *(_DWORD *)grim_interface_ptr;
  v39 = v37 / 2;
  v19 = v35 + 132.0 - (double)(v37 / 2);
  (*(void (__stdcall **)(_DWORD, float, char *))(v1 + 324))(LODWORD(v19), COERCE_FLOAT(LODWORD(v36)), aUnlockedPerksD);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1056964608);
  *(float *)&v39 = (double)(132 - v37 / 2) + v35;
  v40 = v36 + 13.0;
  v27 = (float)v37;
  (*(void (__stdcall **)(int *, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 212))(&v39, LODWORD(v27), 1065353216);
  v2 = 0;
  v3 = &unk_4C2C60;
  do
  {
    if ( *v3 )
      ++v2;
    v3 += 20;
  }
  while ( (int)v3 < (int)&dword_4C364C );
  v36 = v36 + 20.0 + 8.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v20,
    v28,
    v32);
  v17 = v35 + 8.0;
  (*(void (**)(int, _DWORD, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v17),
    COERCE_FLOAT(LODWORD(v36)),
    aDPerksInDataba,
    v2);
  v36 = v36 + 20.0 + 8.0;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 200) )
  {
    ui_mouse_blocked = 1;
    --dword_4D1204;
  }
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 208) )
  {
    ui_mouse_blocked = 1;
    ++dword_4D1204;
  }
  if ( dword_4D1204 >= 0 )
  {
    if ( dword_4D1204 > 1 )
      dword_4D1204 = 1;
  }
  else
  {
    dword_4D1204 = 0;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v21,
    v29,
    v33);
  v35 = v35 + 10.0;
  v22 = v35 - 2.0;
  (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v22),
    COERCE_FLOAT(LODWORD(v36)),
    aPerks_0);
  v4 = 0;
  v5 = (int *)v41;
  v6 = perk_meta_table;
  v36 = v36 + 16.0 + 4.0;
  do
  {
    if ( *((_BYTE *)v6 + 12) )
    {
      ++v4;
      *v5++ = *v6;
    }
    v6 += 5;
  }
  while ( (int)v6 < (int)&dword_4C3640 );
  if ( (byte_4CCC50 & 1) == 0 )
  {
    dword_4CCBA8 = 0;
    byte_4CCC50 |= 1u;
    dword_4CCBAC = 0;
    crt_atexit(nullsub_56);
  }
  dword_4CCBC8 = (int)v41;
  dword_4CCBCC = v4;
  dword_4CCBA4 = 10;
  ui_scrollbar_update(&v35, (int)&flt_4CCB98);
  if ( dword_4CCB9C != -1 )
  {
    v7 = 0;
    v8 = 0;
    v9 = perk_available_table;
    while ( 1 )
    {
      if ( *v9 )
      {
        v10 = v7++;
        if ( v10 == dword_4CCB9C )
          break;
      }
      v9 += 20;
      ++v8;
      if ( (int)v9 >= (int)&dword_4C364C )
        goto LABEL_26;
    }
    v0 = v8;
  }
LABEL_26:
  v40 = flt_489DFC + flt_489E20;
  *(float *)&v37 = flt_489E1C + flt_489DF8 + 300.0;
  v38 = v40 + 40.0;
  v36 = v38 + 275.0;
  v35 = *(float *)&v37 + flt_489DE8 + 44.0 - 110.0 - 10.0;
  if ( (byte_4CCC50 & 2) == 0 )
  {
    byte_4CCB86 = 1;
    byte_4CCC50 |= 2u;
    byte_4CCB95 = 0;
    byte_4CCB94 = 0;
    dword_4CCB90 = 1065353216;
    dword_4CCB8C = 0;
    dword_4CCB80 = 0;
    byte_4CCB84 = 0;
    byte_4CCB85 = 0;
    dword_4CCB88 = 0;
    crt_atexit(nullsub_55);
  }
  dword_4CCB80 = (int)aBack_0;
  *(float *)&v37 = v35 + 132.0;
  v38 = v36;
  if ( ui_button_update((float *)&v37, (int)&dword_4CCB80) )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
  }
  v40 = flt_48A114 + flt_48A138;
  *(float *)&v37 = flt_48A134 + flt_48A110 + 300.0;
  v38 = v40 + 40.0;
  v36 = v38 + 10.0;
  v35 = flt_48A100 - 16.0 + *(float *)&v37 - 240.0 - 10.0;
  if ( *(int *)config_screen_width <= 640 )
    v35 = v35 - 10.0;
  if ( v0 != -1 )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1054615798,
      v23,
      v30,
      v34);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1053609165);
    v24 = v36 - 18.0;
    (*(void (__cdecl **)(int))(*(_DWORD *)grim_interface_ptr + 328))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, _DWORD, char *, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1056964608,
      LODWORD(v24),
      aPerknoD,
      v0);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    v11 = 5 * v0;
    *(float *)&v39 = COERCE_FLOAT(
                       (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 332))(
                         grim_interface_ptr,
                         perk_meta_table[5 * v0]));
    v12 = *(_DWORD *)grim_interface_ptr;
    v13 = perk_meta_table[5 * v0];
    v14 = v39 / 2;
    v37 = v39 / 2;
    v25 = v35 + 128.0 - (double)(v39 / 2);
    (*(void (__stdcall **)(_DWORD, float, int))(v12 + 324))(LODWORD(v25), COERCE_FLOAT(LODWORD(v36)), v13);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1056964608);
    *(float *)&v37 = (double)(128 - v14) + v35;
    v38 = v36 + 13.0;
    v31 = (float)v39;
    (*(void (__thiscall **)(int, int *, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 212))(
      grim_interface_ptr,
      &v37,
      LODWORD(v31),
      1065353216);
    v15 = perk_prereq_table[v11] == -1;
    v36 = v36 + 22.0;
    if ( !v15 )
    {
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1061997773,
        1061997773,
        1061997773);
      v18 = v35 + 16.0;
      (*(void (**)(int, _DWORD, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v18),
        COERCE_FLOAT(LODWORD(v36)),
        aRequiresS,
        perk_meta_table[5 * perk_prereq_table[v11]]);
      v36 = v36 + 18.0;
    }
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    v26 = v35 + 16.0;
    (*(void (__stdcall **)(_DWORD, float, int))(*(_DWORD *)grim_interface_ptr + 324))(
      LODWORD(v26),
      COERCE_FLOAT(LODWORD(v36)),
      perk_desc_table[v11]);
    v36 = v36 + 22.0;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)
    && !dword_4D1204 )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
  }
  result = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1);
  if ( (_BYTE)result )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
  }
  return result;
}

// nullsub_55 @ 0x00441180
void __cdecl nullsub_55()
{
  ;
}

// nullsub_56 @ 0x00441190
void __cdecl nullsub_56()
{
  ;
}

// nullsub_119 @ 0x004411B0
void nullsub_119()
{
  ;
}

// sub_4411C0 @ 0x004411C0
int __cdecl sub_4411C0(float *a1)
{
  int result; // eax

  (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4CCCA8);
  *a1 = *a1 - 16.0;
  result = (*(int (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
             grim_interface_ptr,
             a1,
             1128267776,
             1065353216);
  *a1 = *a1 + 16.0;
  a1[1] = a1[1] + 4.0;
  return result;
}

// sub_441220 @ 0x00441220
int __cdecl sub_441220(float *a1)
{
  int result; // eax

  (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4CCCA8);
  *a1 = *a1 - 16.0;
  result = (*(int (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
             grim_interface_ptr,
             a1,
             1065353216,
             1111490560);
  *a1 = *a1 + 16.0;
  return result;
}

// sub_441270 @ 0x00441270
char *__cdecl sub_441270(int a1, int a2, int a3)
{
  const char *v4; // [esp-8h] [ebp-8h]
  int v5; // [esp-4h] [ebp-4h]

  switch ( a2 )
  {
    case 1:
      v5 = a3;
      v4 = aJan;
      goto LABEL_15;
    case 2:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, aFeb, a3);
      return byte_4D0E38;
    case 3:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, aMar, a3);
      return byte_4D0E38;
    case 4:
      v5 = a3;
      v4 = aApr;
      goto LABEL_15;
    case 5:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, aMay, a3);
      return byte_4D0E38;
    case 6:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, aJun, a3);
      return byte_4D0E38;
    case 7:
      v5 = a3;
      v4 = aJul;
      goto LABEL_15;
    case 8:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, aAug, a3);
      return byte_4D0E38;
    case 9:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, aSep, a3);
      return byte_4D0E38;
    case 10:
      v5 = a3;
      v4 = aOct;
      goto LABEL_15;
    case 11:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, aNov, a3);
      return byte_4D0E38;
    case 12:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, aDec, a3);
      return byte_4D0E38;
    default:
      v5 = a3;
      v4 = asc_478884;
LABEL_15:
      crt_sprintf(byte_4D0E38, "%d. %s %d", a1, v4, v5);
      return byte_4D0E38;
  }
}

// ui_text_input_render @ 0x004413A0
// renders a text input field (focus, text, and caret)
void ui_text_input_render(void *input_state, float y, float alpha)
{
  float v3; // esi
  float v4; // esi
  int v5; // eax
  float *v6; // ebx
  int v7; // ebp
  int v8; // edx
  char v9; // al
  int v10; // edx
  int v11; // edi
  int v12; // ecx
  int v13; // eax
  int v14; // ecx
  int v15; // edx
  int v16; // eax
  int v17; // ecx
  int v18; // edi
  float v19; // ecx
  int v20; // ebp
  int v21; // ecx
  int v22; // edx
  char *v23; // eax
  int v24; // edx
  int v25; // ebx
  int v26; // edi
  char v27; // al
  int v28; // edx
  int v29; // eax
  int v30; // edi
  char *v31; // eax
  int v32; // eax
  int v33; // edi
  int v34; // eax
  int v35; // ecx
  int v36; // eax
  int v37; // edi
  int v38; // eax
  int v39; // ebx
  double v40; // st7
  int v41; // edx
  int v42; // edi
  int v43; // ecx
  int v44; // ebx
  __int64 v45; // rax
  double v46; // st7
  int v47; // eax
  double v48; // st7
  int v49; // edx
  int v50; // ecx
  int v51; // ebx
  double v52; // st7
  _DWORD v53[3]; // [esp+150h] [ebp-34h] BYREF
  float v54; // [esp+15Ch] [ebp-28h]
  float v55[3]; // [esp+160h] [ebp-24h] BYREF
  float v56; // [esp+16Ch] [ebp-18h]
  float v57; // [esp+170h] [ebp-14h]
  float v58; // [esp+174h] [ebp-10h] BYREF
  int v59; // [esp+178h] [ebp-Ch]
  int v60; // [esp+180h] [ebp-4h]
  float retaddr; // [esp+184h] [ebp+0h] BYREF
  float input_statea; // [esp+188h] [ebp+4h]
  float input_statec; // [esp+188h] [ebp+4h]
  float input_stated; // [esp+188h] [ebp+4h]
  float input_stateb; // [esp+188h] [ebp+4h]
  int v66; // [esp+198h] [ebp+14h]
  int v67; // [esp+19Ch] [ebp+18h]
  int v68; // [esp+1A0h] [ebp+1Ch]
  int n; // [esp+1A4h] [ebp+20h]

  flt_496604 = 0.69999999;
  dword_4CCCA8 = dword_4965F8;
  dword_4CCCAC = dword_4965FC;
  v57 = alpha * 0.69999999;
  v55[1] = v3;
  v4 = y;
  dword_4CCCB0 = dword_496600;
  *(float *)&dword_4CCCB4 = v57;
  *(float *)&v5 = COERCE_FLOAT(
                    (*(int (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 332))(
                      grim_interface_ptr,
                      LODWORD(y)));
  v6 = (float *)v66;
  v7 = v68;
  v67 = v5;
  input_statea = *(float *)(v66 + 4);
  retaddr = *(float *)v66 + 4.0;
  if ( game_state_id != 7 && game_state_id != 8 && game_state_id != 12 )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      v68);
    (*(void (__thiscall **)(int, float, float, float))(*(_DWORD *)grim_interface_ptr + 324))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(retaddr)),
      COERCE_FLOAT(LODWORD(input_statea)),
      COERCE_FLOAT(LODWORD(v4)));
    (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4CCCA8);
    y = retaddr;
    v56 = 1.0;
    LODWORD(v55[2]) = grim_interface_ptr;
    alpha = input_statea + 13.0;
    v8 = *(_DWORD *)grim_interface_ptr;
    v55[2] = (float)v67;
    (*(void (__thiscall **)(int, float *, _DWORD, int))(v8 + 212))(grim_interface_ptr, &y, LODWORD(v55[2]), 1065353216);
    v9 = *(_BYTE *)(LODWORD(v4) + 68);
    if ( (v9 & 2) != 0 )
    {
      v10 = *(_DWORD *)grim_interface_ptr;
      *(float *)&v67 = *(float *)&v68 * 0.80000001;
      v11 = v67;
      (*(void (__thiscall **)(int, int, int, int, int))(v10 + 276))(
        grim_interface_ptr,
        1061997773,
        1061997773,
        1061997773,
        v67);
      v12 = *(_DWORD *)grim_interface_ptr;
      v55[2] = input_statea + 14.0;
      (*(void (__cdecl **)(int, float, _DWORD, char *))(v12 + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(retaddr)),
        LODWORD(v55[2]),
        aInternetScoreO);
      v13 = *(_DWORD *)grim_interface_ptr;
      v56 = *(float *)&v68 * 0.5;
      (*(void (__thiscall **)(int, int, int, int, float))(v13 + 276))(
        grim_interface_ptr,
        1056964608,
        1056964608,
        1056964608,
        COERCE_FLOAT(LODWORD(v56)));
      v14 = *(_DWORD *)grim_interface_ptr;
      v56 = *(float *)(LODWORD(v4) + 56);
      v55[1] = input_statea - 12.0;
      v55[0] = retaddr + 94.0;
      (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v14 + 328))(
        grim_interface_ptr,
        LODWORD(v55[0]),
        LODWORD(v55[1]),
        aUniD,
        v56);
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1061997773,
        1061997773,
        1061997773,
        v11);
    }
    else
    {
      *(float *)&v67 = *(float *)&v68 * 0.80000001;
      v11 = v67;
      if ( (v9 & 1) != 0 )
      {
        v15 = *(_DWORD *)grim_interface_ptr;
        BYTE1(v55[1]) = 0;
        HIWORD(v55[1]) = 16256;
        strcpy((char *)v55, "333?");
        (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(v15 + 276))(
          grim_interface_ptr,
          LODWORD(v55[0]),
          LODWORD(v55[1]),
          1060320051,
          v67);
        v16 = grim_interface_ptr;
        v56 = COERCE_FLOAT(aScoreFromTheIn);
      }
      else
      {
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1061997773,
          1061997773,
          1061997773,
          v67);
        v16 = grim_interface_ptr;
        v56 = COERCE_FLOAT(aLocalScore);
      }
      v17 = *(_DWORD *)grim_interface_ptr;
      v55[2] = input_statea + 14.0;
      (*(void (__cdecl **)(int, float, _DWORD, float))(v17 + 328))(
        v16,
        COERCE_FLOAT(LODWORD(retaddr)),
        LODWORD(v55[2]),
        COERCE_FLOAT(LODWORD(v56)));
    }
    qmemcpy(v55, "fff?fff?fff?", sizeof(v55));
    input_statec = input_statea + 15.0;
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      v11);
    v18 = *(_DWORD *)grim_interface_ptr;
    v56 = COERCE_FLOAT(
            sub_441270(
              *(unsigned __int8 *)(LODWORD(v4) + 64),
              *(unsigned __int8 *)(LODWORD(v4) + 66),
              *(unsigned __int8 *)(LODWORD(v4) + 67) + 2000));
    v55[2] = v19;
    v20 = *(_DWORD *)grim_interface_ptr;
    v55[2] = input_statec + 13.0;
    v21 = *(unsigned __int8 *)(LODWORD(v4) + 66);
    LODWORD(v55[1]) = *(unsigned __int8 *)(LODWORD(v4) + 67) + 2000;
    v22 = *(unsigned __int8 *)(LODWORD(v4) + 64);
    *(float *)&v66 = retaddr + 192.0 - 32.0 - 8.0;
    v23 = sub_441270(v22, v21, SLODWORD(v55[1]));
    n = (*(int (__thiscall **)(int, char *, _DWORD, float))(v20 + 332))(
          grim_interface_ptr,
          v23,
          LODWORD(v55[2]),
          COERCE_FLOAT(LODWORD(v56)))
      / 2;
    v56 = *(float *)&v68 - (double)n;
    (*(void (__thiscall **)(int, float))(v18 + 324))(grim_interface_ptr, COERCE_FLOAT(LODWORD(v56)));
    v56 = COERCE_FLOAT(&retaddr);
    input_stated = input_statec + 13.0;
    retaddr = *v6 + 16.0;
    sub_4411C0(&retaddr);
    v7 = v68;
    input_statea = input_stated + 14.0;
  }
  v24 = *(_DWORD *)grim_interface_ptr;
  *(float *)&v67 = *(float *)&v68 * 0.80000001;
  v25 = v67;
  qmemcpy(v55, "fff?fff?fff?", sizeof(v55));
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(v24 + 276))(
    grim_interface_ptr,
    LODWORD(v55[0]),
    LODWORD(v55[1]),
    LODWORD(v55[2]),
    v67);
  v26 = *(_DWORD *)grim_interface_ptr;
  *(float *)&v66 = retaddr + 32.0;
  n = (*(int (__thiscall **)(int, char *, float, char *))(v26 + 332))(
        grim_interface_ptr,
        aScore,
        COERCE_FLOAT(LODWORD(input_statea)),
        aScore)
    / 2;
  v56 = *(float *)&v68 - (double)n;
  (*(void (__thiscall **)(int, float))(v26 + 324))(grim_interface_ptr, COERCE_FLOAT(LODWORD(v56)));
  v27 = *(_BYTE *)(LODWORD(v4) + 40);
  if ( v27 == 2 || v27 == 3 )
    crt_sprintf(byte_4D0DA0, "%.2f secs", (double)*(int *)(LODWORD(v4) + 32) * 0.001);
  else
    crt_sprintf(byte_4D0DA0, "%d", *(_DWORD *)(LODWORD(v4) + 36));
  v56 = *(float *)&v7;
  BYTE1(v55[2]) = 0;
  HIWORD(v55[2]) = 16256;
  v28 = *(_DWORD *)grim_interface_ptr;
  strcpy((char *)v55, "fff?fff?");
  (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(v28 + 276))(
    grim_interface_ptr,
    LODWORD(v55[0]),
    LODWORD(v55[1]),
    LODWORD(v55[2]),
    v7);
  v29 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, byte_4D0DA0);
  v56 = COERCE_FLOAT(byte_4D0DA0);
  LODWORD(v55[2]) = grim_interface_ptr;
  v30 = *(_DWORD *)grim_interface_ptr;
  v55[2] = input_statea + 15.0;
  v67 = v29 / 2;
  v55[1] = retaddr + 32.0 - (double)(v29 / 2);
  (*(void (__stdcall **)(_DWORD, _DWORD, char *))(v30 + 324))(LODWORD(v55[1]), LODWORD(v55[2]), byte_4D0DA0);
  if ( game_state_id != 12 )
  {
    v31 = format_ordinal(n);
    crt_sprintf(byte_4D0DA0, "Rank: %s", v31);
    v32 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, byte_4D0DA0);
    v56 = *(float *)&v25;
    v33 = v32;
    v34 = *(_DWORD *)grim_interface_ptr;
    qmemcpy(v55, "fff?fff?fff?", sizeof(v55));
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(v34 + 276))(
      grim_interface_ptr,
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      v25);
    v56 = COERCE_FLOAT(byte_4D0DA0);
    v66 = *(int *)grim_interface_ptr;
    v55[2] = input_statea + 30.0;
    v67 = v33 / 2;
    v55[1] = retaddr + 32.0 - (double)(v33 / 2);
    (*(void (__stdcall **)(_DWORD, _DWORD, char *))(v66 + 324))(LODWORD(v55[1]), LODWORD(v55[2]), byte_4D0DA0);
  }
  retaddr = retaddr + 96.0;
  sub_441220(&retaddr);
  v35 = *(_DWORD *)grim_interface_ptr;
  if ( *(_BYTE *)(LODWORD(v4) + 40) == 3 )
  {
    (*(void (__cdecl **)(int, float, float, char *))(v35 + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(retaddr)),
      COERCE_FLOAT(LODWORD(input_statea)),
      aExperience);
    crt_sprintf(byte_4D0DA0, "%d", *(_DWORD *)(LODWORD(v4) + 36));
    v36 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, byte_4D0DA0);
    v56 = *(float *)&v25;
    v37 = v36;
    v38 = *(_DWORD *)grim_interface_ptr;
    qmemcpy(v55, "fff?fff?fff?", sizeof(v55));
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(v38 + 276))(
      grim_interface_ptr,
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      v25);
    v56 = COERCE_FLOAT(byte_4D0DA0);
    v55[2] = input_statea + 15.0;
    v39 = *(_DWORD *)grim_interface_ptr;
    v67 = v37 / 2;
    v55[1] = retaddr + 32.0 - (double)(v37 / 2);
    (*(void (__stdcall **)(_DWORD, _DWORD, char *))(v39 + 324))(LODWORD(v55[1]), LODWORD(v55[2]), byte_4D0DA0);
    flt_4D120C = flt_4D120C - (frame_dt + frame_dt);
  }
  else
  {
    v55[1] = retaddr + 6.0;
    (*(void (__cdecl **)(int, _DWORD, float, char *))(v35 + 328))(
      grim_interface_ptr,
      LODWORD(v55[1]),
      COERCE_FLOAT(LODWORD(input_statea)),
      aGameTime);
    v54 = *(float *)&v7;
    v53[2] = *(_DWORD *)(LODWORD(v4) + 32);
    v53[1] = (__int64)(input_statea + 13.0);
    v53[0] = (__int64)(retaddr + 8.0);
    ui_draw_clock_gauge();
    if ( retaddr + 8.0 >= ui_mouse_x
      || retaddr + 72.0 <= ui_mouse_x
      || input_statea + 16.0 >= ui_mouse_y
      || input_statea + 45.0 <= ui_mouse_y )
    {
      v40 = flt_4D120C - (frame_dt + frame_dt);
    }
    else
    {
      v40 = frame_dt + frame_dt + flt_4D120C;
    }
    v56 = *(float *)&v25;
    flt_4D120C = v40;
    v41 = *(_DWORD *)grim_interface_ptr;
    qmemcpy(v55, "fff?fff?fff?", sizeof(v55));
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(v41 + 276))(
      grim_interface_ptr,
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      v25);
    v42 = *(_DWORD *)(LODWORD(v4) + 32) / 1000 / 60;
    v43 = *(_DWORD *)grim_interface_ptr;
    LODWORD(v56) = *(_DWORD *)(LODWORD(v4) + 32) / 1000 % 60;
    LODWORD(v55[2]) = v42;
    if ( SLODWORD(v56) >= 10 )
      LODWORD(v55[1]) = aDD_0;
    else
      LODWORD(v55[1]) = aD0D;
    v55[0] = input_statea + 19.0;
    v54 = retaddr + 40.0;
    (*(void (__cdecl **)(int, float, _DWORD, _DWORD, _DWORD, float))(v43 + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v54)),
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      COERCE_FLOAT(LODWORD(v56)));
  }
  input_stateb = input_statea + 52.0;
  retaddr = retaddr - 96.0;
  if ( dword_487234 == 2 && game_state_id == 8
    || (game_state_id == 7 || game_state_id == 8 || game_state_id == 12) && !dword_487234 )
  {
    flt_4D1210 = 0.0;
  }
  else
  {
    sub_4411C0(&retaddr);
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(
      grim_interface_ptr,
      ui_weapon_icons_texture,
      0);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      1,
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      COERCE_FLOAT(LODWORD(v56)));
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 264))(
      grim_interface_ptr,
      8,
      2,
      1,
      2 * effect_subrect_frame_table[31 * *(unsigned __int8 *)(LODWORD(v4) + 43)]);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      v7);
    v56 = 32.0;
    v44 = *(_DWORD *)grim_interface_ptr;
    v55[1] = (float)(__int64)input_stateb;
    v45 = (__int64)retaddr;
    v67 = v45;
    v55[0] = (float)(int)v45;
    (*(void (__fastcall **)(int, _DWORD, _DWORD, _DWORD, int, int))(v44 + 284))(
      grim_interface_ptr,
      HIDWORD(v45),
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      1115684864,
      1107296256);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
    (*(void (__thiscall **)(int, int, int, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      21,
      2,
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      COERCE_FLOAT(LODWORD(v56)));
    if ( ui_mouse_x <= (double)retaddr
      || retaddr + 64.0 <= ui_mouse_x
      || ui_mouse_y <= (double)input_stateb
      || input_stateb + 32.0 <= ui_mouse_y )
    {
      v46 = flt_4D1208 - (frame_dt + frame_dt);
    }
    else
    {
      v46 = frame_dt + frame_dt + flt_4D1208;
    }
    flt_4D1208 = v46;
    v47 = *(_DWORD *)grim_interface_ptr;
    qmemcpy(v55, "fff?fff?fff?", sizeof(v55));
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, int))(v47 + 276))(
      grim_interface_ptr,
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      v60);
    v67 = 32
        - (*(int (__stdcall **)(int))(*(_DWORD *)grim_interface_ptr + 332))(124 * *(unsigned __int8 *)(LODWORD(v4) + 43) + 5077548)
        / 2;
    v48 = (double)v67;
    if ( v48 < 0.0 )
      v48 = 0.0;
    v49 = *(_DWORD *)grim_interface_ptr;
    LODWORD(v56) = 124 * *(unsigned __int8 *)(LODWORD(v4) + 43) + 5077548;
    v55[2] = input_stateb + 32.0;
    v55[1] = v48 + retaddr;
    (*(void (__stdcall **)(_DWORD, _DWORD, float))(v49 + 324))(
      LODWORD(v55[1]),
      LODWORD(v55[2]),
      COERCE_FLOAT(LODWORD(v56)));
    v50 = *(_DWORD *)grim_interface_ptr;
    v56 = *(float *)(LODWORD(v4) + 52);
    v55[1] = input_stateb + 1.0;
    v55[0] = retaddr + 110.0;
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v50 + 328))(
      grim_interface_ptr,
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      aFragsD,
      v56);
    v51 = *(_DWORD *)grim_interface_ptr;
    LODWORD(v56) = (__int64)((double)*(int *)(LODWORD(v4) + 48) * 100.0 / (double)*(int *)(LODWORD(v4) + 44));
    v55[1] = input_stateb + 16.0 - 1.0;
    v55[0] = retaddr + 110.0;
    (*(void (**)(int, _DWORD, _DWORD, char *, ...))(v51 + 328))(
      grim_interface_ptr,
      LODWORD(v55[0]),
      LODWORD(v55[1]),
      aHitD,
      v56);
    if ( retaddr + 110.0 >= ui_mouse_x
      || retaddr + 174.0 <= ui_mouse_x
      || input_stateb + 16.0 - 1.0 >= ui_mouse_y
      || input_stateb + 32.0 <= ui_mouse_y )
    {
      v52 = flt_4D1210 - (frame_dt + frame_dt);
    }
    else
    {
      v52 = frame_dt + frame_dt + flt_4D1210;
    }
    flt_4D1210 = v52;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    v7);
  sub_4411C0(&v58);
  if ( flt_4D1208 <= 1.0 )
  {
    if ( flt_4D1208 < 0.0 )
      flt_4D1208 = 0.0;
  }
  else
  {
    flt_4D1208 = 1.0;
  }
  if ( flt_4D120C <= 1.0 )
  {
    if ( flt_4D120C < 0.0 )
      flt_4D120C = 0.0;
  }
  else
  {
    flt_4D120C = 1.0;
  }
  if ( flt_4D1210 <= 1.0 )
  {
    if ( flt_4D1210 < 0.0 )
      flt_4D1210 = 0.0;
  }
  else
  {
    flt_4D1210 = 1.0;
  }
  if ( game_state_id == 7 || game_state_id == 8 || game_state_id == 12 )
  {
    qmemcpy(v53, "fff?fff?fff?", sizeof(v53));
    (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      v53[0],
      v53[1],
      v53[2],
      COERCE_FLOAT(LODWORD(v57)));
    if ( flt_4D1208 > 0.5 )
    {
      v54 = (flt_4D1208 - 0.5) * alpha + (flt_4D1208 - 0.5) * alpha;
      qmemcpy(v53, "fff?fff?fff?", sizeof(v53));
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        v53[0],
        v53[1],
        v53[2],
        COERCE_FLOAT(LODWORD(v54)));
      *(float *)&v53[1] = v58 - 20.0;
      (*(void (__stdcall **)(_DWORD, int, char *))(*(_DWORD *)grim_interface_ptr + 324))(v53[1], v59, aMostUsedWeapon);
    }
    if ( flt_4D120C > 0.5 )
    {
      v54 = (flt_4D120C - 0.5) * alpha + (flt_4D120C - 0.5) * alpha;
      qmemcpy(v53, "fff?fff?fff?", sizeof(v53));
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        v53[0],
        v53[1],
        v53[2],
        COERCE_FLOAT(LODWORD(v54)));
      *(float *)&v53[1] = v58 + 12.0;
      (*(void (__stdcall **)(_DWORD, int, char *))(*(_DWORD *)grim_interface_ptr + 324))(v53[1], v59, aTheTimeTheGame);
    }
    if ( flt_4D1210 > 0.5 )
    {
      v54 = (flt_4D1210 - 0.5) * alpha + (flt_4D1210 - 0.5) * alpha;
      qmemcpy(v53, "fff?fff?fff?", sizeof(v53));
      (*(void (__thiscall **)(int, _DWORD, _DWORD, _DWORD, float))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        v53[0],
        v53[1],
        v53[2],
        COERCE_FLOAT(LODWORD(v54)));
      *(float *)&v53[1] = v58 - 22.0;
      (*(void (__stdcall **)(_DWORD, int, char *))(*(_DWORD *)grim_interface_ptr + 324))(v53[1], v59, aTheOfShotBulle);
    }
  }
}

// ui_update_notice_update @ 0x00442150
// renders the update-available notice and its button
void ui_update_notice_update(float *xy, float alpha)
{
  float v2; // [esp+4Ch] [ebp-2Ch]
  float v3; // [esp+4Ch] [ebp-2Ch]
  float v4; // [esp+4Ch] [ebp-2Ch]
  float v5; // [esp+4Ch] [ebp-2Ch]
  float v6; // [esp+4Ch] [ebp-2Ch]
  float v7; // [esp+50h] [ebp-28h]
  float v8; // [esp+50h] [ebp-28h]
  float v9; // [esp+50h] [ebp-28h]
  float v10; // [esp+50h] [ebp-28h]
  float v11; // [esp+50h] [ebp-28h]
  float v12[2]; // [esp+60h] [ebp-18h] BYREF
  _DWORD v13[4]; // [esp+68h] [ebp-10h] BYREF

  *(float *)&v13[3] = alpha * 0.80000001;
  memset(v13, 0, 12);
  (*(void (__thiscall **)(int, float *, int, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 208))(
    grim_interface_ptr,
    xy,
    1132789760,
    1117257728,
    v13);
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(alpha));
  (*(void (__thiscall **)(int, float *, int, int))(*(_DWORD *)grim_interface_ptr + 212))(
    grim_interface_ptr,
    xy,
    1132789760,
    1117257728);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1045220557,
    1045220557,
    1065353216);
  v7 = xy[1] + 14.0;
  v2 = *xy + 12.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v2),
    LODWORD(v7),
    aNote);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  v8 = xy[1] + 4.0;
  v3 = *xy + 60.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v3),
    LODWORD(v8),
    aThereIsANewerV_0);
  v9 = xy[1] + 18.0;
  v4 = *xy + 60.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v4),
    LODWORD(v9),
    aGameAvailableF);
  v10 = xy[1] + 32.0;
  v5 = *xy + 60.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, CHAR *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v5),
    LODWORD(v10),
    szPassword);
  v11 = xy[1] + 46.0;
  v6 = *xy + 60.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, CHAR *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v6),
    LODWORD(v11),
    szPassword);
  if ( (byte_4CC930 & 1) == 0 )
  {
    byte_4D0ED6 = 1;
    byte_4CC930 |= 1u;
    byte_4D0EE5 = 0;
    byte_4D0EE4 = 0;
    dword_4D0EE0 = 1065353216;
    dword_4D0EDC = 0;
    dword_4D0ED0 = 0;
    byte_4D0ED4 = 0;
    byte_4D0ED5 = 0;
    dword_4D0ED8 = 0;
    crt_atexit(nullsub_57);
  }
  dword_4D0ED0 = (int)aGetTheUpdate;
  v12[0] = *xy + 65.0;
  v12[1] = xy[1] + 42.0 - 2.0;
  ui_button_update(v12, (int)&dword_4D0ED0);
  if ( byte_4D0ED5 )
    byte_480838 = 1;
}

// nullsub_57 @ 0x004423C0
void __cdecl nullsub_57()
{
  ;
}

// sub_4423D0 @ 0x004423D0
char sub_4423D0()
{
  char *v0; // eax
  int v1; // ecx
  int v2; // eax
  int v3; // eax
  double v4; // st7
  std::codecvt_base *v5; // ecx
  char *v6; // ebp
  char *v7; // esi
  float v8; // edi
  int v9; // ebx
  char v10; // al
  bool v11; // cc
  int v12; // ebx
  std::codecvt_base *v13; // ecx
  bool v14; // zf
  int v15; // eax
  char v16; // al
  int v17; // ecx
  int v18; // eax
  int *v19; // eax
  char *v20; // eax
  char *v21; // eax
  _BYTE *v22; // eax
  char *v23; // eax
  double v24; // st7
  int v25; // eax
  std::codecvt_base *v26; // ecx
  bool v27; // al
  float v28; // edi
  int v29; // eax
  float v30; // esi
  int v31; // eax
  int v32; // esi
  int v33; // esi
  int v34; // esi
  float v35; // edi
  float v36; // esi
  int v37; // edx
  std::codecvt_base *v38; // ecx
  char v39; // al
  int v40; // ecx
  std::codecvt_base *v41; // ecx
  float v42; // esi
  int v43; // edi
  int v44; // eax
  int v45; // ecx
  int v46; // eax
  int v47; // ecx
  int v48; // eax
  int v49; // ecx
  int v50; // eax
  int v51; // eax
  int v52; // ecx
  char result; // al
  float v54; // [esp+104h] [ebp-ACh]
  float v55; // [esp+108h] [ebp-A8h]
  float v56; // [esp+110h] [ebp-A0h]
  int v57; // [esp+110h] [ebp-A0h]
  int v58; // [esp+110h] [ebp-A0h]
  float v59; // [esp+110h] [ebp-A0h]
  float v60; // [esp+110h] [ebp-A0h]
  float v61; // [esp+110h] [ebp-A0h]
  int v62; // [esp+110h] [ebp-A0h]
  int v63; // [esp+110h] [ebp-A0h]
  float v64; // [esp+110h] [ebp-A0h]
  float v65; // [esp+114h] [ebp-9Ch]
  int v66; // [esp+114h] [ebp-9Ch]
  int v67; // [esp+114h] [ebp-9Ch]
  int v68; // [esp+114h] [ebp-9Ch]
  int v69; // [esp+114h] [ebp-9Ch]
  float v70; // [esp+114h] [ebp-9Ch]
  float v71; // [esp+114h] [ebp-9Ch]
  int v72; // [esp+118h] [ebp-98h]
  int v73; // [esp+118h] [ebp-98h]
  int v74; // [esp+118h] [ebp-98h]
  int v75; // [esp+118h] [ebp-98h]
  float v76; // [esp+118h] [ebp-98h]
  float v77; // [esp+118h] [ebp-98h]
  int v78; // [esp+11Ch] [ebp-94h]
  int v79; // [esp+120h] [ebp-90h]
  int v80; // [esp+124h] [ebp-8Ch]
  int v81; // [esp+128h] [ebp-88h]
  float v82; // [esp+12Ch] [ebp-84h] BYREF
  float v83; // [esp+130h] [ebp-80h]
  char v84; // [esp+137h] [ebp-79h]
  float v85; // [esp+138h] [ebp-78h] BYREF
  float v86; // [esp+13Ch] [ebp-74h]
  float v87; // [esp+140h] [ebp-70h]
  float v88; // [esp+144h] [ebp-6Ch]
  float v89; // [esp+148h] [ebp-68h] BYREF
  float v90; // [esp+14Ch] [ebp-64h]
  float v91; // [esp+150h] [ebp-60h] BYREF
  float v92; // [esp+154h] [ebp-5Ch]
  int v93; // [esp+158h] [ebp-58h] BYREF
  float v94; // [esp+15Ch] [ebp-54h]
  int v95; // [esp+160h] [ebp-50h]
  int v96; // [esp+164h] [ebp-4Ch]
  float v97[2]; // [esp+168h] [ebp-48h] BYREF
  float v98; // [esp+170h] [ebp-40h]
  float v99; // [esp+174h] [ebp-3Ch]
  int v100; // [esp+178h] [ebp-38h] BYREF
  int v101; // [esp+17Ch] [ebp-34h]
  int v102; // [esp+180h] [ebp-30h]
  int v103; // [esp+184h] [ebp-2Ch]
  _DWORD v104[5]; // [esp+188h] [ebp-28h] BYREF
  _DWORD v105[5]; // [esp+19Ch] [ebp-14h] BYREF

  if ( config_hardcore )
  {
    *(float *)&v93 = 0.98039216;
    v94 = 0.27450982;
    v95 = 1047589105;
    v96 = 1060320051;
    v100 = 1065024251;
    v101 = 1049398413;
    v102 = 1047589105;
  }
  else
  {
    *(float *)&v93 = 0.27450982;
    v94 = 0.70588237;
    v95 = 1064366321;
    v96 = 1060320051;
    v100 = 1049398413;
    v101 = 1060418741;
    v102 = 1064366321;
  }
  v103 = 1060320051;
  v94 = flt_489DFC + flt_489E20;
  v84 = 0;
  v98 = flt_489E1C + flt_489DF8 + 300.0;
  v99 = v94 + 40.0;
  v83 = v99 + 1.0;
  v82 = v98 + flt_489DE8 + 44.0 - 110.0 - 32.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v0 = game_mode_label();
  crt_sprintf(byte_4D0FC4, "High scores - %s", v0);
  v88 = COERCE_FLOAT((*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, byte_4D0FC4));
  LODWORD(v97[0]) = SLODWORD(v88) / 2;
  v56 = v82 - (double)(SLODWORD(v88) / 2) + 128.0;
  (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v56),
    COERCE_FLOAT(LODWORD(v83)),
    byte_4D0FC4);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  LODWORD(v97[0]) = 128 - SLODWORD(v88) / 2;
  v89 = (double)SLODWORD(v97[0]) + v82;
  v90 = v83 + 14.0;
  v65 = (float)SLODWORD(v88);
  (*(void (__stdcall **)(float *, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 212))(&v89, LODWORD(v65), 1065353216);
  v83 = v83 + 15.0;
  if ( config_game_mode != 3 )
  {
    v4 = v83 + 20.0;
    goto LABEL_32;
  }
  v82 = v82 - 8.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v57,
    v66,
    v72);
  v83 = v83 + 6.0;
  if ( config_hardcore )
  {
    v1 = quest_unlock_index_full;
    if ( quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 11 <= quest_unlock_index_full )
      goto LABEL_10;
  }
  else
  {
    v1 = quest_unlock_index;
    if ( quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 11 <= quest_unlock_index )
      goto LABEL_10;
  }
  *(_DWORD *)quest_stage_major = v1 / 10 + 1;
  quest_stage_minor = v1 % 10 + 1;
  j_highscore_load_table();
LABEL_10:
  (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &v100);
  v55 = v83 + 1.0;
  v54 = v82 + 42.0;
  (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v54),
    LODWORD(v55),
    aDDS,
    *(_DWORD *)quest_stage_major,
    quest_stage_minor,
    quest_meta_name[110 * *(_DWORD *)quest_stage_major - 121 + 11 * quest_stage_minor]);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  if ( ui_mouse_x <= (double)v82
    || v83 - 2.0 >= ui_mouse_y
    || v82 + 32.0 <= ui_mouse_x
    || v83 + 18.0 <= ui_mouse_y
    || ui_mouse_blocked )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1057971241);
  }
  else
  {
    dword_4D1214 = -3;
    v2 = *(_DWORD *)grim_interface_ptr;
    v84 = 1;
    (*(void (__thiscall **)(int, int, int, int, int))(v2 + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
  }
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7BC, 0);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  if ( *(_DWORD *)quest_stage_major != 1 || quest_stage_minor != 1 )
    (*(void (__thiscall **)(int, float, float, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v82)),
      COERCE_FLOAT(LODWORD(v83)),
      1107296256,
      1098907648);
  v82 = v82 + 255.0;
  if ( ui_mouse_x <= (double)v82
    || v83 - 2.0 >= ui_mouse_y
    || v82 + 32.0 <= ui_mouse_x
    || v83 + 18.0 <= ui_mouse_y
    || ui_mouse_blocked )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1057132380);
  }
  else
  {
    dword_4D1214 = -2;
    v3 = *(_DWORD *)grim_interface_ptr;
    v84 = 1;
    (*(void (__thiscall **)(int, int, int, int, int))(v3 + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
  }
  (*(void (__thiscall **)(int, int, _DWORD, _DWORD, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    1065353216,
    0,
    0,
    1065353216);
  if ( *(_DWORD *)quest_stage_major != 5 || quest_stage_minor != 10 )
    (*(void (__thiscall **)(int, float, float, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v82)),
      COERCE_FLOAT(LODWORD(v83)),
      1107296256,
      1098907648);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  v82 = v82 - 255.0;
  v4 = v83 + 14.0;
  v82 = v82 + 8.0;
LABEL_32:
  v83 = v4 + 8.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v58,
    v67,
    v73);
  v59 = v82 + 9.0;
  (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v59),
    COERCE_FLOAT(LODWORD(v83)),
    aRank);
  v60 = v82 + 44.0;
  (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v60),
    COERCE_FLOAT(LODWORD(v83)),
    aScore);
  v61 = v82 + 100.0;
  (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v61),
    COERCE_FLOAT(LODWORD(v83)),
    aPlayer);
  if ( config_game_mode == 3 )
  {
    if ( (byte_4CCCB8 & 1) == 0 )
    {
      checkbox = 0;
      byte_4CCCB8 |= 1u;
      byte_4D0D99 = 0;
      byte_4D0D9A = 0;
      dword_4D0D9C = 0;
      crt_atexit(nullsub_66);
    }
    dword_4D0D9C = (int)aHardcore;
    if ( quest_unlock_index < 40 )
    {
      config_hardcore = 0;
    }
    else
    {
      v89 = v82 + 162.0;
      checkbox = config_hardcore;
      v90 = v83 - 2.0;
      ui_checkbox_update(&v89, (int)&checkbox);
      LOBYTE(v5) = config_hardcore;
      if ( config_hardcore != checkbox )
      {
        config_hardcore = checkbox;
        j_highscore_load_table();
      }
    }
    if ( !game_is_full_version(v5) )
      config_hardcore = 0;
  }
  LODWORD(v87) = 1;
  v91 = NAN;
  v97[0] = 0.0;
  v6 = (char *)&unk_4CC934;
  v7 = byte_482B54;
  v88 = COERCE_FLOAT(&unk_4CCD68);
  v83 = v83 + 16.0 + 1.0;
  do
  {
    v8 = v88;
    *(float *)v6 = v88;
    memset((void *)LODWORD(v8), 0, 0xA4u);
    v9 = 0;
    if ( !*((_DWORD *)v7 - 9) )
      break;
    v10 = *v7;
    if ( (*v7 & 5) != 0 && ((v10 & 2) == 0 || (v10 & 4) != 0) )
    {
      v9 = 2;
      **(_BYTE **)v6 = 92;
      *(_BYTE *)(*(_DWORD *)v6 + 1) = 103;
    }
    if ( config_game_mode == 2 || config_game_mode == 3 )
      crt_sprintf((char *const)(v9 + *(_DWORD *)v6), "%d\t%d\t%s", v87, *((_DWORD *)v7 - 9) / 1000, v7 - 68);
    else
      crt_sprintf((char *const)(v9 + *(_DWORD *)v6), "%d\t%d\t%s", v87, *((_DWORD *)v7 - 8), v7 - 68);
    v7 += 72;
    v6 += 4;
    v11 = LODWORD(v88) + 164 < (int)&list;
    ++LODWORD(v97[0]);
    LODWORD(v88) += 164;
    ++LODWORD(v87);
  }
  while ( v11 );
  v82 = v82 + 16.0;
  if ( (byte_4CCCB8 & 2) == 0 )
  {
    byte_4CCCB8 |= 2u;
    dword_4CCAD8 = 0;
    dword_4CCADC = 0;
    crt_atexit(nullsub_65);
  }
  dword_4CCAFC = LODWORD(v97[0]);
  v89 = v82 - 8.0;
  v90 = v83;
  dword_4CCAF8 = (int)&unk_4CC934;
  dword_4CCAD4 = 10;
  dword_4CCAD8 = 10;
  dword_4CCADC = 30;
  dword_4CCAE0 = 44;
  ui_scrollbar_update(&v89, (int)&flt_4CCAC8);
  v12 = dword_4CCACC;
  v83 = v83 + 168.0;
  if ( dword_4CCACC == -1 )
    v12 = LODWORD(v91);
  v82 = v82 + 16.0;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v62,
    v68,
    v74);
  v83 = v83 - 1.0;
  if ( (byte_4CCCB8 & 4) == 0 )
  {
    byte_4CCCB8 |= 4u;
    byte_4D0F7E = 1;
    byte_4D0F8D = 0;
    byte_4D0F8C = 0;
    dword_4D0F88 = 1065353216;
    dword_4D0F84 = 0;
    dword_4D0F78 = 0;
    byte_4D0F7C = 0;
    byte_4D0F7D = 0;
    dword_4D0F80 = 0;
    crt_atexit(nullsub_64);
  }
  v14 = !game_is_full_version(v13);
  v15 = *(_DWORD *)grim_interface_ptr;
  if ( v14 )
  {
    if ( (*(unsigned __int8 (__stdcall **)(int))(v15 + 68))(42)
      || (v16 = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 54),
          dword_4D0F78 = (int)aReceiveScores,
          v16) )
    {
      dword_4D0F78 = (int)aReceiveAll;
    }
  }
  else if ( (*(unsigned __int8 (__stdcall **)(int))(v15 + 68))(42)
         || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 54) )
  {
    dword_4D0F78 = (int)aUpdateAll;
  }
  else
  {
    dword_4D0F78 = (int)aUpdateScores;
  }
  if ( ui_button_update(&v82, (int)&dword_4D0F78) && (!dword_4D11F0 || dword_4D11F0 == 6) )
  {
    if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 42)
      || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 54) )
    {
      dword_4CCB58 = -4;
      byte_4D11F9 = 1;
    }
    else
    {
      byte_4D11F9 = 0;
    }
    dword_4D11F0 = 1;
    crt_beginthread((_beginthread_proc_type)sub_42D0E0, 0, 0);
  }
  v83 = v83 + 33.0;
  if ( (byte_4CCCB8 & 8) == 0 )
  {
    byte_4D0F0E = 1;
    byte_4CCCB8 |= 8u;
    byte_4D0F1D = 0;
    byte_4D0F1C = 0;
    dword_4D0F18 = 1065353216;
    dword_4D0F14 = 0;
    dword_4D0F08 = 0;
    byte_4D0F0C = 0;
    byte_4D0F0D = 0;
    dword_4D0F10 = 0;
    crt_atexit(nullsub_63);
  }
  dword_4D0F08 = (int)aPlayAGame;
  if ( dword_4D11F0 == 6 || (byte_4D0F0E = 0, !dword_4D11F0) )
    byte_4D0F0E = 1;
  if ( ui_button_update(&v82, (int)&dword_4D0F08) )
  {
    if ( config_game_mode == 3 )
    {
      v17 = quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 11;
      if ( config_hardcore )
      {
        if ( quest_unlock_index_full < v17 )
          goto LABEL_88;
      }
      else if ( quest_unlock_index < v17 )
      {
        goto LABEL_88;
      }
      render_pass_mode = 0;
      ui_sign_crimson_update_disabled = 0;
      ui_transition_direction = 0;
      game_state_pending = 9;
    }
    else
    {
      render_pass_mode = 0;
      v18 = -(config_game_mode != 4);
      ui_sign_crimson_update_disabled = 0;
      LOBYTE(v18) = v18 & 0xF7;
      ui_transition_direction = 0;
      game_state_pending = v18 + 18;
    }
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    byte_48702C = 1;
  }
LABEL_88:
  v98 = v82 - 32.0;
  v99 = v83 + 32.0;
  if ( (byte_4CCCB8 & 0x10) == 0 )
  {
    byte_4D0F96 = 1;
    byte_4CCCB8 |= 0x10u;
    byte_4D0FA5 = 0;
    byte_4D0FA4 = 0;
    dword_4D0FA0 = 1065353216;
    dword_4D0F9C = 0;
    dword_4D0F90 = 0;
    byte_4D0F94 = 0;
    byte_4D0F95 = 0;
    dword_4D0F98 = 0;
    crt_atexit(nullsub_62);
  }
  dword_4D0F90 = (int)aBack_0;
  if ( dword_4D11F0 == 6 || (byte_4D0F96 = 0, !dword_4D11F0) )
    byte_4D0F96 = 1;
  v89 = v82 + 166.0;
  v90 = v83;
  if ( ui_button_update(&v89, (int)&dword_4D0F90) )
  {
    if ( byte_48724D )
    {
      v19 = bonus_pool;
      do
      {
        *v19 = 0;
        v19 += 7;
      }
      while ( (int)v19 < (int)&quest_spawn_count );
      v20 = projectile_pool;
      do
      {
        *v20 = 0;
        v20 += 64;
      }
      while ( (int)v20 < (int)particle_pool );
      v21 = sprite_effect_pool;
      do
      {
        *v21 = 0;
        v21 += 44;
      }
      while ( (int)v21 < (int)byte_49AA20 );
      v22 = &secondary_projectile_pool;
      do
      {
        *v22 = 0;
        v22 += 44;
      }
      while ( (int)v22 < (int)&dword_4965D8 );
      v23 = creature_pool;
      do
      {
        *v23 = 0;
        v23 += 152;
      }
      while ( (int)v23 < (int)byte_4AA338 );
      quest_stage_minor = dword_487254;
      *(_DWORD *)quest_stage_major = dword_487250;
      byte_48727C = 1;
      config_game_mode = dword_487258;
      config_hardcore = byte_48725C;
      ui_transition_direction = 0;
      game_state_pending = (dword_487258 == 3) + 7;
    }
    else
    {
      ui_transition_direction = 0;
      game_state_pending = 4;
    }
  }
  v94 = flt_48A114 + flt_48A138;
  v85 = flt_48A134 + flt_48A110 + 300.0;
  v86 = v94 + 40.0;
  v24 = flt_48A100 - 16.0 + v85 - 224.0;
  v82 = v24;
  v83 = v86 + 10.0;
  v89 = v24 + 32.0;
  v90 = v83 + 364.0;
  v86 = v83 - 8.0;
  v85 = v82 - 16.0;
  if ( *(int *)config_screen_width <= 640 )
  {
    v85 = v85 + 10.0;
    v24 = v24 - 8.0;
  }
  v25 = dword_4D11F0;
  v82 = v24 - 10.0;
  if ( (dword_4D11F0 == 6 || !dword_4D11F0) && v12 == -1 )
  {
    v86 = v86 + 2.0;
    if ( (byte_4CCCB8 & 0x20) == 0 )
    {
      byte_4D0E20 = 0;
      byte_4CCCB8 |= 0x20u;
      byte_4D0E21 = 0;
      byte_4D0E22 = 0;
      dword_4D0E24 = 0;
      crt_atexit(nullsub_61);
    }
    v97[0] = v85;
    v91 = v85;
    v92 = v86;
    dword_4D0E24 = (int)aShowInternetSc;
    byte_4D0E20 = config_score_load_gate;
    if ( ui_checkbox_update(&v91, (int)&byte_4D0E20) )
    {
      config_score_load_gate = byte_4D0E20;
      j_highscore_load_table();
    }
    v104[0] = aBestOfAllTime;
    v104[1] = aBestOfMonth;
    v104[2] = aBestOfWeek;
    v86 = v86 + 6.0;
    v104[3] = aBestOfDay;
    v104[4] = 0;
    if ( (byte_4CCCB8 & 0x40) == 0 )
    {
      list = 1;
      byte_4CCCB8 |= 0x40u;
      dword_4D0D90 = 0;
      byte_4D0D8C = 0;
      dword_4D0D80 = 0;
      dword_4D0D7C = 0;
      dword_4D0D88 = 0;
      dword_4D0D84 = 0;
      crt_atexit(nullsub_60);
    }
    dword_4D0D88 = 4;
    dword_4D0D84 = (int)v104;
    v27 = game_is_full_version(v26);
    v28 = v85;
    if ( v27 )
    {
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        1061997773);
      v70 = v86 + 114.0 - 14.0;
      (*(void (__thiscall **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v28)),
        LODWORD(v70),
        aSelectedScoreL);
      v92 = v86 + 114.0;
      v91 = v97[0];
      FUN_004443c0(&v91, byte_478678);
    }
    dword_4D0D80 = SBYTE2(config_blob[0]);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1061997773);
    v29 = *(_DWORD *)grim_interface_ptr;
    v91 = v86 + 28.0 - 14.0;
    v30 = v91;
    v88 = v85 + 2.0;
    (*(void (__thiscall **)(int, float, float, char *))(v29 + 324))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v88)),
      COERCE_FLOAT(LODWORD(v91)),
      aNumberOfPlayer);
    v31 = *(_DWORD *)grim_interface_ptr;
    v87 = v85 + 130.0;
    (*(void (__thiscall **)(int, float, float, char *))(v31 + 324))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v87)),
      COERCE_FLOAT(LODWORD(v30)),
      aGameMode);
    v71 = v86 + 70.0 - 14.0;
    (*(void (__thiscall **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v28)),
      LODWORD(v71),
      aShowScores);
    v92 = v86 + 70.0;
    v91 = v97[0];
    v32 = ui_list_widget_update(&v91, (int)&list);
    if ( (dword_4D11F0 == 6 || !dword_4D11F0)
      && v32 > -2
      && ((unsigned __int8)input_primary_just_pressed()
       || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)) )
    {
      dword_4D0D7C = 1 - dword_4D0D7C;
      if ( v32 >= 0 )
      {
        dword_4D0D80 = v32;
        if ( v32 )
        {
          switch ( v32 )
          {
            case 1:
              BYTE2(config_blob[0]) = 1;
              break;
            case 2:
              BYTE2(config_blob[0]) = 2;
              break;
            case 3:
              BYTE2(config_blob[0]) = 3;
              break;
          }
        }
        else
        {
          BYTE2(config_blob[0]) = 0;
        }
        j_highscore_load_table();
      }
    }
    *(float *)&v93 = COERCE_FLOAT(a1Player);
    v94 = COERCE_FLOAT(a2Players);
    if ( byte_4CCCB8 >= 0 )
    {
      byte_4D0FA8 = 1;
      byte_4CCCB8 |= 0x80u;
      dword_4D0FC0 = 0;
      byte_4D0FBC = 0;
      dword_4D0FB0 = 0;
      dword_4D0FAC = 0;
      dword_4D0FB8 = 0;
      dword_4D0FB4 = 0;
      crt_atexit(nullsub_59);
    }
    dword_4D0FB4 = (int)&v93;
    dword_4D0FB8 = 2;
    dword_4D0FB0 = config_player_count - 1;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1062165545);
    v97[0] = v88;
    v91 = v86 + 28.0;
    v97[1] = v91;
    v33 = ui_list_widget_update(v97, (int)&byte_4D0FA8);
    if ( (dword_4D11F0 == 6 || !dword_4D11F0)
      && v33 > -2
      && ((unsigned __int8)input_primary_just_pressed()
       || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)) )
    {
      dword_4D0FAC = 1 - dword_4D0FAC;
      if ( v33 >= 0 )
      {
        dword_4D0FB0 = v33;
        config_player_count = v33 + 1;
        j_highscore_load_table();
      }
    }
    v105[0] = aQuests;
    v105[1] = aRush_0;
    v105[2] = aSurvival;
    v105[3] = aTypOShooter;
    v105[4] = 0;
    if ( (byte_4D0F58 & 1) == 0 )
    {
      byte_4CCCE0 = 1;
      byte_4D0F58 |= 1u;
      dword_4CCCF8 = 0;
      byte_4CCCF4 = 0;
      dword_4CCCE8 = 0;
      dword_4CCCE4 = 0;
      dword_4CCCF0 = 0;
      dword_4CCCEC = 0;
      crt_atexit(nullsub_58);
    }
    dword_4CCCEC = (int)v105;
    dword_4CCCF0 = 3;
    if ( quest_unlock_index >= 40 )
      dword_4CCCF0 = 4;
    byte_4CCCE0 = 1;
    list = 1;
    byte_478678 = 1;
    if ( dword_4CCCE4 )
    {
      byte_478678 = 0;
      list = 0;
    }
    if ( dword_4D0FAC )
    {
      byte_478678 = 0;
      list = 0;
      byte_4CCCE0 = 0;
    }
    if ( dword_4D0D7C )
    {
      byte_478678 = 0;
      byte_4CCCE0 = 0;
    }
    byte_4D0FA8 = 1;
    switch ( config_game_mode )
    {
      case 1:
        dword_4CCCE8 = 2;
        break;
      case 2:
        dword_4CCCE8 = 1;
        break;
      case 3:
        dword_4CCCE8 = 0;
        break;
      case 4:
        dword_4CCCE8 = 3;
        byte_4D0FA8 = 0;
        dword_4D0FB0 = 0;
        config_player_count = 1;
        break;
    }
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1062165545);
    v85 = v87;
    v86 = v91;
    v34 = ui_list_widget_update(&v85, (int)&byte_4CCCE0);
    v25 = dword_4D11F0;
    if ( (dword_4D11F0 == 6 || !dword_4D11F0) && v34 > -2 )
    {
      if ( (unsigned __int8)input_primary_just_pressed()
        || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28) )
      {
        dword_4CCCE4 = 1 - dword_4CCCE4;
        if ( v34 >= 0 )
        {
          dword_4CCCE8 = v34;
          if ( v34 )
          {
            switch ( v34 )
            {
              case 1:
                config_game_mode = 2;
                break;
              case 2:
                config_game_mode = 1;
                break;
              case 3:
                config_game_mode = 4;
                config_player_count = 1;
                break;
            }
          }
          else
          {
            config_game_mode = 3;
          }
          j_highscore_load_table();
        }
      }
      v25 = dword_4D11F0;
    }
  }
  v83 = v83 + 44.0;
  if ( *(int *)config_screen_width <= 640 )
    v82 = v82 + 20.0;
  v35 = v98;
  v36 = v99;
  v37 = *(_DWORD *)grim_interface_ptr;
  if ( v25 )
  {
    (*(void (__stdcall **)(int, int, int, int))(v37 + 276))(1056964608, 1065353216, 1058642330, 1065353216);
    if ( dword_4D11F0 == 1 )
    {
      (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v35)),
        COERCE_FLOAT(LODWORD(v36)),
        aConnecting);
      Sleep(0xAu);
      goto LABEL_224;
    }
    if ( dword_4D11F0 == 2 )
    {
      (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v35)),
        COERCE_FLOAT(LODWORD(v36)),
        aConnected);
      Sleep(0xAu);
      goto LABEL_224;
    }
    if ( dword_4D11F0 == 3 )
    {
      if ( game_is_full_version(v38) )
        (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          COERCE_FLOAT(LODWORD(v35)),
          COERCE_FLOAT(LODWORD(v36)),
          aSendingLocalSc);
      else
        (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          COERCE_FLOAT(LODWORD(v35)),
          COERCE_FLOAT(LODWORD(v36)),
          aConnected_0);
      goto LABEL_188;
    }
    if ( dword_4D11F0 == 4 )
    {
      (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v35)),
        COERCE_FLOAT(LODWORD(v36)),
        aReceivingInter);
      Sleep(0xAu);
    }
    else
    {
      if ( dword_4D11F0 != 5 )
      {
        if ( dword_4D11F0 == 6 )
        {
          (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
            grim_interface_ptr,
            1065353216,
            1056964608,
            1056964608,
            1065353216);
          (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
            grim_interface_ptr,
            COERCE_FLOAT(LODWORD(v35)),
            COERCE_FLOAT(LODWORD(v36)),
            aFailedToUpdate);
          byte_4D11F9 = 0;
        }
        goto LABEL_188;
      }
      (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v35)),
        COERCE_FLOAT(LODWORD(v36)),
        aDone_0);
      if ( byte_4D1218 )
      {
LABEL_188:
        Sleep(0xAu);
        goto LABEL_224;
      }
      dword_4D11F0 = 1;
      crt_beginthread((_beginthread_proc_type)sub_42D8A0, 0, 0);
      byte_4D1218 = 1;
      Sleep(0xAu);
    }
    goto LABEL_224;
  }
  if ( (*(unsigned __int8 (__stdcall **)(int))(v37 + 68))(1) )
  {
    byte_4D11F9 = 0;
    goto LABEL_224;
  }
  if ( byte_4D11F9 )
  {
    if ( config_game_mode == 3 )
    {
      v39 = config_hardcore;
    }
    else
    {
      v39 = 0;
      config_hardcore = 0;
    }
    byte_4D0D94 = v39;
    v40 = ++dword_4CCB58;
    if ( v39 && v40 < 0 )
    {
      v40 = 0;
      dword_4CCB58 = 0;
    }
    else
    {
      switch ( v40 )
      {
        case -3:
          config_game_mode = 1;
          goto LABEL_223;
        case -2:
          config_game_mode = 2;
          goto LABEL_223;
        case -1:
          if ( config_player_count > 1 )
          {
            v40 = 0;
            dword_4CCB58 = 0;
          }
          config_game_mode = 4;
          break;
      }
      if ( v40 < 0 )
        goto LABEL_223;
    }
    if ( v39 )
    {
      if ( HIWORD(game_status_blob) >= v40 )
      {
LABEL_220:
        if ( v40 / 10 + 1 >= 5 )
          goto LABEL_221;
        *(_DWORD *)quest_stage_major = v40 / 10 + 1;
        config_game_mode = 3;
        quest_stage_minor = v40 % 10 + 1;
LABEL_223:
        Sleep(0x32u);
        dword_4D11F0 = 1;
        crt_beginthread((_beginthread_proc_type)sub_42D0E0, 0, 0);
        goto LABEL_224;
      }
    }
    else if ( (unsigned __int16)game_status_blob >= v40 )
    {
      goto LABEL_220;
    }
LABEL_221:
    byte_4D11F9 = 0;
  }
LABEL_224:
  if ( v12 == -1 )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    if ( !dword_4D11F0 )
    {
      if ( dword_4D0F80 > 0 )
      {
        v76 = (double)dword_4D0F80 * 0.00090000004;
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v76));
        if ( game_is_full_version(v41) )
        {
          if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(
                 grim_interface_ptr,
                 42)
            || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(
                 grim_interface_ptr,
                 54) )
          {
            (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
              grim_interface_ptr,
              COERCE_FLOAT(LODWORD(v35)),
              COERCE_FLOAT(LODWORD(v36)),
              aUpdateScoresFr);
          }
        }
        else
        {
          v64 = v98 - 4.0;
          (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
            grim_interface_ptr,
            LODWORD(v64),
            COERCE_FLOAT(LODWORD(v36)),
            aOnlyReceiveSco);
        }
      }
      if ( dword_4D0F10 > 0 )
      {
        v77 = (double)dword_4D0F10 * 0.00090000004;
        (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
          grim_interface_ptr,
          1065353216,
          1065353216,
          1065353216,
          LODWORD(v77));
        (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          COERCE_FLOAT(LODWORD(v35)),
          COERCE_FLOAT(LODWORD(v36)),
          aPlayAGameOfSel);
      }
    }
  }
  else
  {
    v42 = v82;
    *(float *)&v43 = v83;
    (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
      grim_interface_ptr,
      24,
      1054615798,
      v63,
      v69,
      v75);
    v83 = v83 - 54.0;
    *(float *)&v93 = v82 + 24.0;
    v94 = v83 + 4.0;
    ui_text_input_render(v12, 0, v43, v42, (int)&v93, 72 * v12 + 4729616, 1.0, v12 + 1, v78, v79, v80, v81);
    v82 = v42;
    v83 = *(float *)&v43;
  }
  if ( (dword_4D11F0 == 6 || !dword_4D11F0)
    && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 203) )
  {
    v44 = *(_DWORD *)quest_stage_major;
    v45 = --quest_stage_minor;
    if ( quest_stage_minor <= 0 )
    {
      if ( *(int *)quest_stage_major < 2 )
      {
        v45 = 1;
      }
      else
      {
        v44 = *(_DWORD *)quest_stage_major - 1;
        v45 = 10;
        --*(_DWORD *)quest_stage_major;
      }
      quest_stage_minor = v45;
    }
    if ( config_hardcore )
    {
      if ( v45 + 10 * v44 - 11 > quest_unlock_index_full )
      {
        *(_DWORD *)quest_stage_major = quest_unlock_index_full / 10 + 1;
        quest_stage_minor = quest_unlock_index_full % 10 + 1;
        j_highscore_load_table();
      }
    }
    else if ( v45 + 10 * v44 - 11 > quest_unlock_index )
    {
      *(_DWORD *)quest_stage_major = quest_unlock_index / 10 + 1;
      quest_stage_minor = quest_unlock_index % 10 + 1;
    }
    j_highscore_load_table();
  }
  if ( (dword_4D11F0 == 6 || !dword_4D11F0)
    && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 205) )
  {
    v46 = *(_DWORD *)quest_stage_major;
    v47 = quest_stage_minor;
    if ( quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 11 < quest_unlock_index )
      v47 = ++quest_stage_minor;
    if ( v47 > 10 )
    {
      if ( *(int *)quest_stage_major >= 5 )
      {
        v47 = 10;
      }
      else
      {
        v46 = *(_DWORD *)quest_stage_major + 1;
        v47 = 1;
        ++*(_DWORD *)quest_stage_major;
      }
      quest_stage_minor = v47;
    }
    if ( config_hardcore )
    {
      if ( v47 + 10 * v46 - 11 > quest_unlock_index_full )
      {
        *(_DWORD *)quest_stage_major = quest_unlock_index_full / 10 + 1;
        quest_stage_minor = quest_unlock_index_full % 10 + 1;
        j_highscore_load_table();
      }
    }
    else if ( v47 + 10 * v46 - 11 > quest_unlock_index )
    {
      *(_DWORD *)quest_stage_major = quest_unlock_index / 10 + 1;
      quest_stage_minor = quest_unlock_index % 10 + 1;
    }
    j_highscore_load_table();
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  if ( (!dword_4D11F0 || dword_4D11F0 == 6)
    && (v84 && (unsigned __int8)input_primary_just_pressed()
     || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)) )
  {
    switch ( dword_4D1214 )
    {
      case -3:
        v48 = *(_DWORD *)quest_stage_major;
        v49 = --quest_stage_minor;
        if ( quest_stage_minor <= 0 )
        {
          if ( *(int *)quest_stage_major < 2 )
          {
            v49 = 1;
          }
          else
          {
            v48 = *(_DWORD *)quest_stage_major - 1;
            v49 = 10;
            --*(_DWORD *)quest_stage_major;
          }
          quest_stage_minor = v49;
        }
        v50 = v49 + 10 * v48 - 11;
        if ( config_hardcore )
        {
          if ( v50 > quest_unlock_index_full )
          {
LABEL_278:
            *(_DWORD *)quest_stage_major = quest_unlock_index_full / 10 + 1;
            quest_stage_minor = quest_unlock_index_full % 10 + 1;
            j_highscore_load_table();
            j_highscore_load_table();
            break;
          }
        }
        else if ( v50 > quest_unlock_index )
        {
          *(_DWORD *)quest_stage_major = quest_unlock_index / 10 + 1;
          quest_stage_minor = quest_unlock_index % 10 + 1;
        }
        goto LABEL_281;
      case -2:
        v51 = *(_DWORD *)quest_stage_major;
        v52 = quest_stage_minor;
        if ( quest_stage_minor + 10 * *(_DWORD *)quest_stage_major - 11 < quest_unlock_index )
          v52 = ++quest_stage_minor;
        if ( v52 > 10 )
        {
          if ( *(int *)quest_stage_major >= 5 )
          {
            v52 = 10;
          }
          else
          {
            v51 = *(_DWORD *)quest_stage_major + 1;
            v52 = 1;
            ++*(_DWORD *)quest_stage_major;
          }
          quest_stage_minor = v52;
        }
        if ( config_hardcore )
        {
          if ( v52 + 10 * v51 - 11 > quest_unlock_index_full )
            goto LABEL_278;
        }
        else if ( v52 + 10 * v51 - 11 > quest_unlock_index )
        {
          *(_DWORD *)quest_stage_major = quest_unlock_index / 10 + 1;
          quest_stage_minor = quest_unlock_index % 10 + 1;
        }
LABEL_281:
        j_highscore_load_table();
        break;
      case 1:
        if ( !dword_4D11F0 || dword_4D11F0 == 6 )
        {
          if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(
                 grim_interface_ptr,
                 42)
            || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(
                 grim_interface_ptr,
                 54) )
          {
            dword_4CCB58 = -4;
            byte_4D11F9 = 1;
          }
          else
          {
            byte_4D11F9 = 0;
          }
          dword_4D11F0 = 1;
          crt_beginthread((_beginthread_proc_type)sub_42D0E0, 0, 0);
        }
        break;
      case 2:
        render_pass_mode = 0;
        ui_sign_crimson_update_disabled = 0;
        ui_transition_direction = 0;
        game_state_pending = 9;
        sfx_mute_all(music_track_crimson_theme_id);
        sfx_mute_all(music_track_shortie_monk_id);
        sfx_mute_all(music_track_extra_0);
        byte_48702C = 1;
        break;
      case 3:
        ui_transition_direction = 0;
        game_state_pending = 4;
        break;
    }
  }
  if ( (!dword_4D11F0 || dword_4D11F0 == 6)
    && (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1) )
  {
    ui_transition_direction = 0;
    game_state_pending = 4;
  }
  if ( !dword_4D11F0 && byte_4D11F8 && lpMultiByteStr )
  {
    *(float *)&v93 = v89 - 48.0;
    v94 = v90 - 146.0;
    ui_update_notice_update((float *)&v93, 1.0);
  }
  else
  {
    byte_480838 = 0;
  }
  result = ui_transition_direction;
  if ( !ui_transition_direction )
  {
    byte_4D11F8 = 0;
    byte_4D1218 = 0;
  }
  return result;
}

// nullsub_58 @ 0x00444330
void __cdecl nullsub_58()
{
  ;
}

// nullsub_59 @ 0x00444340
void __cdecl nullsub_59()
{
  ;
}

// nullsub_60 @ 0x00444350
void __cdecl nullsub_60()
{
  ;
}

// nullsub_61 @ 0x00444360
void __cdecl nullsub_61()
{
  ;
}

// nullsub_62 @ 0x00444370
void __cdecl nullsub_62()
{
  ;
}

// nullsub_63 @ 0x00444380
void __cdecl nullsub_63()
{
  ;
}

// nullsub_64 @ 0x00444390
void __cdecl nullsub_64()
{
  ;
}

// nullsub_65 @ 0x004443A0
void __cdecl nullsub_65()
{
  ;
}

// nullsub_66 @ 0x004443B0
void __cdecl nullsub_66()
{
  ;
}

// FUN_004443c0 @ 0x004443C0
// [binja] int32_t sub_4443c0(float* arg1, char arg2)
int FUN_004443c0(float *arg1, char arg2)
{
  int v2; // edx
  int *v3; // ecx
  char *v4; // eax
  int v5; // esi
  int v6; // eax
  int result; // eax
  int v8; // [esp+Ch] [ebp-Ch]
  float xy; // [esp+10h] [ebp-8h] BYREF
  float v10; // [esp+14h] [ebp-4h]

  if ( (byte_4CCCD8 & 1) == 0 )
  {
    dword_4D0F38 = 1065353216;
    byte_4CCCD8 |= 1u;
    dword_4D0F28 = (int)&byte_4CCB18;
    dword_4D0F2C = 0;
    dword_4D0F30 = 27;
    dword_4D0F34 = 96;
    crt_atexit(nullsub_70);
  }
  v2 = config_name_slot_count;
  v8 = 0;
  if ( config_name_slot_count > 0 )
  {
    v3 = dword_4CCB5C;
    v4 = config_saved_name_0;
    v8 = config_name_slot_count;
    do
    {
      *v3 = (int)v4;
      v4 += 27;
      ++v3;
      --v2;
    }
    while ( v2 );
  }
  dword_4CCB5C[v8] = (int)strdup_malloc(aAddNewNamedLis);
  if ( (byte_4CCCD8 & 2) == 0 )
  {
    byte_4CCC96 = 1;
    byte_4CCCD8 |= 2u;
    byte_4CCCA5 = 0;
    byte_4CCCA4 = 0;
    dword_4CCCA0 = 1065353216;
    dword_4CCC9C = 0;
    dword_4CCC90 = 0;
    byte_4CCC94 = 0;
    byte_4CCC95 = 0;
    dword_4CCC98 = 0;
    crt_atexit(nullsub_69);
  }
  dword_4CCC90 = (int)aAdd;
  if ( (byte_4CCCD8 & 4) == 0 )
  {
    byte_4CCB06 = 1;
    byte_4CCCD8 |= 4u;
    byte_4CCB15 = 0;
    byte_4CCB14 = 0;
    dword_4CCB10 = 1065353216;
    dword_4CCB0C = 0;
    dword_4CCB00 = 0;
    byte_4CCB04 = 0;
    byte_4CCB05 = 0;
    dword_4CCB08 = 0;
    crt_atexit(nullsub_68);
  }
  dword_4CCB00 = (int)aDelete_0;
  dword_4D0F34 = 174;
  if ( byte_4D1220 )
  {
    xy = *arg1;
    v10 = arg1[1] + 29.0;
    if ( (unsigned __int8)ui_text_input_update(&xy, &dword_4D0F28)
      || (xy = *arg1 + 180.0, v10 = arg1[1] + 22.0, ui_button_update(&xy, (int)&dword_4CCC90)) )
    {
      strcpy(&config_saved_name_0[27 * config_name_slot_count], &byte_4CCB18);
      config_name_slot_selected = config_name_slot_count++;
      if ( config_name_slot_count >= 8 )
      {
        strcpy(config_saved_name_1, &byte_4CCB18);
        --config_name_slot_count;
      }
      byte_4CCB18 = 0;
      dword_4D0F2C = 0;
      byte_4D1220 = 0;
      goto LABEL_20;
    }
  }
  else if ( !dword_4D121C )
  {
    if ( config_name_slot_selected )
    {
      xy = *arg1;
      v10 = arg1[1] + 22.0;
      if ( ui_button_update(&xy, (int)&dword_4CCB00) )
      {
        --config_name_slot_count;
        strcpy(&config_saved_name_0[27 * config_name_slot_selected], &config_saved_name_0[27 * config_name_slot_count]);
        config_name_slot_selected = 0;
LABEL_20:
        j_highscore_load_table();
      }
    }
  }
  if ( (byte_4CCCD8 & 8) == 0 )
  {
    byte_4D0EE8 = 1;
    byte_4CCCD8 |= 8u;
    dword_4D0F00 = 0;
    byte_4D0EFC = 0;
    dword_4D0EF0 = 0;
    dword_4D0EEC = 0;
    dword_4D0EF8 = 0;
    dword_4D0EF4 = 0;
    crt_atexit(nullsub_67);
  }
  dword_4D0EF4 = (int)dword_4CCB5C;
  dword_4D0EF8 = v8 + 1;
  byte_4D0EE8 = arg2;
  dword_4D0EF0 = config_name_slot_selected;
  v5 = ui_list_widget_update(arg1, &byte_4D0EE8);
  if ( v5 > -2
    && ((unsigned __int8)input_primary_just_pressed()
     || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)) )
  {
    v6 = 1 - dword_4D121C;
    dword_4D121C = 1 - dword_4D121C;
    if ( v5 >= 0 )
    {
      dword_4D0EF0 = v5;
      config_name_slot_selected = v5;
      if ( v5 != v8 )
      {
        j_highscore_load_table();
        v6 = dword_4D121C;
      }
      byte_4D1221 = 1;
      byte_4D1222 = 1;
    }
    byte_4D1220 = v5 == v8;
  }
  else
  {
    v6 = dword_4D121C;
  }
  dword_4D0EEC = v6;
  crt_free((void *)dword_4CCB5C[v8]);
  LOBYTE(result) = 0;
  return result;
}

// nullsub_67 @ 0x004447D0
void __cdecl nullsub_67()
{
  ;
}

// nullsub_68 @ 0x004447E0
void __cdecl nullsub_68()
{
  ;
}

// nullsub_69 @ 0x004447F0
void __cdecl nullsub_69()
{
  ;
}

// nullsub_70 @ 0x00444800
void __cdecl nullsub_70()
{
  ;
}

// creature_spawn_tinted @ 0x00444810
// spawns a creature with tint and default stats
int creature_spawn_tinted(float *pos, float *rgba, int type_id)
{
  int v3; // edi
  int v4; // esi
  int v5; // eax
  float *v6; // edx
  int v7; // eax
  double v8; // st7
  double v9; // st6
  int v10; // eax

  v3 = creature_alloc_slot();
  v4 = 38 * v3;
  *(float *)((char *)&creature_pos_x + v4 * 4) = *pos;
  creature_pos_y[v4] = pos[1];
  creature_pool[v4 * 4] = 1;
  creature_state_flag[v4 * 4] = 1;
  creature_vel_x[v4] = 0;
  creature_ai_mode[v4] = 2;
  creature_collision_flag[v4 * 4] = 0;
  creature_collision_timer[v4] = 0;
  *(int *)((char *)&creature_type_id + v4 * 4) = type_id;
  creature_force_target[v4 * 4] = 0;
  creature_hitbox_size[v4] = 1098907648;
  creature_health[v4] = 1065353216;
  creature_vel_y[v4] = 0;
  v5 = crt_rand();
  creature_move_speed[v4] = 1.7;
  creature_reward_value[v4] = 1.0;
  creature_attack_cooldown[v4] = 0.0;
  v6 = &creature_tint_r + 38 * v3;
  *(float *)(v4 * 4 + 4833124) = (double)(v5 % 314) * 0.0099999998;
  *v6 = *rgba;
  v6[1] = rgba[1];
  v6[2] = rgba[2];
  v6[3] = rgba[3];
  v7 = crt_rand();
  *(float *)((char *)&creature_contact_damage + v4 * 4) = 100.0;
  LODWORD(creature_max_health[v4]) = creature_health[v4];
  v8 = (double)(v7 % 20) + 47.0;
  *(float *)(v4 * 4 + 4833132) = v8;
  if ( type_id != 3 && type_id != 4 )
    return v3;
  v9 = creature_move_speed[38 * v3] * 1.2;
  v10 = creature_flags[38 * v3];
  LOBYTE(v10) = v10 | 0x80;
  creature_flags[38 * v3] = v10;
  creature_move_speed[38 * v3] = v9;
  *(&creature_size + 38 * v3) = v8 * 0.80000001;
  return v3;
}

// player_fire_weapon @ 0x00444980
// handles player firing: cooldowns, ammo, projectiles, and muzzle effects
void player_fire_weapon(char param_1, char param_2)
{
  int v2; // edx
  char v8; // bl
  int v19; // eax
  int v21; // edi
  int v22; // eax
  int v24; // esi
  int v26; // esi
  float *v28; // eax
  int v33; // eax
  float angle; // [esp+4h] [ebp-2Ch]
  float vel; // [esp+20h] [ebp-10h] BYREF
  float pos; // [esp+28h] [ebp-8h] BYREF
  int param_2b; // [esp+38h] [ebp+8h]
  int param_2c; // [esp+38h] [ebp+8h]
  char v62; // [esp+3Ch] [ebp+Ch]
  char v63; // [esp+3Ch] [ebp+Ch]
  int v64; // [esp+3Ch] [ebp+Ch]

  if ( !(unsigned __int8)game_is_full_version() )
    crt_exit(0);
  if ( !console_open_flag )
  {
    v2 = render_overlay_player_index;
    _ECX = 216 * render_overlay_player_index;
    __asm
    {
      fld     dword ptr [ecx+4908D4h]
      fcomp   ds:flt_46F228
      fld     frame_dt
      fnstsw  ax
    }
    if ( (_AX & 0x4100) != 0 )
    {
      __asm
      {
        fmul    ds:flt_46F2B4
        fsubr   dword ptr [ecx+4908C0h]
        fstp    dword ptr [ecx+4908C0h]
      }
      player_state_table[216 * render_overlay_player_index] = _ET1;
    }
    else
    {
      __asm
      {
        fadd    st, st
        fsubr   dword ptr [ecx+490BACh]
        fst     dword ptr [ecx+490BACh]
      }
      player_muzzle_flash_alpha[216 * render_overlay_player_index] = _ET1;
      __asm
      {
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
        player_muzzle_flash_alpha[_ECX] = 0;
      player_shot_cooldown[_ECX] = 0;
      player_move_dx[_ECX] = 0;
      player_move_dy[_ECX] = 0;
      player_spread_heat[_ECX] = 0;
      player_ammo[_ECX] = player_clip_size[_ECX];
      player_reload_timer[_ECX] = 0;
      if ( v62 )
      {
        player_start_reload();
        v2 = render_overlay_player_index;
      }
      v8 = 0;
      _ECX = 216 * v2;
      v63 = 0;
      player_aim_x[_ECX] = *(_DWORD *)param_1;
      player_aim_y[_ECX] = *(_DWORD *)(param_1 + 4);
      __asm
      {
        fld     dword ptr [ecx+4908C4h]
        fsub    dword ptr [ecx+490900h]
        fld     dword ptr [ecx+4908C8h]
        fsub    dword ptr [ecx+490904h]
        fxch    st(1)
        fpatan
        fsub    ds:flt_46F220
        fstp    dword ptr [ecx+490BB0h]
      }
      *(float *)(_ECX * 4 + 4787120) = _ET1;
      __asm
      {
        fld     dword ptr [ecx+490B84h]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 )
      {
        __asm
        {
          fld     dword ptr [ecx+490B80h]
          fcomp   ds:flt_46F228
          fnstsw  ax
        }
        if ( (_AX & 0x4000) != 0 )
        {
          v8 = 1;
          player_reload_active[864 * v2] = 0;
        }
      }
      __asm
      {
        fld     dword ptr [ecx+490B84h]
        fcomp   ds:flt_46F228
        fnstsw  ax
      }
      if ( (_AX & 0x4100) != 0 && player_experience[216 * v2] > 0 )
      {
        if ( perk_count_get(perk_id_regression_bullets) || perk_count_get(perk_id_ammunition_within) )
          v63 = 1;
        v2 = render_overlay_player_index;
      }
      if ( v8 || v63 )
      {
        v64 = player_aim_heading[216 * v2];
        if ( param_2 )
        {
          __asm
          {
            fld     [esp+1Ch+arg_8]
            fsub    ds:flt_46F220
          }
          __asm { fsub    ds:flt_46F530 }
          __asm
          {
            fld     st
            fcos
          }
          __asm
          {
            fmul    ds:flt_46F230
            fstp    [esp+1Ch+var_18]
            fsin
            fmul    ds:flt_46F230
            fstp    [esp+1Ch+var_14]
          }
          if ( (byte_4D7A94[124 * player_weapon_id[216 * v2]] & 1) != 0 )
          {
            crt_rand();
            crt_rand();
            v2 = render_overlay_player_index;
          }
          _ECX = 216 * v2;
          __asm
          {
            fld     dword ptr [ecx+490BACh]
            fcomp   ds:flt_46F224
            fnstsw  ax
          }
          if ( (_AX & 0x4100) == 0 )
            player_muzzle_flash_alpha[216 * v2] = 1065353216;
          _EDX = 31 * player_weapon_id[216 * v2];
          __asm
          {
            fld     flt_4D7A7C[edx*4]
            fadd    dword ptr [ecx+490BACh]
            fstp    dword ptr [ecx+490BACh]
          }
          *(float *)(_ECX * 4 + 4787116) = _ET1;
          sfx_play_panned(*(&flt_4D7A84 + 31 * player_weapon_id[_ECX]));
          v2 = render_overlay_player_index;
          _EAX = 864 * render_overlay_player_index;
          if ( player_weapon_id[216 * render_overlay_player_index] == 3 )
          {
            __asm
            {
              fld     [esp+20h+arg_8]
              fcos
            }
            __asm
            {
              fst     [esp+2Ch+param_2]
              fmul    ds:flt_46F524
              fstp    [esp+2Ch+vel]
              fld     [esp+2Ch+arg_8]
              fsin
              fst     dword ptr [esp+2Ch+param_1]
              fmul    ds:flt_46F524
              fstp    [esp+2Ch+var_C]
              fld     [esp+2Ch+var_14]
              fadd    dword ptr [eax+4908C8h]
              fld     [esp+2Ch+var_18]
              fadd    dword ptr [eax+4908C4h]
              fstp    [esp+2Ch+pos]
              fstp    [esp+2Ch+var_4]
            }
            v19 = fx_spawn_sprite(&pos, &vel, 1.0);
            __asm
            {
              fld     [esp+2Ch+param_2]
              fmul    ds:flt_46F360
            }
            __asm { fstp    [esp+34h+pos] }
            v19 *= 44;
            __asm { fld     dword ptr [esp+34h+param_1] }
            *(int *)((char *)sprite_effect_color_r + v19) = 1056964608;
            *(int *)((char *)sprite_effect_color_g + v19) = 1056964608;
            __asm { fmul    ds:flt_46F360 }
            *(int *)((char *)sprite_effect_color_b + v19) = 1056964608;
            *(int *)((char *)sprite_effect_color_a + v19) = 1048576000;
            __asm { fstp    [esp+34h+var_4] }
            __asm { fld     [esp+34h+var_14] }
            _EAX = &player_pos_x[216 * render_overlay_player_index];
            __asm
            {
              fadd    dword ptr [eax+4]
              fld     [esp+34h+var_18]
              fadd    dword ptr [eax]
            }
            __asm
            {
              fstp    [esp+38h+vel]
              fstp    [esp+38h+var_C]
            }
            v21 = 12;
            v22 = 11 * fx_spawn_sprite(&vel, &pos, 2.0);
            sprite_effect_color_r[v22] = 1056964608;
            sprite_effect_color_g[v22] = 1056964608;
            sprite_effect_color_b[v22] = 1056964608;
            sprite_effect_color_a[v22] = 1046764061;
            do
            {
              __asm { fld     [esp+24h+var_14] }
              _EAX = &player_pos_x[216 * render_overlay_player_index];
              __asm
              {
                fadd    dword ptr [eax+4]
                fld     [esp+28h+var_18]
                fadd    dword ptr [eax]
                fstp    [esp+28h+pos]
                fstp    [esp+28h+var_4]
              }
              param_2b = crt_rand() % 200 - 100;
              __asm
              {
                fild    [esp+2Ch+param_2]
                fmul    ds:flt_46F4F8
                fadd    [esp+2Ch+arg_8]
                fstp    [esp+2Ch+angle]; angle
              }
              v24 = projectile_spawn(&pos, angle, 3, -100) << 6;
              --v21;
              param_2c = crt_rand() % 100;
              __asm
              {
                fild    [esp+20h+param_2]
                fmul    ds:flt_46F300
                fadd    ds:flt_46F224
                fstp    dword ptr [esi+4926E4h]
              }
              *(float *)(v24 + 4794084) = _ET1;
            }
            while ( v21 );
            v2 = render_overlay_player_index;
          }
          v26 = perk_id_sharpshooter;
          if ( (int)*(&player_perk_counts + perk_id_sharpshooter) <= 0 )
          {
            __asm
            {
              fld     flt_473A40
              fmul    frame_dt
            }
            __asm { fmul    ds:flt_46F66C }
            _EAX = 864 * v2;
            __asm { fadd    dword ptr [eax+490B68h] }
            v28 = (float *)&player_spread_heat[216 * v2];
            __asm { fstp    dword ptr [eax] }
            *v28 = _ET1;
          }
          __asm { fld     flt_473A40 }
          __asm { fadd    st, st }
          _ECX = 864 * v2;
          __asm
          {
            fcom    dword ptr [ecx+490B68h]
            fnstsw  ax
          }
          if ( (_AX & 0x100) != 0 )
          {
            __asm { fstp    dword ptr [ecx+490B68h] }
            player_spread_heat[216 * v2] = _ET1;
          }
          else
          {
            __asm { fstp    st }
          }
          __asm
          {
            fld     flt_473A40
            fmul    dword ptr [ecx+490B68h]
          }
          v33 = perk_id_fastshot;
          __asm { fstp    dword ptr [ecx+490B68h] }
          player_spread_heat[216 * v2] = _ET1;
          if ( (int)*(&player_perk_counts + v33) > 0 )
          {
            __asm
            {
              fld     dword ptr [ecx+490B84h]
              fmul    ds:flt_46F4DC
              fstp    dword ptr [ecx+490B84h]
            }
            player_shot_cooldown[216 * v2] = _ET1;
          }
          if ( (int)*(&player_perk_counts + v26) > 0 )
          {
            __asm
            {
              fld     dword ptr [ecx+490B84h]
              fmul    ds:flt_46F4D8
              fstp    dword ptr [ecx+490B84h]
            }
            player_shot_cooldown[216 * v2] = _ET1;
          }
          __asm
          {
            fld     dword ptr [ecx+490B7Ch]
            fcomp   ds:flt_46F228
            fnstsw  ax
          }
          if ( (_AX & 0x4100) != 0 )
          {
            player_start_reload();
            v2 = render_overlay_player_index;
          }
        }
      }
      _ECX = 864 * v2;
      __asm
      {
        fld     dword ptr [ecx+490944h]
        fcomp   ds:flt_46F280
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
      {
        do
        {
          __asm
          {
            fld     dword ptr [ecx+490944h]
            fsub    ds:flt_46F280
            fst     dword ptr [ecx+490944h]
          }
          *((float *)&player_move_phase + 216 * v2) = _ET1;
          __asm
          {
            fcomp   ds:flt_46F280
            fnstsw  ax
          }
        }
        while ( (_AX & 0x4100) == 0 );
      }
      __asm
      {
        fld     dword ptr [ecx+4908E4h]
        fmul    ds:flt_46F24C
        fcom    dword ptr [ecx+4908C4h]
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
      {
        __asm { fst     dword ptr [ecx+4908C4h] }
        player_pos_x[216 * v2] = _ET1;
      }
      __asm
      {
        fild    terrain_texture_width
        fsub    st, st(1)
        fcom    dword ptr [ecx+4908C4h]
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
      {
        __asm { fstp    dword ptr [ecx+4908C4h] }
        player_pos_x[216 * v2] = _ET1;
      }
      else
      {
        __asm { fstp    st }
      }
      __asm
      {
        fcom    dword ptr [ecx+4908C8h]
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
      {
        __asm { fst     dword ptr [ecx+4908C8h] }
        player_pos_y[216 * v2] = _ET1;
      }
      __asm
      {
        fisubr  terrain_texture_height
        fcom    dword ptr [ecx+4908C8h]
        fnstsw  ax
      }
      if ( (_AX & 0x100) != 0 )
      {
        __asm { fstp    dword ptr [ecx+4908C8h] }
        player_pos_y[216 * v2] = _ET1;
      }
      else
      {
        __asm { fstp    st }
      }
      __asm
      {
        fld     dword ptr [ecx+490BACh]
        fcomp   ds:flt_46F2A4
        fnstsw  ax
      }
      if ( (_AX & 0x4100) == 0 )
        player_muzzle_flash_alpha[216 * v2] = 1061997773;
    }
  }
}

// sub_444F70 @ 0x00444F70
char *__cdecl sub_444F70(char a1)
{
  int v1; // esi
  char *result; // eax

  v1 = 52;
  if ( !a1 )
    v1 = 51;
  switch ( crt_rand() % v1 )
  {
    case 0:
      result = aLamb;
      break;
    case 1:
      result = aGun;
      break;
    case 2:
      result = aHead;
      break;
    case 3:
      result = aTail;
      break;
    case 4:
      result = aLeg;
      break;
    case 5:
      result = aNose;
      break;
    case 6:
      result = aRoad;
      break;
    case 7:
      result = aStab;
      break;
    case 8:
      result = aHigh;
      break;
    case 9:
      result = aLow;
      break;
    case 10:
      result = aHat;
      break;
    case 11:
      result = aPie;
      break;
    case 12:
      result = aHand;
      break;
    case 13:
      result = aJack;
      break;
    case 14:
      result = aCube;
      break;
    case 15:
      result = aIce;
      break;
    case 16:
      result = aCow;
      break;
    case 17:
      result = aKing;
      break;
    case 18:
      result = aLord;
      break;
    case 19:
      result = aMate;
      break;
    case 20:
      result = aMary;
      break;
    case 21:
      result = aDick;
      break;
    case 22:
      result = aBill;
      break;
    case 23:
      result = aCat;
      break;
    case 24:
      result = aHarry;
      break;
    case 25:
      result = aTom;
      break;
    case 26:
      result = aFly;
      break;
    case 27:
      result = aCall;
      break;
    case 28:
      result = aShot;
      break;
    case 29:
      result = aGate;
      break;
    case 30:
      result = aQuick;
      break;
    case 31:
      result = aBrown;
      break;
    case 32:
      result = aFox;
      break;
    case 33:
      result = aJumper;
      break;
    case 34:
      result = aOver;
      break;
    case 35:
      result = aLazy;
      break;
    case 36:
      result = aDog;
      break;
    case 37:
      result = aZeta;
      break;
    case 38:
      result = aUnique;
      break;
    case 40:
      result = aEarl;
      break;
    case 41:
      result = aSleep_0;
      break;
    case 42:
      result = aOnyx;
      break;
    case 43:
      result = aMill;
      break;
    case 44:
      result = aBlue;
      break;
    case 45:
      result = aBelow;
      break;
    case 46:
      result = aScape;
      break;
    case 47:
      result = aReap;
      break;
    case 48:
      result = aDamo;
      break;
    case 49:
      result = aBreak;
      break;
    case 50:
      result = aBoom;
      break;
    case 51:
      result = aThe;
      break;
    default:
      result = aNerd;
      break;
  }
  return result;
}

// FUN_004451b0 @ 0x004451B0
// [binja] void* sub_4451b0()
void *FUN_004451b0()
{
  int v0; // edi
  int v1; // ebx
  const char *v2; // ebp
  const char *v3; // edi
  int v4; // edx
  int v5; // esi
  unsigned int v6; // kr04_4
  char *v7; // edx
  int v9; // [esp-10h] [ebp-18h]
  char *v10; // [esp+0h] [ebp-8h]
  int v11; // [esp+4h] [ebp-4h]

  if ( !byte_4D7580 )
  {
    v9 = v0;
    j_highscore_load_table();
    v1 = 0;
    v2 = (const char *)&highscore_table;
    v11 = 0;
    v10 = byte_4D1228;
    do
    {
      v3 = byte_4D1228;
      v4 = 0;
      if ( (int)v10 <= (int)byte_4D1228 )
      {
LABEL_6:
        v5 = 0;
        v6 = strlen(v2) + 1;
        if ( (int)(v6 - 1) <= 0 )
        {
LABEL_10:
          v7 = v10;
          v10 += 32;
          ++v1;
          strcpy(v7, v2);
          v11 = v1;
          console_printf(&console_log_queue, aDUniqueS, v1, v2);
        }
        else
        {
          while ( crt_isalpha((void *)v2[v5], v9) || v2[v5] == 46 )
          {
            if ( ++v5 >= (int)(v6 - 1) )
              goto LABEL_10;
          }
        }
      }
      else
      {
        while ( strcmp(v2, v3) )
        {
          v1 = v11;
          ++v4;
          v3 += 32;
          if ( v4 >= v11 )
            goto LABEL_6;
        }
        v1 = v11;
      }
      v2 += 72;
    }
    while ( (int)v2 < (int)quest_selected_meta );
    dword_4D7584 = v1;
    byte_4D7580 = 1;
    if ( !v1 )
      crt_sprintf(byte_4D1228, aQuickbrownfox);
  }
  if ( dword_4D7584 <= 0 )
    return byte_4D1228;
  else
    return &byte_4D1228[32 * (crt_rand() % dword_4D7584)];
}

// FUN_00445310 @ 0x00445310
// [binja] int32_t sub_445310(char* arg1, int32_t arg2)
int FUN_00445310(char *arg1, int arg2)
{
  int v2; // edx
  const char *v3; // ebp
  char *v4; // edi
  int result; // eax

  v2 = 0;
  v3 = (const char *)&unk_4D152C;
  v4 = creature_pool;
  while ( 1 )
  {
    if ( *v4 )
    {
      if ( v2 != arg2 )
      {
        result = strcmp(v3, arg1);
        if ( !result )
          break;
      }
    }
    v4 += 152;
    ++v2;
    v3 += 64;
    if ( (int)v4 >= (int)byte_4AA338 )
    {
      LOBYTE(result) = 1;
      return result;
    }
  }
  LOBYTE(result) = 0;
  return result;
}

// creature_name_assign_random @ 0x00445380
// builds a randomized creature name string into DAT_004d152c for debug overlays
void creature_name_assign_random(int creature_id)
{
  char *v1; // ebx
  char *v2; // eax
  char *v3; // eax
  char *v4; // eax
  char *v5; // eax
  char *v7; // [esp-Ch] [ebp-20h]
  char *v8; // [esp-8h] [ebp-1Ch]
  char *v9; // [esp-8h] [ebp-1Ch]
  char *v10; // [esp-4h] [ebp-18h]
  char *v11; // [esp-4h] [ebp-18h]
  char *v12; // [esp-4h] [ebp-18h]
  int v13; // [esp+10h] [ebp-4h]

  v13 = 0;
  while ( 1 )
  {
    if ( highscore_score_xp > 120 )
    {
      if ( crt_rand() % 100 < 10 )
      {
        v1 = (char *)&unk_4D152C + 64 * creature_id;
        strcpy(v1, (const char *)FUN_004451b0());
        goto LABEL_19;
      }
      if ( highscore_score_xp > 120 && crt_rand() % 100 < 80 )
      {
        v1 = (char *)&unk_4D152C + 64 * creature_id;
        v10 = sub_444F70(0);
        v8 = sub_444F70(0);
        v7 = sub_444F70(0);
        v2 = sub_444F70(1);
        crt_sprintf(v1, "%s%s%s%s", v2, v7, v8, v10);
        goto LABEL_19;
      }
    }
    if ( highscore_score_xp > 80 && crt_rand() % 100 < 80 || highscore_score_xp > 60 && crt_rand() % 100 < 40 )
    {
      v1 = (char *)&unk_4D152C + 64 * creature_id;
      v11 = sub_444F70(0);
      v9 = sub_444F70(0);
      v3 = sub_444F70(1);
      crt_sprintf(v1, "%s%s%s", v3, v9, v11);
    }
    else if ( highscore_score_xp > 40 && crt_rand() % 100 < 80 || highscore_score_xp > 20 && crt_rand() % 100 < 40 )
    {
      v1 = (char *)&unk_4D152C + 64 * creature_id;
      v12 = sub_444F70(0);
      v4 = sub_444F70(1);
      crt_sprintf(v1, "%s%s", v4, v12);
    }
    else
    {
      v1 = (char *)&unk_4D152C + 64 * creature_id;
      v5 = sub_444F70(0);
      crt_sprintf(v1, "%s", v5);
    }
LABEL_19:
    if ( (unsigned __int8)FUN_00445310(v1, creature_id) )
    {
      if ( strlen(v1) <= 0xF )
        break;
      if ( v13++ >= 100 )
        break;
    }
  }
}

// creature_find_by_name @ 0x00445590
// returns the first creature index whose name matches DAT_004d152c, or -1
int creature_find_by_name(char *name)
{
  int result; // eax
  const char *v2; // ebp
  char *v3; // edi

  result = 0;
  v2 = (const char *)&unk_4D152C;
  v3 = creature_pool;
  while ( !*v3 || strcmp(v2, name) )
  {
    v3 += 152;
    ++result;
    v2 += 64;
    if ( (int)v3 >= (int)byte_4AA338 )
      return -1;
  }
  return result;
}

// creature_name_draw_labels @ 0x00445600
// debug overlay: draws creature name labels over world positions
void creature_name_draw_labels()
{
  char *v0; // edi
  float *v1; // esi
  int v2; // eax
  int v3; // [esp+28h] [ebp-40h]
  float v4; // [esp+28h] [ebp-40h]
  int v5; // [esp+2Ch] [ebp-3Ch]
  int v6; // [esp+30h] [ebp-38h]
  float v7; // [esp+40h] [ebp-28h]
  float v8; // [esp+48h] [ebp-20h]
  float v9; // [esp+4Ch] [ebp-1Ch]
  float v10[2]; // [esp+50h] [ebp-18h] BYREF
  _DWORD v11[3]; // [esp+58h] [ebp-10h] BYREF
  float v12; // [esp+64h] [ebp-4h]

  memset(v11, 0, sizeof(v11));
  v12 = 1.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v3,
    v5,
    v6);
  v0 = (char *)&unk_4D152C;
  v1 = (float *)creature_hitbox_size;
  do
  {
    if ( *((_BYTE *)v1 - 16) )
    {
      v2 = (*(int (__thiscall **)(int, char *))(*(_DWORD *)grim_interface_ptr + 332))(grim_interface_ptr, v0);
      if ( *v1 < 0.0 && (v7 = (*v1 + 10.0) * 0.1, v7 <= 1.0) )
      {
        if ( v7 < 0.0 )
          v7 = 0.0;
      }
      else
      {
        v7 = 1.0;
      }
      v8 = *(float *)&camera_offset_x + v1[1] - (double)v2 * 0.5;
      v9 = *(float *)&camera_offset_y + v1[2] - 50.0;
      v12 = v7 * 0.67000002;
      v10[0] = v8 - 4.0;
      v10[1] = v9;
      v4 = (float)(v2 + 8);
      (*(void (__thiscall **)(int, float *, _DWORD, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 208))(
        grim_interface_ptr,
        v10,
        LODWORD(v4),
        1097859072,
        v11);
      (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        COERCE_FLOAT(LODWORD(v7)));
      (*(void (__thiscall **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
        grim_interface_ptr,
        LODWORD(v8),
        LODWORD(v9),
        v0);
    }
    v1 += 38;
    v0 += 64;
  }
  while ( (int)v1 < (int)&flt_4AA348 );
}

// survival_gameplay_update_and_render @ 0x004457C0
// survival mode frame loop: effects, spawns, death handling, world render, HUD, and debug name input
void survival_gameplay_update_and_render()
{
  int *v0; // ecx
  double v1; // st7
  int v2; // edx
  int v3; // edi
  int v4; // eax
  int v5; // eax
  int v6; // eax
  int v7; // eax
  int v8; // ecx
  int v9; // eax
  double v10; // st7
  int v11; // edx
  int v12; // esi
  int v13; // eax
  int v14; // ecx
  double v15; // st7
  int v16; // eax
  int v17; // eax
  int *v18; // eax
  int v19; // ecx
  float v20; // esi
  int v21; // edi
  int v22; // [esp+B0h] [ebp-48h]
  float v23; // [esp+B0h] [ebp-48h]
  int v24; // [esp+B0h] [ebp-48h]
  int v25; // [esp+B0h] [ebp-48h]
  float v26; // [esp+B0h] [ebp-48h]
  int v27; // [esp+B4h] [ebp-44h]
  int v28; // [esp+B4h] [ebp-44h]
  int v29; // [esp+B4h] [ebp-44h]
  int v30; // [esp+B8h] [ebp-40h]
  int v31; // [esp+B8h] [ebp-40h]
  int v32; // [esp+B8h] [ebp-40h]
  char param_2[4]; // [esp+C8h] [ebp-30h] BYREF
  float v34; // [esp+CCh] [ebp-2Ch]
  int v35; // [esp+D0h] [ebp-28h]
  float v36; // [esp+D4h] [ebp-24h]
  float pos[3]; // [esp+D8h] [ebp-20h] BYREF
  float v38; // [esp+E4h] [ebp-14h]
  float rgba; // [esp+E8h] [ebp-10h] BYREF
  float v40; // [esp+ECh] [ebp-Ch]
  float v41; // [esp+F0h] [ebp-8h]
  int v42; // [esp+F4h] [ebp-4h]

  param_2[0] = 0;
  LOBYTE(v35) = 0;
  if ( (byte_4D1528 & 1) == 0 )
  {
    flt_4D7570 = *(float *)player_pos_x + 128.0;
    flt_4D7574 = *(float *)player_pos_y;
    byte_4D1528 |= 1u;
    crt_atexit(nullsub_71);
  }
  if ( byte_478C94 )
  {
    dword_4D7588 = 0;
    byte_4D14A8[0] = 0;
    byte_478C94 = 0;
  }
  v0 = (int *)grim_interface_ptr;
  v1 = (double)config_screen_height - 128.0;
  byte_4D14A9[dword_4D7588] = 0;
  v2 = *v0;
  v38 = v1;
  if ( (*(unsigned __int8 (__thiscall **)(int *, int))(v2 + 68))(v0, 28) && dword_4D7588 > 0 )
  {
    sfx_play(sfx_ui_typeenter);
    v3 = dword_4D7578 + 1;
    byte_4D14A8[dword_4D7588] = 0;
    dword_4D7578 = v3;
    v4 = creature_find_by_name(byte_4D14A8);
    if ( v4 == -1 )
    {
      if ( !strcmp(aReload_0, byte_4D14A8) )
        LOBYTE(v35) = 1;
    }
    else
    {
      param_2[0] = 1;
      v5 = 19 * v4;
      flt_4D7570 = *(&creature_pos_x + 2 * v5);
      flt_4D7574 = creature_pos_y[2 * v5];
      ++dword_4D757C;
    }
    dword_4D7588 = 0;
    byte_4D14A8[0] = 0;
  }
  v6 = console_input_poll();
  if ( v6 && v6 != 13 )
  {
    if ( v6 == 8 )
    {
      v7 = crt_rand() % 2;
      sfx_play(sfx_ui_typeclick_01 + v7);
      if ( dword_4D7588 <= 0 )
        byte_4D14A8[0] = 0;
      else
        byte_4D14A8[--dword_4D7588] = 0;
    }
    else
    {
      v8 = dword_4D7588;
      if ( dword_4D7588 < 17 )
      {
        byte_4D14A8[dword_4D7588] = v6;
        dword_4D7588 = ++v8;
      }
      byte_4D14A8[v8] = 0;
      v9 = crt_rand() % 2;
      sfx_play(sfx_ui_typeclick_01 + v9);
    }
  }
  perks_update_effects();
  v36 = frame_dt;
  if ( time_scale_active )
  {
    v10 = frame_dt * 0.30000001;
    time_scale_factor = 1050253722;
    frame_dt = v10;
    frame_dt_ms = (__int64)(v10 * 1000.0);
  }
  effects_update();
  if ( game_state_id == 18 && (creature_update_all(), projectile_update(), game_state_id == 18) )
  {
    v11 = config_player_count;
    for ( render_overlay_player_index = 0; render_overlay_player_index < config_player_count; ++render_overlay_player_index )
    {
      player_fire_weapon((char)&flt_4D7570, param_2[0]);
      v11 = config_player_count;
    }
  }
  else
  {
    v11 = config_player_count;
  }
  v12 = 3;
  v13 = frame_dt_ms;
  render_overlay_player_index = 0;
  player_weapon_id[0] = 3;
  player_ammo[0] = 1106247680;
  if ( console_open_flag )
  {
    v14 = survival_spawn_cooldown;
  }
  else
  {
    v14 = survival_spawn_cooldown - frame_dt_ms * v11;
    survival_spawn_cooldown = v14;
  }
  if ( v14 < 0 )
  {
    do
    {
      survival_spawn_cooldown = 3500 - survival_elapsed_ms / 800 + v14;
      if ( survival_spawn_cooldown < 100 )
        survival_spawn_cooldown = 100;
      v42 = 1065353216;
      v35 = survival_elapsed_ms + 1;
      v15 = (double)(survival_elapsed_ms + 1);
      rgba = v15 * 0.0000083333334 + 0.30000001;
      v40 = v15 * 10000.0 + 0.30000001;
      v41 = sin(v15 * 0.0001) + 0.30000001;
      if ( rgba >= 0.0 )
      {
        if ( rgba > 1.0 )
          rgba = 1.0;
      }
      else
      {
        rgba = 0.0;
      }
      if ( v40 >= 0.0 )
      {
        if ( v40 > 1.0 )
          v40 = 1.0;
      }
      else
      {
        v40 = 0.0;
      }
      if ( v41 >= 0.0 )
      {
        if ( v41 > 1.0 )
          v41 = 1.0;
      }
      else
      {
        v41 = 0.0;
      }
      ++dword_4D758C;
      *(float *)param_2 = (double)terrain_texture_width + 64.0;
      v34 = cos((double)survival_elapsed_ms * 0.001) * 256.0 + (double)terrain_texture_height * 0.5;
      v16 = creature_spawn_tinted((float *)param_2, &rgba, 4);
      creature_name_assign_random(v16);
      pos[0] = -64.0;
      pos[1] = cos((double)survival_elapsed_ms * 0.001) * 256.0 + (double)terrain_texture_height * 0.5;
      v17 = creature_spawn_tinted(pos, &rgba, 2);
      creature_name_assign_random(v17);
      v14 = survival_spawn_cooldown;
    }
    while ( survival_spawn_cooldown < 0 );
    v12 = player_weapon_id[0];
    v13 = frame_dt_ms;
  }
  highscore_score_xp = player_experience[0];
  if ( !console_open_flag )
  {
    bonus_weapon_power_up_timer = 0;
    bonus_reflex_boost_timer = 0.0;
    time_scale_active = 0;
    survival_elapsed_ms += v13;
    dword_48708C[v12] += v13;
  }
  camera_update();
  gameplay_render_world();
  creature_name_draw_labels();
  v18 = bonus_pool;
  do
  {
    *v18 = 0;
    v18 += 7;
  }
  while ( (int)v18 < (int)&quest_spawn_count );
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  if ( !demo_mode_active
    && *(float *)player_health <= 0.0
    && player_state_table[0] < 0.0
    && (config_player_count == 1 || player2_health[0] <= 0.0 && player2_death_timer < 0.0) )
  {
    render_pass_mode = 0;
    game_state_pending = 7;
    ui_transition_direction = 0;
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
    console_input_poll();
    sfx_mute_all(music_track_extra_0);
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_play_exclusive(music_track_shortie_monk_id);
  }
  frame_dt = v36;
  frame_dt_ms = (__int64)(v36 * 1000.0);
  perk_prompt_update_and_render();
  hud_update_and_render();
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v22,
    v27,
    v30);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7C4, 0);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  v23 = v38 - 16.0;
  (*(void (__stdcall **)(int, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    -1082130432,
    LODWORD(v23),
    1127612416,
    1112801280);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v24,
    v28,
    v31);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v25,
    v29,
    v32);
  v19 = *(_DWORD *)grim_interface_ptr;
  v38 = v38 + 1.0;
  v20 = v38;
  (*(void (**)(int, int, float, char *, ...))(v19 + 328))(
    grim_interface_ptr,
    1086324736,
    COERCE_FLOAT(LODWORD(v38)),
    aS_1,
    byte_4D14A8);
  v36 = 1.0;
  if ( sin(flt_47EA4C * 4.0) > 0.0 )
    v36 = 0.40000001;
  (*(void (__thiscall **)(int, int, int, int, float))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    COERCE_FLOAT(LODWORD(v36)));
  v21 = *(_DWORD *)grim_interface_ptr;
  v36 = COERCE_FLOAT(
          (*(int (__thiscall **)(int, char *, float, char *))(*(_DWORD *)grim_interface_ptr + 332))(
            grim_interface_ptr,
            byte_4D14A8,
            COERCE_FLOAT(LODWORD(v20)),
            asc_4712B8));
  v26 = (double)SLODWORD(v36) + 14.0;
  (*(void (__cdecl **)(int, _DWORD))(v21 + 328))(grim_interface_ptr, LODWORD(v26));
  highscore_record_shots_hit = dword_4D757C;
  highscore_record_shots_fired = dword_4D7578;
  ui_elements_update_and_render();
}

// nullsub_71 @ 0x00445FF0
void __cdecl nullsub_71()
{
  ;
}

// input_any_key_pressed @ 0x00446000
// returns true if any key is down (scans keycodes 2..0x17e)
int input_any_key_pressed()
{
  int v0; // esi
  int result; // eax

  v0 = 2;
  while ( 1 )
  {
    result = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(grim_interface_ptr, v0);
    if ( (_BYTE)result )
      break;
    if ( ++v0 >= 383 )
      return result;
  }
  LOBYTE(result) = 1;
  return result;
}

// input_primary_just_pressed @ 0x00446030
// edge-detect primary action (mouse button 0 or per-player fire key DAT_00490bec)
int input_primary_just_pressed()
{
  int *v0; // esi
  int result; // eax
  bool v2; // bl
  int *v3; // esi

  if ( !console_open_flag )
  {
    if ( input_primary_latch )
    {
      v2 = (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 88))(grim_interface_ptr, 0) == 0;
      v3 = &player_fire_key;
      do
      {
        result = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(grim_interface_ptr, *v3);
        if ( (_BYTE)result )
          v2 = 0;
        v3 += 216;
      }
      while ( (int)v3 < (int)&dword_4912AC );
      if ( v2 )
        input_primary_latch = 0;
    }
    else
    {
      input_primary_latch = (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 88))(
                              grim_interface_ptr,
                              0) != 0;
      v0 = &player_fire_key;
      do
      {
        result = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(grim_interface_ptr, *v0);
        if ( (_BYTE)result )
          input_primary_latch = 1;
        v0 += 216;
      }
      while ( (int)v0 < (int)&dword_4912AC );
      if ( input_primary_latch )
      {
        LOBYTE(result) = 1;
        return result;
      }
    }
  }
  LOBYTE(result) = 0;
  return result;
}

// input_primary_is_down @ 0x004460F0
// returns true while primary action is held (mouse button 0 or primary fire keys)
int input_primary_is_down()
{
  return (*(unsigned __int8 (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 88))(grim_interface_ptr, 0)
      || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           player_fire_key)
      || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
           grim_interface_ptr,
           player_alt_fire_key);
}

// nullsub_72 @ 0x00446140
void nullsub_72()
{
  ;
}

// sub_446150 @ 0x00446150
int __cdecl sub_446150(int a1)
{
  int result; // eax
  int *v2; // ecx

  result = 0;
  v2 = &ui_element_table_end;
  while ( a1 != *v2 )
  {
    ++v2;
    ++result;
    if ( (int)v2 >= (int)byte_48F20C )
      return -1;
  }
  return result;
}

// ui_elements_reset_state @ 0x00446170
// clears active flags and hover timers on all UI elements
void ui_elements_reset_state()
{
  int *v0; // eax
  _BYTE *v1; // edx

  v0 = ui_element_table_end;
  do
  {
    v1 = (_BYTE *)*v0++;
    *v1 = 0;
    *(_DWORD *)(*(v0 - 1) + 760) = 0;
  }
  while ( (int)v0 < (int)byte_48F20C );
}

// ui_elements_max_timeline @ 0x00446190
// returns max timeline value (element +0x10) among active UI elements
int ui_elements_max_timeline()
{
  int result; // eax
  int *v1; // edx

  result = 0;
  v1 = ui_element_table_end;
  do
  {
    if ( *(_BYTE *)*v1 )
    {
      if ( result < *(_DWORD *)(*v1 + 16) )
        result = *(_DWORD *)(*v1 + 16);
    }
    ++v1;
  }
  while ( (int)v1 < (int)byte_48F20C );
  return result;
}

// game_state_set @ 0x004461C0
// resets UI state, updates game_state_prev/id, and seeds UI elements for the new state
void game_state_set(int state_id)
{
  int v2; // edi
  int i; // esi
  int v4; // edx
  int v5; // edx
  int v6; // eax
  int v7; // eax
  float v8; // edx
  int v9; // edx
  int v10; // edx
  int v11; // eax
  int v12; // [esp-8h] [ebp-68h]
  int v13; // [esp-4h] [ebp-64h]
  float v14; // [esp+14h] [ebp-4Ch]
  float v15; // [esp+24h] [ebp-3Ch]
  float v16; // [esp+34h] [ebp-2Ch]
  float v17; // [esp+44h] [ebp-1Ch]
  _BYTE v18[16]; // [esp+50h] [ebp-10h] BYREF
  int state_ida; // [esp+64h] [ebp+4h]

  ui_elements_reset_state();
  v2 = 0;
  game_paused_flag = 0;
  game_state_prev = game_state_id;
  game_state_id = state_id;
  dword_487238 = 0;
  byte_487241 = 0;
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
  console_input_poll();
  switch ( state_id )
  {
    case 0:
      byte_48724D = 0;
      render_pass_mode = 0;
      ui_sign_crimson = 1;
      if ( (unsigned __int8)game_is_full_version() && mods_any_available() )
        byte_488208 = 1;
      if ( (unsigned __int8)game_is_full_version() )
        dword_48823C = (int)sub_447350;
      else
        byte_488208 = 1;
      state_ida = 0;
      for ( i = 2; i <= 7; ++i )
      {
        if ( i == 2 && (unsigned __int8)game_is_full_version() )
        {
          v2 = 4;
          state_ida = 4;
        }
        if ( *(_BYTE *)(*(int (__thiscall **)(int, _BYTE *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                         grim_interface_ptr,
                         v18,
                         100) )
        {
          *(_DWORD *)(ui_element_table_end[i] + 516) = dword_48F7F4;
          v9 = ui_element_table_end[i];
          *(_DWORD *)(v9 + 312) = 0;
          v16 = (double)state_ida * 0.125;
          *(float *)(v9 + 316) = v16;
          v10 = ui_element_table_end[i];
          *(_DWORD *)(v10 + 340) = 1065353216;
          *(float *)(v10 + 344) = v16;
          v11 = ui_element_table_end[i];
          *(_DWORD *)(v11 + 368) = 1065353216;
          v17 = (double)(v2 + 1) * 0.125;
          *(float *)(v11 + 372) = v17;
          v7 = ui_element_table_end[i];
          v8 = v17;
          *(_DWORD *)(v7 + 396) = 0;
        }
        else
        {
          if ( i == 6 )
          {
            v2 = 6;
            state_ida = 6;
          }
          *(_DWORD *)(ui_element_table_end[i] + 516) = dword_48F7F4;
          v4 = ui_element_table_end[i];
          *(_DWORD *)(v4 + 312) = 0;
          v14 = (double)state_ida * 0.125;
          *(float *)(v4 + 316) = v14;
          v5 = ui_element_table_end[i];
          *(_DWORD *)(v5 + 340) = 1065353216;
          *(float *)(v5 + 344) = v14;
          v6 = ui_element_table_end[i];
          *(_DWORD *)(v6 + 368) = 1065353216;
          v15 = (double)(v2 + 1) * 0.125;
          *(float *)(v6 + 372) = v15;
          v7 = ui_element_table_end[i];
          v8 = v15;
          *(_DWORD *)(v7 + 396) = 0;
        }
        *(float *)(v7 + 400) = v8;
        if ( i == 2 && (unsigned __int8)game_is_full_version() )
          v2 = 0;
        state_ida = ++v2;
        if ( v2 == 4 )
        {
          v2 = 5;
          state_ida = 5;
        }
      }
      if ( !(unsigned __int8)game_is_full_version() )
        byte_488208 = 1;
      byte_4878C0 = 1;
      byte_487BD8 = 1;
      byte_487EF0 = 1;
      byte_488520 = *(_BYTE *)(*(int (__thiscall **)(int, _BYTE *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                                grim_interface_ptr,
                                v18,
                                100) != 0;
      byte_488838 = 1;
      break;
    case 22:
      render_pass_mode = 0;
      ui_sign_crimson_update_disabled = 0;
      break;
    case 9:
      byte_48EB38 = 1;
      byte_48702C = 0;
      if ( !render_pass_mode )
      {
        byte_48724D = 0;
        gameplay_reset_state();
        switch ( config_game_mode )
        {
          case 3:
            v13 = quest_stage_minor;
            v12 = *(_DWORD *)quest_stage_major;
            ++quest_play_counts[10 * *(_DWORD *)quest_stage_major + quest_stage_minor];
            quest_start_selected(v12, v13);
            render_pass_mode = 1;
            byte_487241 = 1;
            break;
          case 2:
            render_pass_mode = 1;
            byte_487241 = 1;
            ++dword_485788;
            break;
          case 1:
            render_pass_mode = 1;
            byte_487241 = 1;
            ++dword_485784;
            break;
          default:
            render_pass_mode = 1;
            byte_487241 = 1;
            if ( config_game_mode == 4 )
              ++dword_48578C;
            else
              ++dword_485790;
            break;
        }
      }
      break;
    case 18:
      config_player_count = 1;
      byte_478C94 = 1;
      byte_48EB38 = 1;
      byte_48702C = 0;
      if ( !render_pass_mode )
      {
        byte_48724D = 0;
        gameplay_reset_state();
        render_pass_mode = 1;
        byte_487241 = 1;
      }
      break;
    case 1:
      ui_sign_crimson = 1;
      byte_489498 = 1;
      byte_4897B0 = 1;
      break;
    case 2:
      if ( !byte_4824D1 )
        ui_sign_crimson = 1;
      byte_488B50 = 1;
      dword_48CF78 = -1033371648;
      byte_488E68 = 1;
      dword_487234 = 0;
      *(float *)&dword_48CF7C = (double)*(int *)config_screen_width * 0.0015625 * 150.0 + 10.0 - 150.0 + 135.0;
      break;
    case 4:
      byte_48724D = 0;
      ui_sign_crimson = 1;
      byte_48E820 = 1;
      dword_48E858 = (int)sub_43F550;
      break;
    case 13:
      ui_sign_crimson = 1;
      byte_489DE0 = 1;
      dword_489E18 = (int)nullsub_72;
LABEL_56:
      j_highscore_load_table();
      break;
    case 3:
      ui_sign_crimson = 1;
      dword_48CF78 = -1020002304;
      byte_48D278 = 1;
      byte_48D590 = 1;
      byte_48EE50 = 1;
      *(float *)&dword_48CF7C = (double)*(int *)config_screen_width * 0.0015625 * 150.0 - 150.0 + 139.0;
      break;
    case 14:
      ui_sign_crimson = 1;
      byte_489DE0 = 1;
      byte_48A0F8 = 1;
      dword_489E18 = (int)sub_4423D0;
      goto LABEL_56;
  }
  dword_48A130 = 0;
  switch ( state_id )
  {
    case 19:
      ui_sign_crimson = 1;
      byte_489DE0 = 1;
      break;
    case 26:
      ui_sign_crimson = 1;
      byte_489DE0 = 1;
      dword_489E18 = (int)credits_secret_alien_zookeeper_update;
      break;
    case 20:
      ui_sign_crimson = 1;
      byte_489DE0 = 1;
      dword_489E18 = (int)sub_40E9A0;
      break;
    case 15:
      ui_sign_crimson = 1;
      byte_489DE0 = 1;
      byte_48A0F8 = 1;
      dword_489E18 = (int)sub_440110;
      break;
    case 16:
      ui_sign_crimson = 1;
      byte_489DE0 = 1;
      byte_48A0F8 = 1;
      dword_489E18 = (int)sub_440960;
      break;
    case 17:
      dword_487234 = 0;
      ui_sign_crimson = 1;
      byte_489DE0 = 1;
      dword_489E18 = (int)credits_screen_update;
      break;
    case 11:
      ui_sign_crimson = 1;
      byte_48E1F0 = 1;
      break;
    case 5:
      if ( !byte_4824D1 )
        ui_sign_crimson = 1;
      ui_sign_crimson_update_disabled = 0;
      byte_48B9B8 = 1;
      byte_48BCD0 = 1;
      byte_48BFE8 = 1;
      break;
    default:
      switch ( state_id )
      {
        case 6:
          byte_48C618 = 1;
          goto LABEL_86;
        case 8:
          byte_48DBC0 = 1;
          game_save_status();
          dword_487234 = -2;
          goto LABEL_86;
        case 21:
          byte_48DBC0 = 1;
          break;
        case 12:
          byte_48DBC0 = 1;
          break;
        case 7:
          byte_48CC48 = 1;
          dword_487260 = 0;
          break;
        default:
          goto LABEL_86;
      }
      dword_487234 = -1;
      break;
  }
LABEL_86:
  if ( byte_48724D )
    ui_sign_crimson = 0;
  ui_elements_timeline = 0;
  ui_transition_direction = 1;
}

// ui_element_update @ 0x00446900
// updates hover/click/animation for a UI element and fires callbacks
void __cdecl sub_446900(int a1)
{
  char v2; // al
  int *v3; // ecx
  int v4; // eax
  char v5; // cl
  int v6; // ecx
  int v7; // eax
  int v8; // edx
  int v9; // eax
  double v10; // st7
  double v11; // st6
  char v12; // al
  double v13; // st7
  long double v14; // st7
  long double v15; // st6
  float v16; // [esp+18h] [ebp+4h]

  if ( !*(_BYTE *)(a1 + 2) && *(_BYTE *)a1 )
  {
    if ( ui_mouse_x <= (double)*(float *)(a1 + 32)
      || ui_mouse_y <= (double)*(float *)(a1 + 36)
      || ui_mouse_x >= (double)*(float *)(a1 + 40)
      || ui_mouse_y >= (double)*(float *)(a1 + 44)
      || ui_mouse_blocked
      || byte_4871CA )
    {
      *(_BYTE *)(a1 + 756) = 0;
    }
    else
    {
      v2 = *(_BYTE *)(a1 + 1);
      *(_BYTE *)(a1 + 756) = 1;
      if ( v2 && *(_DWORD *)(a1 + 52) )
      {
        dword_48723C = a1;
        dword_487238 = 0;
        v3 = ui_element_table_end;
        do
        {
          v4 = *v3;
          if ( *(_BYTE *)(*v3 + 1) && (game_state_id || *(_DWORD *)(v4 + 52)) )
          {
            if ( a1 == v4 )
              break;
            ++dword_487238;
          }
          ++v3;
        }
        while ( (int)v3 < (int)byte_48F20C );
      }
    }
    *(_DWORD *)(a1 + 764) += frame_dt_ms;
    v5 = *(_BYTE *)(a1 + 756);
    if ( v5 )
      *(_DWORD *)(a1 + 760) += 6 * frame_dt_ms;
    else
      *(_DWORD *)(a1 + 760) += -2 * frame_dt_ms;
    if ( *(int *)(a1 + 760) < 0 )
      *(_DWORD *)(a1 + 760) = 0;
    if ( *(int *)(a1 + 760) > 1000 )
      *(_DWORD *)(a1 + 760) = 1000;
    if ( *(_DWORD *)(a1 + 52) && *(int *)(a1 + 764) >= 255 && v5 && input_primary_just_pressed() )
    {
      sfx_play(sfx_ui_buttonclick, 1.0);
      (*(void (**)(void))(a1 + 52))();
    }
    v6 = *(_DWORD *)(a1 + 16);
    if ( ui_elements_timeline < v6 )
    {
      v8 = *(_DWORD *)(a1 + 20);
      if ( ui_elements_timeline < v8 )
      {
        v12 = *(_BYTE *)(a1 + 788);
        v16 = 1.5707964;
        v13 = *(float *)(a1 + 60) - *(float *)(a1 + 88);
        *(_DWORD *)(a1 + 12) = 0;
        if ( v12 )
          *(float *)(a1 + 8) = fabs(v13);
        else
          *(float *)(a1 + 8) = -fabs(v13);
      }
      else
      {
        v9 = ui_elements_timeline - v8;
        *(_DWORD *)(a1 + 12) = 0;
        v10 = (double)(v6 - v8);
        v16 = 1.5707964 - (double)v9 * 1.5707964 / v10;
        if ( *(_BYTE *)(a1 + 788) )
          v11 = (1.0 - ((double)ui_elements_timeline - (double)v8) / v10)
              * fabs(*(float *)(a1 + 60) - *(float *)(a1 + 88));
        else
          v11 = -((1.0 - ((double)ui_elements_timeline - (double)v8) / v10)
                * fabs(*(float *)(a1 + 60) - *(float *)(a1 + 88)));
        *(float *)(a1 + 8) = v11;
      }
    }
    else
    {
      if ( !*(_BYTE *)(a1 + 1) )
      {
        sfx_play(sfx_ui_panelclick, 1.0);
        *(_BYTE *)(a1 + 1) = 1;
      }
      v7 = *(_DWORD *)(a1 + 764);
      if ( v7 <= 255 )
        *(_DWORD *)(a1 + 764) = frame_dt_ms + v7;
      *(_DWORD *)(a1 + 8) = 0;
      v16 = 0.0;
      *(_DWORD *)(a1 + 12) = 0;
    }
    if ( !sub_446150(a1) )
      v16 = -COERCE_FLOAT(LODWORD(v16) & 0x7FFFFFFF);
    if ( ui_elements_timeline < *(_DWORD *)(a1 + 16) )
    {
      if ( *(_BYTE *)(a1 + 1) )
        *(_BYTE *)(a1 + 1) = 0;
    }
    v14 = cos(v16);
    *(float *)(a1 + 772) = v14;
    v15 = sin(v16);
    *(float *)(a1 + 776) = -v15;
    *(float *)(a1 + 780) = v15;
    *(float *)(a1 + 784) = v14;
  }
}

// ui_element_render @ 0x00446C40
// updates focus/click handling and renders a UI element
void __cdecl sub_446C40(int a1)
{
  int v1; // esi
  bool v2; // bl
  void (*v3)(void); // eax
  _BYTE *v4; // eax
  int v5; // ecx
  int v6; // edi
  int v7; // ebx
  int v8; // eax
  int v9; // eax
  double v10; // st7
  double v11; // st7
  double v12; // st7
  int v13; // eax
  int v14; // ecx
  int v15; // edi
  char v16; // al
  int v17; // eax
  void (*v18)(void); // esi
  int v19; // [esp+F4h] [ebp-38h]
  int v20; // [esp+F4h] [ebp-38h]
  int v21; // [esp+F4h] [ebp-38h]
  int v22; // [esp+F4h] [ebp-38h]
  int v23; // [esp+F4h] [ebp-38h]
  int v24; // [esp+F4h] [ebp-38h]
  int v25; // [esp+F4h] [ebp-38h]
  int v26; // [esp+F8h] [ebp-34h]
  int v27; // [esp+F8h] [ebp-34h]
  int v28; // [esp+F8h] [ebp-34h]
  int v29; // [esp+F8h] [ebp-34h]
  int v30; // [esp+F8h] [ebp-34h]
  int v31; // [esp+F8h] [ebp-34h]
  int v32; // [esp+F8h] [ebp-34h]
  int v33; // [esp+FCh] [ebp-30h]
  int v34; // [esp+FCh] [ebp-30h]
  int v35; // [esp+FCh] [ebp-30h]
  int v36; // [esp+FCh] [ebp-30h]
  int v37; // [esp+FCh] [ebp-30h]
  int v38; // [esp+FCh] [ebp-30h]
  int v39; // [esp+FCh] [ebp-30h]
  float v40; // [esp+10Ch] [ebp-20h] BYREF
  float v41; // [esp+110h] [ebp-1Ch]
  float v42; // [esp+118h] [ebp-14h]
  _DWORD v43[4]; // [esp+11Ch] [ebp-10h] BYREF

  v1 = a1;
  v2 = 0;
  if ( !*(_BYTE *)a1 )
    return;
  if ( *(float *)(a1 + 768) == 0.0 && *(float *)(cv_uiPointFilterPanels + 12) != 0.0 )
    (*(void (__thiscall **)(int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(grim_interface_ptr, 21, 1);
  if ( *(_DWORD *)(v1 + 52) )
  {
    if ( (int *)v1 != byte_48F20C )
    {
      v2 = ui_focus_update(v1);
      if ( v2 )
      {
        if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28) )
        {
          if ( !console_open_flag )
          {
            if ( *(_BYTE *)(v1 + 1) )
            {
              v3 = *(void (**)(void))(v1 + 52);
              if ( v3 )
                v3();
            }
          }
        }
      }
    }
  }
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  if ( *(_DWORD *)(v1 + 516) != -1 )
  {
    if ( v2 && dword_4D11EC > 0 )
      *(_DWORD *)(v1 + 760) = dword_4D11EC;
    if ( *(_DWORD *)(v1 + 52) )
    {
      v6 = v1 + 311;
      v7 = 4;
      do
      {
        v6 += 28;
        --v7;
        *(_BYTE *)(v6 - 28) = 155 * *(_DWORD *)(v1 + 760) / 1000 + 100;
      }
      while ( v7 );
    }
    else
    {
      v4 = (_BYTE *)(v1 + 311);
      v5 = 4;
      do
      {
        *v4 = -56;
        v4 += 28;
        --v5;
      }
      while ( v5 );
    }
  }
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    v19,
    v26,
    v33);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    v20,
    v27,
    v34);
  v8 = *(_DWORD *)(v1 + 284);
  if ( v8 != -1 )
  {
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, v8, 0);
    v9 = *(_DWORD *)(v1 + 4);
    a1 = 1145324612;
    if ( !v9 )
    {
      if ( config_fx_detail_flag0 )
      {
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          19,
          1,
          v21,
          v28,
          v35);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
        v40 = *(float *)(v1 + 24) + 7.0;
        v41 = *(float *)(v1 + 28) + 7.0;
        (*(void (__thiscall **)(int, int, int, float *, int, int *))(*(_DWORD *)grim_interface_ptr + 308))(
          grim_interface_ptr,
          v1 + 60,
          4,
          &v40,
          v1 + 772,
          &a1);
        if ( *(_DWORD *)(v1 + 288) == 8 )
        {
          v40 = *(float *)(v1 + 24) + 7.0;
          v41 = *(float *)(v1 + 28) + 7.0;
          (*(void (__thiscall **)(int, int, int, float *, int, int *))(*(_DWORD *)grim_interface_ptr + 308))(
            grim_interface_ptr,
            v1 + 116,
            4,
            &v40,
            v1 + 772,
            &a1);
          v40 = *(float *)(v1 + 24) + 7.0;
          v41 = *(float *)(v1 + 28) + 7.0;
          (*(void (__thiscall **)(int, int, int, float *, int, int *))(*(_DWORD *)grim_interface_ptr + 308))(
            grim_interface_ptr,
            v1 + 172,
            4,
            &v40,
            v1 + 772,
            &a1);
        }
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      }
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v21,
        v28,
        v35);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 296))(
        grim_interface_ptr,
        v1 + 60,
        4,
        v1 + 24,
        v1 + 772);
      if ( *(_DWORD *)(v1 + 288) == 8 )
      {
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 296))(
          grim_interface_ptr,
          v1 + 116,
          4,
          v1 + 24,
          v1 + 772);
        (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 296))(
          grim_interface_ptr,
          v1 + 172,
          4,
          v1 + 24,
          v1 + 772);
      }
LABEL_38:
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      goto LABEL_39;
    }
    if ( v9 == 1 )
    {
      if ( config_fx_detail_flag0 )
      {
        (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
          grim_interface_ptr,
          19,
          1,
          v21,
          v28,
          v35);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
        v10 = *(float *)(v1 + 24) + 7.0;
        v42 = *(float *)(v1 + 28) + 7.0;
        v40 = v10 + *(float *)(v1 + 8);
        v41 = v42 + *(float *)(v1 + 12);
        (*(void (__thiscall **)(int, int, int, float *, int *))(*(_DWORD *)grim_interface_ptr + 304))(
          grim_interface_ptr,
          v1 + 60,
          4,
          &v40,
          &a1);
        if ( *(_DWORD *)(v1 + 288) == 8 )
        {
          v11 = *(float *)(v1 + 24) + 7.0;
          v42 = *(float *)(v1 + 28) + 7.0;
          v40 = v11 + *(float *)(v1 + 8);
          v41 = v42 + *(float *)(v1 + 12);
          (*(void (__thiscall **)(int, int, int, float *, int *))(*(_DWORD *)grim_interface_ptr + 304))(
            grim_interface_ptr,
            v1 + 116,
            4,
            &v40,
            &a1);
          v12 = *(float *)(v1 + 24) + 7.0;
          v42 = *(float *)(v1 + 28) + 7.0;
          v40 = v12 + *(float *)(v1 + 8);
          v41 = v42 + *(float *)(v1 + 12);
          (*(void (__thiscall **)(int, int, int, float *, int *))(*(_DWORD *)grim_interface_ptr + 304))(
            grim_interface_ptr,
            v1 + 172,
            4,
            &v40,
            &a1);
        }
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      }
      (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
        grim_interface_ptr,
        19,
        5,
        v21,
        v28,
        v35);
      (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
      v40 = *(float *)(v1 + 8) + *(float *)(v1 + 24);
      v41 = *(float *)(v1 + 12) + *(float *)(v1 + 28);
      (*(void (__thiscall **)(int, int, int, float *))(*(_DWORD *)grim_interface_ptr + 300))(
        grim_interface_ptr,
        v1 + 60,
        4,
        &v40);
      if ( *(_DWORD *)(v1 + 288) == 8 )
      {
        v40 = *(float *)(v1 + 8) + *(float *)(v1 + 24);
        v41 = *(float *)(v1 + 12) + *(float *)(v1 + 28);
        (*(void (__thiscall **)(int, int, int, float *))(*(_DWORD *)grim_interface_ptr + 300))(
          grim_interface_ptr,
          v1 + 116,
          4,
          &v40);
        v40 = *(float *)(v1 + 8) + *(float *)(v1 + 24);
        v41 = *(float *)(v1 + 12) + *(float *)(v1 + 28);
        (*(void (__thiscall **)(int, int, int, float *))(*(_DWORD *)grim_interface_ptr + 300))(
          grim_interface_ptr,
          v1 + 172,
          4,
          &v40);
      }
      goto LABEL_38;
    }
  }
LABEL_39:
  v13 = *(_DWORD *)(v1 + 516);
  if ( v13 != -1 )
  {
    (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, v13, 0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    if ( *(_DWORD *)(v1 + 4) )
    {
      v40 = *(float *)(v1 + 8) + *(float *)(v1 + 24);
      v41 = *(float *)(v1 + 12) + *(float *)(v1 + 28);
      (*(void (__thiscall **)(int, int, int, float *))(*(_DWORD *)grim_interface_ptr + 300))(
        grim_interface_ptr,
        v1 + 292,
        4,
        &v40);
    }
    else
    {
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 296))(
        grim_interface_ptr,
        v1 + 292,
        4,
        v1 + 24,
        v1 + 772);
    }
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  }
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    v21,
    v28,
    v35);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    2,
    v22,
    v29,
    v36);
  if ( *(_DWORD *)(v1 + 764) < 0x100u )
  {
    v14 = v1 + 543;
    v15 = 4;
    do
    {
      v14 += 28;
      *(_BYTE *)(v14 - 260) = -1 - *(_DWORD *)(v1 + 764) / 2;
      --v15;
      *(_BYTE *)(v14 - 28) = -1 - *(_DWORD *)(v1 + 764) / 2;
    }
    while ( v15 );
  }
  v43[0] = *(_DWORD *)(v1 + 772);
  v43[1] = *(_DWORD *)(v1 + 776);
  v43[2] = *(_DWORD *)(v1 + 780);
  v16 = *(_BYTE *)(v1 + 1);
  v43[3] = *(_DWORD *)(v1 + 784);
  if ( v16 )
  {
    v17 = *(_DWORD *)(v1 + 516);
    if ( v17 != -1 )
    {
      if ( *(_DWORD *)(v1 + 52) )
      {
        (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, v17, 0);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
        (*(void (__thiscall **)(int, int, int, int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 296))(
          grim_interface_ptr,
          v1 + 292,
          4,
          v1 + 24,
          v43);
        (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
      }
    }
  }
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    19,
    5,
    v23,
    v30,
    v37);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    20,
    6,
    v24,
    v31,
    v38);
  v18 = *(void (**)(void))(v1 + 56);
  if ( v18 )
    v18();
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v25,
    v32,
    v39);
}

// sub_447350 @ 0x00447350
void sub_447350()
{
  ui_transition_direction = 0;
  game_state_pending = 20;
}

// ui_menu_main_click_options @ 0x00447370
// main menu OPTIONS click callback (sets ui_transition_direction=0 and game_state_pending=2)
void ui_menu_main_click_options()
{
  ui_transition_direction = 0;
  game_state_pending = 2;
}

// sub_447390 @ 0x00447390
void sub_447390()
{
  ui_transition_direction = 0;
  game_state_pending = 4;
  sfx_mute_all(music_track_crimson_theme_id);
  sfx_mute_all(music_track_shortie_monk_id);
  sfx_mute_all(music_track_extra_0);
  sfx_play_exclusive(music_track_shortie_monk_id);
}

// FUN_004473e0 @ 0x004473E0
// [binja] int32_t sub_4473e0()
int FUN_004473e0()
{
  int result; // eax

  ui_transition_direction = 0;
  game_state_pending = 3;
  return result;
}

// ui_menu_main_click_play_game @ 0x00447400
// main menu PLAY GAME click callback (sets ui_transition_direction=0 and game_state_pending=1)
void ui_menu_main_click_play_game()
{
  ui_transition_direction = 0;
  game_state_pending = 1;
}

// FUN_00447420 @ 0x00447420
// [binja] int32_t sub_447420()
int FUN_00447420()
{
  int result; // eax

  LOBYTE(result) = byte_4824D1;
  ui_transition_direction = 0;
  if ( byte_4824D1 )
  {
    game_state_pending = 5;
  }
  else
  {
    result = render_pass_mode != 0 ? 5 : 0;
    game_state_pending = result;
  }
  return result;
}

// ui_menu_main_click_quit @ 0x00447450
// main menu QUIT click callback (clears ui_sign_crimson_update_disabled, sets ui_transition_direction=0, game_state_pending=10, mutes music)
void ui_menu_main_click_quit()
{
  game_state_pending = 10;
  ui_sign_crimson_update_disabled = 0;
  ui_transition_direction = 0;
  sfx_mute_all(music_track_crimson_theme_id);
  sfx_mute_all(music_track_extra_0);
  sfx_mute_all(music_track_shortie_monk_id);
}

// sub_447490 @ 0x00447490
int sub_447490()
{
  int result; // eax

  if ( plugin_interface_ptr )
    *(_BYTE *)(plugin_interface_ptr + 9) = 0;
  ui_sign_crimson_update_disabled = 0;
  ui_transition_direction = 0;
  game_state_pending = byte_4824D1 != 0 ? 22 : 9;
  result = config_game_mode;
  if ( config_game_mode == 4 )
    game_state_pending = 18;
  return result;
}

// sub_4474E0 @ 0x004474E0
void sub_4474E0()
{
  if ( plugin_interface_ptr )
  {
    *(_BYTE *)(plugin_interface_ptr + 9) = 0;
    byte_4824D1 = 0;
    (*(void (__thiscall **)(int))(*(_DWORD *)plugin_interface_ptr + 4))(plugin_interface_ptr);
    sfx_mute_all(music_track_extra_0);
    plugin_interface_ptr = 0;
    FreeLibrary(hLibModule);
    hLibModule = 0;
    byte_471304 = 1;
    game_state_pending = 20;
  }
  else
  {
    game_state_pending = 0;
  }
  ui_transition_direction = 0;
  render_pass_mode = 0;
  sfx_mute_all(music_track_crimson_theme_id);
  sfx_mute_all(music_track_shortie_monk_id);
  sfx_mute_all(music_track_extra_0);
  sfx_play_exclusive(music_track_crimson_theme_id);
}

// config_apply_detail_preset @ 0x00447580
// Applies config_detail_preset ("Graphics detail" 1..5) to the config_fx_detail_flag0/1/2 bytes.
void config_apply_detail_preset()
{
  switch ( config_detail_preset )
  {
    case 1:
      config_fx_detail_flag2 = 0;
      goto LABEL_3;
    case 2:
LABEL_3:
      config_fx_detail_flag0 = 0;
      config_fx_detail_flag1 = 0;
      break;
    case 3:
    case 4:
    case 5:
      config_fx_detail_flag1 = 1;
      config_fx_detail_flag2 = 1;
      config_fx_detail_flag0 = 1;
      break;
    default:
      return;
  }
}

// sub_4475D0 @ 0x004475D0
char sub_4475D0()
{
  int v0; // edx
  int v1; // edx
  double v2; // st7
  int v3; // edx
  int v4; // eax
  char result; // al
  int v6; // [esp+6Ch] [ebp-30h]
  int v7; // [esp+6Ch] [ebp-30h]
  int v8; // [esp+70h] [ebp-2Ch]
  int v9; // [esp+70h] [ebp-2Ch]
  float v10; // [esp+70h] [ebp-2Ch]
  float v11; // [esp+70h] [ebp-2Ch]
  float v12; // [esp+70h] [ebp-2Ch]
  float v13; // [esp+70h] [ebp-2Ch]
  int v14; // [esp+74h] [ebp-28h]
  int v15; // [esp+74h] [ebp-28h]
  float v16[2]; // [esp+84h] [ebp-18h] BYREF
  float v17; // [esp+8Ch] [ebp-10h]
  float v18; // [esp+90h] [ebp-Ch]
  float v19; // [esp+94h] [ebp-8h] BYREF
  float v20; // [esp+98h] [ebp-4h]

  v20 = *(float *)&dword_488B6C + flt_488B90;
  v0 = *(_DWORD *)grim_interface_ptr;
  v17 = flt_488B8C + *(float *)&dword_488B68 + 300.0;
  v18 = v20 + 40.0;
  v16[0] = flt_488B58 - 24.0 - 64.0 + v17;
  v17 = v16[0];
  (*(void (__thiscall **)(int, int, int, int, int))(v0 + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7F4, 0);
  (*(void (__thiscall **)(int, _DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    1048576000,
    1065353216,
    1052770304);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v6,
    v8,
    v14);
  (*(void (__thiscall **)(int, _DWORD, float, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    LODWORD(v16[0]),
    COERCE_FLOAT(LODWORD(v18)),
    1124073472,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v7,
    v9,
    v15);
  v1 = *(_DWORD *)grim_interface_ptr;
  v17 = v16[0] + 8.0;
  v18 = v18 + 2.0;
  (*(void (__thiscall **)(int, int, int, int, int))(v1 + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  v10 = v18 + 45.0;
  (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v17)),
    LODWORD(v10),
    aSoundVolume);
  v11 = v18 + 65.0;
  (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v17)),
    LODWORD(v11),
    aMusicVolume);
  v12 = v18 + 85.0;
  (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v17)),
    LODWORD(v12),
    aGraphicsDetail);
  v13 = v18 + 105.0;
  (*(void (__cdecl **)(int, float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v17)),
    LODWORD(v13),
    aMouseSensitivi);
  if ( (byte_4D79A0 & 1) == 0 )
  {
    byte_4D77E0 = 0;
    byte_4D79A0 |= 1u;
    byte_4D77E1 = 0;
    byte_4D77E2 = 0;
    dword_4D77E4 = 0;
    crt_atexit(nullsub_78);
  }
  v16[0] = v17;
  dword_4D77E4 = (int)aUiInfoTexts;
  byte_4D77E0 = config_full_version;
  v16[1] = v18 + 133.0;
  ui_checkbox_update(v16, (int)&byte_4D77E0);
  config_full_version = byte_4D77E0;
  v17 = v17 - 18.0;
  v18 = v18 - 2.0;
  if ( (byte_4D79A0 & 2) == 0 )
  {
    byte_4D7804 = 1;
    byte_4D79A0 |= 2u;
    byte_4D7805 = 0;
    dword_4D77F8 = 0;
    dword_4D77FC = 10;
    dword_4D7800 = 0;
    crt_atexit(nullsub_77);
  }
  dword_4D77F8 = (__int64)(config_sfx_volume * 10.0);
  v16[0] = v17 + 148.0;
  v19 = v16[0];
  v20 = v18 + 47.0;
  FUN_0043d9b0((int)&v19, (int)&dword_4D77F8);
  config_sfx_volume = (double)dword_4D77F8 * 0.1;
  if ( (byte_4D79A0 & 4) == 0 )
  {
    byte_4D75F4 = 1;
    byte_4D79A0 |= 4u;
    byte_4D75F5 = 0;
    dword_4D75E8 = 0;
    dword_4D75EC = 10;
    dword_4D75F0 = 0;
    crt_atexit(nullsub_76);
  }
  v20 = v18 + 67.0;
  dword_4D75E8 = (__int64)(config_music_volume * 10.0);
  v19 = v16[0];
  FUN_0043d9b0((int)&v19, (int)&dword_4D75E8);
  config_music_volume = (double)dword_4D75E8 * 0.1;
  if ( (byte_4D79A0 & 8) == 0 )
  {
    byte_4D759C = 1;
    byte_4D79A0 |= 8u;
    byte_4D759D = 0;
    dword_4D7590 = 0;
    dword_4D7594 = 10;
    dword_4D7598 = 0;
    crt_atexit(nullsub_75);
  }
  v20 = v18 + 87.0;
  dword_4D7594 = 5;
  dword_4D7598 = 1;
  dword_4D7590 = config_detail_preset;
  v19 = v16[0];
  FUN_0043d9b0((int)&v19, (int)&dword_4D7590);
  config_detail_preset = dword_4D7590;
  if ( dword_4D7590 >= 1 )
  {
    if ( dword_4D7590 > 5 )
      config_detail_preset = 5;
  }
  else
  {
    config_detail_preset = 1;
  }
  config_apply_detail_preset();
  if ( (byte_4D79A0 & 0x10) == 0 )
  {
    byte_4D768C = 1;
    byte_4D79A0 |= 0x10u;
    byte_4D768D = 0;
    dword_4D7680 = 0;
    dword_4D7684 = 10;
    dword_4D7688 = 0;
    crt_atexit(nullsub_74);
  }
  dword_4D7684 = 10;
  dword_4D7688 = 1;
  dword_4D7680 = (__int64)(flt_4807BC * 10.0 + 0.5);
  v20 = v18 + 107.0;
  v19 = v16[0];
  FUN_0043d9b0((int)&v19, (int)&dword_4D7680);
  v2 = (double)dword_4D7680 * 0.1;
  flt_4807BC = v2;
  if ( v2 >= 0.1 )
  {
    if ( flt_4807BC > 1.0 )
      flt_4807BC = 1.0;
  }
  else
  {
    flt_4807BC = 0.1;
  }
  if ( (byte_4D79A0 & 0x20) == 0 )
  {
    byte_4D798E = 1;
    byte_4D79A0 |= 0x20u;
    byte_4D799D = 0;
    byte_4D799C = 0;
    dword_4D7998 = 1065353216;
    dword_4D7994 = 0;
    dword_4D7988 = 0;
    byte_4D798C = 0;
    byte_4D798D = 0;
    dword_4D7990 = 0;
    crt_atexit(nullsub_73);
  }
  dword_4D7988 = (int)aControls;
  v19 = v17 + 10.0;
  v20 = v18 + 155.0;
  ui_button_update(&v19, (int)&dword_4D7988);
  if ( config_fx_toggle )
  {
    v3 = dword_4C364C;
    v4 = 5 * perk_id_bloody_mess_quick_learner;
    perk_meta_table[5 * perk_id_bloody_mess_quick_learner] = dword_4C3644;
  }
  else
  {
    v3 = dword_4C3648;
    v4 = 5 * perk_id_bloody_mess_quick_learner;
    perk_meta_table[5 * perk_id_bloody_mess_quick_learner] = dword_4C3640;
  }
  perk_desc_table[v4] = v3;
  if ( byte_4D798D )
    FUN_004473e0();
  result = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1);
  if ( result )
    return FUN_00447420();
  return result;
}

// nullsub_73 @ 0x00447C30
void __cdecl nullsub_73()
{
  ;
}

// nullsub_74 @ 0x00447C40
void __cdecl nullsub_74()
{
  ;
}

// nullsub_75 @ 0x00447C50
void __cdecl nullsub_75()
{
  ;
}

// nullsub_76 @ 0x00447C60
void __cdecl nullsub_76()
{
  ;
}

// nullsub_77 @ 0x00447C70
void __cdecl nullsub_77()
{
  ;
}

// nullsub_78 @ 0x00447C80
void __cdecl nullsub_78()
{
  ;
}

// FUN_00447c90 @ 0x00447C90
// [binja] int32_t sub_447c90(int32_t arg1)
int FUN_00447c90(int arg1)
{
  int result; // eax

  switch ( arg1 )
  {
    case 0:
      result = (int)aMouse;
      break;
    case 1:
      result = (int)aKeyboard;
      break;
    case 2:
      result = (int)aJoystick;
      break;
    case 3:
      result = (int)aMouseRelative;
      break;
    case 4:
      result = (int)aDualActionPad;
      break;
    case 5:
      result = (int)aComputer;
      break;
    default:
      result = (int)aUnknown;
      break;
  }
  return result;
}

// input_scheme_label @ 0x00447CF0
// maps control scheme ids to labels (Relative/Static/Dual Action Pad/etc)
char *input_scheme_label(int scheme)
{
  char *result; // eax

  switch ( scheme )
  {
    case 1:
      result = aRelative;
      break;
    case 2:
      result = aStatic;
      break;
    case 3:
      result = aDualActionPad;
      break;
    case 4:
      result = aMousePointClic;
      break;
    case 5:
      result = aComputer;
      break;
    default:
      result = aUnknown;
      break;
  }
  return result;
}

// sub_447D40 @ 0x00447D40
char sub_447D40()
{
  float v0; // edi
  int *v1; // esi
  float v2; // ebp
  int v3; // edx
  int v4; // edx
  int v5; // edx
  int v6; // eax
  std::codecvt_base *v7; // ecx
  char v8; // bl
  int v9; // esi
  int v10; // eax
  int v11; // edi
  float v12; // esi
  int v13; // eax
  float v14; // ebp
  int v15; // edi
  int v16; // edi
  int v17; // eax
  int v18; // edx
  float v20; // [esp+A2h] [ebp-54h]
  float v21; // [esp+A6h] [ebp-50h]
  int v22; // [esp+AAh] [ebp-4Ch]
  float v23; // [esp+AAh] [ebp-4Ch]
  float v24; // [esp+AAh] [ebp-4Ch]
  int v25; // [esp+AEh] [ebp-48h]
  float v26; // [esp+AEh] [ebp-48h]
  int v27; // [esp+B2h] [ebp-44h]
  char v28; // [esp+C8h] [ebp-2Eh]
  char v29; // [esp+C9h] [ebp-2Dh]
  float v30; // [esp+CAh] [ebp-2Ch]
  float v31; // [esp+CAh] [ebp-2Ch]
  float v32[2]; // [esp+CEh] [ebp-28h] BYREF
  float v33; // [esp+D6h] [ebp-20h]
  float v34; // [esp+DAh] [ebp-1Ch]
  float v35; // [esp+DEh] [ebp-18h]
  float v36; // [esp+E2h] [ebp-14h]
  float v37; // [esp+E6h] [ebp-10h] BYREF
  float v38; // [esp+EAh] [ebp-Ch]
  int v39; // [esp+EEh] [ebp-8h]
  int v40; // [esp+F2h] [ebp-4h]

  v38 = *(float *)&dword_48E20C + flt_48E230;
  v29 = 0;
  v33 = flt_48E22C + *(float *)&dword_48E208 + 300.0;
  v34 = v38 + 40.0;
  v35 = v33 + flt_48E1F8 + 64.0 - 145.0;
  v36 = v34 + 4.0;
  if ( (byte_4D76A0 & 1) == 0 )
  {
    dword_4D7628 = 1049398413;
    byte_4D76A0 |= 1u;
    dword_4D762C = 1060418741;
    dword_4D7630 = 1064366321;
    dword_4D7634 = 1058642330;
    crt_atexit(nullsub_88);
  }
  if ( (byte_4D76A0 & 2) == 0 )
  {
    dword_4D76F0 = 1049398413;
    byte_4D76A0 |= 2u;
    dword_4D76F4 = 1060418741;
    dword_4D76F8 = 1064366321;
    dword_4D76FC = 1065353216;
    crt_atexit(nullsub_87);
  }
  if ( (byte_4D76A0 & 4) == 0 )
  {
    dword_4D7888 = 0;
    byte_4D76A0 |= 4u;
    dword_4D788C = 1056767229;
    dword_4D7890 = 1061603015;
    dword_4D7894 = 1065353216;
    crt_atexit(nullsub_86);
  }
  if ( (byte_4D76A0 & 8) == 0 )
  {
    dword_4D7738 = 0;
    byte_4D76A0 |= 8u;
    dword_4D773C = 1056767229;
    dword_4D7740 = 1061603015;
    dword_4D7744 = 1056964608;
    crt_atexit(nullsub_85);
  }
  if ( (byte_4D76A0 & 0x10) == 0 )
  {
    qmemcpy(&dword_4D7720, "333?333?333?333?", 16);
    byte_4D76A0 |= 0x10u;
    crt_atexit(nullsub_84);
  }
  if ( (byte_4D76A0 & 0x20) == 0 )
  {
    dword_4D79A8 = 1065353216;
    byte_4D76A0 |= 0x20u;
    dword_4D79AC = 1065353216;
    dword_4D79B0 = 1065353216;
    dword_4D79B4 = 1065353216;
    crt_atexit(nullsub_83);
  }
  if ( (byte_4D76A0 & 0x40) == 0 )
  {
    dword_4D76E0 = 1065353216;
    byte_4D76A0 |= 0x40u;
    dword_4D76E4 = 1065353216;
    dword_4D76E8 = 1065353216;
    dword_4D76EC = 1061997773;
    crt_atexit(nullsub_82);
  }
  if ( byte_4D76A0 >= 0 )
  {
    dword_4D7690 = 1061603015;
    byte_4D76A0 |= 0x80u;
    dword_4D7694 = 1056767229;
    dword_4D7698 = 0;
    dword_4D769C = 1065353216;
    crt_atexit(nullsub_81);
  }
  if ( config_hardcore )
  {
    dword_4D7628 = 1065024251;
    dword_4D762C = 1049398413;
    v37 = 0.98039216;
    dword_4D7630 = 1047589105;
    dword_4D7634 = 1058642330;
    v38 = 0.27450982;
    v39 = 1047589105;
    v40 = 1065353216;
    dword_4D76F0 = 1065024251;
    dword_4D76F4 = 1049398413;
    dword_4D76F8 = 1047589105;
  }
  else
  {
    dword_4D7628 = 1049398413;
    dword_4D762C = 1060418741;
    v37 = 0.27450982;
    dword_4D7630 = 1064366321;
    dword_4D7634 = 1058642330;
    v38 = 0.70588237;
    v39 = 1064366321;
    v40 = 1065353216;
    dword_4D76F0 = 1049398413;
    dword_4D76F4 = 1060418741;
    dword_4D76F8 = 1064366321;
  }
  dword_4D76FC = 1065353216;
  (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4D7720);
  (*(void (__thiscall **)(int, _DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    0,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 252))(grim_interface_ptr, 0);
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7A4, 0);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
  (*(void (__thiscall **)(int, float, float, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v35)),
    COERCE_FLOAT(LODWORD(v36)),
    1115684864,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  v33 = NAN;
  LODWORD(v0) = 1;
  v1 = &dword_48F7A8;
  v35 = v35 + 64.0 + 16.0;
  v32[0] = v36 + 3.0;
  v2 = v32[0];
  do
  {
    if ( ui_mouse_x <= (double)v35
      || ui_mouse_y <= (double)v36
      || v35 + 32.0 <= ui_mouse_x
      || v36 + 32.0 <= ui_mouse_y
      || ui_mouse_blocked )
    {
      (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4D7720);
    }
    else
    {
      (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4D76E0);
      v33 = v0;
    }
    v30 = 1.0;
    if ( dword_478E58 == LODWORD(v0) )
      (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4D79A8);
    else
      v30 = 0.80000001;
    if ( (int)v1 >= (int)&dword_48F7BC )
      v3 = dword_48F7B4;
    else
      v3 = *v1;
    (*(void (__stdcall **)(int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(v3, 0);
    (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 232))(grim_interface_ptr);
    v4 = *(_DWORD *)grim_interface_ptr;
    v32[0] = v30 * 32.0;
    (*(void (__thiscall **)(int, float, float, _DWORD, _DWORD))(v4 + 284))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v35)),
      COERCE_FLOAT(LODWORD(v2)),
      LODWORD(v32[0]),
      LODWORD(v32[0]));
    v5 = *(_DWORD *)grim_interface_ptr;
    v35 = v35 + 36.0;
    (*(void (__thiscall **)(int))(v5 + 240))(grim_interface_ptr);
    ++v1;
    ++LODWORD(v0);
  }
  while ( (int)v1 < (int)&dword_48F7BC );
  v6 = *(_DWORD *)grim_interface_ptr;
  v35 = v35 - 36.0;
  (*(void (__thiscall **)(int, int, int, int, int))(v6 + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v36 = v36 + 50.0;
  v35 = v35 - 208.0 + 16.0;
  if ( (byte_4D79D4 & 1) == 0 )
  {
    byte_4D7700 = 0;
    byte_4D79D4 |= 1u;
    byte_4D7701 = 0;
    byte_4D7702 = 0;
    dword_4D7704 = 0;
    crt_atexit(nullsub_80);
  }
  dword_4D7704 = (int)aHardcore;
  if ( quest_unlock_index >= 40 )
  {
    v32[0] = v35 + 132.0;
    byte_4D7700 = config_hardcore;
    v32[1] = v36 - 12.0;
    ui_checkbox_update(v32, (int)&byte_4D7700);
    config_hardcore = byte_4D7700;
    v36 = v36 + 10.0;
  }
  if ( !game_is_full_version(v7) )
    config_hardcore = 0;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v22,
    v25,
    v27);
  v8 = 0;
  v28 = 0;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 59) )
  {
    v8 = 1;
    v28 = 1;
  }
  v9 = 0;
  v32[0] = v35 - 10.0;
  do
  {
    if ( ui_mouse_x <= (double)v32[0]
      || v36 - 2.0 >= ui_mouse_y
      || v35 + 210.0 <= ui_mouse_x
      || v36 + 18.0 <= ui_mouse_y
      || ui_mouse_blocked )
    {
      (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4D7628);
    }
    else
    {
      dword_4D79D8 = v9;
      v29 = 1;
      (*(void (__thiscall **)(int, int *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, &dword_4D76F0);
    }
    v10 = v9 + 10 * dword_478E58 - 10;
    if ( config_hardcore )
    {
      if ( quest_unlock_index_full < v10 )
        goto LABEL_53;
    }
    else if ( quest_unlock_index < v10 )
    {
LABEL_53:
      v11 = v9 + 1;
      v12 = v36;
      (*(void (**)(int, float, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v35)),
        COERCE_FLOAT(LODWORD(v36)),
        aDD,
        dword_478E58,
        v11);
      v23 = v35 + 32.0;
      (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v23),
        COERCE_FLOAT(LODWORD(v12)),
        asc_478884);
      goto LABEL_54;
    }
    v14 = v36;
    v11 = v9 + 1;
    (*(void (**)(int, float, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v35)),
      COERCE_FLOAT(LODWORD(v36)),
      aDD,
      dword_478E58,
      v9 + 1);
    v21 = v35 + 32.0;
    (*(void (**)(int, _DWORD, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v21),
      COERCE_FLOAT(LODWORD(v14)),
      aS_0,
      quest_meta_name[110 * dword_478E58 - 110 + 11 * v9]);
    v31 = (float)((*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 332))(
                    grim_interface_ptr,
                    quest_meta_name[110 * dword_478E58 - 110 + 11 * v9])
                + 32);
    v37 = v35;
    v38 = v36 + 13.0;
    (*(void (__thiscall **)(int, float *, float, int))(*(_DWORD *)grim_interface_ptr + 212))(
      grim_interface_ptr,
      &v37,
      COERCE_FLOAT(LODWORD(v31)),
      1065353216);
    v8 = v28;
    if ( v28 )
    {
      v20 = v31 + v35 + 12.0;
      (*(void (**)(int, _DWORD, float, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v20),
        COERCE_FLOAT(LODWORD(v14)),
        aDD_2,
        dword_4856BC[10 * dword_478E58 + v9],
        dword_48561C[10 * dword_478E58 + v9]);
    }
LABEL_54:
    v9 = v11;
    v36 = v36 + 20.0;
  }
  while ( v11 < 10 );
  if ( v8 )
  {
    v26 = v36 - 2.0;
    v24 = v35 + 96.0;
    (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v24),
      LODWORD(v26),
      aCompletedGames);
  }
  v35 = v32[0];
  v13 = *(_DWORD *)grim_interface_ptr;
  v36 = v36 + 12.0;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(v13 + 72))(grim_interface_ptr, 203) )
  {
    if ( --dword_478E58 < 1 )
      dword_478E58 = 1;
  }
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 205) )
  {
    if ( ++dword_478E58 > 5 )
      dword_478E58 = 5;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1063675494);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  if ( (byte_4D79D4 & 2) == 0 )
  {
    byte_4D79D4 |= 2u;
    byte_4D774E = 1;
    byte_4D775D = 0;
    byte_4D775C = 0;
    dword_4D7758 = 1065353216;
    dword_4D7754 = 0;
    dword_4D7748 = 0;
    byte_4D774C = 0;
    byte_4D774D = 0;
    dword_4D7750 = 0;
    crt_atexit(nullsub_79);
  }
  dword_4D7748 = (int)aBack_0;
  v37 = v35 + 148.0;
  v38 = v36;
  ui_button_update(&v37, (int)&dword_4D7748);
  if ( byte_4D774D )
  {
    ui_transition_direction = 0;
    game_state_pending = 1;
    sfx_play(sfx_ui_buttonclick, 1.0);
  }
  v15 = LODWORD(v33);
  if ( v33 != NAN && input_primary_just_pressed() )
    dword_478E58 = v15;
  v16 = dword_4D79D8;
  dword_4D79D8 = -10;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 2) )
    dword_4D79D8 = 0;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 3) )
    dword_4D79D8 = 1;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 4) )
    dword_4D79D8 = 2;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 5) )
    dword_4D79D8 = 3;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 6) )
    dword_4D79D8 = 4;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 7) )
    dword_4D79D8 = 5;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 8) )
    dword_4D79D8 = 6;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 9) )
    dword_4D79D8 = 7;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 10) )
    dword_4D79D8 = 8;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 11) )
  {
    v17 = 9;
    dword_4D79D8 = 9;
    goto LABEL_99;
  }
  v17 = dword_4D79D8;
  if ( dword_4D79D8 == -10 )
  {
    dword_4D79D8 = v16;
    LOBYTE(v17) = input_primary_just_pressed();
    if ( (_BYTE)v17 )
    {
      if ( v29
        || (LOBYTE(v17) = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 28),
            (_BYTE)v17) )
      {
        v17 = dword_4D79D8;
        goto LABEL_98;
      }
    }
  }
  else
  {
LABEL_98:
    if ( v17 != 10 )
    {
LABEL_99:
      v18 = v17 + 10 * dword_478E58 - 10;
      if ( config_hardcore )
      {
        if ( quest_unlock_index_full < v18 )
          return v17;
      }
      else if ( quest_unlock_index < v18 )
      {
        return v17;
      }
      ui_sign_crimson_update_disabled = 0;
      ui_transition_direction = 0;
      game_state_pending = 9;
      config_game_mode = 3;
      sfx_mute_all(music_track_crimson_theme_id);
      sfx_mute_all(music_track_shortie_monk_id);
      sfx_mute_all(music_track_extra_0);
      *(_DWORD *)quest_stage_major = dword_478E58;
      quest_stage_minor = dword_4D79D8 + 1;
      byte_48702C = 1;
      LOBYTE(v17) = sfx_play(sfx_ui_buttonclick, 1.0);
    }
  }
  return v17;
}

// nullsub_79 @ 0x00448AB0
void __cdecl nullsub_79()
{
  ;
}

// nullsub_80 @ 0x00448AC0
void __cdecl nullsub_80()
{
  ;
}

// nullsub_81 @ 0x00448AD0
void __cdecl nullsub_81()
{
  ;
}

// nullsub_82 @ 0x00448AE0
void __cdecl nullsub_82()
{
  ;
}

// nullsub_83 @ 0x00448AF0
void __cdecl nullsub_83()
{
  ;
}

// nullsub_84 @ 0x00448B00
void __cdecl nullsub_84()
{
  ;
}

// nullsub_85 @ 0x00448B10
void __cdecl nullsub_85()
{
  ;
}

// nullsub_86 @ 0x00448B20
void __cdecl nullsub_86()
{
  ;
}

// nullsub_87 @ 0x00448B30
void __cdecl nullsub_87()
{
  ;
}

// nullsub_88 @ 0x00448B40
void __cdecl nullsub_88()
{
  ;
}

// sub_448B50 @ 0x00448B50
int sub_448B50()
{
  float v1; // [esp+18h] [ebp-4h]
  float v2; // [esp+18h] [ebp-4h]
  float v3; // [esp+18h] [ebp-4h]
  float v4; // [esp+18h] [ebp-4h]
  float v5; // [esp+18h] [ebp-4h]
  float v6; // [esp+18h] [ebp-4h]

  v1 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(grim_interface_ptr, 319);
  if ( COERCE_FLOAT(LODWORD(v1) & 0x7FFFFFFF) > 0.5 )
    return 319;
  v2 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(grim_interface_ptr, 320);
  if ( COERCE_FLOAT(LODWORD(v2) & 0x7FFFFFFF) > 0.5 )
    return 320;
  v3 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(grim_interface_ptr, 321);
  if ( COERCE_FLOAT(LODWORD(v3) & 0x7FFFFFFF) > 0.5 )
    return 321;
  v4 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(grim_interface_ptr, 339);
  if ( COERCE_FLOAT(LODWORD(v4) & 0x7FFFFFFF) > 0.5 )
    return 339;
  v5 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(grim_interface_ptr, 340);
  if ( COERCE_FLOAT(LODWORD(v5) & 0x7FFFFFFF) > 0.5 )
    return 340;
  v6 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(grim_interface_ptr, 341);
  if ( COERCE_FLOAT(LODWORD(v6) & 0x7FFFFFFF) > 0.5 )
    return 341;
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
  return 0;
}

// sub_448CD0 @ 0x00448CD0
int sub_448CD0()
{
  int v0; // ebx
  int v1; // edx
  double v2; // st7
  char v3; // cl
  double v4; // st7
  int *v5; // ecx
  int *v6; // eax
  int v7; // edx
  int v8; // esi
  int v9; // ecx
  _DWORD *v10; // eax
  char *v11; // eax
  float v12; // edi
  int *v13; // ebp
  int v14; // esi
  const char *v15; // eax
  const char *v16; // edi
  int v17; // ebx
  int v18; // esi
  const char *v19; // eax
  const char *v20; // edi
  int v21; // esi
  const char *v22; // eax
  const char *v23; // edi
  int v24; // esi
  const char *v25; // eax
  const char *v26; // edi
  int v27; // eax
  int v28; // esi
  int v29; // esi
  int v30; // eax
  float *v31; // eax
  float *v32; // eax
  float *v33; // eax
  float *v34; // eax
  float *v35; // eax
  int v36; // edi
  int v37; // eax
  int v38; // eax
  float *v39; // eax
  float *v40; // eax
  float *v41; // eax
  float *v42; // eax
  float *v43; // eax
  float *v44; // eax
  float *v45; // eax
  float *v46; // eax
  float *v47; // eax
  float *v48; // eax
  float *v49; // eax
  int v50; // edi
  int v51; // eax
  float *v52; // eax
  float *v53; // eax
  int v54; // eax
  char v55; // dl
  int v56; // esi
  char *v57; // ecx
  bool v58; // zf
  double v59; // st7
  double v60; // st7
  double v61; // st7
  double v62; // st7
  double v63; // st7
  double v64; // st7
  int v65; // edx
  float *v66; // ecx
  int v67; // eax
  int v68; // ecx
  int v69; // ecx
  int v70; // ecx
  int v71; // ecx
  int v72; // ecx
  int v73; // esi
  int v74; // ecx
  int v75; // eax
  int v76; // edx
  int v77; // eax
  float *v78; // eax
  int v79; // esi
  float *v80; // eax
  int v81; // esi
  float *v82; // eax
  int result; // eax
  int v84; // esi
  int v85; // ecx
  int v86; // edx
  float v87; // [esp+254h] [ebp-90h]
  int v88; // [esp+254h] [ebp-90h]
  float v89; // [esp+254h] [ebp-90h]
  float v90; // [esp+254h] [ebp-90h]
  float v91; // [esp+254h] [ebp-90h]
  float v92; // [esp+254h] [ebp-90h]
  float v93; // [esp+254h] [ebp-90h]
  float v94; // [esp+254h] [ebp-90h]
  float v95; // [esp+258h] [ebp-8Ch]
  int v96; // [esp+258h] [ebp-8Ch]
  float v97; // [esp+258h] [ebp-8Ch]
  float v98; // [esp+258h] [ebp-8Ch]
  float v99; // [esp+258h] [ebp-8Ch]
  int v100; // [esp+25Ch] [ebp-88h]
  float v101; // [esp+25Ch] [ebp-88h]
  float v102; // [esp+25Ch] [ebp-88h]
  float v103; // [esp+260h] [ebp-84h]
  float v104; // [esp+260h] [ebp-84h]
  float v105; // [esp+260h] [ebp-84h]
  float v106; // [esp+260h] [ebp-84h]
  float v107; // [esp+260h] [ebp-84h]
  float v108; // [esp+260h] [ebp-84h]
  float v109; // [esp+260h] [ebp-84h]
  float v110; // [esp+260h] [ebp-84h]
  float v111; // [esp+260h] [ebp-84h]
  float v112; // [esp+260h] [ebp-84h]
  float v113; // [esp+260h] [ebp-84h]
  float v114; // [esp+260h] [ebp-84h]
  int v115; // [esp+264h] [ebp-80h]
  int v116; // [esp+264h] [ebp-80h]
  int v117; // [esp+264h] [ebp-80h]
  int v118; // [esp+264h] [ebp-80h]
  int v119; // [esp+264h] [ebp-80h]
  int v120; // [esp+264h] [ebp-80h]
  int v121; // [esp+264h] [ebp-80h]
  int v122; // [esp+264h] [ebp-80h]
  int v123; // [esp+264h] [ebp-80h]
  int v124; // [esp+264h] [ebp-80h]
  int v125; // [esp+264h] [ebp-80h]
  int v126; // [esp+264h] [ebp-80h]
  int v127; // [esp+268h] [ebp-7Ch]
  int v128; // [esp+268h] [ebp-7Ch]
  int v129; // [esp+268h] [ebp-7Ch]
  int v130; // [esp+268h] [ebp-7Ch]
  int v131; // [esp+268h] [ebp-7Ch]
  int v132; // [esp+268h] [ebp-7Ch]
  int v133; // [esp+268h] [ebp-7Ch]
  int v134; // [esp+268h] [ebp-7Ch]
  int v135; // [esp+268h] [ebp-7Ch]
  int v136; // [esp+268h] [ebp-7Ch]
  int v137; // [esp+268h] [ebp-7Ch]
  int v138; // [esp+268h] [ebp-7Ch]
  float v139; // [esp+270h] [ebp-74h] BYREF
  int v140; // [esp+274h] [ebp-70h]
  float v141; // [esp+278h] [ebp-6Ch] BYREF
  float v142; // [esp+27Ch] [ebp-68h]
  float v143; // [esp+280h] [ebp-64h]
  int v144; // [esp+284h] [ebp-60h]
  float v145; // [esp+288h] [ebp-5Ch] BYREF
  float v146; // [esp+28Ch] [ebp-58h] BYREF
  _DWORD v147[4]; // [esp+290h] [ebp-54h] BYREF
  _DWORD v148[4]; // [esp+2A0h] [ebp-44h] BYREF
  _DWORD v149[6]; // [esp+2B0h] [ebp-34h] BYREF
  _DWORD v150[7]; // [esp+2C8h] [ebp-1Ch] BYREF

  v0 = 0;
  if ( (byte_4D77E8 & 1) == 0 )
  {
    byte_4D770E = 1;
    byte_4D77E8 |= 1u;
    byte_4D771D = 0;
    byte_4D771C = 0;
    dword_4D7718 = 1065353216;
    dword_4D7714 = 0;
    dword_4D7708 = 0;
    byte_4D770C = 0;
    byte_4D770D = 0;
    dword_4D7710 = 0;
    crt_atexit(nullsub_95);
  }
  dword_4D7708 = (int)aRedefine;
  if ( (byte_4D77E8 & 2) == 0 )
  {
    byte_4D75BE = 1;
    byte_4D77E8 |= 2u;
    byte_4D75CD = 0;
    byte_4D75CC = 0;
    dword_4D75C8 = 1065353216;
    dword_4D75C4 = 0;
    dword_4D75B8 = 0;
    byte_4D75BC = 0;
    byte_4D75BD = 0;
    dword_4D75C0 = 0;
    crt_atexit(nullsub_94);
  }
  dword_4D75B8 = (int)aBack_0;
  if ( (byte_4D77E8 & 4) == 0 )
  {
    byte_4D7660 = 1;
    byte_4D77E8 |= 4u;
    dword_4D7678 = 0;
    byte_4D7674 = 0;
    dword_4D7668 = 0;
    dword_4D7664 = 0;
    dword_4D7670 = 0;
    dword_4D766C = 0;
    crt_atexit(nullsub_93);
  }
  if ( (byte_4D77E8 & 8) == 0 )
  {
    byte_4D76A8 = 1;
    byte_4D77E8 |= 8u;
    dword_4D76C0 = 0;
    byte_4D76BC = 0;
    dword_4D76B0 = 0;
    dword_4D76AC = 0;
    dword_4D76B8 = 0;
    dword_4D76B4 = 0;
    crt_atexit(nullsub_92);
  }
  if ( (byte_4D77E8 & 0x10) == 0 )
  {
    byte_4D7638 = 1;
    byte_4D77E8 |= 0x10u;
    dword_4D7650 = 0;
    byte_4D764C = 0;
    dword_4D7640 = 0;
    dword_4D763C = 0;
    dword_4D7648 = 0;
    dword_4D7644 = 0;
    crt_atexit(nullsub_91);
  }
  if ( byte_478E60 )
  {
    byte_478E60 = 0;
    v1 = config_player_mode_flags[dword_4D79DC] - 1;
    dword_4D76B0 = config_aim_scheme[dword_4D79DC];
    dword_4D7640 = v1;
  }
  v150[0] = FUN_00447c90(0);
  v150[1] = FUN_00447c90(1);
  v150[2] = FUN_00447c90(2);
  v150[3] = FUN_00447c90(3);
  v150[4] = FUN_00447c90(4);
  v150[5] = FUN_00447c90(5);
  v150[6] = FUN_00447c90(6);
  dword_4D76B4 = (int)v150;
  dword_4D76B8 = 5;
  v149[0] = input_scheme_label(1);
  v149[1] = input_scheme_label(2);
  v149[2] = input_scheme_label(3);
  v149[3] = input_scheme_label(4);
  v149[4] = input_scheme_label(5);
  v149[5] = input_scheme_label(6);
  dword_4D7644 = (int)v149;
  v2 = *(float *)(cv_enableMousePointAndClickMovement + 12);
  dword_4D7648 = 3;
  if ( v2 != 0.0 )
    dword_4D7648 = 4;
  dword_4D766C = (int)v148;
  v148[0] = aPlayer1;
  v146 = *(float *)&dword_48D294 + flt_48D2B8;
  v148[1] = aPlayer2;
  v148[2] = aPlayer3;
  v148[3] = aPlayer4;
  dword_4D7670 = 2;
  v139 = flt_48D2B4 + *(float *)&dword_48D290 + 300.0;
  *(float *)&v140 = v146 + 40.0;
  v142 = *(float *)&v140;
  v144 = v140;
  v141 = flt_48D280 - 32.0 - 64.0 + v139;
  v143 = v141;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  ui_draw_textured_quad((__int64)(v141 + 2.0), (__int64)(*(float *)&v140 + 4.0), 128, 32, dword_48F7FC);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  v142 = *(float *)&v140 + 3.0;
  v141 = v141 + 9.0;
  v95 = v142 - 2.0;
  v87 = v141 + 126.0;
  (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v87),
    LODWORD(v95),
    aConfigureFor);
  v142 = v142 + 43.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v88,
    v96,
    v100);
  (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v141)),
    COERCE_FLOAT(LODWORD(v142)),
    aAimingMethod);
  v142 = v142 + 42.0;
  (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v141)),
    COERCE_FLOAT(LODWORD(v142)),
    aMovingMethod);
  v142 = v142 + 42.0;
  if ( (byte_4D77E8 & 0x20) == 0 )
  {
    byte_4D77F0 = 0;
    byte_4D77E8 |= 0x20u;
    byte_4D77F1 = 0;
    byte_4D77F2 = 0;
    dword_4D77F4 = 0;
    crt_atexit(nullsub_90);
  }
  v3 = *((_BYTE *)&config_hud_indicator_toggle + dword_4D79DC);
  dword_4D77F4 = (int)aShowDirectionA;
  v142 = v142 + 4.0;
  byte_4D77F0 = v3;
  ui_checkbox_update(&v141, (int)&byte_4D77F0);
  v4 = flt_48EE8C + *(float *)&dword_48EE68;
  v146 = *(float *)&dword_48EE6C + flt_48EE90;
  *((_BYTE *)&config_hud_indicator_toggle + dword_4D79DC) = byte_4D77F0;
  v5 = &player_move_key_backward;
  v139 = v4 + 50.0;
  *(float *)&v140 = v146 + 40.0;
  v6 = &config_p1_axis_move_x;
  v142 = *(float *)&v140 + 32.0;
  v141 = flt_48EE58 - 64.0 + v139 + 64.0;
  do
  {
    v7 = *(v6 - 12);
    v6 += 16;
    *(v5 - 1) = v7;
    *v5 = *(v6 - 27);
    v5[1] = *(v6 - 26);
    v5[2] = *(v6 - 25);
    v5[3] = *(v6 - 24);
    v5[4] = *(v6 - 23);
    v5[5] = *(v6 - 22);
    v5[6] = *(v6 - 21);
    v5[7] = *(v6 - 20);
    v5[9] = *(v6 - 19);
    v5[8] = *(v6 - 18);
    v5[11] = *(v6 - 17);
    v5[10] = *(v6 - 16);
    v5 += 216;
  }
  while ( (int)v6 < (int)dword_4805C0 );
  v101 = (double)dword_4D7710 * 0.00090000004;
  (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    LODWORD(v101));
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1063675494);
  v141 = v141 + 16.0;
  v142 = v142 + 4.0 - 38.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v89 = v141 + 54.0;
  (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    LODWORD(v89),
    COERCE_FLOAT(LODWORD(v142)),
    aConfiguredCont);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1061997773);
  v145 = v141 + 54.0;
  v146 = v142 + 13.0;
  v8 = *(_DWORD *)grim_interface_ptr;
  *(float *)&v140 = COERCE_FLOAT(
                      (*(int (__thiscall **)(int, char *, int))(*(_DWORD *)grim_interface_ptr + 332))(
                        grim_interface_ptr,
                        aConfiguredCont,
                        1065353216));
  v102 = (float)v140;
  (*(void (__thiscall **)(int, float *, _DWORD))(v8 + 212))(grim_interface_ptr, &v146, LODWORD(v102));
  v142 = v142 + 26.0;
  v141 = v141 - 8.0;
  if ( (byte_4D77E8 & 0x40) == 0 )
  {
    v9 = 15;
    byte_4D77E8 |= 0x40u;
    v10 = &unk_4D78A4;
    do
    {
      *((_BYTE *)v10 - 6) = 1;
      *v10 = 1065353216;
      *(v10 - 3) = 0;
      *((_BYTE *)v10 - 8) = 0;
      *((_BYTE *)v10 - 7) = 0;
      *(v10 - 1) = 0;
      v10 += 4;
      --v9;
    }
    while ( v9 );
    crt_atexit(nullsub_89);
  }
  v11 = (char *)&unk_4D789D;
  do
  {
    v11[1] = 1;
    *v11 = 0;
    v11 += 16;
  }
  while ( (int)v11 < (int)&byte_4D798D );
  LODWORD(v12) = 16 * dword_4D79DC;
  do
  {
    v13 = &dword_4D7898[4 * v0];
    if ( *v13 )
      crt_free((LPVOID)dword_4D7898[4 * v0]);
    v14 = config_p1_move_forward[LODWORD(v12)++];
    v139 = v12;
    if ( v14 > 255 )
    {
      switch ( v14 )
      {
        case 256:
          strcpy(String, aMouse1);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 257:
          v16 = aMouse2;
          break;
        case 258:
          strcpy(String, aMouse3);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 259:
          v16 = aMouse4;
          break;
        case 260:
          strcpy(String, aMouse5);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 265:
          v16 = aMwheelup;
          break;
        case 266:
          strcpy(String, aMwheeldown);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 287:
          v16 = aJoys1;
          break;
        case 288:
          strcpy(String, aJoys2);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 289:
          v16 = aJoys3;
          break;
        case 290:
          strcpy(String, aJoys4);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 291:
          v16 = aJoys5;
          break;
        case 292:
          strcpy(String, aJoys6);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 293:
          v16 = aJoys7;
          break;
        case 294:
          strcpy(String, aJoys8);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 295:
          v16 = aJoys9;
          break;
        case 296:
          strcpy(String, aJoys10);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 297:
          v16 = aJoys11;
          break;
        case 298:
          strcpy(String, aJoys12);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 305:
          v16 = aJoysup;
          break;
        case 306:
          strcpy(String, aJoysdown);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 307:
          v16 = aJoysleft;
          break;
        case 308:
          strcpy(String, aJoysright);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 319:
          v16 = aJoyaxisx;
          break;
        case 320:
          strcpy(String, aJoyaxisy);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 321:
          v16 = aJoyaxisz;
          break;
        case 339:
          strcpy(String, aJoyrotx);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 340:
          v16 = aJoyroty;
          break;
        case 341:
          strcpy(String, aJoyrotz);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 382:
          v16 = aUnbound;
          break;
        case 355:
          strcpy(String, aRim0xaxis);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 356:
          v16 = aRim1xaxis;
          break;
        case 357:
          strcpy(String, aRim2xaxis);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 360:
          v16 = aRim0yaxis;
          break;
        case 361:
          strcpy(String, aRim1yaxis);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 362:
          v16 = aRim2yaxis;
          break;
        case 365:
          strcpy(String, aRim0btn1);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 366:
          v16 = aRim0btn2;
          break;
        case 367:
          strcpy(String, aRim0btn3);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 368:
          v16 = aRim0btn4;
          break;
        case 369:
          strcpy(String, aRim0btn5);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 370:
          v16 = aRim1btn1;
          break;
        case 371:
          strcpy(String, aRim1btn2);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 372:
          v16 = aRim1btn3;
          break;
        case 373:
          strcpy(String, aRim1btn4);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 374:
          v16 = aRim1btn5;
          break;
        case 375:
          strcpy(String, aRim2btn1);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 376:
          v16 = aRim2btn2;
          break;
        case 377:
          strcpy(String, aRim2btn3);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        case 378:
          v16 = aRim2btn4;
          break;
        case 379:
          strcpy(String, aRim2btn5);
          v15 = String;
          v12 = v139;
          goto LABEL_283;
        default:
          if ( v14 <= 355 )
            goto LABEL_134;
          v16 = aRawinput;
          break;
      }
      strcpy(String, v16);
LABEL_134:
      v12 = v139;
      v15 = String;
      goto LABEL_283;
    }
    if ( GetKeyNameTextA(v14 << 16, String, 63) )
    {
      v15 = String;
    }
    else
    {
      switch ( v14 )
      {
        case 1:
          v15 = aDikEscape;
          break;
        case 2:
          v15 = aDik1;
          break;
        case 3:
          v15 = aDik2;
          break;
        case 4:
          v15 = aDik3;
          break;
        case 5:
          v15 = aDik4;
          break;
        case 6:
          v15 = aDik5;
          break;
        case 7:
          v15 = aDik6;
          break;
        case 8:
          v15 = aDik7;
          break;
        case 9:
          v15 = aDik8;
          break;
        case 10:
          v15 = aDik9;
          break;
        case 11:
          v15 = aDik0;
          break;
        case 12:
          v15 = aMinus;
          break;
        case 13:
          v15 = aEquals;
          break;
        case 14:
          v15 = aBack;
          break;
        case 15:
          v15 = (const char *)&off_47186C;
          break;
        case 16:
          v15 = aQ;
          break;
        case 17:
          v15 = aW;
          break;
        case 18:
          v15 = aE;
          break;
        case 19:
          v15 = aR;
          break;
        case 20:
          v15 = aT;
          break;
        case 21:
          v15 = aY;
          break;
        case 22:
          v15 = aU;
          break;
        case 23:
          v15 = aI;
          break;
        case 24:
          v15 = aO;
          break;
        case 25:
          v15 = aP;
          break;
        case 26:
          v15 = aLbracket;
          break;
        case 27:
          v15 = aRbracket;
          break;
        case 28:
          v15 = aReturn;
          break;
        case 29:
          v15 = aLcontrol;
          break;
        case 30:
          v15 = aA;
          break;
        case 31:
          v15 = aS_3;
          break;
        case 32:
          v15 = aD_1;
          break;
        case 33:
          v15 = asc_471808;
          break;
        case 34:
          v15 = aG;
          break;
        case 35:
          v15 = asc_471800;
          break;
        case 36:
          v15 = aJ;
          break;
        case 37:
          v15 = aK;
          break;
        case 38:
          v15 = asc_4717F4;
          break;
        case 39:
          v15 = aSemicolon;
          break;
        case 40:
          v15 = aApostrophe;
          break;
        case 41:
          v15 = aGrave;
          break;
        case 42:
          v15 = aLshift;
          break;
        case 43:
          v15 = aBackslash;
          break;
        case 44:
          v15 = aZ;
          break;
        case 45:
          v15 = asc_4717B8;
          break;
        case 46:
          v15 = aC;
          break;
        case 47:
          v15 = aV;
          break;
        case 48:
          v15 = aB;
          break;
        case 49:
          v15 = aN;
          break;
        case 50:
          v15 = aM;
          break;
        case 51:
          v15 = aComma;
          break;
        case 52:
          v15 = aPeriod;
          break;
        case 53:
          v15 = aSlash;
          break;
        case 54:
          v15 = aRshift;
          break;
        case 55:
          v15 = aMultiply;
          break;
        case 56:
          v15 = aLmenu;
          break;
        case 57:
          v15 = aSpace;
          break;
        case 58:
          v15 = aCapital;
          break;
        case 59:
          v15 = aF1;
          break;
        case 60:
          v15 = aF2;
          break;
        case 61:
          v15 = aF3;
          break;
        case 62:
          v15 = aF4;
          break;
        case 63:
          v15 = aF5;
          break;
        case 64:
          v15 = aF6;
          break;
        case 65:
          v15 = aF7;
          break;
        case 66:
          v15 = aF8;
          break;
        case 67:
          v15 = aF9;
          break;
        case 68:
          v15 = aF10;
          break;
        case 69:
          v15 = aNumlock;
          break;
        case 70:
          v15 = aScroll;
          break;
        case 71:
          v15 = aNumpad7;
          break;
        case 72:
          v15 = aNumpad8;
          break;
        case 73:
          v15 = aNumpad9;
          break;
        case 74:
          v15 = aSubtract;
          break;
        case 75:
          v15 = aNumpad4;
          break;
        case 76:
          v15 = aNumpad5;
          break;
        case 77:
          v15 = aNumpad6;
          break;
        case 78:
          v15 = (const char *)&off_4716E8;
          break;
        case 79:
          v15 = aNumpad1;
          break;
        case 80:
          v15 = aNumpad2;
          break;
        case 81:
          v15 = aNumpad3;
          break;
        case 82:
          v15 = aNumpad0;
          break;
        case 83:
          v15 = aDecimal;
          break;
        case 86:
          v15 = aOem102;
          break;
        case 87:
          v15 = aF11;
          break;
        case 88:
          v15 = aF12;
          break;
        case 100:
          v15 = aF13;
          break;
        case 101:
          v15 = aF14;
          break;
        case 102:
          v15 = aF15;
          break;
        case 112:
          v15 = aKana;
          break;
        case 115:
          v15 = aAbntC1;
          break;
        case 121:
          v15 = aConvert;
          break;
        case 123:
          v15 = aNoconvert;
          break;
        case 125:
          v15 = aYen;
          break;
        case 126:
          v15 = aAbntC2;
          break;
        case 141:
          v15 = aNumpadequals;
          break;
        case 144:
          v15 = aPrevtrack;
          break;
        case 145:
          v15 = aAt;
          break;
        case 146:
          v15 = aColon;
          break;
        case 147:
          v15 = aUnderline;
          break;
        case 148:
          v15 = aKanji;
          break;
        case 149:
          v15 = aStop;
          break;
        case 150:
          v15 = aAx;
          break;
        case 151:
          v15 = aUnlabeled;
          break;
        case 153:
          v15 = aNexttrack;
          break;
        case 156:
          v15 = aNumpadenter;
          break;
        case 157:
          v15 = aRcontrol;
          break;
        case 160:
          v15 = aMute;
          break;
        case 161:
          v15 = aCalculator;
          break;
        case 162:
          v15 = aPlaypause;
          break;
        case 164:
          v15 = aMediastop;
          break;
        case 174:
          v15 = aVolumedown;
          break;
        case 176:
          v15 = aVolumeup;
          break;
        case 178:
          v15 = aWebhome;
          break;
        case 179:
          v15 = aNumpadcomma;
          break;
        case 181:
          v15 = aDivide;
          break;
        case 183:
          v15 = aSysrq;
          break;
        case 184:
          v15 = aRmenu;
          break;
        case 197:
          v15 = aPause;
          break;
        case 199:
          v15 = aHome;
          break;
        case 200:
          v15 = aUp;
          break;
        case 201:
          v15 = aPrior;
          break;
        case 203:
          v15 = aLeft;
          break;
        case 205:
          v15 = aRight;
          break;
        case 207:
          v15 = (const char *)&off_47155C;
          break;
        case 208:
          v15 = aDown;
          break;
        case 209:
          v15 = aNext;
          break;
        case 210:
          v15 = aInsert;
          break;
        case 211:
          v15 = aDelete;
          break;
        case 219:
          v15 = aLwin;
          break;
        case 220:
          v15 = aRwin;
          break;
        case 221:
          v15 = aApps;
          break;
        case 222:
          v15 = aPower;
          break;
        case 223:
          v15 = aSleep;
          break;
        case 227:
          v15 = aWake;
          break;
        case 229:
          v15 = aWebsearch;
          break;
        case 230:
          v15 = aWebfavorites;
          break;
        case 231:
          v15 = aWebrefresh;
          break;
        case 232:
          v15 = aWebstop;
          break;
        case 233:
          v15 = aWebforward;
          break;
        case 234:
          v15 = aWebback;
          break;
        case 235:
          v15 = aMycomputer;
          break;
        case 236:
          v15 = aMail;
          break;
        case 237:
          v15 = aMediaselect;
          break;
        default:
          v15 = aUnknown;
          break;
      }
    }
LABEL_283:
    ++v0;
    *v13 = (int)strdup_malloc(v15);
  }
  while ( v0 < 13 );
  v17 = 4 * v0;
  if ( dword_4D7898[v17] )
    crt_free((LPVOID)dword_4D7898[v17]);
  v18 = config_p1_move_forward[LODWORD(v12)];
  if ( v18 <= 255 )
  {
    if ( GetKeyNameTextA(v18 << 16, String, 63) )
    {
      v19 = String;
    }
    else
    {
      switch ( v18 )
      {
        case 1:
          v19 = aDikEscape;
          break;
        case 2:
          v19 = aDik1;
          break;
        case 3:
          v19 = aDik2;
          break;
        case 4:
          v19 = aDik3;
          break;
        case 5:
          v19 = aDik4;
          break;
        case 6:
          v19 = aDik5;
          break;
        case 7:
          v19 = aDik6;
          break;
        case 8:
          v19 = aDik7;
          break;
        case 9:
          v19 = aDik8;
          break;
        case 10:
          v19 = aDik9;
          break;
        case 11:
          v19 = aDik0;
          break;
        case 12:
          v19 = aMinus;
          break;
        case 13:
          v19 = aEquals;
          break;
        case 14:
          v19 = aBack;
          break;
        case 15:
          v19 = (const char *)&off_47186C;
          break;
        case 16:
          v19 = aQ;
          break;
        case 17:
          v19 = aW;
          break;
        case 18:
          v19 = aE;
          break;
        case 19:
          v19 = aR;
          break;
        case 20:
          v19 = aT;
          break;
        case 21:
          v19 = aY;
          break;
        case 22:
          v19 = aU;
          break;
        case 23:
          v19 = aI;
          break;
        case 24:
          v19 = aO;
          break;
        case 25:
          v19 = aP;
          break;
        case 26:
          v19 = aLbracket;
          break;
        case 27:
          v19 = aRbracket;
          break;
        case 28:
          v19 = aReturn;
          break;
        case 29:
          v19 = aLcontrol;
          break;
        case 30:
          v19 = aA;
          break;
        case 31:
          v19 = aS_3;
          break;
        case 32:
          v19 = aD_1;
          break;
        case 33:
          v19 = asc_471808;
          break;
        case 34:
          v19 = aG;
          break;
        case 35:
          v19 = asc_471800;
          break;
        case 36:
          v19 = aJ;
          break;
        case 37:
          v19 = aK;
          break;
        case 38:
          v19 = asc_4717F4;
          break;
        case 39:
          v19 = aSemicolon;
          break;
        case 40:
          v19 = aApostrophe;
          break;
        case 41:
          v19 = aGrave;
          break;
        case 42:
          v19 = aLshift;
          break;
        case 43:
          v19 = aBackslash;
          break;
        case 44:
          v19 = aZ;
          break;
        case 45:
          v19 = asc_4717B8;
          break;
        case 46:
          v19 = aC;
          break;
        case 47:
          v19 = aV;
          break;
        case 48:
          v19 = aB;
          break;
        case 49:
          v19 = aN;
          break;
        case 50:
          v19 = aM;
          break;
        case 51:
          v19 = aComma;
          break;
        case 52:
          v19 = aPeriod;
          break;
        case 53:
          v19 = aSlash;
          break;
        case 54:
          v19 = aRshift;
          break;
        case 55:
          v19 = aMultiply;
          break;
        case 56:
          v19 = aLmenu;
          break;
        case 57:
          v19 = aSpace;
          break;
        case 58:
          v19 = aCapital;
          break;
        case 59:
          v19 = aF1;
          break;
        case 60:
          v19 = aF2;
          break;
        case 61:
          v19 = aF3;
          break;
        case 62:
          v19 = aF4;
          break;
        case 63:
          v19 = aF5;
          break;
        case 64:
          v19 = aF6;
          break;
        case 65:
          v19 = aF7;
          break;
        case 66:
          v19 = aF8;
          break;
        case 67:
          v19 = aF9;
          break;
        case 68:
          v19 = aF10;
          break;
        case 69:
          v19 = aNumlock;
          break;
        case 70:
          v19 = aScroll;
          break;
        case 71:
          v19 = aNumpad7;
          break;
        case 72:
          v19 = aNumpad8;
          break;
        case 73:
          v19 = aNumpad9;
          break;
        case 74:
          v19 = aSubtract;
          break;
        case 75:
          v19 = aNumpad4;
          break;
        case 76:
          v19 = aNumpad5;
          break;
        case 77:
          v19 = aNumpad6;
          break;
        case 78:
          v19 = (const char *)&off_4716E8;
          break;
        case 79:
          v19 = aNumpad1;
          break;
        case 80:
          v19 = aNumpad2;
          break;
        case 81:
          v19 = aNumpad3;
          break;
        case 82:
          v19 = aNumpad0;
          break;
        case 83:
          v19 = aDecimal;
          break;
        case 86:
          v19 = aOem102;
          break;
        case 87:
          v19 = aF11;
          break;
        case 88:
          v19 = aF12;
          break;
        case 100:
          v19 = aF13;
          break;
        case 101:
          v19 = aF14;
          break;
        case 102:
          v19 = aF15;
          break;
        case 112:
          v19 = aKana;
          break;
        case 115:
          v19 = aAbntC1;
          break;
        case 121:
          v19 = aConvert;
          break;
        case 123:
          v19 = aNoconvert;
          break;
        case 125:
          v19 = aYen;
          break;
        case 126:
          v19 = aAbntC2;
          break;
        case 141:
          v19 = aNumpadequals;
          break;
        case 144:
          v19 = aPrevtrack;
          break;
        case 145:
          v19 = aAt;
          break;
        case 146:
          v19 = aColon;
          break;
        case 147:
          v19 = aUnderline;
          break;
        case 148:
          v19 = aKanji;
          break;
        case 149:
          v19 = aStop;
          break;
        case 150:
          v19 = aAx;
          break;
        case 151:
          v19 = aUnlabeled;
          break;
        case 153:
          v19 = aNexttrack;
          break;
        case 156:
          v19 = aNumpadenter;
          break;
        case 157:
          v19 = aRcontrol;
          break;
        case 160:
          v19 = aMute;
          break;
        case 161:
          v19 = aCalculator;
          break;
        case 162:
          v19 = aPlaypause;
          break;
        case 164:
          v19 = aMediastop;
          break;
        case 174:
          v19 = aVolumedown;
          break;
        case 176:
          v19 = aVolumeup;
          break;
        case 178:
          v19 = aWebhome;
          break;
        case 179:
          v19 = aNumpadcomma;
          break;
        case 181:
          v19 = aDivide;
          break;
        case 183:
          v19 = aSysrq;
          break;
        case 184:
          v19 = aRmenu;
          break;
        case 197:
          v19 = aPause;
          break;
        case 199:
          v19 = aHome;
          break;
        case 200:
          v19 = aUp;
          break;
        case 201:
          v19 = aPrior;
          break;
        case 203:
          v19 = aLeft;
          break;
        case 205:
          v19 = aRight;
          break;
        case 207:
          v19 = (const char *)&off_47155C;
          break;
        case 208:
          v19 = aDown;
          break;
        case 209:
          v19 = aNext;
          break;
        case 210:
          v19 = aInsert;
          break;
        case 211:
          v19 = aDelete;
          break;
        case 219:
          v19 = aLwin;
          break;
        case 220:
          v19 = aRwin;
          break;
        case 221:
          v19 = aApps;
          break;
        case 222:
          v19 = aPower;
          break;
        case 223:
          v19 = aSleep;
          break;
        case 227:
          v19 = aWake;
          break;
        case 229:
          v19 = aWebsearch;
          break;
        case 230:
          v19 = aWebfavorites;
          break;
        case 231:
          v19 = aWebrefresh;
          break;
        case 232:
          v19 = aWebstop;
          break;
        case 233:
          v19 = aWebforward;
          break;
        case 234:
          v19 = aWebback;
          break;
        case 235:
          v19 = aMycomputer;
          break;
        case 236:
          v19 = aMail;
          break;
        case 237:
          v19 = aMediaselect;
          break;
        default:
          v19 = aUnknown;
          break;
      }
    }
  }
  else
  {
    switch ( v18 )
    {
      case 256:
        v19 = strcpy(String, aMouse1);
        break;
      case 257:
        v20 = aMouse2;
        goto LABEL_391;
      case 258:
        v19 = strcpy(String, aMouse3);
        break;
      case 259:
        v20 = aMouse4;
        goto LABEL_391;
      case 260:
        v19 = strcpy(String, aMouse5);
        break;
      case 265:
        v20 = aMwheelup;
        goto LABEL_391;
      case 266:
        v19 = strcpy(String, aMwheeldown);
        break;
      case 287:
        v20 = aJoys1;
        goto LABEL_391;
      case 288:
        v19 = strcpy(String, aJoys2);
        break;
      case 289:
        v20 = aJoys3;
        goto LABEL_391;
      case 290:
        v19 = strcpy(String, aJoys4);
        break;
      case 291:
        v20 = aJoys5;
        goto LABEL_391;
      case 292:
        v19 = strcpy(String, aJoys6);
        break;
      case 293:
        v20 = aJoys7;
        goto LABEL_391;
      case 294:
        v19 = strcpy(String, aJoys8);
        break;
      case 295:
        v20 = aJoys9;
        goto LABEL_391;
      case 296:
        v19 = strcpy(String, aJoys10);
        break;
      case 297:
        v20 = aJoys11;
        goto LABEL_391;
      case 298:
        v19 = strcpy(String, aJoys12);
        break;
      case 305:
        v20 = aJoysup;
        goto LABEL_391;
      case 306:
        v19 = strcpy(String, aJoysdown);
        break;
      case 307:
        v20 = aJoysleft;
        goto LABEL_391;
      case 308:
        v19 = strcpy(String, aJoysright);
        break;
      case 319:
        v20 = aJoyaxisx;
        goto LABEL_391;
      case 320:
        v19 = strcpy(String, aJoyaxisy);
        break;
      case 321:
        v20 = aJoyaxisz;
        goto LABEL_391;
      case 339:
        v19 = strcpy(String, aJoyrotx);
        break;
      case 340:
        v20 = aJoyroty;
        goto LABEL_391;
      case 341:
        v19 = strcpy(String, aJoyrotz);
        break;
      case 382:
        v20 = aUnbound;
        goto LABEL_391;
      case 355:
        v19 = strcpy(String, aRim0xaxis);
        break;
      case 356:
        v20 = aRim1xaxis;
        goto LABEL_391;
      case 357:
        v19 = strcpy(String, aRim2xaxis);
        break;
      case 360:
        v20 = aRim0yaxis;
        goto LABEL_391;
      case 361:
        v19 = strcpy(String, aRim1yaxis);
        break;
      case 362:
        v20 = aRim2yaxis;
        goto LABEL_391;
      case 365:
        v19 = strcpy(String, aRim0btn1);
        break;
      case 366:
        v20 = aRim0btn2;
        goto LABEL_391;
      case 367:
        v19 = strcpy(String, aRim0btn3);
        break;
      case 368:
        v20 = aRim0btn4;
        goto LABEL_391;
      case 369:
        v19 = strcpy(String, aRim0btn5);
        break;
      case 370:
        v20 = aRim1btn1;
        goto LABEL_391;
      case 371:
        v19 = strcpy(String, aRim1btn2);
        break;
      case 372:
        v20 = aRim1btn3;
        goto LABEL_391;
      case 373:
        v19 = strcpy(String, aRim1btn4);
        break;
      case 374:
        v20 = aRim1btn5;
        goto LABEL_391;
      case 375:
        v19 = strcpy(String, aRim2btn1);
        break;
      case 376:
        v20 = aRim2btn2;
        goto LABEL_391;
      case 377:
        v19 = strcpy(String, aRim2btn3);
        break;
      case 378:
        v20 = aRim2btn4;
        goto LABEL_391;
      case 379:
        v19 = strcpy(String, aRim2btn5);
        break;
      default:
        if ( v18 > 355 )
        {
          v20 = aRawinput;
LABEL_391:
          strcpy(String, v20);
        }
        v19 = String;
        break;
    }
  }
  dword_4D7898[v17] = (int)strdup_malloc(v19);
  if ( dword_4D7968 )
    crt_free((LPVOID)dword_4D7968);
  v21 = config_key_pick_perk;
  if ( config_key_pick_perk <= 255 )
  {
    if ( GetKeyNameTextA(config_key_pick_perk << 16, String, 63) )
    {
      v22 = String;
    }
    else
    {
      switch ( v21 )
      {
        case 1:
          v22 = aDikEscape;
          break;
        case 2:
          v22 = aDik1;
          break;
        case 3:
          v22 = aDik2;
          break;
        case 4:
          v22 = aDik3;
          break;
        case 5:
          v22 = aDik4;
          break;
        case 6:
          v22 = aDik5;
          break;
        case 7:
          v22 = aDik6;
          break;
        case 8:
          v22 = aDik7;
          break;
        case 9:
          v22 = aDik8;
          break;
        case 10:
          v22 = aDik9;
          break;
        case 11:
          v22 = aDik0;
          break;
        case 12:
          v22 = aMinus;
          break;
        case 13:
          v22 = aEquals;
          break;
        case 14:
          v22 = aBack;
          break;
        case 15:
          v22 = (const char *)&off_47186C;
          break;
        case 16:
          v22 = aQ;
          break;
        case 17:
          v22 = aW;
          break;
        case 18:
          v22 = aE;
          break;
        case 19:
          v22 = aR;
          break;
        case 20:
          v22 = aT;
          break;
        case 21:
          v22 = aY;
          break;
        case 22:
          v22 = aU;
          break;
        case 23:
          v22 = aI;
          break;
        case 24:
          v22 = aO;
          break;
        case 25:
          v22 = aP;
          break;
        case 26:
          v22 = aLbracket;
          break;
        case 27:
          v22 = aRbracket;
          break;
        case 28:
          v22 = aReturn;
          break;
        case 29:
          v22 = aLcontrol;
          break;
        case 30:
          v22 = aA;
          break;
        case 31:
          v22 = aS_3;
          break;
        case 32:
          v22 = aD_1;
          break;
        case 33:
          v22 = asc_471808;
          break;
        case 34:
          v22 = aG;
          break;
        case 35:
          v22 = asc_471800;
          break;
        case 36:
          v22 = aJ;
          break;
        case 37:
          v22 = aK;
          break;
        case 38:
          v22 = asc_4717F4;
          break;
        case 39:
          v22 = aSemicolon;
          break;
        case 40:
          v22 = aApostrophe;
          break;
        case 41:
          v22 = aGrave;
          break;
        case 42:
          v22 = aLshift;
          break;
        case 43:
          v22 = aBackslash;
          break;
        case 44:
          v22 = aZ;
          break;
        case 45:
          v22 = asc_4717B8;
          break;
        case 46:
          v22 = aC;
          break;
        case 47:
          v22 = aV;
          break;
        case 48:
          v22 = aB;
          break;
        case 49:
          v22 = aN;
          break;
        case 50:
          v22 = aM;
          break;
        case 51:
          v22 = aComma;
          break;
        case 52:
          v22 = aPeriod;
          break;
        case 53:
          v22 = aSlash;
          break;
        case 54:
          v22 = aRshift;
          break;
        case 55:
          v22 = aMultiply;
          break;
        case 56:
          v22 = aLmenu;
          break;
        case 57:
          v22 = aSpace;
          break;
        case 58:
          v22 = aCapital;
          break;
        case 59:
          v22 = aF1;
          break;
        case 60:
          v22 = aF2;
          break;
        case 61:
          v22 = aF3;
          break;
        case 62:
          v22 = aF4;
          break;
        case 63:
          v22 = aF5;
          break;
        case 64:
          v22 = aF6;
          break;
        case 65:
          v22 = aF7;
          break;
        case 66:
          v22 = aF8;
          break;
        case 67:
          v22 = aF9;
          break;
        case 68:
          v22 = aF10;
          break;
        case 69:
          v22 = aNumlock;
          break;
        case 70:
          v22 = aScroll;
          break;
        case 71:
          v22 = aNumpad7;
          break;
        case 72:
          v22 = aNumpad8;
          break;
        case 73:
          v22 = aNumpad9;
          break;
        case 74:
          v22 = aSubtract;
          break;
        case 75:
          v22 = aNumpad4;
          break;
        case 76:
          v22 = aNumpad5;
          break;
        case 77:
          v22 = aNumpad6;
          break;
        case 78:
          v22 = (const char *)&off_4716E8;
          break;
        case 79:
          v22 = aNumpad1;
          break;
        case 80:
          v22 = aNumpad2;
          break;
        case 81:
          v22 = aNumpad3;
          break;
        case 82:
          v22 = aNumpad0;
          break;
        case 83:
          v22 = aDecimal;
          break;
        case 86:
          v22 = aOem102;
          break;
        case 87:
          v22 = aF11;
          break;
        case 88:
          v22 = aF12;
          break;
        case 100:
          v22 = aF13;
          break;
        case 101:
          v22 = aF14;
          break;
        case 102:
          v22 = aF15;
          break;
        case 112:
          v22 = aKana;
          break;
        case 115:
          v22 = aAbntC1;
          break;
        case 121:
          v22 = aConvert;
          break;
        case 123:
          v22 = aNoconvert;
          break;
        case 125:
          v22 = aYen;
          break;
        case 126:
          v22 = aAbntC2;
          break;
        case 141:
          v22 = aNumpadequals;
          break;
        case 144:
          v22 = aPrevtrack;
          break;
        case 145:
          v22 = aAt;
          break;
        case 146:
          v22 = aColon;
          break;
        case 147:
          v22 = aUnderline;
          break;
        case 148:
          v22 = aKanji;
          break;
        case 149:
          v22 = aStop;
          break;
        case 150:
          v22 = aAx;
          break;
        case 151:
          v22 = aUnlabeled;
          break;
        case 153:
          v22 = aNexttrack;
          break;
        case 156:
          v22 = aNumpadenter;
          break;
        case 157:
          v22 = aRcontrol;
          break;
        case 160:
          v22 = aMute;
          break;
        case 161:
          v22 = aCalculator;
          break;
        case 162:
          v22 = aPlaypause;
          break;
        case 164:
          v22 = aMediastop;
          break;
        case 174:
          v22 = aVolumedown;
          break;
        case 176:
          v22 = aVolumeup;
          break;
        case 178:
          v22 = aWebhome;
          break;
        case 179:
          v22 = aNumpadcomma;
          break;
        case 181:
          v22 = aDivide;
          break;
        case 183:
          v22 = aSysrq;
          break;
        case 184:
          v22 = aRmenu;
          break;
        case 197:
          v22 = aPause;
          break;
        case 199:
          v22 = aHome;
          break;
        case 200:
          v22 = aUp;
          break;
        case 201:
          v22 = aPrior;
          break;
        case 203:
          v22 = aLeft;
          break;
        case 205:
          v22 = aRight;
          break;
        case 207:
          v22 = (const char *)&off_47155C;
          break;
        case 208:
          v22 = aDown;
          break;
        case 209:
          v22 = aNext;
          break;
        case 210:
          v22 = aInsert;
          break;
        case 211:
          v22 = aDelete;
          break;
        case 219:
          v22 = aLwin;
          break;
        case 220:
          v22 = aRwin;
          break;
        case 221:
          v22 = aApps;
          break;
        case 222:
          v22 = aPower;
          break;
        case 223:
          v22 = aSleep;
          break;
        case 227:
          v22 = aWake;
          break;
        case 229:
          v22 = aWebsearch;
          break;
        case 230:
          v22 = aWebfavorites;
          break;
        case 231:
          v22 = aWebrefresh;
          break;
        case 232:
          v22 = aWebstop;
          break;
        case 233:
          v22 = aWebforward;
          break;
        case 234:
          v22 = aWebback;
          break;
        case 235:
          v22 = aMycomputer;
          break;
        case 236:
          v22 = aMail;
          break;
        case 237:
          v22 = aMediaselect;
          break;
        default:
          v22 = aUnknown;
          break;
      }
    }
  }
  else
  {
    switch ( config_key_pick_perk )
    {
      case 256:
        strcpy(String, aMouse1);
        v22 = String;
        break;
      case 257:
        v23 = aMouse2;
        goto LABEL_648;
      case 258:
        strcpy(String, aMouse3);
        v22 = String;
        break;
      case 259:
        v23 = aMouse4;
        goto LABEL_648;
      case 260:
        strcpy(String, aMouse5);
        v22 = String;
        break;
      case 265:
        v23 = aMwheelup;
        goto LABEL_648;
      case 266:
        strcpy(String, aMwheeldown);
        v22 = String;
        break;
      case 287:
        v23 = aJoys1;
        goto LABEL_648;
      case 288:
        strcpy(String, aJoys2);
        v22 = String;
        break;
      case 289:
        v23 = aJoys3;
        goto LABEL_648;
      case 290:
        strcpy(String, aJoys4);
        v22 = String;
        break;
      case 291:
        v23 = aJoys5;
        goto LABEL_648;
      case 292:
        strcpy(String, aJoys6);
        v22 = String;
        break;
      case 293:
        v23 = aJoys7;
        goto LABEL_648;
      case 294:
        strcpy(String, aJoys8);
        v22 = String;
        break;
      case 295:
        v23 = aJoys9;
        goto LABEL_648;
      case 296:
        strcpy(String, aJoys10);
        v22 = String;
        break;
      case 297:
        v23 = aJoys11;
        goto LABEL_648;
      case 298:
        strcpy(String, aJoys12);
        v22 = String;
        break;
      case 305:
        v23 = aJoysup;
        goto LABEL_648;
      case 306:
        strcpy(String, aJoysdown);
        v22 = String;
        break;
      case 307:
        v23 = aJoysleft;
        goto LABEL_648;
      case 308:
        strcpy(String, aJoysright);
        v22 = String;
        break;
      case 319:
        v23 = aJoyaxisx;
        goto LABEL_648;
      case 320:
        strcpy(String, aJoyaxisy);
        v22 = String;
        break;
      case 321:
        v23 = aJoyaxisz;
        goto LABEL_648;
      case 339:
        strcpy(String, aJoyrotx);
        v22 = String;
        break;
      case 340:
        v23 = aJoyroty;
        goto LABEL_648;
      case 341:
        strcpy(String, aJoyrotz);
        v22 = String;
        break;
      case 382:
        v23 = aUnbound;
        goto LABEL_648;
      case 355:
        strcpy(String, aRim0xaxis);
        v22 = String;
        break;
      case 356:
        v23 = aRim1xaxis;
        goto LABEL_648;
      case 357:
        strcpy(String, aRim2xaxis);
        v22 = String;
        break;
      case 360:
        v23 = aRim0yaxis;
        goto LABEL_648;
      case 361:
        strcpy(String, aRim1yaxis);
        v22 = String;
        break;
      case 362:
        v23 = aRim2yaxis;
        goto LABEL_648;
      case 365:
        strcpy(String, aRim0btn1);
        v22 = String;
        break;
      case 366:
        v23 = aRim0btn2;
        goto LABEL_648;
      case 367:
        strcpy(String, aRim0btn3);
        v22 = String;
        break;
      case 368:
        v23 = aRim0btn4;
        goto LABEL_648;
      case 369:
        strcpy(String, aRim0btn5);
        v22 = String;
        break;
      case 370:
        v23 = aRim1btn1;
        goto LABEL_648;
      case 371:
        strcpy(String, aRim1btn2);
        v22 = String;
        break;
      case 372:
        v23 = aRim1btn3;
        goto LABEL_648;
      case 373:
        strcpy(String, aRim1btn4);
        v22 = String;
        break;
      case 374:
        v23 = aRim1btn5;
        goto LABEL_648;
      case 375:
        strcpy(String, aRim2btn1);
        v22 = String;
        break;
      case 376:
        v23 = aRim2btn2;
        goto LABEL_648;
      case 377:
        strcpy(String, aRim2btn3);
        v22 = String;
        break;
      case 378:
        v23 = aRim2btn4;
        goto LABEL_648;
      case 379:
        strcpy(String, aRim2btn5);
        v22 = String;
        break;
      default:
        if ( config_key_pick_perk > 355 )
        {
          v23 = aRawinput;
LABEL_648:
          strcpy(String, v23);
        }
        v22 = String;
        break;
    }
  }
  dword_4D7968 = (int)strdup_malloc(v22);
  if ( dword_4D7978 )
    crt_free((LPVOID)dword_4D7978);
  v24 = config_key_reload;
  if ( config_key_reload <= 255 )
  {
    if ( GetKeyNameTextA(config_key_reload << 16, String, 63) )
    {
      v25 = String;
    }
    else
    {
      switch ( v24 )
      {
        case 1:
          v25 = aDikEscape;
          break;
        case 2:
          v25 = aDik1;
          break;
        case 3:
          v25 = aDik2;
          break;
        case 4:
          v25 = aDik3;
          break;
        case 5:
          v25 = aDik4;
          break;
        case 6:
          v25 = aDik5;
          break;
        case 7:
          v25 = aDik6;
          break;
        case 8:
          v25 = aDik7;
          break;
        case 9:
          v25 = aDik8;
          break;
        case 10:
          v25 = aDik9;
          break;
        case 11:
          v25 = aDik0;
          break;
        case 12:
          v25 = aMinus;
          break;
        case 13:
          v25 = aEquals;
          break;
        case 14:
          v25 = aBack;
          break;
        case 15:
          v25 = (const char *)&off_47186C;
          break;
        case 16:
          v25 = aQ;
          break;
        case 17:
          v25 = aW;
          break;
        case 18:
          v25 = aE;
          break;
        case 19:
          v25 = aR;
          break;
        case 20:
          v25 = aT;
          break;
        case 21:
          v25 = aY;
          break;
        case 22:
          v25 = aU;
          break;
        case 23:
          v25 = aI;
          break;
        case 24:
          v25 = aO;
          break;
        case 25:
          v25 = aP;
          break;
        case 26:
          v25 = aLbracket;
          break;
        case 27:
          v25 = aRbracket;
          break;
        case 28:
          v25 = aReturn;
          break;
        case 29:
          v25 = aLcontrol;
          break;
        case 30:
          v25 = aA;
          break;
        case 31:
          v25 = aS_3;
          break;
        case 32:
          v25 = aD_1;
          break;
        case 33:
          v25 = asc_471808;
          break;
        case 34:
          v25 = aG;
          break;
        case 35:
          v25 = asc_471800;
          break;
        case 36:
          v25 = aJ;
          break;
        case 37:
          v25 = aK;
          break;
        case 38:
          v25 = asc_4717F4;
          break;
        case 39:
          v25 = aSemicolon;
          break;
        case 40:
          v25 = aApostrophe;
          break;
        case 41:
          v25 = aGrave;
          break;
        case 42:
          v25 = aLshift;
          break;
        case 43:
          v25 = aBackslash;
          break;
        case 44:
          v25 = aZ;
          break;
        case 45:
          v25 = asc_4717B8;
          break;
        case 46:
          v25 = aC;
          break;
        case 47:
          v25 = aV;
          break;
        case 48:
          v25 = aB;
          break;
        case 49:
          v25 = aN;
          break;
        case 50:
          v25 = aM;
          break;
        case 51:
          v25 = aComma;
          break;
        case 52:
          v25 = aPeriod;
          break;
        case 53:
          v25 = aSlash;
          break;
        case 54:
          v25 = aRshift;
          break;
        case 55:
          v25 = aMultiply;
          break;
        case 56:
          v25 = aLmenu;
          break;
        case 57:
          v25 = aSpace;
          break;
        case 58:
          v25 = aCapital;
          break;
        case 59:
          v25 = aF1;
          break;
        case 60:
          v25 = aF2;
          break;
        case 61:
          v25 = aF3;
          break;
        case 62:
          v25 = aF4;
          break;
        case 63:
          v25 = aF5;
          break;
        case 64:
          v25 = aF6;
          break;
        case 65:
          v25 = aF7;
          break;
        case 66:
          v25 = aF8;
          break;
        case 67:
          v25 = aF9;
          break;
        case 68:
          v25 = aF10;
          break;
        case 69:
          v25 = aNumlock;
          break;
        case 70:
          v25 = aScroll;
          break;
        case 71:
          v25 = aNumpad7;
          break;
        case 72:
          v25 = aNumpad8;
          break;
        case 73:
          v25 = aNumpad9;
          break;
        case 74:
          v25 = aSubtract;
          break;
        case 75:
          v25 = aNumpad4;
          break;
        case 76:
          v25 = aNumpad5;
          break;
        case 77:
          v25 = aNumpad6;
          break;
        case 78:
          v25 = (const char *)&off_4716E8;
          break;
        case 79:
          v25 = aNumpad1;
          break;
        case 80:
          v25 = aNumpad2;
          break;
        case 81:
          v25 = aNumpad3;
          break;
        case 82:
          v25 = aNumpad0;
          break;
        case 83:
          v25 = aDecimal;
          break;
        case 86:
          v25 = aOem102;
          break;
        case 87:
          v25 = aF11;
          break;
        case 88:
          v25 = aF12;
          break;
        case 100:
          v25 = aF13;
          break;
        case 101:
          v25 = aF14;
          break;
        case 102:
          v25 = aF15;
          break;
        case 112:
          v25 = aKana;
          break;
        case 115:
          v25 = aAbntC1;
          break;
        case 121:
          v25 = aConvert;
          break;
        case 123:
          v25 = aNoconvert;
          break;
        case 125:
          v25 = aYen;
          break;
        case 126:
          v25 = aAbntC2;
          break;
        case 141:
          v25 = aNumpadequals;
          break;
        case 144:
          v25 = aPrevtrack;
          break;
        case 145:
          v25 = aAt;
          break;
        case 146:
          v25 = aColon;
          break;
        case 147:
          v25 = aUnderline;
          break;
        case 148:
          v25 = aKanji;
          break;
        case 149:
          v25 = aStop;
          break;
        case 150:
          v25 = aAx;
          break;
        case 151:
          v25 = aUnlabeled;
          break;
        case 153:
          v25 = aNexttrack;
          break;
        case 156:
          v25 = aNumpadenter;
          break;
        case 157:
          v25 = aRcontrol;
          break;
        case 160:
          v25 = aMute;
          break;
        case 161:
          v25 = aCalculator;
          break;
        case 162:
          v25 = aPlaypause;
          break;
        case 164:
          v25 = aMediastop;
          break;
        case 174:
          v25 = aVolumedown;
          break;
        case 176:
          v25 = aVolumeup;
          break;
        case 178:
          v25 = aWebhome;
          break;
        case 179:
          v25 = aNumpadcomma;
          break;
        case 181:
          v25 = aDivide;
          break;
        case 183:
          v25 = aSysrq;
          break;
        case 184:
          v25 = aRmenu;
          break;
        case 197:
          v25 = aPause;
          break;
        case 199:
          v25 = aHome;
          break;
        case 200:
          v25 = aUp;
          break;
        case 201:
          v25 = aPrior;
          break;
        case 203:
          v25 = aLeft;
          break;
        case 205:
          v25 = aRight;
          break;
        case 207:
          v25 = (const char *)&off_47155C;
          break;
        case 208:
          v25 = aDown;
          break;
        case 209:
          v25 = aNext;
          break;
        case 210:
          v25 = aInsert;
          break;
        case 211:
          v25 = aDelete;
          break;
        case 219:
          v25 = aLwin;
          break;
        case 220:
          v25 = aRwin;
          break;
        case 221:
          v25 = aApps;
          break;
        case 222:
          v25 = aPower;
          break;
        case 223:
          v25 = aSleep;
          break;
        case 227:
          v25 = aWake;
          break;
        case 229:
          v25 = aWebsearch;
          break;
        case 230:
          v25 = aWebfavorites;
          break;
        case 231:
          v25 = aWebrefresh;
          break;
        case 232:
          v25 = aWebstop;
          break;
        case 233:
          v25 = aWebforward;
          break;
        case 234:
          v25 = aWebback;
          break;
        case 235:
          v25 = aMycomputer;
          break;
        case 236:
          v25 = aMail;
          break;
        case 237:
          v25 = aMediaselect;
          break;
        default:
          v25 = aUnknown;
          break;
      }
    }
  }
  else
  {
    switch ( config_key_reload )
    {
      case 256:
        v25 = strcpy(String, aMouse1);
        break;
      case 257:
        v26 = aMouse2;
        goto LABEL_905;
      case 258:
        v25 = strcpy(String, aMouse3);
        break;
      case 259:
        v26 = aMouse4;
        goto LABEL_905;
      case 260:
        v25 = strcpy(String, aMouse5);
        break;
      case 265:
        v26 = aMwheelup;
        goto LABEL_905;
      case 266:
        v25 = strcpy(String, aMwheeldown);
        break;
      case 287:
        v26 = aJoys1;
        goto LABEL_905;
      case 288:
        v25 = strcpy(String, aJoys2);
        break;
      case 289:
        v26 = aJoys3;
        goto LABEL_905;
      case 290:
        v25 = strcpy(String, aJoys4);
        break;
      case 291:
        v26 = aJoys5;
        goto LABEL_905;
      case 292:
        v25 = strcpy(String, aJoys6);
        break;
      case 293:
        v26 = aJoys7;
        goto LABEL_905;
      case 294:
        v25 = strcpy(String, aJoys8);
        break;
      case 295:
        v26 = aJoys9;
        goto LABEL_905;
      case 296:
        v25 = strcpy(String, aJoys10);
        break;
      case 297:
        v26 = aJoys11;
        goto LABEL_905;
      case 298:
        v25 = strcpy(String, aJoys12);
        break;
      case 305:
        v26 = aJoysup;
        goto LABEL_905;
      case 306:
        v25 = strcpy(String, aJoysdown);
        break;
      case 307:
        v26 = aJoysleft;
        goto LABEL_905;
      case 308:
        v25 = strcpy(String, aJoysright);
        break;
      case 319:
        v26 = aJoyaxisx;
        goto LABEL_905;
      case 320:
        v25 = strcpy(String, aJoyaxisy);
        break;
      case 321:
        v26 = aJoyaxisz;
        goto LABEL_905;
      case 339:
        v25 = strcpy(String, aJoyrotx);
        break;
      case 340:
        v26 = aJoyroty;
        goto LABEL_905;
      case 341:
        v25 = strcpy(String, aJoyrotz);
        break;
      case 382:
        v26 = aUnbound;
        goto LABEL_905;
      case 355:
        v25 = strcpy(String, aRim0xaxis);
        break;
      case 356:
        v26 = aRim1xaxis;
        goto LABEL_905;
      case 357:
        v25 = strcpy(String, aRim2xaxis);
        break;
      case 360:
        v26 = aRim0yaxis;
        goto LABEL_905;
      case 361:
        v25 = strcpy(String, aRim1yaxis);
        break;
      case 362:
        v26 = aRim2yaxis;
        goto LABEL_905;
      case 365:
        v25 = strcpy(String, aRim0btn1);
        break;
      case 366:
        v26 = aRim0btn2;
        goto LABEL_905;
      case 367:
        v25 = strcpy(String, aRim0btn3);
        break;
      case 368:
        v26 = aRim0btn4;
        goto LABEL_905;
      case 369:
        v25 = strcpy(String, aRim0btn5);
        break;
      case 370:
        v26 = aRim1btn1;
        goto LABEL_905;
      case 371:
        v25 = strcpy(String, aRim1btn2);
        break;
      case 372:
        v26 = aRim1btn3;
        goto LABEL_905;
      case 373:
        v25 = strcpy(String, aRim1btn4);
        break;
      case 374:
        v26 = aRim1btn5;
        goto LABEL_905;
      case 375:
        v25 = strcpy(String, aRim2btn1);
        break;
      case 376:
        v26 = aRim2btn2;
        goto LABEL_905;
      case 377:
        v25 = strcpy(String, aRim2btn3);
        break;
      case 378:
        v26 = aRim2btn4;
        goto LABEL_905;
      case 379:
        v25 = strcpy(String, aRim2btn5);
        break;
      default:
        if ( config_key_reload > 355 )
        {
          v26 = aRawinput;
LABEL_905:
          strcpy(String, v26);
        }
        v25 = String;
        break;
    }
  }
  dword_4D7978 = (int)strdup_malloc(v25);
  v27 = dword_478E64;
  if ( dword_478E64 != -1 )
  {
    if ( dword_4D7898[4 * dword_478E64] )
    {
      crt_free((LPVOID)dword_4D7898[4 * dword_478E64]);
      v27 = dword_478E64;
    }
    v28 = 4 * v27;
    dword_4D7898[v28] = (int)strdup_malloc(asc_478884);
    byte_4D789E[v28 * 4] = 0;
  }
  flt_496604 = 0.69999999;
  v147[0] = dword_4965F8;
  v141 = v141 - 14.0;
  v147[2] = dword_496600;
  v147[1] = dword_4965FC;
  v147[3] = 1060320051;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v141)),
    COERCE_FLOAT(LODWORD(v142)),
    aAiming);
  (*(void (__thiscall **)(int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, v147);
  v145 = 0.0;
  v146 = 13.0;
  v29 = *(_DWORD *)grim_interface_ptr;
  v30 = FUN_0044ecf0(&v139, &v145);
  (*(void (__thiscall **)(int, int, int, int))(v29 + 212))(grim_interface_ptr, v30, 1130627072, 1065353216);
  v142 = v142 + 18.0;
  v141 = v141 + 8.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  if ( config_aim_scheme[dword_4D79DC] == 1 )
  {
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aTorsoLeft);
    v145 = 128.0;
    v146 = 0.0;
    v31 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(v29, v31, (int)&arg3, v103, v115, v127);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aTorsoRight);
    v145 = 128.0;
    v146 = 0.0;
    v32 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(v29, v32, (int)&flt_4D7918, v104, v116, v128);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
  }
  if ( config_aim_scheme[dword_4D79DC] == 4 )
  {
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aAimUpDownAxis);
    v145 = 128.0;
    v146 = 0.0;
    v33 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v33, (int)&flt_4D7928, v103, v115, v127);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aAimLeftRightAx);
    v145 = 128.0;
    v146 = 0.0;
    v34 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v34, (int)&flt_4D7938, v105, v117, v129);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
  }
  (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v141)),
    COERCE_FLOAT(LODWORD(v142)),
    aFire);
  v145 = 128.0;
  v146 = 0.0;
  v35 = (float *)FUN_0044ecf0(&v139, &v145);
  ui_menu_item_update(4, v35, (int)&flt_4D78D8, v103, v115, v127);
  v142 = v142 + 16.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  v142 = v142 + 8.0;
  v141 = v141 - 8.0;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
    grim_interface_ptr,
    COERCE_FLOAT(LODWORD(v141)),
    COERCE_FLOAT(LODWORD(v142)),
    aMoving);
  (*(void (__thiscall **)(int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, v147);
  v145 = 0.0;
  v146 = 13.0;
  v36 = *(_DWORD *)grim_interface_ptr;
  v37 = FUN_0044ecf0(&v139, &v145);
  (*(void (__thiscall **)(int, int, int, int))(v36 + 212))(grim_interface_ptr, v37, 1130627072, 1065353216);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1060320051);
  v38 = config_player_mode_flags[dword_4D79DC];
  v141 = v141 + 8.0;
  v142 = v142 + 18.0;
  if ( v38 == 2 )
  {
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aMoveUp);
    v145 = 128.0;
    v146 = 0.0;
    v39 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v39, (int)dword_4D7898, v106, v118, v130);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aMoveDown);
    v145 = 128.0;
    v146 = 0.0;
    v40 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v40, (int)&flt_4D78A8, v107, v119, v131);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aMoveLeft);
    v145 = 128.0;
    v146 = 0.0;
    v41 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v41, (int)&flt_4D78B8, v108, v120, v132);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aMoveRight);
    v145 = 128.0;
    v146 = 0.0;
    v42 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v42, (int)&flt_4D78C8, v109, v121, v133);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
  }
  if ( config_player_mode_flags[dword_4D79DC] == 1 )
  {
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aForward);
    v145 = 128.0;
    v146 = 0.0;
    v43 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v43, (int)dword_4D7898, v106, v118, v130);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aBackwards);
    v145 = 128.0;
    v146 = 0.0;
    v44 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v44, (int)&flt_4D78A8, v110, v122, v134);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aTurnLeft);
    v145 = 128.0;
    v146 = 0.0;
    v45 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v45, (int)&flt_4D78B8, v111, v123, v135);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aTurnRight);
    v145 = 128.0;
    v146 = 0.0;
    v46 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v46, (int)&flt_4D78C8, v112, v124, v136);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
  }
  if ( config_player_mode_flags[dword_4D79DC] == 4 )
  {
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aMoveToCursor);
    v145 = 128.0;
    v146 = 0.0;
    v47 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v47, (int)&dword_4D7978, v106, v118, v130);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
  }
  if ( config_player_mode_flags[dword_4D79DC] == 3 )
  {
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aUpDownAxis);
    v145 = 128.0;
    v146 = 0.0;
    v48 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v48, (int)&flt_4D7948, v106, v118, v130);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aLeftRightAxis);
    v145 = 128.0;
    v146 = 0.0;
    v49 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v49, (int)&flt_4D7958, v113, v125, v137);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
  }
  v142 = v142 + 8.0;
  v141 = v141 - 8.0;
  if ( !dword_4D79DC )
  {
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1065353216);
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aMisc);
    (*(void (__thiscall **)(int, _DWORD *))(*(_DWORD *)grim_interface_ptr + 272))(grim_interface_ptr, v147);
    v145 = 0.0;
    v146 = 13.0;
    v50 = *(_DWORD *)grim_interface_ptr;
    v51 = FUN_0044ecf0(&v139, &v145);
    (*(void (__thiscall **)(int, int, int, int))(v50 + 212))(grim_interface_ptr, v51, 1130627072, 1065353216);
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    v142 = v142 + 18.0;
    v141 = v141 + 8.0;
    (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      COERCE_FLOAT(LODWORD(v141)),
      COERCE_FLOAT(LODWORD(v142)),
      aLevelUp);
    v145 = 128.0;
    v146 = 0.0;
    v52 = (float *)FUN_0044ecf0(&v139, &v145);
    ui_menu_item_update(4, v52, (int)&dword_4D7968, v106, v118, v130);
    v142 = v142 + 16.0;
    (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      1060320051);
    if ( config_player_mode_flags[dword_4D79DC] != 4 )
    {
      (*(void (__cdecl **)(int, float, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        COERCE_FLOAT(LODWORD(v141)),
        COERCE_FLOAT(LODWORD(v142)),
        aReload);
      v145 = 128.0;
      v146 = 0.0;
      v53 = (float *)FUN_0044ecf0(&v139, &v145);
      ui_menu_item_update(4, v53, (int)&dword_4D7978, v114, v126, v138);
      v142 = v142 + 16.0;
      (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
        grim_interface_ptr,
        1065353216,
        1065353216,
        1065353216,
        1060320051);
    }
    v142 = v142 + 8.0;
    v141 = v141 - 8.0;
  }
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1063675494);
  v54 = dword_478E64;
  v141 = v141 - 27.0;
  if ( dword_478E64 != -1 )
  {
    if ( dword_478E64 < 9 || dword_478E64 >= 13 )
    {
      v142 = v142 + 12.0;
      v93 = v141 + 54.0;
      (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v93),
        COERCE_FLOAT(LODWORD(v142)),
        aAssignControlE);
      v99 = v142 + 13.0;
      v94 = v141 + 54.0;
      (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v94),
        LODWORD(v99),
        aPressEscapeToC);
      v54 = dword_478E64;
    }
    else
    {
      v142 = v142 + 12.0;
      v90 = v141 + 54.0;
      (*(void (__cdecl **)(int, _DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v90),
        COERCE_FLOAT(LODWORD(v142)),
        aMoveJoystickPa);
      v97 = v142 + 13.0;
      v91 = v141 + 54.0;
      (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v91),
        LODWORD(v97),
        aAxisYouWantToA);
      v98 = v142 + 26.0;
      v92 = v141 + 54.0;
      (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v92),
        LODWORD(v98),
        aPressEscapeToC);
      v54 = dword_478E64;
    }
  }
  v55 = byte_4D79E0;
  v56 = 0;
  v57 = (char *)&unk_4D789D;
  v141 = v141 + 27.0;
  do
  {
    if ( *v57 )
    {
      v55 = 0;
      v58 = v54 == -1;
      v54 = -1;
      if ( v58 )
        v54 = v56;
    }
    v57 += 16;
    ++v56;
  }
  while ( (int)v57 < (int)&byte_4D798D );
  dword_478E64 = v54;
  byte_4D79E0 = v55;
  if ( v54 != -1 )
  {
    if ( v54 < 9 || v54 >= 13 )
    {
      if ( !input_any_key_pressed() )
        byte_4D79E0 = 1;
      if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1) )
      {
        byte_4871CA = 0;
        dword_478E64 = -1;
        byte_4D79E0 = 0;
      }
      else if ( byte_4D79E0 )
      {
        v73 = 2;
        if ( dword_478E64 >= 13 )
        {
          do
          {
            if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                   grim_interface_ptr,
                   v73) )
            {
              (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
              if ( dword_478E64 == 13 )
                config_key_pick_perk = v73;
              else
                config_key_reload = v73;
              dword_478E64 = -1;
              byte_4D79E0 = 0;
            }
            ++v73;
          }
          while ( v73 < 383 );
          v77 = sub_448B50();
          if ( v77 )
          {
            if ( dword_478E64 == 13 )
              config_key_pick_perk = v77;
            else
              config_key_reload = v77;
          }
        }
        else
        {
          do
          {
            if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 128))(
                   grim_interface_ptr,
                   v73) )
            {
              (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
              v74 = dword_478E64 + 16 * dword_4D79DC;
              dword_478E64 = -1;
              byte_4D79E0 = 0;
              config_p1_move_forward[v74] = v73;
            }
            ++v73;
          }
          while ( v73 < 383 );
          v75 = sub_448B50();
          if ( v75 )
          {
            v76 = dword_478E64 + 16 * dword_4D79DC;
            dword_478E64 = -1;
            byte_4D79E0 = 0;
            config_p1_move_forward[v76] = v75;
          }
        }
      }
    }
    else
    {
      if ( !v55 && !input_any_key_pressed() )
      {
        byte_4D79E0 = 1;
        memset(&flt_4D79E4, 0, 0x40u);
      }
      if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1) )
      {
        byte_4871CA = 0;
        goto LABEL_1093;
      }
      if ( byte_4D79E0 )
      {
        v139 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
                 grim_interface_ptr,
                 319);
        LODWORD(v139) &= ~0x80000000;
        if ( flt_4D79E4 <= (double)v139 )
          v59 = v139;
        else
          v59 = flt_4D79E4;
        flt_4D79E4 = v59;
        v139 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
                 grim_interface_ptr,
                 320);
        LODWORD(v139) &= ~0x80000000;
        if ( flt_4D79E8 <= (double)v139 )
          v60 = v139;
        else
          v60 = flt_4D79E8;
        flt_4D79E8 = v60;
        v139 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
                 grim_interface_ptr,
                 321);
        LODWORD(v139) &= ~0x80000000;
        if ( flt_4D79EC <= (double)v139 )
          v61 = v139;
        else
          v61 = flt_4D79EC;
        flt_4D79EC = v61;
        v139 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
                 grim_interface_ptr,
                 339);
        LODWORD(v139) &= ~0x80000000;
        if ( flt_4D79F0 <= (double)v139 )
          v62 = v139;
        else
          v62 = flt_4D79F0;
        flt_4D79F0 = v62;
        v139 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
                 grim_interface_ptr,
                 340);
        LODWORD(v139) &= ~0x80000000;
        if ( flt_4D79F4 <= (double)v139 )
          v63 = v139;
        else
          v63 = flt_4D79F4;
        flt_4D79F4 = v63;
        v139 = ((double (__thiscall *)(int, int))*(_DWORD *)(*(_DWORD *)grim_interface_ptr + 132))(
                 grim_interface_ptr,
                 341);
        LODWORD(v139) &= ~0x80000000;
        if ( flt_4D79F8 <= (double)v139 )
          v64 = v139;
        else
          v64 = flt_4D79F8;
        flt_4D79F8 = v64;
        v65 = 0;
        v66 = &flt_4D79E4;
        while ( *v66 <= 0.5 )
        {
          ++v66;
          ++v65;
          if ( (int)v66 >= (int)flt_4D7A00 )
            goto LABEL_1146;
        }
        v67 = dword_478E64 + 16 * dword_4D79DC;
        switch ( v65 )
        {
          case 0:
            v68 = grim_interface_ptr;
            config_p1_move_forward[v67] = 319;
            (*(void (__thiscall **)(int))(*(_DWORD *)v68 + 76))(v68);
            break;
          case 1:
            v69 = grim_interface_ptr;
            config_p1_move_forward[v67] = 320;
            (*(void (__thiscall **)(int))(*(_DWORD *)v69 + 76))(v69);
            break;
          case 2:
            v70 = grim_interface_ptr;
            config_p1_move_forward[v67] = 321;
            (*(void (__thiscall **)(int))(*(_DWORD *)v70 + 76))(v70);
            break;
          case 3:
            v71 = grim_interface_ptr;
            config_p1_move_forward[v67] = 339;
            (*(void (__thiscall **)(int))(*(_DWORD *)v71 + 76))(v71);
            break;
          case 4:
            v72 = grim_interface_ptr;
            config_p1_move_forward[v67] = 340;
            (*(void (__thiscall **)(int))(*(_DWORD *)v72 + 76))(v72);
            break;
          case 5:
            config_p1_move_forward[v67] = 341;
            goto LABEL_1124;
          default:
LABEL_1124:
            (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 76))(grim_interface_ptr);
            break;
        }
LABEL_1093:
        dword_478E64 = -1;
        byte_4D79E0 = 0;
      }
    }
  }
LABEL_1146:
  byte_4D7638 = 1;
  byte_4D76A8 = 1;
  byte_4D7660 = 1;
  byte_4D77F1 = 0;
  if ( dword_4D763C )
  {
    byte_4D76A8 = 0;
    byte_4D7660 = 0;
  }
  if ( dword_4D7664 )
  {
    byte_4D76A8 = 0;
    byte_4D7638 = 0;
  }
  if ( dword_4D76AC )
  {
    byte_4D7638 = 0;
    byte_4D7660 = 0;
  }
  if ( dword_4D763C || dword_4D76AC )
    byte_4D77F1 = 1;
  v145 = 10.0;
  v146 = 104.0;
  v78 = (float *)FUN_0044ecf0(&v139, &v145);
  v79 = ui_list_widget_update(v78, (int)&byte_4D7638);
  if ( v79 > -2
    && (input_primary_just_pressed()
     || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)) )
  {
    dword_4D763C = 1 - dword_4D763C;
    if ( v79 >= 0 )
    {
      dword_4D7640 = v79;
      config_player_mode_flags[dword_4D79DC] = v79 + 1;
    }
  }
  v145 = 10.0;
  v146 = 62.0;
  v80 = (float *)FUN_0044ecf0(&v139, &v145);
  v81 = ui_list_widget_update(v80, (int)&byte_4D76A8);
  if ( v81 > -2
    && (input_primary_just_pressed()
     || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)) )
  {
    dword_4D76AC = 1 - dword_4D76AC;
    if ( v81 >= 0 )
    {
      dword_4D76B0 = v81;
      config_aim_scheme[dword_4D79DC] = v81;
    }
  }
  v145 = 136.0;
  v146 = 16.0;
  v82 = (float *)FUN_0044ecf0(&v139, &v145);
  result = ui_list_widget_update(v82, (int)&byte_4D7660);
  v84 = result;
  if ( result > -2 )
  {
    if ( input_primary_just_pressed()
      || (result = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28),
          (_BYTE)result) )
    {
      result = 1 - dword_4D7664;
      dword_4D7664 = 1 - dword_4D7664;
      if ( v84 >= 0 )
      {
        v85 = config_aim_scheme[v84];
        v86 = config_player_mode_flags[v84] - 1;
        dword_4D7668 = v84;
        dword_4D79DC = v84;
        dword_4D76B0 = v85;
        dword_4D7640 = v86;
      }
    }
  }
  return result;
}

// FUN_0044ecf0 @ 0x0044ECF0
// [binja] float* __thiscall sub_44ecf0(float* arg1, float* arg2, float* arg3)
float *FUN_0044ecf0(float *arg1, float *arg2, float *arg3)
{
  float *v3; // ecx
  double v4; // st7

  v4 = arg2[1] + v3[1];
  *arg1 = *arg2 + *v3;
  arg1[1] = v4;
  return arg1;
}

// nullsub_89 @ 0x0044ED10
void __cdecl nullsub_89()
{
  ;
}

// nullsub_90 @ 0x0044ED20
void __cdecl nullsub_90()
{
  ;
}

// nullsub_91 @ 0x0044ED30
void __cdecl nullsub_91()
{
  ;
}

// nullsub_92 @ 0x0044ED40
void __cdecl nullsub_92()
{
  ;
}

// nullsub_93 @ 0x0044ED50
void __cdecl nullsub_93()
{
  ;
}

// nullsub_94 @ 0x0044ED60
void __cdecl nullsub_94()
{
  ;
}

// nullsub_95 @ 0x0044ED70
void __cdecl nullsub_95()
{
  ;
}

// sub_44ED80 @ 0x0044ED80
char sub_44ED80()
{
  int v0; // ecx
  int *v1; // eax
  int v2; // edx
  double v3; // st7
  int v4; // ecx
  int *v5; // eax
  int v6; // edx
  std::codecvt_base *v7; // ecx
  int v8; // esi
  int v9; // eax
  char result; // al
  float v11; // [esp+108h] [ebp-44h]
  float v12; // [esp+108h] [ebp-44h]
  float v13; // [esp+108h] [ebp-44h]
  float v14; // [esp+108h] [ebp-44h]
  float v15; // [esp+108h] [ebp-44h]
  float v16; // [esp+108h] [ebp-44h]
  float v17; // [esp+108h] [ebp-44h]
  float v18; // [esp+108h] [ebp-44h]
  int v19; // [esp+10Ch] [ebp-40h]
  float v20; // [esp+10Ch] [ebp-40h]
  int v21; // [esp+10Ch] [ebp-40h]
  float v22; // [esp+10Ch] [ebp-40h]
  float v23; // [esp+10Ch] [ebp-40h]
  float v24; // [esp+10Ch] [ebp-40h]
  float v25; // [esp+10Ch] [ebp-40h]
  float v26; // [esp+10Ch] [ebp-40h]
  float v27; // [esp+10Ch] [ebp-40h]
  float v28; // [esp+10Ch] [ebp-40h]
  float v29; // [esp+10Ch] [ebp-40h]
  int v30; // [esp+10Ch] [ebp-40h]
  float v31; // [esp+10Ch] [ebp-40h]
  float v32; // [esp+10Ch] [ebp-40h]
  float v33; // [esp+10Ch] [ebp-40h]
  float v34; // [esp+10Ch] [ebp-40h]
  int v35; // [esp+110h] [ebp-3Ch]
  int v36; // [esp+110h] [ebp-3Ch]
  float v37; // [esp+110h] [ebp-3Ch]
  int v38; // [esp+110h] [ebp-3Ch]
  float v39; // [esp+110h] [ebp-3Ch]
  int v40; // [esp+114h] [ebp-38h]
  int v41; // [esp+114h] [ebp-38h]
  int v42; // [esp+114h] [ebp-38h]
  float v43; // [esp+114h] [ebp-38h]
  float v44; // [esp+114h] [ebp-38h]
  float v45; // [esp+114h] [ebp-38h]
  float v46; // [esp+114h] [ebp-38h]
  float v47; // [esp+114h] [ebp-38h]
  char v48; // [esp+123h] [ebp-29h]
  float v49; // [esp+124h] [ebp-28h] BYREF
  float v50; // [esp+128h] [ebp-24h]
  float v51; // [esp+12Ch] [ebp-20h]
  float v52; // [esp+130h] [ebp-1Ch]
  float v53; // [esp+134h] [ebp-18h] BYREF
  float v54; // [esp+138h] [ebp-14h]
  _DWORD v55[4]; // [esp+13Ch] [ebp-10h] BYREF

  if ( (byte_4D7730 & 1) == 0 )
  {
    byte_4D75FE = 1;
    byte_4D7730 |= 1u;
    byte_4D760D = 0;
    byte_4D760C = 0;
    dword_4D7608 = 1065353216;
    dword_4D7604 = 0;
    dword_4D75F8 = 0;
    byte_4D75FC = 0;
    byte_4D75FD = 0;
    dword_4D7600 = 0;
    crt_atexit(nullsub_102);
  }
  dword_4D75F8 = (int)aQuests_0;
  if ( (byte_4D7730 & 2) == 0 )
  {
    byte_4D75A6 = 1;
    byte_4D7730 |= 2u;
    byte_4D75B5 = 0;
    byte_4D75B4 = 0;
    dword_4D75B0 = 1065353216;
    dword_4D75AC = 0;
    dword_4D75A0 = 0;
    byte_4D75A4 = 0;
    byte_4D75A5 = 0;
    dword_4D75A8 = 0;
    crt_atexit(nullsub_101);
  }
  dword_4D75A0 = (int)aRush;
  if ( (byte_4D7730 & 4) == 0 )
  {
    byte_4D76CE = 1;
    byte_4D7730 |= 4u;
    byte_4D76DD = 0;
    byte_4D76DC = 0;
    dword_4D76D8 = 1065353216;
    dword_4D76D4 = 0;
    dword_4D76C8 = 0;
    byte_4D76CC = 0;
    byte_4D76CD = 0;
    dword_4D76D0 = 0;
    crt_atexit(nullsub_100);
  }
  dword_4D76C8 = (int)aSurvival;
  if ( (byte_4D7730 & 8) == 0 )
  {
    byte_4D7616 = 1;
    byte_4D7730 |= 8u;
    byte_4D7625 = 0;
    byte_4D7624 = 0;
    dword_4D7620 = 1065353216;
    dword_4D761C = 0;
    dword_4D7610 = 0;
    byte_4D7614 = 0;
    byte_4D7615 = 0;
    dword_4D7618 = 0;
    crt_atexit(nullsub_99);
  }
  dword_4D7610 = (int)aTypOShooter;
  if ( (byte_4D7730 & 0x10) == 0 )
  {
    byte_4D7658 = 0;
    byte_4D7730 |= 0x10u;
    byte_4D7659 = 0;
    byte_4D765A = 0;
    dword_4D765C = 0;
    crt_atexit(nullsub_98);
  }
  dword_4D765C = (int)aHardcore;
  if ( (byte_4D7730 & 0x20) == 0 )
  {
    byte_4D75D6 = 1;
    byte_4D7730 |= 0x20u;
    byte_4D75E5 = 0;
    byte_4D75E4 = 0;
    dword_4D75E0 = 1065353216;
    dword_4D75DC = 0;
    dword_4D75D0 = 0;
    byte_4D75D4 = 0;
    byte_4D75D5 = 0;
    dword_4D75D8 = 0;
    crt_atexit(nullsub_97);
  }
  dword_4D75D0 = (int)aTutorial;
  v54 = *(float *)&dword_4894B4 + flt_4894D8;
  v51 = flt_4894D4 + *(float *)&dword_4894B0 + 330.0;
  v52 = v54 + 50.0;
  v50 = v52;
  v49 = flt_4894A0 - 64.0 + v51;
  v51 = v49;
  (*(void (__thiscall **)(int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 196))(grim_interface_ptr, dword_48F7F4, 0);
  (*(void (__thiscall **)(int, _DWORD, int, int, int))(*(_DWORD *)grim_interface_ptr + 256))(
    grim_interface_ptr,
    0,
    1040187392,
    1065353216,
    1048576000);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    1,
    v19,
    v35,
    v40);
  v20 = v52 - 8.0;
  v11 = v49 - 64.0;
  (*(void (__stdcall **)(_DWORD, _DWORD, int, int))(*(_DWORD *)grim_interface_ptr + 284))(
    LODWORD(v11),
    LODWORD(v20),
    1124073472,
    1107296256);
  (*(void (__thiscall **)(int))(*(_DWORD *)grim_interface_ptr + 240))(grim_interface_ptr);
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    21,
    2,
    v21,
    v36,
    v41);
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1065353216);
  v48 = 0;
  if ( (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 68))(grim_interface_ptr, 59) )
  {
    v48 = 1;
    v37 = v50 + 16.0;
    v22 = v49 + 132.0;
    (*(void (__cdecl **)(int, _DWORD, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 328))(
      grim_interface_ptr,
      LODWORD(v22),
      LODWORD(v37),
      aTimesPlayed);
  }
  if ( quest_unlock_index >= 40 && config_player_count <= 1 )
  {
    v50 = v50 + 26.0;
    if ( dword_485788 + dword_485644 + dword_485784 <= 0 )
    {
      if ( config_player_count == 1 )
        ui_button_update(&v49, (int)&dword_4D75D0);
      v50 = v50 + 28.0;
    }
    ui_button_update(&v49, (int)&dword_4D75F8);
    if ( v48 )
    {
      v4 = 0;
      v5 = &dword_485644;
      do
      {
        v6 = *v5++;
        v4 += v6;
      }
      while ( (int)v5 < (int)dword_4856E4 );
      v26 = v50 + 8.0;
      v15 = v49 + 158.0;
      (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v15),
        LODWORD(v26),
        aD_0,
        v4);
    }
    v50 = v50 + 28.0;
    ui_button_update(&v49, (int)&dword_4D75A0);
    if ( v48 )
    {
      v27 = v50 + 8.0;
      v16 = v49 + 158.0;
      (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v16),
        LODWORD(v27),
        aD_0,
        dword_485788);
    }
    v50 = v50 + 28.0;
    ui_button_update(&v49, (int)&dword_4D76C8);
    if ( v48 )
    {
      v28 = v50 + 8.0;
      v17 = v49 + 158.0;
      (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v17),
        LODWORD(v28),
        aD_0,
        dword_485784);
    }
    v50 = v50 + 28.0;
    if ( game_is_full_version(v7) )
    {
      if ( config_player_count == 1 )
        ui_button_update(&v49, (int)&dword_4D7610);
      if ( v48 )
      {
        v29 = v50 + 8.0;
        v18 = v49 + 158.0;
        (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
          grim_interface_ptr,
          LODWORD(v18),
          LODWORD(v29),
          aD_0,
          dword_48578C);
      }
    }
    v50 = v50 + 28.0;
    if ( dword_485788 + dword_485644 + dword_485784 > 0 )
    {
      ui_button_update(&v49, (int)&dword_4D75D0);
      v3 = v50 + 28.0;
LABEL_52:
      v50 = v3;
    }
  }
  else
  {
    v50 = v50 + 32.0;
    if ( dword_485788 + dword_485644 + dword_485784 <= 0 )
    {
      if ( config_player_count == 1 )
        ui_button_update(&v49, (int)&dword_4D75D0);
      v50 = v50 + 32.0;
    }
    ui_button_update(&v49, (int)&dword_4D75F8);
    if ( v48 )
    {
      v0 = 0;
      v1 = &dword_485644;
      do
      {
        v2 = *v1++;
        v0 += v2;
      }
      while ( (int)v1 < (int)dword_4856E4 );
      v23 = v50 + 8.0;
      v12 = v49 + 158.0;
      (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v12),
        LODWORD(v23),
        aD_0,
        v0);
    }
    v50 = v50 + 32.0;
    ui_button_update(&v49, (int)&dword_4D75A0);
    if ( v48 )
    {
      v24 = v50 + 8.0;
      v13 = v49 + 158.0;
      (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v13),
        LODWORD(v24),
        aD_0,
        dword_485788);
    }
    v50 = v50 + 32.0;
    ui_button_update(&v49, (int)&dword_4D76C8);
    if ( v48 )
    {
      v25 = v50 + 8.0;
      v14 = v49 + 158.0;
      (*(void (**)(int, _DWORD, _DWORD, char *, ...))(*(_DWORD *)grim_interface_ptr + 328))(
        grim_interface_ptr,
        LODWORD(v14),
        LODWORD(v25),
        aD_0,
        dword_485784);
    }
    v50 = v50 + 32.0;
    if ( dword_485788 + dword_485644 + dword_485784 > 0 )
    {
      if ( config_player_count == 1 )
        ui_button_update(&v49, (int)&dword_4D75D0);
      v3 = v50 + 32.0;
      goto LABEL_52;
    }
  }
  v55[0] = a1Player;
  v55[1] = a2Players;
  v55[2] = a3Players;
  v55[3] = a4Players;
  if ( (byte_4D7730 & 0x40) == 0 )
  {
    byte_4D79B8 = 1;
    byte_4D7730 |= 0x40u;
    dword_4D79D0 = 0;
    byte_4D79CC = 0;
    dword_4D79C0 = 0;
    dword_4D79BC = 0;
    dword_4D79C8 = 0;
    dword_4D79C4 = 0;
    crt_atexit(nullsub_96);
  }
  dword_4D79C0 = config_player_count - 1;
  dword_4D79C4 = (int)v55;
  dword_4D79C8 = 2;
  (*(void (__thiscall **)(int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 276))(
    grim_interface_ptr,
    1065353216,
    1065353216,
    1065353216,
    1062165545);
  v53 = v51 + 80.0;
  v54 = v52 + 1.0;
  v8 = ui_list_widget_update(&v53, (int)&byte_4D79B8);
  if ( v8 > -2
    && (input_primary_just_pressed()
     || (*(unsigned __int8 (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 28)) )
  {
    v9 = 1 - dword_4D79BC;
    dword_4D79BC = 1 - dword_4D79BC;
    if ( v8 < 0 )
      goto LABEL_61;
    dword_4D79C0 = v8;
    config_player_count = v8 + 1;
    j_highscore_load_table();
  }
  v9 = dword_4D79BC;
LABEL_61:
  if ( v9 )
  {
    byte_4D76CE = 0;
    byte_4D75A6 = 0;
    byte_4D75FE = 0;
  }
  else
  {
    byte_4D76CE = 1;
    byte_4D75A6 = 1;
    byte_4D75FE = 1;
  }
  v49 = v49 - 55.0;
  v50 = v50 + 16.0;
  (*(void (__thiscall **)(int, int, int, int, int, int))(*(_DWORD *)grim_interface_ptr + 32))(
    grim_interface_ptr,
    24,
    1056964608,
    v30,
    v38,
    v42);
  if ( dword_4D7600 > 0 )
  {
    v43 = (double)dword_4D7600 * 0.00090000004;
    (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v43));
    v31 = v49 - 8.0;
    (*(void (__stdcall **)(_DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
      LODWORD(v31),
      COERCE_FLOAT(LODWORD(v50)),
      aUnlockNewWeapo);
  }
  if ( dword_4D75A8 > 0 )
  {
    v44 = (double)dword_4D75A8 * 0.00090000004;
    (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v44));
    v32 = v49 + 32.0;
    (*(void (__stdcall **)(_DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
      LODWORD(v32),
      COERCE_FLOAT(LODWORD(v50)),
      aFaceARushOfAli);
  }
  if ( dword_4D76D0 > 0 )
  {
    v45 = (double)dword_4D76D0 * 0.00090000004;
    (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v45));
    v33 = v49 + 20.0;
    (*(void (__stdcall **)(_DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
      LODWORD(v33),
      COERCE_FLOAT(LODWORD(v50)),
      aGainPerksAndWe);
  }
  if ( dword_4D7618 > 0 )
  {
    v46 = (double)dword_4D7618 * 0.00090000004;
    (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v46));
    v39 = v50 - 12.0;
    (*(void (__stdcall **)(float, _DWORD, char *))(*(_DWORD *)grim_interface_ptr + 324))(
      COERCE_FLOAT(LODWORD(v49)),
      LODWORD(v39),
      aUseYourTypingS);
  }
  if ( dword_4D75D8 > 0 )
  {
    v47 = (double)dword_4D75D8 * 0.00090000004;
    (*(void (__thiscall **)(int, int, int, int, _DWORD))(*(_DWORD *)grim_interface_ptr + 276))(
      grim_interface_ptr,
      1065353216,
      1065353216,
      1065353216,
      LODWORD(v47));
    v34 = v49 + 38.0;
    (*(void (__stdcall **)(_DWORD, float, char *))(*(_DWORD *)grim_interface_ptr + 324))(
      LODWORD(v34),
      COERCE_FLOAT(LODWORD(v50)),
      aLearnHowToPlay);
  }
  if ( byte_4D7615 )
  {
    render_pass_mode = 0;
    ui_sign_crimson_update_disabled = 0;
    ui_transition_direction = 0;
    game_state_pending = 18;
    config_game_mode = 4;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
    byte_48702C = 1;
  }
  if ( byte_4D75FD )
  {
    ui_transition_direction = 0;
    game_state_pending = 11;
  }
  if ( byte_4D75A5 )
  {
    ui_sign_crimson_update_disabled = 0;
    ui_transition_direction = 0;
    game_state_pending = 9;
    config_game_mode = 2;
    byte_48702C = 1;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
  }
  if ( byte_4D76CD )
  {
    ui_sign_crimson_update_disabled = 0;
    ui_transition_direction = 0;
    game_state_pending = 9;
    config_game_mode = 1;
    byte_48702C = 1;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
  }
  if ( byte_4D75D5 )
  {
    ui_sign_crimson_update_disabled = 0;
    ui_transition_direction = 0;
    game_state_pending = 9;
    config_game_mode = 8;
    byte_48702C = 1;
    sfx_mute_all(music_track_crimson_theme_id);
    sfx_mute_all(music_track_shortie_monk_id);
    sfx_mute_all(music_track_extra_0);
  }
  result = (*(int (__thiscall **)(int, int))(*(_DWORD *)grim_interface_ptr + 72))(grim_interface_ptr, 1);
  if ( result )
    return FUN_00447420();
  return result;
}

// nullsub_96 @ 0x0044FA30
void __cdecl nullsub_96()
{
  ;
}

// nullsub_97 @ 0x0044FA40
void __cdecl nullsub_97()
{
  ;
}

// nullsub_98 @ 0x0044FA50
void __cdecl nullsub_98()
{
  ;
}

// nullsub_99 @ 0x0044FA60
void __cdecl nullsub_99()
{
  ;
}

// nullsub_100 @ 0x0044FA70
void __cdecl nullsub_100()
{
  ;
}

// nullsub_101 @ 0x0044FA80
void __cdecl nullsub_101()
{
  ;
}

// nullsub_102 @ 0x0044FA90
void __cdecl nullsub_102()
{
  ;
}

// FUN_0044faa0 @ 0x0044FAA0
// [binja] char* sub_44faa0(char* arg1)
char *FUN_0044faa0(char *arg1)
{
  char *result; // eax

  result = arg1;
  if ( arg1 )
  {
    *((_DWORD *)arg1 + 71) = -1;
    *((_DWORD *)arg1 + 129) = -1;
    *((_DWORD *)arg1 + 187) = -1;
    *((_DWORD *)arg1 + 8) = 1130954752;
    *((_DWORD *)arg1 + 9) = 1105199104;
    *((_DWORD *)arg1 + 10) = 1138196480;
    *((_DWORD *)arg1 + 191) = 256;
    *((_DWORD *)arg1 + 13) = 0;
    *((_DWORD *)arg1 + 14) = 0;
    *((_DWORD *)arg1 + 11) = 1116209152;
    *((_DWORD *)arg1 + 192) = 0;
    *arg1 = 0;
    *((_DWORD *)arg1 + 12) = 57;
    arg1[756] = 0;
    *((_DWORD *)arg1 + 4) = 300;
    *((_DWORD *)arg1 + 5) = 0;
    arg1[2] = 0;
    *((_DWORD *)arg1 + 1) = 0;
  }
  else
  {
    LOBYTE(result) = console_printf(&console_log_queue, aElemNull);
  }
  return result;
}

// FUN_0044fb50 @ 0x0044FB50
// [binja] float sub_44fb50(float arg1)
float FUN_0044fb50(float arg1)
{
  double v2; // st7
  double v3; // st7
  double v4; // st6
  double v5; // st6
  char v6; // cl
  double v7; // st7
  int v8; // edx
  float *v9; // ecx
  float v11; // [esp+0h] [ebp-8h]
  float v12; // [esp+0h] [ebp-8h]
  float v13; // [esp+4h] [ebp-4h]
  float v14; // [esp+4h] [ebp-4h]
  float v15; // [esp+4h] [ebp-4h]
  float v16; // [esp+4h] [ebp-4h]
  float arg1a; // [esp+Ch] [ebp+4h]

  if ( (_UNKNOWN *)LODWORD(arg1) != &unk_48C300 && (char *)LODWORD(arg1) != &byte_48C618 )
  {
    v13 = *(float *)(LODWORD(arg1) + 64) + *(float *)(LODWORD(arg1) + 28);
    *(float *)(LODWORD(arg1) + 32) = *(float *)(LODWORD(arg1) + 60)
                                   + *(float *)(LODWORD(arg1) + 24)
                                   + *(float *)(LODWORD(arg1) + 32);
    *(float *)(LODWORD(arg1) + 36) = v13 + *(float *)(LODWORD(arg1) + 36);
    v14 = *(float *)(LODWORD(arg1) + 64) + *(float *)(LODWORD(arg1) + 28);
    *(float *)(LODWORD(arg1) + 40) = *(float *)(LODWORD(arg1) + 60)
                                   + *(float *)(LODWORD(arg1) + 24)
                                   + *(float *)(LODWORD(arg1) + 40);
    *(float *)(LODWORD(arg1) + 44) = v14 + *(float *)(LODWORD(arg1) + 44);
    v11 = *(float *)(LODWORD(arg1) + 60) + *(float *)(LODWORD(arg1) + 24);
    v2 = *(float *)(LODWORD(arg1) + 64) + *(float *)(LODWORD(arg1) + 28);
    *(float *)(LODWORD(arg1) + 32) = v11;
    v15 = v2;
    v3 = *(float *)(LODWORD(arg1) + 116) - *(float *)(LODWORD(arg1) + 60);
    *(float *)(LODWORD(arg1) + 36) = v15;
    *(float *)(LODWORD(arg1) + 32) = v3 * 0.54000002 + *(float *)(LODWORD(arg1) + 32);
    v4 = *(float *)(LODWORD(arg1) + 120) - *(float *)(LODWORD(arg1) + 64);
    arg1a = v4;
    *(float *)(LODWORD(arg1) + 36) = v4 * 0.28 + *(float *)(LODWORD(arg1) + 36);
    v12 = *(float *)(LODWORD(arg1) + 116) + *(float *)(LODWORD(arg1) + 24);
    v5 = *(float *)(LODWORD(arg1) + 120) + *(float *)(LODWORD(arg1) + 28);
    *(float *)(LODWORD(arg1) + 40) = v12;
    v6 = *(_BYTE *)(LODWORD(arg1) + 788);
    v16 = v5;
    *(float *)(LODWORD(arg1) + 44) = v16;
    *(float *)(LODWORD(arg1) + 40) = *(float *)(LODWORD(arg1) + 40) - v3 * 0.050000001;
    v7 = *(float *)(LODWORD(arg1) + 44) - arg1a * 0.1;
    *(float *)(LODWORD(arg1) + 44) = v7;
    if ( v6 )
    {
      v8 = 0;
      if ( *(int *)(LODWORD(arg1) + 288) > 0 )
      {
        v9 = (float *)(LODWORD(arg1) + 108);
        do
        {
          v7 = *(v9 - 7);
          v8 += 2;
          *(v9 - 7) = *v9;
          *v9 = v7;
          v9 += 14;
        }
        while ( v8 < *(_DWORD *)(LODWORD(arg1) + 288) );
      }
    }
  }
  return v7;
}

// sub_44FC70 @ 0x0044FC70
HINSTANCE sub_44FC70()
{
  byte_47EA50 = 1;
  shareware_offer_seen_latch = 1;
  return ShellExecuteA(0, Operation, File, 0, 0, 1);
}

// sub_44FCA0 @ 0x0044FCA0
void sub_44FCA0()
{
  byte_4D7A25 = 1;
}

// ui_menu_layout_init @ 0x0044FCB0
// initializes menu UI element layout and text textures
void ui_menu_layout_init()
{
  char *v0; // ebx
  char **v1; // esi
  int v2; // ebp
  int v3; // edi
  int i; // esi
  int v5; // edx
  int v6; // edx
  int v7; // eax
  int v8; // eax
  float v9; // edx
  int v10; // edx
  int v11; // edx
  int v12; // eax
  std::codecvt_base *v13; // ecx
  int v58; // ecx
  int v59; // edx
  int *v60; // eax
  int v66; // edx
  int v67; // esi
  int *v68; // ecx
  float *v83; // edx
  float *v86; // edx
  float *v89; // edx
  int v91; // esi
  int *v92; // eax
  float *v107; // edx
  float *v110; // edx
  float *v113; // edx
  float *v129; // edx
  float *v132; // edx
  float *v135; // edx
  int *v259; // eax
  float *v262; // esi
  char *v263; // [esp-4h] [ebp-84h]
  char *v264; // [esp+0h] [ebp-80h]
  char *v265; // [esp+4h] [ebp-7Ch]
  char *v266; // [esp+8h] [ebp-78h]
  int v267; // [esp+18h] [ebp-68h]
  int v268; // [esp+18h] [ebp-68h]
  int v269; // [esp+18h] [ebp-68h]
  int v270; // [esp+18h] [ebp-68h]
  int v271; // [esp+1Ch] [ebp-64h]
  int v272; // [esp+20h] [ebp-60h]
  int v273; // [esp+20h] [ebp-60h]
  int v274; // [esp+20h] [ebp-60h]
  int v275; // [esp+20h] [ebp-60h]
  int v276; // [esp+20h] [ebp-60h]
  int v277; // [esp+20h] [ebp-60h]
  float v278; // [esp+20h] [ebp-60h]
  int v279; // [esp+20h] [ebp-60h]
  int v280; // [esp+20h] [ebp-60h]
  int v281; // [esp+20h] [ebp-60h]
  int v282; // [esp+20h] [ebp-60h]
  float v283; // [esp+2Ch] [ebp-54h]
  float v284; // [esp+34h] [ebp-4Ch]
  float v285; // [esp+3Ch] [ebp-44h]
  float v286; // [esp+44h] [ebp-3Ch]
  float v287; // [esp+4Ch] [ebp-34h]
  float v288; // [esp+54h] [ebp-2Ch]
  float v289; // [esp+5Ch] [ebp-24h]
  std::codecvt_base *v290; // [esp+60h] [ebp-20h] BYREF
  float v291; // [esp+64h] [ebp-1Ch]
  _BYTE v292[16]; // [esp+70h] [ebp-10h] BYREF

  __asm { fild    config_screen_width }
  screen_fade_alpha = 0.0;
  __asm { fmul    ds:flt_46F7A0 }
  dword_48723C = 0;
  byte_48702C = 0;
  __asm
  {
    fstp    flt_487288
    fild    config_screen_height
  }
  __asm
  {
    fmul    ds:flt_46F7E8
    fstp    flt_48728C
  }
  memset(ui_element_table_end, 0, 0xA4u);
  ui_element_table_end[0] = (int)&ui_sign_crimson;
  dword_48F16C = (int)&byte_4875A8;
  dword_48F170 = (int)&byte_488208;
  dword_48F174 = (int)&byte_4878C0;
  dword_48F178 = (int)&byte_487BD8;
  dword_48F17C = (int)&byte_487EF0;
  if ( *(_BYTE *)(*(int (__thiscall **)(int, std::codecvt_base **, int))(*(_DWORD *)grim_interface_ptr + 36))(
                   grim_interface_ptr,
                   &v290,
                   100) )
  {
    dword_48F180 = (int)&byte_488520;
    dword_48F184 = (int)&byte_488838;
  }
  else
  {
    dword_48F184 = (int)&byte_488520;
    dword_48F180 = (int)&byte_488838;
  }
  dword_48F1E4 = (int)&byte_488B50;
  dword_48F1E8 = (int)&byte_488E68;
  dword_48F190 = (int)&unk_489180;
  dword_48F194 = (int)&byte_489498;
  dword_48F198 = (int)&byte_4897B0;
  dword_48F1A4 = (int)&unk_48A410;
  dword_48F1A8 = (int)&unk_48A728;
  dword_48F1AC = (int)&unk_48AA40;
  dword_48F1B4 = (int)&unk_48AD58;
  dword_48F1B8 = (int)&unk_48B070;
  dword_48F1BC = (int)&unk_48B388;
  dword_48F1C0 = (int)&unk_48B6A0;
  dword_48F1C4 = (int)&byte_48B9B8;
  dword_48F1C8 = (int)&byte_48BCD0;
  dword_48F1CC = (int)&byte_48BFE8;
  dword_48F1D0 = (int)&unk_48C300;
  dword_48F1D4 = (int)&byte_48C618;
  dword_48F1D8 = (int)&byte_48EB38;
  dword_48F1DC = (int)&unk_48C930;
  dword_48F1E0 = (int)&byte_48CC48;
  dword_48F19C = (int)&unk_48CF60;
  dword_48F1A0 = (int)&byte_48D278;
  dword_48F1B0 = (int)&byte_48D590;
  dword_48F188 = (int)&unk_489AC8;
  dword_48F18C = (int)&byte_489DE0;
  dword_48F1EC = (int)&byte_48A0F8;
  dword_48F1F0 = (int)&unk_48D8A8;
  dword_48F1F4 = (int)&byte_48DBC0;
  dword_48F1F8 = (int)&unk_48DED8;
  dword_48F1FC = (int)&byte_48E1F0;
  dword_48F200 = (int)&unk_48E508;
  dword_48F204 = (int)&byte_48E820;
  ui_element_table_start = (int)&byte_48EE50;
  v1 = (char **)ui_element_table_end;
  do
    FUN_0044faa0(*v1++);
  while ( (int)v1 < (int)byte_48F20C );
  qmemcpy(&unk_4872CC, &unk_48FAC0, 0xE8u);
  v272 = *(_DWORD *)config_screen_width + 4;
  __asm { fild    [esp+70h+var_60] }
  dword_4872AC = 1116471296;
  __asm { fstp    [esp+70h+var_60] }
  dword_4872A8 = v273;
  if ( *(int *)config_screen_width <= 640 )
    dword_4872AC = 1114636288;
  dword_48F7F4 = texture_get_or_load_alt(aUiUiItemtextsJ, v0);
  dword_48F7F8 = texture_get_or_load_alt(aUiUiTextreaper, v266);
  dword_48F7FC = texture_get_or_load_alt(aUiUiTextcontro, v265);
  h = texture_get_or_load_alt(aUiUiTextpickap, v264);
  dword_48F804 = texture_get_or_load_alt(aUiUiTextwelldo, v263);
  qmemcpy(&unk_488244, &unk_48FBA8, 0xE8u);
  dword_488220 = -1032847360;
  dword_488224 = 1129447424;
  *(float *)&v290 = 270.0;
  v291 = -38.0;
  ui_element_set_rect((int)&unk_48832C, 124.0, 30.0, (float *)&v290);
  dword_488238 = 48;
  dword_48823C = (int)sub_44FC70;
  if ( (unsigned __int8)game_is_full_version() )
    dword_48823C = (int)sub_447350;
  qmemcpy(&unk_4878FC, &unk_48FBA8, 0xE8u);
  dword_4878D8 = -1032847360;
  dword_4878DC = 1132920832;
  *(float *)&v290 = 270.0;
  v291 = -38.0;
  ui_element_set_rect((int)&unk_4879E4, 124.0, 30.0, (float *)&v290);
  dword_4878F4 = (int)ui_menu_main_click_play_game;
  dword_4878F0 = 25;
  *(float *)&v290 = 270.0;
  qmemcpy(&unk_487C14, &unk_48FBA8, 0xE8u);
  dword_487BF0 = -1032847360;
  dword_487BF4 = 1134886912;
  v291 = -38.0;
  ui_element_set_rect((int)&unk_487CFC, 124.0, 30.0, (float *)&v290);
  dword_487C0C = (int)ui_menu_main_click_options;
  dword_487C08 = 24;
  *(float *)&v290 = 270.0;
  qmemcpy(&unk_487F2C, &unk_48FBA8, 0xE8u);
  dword_487F08 = -1032847360;
  dword_487F0C = 1136852992;
  v291 = -38.0;
  ui_element_set_rect((int)&unk_488014, 124.0, 30.0, (float *)&v290);
  dword_487F24 = (int)sub_447390;
  dword_487F20 = 31;
  v2 = 5;
  if ( *(_BYTE *)(*(int (__thiscall **)(int, std::codecvt_base **, int))(*(_DWORD *)grim_interface_ptr + 36))(
                   grim_interface_ptr,
                   &v290,
                   100) )
  {
    qmemcpy(&unk_48855C, &unk_48FBA8, 0xE8u);
    dword_488538 = -1032847360;
    dword_48853C = 1138819072;
    *(float *)&v290 = 270.0;
    v291 = -38.0;
    ui_element_set_rect((int)&unk_488644, 124.0, 30.0, (float *)&v290);
    dword_488550 = 48;
    dword_488554 = (int)sub_44FCA0;
    v2 = 6;
  }
  qmemcpy(&unk_488874, &unk_48FBA8, 0xE8u);
  *(float *)&v290 = 270.0;
  dword_488850 = -1032847360;
  v274 = 60 * v2 + 150;
  __asm { fild    [esp+78h+var_60] }
  __asm { fstp    [esp+88h+var_64] }
  v291 = -38.0;
  dword_488854 = v271;
  ui_element_set_rect((int)&unk_48895C, 124.0, 30.0, (float *)&v290);
  v3 = 0;
  dword_48886C = (int)ui_menu_main_click_quit;
  dword_488868 = 16;
  v267 = 0;
  for ( i = 2; i <= 7; ++i )
  {
    if ( i == 2 && (unsigned __int8)game_is_full_version() )
    {
      v3 = 4;
      v267 = 4;
    }
    if ( *(_BYTE *)(*(int (__thiscall **)(int, _BYTE *, int))(*(_DWORD *)grim_interface_ptr + 36))(
                     grim_interface_ptr,
                     v292,
                     100) )
    {
      __asm { fild    [esp+78h+var_68] }
      __asm { fmul    ds:flt_46F5DC }
      *(_DWORD *)(ui_element_table_end[i] + 516) = dword_48F7F4;
      v10 = ui_element_table_end[i];
      *(_DWORD *)(v10 + 312) = 0;
      __asm { fst     [esp+78h+var_34] }
      *(float *)&v290 = 0.0;
      __asm { fstp    [esp+78h+var_2C] }
      *(float *)(v10 + 316) = v287;
      v11 = ui_element_table_end[i];
      *(_DWORD *)(v11 + 340) = 1065353216;
      *(float *)(v11 + 344) = v288;
      v12 = ui_element_table_end[i];
      v276 = v3 + 1;
      __asm { fild    [esp+78h+var_60] }
      *(_DWORD *)(v12 + 368) = 1065353216;
      v13 = v290;
      __asm
      {
        fmul    ds:flt_46F5DC
        fst     [esp+78h+var_24]
      }
      __asm { fstp    [esp+78h+var_1C] }
      *(float *)(v12 + 372) = v289;
      v8 = ui_element_table_end[i];
      v9 = v291;
      *(_DWORD *)(v8 + 396) = v13;
    }
    else
    {
      if ( i == 6 )
      {
        v3 = 6;
        v267 = 6;
      }
      __asm { fild    [esp+78h+var_68] }
      __asm { fmul    ds:flt_46F5DC }
      *(_DWORD *)(ui_element_table_end[i] + 516) = dword_48F7F4;
      v5 = ui_element_table_end[i];
      *(_DWORD *)(v5 + 312) = 0;
      __asm { fst     [esp+78h+var_54] }
      __asm { fstp    [esp+78h+var_4C] }
      *(float *)(v5 + 316) = v283;
      v6 = ui_element_table_end[i];
      *(_DWORD *)(v6 + 340) = 1065353216;
      *(float *)(v6 + 344) = v284;
      v7 = ui_element_table_end[i];
      v275 = v3 + 1;
      __asm { fild    [esp+78h+var_60] }
      *(_DWORD *)(v7 + 368) = 1065353216;
      __asm
      {
        fmul    ds:flt_46F5DC
        fst     [esp+78h+var_44]
      }
      __asm { fstp    [esp+78h+var_3C] }
      *(float *)(v7 + 372) = v285;
      v8 = ui_element_table_end[i];
      v9 = v286;
      *(_DWORD *)(v8 + 396) = 0;
    }
    *(float *)(v8 + 400) = v9;
    if ( i == 2 && (unsigned __int8)game_is_full_version() )
      v3 = 0;
    v267 = ++v3;
    if ( v3 == 4 )
    {
      v3 = 5;
      v267 = 5;
    }
  }
  if ( *(int *)config_screen_width > 640 )
  {
    if ( *(int *)config_screen_width > 800 && *(int *)config_screen_width <= 1024 )
    {
      for ( _EAX = 0; _EAX < 112; *(float *)(_EAX + _ECX + 264) = _ET1 )
      {
        _EDX = ui_element_table_end[0];
        __asm
        {
          fld     dword ptr [eax+edx+3Ch]
          fmul    ds:flt_46F5F4
        }
        _ECX = (float *)(_EAX + ui_element_table_end[0] + 60);
        __asm { fstp    dword ptr [ecx] }
        *_ECX = _ET1;
        __asm
        {
          fld     dword ptr [ecx+4]
          fmul    ds:flt_46F5F4
          fstp    dword ptr [ecx+4]
        }
        _ECX[1] = _ET1;
        _ECX = ui_element_table_end[0];
        __asm
        {
          fld     dword ptr [eax+ecx+20Ch]
          fmul    ds:flt_46F5F4
        }
        _ECX = (float *)(_EAX + ui_element_table_end[0] + 524);
        __asm { fstp    dword ptr [ecx] }
        *_ECX = _ET1;
        __asm
        {
          fld     dword ptr [ecx+4]
          fmul    ds:flt_46F5F4
          fstp    dword ptr [ecx+4]
        }
        _ECX[1] = _ET1;
        _EDX = ui_element_table_end[0];
        __asm
        {
          fld     dword ptr [eax+edx+124h]
          fmul    ds:flt_46F5F4
        }
        _ECX = (float *)(_EAX + ui_element_table_end[0] + 292);
        _EAX += 28;
        __asm { fstp    dword ptr [ecx] }
        *_ECX = _ET1;
        __asm
        {
          fld     dword ptr [ecx+4]
          fmul    ds:flt_46F5F4
          fstp    dword ptr [ecx+4]
        }
        _ECX[1] = _ET1;
        _ECX = ui_element_table_end[0];
        __asm
        {
          fld     dword ptr [eax+ecx+20h]
          fadd    ds:flt_46F260
          fstp    dword ptr [eax+ecx+20h]
        }
        *(float *)(_EAX + _ECX + 32) = _ET1;
        _ECX = ui_element_table_end[0];
        __asm
        {
          fld     dword ptr [eax+ecx+1F0h]
          fadd    ds:flt_46F260
          fstp    dword ptr [eax+ecx+1F0h]
        }
        *(float *)(_EAX + _ECX + 496) = _ET1;
        _ECX = ui_element_table_end[0];
        __asm
        {
          fld     dword ptr [eax+ecx+108h]
          fadd    ds:flt_46F260
          fstp    dword ptr [eax+ecx+108h]
        }
      }
    }
  }
  else
  {
    for ( _EAX = 0; _EAX < 112; *(float *)(_EAX + _ECX + 268) = _ET1 )
    {
      _ECX = ui_element_table_end[0];
      __asm
      {
        fld     dword ptr [eax+ecx+3Ch]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + ui_element_table_end[0] + 60);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _EDX = ui_element_table_end[0];
      __asm
      {
        fld     dword ptr [eax+edx+20Ch]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + ui_element_table_end[0] + 524);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = ui_element_table_end[0];
      __asm
      {
        fld     dword ptr [eax+ecx+124h]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + ui_element_table_end[0] + 292);
      _EAX += 28;
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = ui_element_table_end[0];
      __asm
      {
        fld     dword ptr [eax+ecx+20h]
        fadd    ds:flt_46F260
        fstp    dword ptr [eax+ecx+20h]
      }
      *(float *)(_EAX + _ECX + 32) = _ET1;
      _ECX = ui_element_table_end[0];
      __asm
      {
        fld     dword ptr [eax+ecx+1F0h]
        fadd    ds:flt_46F260
        fstp    dword ptr [eax+ecx+1F0h]
      }
      *(float *)(_EAX + _ECX + 496) = _ET1;
      _ECX = ui_element_table_end[0];
      __asm
      {
        fld     dword ptr [eax+ecx+108h]
        fadd    ds:flt_46F260
        fstp    dword ptr [eax+ecx+108h]
      }
      *(float *)(_EAX + _ECX + 264) = _ET1;
      _ECX = dword_48F16C;
      __asm
      {
        fld     dword ptr [eax+ecx+24h]
        fsub    ds:flt_46F280
        fstp    dword ptr [eax+ecx+24h]
      }
      *(float *)(_EAX + _ECX + 36) = _ET1;
      _ECX = dword_48F16C;
      __asm
      {
        fld     dword ptr [eax+ecx+1F4h]
        fsub    ds:flt_46F280
        fstp    dword ptr [eax+ecx+1F4h]
      }
      *(float *)(_EAX + _ECX + 500) = _ET1;
      _ECX = dword_48F16C;
      __asm
      {
        fld     dword ptr [eax+ecx+10Ch]
        fsub    ds:flt_46F280
        fstp    dword ptr [eax+ecx+10Ch]
      }
    }
  }
  v58 = -20;
  v59 = 100;
  v60 = &dword_48F16C;
  v268 = -20;
  do
  {
    *(_DWORD *)(*v60 + 20) += v59;
    *(_DWORD *)(*v60 + 16) += v59;
    if ( v58 > 0 )
    {
      __asm { fild    [esp+78h+var_68] }
      _ESI = *v60;
      __asm
      {
        fsubr   dword ptr [esi+18h]
        fstp    dword ptr [esi+18h]
      }
      *(float *)(_ESI + 24) = _ET1;
    }
    v58 += 20;
    v59 += 100;
    ++v60;
    v268 = v58;
  }
  while ( v58 <= 100 );
  if ( (unsigned __int8)game_is_full_version() )
    byte_486FAA = 1;
  qmemcpy(&flt_488B8C, &unk_48FC90, 0xE8u);
  __asm
  {
    fld     flt_488B70
    fadd    ds:flt_46F7E4
    fstp    [esp+78h+var_20]
    fld     flt_488B74
    fadd    ds:flt_46F2F0
  }
  dword_488B68 = -1036779520;
  dword_488B6C = 1129447424;
  __asm { fstp    [esp+78h+var_1C] }
  dword_488B7C = LODWORD(v291);
  dword_488B84 = 0;
  dword_488B88 = (int)sub_4475D0;
  dword_488B78 = (int)v290;
  dword_488B54 = 1;
  qmemcpy(&unk_488EA4, &unk_48FBA8, 0xE8u);
  dword_488E80 = -1034158080;
  dword_488E84 = 1138163712;
  *(float *)&v290 = 270.0;
  v291 = -38.0;
  ui_element_set_rect((int)&unk_488F8C, 124.0, 30.0, (float *)&v290);
  dword_48906C = dword_48F7F4;
  dword_488FA0 = 0;
  dword_488FA4 = 1063256064;
  dword_488FC0 = 1063256064;
  dword_488FBC = 1065353216;
  dword_488FD8 = 1065353216;
  dword_488FF4 = 0;
  dword_488FDC = 1065353216;
  dword_488FF8 = 1065353216;
  dword_488E9C = (int)FUN_00447420;
  dword_488E6C = 1;
  dword_488E98 = 48;
  qmemcpy(&unk_48B9F4, &unk_48FBA8, 0xE8u);
  dword_48B9D0 = -1032847360;
  dword_48B9D4 = 1129447424;
  qmemcpy(&unk_48BADC, &unk_487CFC, 0xE8u);
  dword_48B9C8 += 100;
  dword_48B9CC += 100;
  dword_48B9EC = (int)ui_menu_main_click_options;
  qmemcpy(&unk_48BD0C, &unk_48FBA8, 0xE8u);
  dword_48BCE8 = -1029701632;
  dword_48BCEC = 1132920832;
  qmemcpy(&unk_48BDF4, &unk_48895C, 0xE8u);
  dword_48BD04 = (int)sub_4474E0;
  dword_48BCE0 += 200;
  dword_48BCE4 += 200;
  qmemcpy(&unk_48C024, &unk_48FBA8, 0xE8u);
  dword_48C000 = -1027080192;
  dword_48C004 = 1134886912;
  qmemcpy(&unk_48C10C, &unk_488F8C, 0xE8u);
  dword_48BFF8 += 300;
  dword_48C318 = -1020329984;
  dword_48BFFC += 300;
  dword_48C31C = 1110704128;
  dword_48C01C = (int)sub_447490;
  dword_48C018 = 48;
  dword_48C304 = 1;
  qmemcpy(&flt_48C654, &unk_48FD78, 0xE8u);
  flt_48C630 = -45.0;
  flt_48C634 = 110.0;
  dword_48C628 += 100;
  dword_48C62C += 100;
  dword_48919C = 1125187584;
  dword_48C61C = 1;
  dword_489198 = -1032847360;
  dword_489184 = 1;
  qmemcpy(&flt_4894D4, &unk_48FE60, 0xE8u);
  *(float *)&v290 = -45.0;
  v291 = 210.0;
  dword_4894B0 = -1036779520;
  dword_4894B4 = 1129447424;
  _EAX = (float *)&unk_4895BC;
  do
  {
    __asm
    {
      fld     dword ptr [eax]
      fadd    ds:flt_46F260
    }
    _EAX += 7;
    __asm { fstp    dword ptr [eax-1Ch] }
    *(_EAX - 7) = _ET1;
    __asm
    {
      fld     dword ptr [eax-18h]
      fadd    ds:flt_46F260
      fstp    dword ptr [eax-18h]
    }
    *(_EAX - 6) = _ET1;
  }
  while ( (int)_EAX < (int)flt_48962C );
  dword_4894D0 = (int)sub_44ED80;
  dword_48949C = 1;
  qmemcpy(&unk_4897EC, &unk_48FBA8, 0xE8u);
  dword_4897CC = 1139212288;
  dword_4897C8 = -1034158080;
  qmemcpy(&unk_4898D4, &unk_488F8C, 0xE8u);
  dword_4897E4 = (int)FUN_00447420;
  dword_48C948 = -1020329984;
  dword_4897B4 = 1;
  dword_4897E0 = 48;
  dword_48C94C = 1110704128;
  dword_48C934 = 1;
  qmemcpy(&flt_48CC84, &unk_48FD78, 0xE8u);
  flt_48CC64 = 110.0;
  flt_48CC60 = -45.0;
  dword_48CC5C += 100;
  dword_48CC58 += 100;
  dword_48CF78 = -1020002304;
  dword_48CF7C = 1124532224;
  v291 = 200.0;
  dword_48CC4C = 1;
  dword_48CF64 = 1;
  *(float *)&v290 = -165.0;
  qmemcpy(&flt_48D2B4, &unk_48FC90, 0xE8u);
  dword_48D294 = 1128792064;
  v66 = *(_DWORD *)config_screen_width;
  dword_48D290 = -1020985344;
  if ( *(int *)config_screen_width <= 640 )
    dword_48D290 = -1019805696;
  dword_48D2B0 = (int)sub_448CD0;
  dword_48D27C = 1;
  qmemcpy(&unk_48D5CC, &unk_48FBA8, 0xE8u);
  dword_48D5A8 = -1021640704;
  dword_48D5AC = 1137836032;
  qmemcpy(&unk_48D6B4, &unk_488F8C, 0xE8u);
  dword_48D8C0 = -1020329984;
  dword_48D8C4 = 1110704128;
  dword_48D5C4 = (int)ui_menu_main_click_options;
  dword_48D594 = 0;
  dword_48D5C0 = 48;
  dword_48D8AC = 1;
  qmemcpy(&flt_48DBFC, &unk_48FD78, 0xE8u);
  flt_48DBD8 = -45.0;
  flt_48DBDC = 110.0;
  dword_48DBD4 += 100;
  dword_48DBD0 += 100;
  dword_48DEF4 = 1123287040;
  dword_48DBC4 = 1;
  dword_48DEF0 = -1022951424;
  dword_48DEDC = 1;
  qmemcpy(&flt_48E22C, &unk_48FD78, 0xE8u);
  dword_48E20C = 1127809024;
  dword_48E208 = -1063256064;
  dword_48E524 = 1123287040;
  dword_48E228 = (int)sub_447D40;
  dword_48E1F4 = 1;
  dword_48E520 = -1022951424;
  dword_48E50C = 1;
  qmemcpy(&flt_48E85C, &unk_48FD78, 0xE8u);
  v291 = 185.0;
  *(float *)&v290 = -5.0;
  flt_48E83C = 185.0;
  flt_48E838 = -5.0;
  dword_48E824 = 1;
  v277 = *(_DWORD *)config_screen_width - 350;
  __asm { fild    [esp+78h+var_60] }
  qmemcpy(&flt_48A134, &unk_48FC90, 0xE8u);
  __asm { fstp    [esp+78h+var_60] }
  flt_48A110 = v278;
  flt_48A114 = 200.0;
  if ( *(int *)config_screen_width <= 800 )
  {
    __asm { fld     [esp+78h+var_60] }
    if ( *(int *)config_screen_width <= 640 )
      __asm { fadd    ds:flt_46F260 }
    else
      __asm { fsub    ds:flt_46F4B0 }
  }
  else
  {
    __asm
    {
      fld     [esp+78h+var_60]
      fsub    ds:flt_46F770
    }
  }
  __asm { fstp    flt_48A110 }
  *(float *)&v290 = -190.0;
  v291 = 122.0;
  dword_48A0FC = 1;
  byte_48A40C = 1;
  dword_489AE4 = 1123287040;
  dword_489AE0 = -1020985344;
  if ( *(int *)config_screen_width <= 640 )
    dword_489AE0 = -1017708544;
  dword_489ACC = 1;
  qmemcpy(&flt_489E1C, &unk_48FD78, 0xE8u);
  *(float *)&v290 = -60.0;
  v291 = 185.0;
  flt_489DFC = 185.0;
  flt_489DF8 = -35.0;
  if ( *(int *)config_screen_width <= 640 )
    flt_489DF8 = -85.0;
  v67 = -11;
  dword_489DE4 = 1;
  dword_48EB48 = 500;
  v68 = &dword_48F16C;
  v269 = -11;
  do
  {
    if ( v66 <= 640 )
    {
      __asm { fild    [esp+78h+var_68] }
      _EAX = 0;
      do
      {
        _EDX = *v68;
        __asm
        {
          fld     dword ptr [edx+eax+3Ch]
          fmul    ds:flt_46F34C
        }
        _EDX = (float *)(*v68 + _EAX + 60);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v68;
        __asm
        {
          fld     dword ptr [edx+eax+20Ch]
          fmul    ds:flt_46F34C
        }
        _EDX = (float *)(*v68 + _EAX + 524);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v68;
        __asm
        {
          fld     dword ptr [edx+eax+124h]
          fmul    ds:flt_46F34C
        }
        _EDX = (float *)(*v68 + _EAX + 292);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v68;
        __asm { fld     dword ptr [edx+eax+40h] }
        v83 = (float *)(*v68 + _EAX + 64);
        __asm
        {
          fsub    st, st(1)
          fstp    dword ptr [edx]
        }
        *v83 = _ET1;
        _EDX = *v68;
        __asm { fld     dword ptr [edx+eax+210h] }
        v86 = (float *)(*v68 + _EAX + 528);
        __asm
        {
          fsub    st, st(1)
          fstp    dword ptr [edx]
        }
        *v86 = _ET1;
        _EDX = *v68;
        __asm { fld     dword ptr [edx+eax+128h] }
        v89 = (float *)(*v68 + _EAX + 296);
        _EAX += 28;
        __asm { fsub    st, st(1) }
        __asm { fstp    dword ptr [edx] }
        *v89 = _ET1;
      }
      while ( _EAX < 112 );
      v66 = *(_DWORD *)config_screen_width;
      __asm { fstp    st }
    }
    v67 += 11;
    ++v68;
    v269 = v67;
  }
  while ( v67 <= 55 );
  v91 = -11;
  v92 = &dword_48F1C0;
  v270 = -5;
  v279 = -11;
  do
  {
    if ( v66 > 640 )
    {
      if ( v66 > 800 )
        goto LABEL_69;
      __asm { fild    [esp+78h+var_68] }
      _ECX = 0;
      do
      {
        _EDX = *v92;
        __asm
        {
          fld     dword ptr [edx+ecx+3Ch]
          fmul    ds:flt_46F34C
        }
        _EDX = (float *)(*v92 + _ECX + 60);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v92;
        __asm
        {
          fld     dword ptr [edx+ecx+20Ch]
          fmul    ds:flt_46F34C
        }
        _EDX = (float *)(*v92 + _ECX + 524);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v92;
        __asm
        {
          fld     dword ptr [edx+ecx+124h]
          fmul    ds:flt_46F34C
        }
        _EDX = (float *)(*v92 + _ECX + 292);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v92;
        __asm { fld     dword ptr [edx+ecx+40h] }
        v129 = (float *)(*v92 + _ECX + 64);
        __asm
        {
          fsub    st, st(1)
          fstp    dword ptr [edx]
        }
        *v129 = _ET1;
        _EDX = *v92;
        __asm { fld     dword ptr [edx+ecx+210h] }
        v132 = (float *)(*v92 + _ECX + 528);
        __asm
        {
          fsub    st, st(1)
          fstp    dword ptr [edx]
        }
        *v132 = _ET1;
        _EDX = *v92;
        __asm { fld     dword ptr [edx+ecx+128h] }
        v135 = (float *)(*v92 + _ECX + 296);
        _ECX += 28;
        __asm { fsub    st, st(1) }
        __asm { fstp    dword ptr [edx] }
        *v135 = _ET1;
      }
      while ( _ECX < 112 );
    }
    else
    {
      __asm { fild    [esp+78h+var_60] }
      _ECX = 0;
      do
      {
        _EDX = *v92;
        __asm
        {
          fld     dword ptr [edx+ecx+3Ch]
          fmul    ds:flt_46F2A4
        }
        _EDX = (float *)(*v92 + _ECX + 60);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F2A4
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v92;
        __asm
        {
          fld     dword ptr [edx+ecx+20Ch]
          fmul    ds:flt_46F2A4
        }
        _EDX = (float *)(*v92 + _ECX + 524);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F2A4
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v92;
        __asm
        {
          fld     dword ptr [edx+ecx+124h]
          fmul    ds:flt_46F2A4
        }
        _EDX = (float *)(*v92 + _ECX + 292);
        __asm { fstp    dword ptr [edx] }
        *_EDX = _ET1;
        __asm
        {
          fld     dword ptr [edx+4]
          fmul    ds:flt_46F2A4
          fstp    dword ptr [edx+4]
        }
        _EDX[1] = _ET1;
        _EDX = *v92;
        __asm { fld     dword ptr [edx+ecx+40h] }
        v107 = (float *)(*v92 + _ECX + 64);
        __asm
        {
          fsub    st, st(1)
          fstp    dword ptr [edx]
        }
        *v107 = _ET1;
        _EDX = *v92;
        __asm { fld     dword ptr [edx+ecx+210h] }
        v110 = (float *)(*v92 + _ECX + 528);
        __asm
        {
          fsub    st, st(1)
          fstp    dword ptr [edx]
        }
        *v110 = _ET1;
        _EDX = *v92;
        __asm { fld     dword ptr [edx+ecx+128h] }
        v113 = (float *)(*v92 + _ECX + 296);
        _ECX += 28;
        __asm { fsub    st, st(1) }
        __asm { fstp    dword ptr [edx] }
        *v113 = _ET1;
      }
      while ( _ECX < 112 );
    }
    v66 = *(_DWORD *)config_screen_width;
    __asm { fstp    st }
LABEL_69:
    v91 += 11;
    ++v92;
    v279 = v91;
    v270 += 5;
  }
  while ( v91 <= 22 );
  if ( v66 <= 640 )
  {
    for ( _EAX = 0; _EAX < 112; *(float *)(_EAX + _ECX + 268) = _ET1 )
    {
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+3Ch]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F1E8 + 60);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _EDX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+edx+20Ch]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F1E8 + 524);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+124h]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F1E8 + 292);
      _EAX += 28;
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+24h]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+24h]
      }
      *(float *)(_EAX + _ECX + 36) = _ET1;
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+1F4h]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+1F4h]
      }
      *(float *)(_EAX + _ECX + 500) = _ET1;
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+10Ch]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+10Ch]
      }
    }
    goto LABEL_77;
  }
  if ( v66 <= 800 )
  {
    for ( _EAX = 0; _EAX < 112; *(float *)(_EAX + _ECX + 268) = _ET1 )
    {
      _EDX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+edx+3Ch]
        fmul    ds:flt_46F34C
      }
      _ECX = (float *)(_EAX + dword_48F1E8 + 60);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F34C
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+20Ch]
        fmul    ds:flt_46F34C
      }
      _ECX = (float *)(_EAX + dword_48F1E8 + 524);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F34C
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _EDX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+edx+124h]
        fmul    ds:flt_46F34C
      }
      _ECX = (float *)(_EAX + dword_48F1E8 + 292);
      _EAX += 28;
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F34C
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+24h]
        fsub    ds:flt_46F248
        fstp    dword ptr [eax+ecx+24h]
      }
      *(float *)(_EAX + _ECX + 36) = _ET1;
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+1F4h]
        fsub    ds:flt_46F248
        fstp    dword ptr [eax+ecx+1F4h]
      }
      *(float *)(_EAX + _ECX + 500) = _ET1;
      _ECX = dword_48F1E8;
      __asm
      {
        fld     dword ptr [eax+ecx+10Ch]
        fsub    ds:flt_46F248
        fstp    dword ptr [eax+ecx+10Ch]
      }
    }
LABEL_77:
    v66 = *(_DWORD *)config_screen_width;
  }
  if ( v66 <= 640 )
  {
    for ( _EAX = 0; _EAX < 112; *(float *)(_EAX + _ECX + 268) = _ET1 )
    {
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+3Ch]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F198 + 60);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _EDX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+edx+20Ch]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F198 + 524);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+124h]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F198 + 292);
      _EAX += 28;
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+24h]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+24h]
      }
      *(float *)(_EAX + _ECX + 36) = _ET1;
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+1F4h]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+1F4h]
      }
      *(float *)(_EAX + _ECX + 500) = _ET1;
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+10Ch]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+10Ch]
      }
    }
    goto LABEL_85;
  }
  if ( v66 <= 800 )
  {
    for ( _EAX = 0; _EAX < 112; *(float *)(_EAX + _ECX + 268) = _ET1 )
    {
      _EDX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+edx+3Ch]
        fmul    ds:flt_46F34C
      }
      _ECX = (float *)(_EAX + dword_48F198 + 60);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F34C
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+20Ch]
        fmul    ds:flt_46F34C
      }
      _ECX = (float *)(_EAX + dword_48F198 + 524);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F34C
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _EDX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+edx+124h]
        fmul    ds:flt_46F34C
      }
      _ECX = (float *)(_EAX + dword_48F198 + 292);
      _EAX += 28;
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F34C
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+24h]
        fsub    ds:flt_46F248
        fstp    dword ptr [eax+ecx+24h]
      }
      *(float *)(_EAX + _ECX + 36) = _ET1;
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+1F4h]
        fsub    ds:flt_46F248
        fstp    dword ptr [eax+ecx+1F4h]
      }
      *(float *)(_EAX + _ECX + 500) = _ET1;
      _ECX = dword_48F198;
      __asm
      {
        fld     dword ptr [eax+ecx+10Ch]
        fsub    ds:flt_46F248
        fstp    dword ptr [eax+ecx+10Ch]
      }
    }
LABEL_85:
    v66 = *(_DWORD *)config_screen_width;
  }
  if ( v66 > 640 )
  {
    if ( v66 <= 800 )
    {
      for ( _EAX = 0; _EAX < 112; *(float *)(_EAX + _ECX + 268) = _ET1 )
      {
        _EDX = dword_48F1B0;
        __asm
        {
          fld     dword ptr [eax+edx+3Ch]
          fmul    ds:flt_46F34C
        }
        _ECX = (float *)(_EAX + dword_48F1B0 + 60);
        __asm { fstp    dword ptr [ecx] }
        *_ECX = _ET1;
        __asm
        {
          fld     dword ptr [ecx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [ecx+4]
        }
        _ECX[1] = _ET1;
        _ECX = dword_48F1B0;
        __asm
        {
          fld     dword ptr [eax+ecx+20Ch]
          fmul    ds:flt_46F34C
        }
        _ECX = (float *)(_EAX + dword_48F1B0 + 524);
        __asm { fstp    dword ptr [ecx] }
        *_ECX = _ET1;
        __asm
        {
          fld     dword ptr [ecx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [ecx+4]
        }
        _ECX[1] = _ET1;
        _EDX = dword_48F1B0;
        __asm
        {
          fld     dword ptr [eax+edx+124h]
          fmul    ds:flt_46F34C
        }
        _ECX = (float *)(_EAX + dword_48F1B0 + 292);
        _EAX += 28;
        __asm { fstp    dword ptr [ecx] }
        *_ECX = _ET1;
        __asm
        {
          fld     dword ptr [ecx+4]
          fmul    ds:flt_46F34C
          fstp    dword ptr [ecx+4]
        }
        _ECX[1] = _ET1;
        _ECX = dword_48F1B0;
        __asm
        {
          fld     dword ptr [eax+ecx+24h]
          fsub    ds:flt_46F248
          fstp    dword ptr [eax+ecx+24h]
        }
        *(float *)(_EAX + _ECX + 36) = _ET1;
        _ECX = dword_48F1B0;
        __asm
        {
          fld     dword ptr [eax+ecx+1F4h]
          fsub    ds:flt_46F248
          fstp    dword ptr [eax+ecx+1F4h]
        }
        *(float *)(_EAX + _ECX + 500) = _ET1;
        _ECX = dword_48F1B0;
        __asm
        {
          fld     dword ptr [eax+ecx+10Ch]
          fsub    ds:flt_46F248
          fstp    dword ptr [eax+ecx+10Ch]
        }
      }
    }
  }
  else
  {
    for ( _EAX = 0; _EAX < 112; *(float *)(_EAX + _ECX + 268) = _ET1 )
    {
      _ECX = dword_48F1B0;
      __asm
      {
        fld     dword ptr [eax+ecx+3Ch]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F1B0 + 60);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _EDX = dword_48F1B0;
      __asm
      {
        fld     dword ptr [eax+edx+20Ch]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F1B0 + 524);
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F1B0;
      __asm
      {
        fld     dword ptr [eax+ecx+124h]
        fmul    ds:flt_46F2A4
      }
      _ECX = (float *)(_EAX + dword_48F1B0 + 292);
      _EAX += 28;
      __asm { fstp    dword ptr [ecx] }
      *_ECX = _ET1;
      __asm
      {
        fld     dword ptr [ecx+4]
        fmul    ds:flt_46F2A4
        fstp    dword ptr [ecx+4]
      }
      _ECX[1] = _ET1;
      _ECX = dword_48F1B0;
      __asm
      {
        fld     dword ptr [eax+ecx+24h]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+24h]
      }
      *(float *)(_EAX + _ECX + 36) = _ET1;
      _ECX = dword_48F1B0;
      __asm
      {
        fld     dword ptr [eax+ecx+1F4h]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+1F4h]
      }
      *(float *)(_EAX + _ECX + 500) = _ET1;
      _ECX = dword_48F1B0;
      __asm
      {
        fld     dword ptr [eax+ecx+10Ch]
        fsub    ds:flt_46F578
        fstp    dword ptr [eax+ecx+10Ch]
      }
    }
  }
  FUN_0044faa0((char *)byte_48F20C);
  dword_48F240 = (int)nullsub_72;
  qmemcpy(&perk_prompt_bounds_min_x, &unk_48FBA8, 0xE8u);
  dword_48F25C = 1065353216;
  dword_48F278 = 0;
  dword_48F2B0 = 1065353216;
  dword_48F294 = 0;
  ui_element_load((int)&unk_48F330, aUiUiTextlevelu);
  *(float *)&v290 = -230.0;
  v291 = -27.0;
  ui_element_set_rect((int)&unk_48F330, 75.0, 25.0, (float *)&v290);
  _EAX = (float *)&unk_48F334;
  do
  {
    __asm
    {
      fld     dword ptr [eax-0ECh]
      fsub    ds:flt_46F3E0
    }
    _EAX += 7;
    __asm { fstp    dword ptr [eax-108h] }
    *(_EAX - 66) = _ET1;
    __asm
    {
      fld     dword ptr [eax-108h]
      fmul    ds:flt_46F6C8
      fstp    dword ptr [eax-108h]
    }
    *(_EAX - 66) = _ET1;
    __asm
    {
      fld     dword ptr [eax-104h]
      fmul    ds:flt_46F6C8
      fstp    dword ptr [eax-104h]
    }
    *(_EAX - 65) = _ET1;
    __asm
    {
      fld     dword ptr [eax-20h]
      fmul    ds:flt_46F684
      fstp    dword ptr [eax-20h]
    }
    *(_EAX - 8) = _ET1;
    __asm
    {
      fld     dword ptr [eax-1Ch]
      fmul    ds:flt_46F684
      fstp    dword ptr [eax-1Ch]
    }
    *(_EAX - 7) = _ET1;
    __asm
    {
      fld     dword ptr [eax-20h]
      fsub    ds:flt_46F774
      fstp    dword ptr [eax-20h]
    }
    *(_EAX - 8) = _ET1;
    __asm
    {
      fld     dword ptr [eax-1Ch]
      fsub    ds:flt_46F25C
      fstp    dword ptr [eax-1Ch]
    }
    *(_EAX - 7) = _ET1;
  }
  while ( (int)_EAX < (int)flt_48F3A4 );
  if ( *(_DWORD *)config_screen_width == 640 )
  {
    *(float *)&v290 = 690.0;
    v291 = 80.0;
    perk_prompt_origin_x = 690.0;
    perk_prompt_origin_y = 80.0;
  }
  else
  {
    v291 = 40.0;
    v280 = *(_DWORD *)config_screen_width + 50;
    __asm { fild    [esp+74h+var_60] }
    perk_prompt_origin_y = 40.0;
    __asm { fstp    [esp+74h+var_20] }
    LODWORD(perk_prompt_origin_x) = v290;
  }
  v259 = &dword_48F16C;
  do
  {
    __asm { fild    config_screen_width }
    _ECX = *v259++;
    __asm
    {
      fmul    ds:flt_46F7A0
      fmul    ds:flt_46F66C
      fsub    ds:flt_46F66C
      fadd    dword ptr [ecx+1Ch]
      fstp    dword ptr [ecx+1Ch]
    }
    *(float *)(_ECX + 28) = _ET1;
  }
  while ( (int)v259 < (int)byte_48F20C );
  v281 = *(_DWORD *)config_screen_width - 350;
  __asm { fild    [esp+74h+var_60] }
  qmemcpy(&byte_48EE50, &byte_489DE0, 0x318u);
  __asm { fstp    [esp+74h+var_60] }
  dword_48EE68 = v282;
  dword_48EE6C = 1128792064;
  if ( *(int *)config_screen_width <= 640 )
  {
    __asm
    {
      fld     [esp+74h+var_60]
      fadd    ds:flt_46F290
      fstp    dword_48EE68
      fld     dword_48EE6C
      fsub    ds:flt_46F280
      fstp    dword_48EE6C
    }
  }
  dword_48EE54 = 1;
  byte_48F164 = 1;
  v262 = (float *)ui_element_table_end;
  do
    FUN_0044fb50(*v262++);
  while ( (int)v262 < (int)byte_48F20C );
}

// sub_451910 @ 0x00451910
int sub_451910()
{
  float *v0; // edx
  unsigned int v1; // kr04_4
  float *v2; // edi
  int result; // eax
  int v4; // [esp+10h] [ebp-8h]

  v0 = weapon_projectile_damage_scale;
  v4 = 64;
  do
  {
    *(v0 - 3) = 0.0;
    *v0 = 1.0;
    *(v0 - 1) = 45.0;
    *(v0 - 2) = 0.0;
    *((_DWORD *)v0 - 5) = 1;
    v1 = strlen(aUnknown) + 1;
    qmemcpy(v0 - 28, aUnknown, 4 * (v1 >> 2));
    v2 = &v0[(v1 >> 2) - 28];
    v0 += 31;
    qmemcpy(v2, &aUnknown[4 * (v1 >> 2)], v1 & 3);
    *(v0 - 60) = 0.0;
    *((_BYTE *)v0 - 172) = 0;
    *(v0 - 42) = 0.0;
    *(v0 - 41) = 1.0;
    *(v0 - 40) = 1.0;
    *(v0 - 39) = 0.0;
    result = v4 - 1;
    v4 = result;
  }
  while ( result );
  return result;
}

// weapon_table_init @ 0x004519B0
// initializes the weapon stats table at DAT_004d7a28
void weapon_table_init()
{
  int v0; // ecx
  int *v1; // eax
  int v2; // edx
  int v3; // ebp
  int v4; // edx
  int v5; // edx
  int v6; // ebp
  int v7; // ebx
  int v8; // ebp
  int v9; // ebp
  int v10; // ebp

  v0 = 0;
  v1 = weapon_projectile_pellet_count;
  do
  {
    v2 = v0++ - 1;
    *(v1 - 4) = v2;
    *v1 = 1;
    v1 += 31;
  }
  while ( (int)v1 < (int)&dword_4D99A0 );
  effect_subrect_frame_table[0] = 0;
  dword_4D7EF4 = 1106247680;
  dword_4D7FEC = 1108082688;
  dword_4D84C4 = 1097859072;
  dword_4D8540 = 1101004800;
  dword_4D85BC = 1092616192;
  dword_4D8828 = 1092616192;
  dword_4D83CC = 1101004800;
  dword_4D7D80 = 1129775104;
  dword_4D8E74 = 1097859072;
  dword_4D8F6C = 1092616192;
  dword_4D7C0C = 1114636288;
  dword_4D7B14 = 1113325568;
  dword_4D7B90 = 1112014848;
  dword_4D86B4 = 1101004800;
  dword_4D86B8 = 1093664768;
  dword_4D9064 = 1114636288;
  dword_4D9068 = 1048576000;
  dword_4D8730 = 1092616192;
  dword_4D8734 = 1056964608;
  dword_4D7EF8 = 1084227584;
  dword_4D7FF0 = 1074161254;
  dword_4D84C8 = 1077936128;
  dword_4D8544 = 1068708659;
  dword_4D85C0 = 1099274650;
  dword_4D882C = 1105199104;
  dword_4D83D0 = 1065353216;
  dword_4D8E78 = 0;
  dword_4D7C10 = 1067030938;
  dword_4D7B18 = 1082340147;
  dword_4D863C = 0;
  strcpy(byte_4D8FF8, aFireBullets_0);
  v3 = sfx_autorifle_fire;
  v4 = sfx_pistol_reload;
  dword_4D9060 = 1;
  dword_4D903C = 112;
  dword_4D9040 = 1041194025;
  dword_4D9044 = 1067030938;
  flt_4D9048 = 0.22;
  LODWORD(flt_4D9050) = sfx_autorifle_fire;
  dword_4D9058 = sfx_pistol_reload;
  strcpy(byte_4D7AA8, aPistol);
  dword_4D7B10 = 5;
  dword_4D7AEC = 12;
  dword_4D7AF0 = 1060516345;
  dword_4D7AF4 = 1067030938;
  dword_4D7AF8 = 1046562734;
  dword_4D7B00 = sfx_pistol_fire;
  dword_4D7B08 = v4;
  strcpy(byte_4D7B24, aAssaultRifle);
  v5 = sfx_shotgun_reload;
  dword_4D7B7C = v3;
  v6 = sfx_autorifle_reload;
  dword_4D7B8C = 1;
  dword_4D7B68 = 25;
  dword_4D7B6C = 1039113650;
  dword_4D7B70 = 1067030938;
  dword_4D7B74 = 1035489772;
  dword_4D7B84 = sfx_autorifle_reload;
  strcpy(byte_4D7BA0, aShotgun);
  dword_4D7BE4 = 12;
  dword_4D7C14 = 12;
  dword_4D7C08 = 1;
  v7 = sfx_shotgun_fire;
  dword_4D7BE8 = 1062836634;
  dword_4D7BEC = 1072902963;
  dword_4D7BF0 = 1049247089;
  dword_4D7BF8 = sfx_shotgun_fire;
  dword_4D7C00 = v5;
  strcpy(byte_4D7C1C, aSawedOffShotgu);
  dword_4D7C60 = 12;
  dword_4D7C90 = 12;
  dword_4D7C84 = 1;
  dword_4D7C64 = 1063172178;
  dword_4D7C68 = 1072902963;
  dword_4D7C6C = 1040522936;
  dword_4D7C74 = v7;
  dword_4D7C7C = v5;
  strcpy(byte_4D83DC, aJackhammer);
  dword_4D8444 = 1;
  dword_4D8420 = 16;
  dword_4D8424 = 1041194025;
  dword_4D8428 = 1077936128;
  dword_4D842C = 1042536202;
  dword_4D8450 = 4;
  dword_4D8434 = v7;
  dword_4D843C = v5;
  strcpy(byte_4D7C98, aSubmachineGun);
  dword_4D7CF0 = sfx_hrpm_fire;
  dword_4D7D00 = 5;
  dword_4D7CDC = 30;
  dword_4D7CE0 = 1035237040;
  dword_4D7CE4 = 1067030938;
  dword_4D7CE8 = 1034416030;
  dword_4D7CF8 = v6;
  strcpy(byte_4D7E0C, aFlamethrower);
  dword_4D7E64 = sfx_flamer_fire_01;
  dword_4D7E74 = 8;
  dword_4D7E68 = 2;
  dword_4D7E50 = 30;
  dword_4D7E54 = 1006955619;
  dword_4D7E58 = 0x40000000;
  dword_4D7E5C = 1014350479;
  dword_4D7E08 = 1;
  dword_4D7E6C = v6;
  strcpy(byte_4D7E88, aPlasmaRifle);
  dword_4D7ECC = 20;
  dword_4D7EE0 = LODWORD(sfx_shock_fire);
  dword_4D7ED0 = 1049945413;
  dword_4D7ED4 = 1067030938;
  dword_4D7ED8 = 1044012597;
  dword_4D7EE8 = v6;
  strcpy(byte_4D7F04, aMultiPlasma);
  dword_4D7F5C = LODWORD(sfx_shock_fire);
  dword_4D7F48 = 8;
  dword_4D7F4C = 1058991492;
  dword_4D7F50 = 1068708659;
  dword_4D7F54 = 1050924810;
  dword_4D7F78 = 3;
  dword_4D7F64 = v6;
  strcpy(byte_4D7F80, aPlasmaMinigun);
  flt_4D7FD8 = sfx_plasmaminigun_fire;
  dword_4D7FC4 = 30;
  dword_4D7FC8 = 1038174126;
  dword_4D7FCC = 1067869798;
  dword_4D7FD0 = 1036429296;
  dword_4D7FE0 = v6;
  strcpy(byte_4D7D14, aGaussGun);
  dword_4D7D6C = sfx_gauss_fire;
  dword_4D7D7C = 1;
  dword_4D7D58 = 6;
  dword_4D7D5C = 1058642330;
  dword_4D7D60 = 1070386381;
  dword_4D7D64 = 1054280253;
  dword_4D7D74 = v5;
  strcpy(byte_4D7FFC, aRocketLauncher);
  dword_4D8064 = 8;
  dword_4D8040 = 5;
  dword_4D8044 = 1061004758;
  dword_4D8048 = 1067030938;
  dword_4D804C = 1054280253;
  dword_4D8054 = sfx_rocket_fire;
  dword_4D805C = sfx_autorifle_reload_alt;
  dword_4D7FF8 = 2;
  strcpy(byte_4D8078, aSeekerRockets);
  dword_4D80D8 = sfx_autorifle_reload_alt;
  dword_4D80D0 = sfx_rocket_fire;
  dword_4D80E0 = 8;
  dword_4D80BC = 8;
  dword_4D80C0 = 1050616502;
  dword_4D80C4 = 1067030938;
  dword_4D80C8 = 1050924810;
  dword_4D8074 = 2;
  strcpy(byte_4D7D90, aMeanMinigun);
  dword_4D7DE8 = sfx_autorifle_fire;
  dword_4D7DF8 = 3;
  dword_4D7DD4 = 120;
  dword_4D7DD8 = 1035489772;
  dword_4D7DDC = 1082130432;
  dword_4D7DE0 = 1031664566;
  dword_4D7DF0 = v6;
  strcpy(byte_4D80F4, aPlasmaShotgun);
  dword_4D814C = sfx_plasmashotgun_fire;
  dword_4D8138 = 8;
  dword_4D813C = 1056293519;
  dword_4D8140 = 1078355558;
  dword_4D8144 = 1038174126;
  dword_4D8168 = 14;
  dword_4D8154 = v5;
  strcpy(byte_4D8170, aBlowTorch);
  dword_4D81C8 = sfx_flamer_fire_01;
  dword_4D81D8 = 8;
  dword_4D81CC = 2;
  dword_4D81B4 = 30;
  dword_4D81B8 = 1002983312;
  dword_4D81BC = 1069547520;
  dword_4D81C0 = 1008981770;
  dword_4D816C = 1;
  dword_4D81D0 = v6;
  strcpy(byte_4D81EC, aHrFlamer);
  dword_4D8244 = sfx_flamer_fire_01;
  dword_4D8254 = 8;
  dword_4D8248 = 2;
  dword_4D8230 = 30;
  dword_4D8234 = 1007371158;
  dword_4D8238 = 1072064102;
  dword_4D823C = 1008981770;
  dword_4D81E8 = 1;
  dword_4D824C = v6;
  strcpy(byte_4D8268, aMiniRocketSwar);
  dword_4D82C8 = sfx_autorifle_reload_alt;
  dword_4D82C0 = sfx_rocket_fire;
  dword_4D82D0 = 8;
  dword_4D82AC = 5;
  dword_4D82B0 = 1072064102;
  dword_4D82B4 = 1072064102;
  dword_4D82B8 = 1039516303;
  dword_4D8264 = 2;
  strcpy(byte_4D82E4, aRocketMinigun);
  dword_4D834C = 8;
  dword_4D8328 = 16;
  dword_4D832C = 1039516303;
  dword_4D833C = sfx_rocketmini_fire;
  dword_4D8344 = sfx_autorifle_reload_alt;
  dword_4D8330 = 1072064102;
  dword_4D8334 = 1039516303;
  dword_4D82E0 = 2;
  strcpy(byte_4D8360, aPulseGun);
  dword_4D83B8 = sfx_pulse_fire;
  dword_4D83C8 = 8;
  dword_4D83A4 = 16;
  dword_4D83A8 = 1036831949;
  dword_4D83AC = 1036831949;
  dword_4D83B0 = 0;
  dword_4D835C = 3;
  dword_4D83C0 = v6;
  v8 = sfx_shock_reload;
  strcpy(byte_4D8458, aIonRifle);
  dword_4D84B0 = sfx_shock_fire_alt;
  dword_4D84C0 = 8;
  dword_4D849C = 8;
  dword_4D84A0 = 1053609165;
  dword_4D84A4 = 1068289229;
  dword_4D84A8 = 1038442562;
  dword_4D8454 = 4;
  dword_4D84B8 = v8;
  strcpy(byte_4D84D4, aIonMinigun);
  dword_4D852C = sfx_shockminigun_fire;
  dword_4D853C = 8;
  dword_4D8518 = 20;
  dword_4D851C = 1036831949;
  dword_4D8520 = 1072064102;
  dword_4D8524 = 1035489772;
  dword_4D84D0 = 4;
  dword_4D8534 = v8;
  strcpy(byte_4D8550, aIonCannon);
  dword_4D85A8 = sfx_shock_fire_alt;
  dword_4D8594 = 3;
  dword_4D8598 = 1065353216;
  dword_4D859C = 1077936128;
  dword_4D85A0 = 1059984507;
  dword_4D854C = 4;
  dword_4D85B0 = v8;
  strcpy(byte_4D8930, aIonShotgun);
  dword_4D8988 = sfx_shock_fire_alt;
  dword_4D8998 = 1;
  dword_4D8974 = 10;
  dword_4D8978 = 1062836634;
  dword_4D897C = 1072902963;
  dword_4D8980 = 1049247089;
  dword_4D89A4 = 8;
  dword_4D892C = 4;
  dword_4D8990 = v8;
  dword_4D8994 = 31;
  strcpy(byte_4D88B4, aGaussShotgun);
  dword_4D890C = sfx_gauss_fire;
  dword_4D891C = 1;
  dword_4D88F8 = 4;
  dword_4D88FC = 1065772646;
  dword_4D8900 = 1074161254;
  dword_4D8904 = 1049247089;
  dword_4D88B0 = 0;
  dword_4D8914 = v5;
  dword_4D8918 = 30;
  strcpy(byte_4D87BC, aPlasmaCannon);
  dword_4D8814 = LODWORD(sfx_shock_fire);
  dword_4D8800 = 3;
  dword_4D8804 = 1063675494;
  dword_4D8808 = 1076677837;
  dword_4D880C = 1058642330;
  dword_4D881C = v8;
  dword_4D8820 = 25;
  strcpy(byte_4D8740, aEvilScythe);
  dword_4D8798 = sfx_shock_fire_alt;
  dword_4D8784 = 3;
  dword_4D8788 = 1065353216;
  dword_4D878C = 1077936128;
  dword_4D8790 = 1059984507;
  dword_4D873C = 4;
  dword_4D87A0 = v8;
  dword_4D87A4 = 25;
  strcpy(byte_4D89AC, aFlameburst);
  dword_4D8A04 = sfx_flamer_fire_01;
  dword_4D89F0 = 60;
  dword_4D89F4 = 1017370378;
  dword_4D89F8 = 1077936128;
  dword_4D89FC = 1043878380;
  dword_4D89A8 = 4;
  dword_4D8A0C = v8;
  dword_4D8A10 = 29;
  strcpy(byte_4D8A28, aRaygun);
  dword_4D8A80 = sfx_shock_fire_alt;
  dword_4D8A6C = 12;
  dword_4D8A70 = 1060320051;
  dword_4D8A74 = 0x40000000;
  dword_4D8A78 = 1052938076;
  dword_4D8A24 = 4;
  dword_4D8A88 = v8;
  dword_4D8A8C = 30;
  strcpy(byte_4D8838, aSplitterGun);
  dword_4D8890 = sfx_shock_fire_alt;
  dword_4D887C = 6;
  dword_4D8880 = 1060320051;
  dword_4D8884 = 1074580685;
  dword_4D8888 = 1049582633;
  dword_4D8834 = 0;
  dword_4D8898 = v8;
  dword_4D88A8 = 1086324736;
  dword_4D88A4 = 1106247680;
  strcpy(byte_4D85CC, aShrinkifier5k);
  dword_4D8624 = sfx_shock_fire_alt;
  dword_4D8634 = 8;
  dword_4D8610 = 8;
  dword_4D8614 = 1045891645;
  dword_4D8618 = 1067198710;
  dword_4D861C = 1025758986;
  dword_4D862C = v8;
  dword_4D8630 = 23;
  strcpy(byte_4D8648, aBladeGun);
  dword_4D86A0 = sfx_shock_fire_alt;
  dword_4D86B0 = 8;
  dword_4D868C = 6;
  dword_4D8690 = 1051931443;
  dword_4D8694 = 1080033280;
  dword_4D8698 = 1025758986;
  dword_4D86A8 = v8;
  dword_4D86AC = 24;
  strcpy(byte_4D8E08, aPlagueSphreade);
  dword_4D8E70 = 8;
  v9 = sfx_bloodspill_01;
  dword_4D8E4C = 5;
  dword_4D8E50 = 1045220557;
  dword_4D8E54 = 1067030938;
  dword_4D8E58 = 1025758986;
  dword_4D8E60 = sfx_bloodspill_01;
  dword_4D8E68 = v5;
  strcpy(byte_4D8F00, aRainbowGun);
  dword_4D8F68 = 8;
  dword_4D8F44 = 10;
  dword_4D8F48 = 1045220557;
  dword_4D8F4C = 1067030938;
  dword_4D8F50 = 1035489772;
  dword_4D8F58 = v9;
  dword_4D8F60 = v5;
  strcpy(byte_4D8F7C, aGrimWeapon);
  dword_4D8FC0 = 3;
  dword_4D8FC4 = 1056964608;
  dword_4D8FC8 = 1067030938;
  dword_4D8FCC = 1053609165;
  dword_4D8FD4 = v9;
  dword_4D8FDC = v5;
  strcpy(byte_4D8E84, aBubblegun);
  dword_4D8EEC = 8;
  dword_4D8EC8 = 15;
  dword_4D8ECC = 1042623444;
  dword_4D8ED0 = 1067030938;
  dword_4D8ED4 = 1028443341;
  dword_4D8EDC = v9;
  dword_4D8EE4 = v5;
  strcpy(byte_4D86C4, aSpiderPlasma);
  dword_4D872C = 8;
  dword_4D8708 = 5;
  dword_4D870C = 1045220557;
  dword_4D8710 = 1067030938;
  dword_4D8714 = 1025758986;
  dword_4D871C = v9;
  dword_4D8724 = v5;
  strcpy(byte_4D9264, aTransmutator);
  dword_4D92CC = 9;
  dword_4D92A8 = 50;
  dword_4D92AC = 1025758986;
  dword_4D92B0 = 1084227584;
  dword_4D92B4 = 1025758986;
  dword_4D92BC = v9;
  dword_4D92C4 = v5;
  v10 = LODWORD(sfx_explosion_large);
  strcpy(byte_4D92E0, aBlasterR300);
  dword_4D9338 = LODWORD(sfx_shock_fire);
  dword_4D9348 = 9;
  dword_4D9324 = 20;
  dword_4D9328 = 1034147594;
  dword_4D932C = 0x40000000;
  dword_4D9330 = 1028443341;
  dword_4D9340 = v5;
  strcpy(byte_4D93D8, aNukeLauncher);
  dword_4D9440 = 8;
  dword_4D941C = 1;
  dword_4D9420 = 1082130432;
  dword_4D9424 = 1090519040;
  dword_4D9428 = 1065353216;
  dword_4D9430 = v10;
  dword_4D9438 = v5;
  strcpy(byte_4D935C, aLightingRifle);
  dword_4D93B4 = v10;
  dword_4D93C4 = 8;
  dword_4D93A0 = 500;
  dword_4D93A4 = 1082130432;
  dword_4D93A8 = 1090519040;
  dword_4D93AC = 1065353216;
  dword_4D93BC = v5;
}

// weapon_pick_random_available @ 0x00452CD0
// selects a random weapon id that is marked available
int weapon_pick_random_available()
{
  int v0; // esi

  do
  {
    v0 = crt_rand() % 33 + 1;
    if ( dword_485544[v0] && (crt_rand() & 1) == 0 )
      v0 = crt_rand() % 33 + 1;
  }
  while ( !byte_4D7A6C[124 * v0]
       || config_game_mode == 3 && *(_DWORD *)quest_stage_major == 5 && quest_stage_minor == 10 && v0 == 23 );
  return v0;
}

// weapon_assign_player @ 0x00452D40
// assigns a weapon to a player and resets ammo timers
void weapon_assign_player(int player_index, int weapon_id)
{
  int v2; // esi
  int v3; // edi
  float v4; // ecx
  int v5; // [esp-10h] [ebp-10h]
  int weapon_ida; // [esp+8h] [ebp+8h]

  if ( !demo_mode_active )
    ++dword_485544[weapon_id];
  v2 = 216 * player_index;
  v3 = 124 * weapon_id;
  player_weapon_id[v2] = weapon_id;
  v5 = perk_id_ammo_maniac;
  *(float *)(v2 * 4 + 4787060) = (float)dword_4D7A70[31 * weapon_id];
  if ( perk_count_get(v5) )
  {
    weapon_ida = (__int64)(*(float *)&player_clip_size[216 * player_index] * 0.25);
    if ( weapon_ida <= 1 )
      weapon_ida = 1;
    *(float *)&player_clip_size[216 * player_index] = (double)weapon_ida
                                                    + *(float *)&player_clip_size[216 * player_index];
  }
  if ( perk_count_get(perk_id_my_favourite_weapon) )
    *(float *)&player_clip_size[216 * player_index] = *(float *)&player_clip_size[216 * player_index] + 2.0;
  v4 = *(float *)((char *)&sfx_id + v3);
  player_ammo[216 * player_index] = player_clip_size[216 * player_index];
  player_weapon_reset_latch[216 * player_index] = 0;
  player_shot_cooldown[216 * player_index] = 0;
  player_reload_timer[216 * player_index] = 0;
  dword_4871D0[player_index] = 0x40000000;
  sfx_play_panned(v4);
}

// weapon_refresh_available @ 0x00452E40
// rebuilds availability flags from the unlock list
void weapon_refresh_available()
{
  char *v0; // eax
  int v1; // esi
  int v2; // edx
  int *v3; // ecx
  int v4; // eax

  v0 = byte_4D7A6C;
  do
  {
    *v0 = 0;
    v0 += 124;
  }
  while ( (int)v0 < (int)byte_4D996C );
  v1 = quest_unlock_index;
  v2 = 0;
  byte_4D7AE8 = 1;
  if ( quest_unlock_index > 0 )
  {
    v3 = quest_unlock_weapon_id;
    do
    {
      if ( (int)v3 >= (int)dword_484FEC )
        break;
      v4 = *v3;
      v3 += 11;
      ++v2;
      byte_4D7A6C[124 * v4] = 1;
    }
    while ( v2 < v1 );
  }
  if ( config_game_mode == 1 )
  {
    byte_4D7B64 = 1;
    byte_4D7BE0 = 1;
    byte_4D7CD8 = 1;
  }
  if ( (unsigned __int8)game_is_full_version() )
  {
    if ( quest_unlock_index_full >= 40 )
      byte_4D8878 = 1;
    byte_4D7A6C[0] = 0;
  }
  else
  {
    quest_unlock_index_full = 0;
    byte_4D7A6C[0] = 0;
  }
}

// float_near_equal @ 0x00452EF0
// returns 1 when |a-b| < 1.1920929e-07 (FLT_EPSILON)
int float_near_equal(float a, float b)
{
  double v2; // st7

  v2 = a - b;
  return v2 >= -0.00000011920929 && v2 <= 0.00000011920929;
}

// FUN_00452f1d @ 0x00452F1D
// [binja] int32_t sub_452f1d()
int FUN_00452f1d()
{
  renderer_select_backend(1);
  return off_479658();
}

// sub_452F30 @ 0x00452F30
int __stdcall sub_452F30(int a1, int a2, int a3, int a4, int a5, float a6)
{
  renderer_select_backend(1u);
  return off_4795E4(a1, a2, a3, a4, a5, a6);
}

// sub_452F5A @ 0x00452F5A
float *__stdcall sub_452F5A(float *a1, float *a2, float *a3, float *a4, float *a5, float a6)
{
  double v6; // st7
  double v8; // st6
  double v9; // st7
  float v10; // [esp+0h] [ebp-8h]
  float v11; // [esp+4h] [ebp-4h]
  float v12; // [esp+24h] [ebp+1Ch]

  v6 = a6 * a6;
  v8 = a6 * v6;
  v10 = v8 + v8 - v6 * 3.0 + 1.0;
  v11 = v8 - (v6 + v6) + a6;
  v12 = v6 * 3.0 - (v8 + v8);
  v9 = v8 - v6;
  *a1 = v10 * *a2 + v11 * *a3 + v12 * *a4 + v9 * *a5;
  a1[1] = v9 * a5[1] + v12 * a4[1] + v11 * a3[1] + v10 * a2[1];
  return a1;
}

// sub_452FE8 @ 0x00452FE8
int __stdcall sub_452FE8(int a1, int a2, int a3, int a4, int a5, float a6)
{
  renderer_select_backend(1u);
  return off_47965C(a1, a2, a3, a4, a5, a6);
}

// sub_453012 @ 0x00453012
float *__stdcall sub_453012(float *a1, float *a2, float *a3, float *a4, float *a5, float a6)
{
  double v6; // st7
  double v8; // st6
  double v9; // st7
  float v10; // [esp+0h] [ebp-8h]
  float v11; // [esp+4h] [ebp-4h]
  float v12; // [esp+24h] [ebp+1Ch]

  v6 = a6 * a6;
  v8 = a6 * v6;
  v10 = v6 * 2.0 - v8 - a6;
  v11 = v8 * 3.0 - v6 * 5.0 + 2.0;
  v12 = v6 * 4.0 - v8 * 3.0 + a6;
  v9 = v8 - v6;
  *a1 = (v10 * *a2 + v11 * *a3 + v12 * *a4 + v9 * *a5) * 0.5;
  a1[1] = (v9 * a5[1] + v12 * a4[1] + v11 * a3[1] + v10 * a2[1]) * 0.5;
  return a1;
}

// sub_4530C1 @ 0x004530C1
int __stdcall sub_4530C1(int a1, int a2, int a3, int a4, float a5, float a6)
{
  renderer_select_backend(1u);
  return off_479660(a1, a2, a3, a4, a5, a6);
}

// sub_4530F0 @ 0x004530F0
float *__stdcall sub_4530F0(float *a1, float *a2, float *a3, float *a4, float a5, float a6)
{
  *a1 = (*a3 - *a2) * a5 + (*a4 - *a2) * a6 + *a2;
  a1[1] = (a3[1] - a2[1]) * a5 + (a4[1] - a2[1]) * a6 + a2[1];
  return a1;
}

// sub_453133 @ 0x00453133
int sub_453133()
{
  renderer_select_backend(1u);
  return off_4795A0();
}

// FUN_0045315a @ 0x0045315A
// [binja] int32_t sub_45315a()
int FUN_0045315a()
{
  renderer_select_backend(1);
  return off_4795BC();
}

// sub_45316D @ 0x0045316D
int __stdcall sub_45316D(int a1, int a2, int a3, int a4, int a5, float a6)
{
  renderer_select_backend(1u);
  return off_479664(a1, a2, a3, a4, a5, a6);
}

// sub_453197 @ 0x00453197
float *__stdcall sub_453197(float *a1, float *a2, float *a3, float *a4, float *a5, float a6)
{
  double v6; // st7
  double v8; // st6
  double v9; // st7
  float v10; // [esp+0h] [ebp-8h]
  float v11; // [esp+4h] [ebp-4h]
  float v12; // [esp+24h] [ebp+1Ch]

  v6 = a6 * a6;
  v8 = a6 * v6;
  v10 = v8 + v8 - v6 * 3.0 + 1.0;
  v11 = v8 - (v6 + v6) + a6;
  v12 = v6 * 3.0 - (v8 + v8);
  v9 = v8 - v6;
  *a1 = v10 * *a2 + v11 * *a3 + v12 * *a4 + v9 * *a5;
  a1[1] = v9 * a5[1] + v12 * a4[1] + v11 * a3[1] + v10 * a2[1];
  a1[2] = v9 * a5[2] + v12 * a4[2] + v11 * a3[2] + v10 * a2[2];
  return a1;
}

// sub_453245 @ 0x00453245
int __stdcall sub_453245(int a1, int a2, int a3, int a4, int a5, float a6)
{
  renderer_select_backend(1u);
  return off_479668(a1, a2, a3, a4, a5, a6);
}

// sub_45326F @ 0x0045326F
float *__stdcall sub_45326F(float *a1, float *a2, float *a3, float *a4, float *a5, float a6)
{
  double v6; // st7
  double v8; // st6
  double v9; // st7
  float v10; // [esp+0h] [ebp-8h]
  float v11; // [esp+4h] [ebp-4h]
  float v12; // [esp+24h] [ebp+1Ch]

  v6 = a6 * a6;
  v8 = a6 * v6;
  v10 = v6 * 2.0 - v8 - a6;
  v11 = v8 * 3.0 - v6 * 5.0 + 2.0;
  v12 = v6 * 4.0 - v8 * 3.0 + a6;
  v9 = v8 - v6;
  *a1 = (v10 * *a2 + v11 * *a3 + v12 * *a4 + v9 * *a5) * 0.5;
  a1[1] = (v9 * a5[1] + v12 * a4[1] + v11 * a3[1] + v10 * a2[1]) * 0.5;
  a1[2] = (v9 * a5[2] + v12 * a4[2] + v11 * a3[2] + v10 * a2[2]) * 0.5;
  return a1;
}

// sub_453340 @ 0x00453340
int __stdcall sub_453340(int a1, int a2, int a3, int a4, float a5, float a6)
{
  renderer_select_backend(1u);
  return off_47966C(a1, a2, a3, a4, a5, a6);
}

// sub_45336F @ 0x0045336F
float *__stdcall sub_45336F(float *a1, float *a2, float *a3, float *a4, float a5, float a6)
{
  *a1 = (*a3 - *a2) * a5 + (*a4 - *a2) * a6 + *a2;
  a1[1] = (a3[1] - a2[1]) * a5 + (a4[1] - a2[1]) * a6 + a2[1];
  a1[2] = (a3[2] - a2[2]) * a5 + (a4[2] - a2[2]) * a6 + a2[2];
  return a1;
}

// sub_4533D9 @ 0x004533D9
float *__stdcall sub_4533D9(float *a1, float *a2, float *a3)
{
  float v4; // [esp+8h] [ebp-10h]
  float v5; // [esp+Ch] [ebp-Ch]
  float v6; // [esp+10h] [ebp-8h]
  float v7; // [esp+14h] [ebp-4h]

  v4 = a3[8] * a2[2] + a3[4] * a2[1] + *a2 * *a3 + a3[12];
  v5 = a3[9] * a2[2] + a3[5] * a2[1] + a3[1] * *a2 + a3[13];
  v6 = a3[10] * a2[2] + a3[6] * a2[1] + a3[2] * *a2 + a3[14];
  v7 = a3[11] * a2[2] + a3[7] * a2[1] + a3[3] * *a2 + a3[15];
  *a1 = v4;
  a1[1] = v5;
  a1[2] = v6;
  a1[3] = v7;
  return a1;
}

// FUN_00453464 @ 0x00453464
// [binja] int32_t sub_453464()
int FUN_00453464()
{
  renderer_select_backend(1);
  return off_4795C8();
}

// sub_453484 @ 0x00453484
float *__stdcall sub_453484(float *a1, float *a2, float *a3)
{
  float v4; // [esp+8h] [ebp-Ch]
  float v5; // [esp+Ch] [ebp-8h]
  float v6; // [esp+10h] [ebp-4h]

  v4 = a3[8] * a2[2] + a3[4] * a2[1] + *a2 * *a3;
  v5 = a3[9] * a2[2] + a3[5] * a2[1] + a3[1] * *a2;
  v6 = a3[10] * a2[2] + a3[6] * a2[1] + a3[2] * *a2;
  *a1 = v4;
  a1[1] = v5;
  a1[2] = v6;
  return a1;
}

// FUN_004534ea @ 0x004534EA
// [binja] int32_t sub_4534ea()
int FUN_004534ea()
{
  renderer_select_backend(1);
  return off_4795D8();
}

// sub_4534FB @ 0x004534FB
int sub_4534FB()
{
  renderer_select_backend(1u);
  return off_4795DC();
}

// sub_453519 @ 0x00453519
float *__stdcall sub_453519(float *a1, float *a2, float *a3, float *a4)
{
  double v6; // st7
  double v8; // st6
  double v9; // st7
  double v10; // st6
  float v12; // [esp+8h] [ebp-1Ch]
  float v13; // [esp+Ch] [ebp-18h]
  float v14; // [esp+10h] [ebp-14h]
  float v15; // [esp+14h] [ebp-10h]
  float v16; // [esp+18h] [ebp-Ch]
  float v17; // [esp+1Ch] [ebp-8h]
  float v18; // [esp+20h] [ebp-4h]
  float v19; // [esp+30h] [ebp+Ch]
  float v20; // [esp+34h] [ebp+10h]
  float v21; // [esp+38h] [ebp+14h]

  v6 = a4[3] * a3[2];
  v8 = a3[3] * a4[2];
  v20 = a4[3] * a3[1] - a3[3] * a4[1];
  v17 = a3[1] * a4[2];
  v18 = a3[2] * a4[1];
  v12 = (v6 - v8) * a2[1] - v20 * a2[2] + (v17 - v18) * a2[3];
  v19 = a3[3] * *a4;
  v21 = a4[3] * *a3;
  v16 = *a4 * a3[2] - *a3 * a4[2];
  v13 = (v8 - v6) * *a2 - (v19 - v21) * a2[2] + v16 * a2[3];
  v9 = *a3 * a4[1];
  v10 = *a4 * a3[1];
  v14 = v20 * *a2 - (v21 - v19) * a2[1] + (v9 - v10) * a2[3];
  v15 = (v18 - v17) * *a2 - v16 * a2[1] + (v10 - v9) * a2[2];
  *a1 = v12;
  a1[1] = v13;
  a1[2] = v14;
  a1[3] = v15;
  return a1;
}

// sub_453616 @ 0x00453616
int __stdcall sub_453616(int a1, int a2, int a3, int a4, int a5, float a6)
{
  renderer_select_backend(1u);
  return off_479670(a1, a2, a3, a4, a5, a6);
}

// sub_453640 @ 0x00453640
float *__stdcall sub_453640(float *a1, float *a2, float *a3, float *a4, float *a5, float a6)
{
  double v6; // st7
  double v8; // st6
  double v9; // st6
  double v10; // st5
  double v11; // st4
  double v12; // st3
  float v13; // [esp+0h] [ebp-Ch]
  float v14; // [esp+4h] [ebp-8h]
  float v15; // [esp+8h] [ebp-4h]

  v6 = a6 * a6;
  v8 = a6 * v6;
  v15 = v8;
  v13 = v8 + v8;
  v14 = 3.0 * v6;
  v9 = v13 - v14 + 1.0;
  v10 = v15 - (v6 + v6) + a6;
  v11 = v14 - v13;
  v12 = v15 - v6;
  *a1 = v9 * *a2 + v10 * *a3 + v11 * *a4 + v12 * *a5;
  a1[1] = v12 * a5[1] + v11 * a4[1] + v10 * a3[1] + v9 * a2[1];
  a1[2] = v12 * a5[2] + v11 * a4[2] + v10 * a3[2] + v9 * a2[2];
  a1[3] = v12 * a5[3] + v11 * a4[3] + v10 * a3[3] + v9 * a2[3];
  return a1;
}

// sub_453711 @ 0x00453711
int __stdcall sub_453711(int a1, int a2, int a3, int a4, int a5, float a6)
{
  renderer_select_backend(1u);
  return off_479674(a1, a2, a3, a4, a5, a6);
}

// sub_45373B @ 0x0045373B
float *__stdcall sub_45373B(float *a1, float *a2, float *a3, float *a4, float *a5, float a6)
{
  double v6; // st7
  double v8; // st6
  double v9; // st7
  float v10; // [esp+0h] [ebp-8h]
  float v11; // [esp+4h] [ebp-4h]
  float v12; // [esp+24h] [ebp+1Ch]

  v6 = a6 * a6;
  v8 = a6 * v6;
  v10 = v6 * 2.0 - v8 - a6;
  v11 = v8 * 3.0 - v6 * 5.0 + 2.0;
  v12 = v6 * 4.0 - v8 * 3.0 + a6;
  v9 = v8 - v6;
  *a1 = (v10 * *a2 + v11 * *a3 + v12 * *a4 + v9 * *a5) * 0.5;
  a1[1] = (v9 * a5[1] + v12 * a4[1] + v11 * a3[1] + v10 * a2[1]) * 0.5;
  a1[2] = (v9 * a5[2] + v12 * a4[2] + v11 * a3[2] + v10 * a2[2]) * 0.5;
  a1[3] = (v9 * a5[3] + v12 * a4[3] + v11 * a3[3] + v10 * a2[3]) * 0.5;
  return a1;
}

// sub_45382E @ 0x0045382E
int __stdcall sub_45382E(int a1, int a2, int a3, int a4, float a5, float a6)
{
  renderer_select_backend(1u);
  return off_479678(a1, a2, a3, a4, a5, a6);
}

// sub_45385D @ 0x0045385D
float *__stdcall sub_45385D(float *a1, float *a2, float *a3, float *a4, float a5, float a6)
{
  *a1 = (*a3 - *a2) * a5 + (*a4 - *a2) * a6 + *a2;
  a1[1] = (a3[1] - a2[1]) * a5 + (a4[1] - a2[1]) * a6 + a2[1];
  a1[2] = (a3[2] - a2[2]) * a5 + (a4[2] - a2[2]) * a6 + a2[2];
  a1[3] = (a3[3] - a2[3]) * a5 + (a4[3] - a2[3]) * a6 + a2[3];
  return a1;
}

// sub_4538E1 @ 0x004538E1
float *__stdcall sub_4538E1(float *a1, float *a2, float *a3)
{
  float v4; // [esp+8h] [ebp-10h]
  float v5; // [esp+Ch] [ebp-Ch]
  float v6; // [esp+10h] [ebp-8h]
  float v7; // [esp+14h] [ebp-4h]

  v4 = a3[12] * a2[3] + a3[4] * a2[1] + a3[8] * a2[2] + *a2 * *a3;
  v5 = a3[13] * a2[3] + a3[5] * a2[1] + a3[1] * *a2 + a3[9] * a2[2];
  v6 = a3[14] * a2[3] + a3[6] * a2[1] + a3[2] * *a2 + a3[10] * a2[2];
  v7 = a3[15] * a2[3] + a3[7] * a2[1] + a3[3] * *a2 + a3[11] * a2[2];
  *a1 = v4;
  a1[1] = v5;
  a1[2] = v6;
  a1[3] = v7;
  return a1;
}

// sub_45398D @ 0x0045398D
double __stdcall sub_45398D(float *a1)
{
  double v2; // st7
  double v3; // st6
  double v4; // st5
  double v5; // st4
  double v6; // st3
  float v8; // [esp+8h] [ebp+8h]

  v2 = a1[10] * a1[15] - a1[14] * a1[11];
  v3 = a1[15] * a1[9] - a1[13] * a1[11];
  v4 = a1[14] * a1[9] - a1[10] * a1[13];
  v5 = a1[8] * a1[15] - a1[12] * a1[11];
  v6 = a1[14] * a1[8] - a1[12] * a1[10];
  v8 = a1[8] * a1[13] - a1[12] * a1[9];
  return (v2 * a1[5] - v3 * a1[6] + v4 * a1[7]) * *a1
       - (v2 * a1[4] - v5 * a1[6] + v6 * a1[7]) * a1[1]
       + (v3 * a1[4] - v5 * a1[5] + v8 * a1[7]) * a1[2]
       - (v4 * a1[4] - v6 * a1[5] + v8 * a1[6]) * a1[3];
}

// FUN_00453a57 @ 0x00453A57
// [binja] int32_t sub_453a57()
int FUN_00453a57()
{
  renderer_select_backend(1);
  return off_4795AC();
}

// sub_453A6A @ 0x00453A6A
float *__stdcall sub_453A6A(float *a1, float *a2, float *a3)
{
  float *result; // eax
  float *v4; // esi
  char v5; // [esp+4h] [ebp-40h] BYREF

  result = a1;
  if ( a1 == a2 || (v4 = a1, a1 == a3) )
    v4 = (float *)&v5;
  *v4 = a2[3] * a3[12] + *a2 * *a3 + a2[2] * a3[8] + a3[4] * a2[1];
  v4[1] = a2[1] * a3[5] + a2[3] * a3[13] + a2[2] * a3[9] + a3[1] * *a2;
  v4[2] = a2[3] * a3[14] + a3[2] * *a2 + a2[2] * a3[10] + a3[6] * a2[1];
  v4[3] = a2[3] * a3[15] + a3[11] * a2[2] + *a2 * a3[3] + a3[7] * a2[1];
  v4[4] = a2[7] * a3[12] + a2[4] * *a3 + a3[4] * a2[5] + a2[6] * a3[8];
  v4[5] = a2[6] * a3[9] + a2[7] * a3[13] + a3[5] * a2[5] + a3[1] * a2[4];
  v4[6] = a3[6] * a2[5] + a2[7] * a3[14] + a3[2] * a2[4] + a2[6] * a3[10];
  v4[7] = a3[7] * a2[5] + a2[7] * a3[15] + a2[6] * a3[11] + a2[4] * a3[3];
  v4[8] = a2[11] * a3[12] + a2[8] * *a3 + a3[4] * a2[9] + a2[10] * a3[8];
  v4[9] = a2[11] * a3[13] + a2[10] * a3[9] + a3[5] * a2[9] + a3[1] * a2[8];
  v4[10] = a3[6] * a2[9] + a3[2] * a2[8] + a2[11] * a3[14] + a2[10] * a3[10];
  v4[11] = a2[11] * a3[15] + a2[10] * a3[11] + a3[7] * a2[9] + a2[8] * a3[3];
  v4[12] = a2[15] * a3[12] + a2[12] * *a3 + a3[4] * a2[13] + a2[14] * a3[8];
  v4[13] = a2[15] * a3[13] + a2[14] * a3[9] + a3[5] * a2[13] + a3[1] * a2[12];
  v4[14] = a3[6] * a2[13] + a3[2] * a2[12] + a2[15] * a3[14] + a2[14] * a3[10];
  v4[15] = a2[15] * a3[15] + a2[14] * a3[11] + a3[7] * a2[13] + a2[12] * a3[3];
  if ( v4 != a1 )
    qmemcpy(a1, v4, 0x40u);
  return result;
}

// FUN_00453ca0 @ 0x00453CA0
// [binja] int32_t sub_453ca0()
int FUN_00453ca0()
{
  renderer_select_backend(1);
  return off_479634();
}

// sub_453CB3 @ 0x00453CB3
int __stdcall sub_453CB3(int a1, int a2)
{
  double v2; // st7
  int result; // eax
  double v4; // st7
  double v5; // st7
  double v6; // st7
  double v7; // st7
  double v8; // st7

  v2 = *(float *)(a2 + 4);
  result = a1;
  *(float *)(a1 + 4) = *(float *)(a2 + 16);
  *(float *)(a1 + 16) = v2;
  v4 = *(float *)(a2 + 8);
  *(_DWORD *)(a1 + 8) = *(_DWORD *)(a2 + 32);
  *(float *)(a1 + 32) = v4;
  v5 = *(float *)(a2 + 12);
  *(_DWORD *)(a1 + 12) = *(_DWORD *)(a2 + 48);
  *(float *)(a1 + 48) = v5;
  v6 = *(float *)(a2 + 24);
  *(_DWORD *)(a1 + 24) = *(_DWORD *)(a2 + 36);
  *(float *)(a1 + 36) = v6;
  v7 = *(float *)(a2 + 28);
  *(_DWORD *)(a1 + 28) = *(_DWORD *)(a2 + 52);
  *(float *)(a1 + 52) = v7;
  v8 = *(float *)(a2 + 44);
  *(_DWORD *)(a1 + 44) = *(_DWORD *)(a2 + 56);
  *(float *)(a1 + 56) = v8;
  if ( a1 != a2 )
  {
    *(_DWORD *)a1 = *(_DWORD *)a2;
    *(_DWORD *)(a1 + 20) = *(_DWORD *)(a2 + 20);
    *(_DWORD *)(a1 + 40) = *(_DWORD *)(a2 + 40);
    *(_DWORD *)(a1 + 60) = *(_DWORD *)(a2 + 60);
  }
  return result;
}

// sub_453D2D @ 0x00453D2D
float *__stdcall sub_453D2D(float *a1, float *a2, float *a3)
{
  float *result; // eax
  float *v4; // esi
  char v5; // [esp+4h] [ebp-40h] BYREF

  result = a1;
  if ( a1 == a2 || (v4 = a1, a1 == a3) )
    v4 = (float *)&v5;
  *v4 = a2[3] * a3[12] + *a2 * *a3 + a2[2] * a3[8] + a3[4] * a2[1];
  v4[1] = a2[4] * *a3 + a3[12] * a2[7] + a3[8] * a2[6] + a3[4] * a2[5];
  v4[2] = a2[10] * a3[8] + a2[9] * a3[4] + a3[12] * a2[11] + a2[8] * *a3;
  v4[3] = a2[13] * a3[4] + a2[15] * a3[12] + *a3 * a2[12] + a2[14] * a3[8];
  v4[4] = a3[9] * a2[2] + a3[1] * *a2 + a3[13] * a2[3] + a2[1] * a3[5];
  v4[5] = a3[13] * a2[7] + a3[9] * a2[6] + a2[5] * a3[5] + a2[4] * a3[1];
  v4[6] = a2[9] * a3[5] + a3[13] * a2[11] + a3[9] * a2[10] + a2[8] * a3[1];
  v4[7] = a2[13] * a3[5] + a3[13] * a2[15] + a3[9] * a2[14] + a3[1] * a2[12];
  v4[8] = a3[10] * a2[2] + a3[2] * *a2 + a2[1] * a3[6] + a3[14] * a2[3];
  v4[9] = a3[14] * a2[7] + a3[10] * a2[6] + a2[5] * a3[6] + a2[4] * a3[2];
  v4[10] = a2[9] * a3[6] + a3[14] * a2[11] + a3[10] * a2[10] + a2[8] * a3[2];
  v4[11] = a2[13] * a3[6] + a3[14] * a2[15] + a3[10] * a2[14] + a3[2] * a2[12];
  v4[12] = a3[11] * a2[2] + a3[3] * *a2 + a2[1] * a3[7] + a3[15] * a2[3];
  v4[13] = a3[15] * a2[7] + a3[11] * a2[6] + a2[5] * a3[7] + a2[4] * a3[3];
  v4[14] = a2[9] * a3[7] + a3[15] * a2[11] + a3[11] * a2[10] + a2[8] * a3[3];
  v4[15] = a2[13] * a3[7] + a3[15] * a2[15] + a3[11] * a2[14] + a3[3] * a2[12];
  if ( v4 != a1 )
    qmemcpy(a1, v4, 0x40u);
  return result;
}

// FUN_00453f63 @ 0x00453F63
// [binja] int32_t sub_453f63()
int FUN_00453f63()
{
  renderer_select_backend(1);
  return off_4795E8();
}

// sub_453F76 @ 0x00453F76
int __stdcall sub_453F76(float *a1, float *a2, float *a3)
{
  double v4; // st7
  double v5; // st6
  double v6; // st7
  double v7; // st7
  double v8; // st6
  double v9; // st5
  double v10; // st4
  double v11; // st3
  double v12; // st2
  double v13; // st7
  double v14; // st6
  double v15; // st5
  double v16; // st3
  double v17; // st4
  double v18; // st3
  double v19; // st2
  double v20; // st7
  int result; // eax
  float v22; // [esp+8h] [ebp-54h]
  float v23; // [esp+Ch] [ebp-50h]
  float v24; // [esp+10h] [ebp-4Ch]
  float v25; // [esp+14h] [ebp-48h]
  float v26; // [esp+18h] [ebp-44h]
  float v27; // [esp+1Ch] [ebp-40h]
  float v28; // [esp+20h] [ebp-3Ch]
  float v29; // [esp+24h] [ebp-38h]
  float v30; // [esp+28h] [ebp-34h]
  float v31; // [esp+28h] [ebp-34h]
  float v32; // [esp+2Ch] [ebp-30h]
  float v33; // [esp+2Ch] [ebp-30h]
  float v34; // [esp+30h] [ebp-2Ch]
  float v35; // [esp+30h] [ebp-2Ch]
  float v36; // [esp+34h] [ebp-28h]
  float v37; // [esp+34h] [ebp-28h]
  float v38; // [esp+38h] [ebp-24h]
  float v39; // [esp+38h] [ebp-24h]
  float v40; // [esp+3Ch] [ebp-20h]
  float v41; // [esp+3Ch] [ebp-20h]
  float v42; // [esp+3Ch] [ebp-20h]
  float v43; // [esp+40h] [ebp-1Ch]
  float v44; // [esp+40h] [ebp-1Ch]
  float v45; // [esp+44h] [ebp-18h]
  float v46; // [esp+44h] [ebp-18h]
  float v47; // [esp+48h] [ebp-14h]
  float v48; // [esp+48h] [ebp-14h]
  float v49; // [esp+4Ch] [ebp-10h]
  float v50; // [esp+4Ch] [ebp-10h]
  float v51; // [esp+50h] [ebp-Ch]
  float v52; // [esp+50h] [ebp-Ch]
  float v53; // [esp+54h] [ebp-8h]
  float v54; // [esp+54h] [ebp-8h]
  float v55; // [esp+54h] [ebp-8h]
  float v56; // [esp+58h] [ebp-4h]
  float v57; // [esp+58h] [ebp-4h]
  float v58; // [esp+58h] [ebp-4h]
  float v59; // [esp+58h] [ebp-4h]
  float v60; // [esp+6Ch] [ebp+10h]
  float v61; // [esp+6Ch] [ebp+10h]
  float v62; // [esp+6Ch] [ebp+10h]
  float v63; // [esp+6Ch] [ebp+10h]

  v4 = *a3;
  v5 = a3[1];
  v43 = a3[4];
  v40 = a3[5];
  v45 = a3[8];
  v56 = a3[9];
  v47 = a3[12];
  v60 = a3[13];
  v51 = v40 * v4 - v43 * v5;
  v49 = a3[14];
  v53 = v56 * v4 - v45 * v5;
  v34 = v60 * v4 - v47 * v5;
  v29 = v56 * v43 - v45 * v40;
  v30 = v60 * v43 - v47 * v40;
  v6 = v60;
  v61 = a3[15];
  v32 = v6 * v45 - v47 * v56;
  v7 = a3[2];
  v8 = a3[3];
  v9 = a3[6];
  v36 = a3[6];
  v10 = a3[7];
  v41 = a3[7];
  v11 = a3[10];
  v38 = a3[10];
  v12 = a3[11];
  v57 = a3[11];
  v22 = v7 * v29 - v9 * v53 + v11 * v51;
  v23 = v9 * v34 - v49 * v51 - v7 * v30;
  v24 = v7 * v32 - v11 * v34 + v49 * v53;
  v25 = v11 * v30 - v49 * v29 - v9 * v32;
  v26 = v53 * v10 - v51 * v12 - v29 * v8;
  v27 = v30 * v8 - v34 * v10 + v51 * v61;
  v28 = v34 * v12 - v53 * v61 - v32 * v8;
  v35 = v32 * v10 - v30 * v12 + v29 * v61;
  v52 = v7 * v10 - v9 * v8;
  v54 = v7 * v57 - v38 * v8;
  v13 = v7 * v61 - v49 * v8;
  v44 = a3[4];
  v46 = a3[8];
  v14 = v36 * v57 - v38 * v41;
  v15 = v36 * v61 - v49 * v41;
  v16 = v49 * v57;
  v58 = a3[9];
  v48 = a3[12];
  v17 = v38 * v61 - v16;
  v18 = a3[1];
  v19 = a3[5];
  v62 = a3[13];
  v50 = v54 * v19 - v52 * v58 - v14 * v18;
  v39 = v15 * v18 - v13 * v19 + v52 * v62;
  v37 = v13 * v58 - v54 * v62 - v17 * v18;
  v31 = v17 * v19 - v15 * v58 + v14 * v62;
  v63 = v14 * *a3 - v54 * v44 + v52 * v46;
  v59 = v13 * v44 - v52 * v48 - v15 * *a3;
  v42 = *a3 * v17 - v13 * v46 + v54 * v48;
  v20 = v50 * v48 + v39 * v46 + v37 * v44 + v31 * *a3;
  if ( a2 )
    *a2 = v20;
  v55 = 1.0 / v20;
  result = _finite(v55);
  if ( result )
  {
    *a1 = v31 * v55;
    a1[1] = v37 * v55;
    a1[2] = v39 * v55;
    a1[3] = v50 * v55;
    v33 = v15 * v46 - v14 * v48 - v17 * v44;
    a1[4] = v33 * v55;
    a1[5] = v42 * v55;
    a1[6] = v59 * v55;
    a1[7] = v63 * v55;
    a1[8] = v35 * v55;
    a1[9] = v28 * v55;
    a1[10] = v27 * v55;
    a1[11] = v26 * v55;
    a1[12] = v25 * v55;
    a1[13] = v24 * v55;
    a1[14] = v23 * v55;
    a1[15] = v22 * v55;
    return (int)a1;
  }
  return result;
}

// FUN_00454303 @ 0x00454303
// [binja] int32_t __stdcall sub_454303(float arg1, float arg2, float arg3); wrapper calls PTR_FUN_00479624 (idx 0x21)
float *FUN_00454303(float *arg1, float arg2, float arg3, float arg4)
{
  renderer_select_backend(1);
  return (float *)off_479624((int)arg1, arg2, arg3, arg4);
}

// sub_454331 @ 0x00454331
int __stdcall sub_454331(int a1, int a2, int a3, int a4)
{
  *(float *)(a1 + 56) = 0.0;
  *(_DWORD *)a1 = a2;
  *(float *)(a1 + 52) = 0.0;
  *(_DWORD *)(a1 + 20) = a3;
  *(float *)(a1 + 48) = 0.0;
  *(_DWORD *)(a1 + 40) = a4;
  *(float *)(a1 + 44) = 0.0;
  *(float *)(a1 + 36) = 0.0;
  *(float *)(a1 + 32) = 0.0;
  *(float *)(a1 + 28) = 0.0;
  *(float *)(a1 + 24) = 0.0;
  *(float *)(a1 + 16) = 0.0;
  *(float *)(a1 + 12) = 0.0;
  *(float *)(a1 + 8) = 0.0;
  *(float *)(a1 + 4) = 0.0;
  *(float *)(a1 + 60) = 1.0;
  return a1;
}

// FUN_0045438d @ 0x0045438D
// [binja] int32_t __stdcall sub_45438d(float arg1, float arg2, float arg3); wrapper calls PTR_FUN_00479608 (idx 0x1a)
float *FUN_0045438d(float *arg1, float arg2, float arg3, float arg4)
{
  renderer_select_backend(1);
  return (float *)off_479608((int)arg1, arg2, arg3, arg4);
}

// sub_4543BB @ 0x004543BB
int __stdcall sub_4543BB(int a1, int a2, int a3, int a4)
{
  *(float *)(a1 + 44) = 0.0;
  *(_DWORD *)(a1 + 48) = a2;
  *(float *)(a1 + 36) = 0.0;
  *(_DWORD *)(a1 + 52) = a3;
  *(float *)(a1 + 32) = 0.0;
  *(_DWORD *)(a1 + 56) = a4;
  *(float *)(a1 + 28) = 0.0;
  *(float *)(a1 + 24) = 0.0;
  *(float *)(a1 + 16) = 0.0;
  *(float *)(a1 + 12) = 0.0;
  *(float *)(a1 + 8) = 0.0;
  *(float *)(a1 + 4) = 0.0;
  *(float *)(a1 + 60) = 1.0;
  *(float *)(a1 + 40) = 1.0;
  *(float *)(a1 + 20) = 1.0;
  *(float *)a1 = 1.0;
  return a1;
}

// FUN_00454417 @ 0x00454417
// [binja] int32_t __stdcall sub_454417(float arg1); wrapper calls PTR_FUN_00479618 (idx 0x1e)
float *FUN_00454417(float *arg1, float arg2)
{
  renderer_select_backend(1);
  return (float *)off_479618((int)arg1, arg2);
}

// FUN_00454433 @ 0x00454433
// [binja] float* __stdcall sub_454433(float* arg1, float arg2)
float *FUN_00454433(float *arg1, float arg2)
{
  float v3; // [esp+8h] [ebp-8h]
  float v4; // [esp+Ch] [ebp-4h]

  v3 = cos(arg2);
  v4 = sin(arg2);
  *arg1 = 1.0;
  arg1[1] = 0.0;
  arg1[6] = v4;
  arg1[2] = 0.0;
  arg1[3] = 0.0;
  arg1[4] = 0.0;
  arg1[5] = v3;
  arg1[7] = 0.0;
  arg1[8] = 0.0;
  arg1[9] = -v4;
  arg1[10] = v3;
  arg1[11] = 0.0;
  arg1[12] = 0.0;
  arg1[13] = 0.0;
  arg1[14] = 0.0;
  arg1[15] = 1.0;
  return arg1;
}

// FUN_004544ad @ 0x004544AD
// [binja] int32_t __stdcall sub_4544ad(float arg1); wrapper calls PTR_FUN_0047961c (idx 0x1f)
float *FUN_004544ad(float *arg1, float arg2)
{
  renderer_select_backend(1);
  return (float *)off_47961C((int)arg1, arg2);
}

// FUN_004544c9 @ 0x004544C9
// [binja] float* __stdcall sub_4544c9(float* arg1, float arg2)
float *FUN_004544c9(float *arg1, float arg2)
{
  float v3; // [esp+8h] [ebp-8h]
  float v4; // [esp+Ch] [ebp-4h]

  v4 = cos(arg2);
  v3 = sin(arg2);
  *arg1 = v4;
  arg1[1] = 0.0;
  arg1[2] = -v3;
  arg1[3] = 0.0;
  arg1[4] = 0.0;
  arg1[5] = 1.0;
  arg1[6] = 0.0;
  arg1[7] = 0.0;
  arg1[8] = v3;
  arg1[9] = 0.0;
  arg1[10] = v4;
  arg1[11] = 0.0;
  arg1[12] = 0.0;
  arg1[13] = 0.0;
  arg1[14] = 0.0;
  arg1[15] = 1.0;
  return arg1;
}

// FUN_00454544 @ 0x00454544
// [binja] int32_t __stdcall sub_454544(float arg1); wrapper calls PTR_FUN_00479620 (idx 0x20)
float *FUN_00454544(float *arg1, float arg2)
{
  renderer_select_backend(1);
  return (float *)off_479620((int)arg1, arg2);
}

// FUN_00454560 @ 0x00454560
// [binja] float* __stdcall sub_454560(float* arg1, float arg2)
float *FUN_00454560(float *arg1, float arg2)
{
  float v3; // [esp+8h] [ebp-8h]
  float v4; // [esp+Ch] [ebp-4h]

  v3 = cos(arg2);
  v4 = sin(arg2);
  *arg1 = v3;
  arg1[1] = v4;
  arg1[2] = 0.0;
  arg1[3] = 0.0;
  arg1[4] = -v4;
  arg1[5] = v3;
  arg1[6] = 0.0;
  arg1[7] = 0.0;
  arg1[8] = 0.0;
  arg1[9] = 0.0;
  arg1[10] = 1.0;
  arg1[11] = 0.0;
  arg1[12] = 0.0;
  arg1[13] = 0.0;
  arg1[14] = 0.0;
  arg1[15] = 1.0;
  return arg1;
}

// FUN_004545dc @ 0x004545DC
// [binja] int32_t __stdcall sub_4545dc(int arg1, float arg2); wrapper calls PTR_FUN_00479648 (idx 0x2a)
float *FUN_004545dc(float *arg1, float *arg2, float arg3)
{
  renderer_select_backend(1);
  return (float *)off_479648((int)arg1, (int)arg2, arg3);
}

// FUN_004545fc @ 0x004545FC
// [binja] float* __stdcall sub_4545fc(float* arg1, float arg2, float arg3)
float *FUN_004545fc(float *arg1, float arg2, float arg3)
{
  double v4; // st7
  double v5; // st6
  double v6; // st5
  double v7; // st4
  double v8; // st3
  double v9; // st2
  double v10; // st3
  float v11; // [esp+8h] [ebp-1Ch] BYREF
  float v12; // [esp+Ch] [ebp-18h]
  float v13; // [esp+10h] [ebp-14h]
  float *v14; // [esp+14h] [ebp-10h]
  float *v15; // [esp+18h] [ebp-Ch]
  float v16; // [esp+1Ch] [ebp-8h] BYREF
  float v17; // [esp+20h] [ebp-4h] BYREF
  float arg2a; // [esp+30h] [ebp+Ch]
  float arg3a; // [esp+34h] [ebp+10h]
  float arg3b; // [esp+34h] [ebp+10h]

  v15 = &v17;
  v14 = &v16;
  v17 = cos(arg3);
  v16 = sin(arg3);
  v11 = *(float *)LODWORD(arg2);
  arg3a = 1.0 - v17;
  v12 = *(float *)(LODWORD(arg2) + 4);
  v13 = *(float *)(LODWORD(arg2) + 8);
  j_FUN_0045315a(&v11, &v11);
  v4 = arg3a;
  arg3b = v12 * v11 * arg3a;
  v5 = v13;
  v6 = v12 * v13 * v4;
  v7 = v13 * v11 * v4;
  *arg1 = v11 * v11 * v4 + v17;
  v8 = v5 * v16;
  arg1[1] = arg3b + v8;
  v9 = v12 * v16;
  arg2a = v9;
  arg1[2] = v7 - v9;
  arg1[3] = 0.0;
  arg1[4] = arg3b - v8;
  arg1[5] = v12 * v12 * v4 + v17;
  v10 = v11 * v16;
  arg1[6] = v10 + v6;
  arg1[7] = 0.0;
  arg1[8] = arg2a + v7;
  arg1[9] = v6 - v10;
  arg1[10] = v5 * v5 * v4 + v17;
  arg1[11] = 0.0;
  arg1[12] = 0.0;
  arg1[13] = 0.0;
  arg1[14] = 0.0;
  arg1[15] = 1.0;
  return arg1;
}

// FUN_004546fe @ 0x004546FE
// [binja] int32_t sub_4546fe()
int FUN_004546fe()
{
  renderer_select_backend(1);
  return off_479638();
}

// sub_454711 @ 0x00454711
float *__stdcall sub_454711(float *a1, float *a2)
{
  double v3; // st7
  double v4; // st6
  double v5; // st5
  double v6; // st4
  double v7; // st3
  float *result; // eax
  double v9; // st2
  float v10; // [esp+0h] [ebp-10h]
  float v11; // [esp+4h] [ebp-Ch]
  float v12; // [esp+8h] [ebp-8h]
  float v13; // [esp+Ch] [ebp-4h]
  float v14; // [esp+Ch] [ebp-4h]
  float v15; // [esp+18h] [ebp+8h]
  float v16; // [esp+1Ch] [ebp+Ch]
  float v17; // [esp+1Ch] [ebp+Ch]

  v13 = *a2 * 2.0;
  v16 = a2[1] * 2.0;
  v3 = 2.0 * a2[2];
  v4 = v13 * a2[3];
  v5 = v16 * a2[3];
  v6 = v3 * a2[3];
  v10 = v13 * *a2;
  v14 = v16 * *a2;
  v12 = v3 * *a2;
  v11 = v16 * a2[1];
  v17 = v3 * a2[1];
  v7 = v3 * a2[2];
  result = a1;
  *a1 = 1.0 - v11 - v7;
  a1[1] = v14 + v6;
  a1[2] = v12 - v5;
  a1[3] = 0.0;
  a1[4] = v14 - v6;
  v9 = 1.0 - v10;
  v15 = v9;
  result[5] = v9 - v7;
  result[6] = v17 + v4;
  result[7] = 0.0;
  result[8] = v12 + v5;
  result[9] = v17 - v4;
  result[10] = v15 - v11;
  result[11] = 0.0;
  result[12] = 0.0;
  result[13] = 0.0;
  result[14] = 0.0;
  result[15] = 1.0;
  return result;
}

// FUN_004547f3 @ 0x004547F3
// [binja] int32_t __stdcall sub_4547f3(float arg1, float arg2, float arg3); wrapper calls PTR_FUN_00479640 (idx 0x28)
float *FUN_004547f3(float *arg1, float arg2, float arg3, float arg4)
{
  renderer_select_backend(1);
  return (float *)off_479640((int)arg1, arg2, arg3, arg4);
}

// FUN_00454821 @ 0x00454821
// [binja] int32_t sub_454821()
int FUN_00454821()
{
  renderer_select_backend(1);
  return off_47963C();
}

// sub_454832 @ 0x00454832
int __stdcall sub_454832(int a1, float a2, int a3, int a4, int a5)
{
  renderer_select_backend(1u);
  return off_479644(a1, a2, a3, a4, a5);
}

// sub_454859 @ 0x00454859
float *__stdcall sub_454859(float *a1, float a2, float *a3, int a4, float *a5)
{
  int v6; // [esp+0h] [ebp-50h]
  int v7; // [esp+4h] [ebp-4Ch]
  int v8; // [esp+8h] [ebp-48h]
  _BYTE v9[12]; // [esp+10h] [ebp-40h] BYREF
  _BYTE v10[52]; // [esp+1Ch] [ebp-34h] BYREF

  a1[14] = 0.0;
  a1[13] = 0.0;
  a1[12] = 0.0;
  a1[11] = 0.0;
  a1[9] = 0.0;
  a1[8] = 0.0;
  a1[7] = 0.0;
  a1[6] = 0.0;
  a1[4] = 0.0;
  a1[3] = 0.0;
  a1[2] = 0.0;
  a1[1] = 0.0;
  *a1 = a2;
  a1[5] = a2;
  a1[10] = a2;
  a1[15] = 1.0;
  if ( a4 )
  {
    j_FUN_004546fe(v9, a4, v6, v7, v8);
    if ( a3 )
    {
      a1[12] = a1[12] - *a3;
      a1[13] = a1[13] - a3[1];
      a1[14] = a1[14] - a3[2];
      j_FUN_00453a57(a1, a1, v10);
      a1[12] = *a3 + a1[12];
      a1[13] = a1[13] + a3[1];
      a1[14] = a3[2] + a1[14];
    }
    else
    {
      j_FUN_00453a57(a1, a1, v10);
    }
  }
  if ( a5 )
  {
    a1[12] = *a5 + a1[12];
    a1[13] = a5[1] + a1[13];
    a1[14] = a5[2] + a1[14];
  }
  return a1;
}

// sub_454966 @ 0x00454966
float *__stdcall sub_454966(float *a1, float *a2, float *a3)
{
  long double v3; // st7
  float *result; // eax
  long double v5; // st7
  long double v6; // st7

  v3 = *a1 * *a1 + a1[1] * a1[1] + a1[2] * a1[2] + a1[3] * a1[3];
  result = a2;
  if ( v3 <= 1.1754944e-38 )
  {
    if ( a2 )
    {
      *a2 = 1.0;
      a2[1] = 0.0;
      a2[2] = 0.0;
    }
    result = a3;
    if ( a3 )
      *a3 = 0.0;
  }
  else
  {
    if ( a2 )
    {
      v5 = 1.0 / sqrt(v3);
      *a2 = v5 * *a1;
      a2[1] = v5 * a1[1];
      a2[2] = v5 * a1[2];
    }
    if ( a3 )
    {
      v6 = acos(a1[3]);
      *a3 = v6 + v6;
    }
  }
  return result;
}

// sub_454A10 @ 0x00454A10
float *__stdcall sub_454A10(float *a1, float *a2)
{
  double v3; // st7
  float *result; // eax
  long double v5; // st6
  double v6; // st7
  double v7; // st6
  int v8; // ebx
  int v9; // edx
  int v10; // edi
  int v11; // esi
  long double v12; // st7
  long double v13; // st6
  long double v14; // st7
  double v15; // st6
  int v16; // ebx
  int v17; // edi
  int v18; // esi
  double v19; // st6
  int v20; // edi
  _DWORD v21[3]; // [esp+0h] [ebp-1Ch]
  float v22; // [esp+Ch] [ebp-10h]
  float v23; // [esp+10h] [ebp-Ch]
  float v24; // [esp+14h] [ebp-8h]
  int v25; // [esp+18h] [ebp-4h]
  int v26; // [esp+24h] [ebp+8h]
  int v27; // [esp+28h] [ebp+Ch]

  v3 = a2[5] + *a2 + a2[10];
  if ( v3 <= 0.0 )
  {
    v21[2] = 0;
    v6 = *a2 - a2[5] - a2[10];
    v22 = v6;
    v21[0] = 1;
    v7 = a2[5];
    v21[1] = 2;
    v23 = v7 - *a2 - a2[10];
    v24 = a2[10] - (a2[5] + *a2);
    v8 = v6 < v23;
    v27 = v8;
    if ( *(&v22 + v8) < (double)v24 )
    {
      v8 = 2;
      v27 = 2;
    }
    v9 = v8;
    result = a1;
    v11 = v21[v8];
    v12 = sqrt(*(&v22 + v8) + 1.0);
    v25 = v21[v8];
    v10 = v25;
    v13 = v12 * 0.5;
    a1[v9] = v13;
    v14 = 0.25 / v13;
    v15 = a2[v11 * 4 + v8] + a2[4 * v8 + v10];
    v16 = 4 * v21[v11] + v27;
    v26 = v21[v11];
    v17 = v21[v11];
    result[v11] = v15 * v14;
    v18 = v17 + v11 * 4;
    v19 = a2[v16] + a2[v17 + v9 * 4];
    v20 = v25;
    result[v26] = v19 * v14;
    result[3] = (a2[v18] - a2[v20 + v26 * 4]) * v14;
  }
  else
  {
    v5 = sqrt(v3 + 1.0) * 0.5;
    a1[3] = v5;
    *a1 = (a2[6] - a2[9]) * (0.25 / v5);
    a1[1] = (a2[8] - a2[2]) * (0.25 / v5);
    a1[2] = (a2[1] - a2[4]) * (0.25 / v5);
    return a1;
  }
  return result;
}

// FUN_00454b44 @ 0x00454B44
// [binja] int32_t __stdcall sub_454b44(int arg1, float arg2); wrapper calls PTR_FUN_00479614 (idx 0x1d)
float *FUN_00454b44(float *arg1, float *arg2, float arg3)
{
  renderer_select_backend(1);
  return (float *)off_479614((int)arg1, (int)arg2, arg3);
}

// FUN_00454b64 @ 0x00454B64
// [binja] float* __stdcall sub_454b64(float arg1, float arg2, float arg3)
float *FUN_00454b64(float arg1, float arg2, float arg3)
{
  float v5[3]; // [esp+0h] [ebp-14h] BYREF
  float *v6; // [esp+10h] [ebp-4h]
  float arg1a; // [esp+1Ch] [ebp+8h]
  float arg2a; // [esp+20h] [ebp+Ch]

  j_FUN_0045315a(v5, LODWORD(arg2));
  v6 = (float *)(LODWORD(arg1) + 12);
  arg1a = arg3 * 0.5;
  *v6 = cos(arg1a);
  arg2a = sin(arg1a);
  *(float *)LODWORD(arg1) = v5[0] * arg2a;
  *(float *)(LODWORD(arg1) + 4) = v5[1] * arg2a;
  *(float *)(LODWORD(arg1) + 8) = v5[2] * arg2a;
  return (float *)LODWORD(arg1);
}

// FUN_00454bc0 @ 0x00454BC0
// [binja] int32_t __stdcall sub_454bc0(float arg1, float arg2, float arg3); wrapper calls PTR_FUN_00479604 (idx 0x19)
float *FUN_00454bc0(float *arg1, float arg2, float arg3, float arg4)
{
  renderer_select_backend(1);
  return (float *)off_479604((int)arg1, arg2, arg3, arg4);
}

// sub_454BF4 @ 0x00454BF4
float *__stdcall sub_454BF4(float *a1, float a2, float a3, float a4)
{
  double v5; // st7
  double v6; // st6
  double v7; // st7
  double v8; // st6
  float v9; // [esp+8h] [ebp-18h]
  float v10; // [esp+Ch] [ebp-14h]
  float v11; // [esp+10h] [ebp-10h]
  float v12; // [esp+14h] [ebp-Ch]
  float v13; // [esp+18h] [ebp-8h]
  float v14; // [esp+1Ch] [ebp-4h]
  float v15; // [esp+30h] [ebp+10h]
  float v16; // [esp+30h] [ebp+10h]
  float v17; // [esp+34h] [ebp+14h]

  v9 = a4 * 0.5;
  v14 = cos(v9);
  v17 = sin(v9);
  v15 = a3 * 0.5;
  v12 = cos(v15);
  v10 = sin(v15);
  v16 = a2 * 0.5;
  v13 = cos(v16);
  v11 = sin(v16);
  v5 = v11 * v12;
  v6 = v13 * v10;
  *a1 = v14 * v6 + v5 * v17;
  a1[1] = v5 * v14 - v6 * v17;
  v7 = v13 * v12;
  v8 = v11 * v10;
  a1[2] = v7 * v17 - v8 * v14;
  a1[3] = v8 * v17 + v7 * v14;
  return a1;
}

// FUN_00454ccd @ 0x00454CCD
// [binja] int32_t sub_454ccd()
int FUN_00454ccd()
{
  renderer_select_backend(1);
  return off_4795EC();
}

// sub_454CE0 @ 0x00454CE0
float *__stdcall sub_454CE0(float *a1, float *a2, float *a3)
{
  double v3; // st5
  double v4; // st6
  double v5; // st7

  v3 = a3[3] * a2[1] - *a3 * a2[2] + a3[1] * a2[3] + a3[2] * *a2;
  v4 = a3[3] * a2[2] + *a3 * a2[1] - a3[1] * *a2 + a3[2] * a2[3];
  v5 = a3[3] * a2[3] - *a3 * *a2 - a3[1] * a2[1] - a3[2] * a2[2];
  *a1 = a3[3] * *a2 + *a3 * a2[3] + a3[1] * a2[2] - a3[2] * a2[1];
  a1[1] = v3;
  a1[2] = v4;
  a1[3] = v5;
  return a1;
}

// sub_454D83 @ 0x00454D83
float *__stdcall sub_454D83(float *a1, float *a2)
{
  float *v2; // esi
  float *result; // eax
  float *v4; // esi
  long double v5; // st7
  long double v6; // st7
  float v7[4]; // [esp+10h] [ebp-10h] BYREF
  float v8; // [esp+2Ch] [ebp+Ch]

  v2 = a2;
  v8 = *a2 * *a2 + a2[1] * a2[1] + a2[2] * a2[2] + a2[3] * a2[3];
  if ( float_near_equal(v8, 1.0) )
  {
    result = a1;
    if ( a1 == v2 )
      return result;
    goto LABEL_3;
  }
  result = a1;
  if ( v8 > 1.1754944e-38 )
  {
    v5 = 1.0 / sqrt(v8);
    v7[0] = v5 * *v2;
    v7[1] = v5 * v2[1];
    v7[2] = v5 * v2[2];
    v6 = v5 * v2[3];
    v2 = v7;
    v7[3] = v6;
LABEL_3:
    *result = *v2;
    v4 = v2 + 1;
    result[1] = *v4++;
    result[2] = *v4;
    result[3] = v4[1];
    return result;
  }
  *a1 = 0.0;
  a1[1] = 0.0;
  a1[2] = 0.0;
  a1[3] = 0.0;
  return result;
}

// FUN_00454e3c @ 0x00454E3C
// [binja] int32_t sub_454e3c()
int FUN_00454e3c()
{
  renderer_select_backend(1);
  return off_479650();
}

// sub_454E4F @ 0x00454E4F
float *__stdcall sub_454E4F(float *a1, float *a2)
{
  float *v3; // ecx
  double v4; // st7
  double v5; // st7
  float v7; // [esp+14h] [ebp+Ch]

  v3 = a1;
  v7 = *a2 * *a2 + a2[1] * a2[1] + a2[2] * a2[2] + a2[3] * a2[3];
  if ( v7 <= 1.0842022e-19 )
  {
    *a1 = 0.0;
    a1[1] = 0.0;
    a1[2] = 0.0;
    v5 = 0.0;
    goto LABEL_5;
  }
  *a1 = -*a2;
  a1[1] = -a2[1];
  a1[2] = -a2[2];
  a1[3] = a2[3];
  if ( !float_near_equal(v7, 1.0) )
  {
    v4 = 1.0 / v7;
    *v3 = v4 * *v3;
    v3[1] = v4 * v3[1];
    v3[2] = v4 * v3[2];
    v5 = v4 * v3[3];
LABEL_5:
    v3[3] = v5;
  }
  return v3;
}

// sub_454F09 @ 0x00454F09
float *__stdcall sub_454F09(float *a1, float *a2)
{
  long double v3; // st7
  bool v4; // zf
  float *result; // eax
  double v6; // st7
  float v7; // [esp+Ch] [ebp-4h]
  float v8; // [esp+1Ch] [ebp+Ch]

  if ( a2[3] >= 1.0 )
  {
    result = a1;
    goto LABEL_5;
  }
  v3 = acos(a2[3]);
  v7 = sin(v3);
  v4 = !float_near_equal(v7, 0.0);
  result = a1;
  if ( !v4 )
  {
LABEL_5:
    *result = *a2;
    result[1] = a2[1];
    result[2] = a2[2];
    goto LABEL_6;
  }
  v8 = v3;
  v6 = v8 / v7;
  *a1 = v6 * *a2;
  a1[1] = v6 * a2[1];
  a1[2] = v6 * a2[2];
LABEL_6:
  result[3] = 0.0;
  return result;
}

// sub_454F8D @ 0x00454F8D
float *__stdcall sub_454F8D(float *a1, float *a2)
{
  float *v2; // ecx
  double v3; // st7
  float v5; // [esp+10h] [ebp-4h]
  float v6; // [esp+20h] [ebp+Ch]

  v5 = sqrt(*a2 * *a2 + a2[1] * a2[1] + a2[2] * a2[2]);
  a1[3] = cos(v5);
  v6 = sin(v5);
  if ( float_near_equal(v6, 0.0) )
  {
    if ( a1 != v2 )
    {
      *a1 = *v2;
      a1[1] = v2[1];
      a1[2] = v2[2];
    }
  }
  else
  {
    v3 = v6 / v5;
    *a1 = v3 * *v2;
    a1[1] = v3 * v2[1];
    a1[2] = v3 * v2[2];
  }
  return a1;
}

// FUN_00455028 @ 0x00455028
// [binja] int32_t __stdcall sub_455028(int arg1, int arg2, float arg3); wrapper calls PTR_FUN_0047962c (idx 0x23)
float *FUN_00455028(float *arg1, float *arg2, float *arg3, float arg4)
{
  renderer_select_backend(1);
  return (float *)off_47962C((int)arg1, (int)arg2, (int)arg3, arg4);
}

// sub_455052 @ 0x00455052
float *__stdcall sub_455052(float *a1, float *a2, float *a3, float a4)
{
  double v5; // st7
  double v7; // st6
  double v8; // st5
  long double v9; // st6
  long double v10; // st6
  long double v11; // st6
  float v13; // [esp+0h] [ebp-4h]
  float v14; // [esp+10h] [ebp+Ch]
  float v15; // [esp+14h] [ebp+10h]
  float v16; // [esp+14h] [ebp+10h]

  v5 = 1.0 - a4;
  v7 = *a2 * *a3 + a3[2] * a2[2] + a3[1] * a2[1] + a3[3] * a2[3];
  if ( v7 < 0.0 )
    v14 = -1.0;
  else
    v14 = 1.0;
  v8 = v14 * v7;
  if ( 1.0 - v8 <= 0.00000011920929 )
  {
    v10 = a4;
  }
  else
  {
    v9 = sqrt(1.0 - v8 * v8);
    v15 = v8;
    v16 = atan2(v9, v15);
    v13 = 1.0 / v9;
    v5 = sin(v16 * v5) * v13;
    v10 = sin(v16 * a4) * v13;
  }
  v11 = v10 * v14;
  *a1 = v5 * *a2 + v11 * *a3;
  a1[1] = v11 * a3[1] + v5 * a2[1];
  a1[2] = v11 * a3[2] + v5 * a2[2];
  a1[3] = v11 * a3[3] + v5 * a2[3];
  return a1;
}

// sub_455135 @ 0x00455135
int __stdcall sub_455135(int a1, int a2, int a3, int a4, int a5, float a6)
{
  renderer_select_backend(1u);
  return off_47964C(a1, a2, a3, a4, a5, a6);
}

// sub_45515F @ 0x0045515F
int __stdcall sub_45515F(int a1, int a2, int a3, int a4, int a5, float a6)
{
  float v7; // [esp+0h] [ebp-24h]
  int v8[4]; // [esp+4h] [ebp-20h] BYREF
  int v9[4]; // [esp+14h] [ebp-10h] BYREF

  j_FUN_00455028((int)v8, a2, a5, a6);
  j_FUN_00455028((int)v9, a3, a4, a6);
  v7 = (1.0 - a6) * a6 + (1.0 - a6) * a6;
  j_FUN_00455028(a1, (int)v8, (int)v9, v7);
  return a1;
}

// FUN_004551b6 @ 0x004551B6
// [binja] int32_t sub_4551b6()
int FUN_004551b6()
{
  renderer_select_backend(1);
  return off_479654();
}

// sub_4551C7 @ 0x004551C7
int __stdcall sub_4551C7(int a1, int a2, int a3, int a4, float a5, float a6)
{
  renderer_select_backend(1u);
  return off_479630(a1, a2, a3, a4, a5, a6);
}

// sub_4551F6 @ 0x004551F6
_DWORD *__stdcall sub_4551F6(_DWORD *a1, _DWORD *a2, int a3, int a4, float a5, float a6)
{
  float v7; // [esp+4h] [ebp-28h]
  int v8[4]; // [esp+Ch] [ebp-20h] BYREF
  int v9[4]; // [esp+1Ch] [ebp-10h] BYREF
  float v10; // [esp+44h] [ebp+18h]

  v10 = a5 + a6;
  if ( float_near_equal(v10, 0.0) )
  {
    if ( a1 != a2 )
    {
      *a1 = *a2;
      a1[1] = a2[1];
      a1[2] = a2[2];
      a1[3] = a2[3];
    }
  }
  else
  {
    j_FUN_00455028((int)v8, (int)a2, a3, v10);
    j_FUN_00455028((int)v9, (int)a2, a4, v10);
    v7 = a6 / v10;
    j_FUN_00455028((int)a1, (int)v8, (int)v9, v7);
  }
  return a1;
}

// FUN_00455281 @ 0x00455281
// [binja] int32_t sub_455281()
int FUN_00455281()
{
  renderer_select_backend(1);
  return off_4795F4();
}

// sub_455294 @ 0x00455294
float *__stdcall sub_455294(float *a1, float *a2)
{
  float *result; // eax
  float *v4; // esi
  long double v5; // st7
  long double v6; // st7
  float v7; // [esp+18h] [ebp+Ch]

  v7 = *a2 * *a2 + a2[1] * a2[1] + a2[2] * a2[2];
  if ( float_near_equal(v7, 1.0) )
  {
    result = a1;
    if ( a1 != a2 )
    {
      *a1 = *a2;
      v4 = a2 + 1;
      a1[1] = *v4++;
      a1[2] = *v4;
      a1[3] = v4[1];
    }
  }
  else
  {
    result = a1;
    if ( v7 <= 1.1754944e-38 )
    {
      *a1 = 0.0;
      a1[1] = 0.0;
      a1[2] = 0.0;
      v6 = 0.0;
    }
    else
    {
      v5 = 1.0 / sqrt(v7);
      *a1 = v5 * *a2;
      a1[1] = v5 * a2[1];
      a1[2] = v5 * a2[2];
      v6 = v5 * a2[3];
    }
    a1[3] = v6;
  }
  return result;
}

// sub_455345 @ 0x00455345
float *__stdcall sub_455345(float *a1, float *a2, float *a3, float *a4)
{
  double v4; // st7
  double v5; // st6
  float v7; // [esp+1Ch] [ebp+Ch]

  v4 = *a2 * *a3 + a2[1] * a3[1] + a3[2] * a2[2];
  v5 = v4 - (*a2 * *a4 + a4[2] * a2[2] + a2[1] * a4[1]);
  if ( v5 == 0.0 )
    return 0;
  v7 = (v4 + a2[3]) / v5;
  if ( !_finite(v7) )
    return 0;
  *a1 = (*a4 - *a3) * v7 + *a3;
  a1[1] = (a4[1] - a3[1]) * v7 + a3[1];
  a1[2] = (a4[2] - a3[2]) * v7 + a3[2];
  return a1;
}

// sub_4553F4 @ 0x004553F4
int __stdcall sub_4553F4(int a1, float *a2, int a3)
{
  *(float *)a1 = *(float *)a3;
  *(_DWORD *)(a1 + 4) = *(_DWORD *)(a3 + 4);
  *(_DWORD *)(a1 + 8) = *(_DWORD *)(a3 + 8);
  *(float *)(a1 + 12) = -(a2[1] * *(float *)(a3 + 4) + a2[2] * *(float *)(a3 + 8) + *a2 * *(float *)a3);
  return a1;
}

// sub_455439 @ 0x00455439
float *__stdcall sub_455439(float *a1, float *a2, float *a3, float *a4)
{
  double v4; // st7
  double v5; // st6
  double v6; // st5
  double v7; // st4
  float v9; // [esp+Ch] [ebp-18h]
  float v10; // [esp+10h] [ebp-14h]
  float v11; // [esp+14h] [ebp-10h]
  float v12; // [esp+18h] [ebp-Ch]
  float v13; // [esp+1Ch] [ebp-8h]

  v4 = *a2 - *a3;
  v5 = a2[1] - a3[1];
  v6 = a2[2] - a3[2];
  v12 = *a2 - *a4;
  v13 = a2[1] - a4[1];
  v7 = a2[2] - a4[2];
  v9 = v7 * v5 - v13 * v6;
  v10 = v6 * v12 - v7 * v4;
  v11 = v13 * v4 - v12 * v5;
  *a1 = v9;
  a1[1] = v10;
  a1[2] = v11;
  j_FUN_0045315a(a1, a1);
  a1[3] = -(a1[2] * a2[2] + a1[1] * a2[1] + *a1 * *a2);
  return a1;
}

// sub_4554E8 @ 0x004554E8
float *__stdcall sub_4554E8(float *a1, float *a2, float *a3)
{
  float v4; // [esp+8h] [ebp-10h]
  float v5; // [esp+Ch] [ebp-Ch]
  float v6; // [esp+10h] [ebp-8h]
  float v7; // [esp+14h] [ebp-4h]

  v4 = a3[8] * a2[2] + a3[12] * a2[3] + a3[4] * a2[1] + *a2 * *a3;
  v5 = a3[9] * a2[2] + a3[1] * *a2 + a3[13] * a2[3] + a3[5] * a2[1];
  v6 = a3[10] * a2[2] + a3[2] * *a2 + a3[14] * a2[3] + a3[6] * a2[1];
  v7 = a3[11] * a2[2] + a3[3] * *a2 + a3[15] * a2[3] + a3[7] * a2[1];
  *a1 = v4;
  a1[1] = v5;
  a1[2] = v6;
  a1[3] = v7;
  return a1;
}

// FUN_00455587 @ 0x00455587
// [binja] int32_t* __stdcall sub_455587(int32_t* arg1, float arg2)
int *FUN_00455587(int *arg1, float arg2)
{
  int *v2; // ecx
  int *result; // eax
  int v4; // ecx
  long double v5; // st7
  long double v6; // st7
  float v7; // [esp+8h] [ebp-8h]
  int v8; // [esp+Ch] [ebp-4h]
  float arg2a; // [esp+1Ch] [ebp+Ch]

  arg2a = *(float *)LODWORD(arg2) * *(float *)LODWORD(arg2)
        + *(float *)(LODWORD(arg2) + 4) * *(float *)(LODWORD(arg2) + 4);
  if ( float_near_equal(arg2a, 1.0) )
  {
    result = arg1;
    if ( arg1 == v2 )
      return result;
    *arg1 = *v2;
    v4 = v2[1];
    goto LABEL_4;
  }
  result = arg1;
  if ( arg2a > 1.1754944e-38 )
  {
    v5 = 1.0 / sqrt(arg2a);
    v7 = v5 * *(float *)v2;
    v6 = v5 * *((float *)v2 + 1);
    *(float *)arg1 = v7;
    *(float *)&v8 = v6;
    v4 = v8;
LABEL_4:
    result[1] = v4;
    return result;
  }
  *(float *)arg1 = 0.0;
  *((float *)arg1 + 1) = 0.0;
  return result;
}

// FUN_00455614 @ 0x00455614
// [binja] float* __stdcall sub_455614(float* arg1, float* arg2, float* arg3)
float *FUN_00455614(float *arg1, float *arg2, float *arg3)
{
  float v4; // [esp+8h] [ebp-10h]
  float v5; // [esp+Ch] [ebp-Ch]
  float v6; // [esp+10h] [ebp-8h]
  float v7; // [esp+14h] [ebp-4h]

  v4 = arg3[4] * arg2[1] + *arg2 * *arg3 + arg3[12];
  v5 = arg3[1] * *arg2 + arg3[5] * arg2[1] + arg3[13];
  v6 = arg3[2] * *arg2 + arg3[6] * arg2[1] + arg3[14];
  v7 = arg3[3] * *arg2 + arg3[7] * arg2[1] + arg3[15];
  *arg1 = v4;
  arg1[1] = v5;
  arg1[2] = v6;
  arg1[3] = v7;
  return arg1;
}

// FUN_0045567f @ 0x0045567F
// [binja] float* __stdcall sub_45567f(float* arg1, float* arg2, float* arg3)
float *FUN_0045567f(float *arg1, float *arg2, float *arg3)
{
  double v3; // st6
  double v4; // st7
  bool v5; // zf
  float *result; // eax
  double v7; // st7
  float a; // [esp+8h] [ebp-4h]

  v3 = *arg2 * arg3[1] + arg2[1] * arg3[5] + arg3[13];
  v4 = *arg2 * arg3[3] + arg2[1] * arg3[7] + arg3[15];
  *arg1 = *arg2 * *arg3 + arg2[1] * arg3[4] + arg3[12];
  arg1[1] = v3;
  a = v4;
  v5 = float_near_equal(a, 1.0) == 0;
  result = arg1;
  if ( v5 )
  {
    v7 = 1.0 / a;
    *arg1 = v7 * *arg1;
    arg1[1] = v7 * arg1[1];
  }
  return result;
}

// FUN_004556ff @ 0x004556FF
// [binja] float* __stdcall sub_4556ff(float* arg1, float* arg2, float* arg3)
float *FUN_004556ff(float *arg1, float *arg2, float *arg3)
{
  double v3; // st7
  double v4; // st6
  float v6; // [esp+0h] [ebp-8h]
  float v7; // [esp+4h] [ebp-4h]

  v6 = arg3[4] * arg2[1] + *arg2 * *arg3;
  v3 = arg3[1] * *arg2;
  v4 = arg3[5] * arg2[1];
  *arg1 = v6;
  v7 = v3 + v4;
  arg1[1] = v7;
  return arg1;
}

// FUN_0045573b @ 0x0045573B
// [binja] float* __stdcall sub_45573b(float* arg1, float arg2)
float *FUN_0045573b(float *arg1, float arg2)
{
  float *v2; // esi
  float *result; // eax
  float *v4; // esi
  long double v5; // st7
  long double v6; // st7
  float v7[3]; // [esp+10h] [ebp-Ch] BYREF
  float arg2a; // [esp+28h] [ebp+Ch]

  v2 = (float *)LODWORD(arg2);
  arg2a = *(float *)LODWORD(arg2) * *(float *)LODWORD(arg2)
        + *(float *)(LODWORD(arg2) + 4) * *(float *)(LODWORD(arg2) + 4)
        + *(float *)(LODWORD(arg2) + 8) * *(float *)(LODWORD(arg2) + 8);
  if ( float_near_equal(arg2a, 1.0) )
  {
    result = arg1;
    if ( arg1 == v2 )
      return result;
    goto LABEL_3;
  }
  result = arg1;
  if ( arg2a > 1.1754944e-38 )
  {
    v5 = 1.0 / sqrt(arg2a);
    v7[0] = v5 * *v2;
    v7[1] = v5 * v2[1];
    v6 = v5 * v2[2];
    v2 = v7;
    v7[2] = v6;
LABEL_3:
    *result = *v2;
    v4 = v2 + 1;
    result[1] = *v4;
    result[2] = v4[1];
    return result;
  }
  *arg1 = 0.0;
  arg1[1] = 0.0;
  arg1[2] = 0.0;
  return result;
}

// FUN_004557db @ 0x004557DB
// [binja] float* __stdcall sub_4557db(float* arg1, float* arg2, float* arg3)
float *FUN_004557db(float *arg1, float *arg2, float *arg3)
{
  double v3; // st5
  double v4; // st6
  double v5; // st7
  bool v6; // zf
  float *result; // eax
  double v8; // st7
  float a; // [esp+8h] [ebp-4h]

  v3 = *arg2 * arg3[1] + arg2[1] * arg3[5] + arg2[2] * arg3[9] + arg3[13];
  v4 = *arg2 * arg3[2] + arg2[1] * arg3[6] + arg2[2] * arg3[10] + arg3[14];
  v5 = *arg2 * arg3[3] + arg2[1] * arg3[7] + arg2[2] * arg3[11] + arg3[15];
  *arg1 = *arg2 * *arg3 + arg2[1] * arg3[4] + arg2[2] * arg3[8] + arg3[12];
  arg1[1] = v3;
  arg1[2] = v4;
  a = v5;
  v6 = float_near_equal(a, 1.0) == 0;
  result = arg1;
  if ( v6 )
  {
    v8 = 1.0 / a;
    *arg1 = v8 * *arg1;
    arg1[1] = v8 * arg1[1];
    arg1[2] = v8 * arg1[2];
  }
  return result;
}

// sub_45589A @ 0x0045589A
float *__stdcall sub_45589A(float *a1, int a2, int a3, float *a4, float *a5, float *a6)
{
  float *v6; // esi
  float *v8; // [esp-4h] [ebp-54h]
  float v9[16]; // [esp+10h] [ebp-40h] BYREF

  v6 = v9;
  switch ( (a4 != 0) | (2 * ((a5 != 0) | (2 * (a6 != 0)))) )
  {
    case 0:
      v9[14] = 0.0;
      v9[13] = 0.0;
      v9[12] = 0.0;
      v9[11] = 0.0;
      v9[9] = 0.0;
      v9[8] = 0.0;
      v9[7] = 0.0;
      v9[6] = 0.0;
      v9[4] = 0.0;
      v9[3] = 0.0;
      v9[2] = 0.0;
      v9[1] = 0.0;
      v9[15] = 1.0;
      v9[10] = 1.0;
      v9[5] = 1.0;
      v9[0] = 1.0;
      break;
    case 1:
      v6 = a4;
      break;
    case 2:
      v6 = a5;
      break;
    case 3:
      j_FUN_00453a57(v9, a5, a4);
      break;
    case 4:
      v6 = a6;
      break;
    case 5:
      v8 = a4;
      goto LABEL_9;
    case 6:
      v8 = a5;
LABEL_9:
      j_FUN_00453a57(v9, a6, v8);
      break;
    case 7:
      j_FUN_00453a57(v9, a6, a5);
      j_FUN_00453a57(v9, v9, a4);
      break;
    default:
      break;
  }
  j_FUN_00453464(a1, a2, v6);
  if ( a3 )
  {
    *a1 = (*a1 + 1.0) * (double)*(unsigned int *)(a3 + 8) * 0.5 + (double)*(unsigned int *)a3;
    a1[1] = (1.0 - a1[1]) * (double)*(unsigned int *)(a3 + 12) * 0.5 + (double)*(unsigned int *)(a3 + 4);
    a1[2] = (*(float *)(a3 + 20) - *(float *)(a3 + 16)) * a1[2] + *(float *)(a3 + 16);
  }
  return a1;
}

// FUN_00455a27 @ 0x00455A27
// [binja] float* __stdcall sub_455a27(float* arg1, float* arg2, int32_t* arg3, int32_t* arg4, int32_t* arg5, int32_t* arg6)
float *FUN_00455a27(float *arg1, float *arg2, int *arg3, int *arg4, int *arg5, int *arg6)
{
  double v6; // st7
  double v7; // st7
  int *v9; // [esp+10h] [ebp-54h]
  float v10[16]; // [esp+24h] [ebp-40h] BYREF

  switch ( (arg4 != 0) | (2 * ((arg5 != 0) | (2 * (arg6 != 0)))) )
  {
    case 0:
      v10[14] = 0.0;
      v10[13] = 0.0;
      v10[12] = 0.0;
      v10[11] = 0.0;
      v10[9] = 0.0;
      v10[8] = 0.0;
      v10[7] = 0.0;
      v10[6] = 0.0;
      v10[4] = 0.0;
      v10[3] = 0.0;
      v10[2] = 0.0;
      v10[1] = 0.0;
      v10[15] = 1.0;
      v10[10] = 1.0;
      v10[5] = 1.0;
      v10[0] = 1.0;
      break;
    case 1:
      j_FUN_00453f63(v10, 0, arg4);
      break;
    case 2:
      j_FUN_00453f63(v10, 0, arg5);
      break;
    case 3:
      j_FUN_00453a57(v10, arg5, arg4);
      goto LABEL_11;
    case 4:
      j_FUN_00453f63(v10, 0, arg6);
      break;
    case 5:
      v9 = arg4;
      goto LABEL_9;
    case 6:
      v9 = arg5;
LABEL_9:
      j_FUN_00453a57(v10, arg6, v9);
      goto LABEL_11;
    case 7:
      j_FUN_00453a57(v10, arg6, arg5);
      j_FUN_00453a57(v10, v10, arg4);
LABEL_11:
      j_FUN_00453f63(v10, 0, v10);
      break;
    default:
      break;
  }
  if ( arg3 )
  {
    v6 = *arg2 - (double)(unsigned int)*arg3;
    *arg1 = v6 / (double)(unsigned int)arg3[2] + v6 / (double)(unsigned int)arg3[2] - 1.0;
    v7 = arg2[1] - (double)(unsigned int)arg3[1];
    arg1[1] = -(v7 / (double)(unsigned int)arg3[3] + v7 / (double)(unsigned int)arg3[3] - 1.0);
    arg1[2] = (arg2[2] - *((float *)arg3 + 4)) / (*((float *)arg3 + 5) - *((float *)arg3 + 4));
    j_FUN_00453464(arg1, arg1, v10);
  }
  else
  {
    j_FUN_00453464(arg1, arg2, v10);
  }
  return arg1;
}

// FUN_00455bcd @ 0x00455BCD
// [binja] float* __stdcall sub_455bcd(float* arg1, float arg2)
float *FUN_00455bcd(float *arg1, float arg2)
{
  float *v2; // esi
  float *result; // eax
  float *v4; // esi
  long double v5; // st7
  long double v6; // st7
  float v7[4]; // [esp+10h] [ebp-10h] BYREF
  float arg2a; // [esp+2Ch] [ebp+Ch]

  v2 = (float *)LODWORD(arg2);
  arg2a = *(float *)LODWORD(arg2) * *(float *)LODWORD(arg2)
        + *(float *)(LODWORD(arg2) + 4) * *(float *)(LODWORD(arg2) + 4)
        + *(float *)(LODWORD(arg2) + 8) * *(float *)(LODWORD(arg2) + 8)
        + *(float *)(LODWORD(arg2) + 12) * *(float *)(LODWORD(arg2) + 12);
  if ( float_near_equal(arg2a, 1.0) )
  {
    result = arg1;
    if ( arg1 == v2 )
      return result;
    goto LABEL_3;
  }
  result = arg1;
  if ( arg2a > 1.1754944e-38 )
  {
    v5 = 1.0 / sqrt(arg2a);
    v7[0] = v5 * *v2;
    v7[1] = v5 * v2[1];
    v7[2] = v5 * v2[2];
    v6 = v5 * v2[3];
    v2 = v7;
    v7[3] = v6;
LABEL_3:
    *result = *v2;
    v4 = v2 + 1;
    result[1] = *v4++;
    result[2] = *v4;
    result[3] = v4[1];
    return result;
  }
  *arg1 = 0.0;
  arg1[1] = 0.0;
  arg1[2] = 0.0;
  arg1[3] = 0.0;
  return result;
}

// FUN_00455c86 @ 0x00455C86
// [binja] int32_t __stdcall sub_455c86(int32_t arg1, float arg2, float arg3, float arg4)
int FUN_00455c86(int arg1, float arg2, float arg3, float arg4)
{
  int v5[4]; // [esp+Ch] [ebp-10h] BYREF

  j_FUN_00454bc0((int)v5, arg2, arg3, arg4);
  ((void (__stdcall *)(int, int *))j_FUN_004546fe)(arg1, v5);
  return arg1;
}

// sub_455CBF @ 0x00455CBF
float *__stdcall sub_455CBF(float *a1, float *a2, int a3, float *a4, float *a5, int a6, float *a7)
{
  int v7; // ecx
  int v8; // ecx
  float *v9; // esi
  int v10; // eax
  char *v12; // [esp+Ch] [ebp-D0h]
  int v13; // [esp+10h] [ebp-CCh]
  int v14; // [esp+14h] [ebp-C8h]
  _DWORD v15[16]; // [esp+1Ch] [ebp-C0h] BYREF
  _BYTE v16[4]; // [esp+5Ch] [ebp-80h] BYREF
  char v17; // [esp+60h] [ebp-7Ch] BYREF
  _BYTE v18[52]; // [esp+68h] [ebp-74h] BYREF
  _BYTE v19[4]; // [esp+9Ch] [ebp-40h] BYREF
  _BYTE v20[60]; // [esp+A0h] [ebp-3Ch] BYREF

  if ( a4 )
  {
    if ( a3 )
    {
      *(float *)&v15[14] = 0.0;
      v7 = *(_DWORD *)a4;
      *(float *)&v15[13] = 0.0;
      v15[0] = v7;
      v8 = *((_DWORD *)a4 + 1);
      *(float *)&v15[12] = 0.0;
      *(float *)&v15[10] = a4[2];
      *(float *)&v15[11] = 0.0;
      v15[5] = v8;
      *(float *)&v15[9] = 0.0;
      *(float *)&v15[8] = 0.0;
      *(float *)&v15[7] = 0.0;
      *(float *)&v15[6] = 0.0;
      *(float *)&v15[4] = 0.0;
      *(float *)&v15[3] = 0.0;
      *(float *)&v15[2] = 0.0;
      *(float *)&v15[1] = 0.0;
      *(float *)&v15[15] = 1.0;
      j_FUN_004546fe(v16, a3, v12, v13, v14);
      v12 = &v17;
      if ( a2 )
      {
        j_FUN_00453ca0(v20);
        v9 = a1;
        a1[14] = 0.0;
        a1[13] = 0.0;
        a1[12] = 0.0;
        a1[11] = 0.0;
        a1[9] = 0.0;
        a1[8] = 0.0;
        a1[7] = 0.0;
        a1[6] = 0.0;
        a1[4] = 0.0;
        a1[3] = 0.0;
        a1[2] = 0.0;
        a1[1] = 0.0;
        a1[15] = 1.0;
        a1[10] = 1.0;
        a1[5] = 1.0;
        *a1 = 1.0;
        a1[12] = -*a2;
        a1[13] = -a2[1];
        a1[14] = -a2[2];
        j_FUN_00453a57(a1, a1, v19);
        j_FUN_00453a57(v9, v9, v15);
        j_FUN_00453a57(v9, v9, v16);
        a1[12] = a1[12] + *a2;
        a1[13] = a2[1] + a1[13];
        a1[14] = a1[14] + a2[2];
      }
      else
      {
        v9 = a1;
        j_FUN_00453ca0(a1);
        j_FUN_00453a57(v9, v9, v15);
        j_FUN_00453a57(v9, v9, v16);
      }
    }
    else
    {
      v9 = a1;
      a1[14] = 0.0;
      a1[13] = 0.0;
      a1[12] = 0.0;
      a1[11] = 0.0;
      a1[9] = 0.0;
      a1[8] = 0.0;
      a1[7] = 0.0;
      a1[6] = 0.0;
      a1[4] = 0.0;
      a1[3] = 0.0;
      a1[2] = 0.0;
      a1[1] = 0.0;
      *a1 = *a4;
      a1[5] = a4[1];
      v10 = *((_DWORD *)a4 + 2);
      a1[15] = 1.0;
      *((_DWORD *)a1 + 10) = v10;
    }
  }
  else
  {
    v9 = a1;
    a1[14] = 0.0;
    a1[13] = 0.0;
    a1[12] = 0.0;
    a1[11] = 0.0;
    a1[9] = 0.0;
    a1[8] = 0.0;
    a1[7] = 0.0;
    a1[6] = 0.0;
    a1[4] = 0.0;
    a1[3] = 0.0;
    a1[2] = 0.0;
    a1[1] = 0.0;
    a1[15] = 1.0;
    a1[10] = 1.0;
    a1[5] = 1.0;
    *a1 = 1.0;
  }
  if ( a6 )
  {
    j_FUN_004546fe(v16, a6, v12, v13, v14);
    if ( a5 )
    {
      v9[12] = v9[12] - *a5;
      v9[13] = v9[13] - a5[1];
      v9[14] = v9[14] - a5[2];
      j_FUN_00453a57(v9, v9, v18);
      v9[12] = v9[12] + *a5;
      v9[13] = v9[13] + a5[1];
      v9[14] = v9[14] + a5[2];
    }
    else
    {
      j_FUN_00453a57(v9, v9, v18);
    }
  }
  if ( a7 )
  {
    v9[12] = v9[12] + *a7;
    v9[13] = a7[1] + v9[13];
    v9[14] = a7[2] + v9[14];
  }
  return v9;
}

// sub_455F73 @ 0x00455F73
float *__stdcall sub_455F73(float *a1, float *a2, int a3)
{
  double v4; // st7
  double v5; // st6
  double v6; // st5
  double v7; // st4
  double v8; // st3
  float v9; // [esp+8h] [ebp-18h]
  float v10; // [esp+Ch] [ebp-14h]
  float v11; // [esp+10h] [ebp-10h] BYREF
  float v12; // [esp+14h] [ebp-Ch]
  float v13; // [esp+18h] [ebp-8h]
  float v14; // [esp+1Ch] [ebp-4h]

  j_FUN_00455281(&v11, a3);
  v4 = v12 * a2[1] + v11 * *a2 + v14 * a2[3] + v13 * a2[2];
  v5 = -v11;
  v6 = -v12;
  v7 = -v13;
  v9 = v7;
  v8 = -v14;
  v10 = v8;
  *a1 = v5 * *a2 + v4;
  a1[4] = v6 * *a2;
  a1[8] = v7 * *a2;
  a1[12] = v8 * *a2;
  a1[1] = v5 * a2[1];
  a1[5] = v6 * a2[1] + v4;
  a1[9] = v7 * a2[1];
  a1[13] = v8 * a2[1];
  a1[2] = v5 * a2[2];
  a1[6] = v6 * a2[2];
  a1[10] = v7 * a2[2] + v4;
  a1[14] = v8 * a2[2];
  a1[3] = v5 * a2[3];
  a1[7] = v6 * a2[3];
  a1[11] = v9 * a2[3];
  a1[15] = v10 * a2[3] + v4;
  return a1;
}

// sub_45604D @ 0x0045604D
float *__stdcall sub_45604D(float *a1, int a2)
{
  double v2; // st7
  double v4; // st6
  double v5; // st5
  float v6; // [esp+0h] [ebp-10h] BYREF
  float v7; // [esp+4h] [ebp-Ch]
  float v8; // [esp+8h] [ebp-8h]
  float v9; // [esp+Ch] [ebp-4h]
  float v10; // [esp+1Ch] [ebp+Ch]

  j_FUN_00455281(&v6, a2);
  v2 = v6 * -2.0;
  v4 = v7 * -2.0;
  v5 = v8 * -2.0;
  v10 = v5;
  *a1 = v6 * v2 + 1.0;
  a1[1] = v4 * v6;
  a1[2] = v5 * v6;
  a1[3] = 0.0;
  a1[4] = v7 * v2;
  a1[5] = v7 * v4 + 1.0;
  a1[6] = v5 * v7;
  a1[7] = 0.0;
  a1[8] = v8 * v2;
  a1[9] = v8 * v4;
  a1[10] = v8 * v5 + 1.0;
  a1[11] = 0.0;
  a1[12] = v9 * v2;
  a1[13] = v9 * v4;
  a1[14] = v9 * v10;
  a1[15] = 1.0;
  return a1;
}

// sub_45610C @ 0x0045610C
int __stdcall sub_45610C(float *a1, float *a2, float *a3, float *a4, float *a5, float *a6, float *a7)
{
  unsigned __int8 v8; // c0
  unsigned __int8 v9; // c3
  unsigned __int8 v11; // c0
  unsigned __int8 v12; // c3
  unsigned __int8 v14; // c0
  unsigned __int8 v15; // c3
  int result; // eax
  _BYTE v17[16]; // [esp+8h] [ebp-44h] BYREF
  float v18; // [esp+18h] [ebp-34h]
  float v19; // [esp+1Ch] [ebp-30h]
  float v20; // [esp+20h] [ebp-2Ch]
  float v21; // [esp+24h] [ebp-28h]
  float v22; // [esp+28h] [ebp-24h] BYREF
  float v23; // [esp+2Ch] [ebp-20h]
  float v24; // [esp+30h] [ebp-1Ch]
  float v25; // [esp+34h] [ebp-18h]
  float v26; // [esp+38h] [ebp-14h] BYREF
  float v27; // [esp+3Ch] [ebp-10h]
  float v28; // [esp+40h] [ebp-Ch]
  float v29; // [esp+44h] [ebp-8h]
  float v30; // [esp+48h] [ebp-4h]
  float v31; // [esp+4Ch] [ebp+0h]
  float v32; // [esp+50h] [ebp+4h]
  float v33; // [esp+54h] [ebp+8h]
  float v34; // [esp+58h] [ebp+Ch] BYREF
  float v35; // [esp+5Ch] [ebp+10h]
  float v36; // [esp+60h] [ebp+14h]
  float v37; // [esp+64h] [ebp+18h]
  float v38; // [esp+68h] [ebp+1Ch] BYREF
  float v39; // [esp+6Ch] [ebp+20h]
  float v40; // [esp+70h] [ebp+24h]
  float v41; // [esp+74h] [ebp+28h]
  float v42; // [esp+78h] [ebp+2Ch] BYREF
  float v43; // [esp+7Ch] [ebp+30h]
  float v44; // [esp+80h] [ebp+34h]
  float v45; // [esp+84h] [ebp+38h]
  float v46; // [esp+88h] [ebp+3Ch] BYREF
  float v47; // [esp+8Ch] [ebp+40h]
  float v48; // [esp+90h] [ebp+44h]
  float v49; // [esp+94h] [ebp+48h]
  float v50; // [esp+98h] [ebp+4Ch]
  float v51; // [esp+9Ch] [ebp+50h]
  float v52; // [esp+A0h] [ebp+54h]
  float v53; // [esp+A4h] [ebp+58h]

  v22 = *a4;
  v23 = a4[1];
  v24 = a4[2];
  v25 = a4[3];
  v34 = *a5;
  v35 = a5[1];
  v36 = a5[2];
  v37 = a5[3];
  v46 = *a6;
  v47 = a6[1];
  v48 = a6[2];
  v51 = v23 - v35;
  v49 = a6[3];
  v52 = v24 - v36;
  v26 = *a7;
  v27 = a7[1];
  v53 = v25 - v37;
  v28 = a7[2];
  v29 = a7[3];
  if ( !(v8 | v9) )
  {
    v42 = -v22;
    v43 = -v23;
    v44 = -v24;
    v45 = -v25;
    v22 = v42;
    v23 = v43;
    v24 = v44;
    v25 = v45;
  }
  v51 = v35 - v47;
  v52 = v36 - v48;
  v53 = v37 - v49;
  if ( !(v11 | v12) )
  {
    v42 = -v46;
    v43 = -v47;
    v44 = -v48;
    v45 = -v49;
    v46 = v42;
    v47 = v43;
    v48 = v44;
    v49 = v45;
  }
  v51 = v47 - v27;
  v52 = v48 - v28;
  v53 = v49 - v29;
  if ( !(v14 | v15) )
  {
    v42 = -v26;
    v43 = -v27;
    v44 = -v28;
    v45 = -v29;
    v26 = v42;
    v27 = v43;
    v28 = v44;
    v29 = v45;
  }
  j_FUN_00454e3c(&v42, &v34);
  j_FUN_00454ccd(&v38, &v42, &v22);
  v30 = v38;
  v31 = v39;
  v32 = v40;
  v33 = v41;
  FUN_00454f03();
  j_FUN_00454ccd(&v38, &v42, &v46);
  v30 = v38;
  v31 = v39;
  v32 = v40;
  v33 = v41;
  FUN_00454f03();
  v39 = v19 + v51;
  v40 = v20 + v52;
  v30 = (v18 + v50) * -0.25;
  v31 = v39 * -0.25;
  v32 = v40 * -0.25;
  v33 = (v21 + v53) * -0.25;
  FUN_00454f87();
  j_FUN_00454ccd(&v38, &v34, v17);
  *a1 = v38;
  a1[1] = v39;
  a1[2] = v40;
  a1[3] = v41;
  j_FUN_00454e3c(&v42, &v46);
  j_FUN_00454ccd(&v38, &v42, &v34);
  v30 = v38;
  v31 = v39;
  v32 = v40;
  v33 = v41;
  FUN_00454f03();
  j_FUN_00454ccd(&v38, &v42, &v26);
  v30 = v38;
  v31 = v39;
  v32 = v40;
  v33 = v41;
  FUN_00454f03();
  v39 = v19 + v51;
  v40 = v20 + v52;
  v30 = (v18 + v50) * -0.25;
  v31 = v39 * -0.25;
  v32 = v40 * -0.25;
  v33 = (v21 + v53) * -0.25;
  FUN_00454f87();
  result = j_FUN_00454ccd(&v38, &v46, v17);
  *a2 = v38;
  a2[1] = v39;
  a2[2] = v40;
  a2[3] = v41;
  *a3 = v46;
  a3[1] = v47;
  a3[2] = v48;
  a3[3] = v49;
  return result;
}

// sub_4564E6 @ 0x004564E6
BOOL __cdecl sub_4564E6(int a1, LPCSTR lpValueName, LPBYTE lpData, DWORD cbData)
{
  LSTATUS v4; // esi
  BOOL result; // eax
  DWORD Type; // [esp+0h] [ebp-8h] BYREF
  HKEY phkResult; // [esp+4h] [ebp-4h] BYREF

  phkResult = 0;
  result = 0;
  if ( !RegOpenKeyA(HKEY_LOCAL_MACHINE, "Software\\Microsoft\\Direct3D", &phkResult) )
  {
    v4 = RegQueryValueExA(phkResult, lpValueName, 0, &Type, lpData, &cbData);
    RegCloseKey(phkResult);
    if ( !v4 && Type == a1 )
      return 1;
  }
  return result;
}

// sub_456542 @ 0x00456542
BOOL sub_456542()
{
  int v11; // [esp+Ch] [ebp-4h]

  v11 = 0;
  _EAX = 0x80000000;
  __asm { cpuid }
  if ( _EAX >= 0x80000001 )
  {
    _EAX = -2147483647;
    __asm { cpuid }
    return _EDX < 0;
  }
  return v11;
}

// sub_45657A @ 0x0045657A
int sub_45657A()
{
  _DWORD v11[7]; // [esp-Ch] [ebp-48h] BYREF
  int v12; // [esp+10h] [ebp-2Ch]
  int v13; // [esp+14h] [ebp-28h]
  char v14[16]; // [esp+18h] [ebp-24h] BYREF
  int v15; // [esp+28h] [ebp-14h]
  _DWORD *v16; // [esp+2Ch] [ebp-10h]
  int v17; // [esp+38h] [ebp-4h]

  v16 = v11;
  v15 = 0;
  strcpy(v14, "GenuineIntel");
  _EAX = 0;
  __asm { cpuid }
  v12 = _EAX;
  v11[4] = _EBX;
  v11[5] = _EDX;
  v11[6] = _ECX;
  v17 = -1;
  if ( !_EAX )
    return v15;
  _EAX = 1;
  __asm { cpuid }
  v12 = _EAX;
  v13 = _EDX;
  if ( (_EDX & 0x2000000) != 0 )
    v15 |= 4u;
  if ( (v13 & 0x4000000) != 0 )
    return v15 | 8;
  return v15;
}

// sub_45661F @ 0x0045661F
int __cdecl sub_45661F(DWORD ProcessorFeature)
{
  char v1; // bl
  struct _OSVERSIONINFOA VersionInformation; // [esp+8h] [ebp-24h] BYREF
  char v4; // [esp+9Fh] [ebp+73h]

  memset(&VersionInformation, 0, sizeof(VersionInformation));
  v1 = 0;
  v4 = 0;
  VersionInformation.dwOSVersionInfoSize = 148;
  if ( !GetVersionExA(&VersionInformation) )
  {
    v1 = 1;
    v4 = 1;
  }
  if ( VersionInformation.dwPlatformId == 1 )
  {
    if ( VersionInformation.dwMajorVersion <= 4
      && (VersionInformation.dwMajorVersion != 4
       || VersionInformation.dwMinorVersion < 0xA
       || LOWORD(VersionInformation.dwBuildNumber) < 0x55Du) )
    {
      v4 = 1;
    }
    goto LABEL_11;
  }
  if ( VersionInformation.dwPlatformId != 2 )
    return 0;
  if ( v1 )
  {
LABEL_11:
    if ( ProcessorFeature != 6 )
    {
      if ( ProcessorFeature == 7 )
        return sub_456542();
      if ( ProcessorFeature != 10 || v4 )
        return 0;
      return sub_45657A() & 8;
    }
    if ( !v4 )
      return sub_45657A() & 4;
    return 0;
  }
  if ( ProcessorFeature != 10 )
    return IsProcessorFeaturePresent(ProcessorFeature);
  return sub_45657A() & 8;
}

// renderer_select_backend @ 0x004566D3
// selects renderer table based on config
int renderer_select_backend(int reset)
{
  if ( reset )
  {
    if ( dword_479770 == 0xFFFF )
    {
      dword_479770 = 0;
      qmemcpy(&off_4795A0, &off_479688, 0xE4u);
      sub_457127((float *(__stdcall **)(float *, float *, float *))&off_4795A0);
      if ( !sub_4564E6(4, "DisableD3DXPSGP", (LPBYTE)&reset, 4u) )
        reset = 0;
      if ( reset != 1 )
      {
        if ( sub_45661F(7u) )
        {
          sub_456AA5((__m64 *(__stdcall **)(__m64 *, __m64 *, __m64 *))&off_4795A0);
          dword_479770 = 1;
        }
        else if ( sub_45661F(0xAu) )
        {
          sub_4568C0((__m128 *(__stdcall **)(__m128 *, unsigned int *, __m128 *))&off_4795A0);
          dword_479770 = 2;
        }
        else if ( sub_45661F(6u) )
        {
          sub_4567B0((__m128 *(__stdcall **)(__m128 *, unsigned int *, __m128 *))&off_4795A0);
          dword_479770 = 3;
        }
      }
    }
  }
  else
  {
    dword_479770 = 0xFFFF;
    qmemcpy(&off_4795A0, &off_479688, 0xE4u);
  }
  return dword_479770;
}

// sub_4567B0 @ 0x004567B0
__m128 *(__stdcall **__cdecl sub_4567B0(
        __m128 *(__stdcall **a1)(__m128 *, unsigned int *, __m128 *)))(__m128 *, unsigned int *, __m128 *)
{
  a1[28] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457E90;
  *a1 = sub_457170;
  a1[13] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457C10;
  a1[27] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457D00;
  a1[11] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458E20;
  a1[48] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457AF0;
  a1[47] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457710;
  a1[17] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4579B0;
  a1[54] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457AA0;
  a1[53] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4577A0;
  a1[52] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457910;
  a1[51] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457A40;
  a1[50] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457650;
  a1[49] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457850;
  a1[18] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458840;
  a1[22] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457B50;
  a1[25] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458230;
  a1[24] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458110;
  a1[19] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457F70;
  a1[44] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4580A0;
  a1[20] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458000;
  a1[16] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457500;
  a1[21] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457420;
  a1[8] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4575B0;
  a1[7] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457350;
  a1[10] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457250;
  a1[9] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4571B0;
  a1[6] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458300;
  a1[5] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457210;
  a1[4] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458B00;
  a1[3] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458540;
  a1[2] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458480;
  a1[1] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4583C0;
  return a1;
}

// sub_4568C0 @ 0x004568C0
__m128 *(__stdcall **__cdecl sub_4568C0(
        __m128 *(__stdcall **a1)(__m128 *, unsigned int *, __m128 *)))(__m128 *, unsigned int *, __m128 *)
{
  a1[28] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_459170;
  *a1 = sub_457170;
  a1[13] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458EF0;
  a1[27] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458FE0;
  a1[11] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458E20;
  a1[48] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457AF0;
  a1[47] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457710;
  a1[17] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4579B0;
  a1[54] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457AA0;
  a1[53] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4577A0;
  a1[52] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457910;
  a1[51] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457A40;
  a1[50] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457650;
  a1[49] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457850;
  a1[18] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458840;
  a1[22] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457B50;
  a1[25] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_459370;
  a1[24] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_459250;
  a1[31] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458D90;
  a1[30] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458D10;
  a1[19] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457F70;
  a1[20] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458000;
  a1[16] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458C60;
  a1[21] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458760;
  a1[8] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4575B0;
  a1[7] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458690;
  a1[10] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457250;
  a1[9] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4571B0;
  a1[6] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458300;
  a1[5] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_457210;
  a1[4] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458B00;
  a1[3] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458540;
  a1[2] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_458480;
  a1[1] = (__m128 *(__stdcall *)(__m128 *, unsigned int *, __m128 *))sub_4583C0;
  return a1;
}

// FUN_004569d0 @ 0x004569D0
// [binja] int32_t sub_4569d0()
int FUN_004569d0()
{
  char v26[16]; // [esp+Ch] [ebp-28h] BYREF
  _DWORD v27[5]; // [esp+1Ch] [ebp-18h] BYREF
  int v28; // [esp+30h] [ebp-4h]

  strcpy((char *)v27, "UnknownVendr");
  strcpy(v26, "AuthenticAMD");
  _EAX = 0;
  __asm { cpuid }
  v28 = 1;
  _EAX = 0;
  __asm { cpuid }
  v27[0] = _EBX;
  v27[1] = _EDX;
  v27[2] = _ECX;
  if ( _EAX )
  {
    _EAX = 1;
    __asm { cpuid }
    v27[4] = _EAX;
    v28 |= ((_EDX & 0x800000) != 0 ? 0x20 : 0) | 2;
    _EAX = 0x80000000;
    __asm { cpuid }
    if ( _EAX > 0x80000000 )
    {
      v28 |= 4u;
      _EAX = -2147483647;
      __asm { cpuid }
      v28 |= _EDX < 0 ? 0x80 : 0;
      if ( !memcmp(v26, v27, 0xCu) )
      {
        v28 |= (_EDX & 0x40000000) != 0 ? 0x100 : 0;
        return ((_EDX & 0x400000) != 0 ? 0x200 : 0) | v28;
      }
    }
  }
  return v28;
}

// sub_456AA5 @ 0x00456AA5
int __cdecl sub_456AA5(__m64 *(__stdcall **a1)(__m64 *, __m64 *, __m64 *))
{
  int result; // eax

  result = FUN_004569d0();
  if ( (result & 0x20) != 0 && (result & 0x80u) != 0 )
  {
    *a1 = sub_45F218;
    a1[1] = sub_45E75A;
    a1[2] = sub_45F4D9;
    a1[3] = sub_45A9AA;
    a1[5] = sub_45F26D;
    a1[6] = sub_45E7CB;
    a1[7] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45E832;
    a1[8] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F55B;
    a1[9] = sub_45F2A6;
    a1[10] = j_vec3_transform_coord;
    a1[11] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45ABDC;
    a1[12] = sub_45F903;
    a1[13] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F946;
    a1[14] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))vec3_project;
    a1[15] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))vec3_unproject;
    a1[16] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F5BA;
    a1[17] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F30A;
    a1[18] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45E73E;
    a1[19] = sub_459440;
    a1[20] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_4594D9;
    a1[21] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45FAE8;
    a1[22] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45FA2A;
    a1[23] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459536;
    a1[24] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_4595E9;
    a1[25] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459A1A;
    a1[26] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45ACAB;
    a1[27] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45ACFB;
    a1[28] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45ADE6;
    a1[29] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459ADF;
    a1[30] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45AEC2;
    a1[31] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45AF25;
    a1[32] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45AF83;
    a1[33] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45AFDC;
    a1[34] = sub_45FB4C;
    a1[35] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459B4B;
    a1[36] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459C82;
    a1[37] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45B023;
    a1[38] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45B0CB;
    a1[39] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45B252;
    a1[40] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45C3EA;
    a1[41] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45C58F;
    a1[42] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45CAC3;
    a1[43] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459D0F;
    a1[44] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459DA1;
    a1[54] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F6EC;
    a1[51] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45E891;
    a1[48] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F3A2;
    a1[46] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F3EB;
    a1[52] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F75D;
    a1[49] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45E902;
    a1[55] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459E05;
    a1[56] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459EAC;
    a1[53] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F825;
    a1[47] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F42E;
    a1[50] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45E9D6;
    a1[4] = sub_45E012;
    a1[45] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459F51;
    if ( (result & 0x100) != 0 && (result & 0x200) != 0 )
    {
      a1[15] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45F0C5;
      a1[18] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45DD30;
      a1[38] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45B19D;
      a1[39] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_45CBDC;
      a1[24] = (__m64 *(__stdcall *)(__m64 *, __m64 *, __m64 *))sub_459805;
    }
  }
  return result;
}

// sub_456CCB @ 0x00456CCB
float *__stdcall sub_456CCB(float *a1, float *a2, float *a3)
{
  double v3; // st5
  double v4; // st6
  double v5; // st7

  v3 = *a2 * a3[1] + a2[1] * a3[5] + a3[13];
  v4 = *a2 * a3[2] + a2[1] * a3[6] + a3[14];
  v5 = *a2 * a3[3] + a2[1] * a3[7] + a3[15];
  *a1 = *a2 * *a3 + a2[1] * a3[4] + a3[12];
  a1[1] = v3;
  a1[2] = v4;
  a1[3] = v5;
  return a1;
}

// sub_456D34 @ 0x00456D34
float *__stdcall sub_456D34(float *a1, float *a2, float *a3)
{
  double v3; // st7

  v3 = *a2 * a3[1] + a2[1] * a3[5];
  *a1 = *a2 * *a3 + a2[1] * a3[4];
  a1[1] = v3;
  return a1;
}

// sub_456D69 @ 0x00456D69
float *__stdcall sub_456D69(float *a1, float *a2, float *a3)
{
  double v3; // st5
  double v4; // st6
  double v5; // st7

  v3 = *a2 * a3[1] + a2[1] * a3[5] + a2[2] * a3[9] + a3[13];
  v4 = *a2 * a3[2] + a2[1] * a3[6] + a2[2] * a3[10] + a3[14];
  v5 = *a2 * a3[3] + a2[1] * a3[7] + a2[2] * a3[11] + a3[15];
  *a1 = *a2 * *a3 + a2[1] * a3[4] + a2[2] * a3[8] + a3[12];
  a1[1] = v3;
  a1[2] = v4;
  a1[3] = v5;
  return a1;
}

// sub_456DF4 @ 0x00456DF4
float *__stdcall sub_456DF4(float *a1, float *a2, float *a3)
{
  double v3; // st6
  double v4; // st7

  v3 = *a2 * a3[1] + a2[1] * a3[5] + a2[2] * a3[9];
  v4 = *a2 * a3[2] + a2[1] * a3[6] + a2[2] * a3[10];
  *a1 = *a2 * *a3 + a2[1] * a3[4] + a2[2] * a3[8];
  a1[1] = v3;
  a1[2] = v4;
  return a1;
}

// sub_456E53 @ 0x00456E53
float *__stdcall sub_456E53(float *a1, float *a2, float *a3)
{
  double v3; // st5
  double v4; // st6
  double v5; // st7

  v3 = *a2 * a3[1] + a2[1] * a3[5] + a2[2] * a3[9] + a2[3] * a3[13];
  v4 = *a2 * a3[2] + a2[1] * a3[6] + a2[2] * a3[10] + a2[3] * a3[14];
  v5 = *a2 * a3[3] + a2[1] * a3[7] + a2[2] * a3[11] + a2[3] * a3[15];
  *a1 = *a2 * *a3 + a2[1] * a3[4] + a2[2] * a3[8] + a2[3] * a3[12];
  a1[1] = v3;
  a1[2] = v4;
  a1[3] = v5;
  return a1;
}

// FUN_00456eec @ 0x00456EEC
// [binja] float* __stdcall sub_456eec(float* arg1, float* arg2)
float *FUN_00456eec(float *arg1, float *arg2)
{
  float v8; // [esp+4h] [ebp-8h]
  float v9; // [esp+8h] [ebp-4h]
  int v10; // [esp+8h] [ebp-4h]
  unsigned int v11; // [esp+8h] [ebp-4h]

  _EDX = arg2;
  __asm
  {
    fld     dword ptr [edx]
    fmul    dword ptr [edx]
    fld     dword ptr [edx+4]
    fmul    dword ptr [edx+4]
    fld     dword ptr [edx+8]
    fmul    dword ptr [edx+8]
    fxch    st(2)
    faddp   st(1), st
    faddp   st(1), st
    fst     [ebp+var_8]
  }
  if ( v8 == 0.0 )
  {
    __asm { ffree   st }
    *(_DWORD *)arg1 = LOBYTE(v8);
    *((_DWORD *)arg1 + 1) = LOBYTE(v8);
    *((_DWORD *)arg1 + 2) = LOBYTE(v8);
  }
  else
  {
    __asm
    {
      fld1
      fsubp   st(1), st
      fstp    [ebp+var_4]
    }
    if ( (LODWORD(v9) & 0x7FFFFFFFu) > 0x3727C5AC )
    {
      _EDI = (LODWORD(v8) >> 12) & 0xFF8;
      v10 = LODWORD(v8) & 0xFFFFFF | 0x3F000000;
      __asm
      {
        fld     [ebp+var_4]
        fmul    dword ptr [edi+479780h]
      }
      __asm { fadd    dword ptr [edi+479784h] }
      v11 = ((unsigned int)(-1090519041 - LODWORD(v8)) >> 1) & 0xFF800000;
      __asm
      {
        fmul    [ebp+var_4]
        fld     dword ptr [edx]
        fmul    st, st(1)
        fld     dword ptr [edx+4]
        fmul    st, st(2)
        fld     dword ptr [edx+8]
        fmul    st, st(3)
        fxch    st(2)
        fstp    dword ptr [ecx]
      }
      *arg1 = _ET1;
      __asm { fstp    dword ptr [ecx+4] }
      arg1[1] = _ET1;
      __asm { fstp    dword ptr [ecx+8] }
      arg1[2] = _ET1;
      __asm { fstp    st }
    }
    else if ( arg1 != arg2 )
    {
      *arg1 = *arg2;
      arg1[1] = arg2[1];
      arg1[2] = arg2[2];
    }
  }
  return arg1;
}

// FUN_00456fb6 @ 0x00456FB6
// [binja] int32_t __stdcall sub_456fb6(int32_t arg1, int32_t arg2, void* arg3)
int FUN_00456fb6(int arg1, int arg2, void *arg3)
{
  int result; // eax
  int v4; // ebx
  int v10; // ebx
  int v13; // edi
  _BYTE v16[64]; // [esp+Ch] [ebp-40h] BYREF

  result = arg1;
  if ( arg3 == (void *)arg1 )
  {
    if ( arg2 != arg1 )
    {
      v4 = arg1;
      _ECX = arg2;
      _EDX = arg3;
      _EDI = -4;
      do
      {
        _ESI = -16;
        __asm
        {
          fld     dword ptr [edx+edi*4+10h]
          fld     dword ptr [edx+edi*4+20h]
          fld     dword ptr [edx+edi*4+30h]
          fld     dword ptr [edx+edi*4+40h]
        }
        do
        {
          __asm
          {
            fld     st(3)
            fmul    dword ptr [ecx+esi*4+40h]
            fld     st(3)
            fmul    dword ptr [ecx+esi*4+44h]
            fld     st(3)
            fmul    dword ptr [ecx+esi*4+48h]
            fld     st(3)
            fmul    dword ptr [ecx+esi*4+4Ch]
            fxch    st(3)
            faddp   st(1), st
            fxch    st(2)
            faddp   st(1), st
            faddp   st(1), st
            fstp    dword ptr [ebx+esi*4+40h]
          }
          *(float *)(v4 + 4 * _ESI + 64) = _ET1;
          _ESI += 4;
        }
        while ( _ESI );
        __asm
        {
          ffree   st(3)
          ffree   st(2)
          ffree   st(1)
          ffree   st
        }
        v4 += 4;
        ++_EDI;
      }
      while ( _EDI );
      return result;
    }
    qmemcpy(v16, arg3, sizeof(v16));
    arg3 = v16;
  }
  v10 = arg1;
  _ECX = arg2;
  _EDX = arg3;
  v13 = -4;
  do
  {
    _ESI = -4;
    __asm
    {
      fld     dword ptr [ecx]
      fld     dword ptr [ecx+4]
      fld     dword ptr [ecx+8]
      fld     dword ptr [ecx+0Ch]
    }
    do
    {
      __asm
      {
        fld     st(3)
        fmul    dword ptr [edx+esi*4+10h]
        fld     st(3)
        fmul    dword ptr [edx+esi*4+20h]
        fld     st(3)
        fmul    dword ptr [edx+esi*4+30h]
        fld     st(3)
        fmul    dword ptr [edx+esi*4+40h]
        fxch    st(3)
        faddp   st(1), st
        fxch    st(2)
        faddp   st(1), st
        faddp   st(1), st
        fstp    dword ptr [ebx+esi*4+10h]
      }
      *(float *)(v10 + 4 * _ESI++ + 16) = _ET1;
    }
    while ( _ESI );
    __asm
    {
      ffree   st(3)
      ffree   st(2)
      ffree   st(1)
      ffree   st
    }
    _ECX += 16;
    v10 += 16;
    ++v13;
  }
  while ( v13 );
  return result;
}

// FUN_00457099 @ 0x00457099
// [binja] void* __stdcall sub_457099(void* arg1, int32_t arg2, int32_t arg3)
void *FUN_00457099(void *arg1, int arg2, int arg3)
{
  char *v3; // eax
  int v6; // edi
  float *v8; // ebx
  void *result; // eax
  char v11; // [esp+0h] [ebp-44h] BYREF
  char *v12; // [esp+40h] [ebp-4h]

  v3 = (char *)arg1;
  if ( arg1 == (void *)arg2 || arg1 == (void *)arg3 )
    v3 = &v11;
  v12 = v3;
  _ECX = arg2;
  _EDX = arg3;
  v6 = -4;
  do
  {
    _ESI = -4;
    v8 = (float *)&v3[4 * v6 + 16];
    __asm
    {
      fld     dword ptr [ecx]
      fld     dword ptr [ecx+4]
      fld     dword ptr [ecx+8]
      fld     dword ptr [ecx+0Ch]
    }
    do
    {
      __asm
      {
        fld     st(3)
        fmul    dword ptr [edx+esi*4+10h]
        fld     st(3)
        fmul    dword ptr [edx+esi*4+20h]
        fld     st(3)
        fmul    dword ptr [edx+esi*4+30h]
        fld     st(3)
        fmul    dword ptr [edx+esi*4+40h]
        fxch    st(3)
        faddp   st(1), st
        fxch    st(2)
        faddp   st(1), st
        faddp   st(1), st
        fstp    dword ptr [ebx]
      }
      *v8 = _ET1;
      v8 += 4;
      ++_ESI;
    }
    while ( _ESI );
    __asm
    {
      ffree   st(3)
      ffree   st(2)
      ffree   st(1)
      ffree   st
    }
    _ECX += 16;
    ++v6;
  }
  while ( v6 );
  result = arg1;
  if ( v12 != arg1 )
    qmemcpy(arg1, v12, 0x40u);
  return result;
}

// sub_457127 @ 0x00457127
float *(__stdcall **__cdecl sub_457127(
        float *(__stdcall **a1)(float *a1, float *a2, float *a3)))(float *a1, float *a2, float *a3)
{
  *a1 = sub_456CCB;
  a1[1] = sub_456D69;
  a1[2] = sub_456E53;
  a1[3] = (float *(__stdcall *)(float *, float *, float *))FUN_00456fb6;
  a1[4] = (float *(__stdcall *)(float *, float *, float *))FUN_00457099;
  a1[5] = sub_456D34;
  a1[6] = sub_456DF4;
  a1[7] = (float *(__stdcall *)(float *, float *, float *))FUN_00456eec;
  return a1;
}

// sub_457170 @ 0x00457170
__m128 *__stdcall sub_457170(__m128 *a1, unsigned int *a2, __m128 *a3)
{
  *a1 = _mm_add_ps(
          _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps((__m128)*a2, (__m128)*a2, 0), *a3), a3[3]),
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[1], (__m128)a2[1], 0), a3[1]));
  return a1;
}

// sub_4571B0 @ 0x004571B0
double *__stdcall sub_4571B0(double *a1, unsigned int *a2, __m128 *a3)
{
  __m128 v3; // xmm2
  __m128 v4; // xmm0
  __m128 v5; // xmm1

  v3 = _mm_add_ps(
         _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps((__m128)*a2, (__m128)*a2, 0), *a3), a3[3]),
         _mm_mul_ps(_mm_shuffle_ps((__m128)a2[1], (__m128)a2[1], 0), a3[1]));
  v4 = _mm_rcp_ps(v3);
  v5 = _mm_mul_ps(_mm_mul_ps(v4, v4), v3);
  _mm_storel_ps(a1, _mm_mul_ps(v3, _mm_shuffle_ps(v5, v5, 255)));
  return a1;
}

// sub_457210 @ 0x00457210
double *__stdcall sub_457210(double *a1, unsigned int *a2, __m128 *a3)
{
  _mm_storel_ps(
    a1,
    _mm_add_ps(
      _mm_mul_ps(_mm_shuffle_ps((__m128)*a2, (__m128)*a2, 0), *a3),
      _mm_mul_ps(_mm_shuffle_ps((__m128)a2[1], (__m128)a2[1], 0), a3[1])));
  return a1;
}

// sub_457250 @ 0x00457250
void __stdcall sub_457250(int a1, int a2, int a3)
{
  JUMPOUT(0x457261);
}

// sub_45725E @ 0x0045725E
int __stdcall sub_45725E(int a1, int a2, int a3)
{
  __m128 v3; // xmm2
  __m128 v4; // xmm0
  __m128 v5; // xmm2
  __m128 v6; // xmm2
  __m128 v7; // xmm0
  __m128 v9; // xmm6
  __m128 v10; // xmm4
  __m128 v11; // xmm1
  __m128 v12; // xmm1
  __m128 v13; // xmm4

  if ( (a3 & 0xF) != 0 )
  {
    v9 = _mm_loadl_ps((const double *)a2);
    v10 = _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 8)), _mm_shuffle_ps(v9, v9, 0)),
              _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 24)), _mm_shuffle_ps(v9, v9, 85))),
            _mm_add_ps(
              _mm_mul_ps(
                _mm_loadh_ps((const double *)(a3 + 40)),
                _mm_shuffle_ps((__m128)*(unsigned int *)(a2 + 8), (__m128)*(unsigned int *)(a2 + 8), 0)),
              _mm_loadh_ps((const double *)(a3 + 56))));
    v11 = _mm_rcp_ps(v10);
    v12 = _mm_sub_ps(_mm_add_ps(v11, v11), _mm_mul_ps(_mm_mul_ps(v11, v10), v11));
    v13 = _mm_mul_ps(v10, _mm_shuffle_ps(v12, v12, 255));
    _mm_storel_ps((double *)a1, v13);
    *(_DWORD *)(a1 + 8) = _mm_movehl_ps(v13, v13).m128_u32[0];
  }
  else
  {
    v3 = _mm_loadl_ps((const double *)a2);
    v4 = _mm_add_ps(
           _mm_add_ps(
             _mm_mul_ps(_mm_shuffle_ps(v3, v3, 0), *(__m128 *)a3),
             _mm_mul_ps(_mm_shuffle_ps(v3, v3, 85), *(__m128 *)(a3 + 16))),
           _mm_add_ps(
             _mm_mul_ps(
               _mm_shuffle_ps((__m128)*(unsigned int *)(a2 + 8), (__m128)*(unsigned int *)(a2 + 8), 0),
               *(__m128 *)(a3 + 32)),
             *(__m128 *)(a3 + 48)));
    v5 = _mm_rcp_ps(v4);
    v6 = _mm_sub_ps(_mm_add_ps(v5, v5), _mm_mul_ps(_mm_mul_ps(v5, v4), v5));
    v7 = _mm_mul_ps(v4, _mm_shuffle_ps(v6, v6, 255));
    _mm_storel_ps((double *)a1, v7);
    *(_DWORD *)(a1 + 8) = _mm_movehl_ps(v7, v7).m128_u32[0];
  }
  return a1;
}

// sub_457350 @ 0x00457350
void __stdcall sub_457350(int a1, int a2)
{
  JUMPOUT(0x457361);
}

// sub_45735E @ 0x0045735E
float *__stdcall sub_45735E(float *a1, float *a2)
{
  float *result; // eax
  float v3; // xmm6_4
  float v4; // xmm5_4
  float v5; // xmm3_4
  float v6; // xmm3_4
  float v7; // xmm0_4

  result = a1;
  v3 = a2[1];
  v4 = a2[2];
  v5 = (float)((float)(*a2 * *a2) + (float)(v3 * v3)) + (float)(v4 * v4);
  if ( *(float *)&dword_4DC000 <= v5 )
  {
    v6 = 1.0 / fsqrt(v5);
    v7 = (float)(*(float *)&dword_4DC004 * v6)
       * (float)(*(float *)&dword_4DC008
               - (float)((float)((float)((float)((float)(*a2 * *a2) + (float)(a2[1] * a2[1])) + (float)(a2[2] * a2[2]))
                               * v6)
                       * v6));
    *a1 = v7 * *a2;
    a1[1] = v7 * v3;
    a1[2] = v7 * v4;
  }
  else
  {
    *a1 = 0.0;
    a1[1] = 0.0;
    a1[2] = 0.0;
  }
  return result;
}

// sub_457420 @ 0x00457420
void __stdcall sub_457420(int a1, int a2)
{
  JUMPOUT(0x457431);
}

// sub_45742E @ 0x0045742E
float *__stdcall sub_45742E(float *a1, float *a2)
{
  float *result; // eax
  float v3; // xmm4_4
  float v4; // xmm6_4
  float v5; // xmm3_4
  float v6; // xmm3_4
  float v7; // xmm0_4

  result = a1;
  v3 = a2[1];
  v4 = a2[2];
  v5 = (float)((float)(*a2 * *a2) + (float)(v3 * v3)) + (float)(v4 * v4);
  if ( *(float *)&dword_4DC00C <= v5 )
  {
    v6 = 1.0 / fsqrt(v5);
    v7 = (float)(*(float *)&dword_4DC010 * v6)
       * (float)(*(float *)&dword_4DC014
               - (float)((float)((float)((float)((float)(*a2 * *a2) + (float)(a2[1] * a2[1])) + (float)(a2[2] * a2[2]))
                               * v6)
                       * v6));
    *a1 = v7 * *a2;
    a1[1] = v7 * v3;
    a1[2] = v7 * v4;
    a1[3] = v7 * a2[3];
  }
  else
  {
    *a1 = 0.0;
    a1[1] = 0.0;
    a1[2] = 0.0;
    a1[3] = 0.0;
  }
  return result;
}

// sub_457500 @ 0x00457500
void __stdcall sub_457500(int a1, int a2, int a3, int a4)
{
  JUMPOUT(0x457511);
}

// sub_45750E @ 0x0045750E
__m128 *__stdcall sub_45750E(__m128 *a1, int a2, int a3, int a4)
{
  __m128 v5; // xmm2
  __m128 v6; // xmm2
  __m128 v7; // xmm1
  __m128 v8; // xmm3
  __m128 v9; // xmm4
  __m128 v10; // xmm0
  __m128 v11; // xmm4
  __m128 v12; // xmm2
  __m128 v13; // xmm3
  __m128 v14; // xmm1

  v5 = _mm_loadh_ps((const double *)(a3 + 8));
  v6 = _mm_shuffle_ps(v5, v5, 57);
  v7 = _mm_loadh_ps((const double *)(a2 + 8));
  v8 = _mm_loadh_ps((const double *)(a4 + 8));
  v9 = _mm_shuffle_ps(v8, v8, 78);
  v10 = _mm_mul_ps(_mm_shuffle_ps(v9, v9, 57), v6);
  v11 = _mm_mul_ps(v9, v6);
  v12 = _mm_mul_ps(v6, v8);
  v13 = _mm_shuffle_ps(v7, v7, 57);
  v14 = _mm_shuffle_ps(v13, v13, 57);
  *a1 = _mm_xor_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(v13, _mm_sub_ps(_mm_shuffle_ps(v11, v11, 57), _mm_shuffle_ps(v12, v12, 78))),
              _mm_mul_ps(_mm_sub_ps(_mm_shuffle_ps(v10, v10, 78), v10), v14)),
            _mm_mul_ps(_mm_shuffle_ps(v14, v14, 57), _mm_sub_ps(v11, _mm_shuffle_ps(v12, v12, 57)))),
          (__m128)xmmword_47A7A0);
  return a1;
}

// sub_4575B0 @ 0x004575B0
float *__stdcall sub_4575B0(float *a1, float *a2)
{
  float v2; // xmm1_4
  float v3; // xmm2_4
  float v4; // xmm3_4
  float v5; // xmm4_4
  float v6; // xmm6_4
  float v7; // xmm5_4

  v2 = a2[1];
  v3 = a2[2];
  v4 = a2[3];
  v5 = (float)((float)(*a2 * *a2) + (float)(v2 * v2)) + (float)((float)(v3 * v3) + (float)(v4 * v4));
  v6 = 1.0 / fsqrt(v5);
  v7 = (float)((float)(*(float *)&dword_47A7C0 - (float)(v5 * (float)(v6 * v6))) * *(float *)&dword_47A7B0) * v6;
  *a1 = *a2 * v7;
  a1[1] = v2 * v7;
  a1[2] = v3 * v7;
  a1[3] = v4 * v7;
  return a1;
}

// sub_457650 @ 0x00457650
int __userpurge sub_457650@<eax>(
        __m128 a1@<xmm1>,
        __m128 a2@<xmm2>,
        int a3,
        const double *a4,
        const double *a5,
        const double *a6,
        const double *a7,
        float a8)
{
  __m128 v8; // xmm0
  __m128 v9; // xmm0
  __m128 v10; // xmm4

  v8 = (__m128)LODWORD(a8);
  a1.m128_f32[0] = v8.m128_f32[0] * v8.m128_f32[0];
  a2.m128_f32[0] = a8 * (float)(v8.m128_f32[0] * v8.m128_f32[0]);
  v9 = _mm_add_ps(
         _mm_add_ps(
           _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v8, v8, 0), (__m128)xmmword_47A800), (__m128)xmmword_47A7E0),
           _mm_mul_ps(_mm_shuffle_ps(a1, a1, 0), (__m128)xmmword_47A7F0)),
         _mm_mul_ps(_mm_shuffle_ps(a2, a2, 0), (__m128)xmmword_47A7D0));
  v10 = _mm_add_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_loadh_ps(a4), _mm_shuffle_ps(v9, v9, 0)),
              _mm_mul_ps(_mm_loadh_ps(a5), _mm_shuffle_ps(v9, v9, 85))),
            _mm_mul_ps(_mm_loadh_ps(a6), _mm_shuffle_ps(v9, v9, 170))),
          _mm_mul_ps(_mm_loadh_ps(a7), _mm_shuffle_ps(v9, v9, 255)));
  _mm_storeh_ps((double *)a3, v10);
  *(_DWORD *)(a3 + 8) = v10.m128_i32[0];
  return a3;
}

// sub_457710 @ 0x00457710
double *__userpurge sub_457710@<eax>(
        __m128 a1@<xmm1>,
        __m128 a2@<xmm2>,
        double *a3,
        int a4,
        const double *a5,
        int a6,
        const double *a7,
        float a8)
{
  __m128 v8; // xmm0
  __m128 v9; // xmm0
  __m128 v10; // xmm6
  __m128 v11; // xmm4

  v8 = (__m128)LODWORD(a8);
  a1.m128_f32[0] = v8.m128_f32[0] * v8.m128_f32[0];
  a2.m128_f32[0] = a8 * (float)(v8.m128_f32[0] * v8.m128_f32[0]);
  v9 = _mm_add_ps(
         _mm_add_ps(
           _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v8, v8, 0), (__m128)xmmword_47A800), (__m128)xmmword_47A7E0),
           _mm_mul_ps(_mm_shuffle_ps(a1, a1, 0), (__m128)xmmword_47A7F0)),
         _mm_mul_ps(_mm_shuffle_ps(a2, a2, 0), (__m128)xmmword_47A7D0));
  v10 = _mm_mul_ps(_mm_loadh_ps(a7), _mm_shuffle_ps(v9, v9, 250));
  v11 = _mm_add_ps(_mm_mul_ps(_mm_loadh_ps(a5), _mm_shuffle_ps(v9, v9, 80)), v10);
  _mm_storel_ps(a3, _mm_add_ps(v11, _mm_movehl_ps(v10, v11)));
  return a3;
}

// sub_4577A0 @ 0x004577A0
__m128 *__userpurge sub_4577A0@<eax>(
        __m128 a1@<xmm1>,
        __m128 a2@<xmm2>,
        __m128 *a3,
        __m128 *a4,
        __m128 *a5,
        __m128 *a6,
        __m128 *a7,
        float a8)
{
  __m128 v8; // xmm0
  __m128 v9; // xmm0

  v8 = (__m128)LODWORD(a8);
  a1.m128_f32[0] = v8.m128_f32[0] * v8.m128_f32[0];
  a2.m128_f32[0] = a8 * (float)(v8.m128_f32[0] * v8.m128_f32[0]);
  v9 = _mm_add_ps(
         _mm_add_ps(
           _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v8, v8, 0), (__m128)xmmword_47A800), (__m128)xmmword_47A7E0),
           _mm_mul_ps(_mm_shuffle_ps(a1, a1, 0), (__m128)xmmword_47A7F0)),
         _mm_mul_ps(_mm_shuffle_ps(a2, a2, 0), (__m128)xmmword_47A7D0));
  *a3 = _mm_add_ps(
          _mm_add_ps(
            _mm_add_ps(_mm_mul_ps(*a4, _mm_shuffle_ps(v9, v9, 0)), _mm_mul_ps(*a5, _mm_shuffle_ps(v9, v9, 85))),
            _mm_mul_ps(*a6, _mm_shuffle_ps(v9, v9, 170))),
          _mm_mul_ps(*a7, _mm_shuffle_ps(v9, v9, 255)));
  return a3;
}

// sub_457850 @ 0x00457850
int __userpurge sub_457850@<eax>(
        __m128 a1@<xmm1>,
        __m128 a2@<xmm2>,
        int a3,
        const double *a4,
        const double *a5,
        const double *a6,
        const double *a7,
        float a8)
{
  __m128 v8; // xmm0
  __m128 v9; // xmm0
  __m128 v10; // xmm0
  __m128 v11; // xmm4

  v8 = (__m128)LODWORD(a8);
  a1.m128_f32[0] = v8.m128_f32[0] * v8.m128_f32[0];
  a2.m128_f32[0] = a8 * (float)(v8.m128_f32[0] * v8.m128_f32[0]);
  v9 = _mm_mul_ps(_mm_shuffle_ps(v8, v8, 0), (__m128)xmmword_47A840);
  v9.m128_f32[0] = v9.m128_f32[0] + *(float *)&dword_47A820;
  v10 = _mm_add_ps(
          _mm_add_ps(v9, _mm_mul_ps(_mm_shuffle_ps(a1, a1, 0), (__m128)xmmword_47A830)),
          _mm_mul_ps(_mm_shuffle_ps(a2, a2, 0), (__m128)xmmword_47A810));
  v11 = _mm_add_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_loadh_ps(a4), _mm_shuffle_ps(v10, v10, 0)),
              _mm_mul_ps(_mm_loadh_ps(a5), _mm_shuffle_ps(v10, v10, 85))),
            _mm_mul_ps(_mm_loadh_ps(a6), _mm_shuffle_ps(v10, v10, 170))),
          _mm_mul_ps(_mm_loadh_ps(a7), _mm_shuffle_ps(v10, v10, 255)));
  _mm_storeh_ps((double *)a3, v11);
  *(_DWORD *)(a3 + 8) = v11.m128_i32[0];
  return a3;
}

// sub_457910 @ 0x00457910
__m128 *__userpurge sub_457910@<eax>(
        __m128 a1@<xmm1>,
        __m128 a2@<xmm2>,
        __m128 *a3,
        __m128 *a4,
        __m128 *a5,
        __m128 *a6,
        __m128 *a7,
        float a8)
{
  __m128 v8; // xmm0
  __m128 v9; // xmm0
  __m128 v10; // xmm0

  v8 = (__m128)LODWORD(a8);
  a1.m128_f32[0] = v8.m128_f32[0] * v8.m128_f32[0];
  a2.m128_f32[0] = a8 * (float)(v8.m128_f32[0] * v8.m128_f32[0]);
  v9 = _mm_mul_ps(_mm_shuffle_ps(v8, v8, 0), (__m128)xmmword_47A840);
  v9.m128_f32[0] = v9.m128_f32[0] + *(float *)&dword_47A820;
  v10 = _mm_add_ps(
          _mm_add_ps(v9, _mm_mul_ps(_mm_shuffle_ps(a1, a1, 0), (__m128)xmmword_47A830)),
          _mm_mul_ps(_mm_shuffle_ps(a2, a2, 0), (__m128)xmmword_47A810));
  *a3 = _mm_add_ps(
          _mm_add_ps(
            _mm_add_ps(_mm_mul_ps(*a4, _mm_shuffle_ps(v10, v10, 0)), _mm_mul_ps(*a5, _mm_shuffle_ps(v10, v10, 85))),
            _mm_mul_ps(*a6, _mm_shuffle_ps(v10, v10, 170))),
          _mm_mul_ps(*a7, _mm_shuffle_ps(v10, v10, 255)));
  return a3;
}

// sub_4579B0 @ 0x004579B0
double *__userpurge sub_4579B0@<eax>(
        __m128 a1@<xmm1>,
        __m128 a2@<xmm2>,
        __m128 a3@<xmm3>,
        double *a4,
        int a5,
        const double *a6,
        int a7,
        const double *a8,
        float a9)
{
  __m128 v9; // xmm0
  __m128 v10; // xmm0
  __m128 v11; // xmm0
  __m128 v12; // xmm4

  v9 = (__m128)LODWORD(a9);
  a1.m128_f32[0] = v9.m128_f32[0] * v9.m128_f32[0];
  a2.m128_f32[0] = a9 * (float)(v9.m128_f32[0] * v9.m128_f32[0]);
  v10 = _mm_mul_ps(_mm_shuffle_ps(v9, v9, 0), (__m128)xmmword_47A840);
  v10.m128_f32[0] = v10.m128_f32[0] + *(float *)&dword_47A820;
  v11 = _mm_add_ps(
          _mm_add_ps(v10, _mm_mul_ps(_mm_shuffle_ps(a1, a1, 0), (__m128)xmmword_47A830)),
          _mm_mul_ps(_mm_shuffle_ps(a2, a2, 0), (__m128)xmmword_47A810));
  v12 = _mm_add_ps(
          _mm_mul_ps(_mm_loadh_ps(a6), _mm_shuffle_ps(v11, v11, 80)),
          _mm_mul_ps(_mm_loadh_ps(a8), _mm_shuffle_ps(v11, v11, 250)));
  _mm_storel_ps(a4, _mm_add_ps(v12, _mm_movehl_ps(a3, v12)));
  return a4;
}

// sub_457A40 @ 0x00457A40
int __stdcall sub_457A40(
        int a1,
        const double *a2,
        const double *a3,
        const double *a4,
        unsigned int a5,
        unsigned int a6)
{
  __m128 v6; // xmm2
  __m128 v7; // xmm3

  v6 = _mm_loadh_ps(a2);
  v7 = _mm_add_ps(
         _mm_add_ps(_mm_mul_ps(_mm_sub_ps(_mm_loadh_ps(a3), v6), _mm_shuffle_ps((__m128)a5, (__m128)a5, 0)), v6),
         _mm_mul_ps(_mm_sub_ps(_mm_loadh_ps(a4), v6), _mm_shuffle_ps((__m128)a6, (__m128)a6, 0)));
  *(_DWORD *)(a1 + 8) = v7.m128_i32[0];
  _mm_storeh_ps((double *)a1, v7);
  return a1;
}

// sub_457AA0 @ 0x00457AA0
__m128 *__stdcall sub_457AA0(__m128 *a1, __m128 *a2, __m128 *a3, __m128 *a4, unsigned int a5, unsigned int a6)
{
  *a1 = _mm_add_ps(
          _mm_add_ps(_mm_mul_ps(_mm_sub_ps(*a3, *a2), _mm_shuffle_ps((__m128)a5, (__m128)a5, 0)), *a2),
          _mm_mul_ps(_mm_sub_ps(*a4, *a2), _mm_shuffle_ps((__m128)a6, (__m128)a6, 0)));
  return a1;
}

// sub_457AF0 @ 0x00457AF0
double *__stdcall sub_457AF0(
        double *a1,
        const double *a2,
        const double *a3,
        const double *a4,
        unsigned int a5,
        unsigned int a6)
{
  __m128 v6; // xmm2

  v6 = _mm_loadh_ps(a2);
  _mm_storeh_ps(
    a1,
    _mm_add_ps(
      _mm_add_ps(_mm_mul_ps(_mm_sub_ps(_mm_loadh_ps(a3), v6), _mm_shuffle_ps((__m128)a5, (__m128)a5, 0)), v6),
      _mm_mul_ps(_mm_sub_ps(_mm_loadh_ps(a4), v6), _mm_shuffle_ps((__m128)a6, (__m128)a6, 0))));
  return a1;
}

// sub_457B50 @ 0x00457B50
int __userpurge sub_457B50@<eax>(
        __m128 a1@<xmm5>,
        __m128 a2@<xmm6>,
        int a3,
        __m128 *a4,
        const double *a5,
        const double *a6)
{
  __m128 v6; // xmm1
  __m128 v7; // xmm4
  __m128 v8; // xmm0
  __m128 v9; // xmm2
  __m128 v10; // xmm3
  __m128 v11; // xmm0
  __m128 v12; // xmm5
  __m128 v13; // xmm6
  __m128 v14; // xmm0
  float v15; // xmm5_4
  __m128 v16; // xmm3
  __m128 v17; // xmm1
  int v19; // [esp+0h] [ebp-4h]

  v19 = a3;
  v6 = _mm_loadh_ps(a5);
  v7 = *a4;
  v8 = _mm_shuffle_ps(v7, v7, 78);
  v9 = _mm_loadh_ps(a6);
  v10 = _mm_mul_ps(v6, v8);
  v11 = _mm_mul_ps(v8, v9);
  v12 = _mm_movehl_ps(a1, v10);
  v13 = _mm_movehl_ps(a2, v11);
  v16 = _mm_add_ps(v10, v12);
  v14 = _mm_add_ps(v11, v13);
  v16.m128_f32[0] = v16.m128_f32[0] + _mm_shuffle_ps(v12, v16, 85).m128_f32[0];
  v15 = v16.m128_f32[0] - (float)(v14.m128_f32[0] + _mm_shuffle_ps(v13, v14, 85).m128_f32[0]);
  v16.m128_f32[0] = v16.m128_f32[0] + _mm_shuffle_ps(v7, v7, 255).m128_f32[0];
  if ( v15 == *(float *)&dword_4D9940 )
    return 0;
  v16.m128_f32[0] = v16.m128_f32[0]
                  * (float)((float)((float)(1.0 / v15) + (float)(1.0 / v15))
                          - (float)((float)(v15 * (float)(1.0 / v15)) * (float)(1.0 / v15)));
  v17 = _mm_add_ps(v6, _mm_mul_ps(_mm_shuffle_ps(v16, v16, 0), _mm_sub_ps(v9, v6)));
  _mm_storeh_ps((double *)a3, v17);
  *(_DWORD *)(a3 + 8) = v17.m128_i32[0];
  return v19;
}

// sub_457C10 @ 0x00457C10
void __stdcall sub_457C10(int a1, int a2, int a3, int a4)
{
  JUMPOUT(0x457C21);
}

// sub_457C1E @ 0x00457C1E
__m128 *__stdcall sub_457C1E(__m128 *a1, const double *a2, const double *a3, const double *a4)
{
  __m128 v5; // xmm3
  __m128 v6; // xmm1
  __m128 v7; // xmm0
  __m128 v8; // xmm4
  __m128 v9; // xmm5
  __m128 v10; // xmm3
  __m128 v11; // xmm5
  __m128 v12; // xmm1
  __m128 v13; // xmm3
  __m128 v14; // xmm5
  __m128 v15; // xmm0
  __m128 v16; // xmm5
  __m128 v17; // xmm3
  __m128 v18; // xmm0

  v5 = _mm_loadh_ps(a2);
  v6 = _mm_sub_ps(v5, _mm_loadh_ps(a4));
  v7 = _mm_shuffle_ps(v6, v6, 120);
  v8 = v5;
  v9 = _mm_sub_ps(v5, _mm_loadh_ps(a3));
  v10 = _mm_shuffle_ps(v9, v9, 99);
  v11 = _mm_mul_ps(_mm_shuffle_ps(v9, v9, 120), _mm_shuffle_ps(v6, v6, 99));
  v12 = (__m128)xmmword_47A870;
  v13 = _mm_sub_ps(_mm_mul_ps(v7, v10), v11);
  v14 = _mm_mul_ps(v13, v13);
  v15 = _mm_add_ps(v14, _mm_movehl_ps(v14, v14));
  v15.m128_f32[0] = v15.m128_f32[0] + _mm_shuffle_ps(v15, v15, 1).m128_f32[0];
  v16 = v15;
  v15.m128_f32[0] = fsqrt(v15.m128_f32[0]);
  v12.m128_f32[0] = (float)(*(float *)&xmmword_47A870 * (float)(1.0 / v15.m128_f32[0]))
                  * (float)(*(float *)&xmmword_47A860
                          - (float)((float)(v16.m128_f32[0] * (float)(1.0 / v15.m128_f32[0]))
                                  * (float)(1.0 / v15.m128_f32[0])));
  v17 = _mm_mul_ps(v13, _mm_shuffle_ps(v12, v12, 0));
  *a1 = v17;
  v18 = _mm_mul_ps(_mm_shuffle_ps(v8, v8, 14), v17);
  a1->m128_i32[3] = COERCE_UNSIGNED_INT(
                      v18.m128_f32[0]
                    + (float)(_mm_movehl_ps(v16, v18).m128_f32[0] + _mm_shuffle_ps(v18, v18, 85).m128_f32[0]))
                  ^ xmmword_47A850;
  return a1;
}

// sub_457D00 @ 0x00457D00
void __stdcall sub_457D00(int a1, int a2, int a3)
{
  JUMPOUT(0x457D11);
}

// sub_457D0E @ 0x00457D0E
double *__stdcall sub_457D0E(double *a1, __m128 *a2, __m128 *a3)
{
  __m128 v3; // xmm2
  __m128 v4; // xmm3
  __m128 v5; // xmm3
  __m128 v6; // xmm1
  __m128 v7; // xmm0
  CHAR v8; // al
  __m128 v9; // xmm4
  float v10; // xmm3_4
  float v11; // xmm5_4
  double *result; // eax
  __m128 v13; // xmm4
  __m128 v14; // xmm0
  __m128 v15; // xmm0
  __m128 v16; // xmm0
  __m128 v17; // xmm5
  __m128 v18; // xmm6
  float v19; // xmm7_4
  __m128 v20; // xmm0
  __m128 v21; // xmm1
  __m128 v22; // xmm2
  __m128 v23; // xmm3

  v3 = *a3;
  v4 = _mm_and_ps((__m128)xmmword_47A8C0, *a3);
  v5 = _mm_mul_ps(v4, v4);
  v6 = _mm_add_ps(v5, _mm_movehl_ps((__m128)0LL, v5));
  v7 = _mm_shuffle_ps(v6, v6, 1);
  v7.m128_f32[0] = v7.m128_f32[0] + v6.m128_f32[0];
  if ( v7.m128_f32[0] != 0.0 )
  {
    v8 = String[96];
    if ( (String[96] & 1) != 0 )
    {
      v9 = *(__m128 *)&String[64];
    }
    else
    {
      v8 = String[96] | 1;
      v9 = (__m128)(unsigned int)dword_4DC0C0;
      String[96] |= 1u;
      *(_OWORD *)&String[64] = (unsigned int)dword_4DC0C0;
    }
    if ( (v8 & 2) != 0 )
    {
      v10 = *(float *)&String[80];
    }
    else
    {
      v10 = *(float *)&dword_4DC0C4;
      String[96] = v8 | 2;
      *(_OWORD *)&String[80] = (unsigned int)dword_4DC0C4;
    }
    v11 = 1.0 / fsqrt(v7.m128_f32[0]);
    v9.m128_f32[0] = (float)(v9.m128_f32[0] * v11) * (float)(v10 - (float)((float)(v7.m128_f32[0] * v11) * v11));
    v7 = _mm_mul_ps(v3, _mm_shuffle_ps(v9, v9, 0));
  }
  result = a1;
  v13 = _mm_xor_ps((__m128)xmmword_47A880, v7);
  v14 = _mm_mul_ps(v7, *a2);
  v15 = _mm_add_ps(v14, _mm_movehl_ps(v6, v14));
  v15.m128_f32[0] = v15.m128_f32[0] + _mm_shuffle_ps(v15, v15, 1).m128_f32[0];
  v16 = _mm_shuffle_ps(v15, v15, 0);
  v17 = _mm_and_ps((__m128)xmmword_47A8A0, v16);
  v18 = _mm_and_ps((__m128)xmmword_47A8B0, v16);
  v19 = v16.m128_f32[0];
  v20 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v13, v13, 85), *a2), _mm_and_ps((__m128)xmmword_47A890, v16));
  v21 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v13, v13, 170), *a2), v17);
  v23 = _mm_mul_ps(_mm_shuffle_ps(v13, v13, 0), *a2);
  v22 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v13, v13, 255), *a2), v18);
  v23.m128_f32[0] = v23.m128_f32[0] + v19;
  if ( ((unsigned __int8)a1 & 0xF) != 0 )
  {
    _mm_storel_ps(a1, v23);
    _mm_storeh_ps(a1 + 1, v23);
    _mm_storel_ps(a1 + 2, v20);
    _mm_storeh_ps(a1 + 3, v20);
    _mm_storel_ps(a1 + 4, v21);
    _mm_storeh_ps(a1 + 5, v21);
    _mm_storel_ps(a1 + 6, v22);
    _mm_storeh_ps(a1 + 7, v22);
  }
  else
  {
    *(__m128 *)a1 = v23;
    *((__m128 *)a1 + 1) = v20;
    *((__m128 *)a1 + 2) = v21;
    *((__m128 *)a1 + 3) = v22;
  }
  return result;
}

// sub_457E90 @ 0x00457E90
void __stdcall sub_457E90(int a1, int a2)
{
  JUMPOUT(0x457EA1);
}

// sub_457E9E @ 0x00457E9E
__m128 *__stdcall sub_457E9E(__m128 *a1, const double *a2)
{
  __m128 v3; // xmm1
  __m128 v4; // xmm0
  __m128 v5; // xmm3
  __m128 v6; // xmm4
  __m128 v7; // xmm0
  float v8; // xmm5_4
  __m128 v9; // xmm1
  __m128 v10; // xmm4
  __m128 v11; // xmm0
  __m128 v12; // xmm1
  __m128 v13; // xmm2
  __m128 v14; // xmm0
  __m128 v15; // xmm3
  __m128 v16; // xmm2
  __m128 v17; // xmm4

  v3 = _mm_loadl_ps(a2);
  v4 = _mm_and_ps((__m128)xmmword_47A940, v3);
  v5 = (__m128)(unsigned int)dword_47A930;
  v6 = _mm_mul_ps(v4, v4);
  v7 = _mm_add_ps(v6, _mm_movehl_ps(v6, v6));
  v8 = v7.m128_f32[0] + _mm_shuffle_ps(v7, v7, 1).m128_f32[0];
  v7.m128_f32[0] = 1.0 / fsqrt(v8);
  v5.m128_f32[0] = (float)(*(float *)&dword_47A930 * v7.m128_f32[0])
                 * (float)(*(float *)&dword_47A920 - (float)((float)(v8 * v7.m128_f32[0]) * v7.m128_f32[0]));
  v9 = _mm_mul_ps(v3, _mm_shuffle_ps(v5, v5, 0));
  v10 = _mm_mul_ps((__m128)xmmword_47A910, v9);
  v11 = v9;
  v12 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v9, v9, 0), v10), (__m128)xmmword_47A900);
  v13 = v11;
  v14 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v11, v11, 255), v10), (__m128)xmmword_47A8D0);
  v15 = v13;
  v16 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v13, v13, 170), v10), (__m128)xmmword_47A8E0);
  v17 = _mm_add_ps(_mm_mul_ps(v10, _mm_shuffle_ps(v15, v15, 85)), (__m128)xmmword_47A8F0);
  *a1 = v12;
  a1[1] = v17;
  a1[2] = v16;
  a1[3] = v14;
  return a1;
}

// sub_457F70 @ 0x00457F70
double *__stdcall sub_457F70(double *a1, int a2, int a3)
{
  __m128 v3; // xmm0
  __m128 v4; // xmm2
  __m128 v5; // xmm1
  __m128 v6; // xmm0
  __m128 v7; // xmm1
  __m128 v8; // xmm0
  __m128 v9; // xmm1

  v3 = _mm_loadh_ps((const double *)(a2 + 8));
  v4 = _mm_loadh_ps((const double *)(a3 + 8));
  v5 = _mm_mul_ps(_mm_shuffle_ps(v4, v4, 255), v3);
  v6 = _mm_shuffle_ps(v3, v3, 27);
  v7 = _mm_add_ps(v5, _mm_mul_ps(_mm_xor_ps(_mm_shuffle_ps(v4, v4, 0), (__m128)xmmword_4DC100), v6));
  v8 = _mm_shuffle_ps(v6, v6, 177);
  v9 = _mm_add_ps(
         _mm_add_ps(v7, _mm_mul_ps(_mm_xor_ps(_mm_shuffle_ps(v4, v4, 85), (__m128)xmmword_4DC0F0), v8)),
         _mm_mul_ps(_mm_xor_ps(_mm_shuffle_ps(v4, v4, 170), (__m128)xmmword_4DC0E0), _mm_shuffle_ps(v8, v8, 27)));
  _mm_storel_ps(a1, v9);
  _mm_storeh_ps(a1 + 1, v9);
  return a1;
}

// sub_458000 @ 0x00458000
float *__stdcall sub_458000(float *a1, float *a2)
{
  float v2; // xmm1_4
  float v3; // xmm2_4
  float v4; // xmm3_4
  float v5; // xmm4_4
  float v6; // xmm6_4
  float v7; // xmm5_4

  v2 = a2[1];
  v3 = a2[2];
  v4 = a2[3];
  v5 = (float)((float)(*a2 * *a2) + (float)(v2 * v2)) + (float)((float)(v3 * v3) + (float)(v4 * v4));
  v6 = 1.0 / fsqrt(v5);
  v7 = (float)((float)(*(float *)&dword_47A970 - (float)(v5 * (float)(v6 * v6))) * *(float *)&dword_47A960) * v6;
  *a1 = *a2 * v7;
  a1[1] = v2 * v7;
  a1[2] = v3 * v7;
  a1[3] = v4 * v7;
  return a1;
}

// sub_4580A0 @ 0x004580A0
void __stdcall sub_4580A0(int a1, int a2)
{
  JUMPOUT(0x4580B1);
}

// sub_4580AE @ 0x004580AE
__m128 *__stdcall sub_4580AE(__m128 *a1, int a2)
{
  __m128 v3; // xmm1
  __m128 v4; // xmm2
  __m128 v5; // xmm0
  __m128 v6; // xmm3

  v3 = _mm_loadh_ps((const double *)(a2 + 8));
  v4 = _mm_mul_ps(v3, v3);
  v5 = _mm_add_ps(v4, _mm_movehl_ps(v4, v4));
  v4.m128_f32[0] = v5.m128_f32[0] + _mm_shuffle_ps(v5, v5, 85).m128_f32[0];
  v5.m128_f32[0] = 1.0 / v4.m128_f32[0];
  v6 = v5;
  v6.m128_f32[0] = (float)(v6.m128_f32[0] + v6.m128_f32[0])
                 - (float)((float)(v5.m128_f32[0] * v4.m128_f32[0]) * v5.m128_f32[0]);
  *a1 = _mm_mul_ps(_mm_mul_ps(v3, (__m128)xmmword_47A980), _mm_shuffle_ps(v6, v6, 0));
  return a1;
}

// sub_458110 @ 0x00458110
float *__stdcall sub_458110(float *a1, float *a2)
{
  float *result; // eax
  double v3; // st7
  float v4; // edi
  float v5; // esi
  int v6; // ebp
  double v7; // st7
  int v8; // ecx
  int v9; // ebx
  int v10; // ebp
  float *v11; // esi
  long double v12; // st6
  long double v13; // st7
  float *v14; // ecx
  long double v15; // st6
  long double v16; // st7
  _DWORD v17[7]; // [esp+0h] [ebp-1Ch]

  result = a1;
  v3 = *a2 + a2[5] + a2[10];
  v4 = *a2;
  v5 = a2[5];
  v6 = *((_DWORD *)a2 + 10);
  if ( flt_4DC11C < v3 )
  {
    v15 = sqrt(v3 + flt_4DC120) * flt_4DC124;
    v16 = flt_4DC128 / v15;
    a1[3] = v15;
    *a1 = (a2[6] - a2[9]) * v16;
    a1[1] = (a2[8] - a2[2]) * v16;
    a1[2] = v16 * (a2[1] - a2[4]);
  }
  else
  {
    v7 = a2[10];
    *(float *)v17 = *a2;
    *(float *)&v17[1] = v5;
    v17[2] = v6;
    v8 = 2;
    if ( *(float *)&v17[v5 > (double)v4] >= v7 )
      v8 = v5 > (double)v4;
    v9 = dword_4DC110[v8];
    v10 = dword_4DC110[v9];
    v11 = &a2[v8];
    v12 = sqrt(flt_4DC130 + *(float *)&v17[v8] - *(float *)&v17[v9] - *(float *)&v17[v10]) * flt_4DC134;
    v13 = flt_4DC138 / v12;
    a1[v8] = v12;
    v14 = &a2[4 * v8];
    a1[v9] = (v14[v9] + v11[4 * v9]) * v13;
    a1[v10] = (v11[4 * v10] + v14[v10]) * v13;
    a1[3] = v13 * (a2[4 * v9 + v10] - a2[4 * v10 + v9]);
  }
  return result;
}

// sub_458230 @ 0x00458230
void __stdcall sub_458230(int a1, int a2, int a3, int a4)
{
  JUMPOUT(0x458241);
}

// sub_45823E @ 0x0045823E
__m128 *__stdcall sub_45823E(__m128 *a1, unsigned int a2, unsigned int a3, unsigned int a4)
{
  __m128 v4; // xmm0
  __m128 v5; // xmm1
  __m128 v6; // xmm3
  __m128 v7; // xmm2
  __m128 v8; // xmm3
  __m128 v10; // [esp+10h] [ebp-4Ch] BYREF
  __m128 v11[3]; // [esp+20h] [ebp-3Ch] BYREF

  v10 = _mm_mul_ps(
          _mm_shuffle_ps(
            _mm_unpacklo_ps((__m128)a3, (__m128)a4),
            _mm_unpacklo_ps((__m128)(unsigned int)dword_4DC160, (__m128)a2),
            17),
          (__m128)xmmword_4DC150);
  sub_45FBD0(&v10, &v10, v11);
  v4 = _mm_shuffle_ps(v10, v11[0], 0);
  v5 = _mm_shuffle_ps(v4, v4, 138);
  v6 = _mm_shuffle_ps(v10, v11[0], 153);
  v7 = _mm_shuffle_ps(v6, v6, 247);
  v8 = _mm_shuffle_ps(v6, v6, 168);
  v10 = _mm_add_ps(
          _mm_mul_ps(_mm_mul_ps(v5, v7), v8),
          _mm_xor_ps(
            _mm_mul_ps(_mm_mul_ps(_mm_shuffle_ps(v5, v5, 138), _mm_shuffle_ps(v7, v7, 81)), _mm_shuffle_ps(v8, v8, 1)),
            (__m128)xmmword_4DC140));
  *a1 = v10;
  return a1;
}

// sub_458300 @ 0x00458300
void __stdcall sub_458300(int a1, int a2, int a3)
{
  JUMPOUT(0x458311);
}

// sub_45830E @ 0x0045830E
int __stdcall sub_45830E(int a1, int a2, int a3)
{
  __m128 v3; // xmm2
  __m128 v4; // xmm0
  __m128 v6; // xmm5
  __m128 v7; // xmm3

  if ( (a3 & 0xF) != 0 )
  {
    v6 = _mm_loadl_ps((const double *)a2);
    v7 = _mm_add_ps(
           _mm_add_ps(
             _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 8)), _mm_shuffle_ps(v6, v6, 0)),
             _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 24)), _mm_shuffle_ps(v6, v6, 85))),
           _mm_mul_ps(
             _mm_loadh_ps((const double *)(a3 + 40)),
             _mm_shuffle_ps((__m128)*(unsigned int *)(a2 + 8), (__m128)*(unsigned int *)(a2 + 8), 0)));
    _mm_storel_ps((double *)a1, v7);
    *(_DWORD *)(a1 + 8) = _mm_movehl_ps(v7, v7).m128_u32[0];
  }
  else
  {
    v3 = _mm_loadl_ps((const double *)a2);
    v4 = _mm_add_ps(
           _mm_add_ps(
             _mm_mul_ps(_mm_shuffle_ps(v3, v3, 0), *(__m128 *)a3),
             _mm_mul_ps(_mm_shuffle_ps(v3, v3, 85), *(__m128 *)(a3 + 16))),
           _mm_mul_ps(
             _mm_shuffle_ps((__m128)*(unsigned int *)(a2 + 8), (__m128)*(unsigned int *)(a2 + 8), 0),
             *(__m128 *)(a3 + 32)));
    _mm_storel_ps((double *)a1, v4);
    *(_DWORD *)(a1 + 8) = _mm_movehl_ps(v4, v4).m128_u32[0];
  }
  return a1;
}

// sub_4583C0 @ 0x004583C0
void __stdcall sub_4583C0(int a1, int a2, int a3)
{
  JUMPOUT(0x4583D1);
}

// sub_4583CE @ 0x004583CE
__m128 *__stdcall sub_4583CE(__m128 *a1, int a2, int a3)
{
  __m128 v3; // xmm2
  __m128 v5; // xmm6

  if ( (a3 & 0xF) != 0 )
  {
    v5 = _mm_loadl_ps((const double *)a2);
    *a1 = _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 8)), _mm_shuffle_ps(v5, v5, 0)),
              _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 24)), _mm_shuffle_ps(v5, v5, 85))),
            _mm_add_ps(
              _mm_mul_ps(
                _mm_loadh_ps((const double *)(a3 + 40)),
                _mm_shuffle_ps((__m128)*(unsigned int *)(a2 + 8), (__m128)*(unsigned int *)(a2 + 8), 0)),
              _mm_loadh_ps((const double *)(a3 + 56))));
  }
  else
  {
    v3 = _mm_loadl_ps((const double *)a2);
    *a1 = _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_shuffle_ps(v3, v3, 0), *(__m128 *)a3),
              _mm_mul_ps(_mm_shuffle_ps(v3, v3, 85), *(__m128 *)(a3 + 16))),
            _mm_add_ps(
              _mm_mul_ps(
                _mm_shuffle_ps((__m128)*(unsigned int *)(a2 + 8), (__m128)*(unsigned int *)(a2 + 8), 0),
                *(__m128 *)(a3 + 32)),
              *(__m128 *)(a3 + 48)));
  }
  return a1;
}

// sub_458480 @ 0x00458480
void __stdcall sub_458480(int a1, int a2, int a3)
{
  JUMPOUT(0x458491);
}

// sub_45848E @ 0x0045848E
__m128 *__stdcall sub_45848E(__m128 *a1, __m128 *a2, int a3)
{
  if ( (a3 & 0xF) != 0 )
    *a1 = _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 8)), _mm_shuffle_ps(*a2, *a2, 0)),
              _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 24)), _mm_shuffle_ps(*a2, *a2, 85))),
            _mm_add_ps(
              _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 40)), _mm_shuffle_ps(*a2, *a2, 170)),
              _mm_mul_ps(_mm_loadh_ps((const double *)(a3 + 56)), _mm_shuffle_ps(*a2, *a2, 255))));
  else
    *a1 = _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_shuffle_ps(*a2, *a2, 0), *(__m128 *)a3),
              _mm_mul_ps(_mm_shuffle_ps(*a2, *a2, 85), *(__m128 *)(a3 + 16))),
            _mm_add_ps(
              _mm_mul_ps(_mm_shuffle_ps(*a2, *a2, 170), *(__m128 *)(a3 + 32)),
              _mm_mul_ps(_mm_shuffle_ps(*a2, *a2, 255), *(__m128 *)(a3 + 48))));
  return a1;
}

// sub_458540 @ 0x00458540
void __stdcall sub_458540(int a1, int a2, int a3)
{
  JUMPOUT(0x458551);
}

// sub_45854E @ 0x0045854E
double *__stdcall sub_45854E(double *a1, unsigned int *a2, const double *a3)
{
  __m128 v5; // xmm3
  __m128 v6; // xmm2
  __m128 v7; // xmm1
  __m128 v8; // xmm0
  __m128 v9; // xmm4
  __m128 v10; // xmm5
  __m128 v11; // xmm6
  __m128 v12; // xmm7
  __m128 v13; // xmm2
  __m128 v14; // xmm1
  __m128 v15; // xmm7

  v5 = _mm_loadh_ps(a3 + 1);
  v6 = _mm_loadh_ps(a3 + 3);
  v7 = _mm_loadh_ps(a3 + 5);
  v8 = _mm_loadh_ps(a3 + 7);
  v9 = _mm_add_ps(
         _mm_add_ps(
           _mm_add_ps(
             _mm_mul_ps(_mm_shuffle_ps((__m128)*a2, (__m128)*a2, 0), v5),
             _mm_mul_ps(_mm_shuffle_ps((__m128)a2[1], (__m128)a2[1], 0), v6)),
           _mm_mul_ps(_mm_shuffle_ps((__m128)a2[2], (__m128)a2[2], 0), v7)),
         _mm_mul_ps(_mm_shuffle_ps((__m128)a2[3], (__m128)a2[3], 0), v8));
  v10 = _mm_add_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_shuffle_ps((__m128)a2[4], (__m128)a2[4], 0), v5),
              _mm_mul_ps(_mm_shuffle_ps((__m128)a2[5], (__m128)a2[5], 0), v6)),
            _mm_mul_ps(_mm_shuffle_ps((__m128)a2[6], (__m128)a2[6], 0), v7)),
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[7], (__m128)a2[7], 0), v8));
  v11 = _mm_add_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_shuffle_ps((__m128)a2[8], (__m128)a2[8], 0), v5),
              _mm_mul_ps(_mm_shuffle_ps((__m128)a2[9], (__m128)a2[9], 0), v6)),
            _mm_mul_ps(_mm_shuffle_ps((__m128)a2[10], (__m128)a2[10], 0), v7)),
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[11], (__m128)a2[11], 0), v8));
  v12 = _mm_add_ps(
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[12], (__m128)a2[12], 0), v5),
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[13], (__m128)a2[13], 0), v6));
  v13 = _mm_mul_ps(_mm_shuffle_ps((__m128)a2[14], (__m128)a2[14], 0), v7);
  v14 = (__m128)a2[15];
  _mm_storel_ps(a1, v9);
  _mm_storeh_ps(a1 + 1, v9);
  _mm_storel_ps(a1 + 2, v10);
  _mm_storeh_ps(a1 + 3, v10);
  _mm_storel_ps(a1 + 4, v11);
  _mm_storeh_ps(a1 + 5, v11);
  v15 = _mm_add_ps(_mm_add_ps(v12, v13), _mm_mul_ps(_mm_shuffle_ps(v14, v14, 0), v8));
  _mm_storel_ps(a1 + 6, v15);
  _mm_storeh_ps(a1 + 7, v15);
  return a1;
}

// sub_458690 @ 0x00458690
void __stdcall sub_458690(int a1, int a2)
{
  JUMPOUT(0x4586A1);
}

// sub_45869E @ 0x0045869E
float *__stdcall sub_45869E(float *a1, float *a2)
{
  float *result; // eax
  float v3; // xmm6_4
  float v4; // xmm5_4
  float v5; // xmm3_4
  float v6; // xmm3_4
  float v7; // xmm0_4

  result = a1;
  v3 = a2[1];
  v4 = a2[2];
  v5 = (float)((float)(*a2 * *a2) + (float)(v3 * v3)) + (float)(v4 * v4);
  if ( *(float *)&dword_4DC180 <= v5 )
  {
    v6 = 1.0 / fsqrt(v5);
    v7 = (float)(*(float *)&dword_4DC184 * v6)
       * (float)(*(float *)&dword_4DC188
               - (float)((float)((float)((float)((float)(*a2 * *a2) + (float)(a2[1] * a2[1])) + (float)(a2[2] * a2[2]))
                               * v6)
                       * v6));
    *a1 = v7 * *a2;
    a1[1] = v7 * v3;
    a1[2] = v7 * v4;
  }
  else
  {
    *a1 = 0.0;
    a1[1] = 0.0;
    a1[2] = 0.0;
  }
  return result;
}

// sub_458760 @ 0x00458760
void __stdcall sub_458760(int a1, int a2)
{
  JUMPOUT(0x458771);
}

// sub_45876E @ 0x0045876E
float *__stdcall sub_45876E(float *a1, float *a2)
{
  float *result; // eax
  float v3; // xmm4_4
  float v4; // xmm6_4
  float v5; // xmm3_4
  float v6; // xmm3_4
  float v7; // xmm0_4

  result = a1;
  v3 = a2[1];
  v4 = a2[2];
  v5 = (float)((float)(*a2 * *a2) + (float)(v3 * v3)) + (float)(v4 * v4);
  if ( *(float *)&dword_4DC18C <= v5 )
  {
    v6 = 1.0 / fsqrt(v5);
    v7 = (float)(*(float *)&dword_4DC190 * v6)
       * (float)(*(float *)&dword_4DC194
               - (float)((float)((float)((float)((float)(*a2 * *a2) + (float)(a2[1] * a2[1])) + (float)(a2[2] * a2[2]))
                               * v6)
                       * v6));
    *a1 = v7 * *a2;
    a1[1] = v7 * v3;
    a1[2] = v7 * v4;
    a1[3] = v7 * a2[3];
  }
  else
  {
    *a1 = 0.0;
    a1[1] = 0.0;
    a1[2] = 0.0;
    a1[3] = 0.0;
  }
  return result;
}

// sub_458840 @ 0x00458840
void __stdcall sub_458840(int a1, int a2, int a3)
{
  JUMPOUT(0x458851);
}

// sub_45884E @ 0x0045884E
double *__stdcall sub_45884E(double *a1, _DWORD *a2, const double *a3)
{
  __m128 v3; // xmm4
  __m128 v4; // xmm1
  __m128 v5; // xmm5
  __m128 v6; // xmm0
  __m128 v7; // xmm4
  __m128 v8; // xmm5
  __m128 v9; // xmm6
  __m128 v10; // xmm5
  __m128 v11; // xmm7
  __m128 v12; // xmm3
  __m128 v13; // xmm1
  __m128 v14; // xmm7
  __m128 v15; // xmm3
  __m128 v16; // xmm5
  __m128 v17; // xmm5
  __m128 v18; // xmm6
  __m128 v19; // xmm3
  __m128 v20; // xmm5
  __m128 v21; // xmm6
  __m128 v22; // xmm3
  __m128 v23; // xmm7
  __m128 v24; // xmm7
  __m128 v25; // xmm5
  __m128 v26; // xmm0
  __m128 v27; // xmm6
  __m128 v28; // xmm7
  __m128 v29; // xmm4
  __m128 v30; // xmm0
  __m128 v31; // xmm7
  __m128 v32; // xmm5
  __m128 v33; // xmm6
  __m128 v34; // xmm1
  __m128 v35; // xmm1
  __m128 v36; // xmm0
  __m128 v37; // xmm5
  __m128 v38; // xmm6
  __m128 v39; // xmm3
  __m128 v40; // xmm3
  __m128 v41; // xmm5
  __m128 v42; // xmm7
  __m128 v43; // xmm3
  __m128 v44; // xmm6
  __m128 v45; // xmm4
  __m128 v46; // xmm0
  __m128 v47; // xmm4
  __m128 v48; // xmm3
  __m128 v49; // xmm0
  __m128 v50; // xmm4
  __m128 v51; // xmm6
  __m128 v52; // xmm2
  __m128 v53; // xmm0
  __m128 v55; // xmm5
  __m128 v56; // xmm5
  __m128 v57; // xmm1
  __m128 v58; // xmm4
  __m128 v59; // xmm6
  __m128 v60; // xmm5
  __m128 v61; // [esp+20h] [ebp-FCh]
  __m128 v62; // [esp+30h] [ebp-ECh]
  __m128 v63; // [esp+40h] [ebp-DCh]
  __m128 v64; // [esp+50h] [ebp-CCh]
  __m128 v65; // [esp+60h] [ebp-BCh]
  __m128 v66; // [esp+70h] [ebp-ACh]
  __m128 v67; // [esp+80h] [ebp-9Ch]
  __m128 v68; // [esp+90h] [ebp-8Ch]
  __m128 v69; // [esp+A0h] [ebp-7Ch]
  __m128 v70; // [esp+B0h] [ebp-6Ch]
  __m128 v71; // [esp+E0h] [ebp-3Ch]

  v3 = _mm_loadh_ps(a3 + 7);
  v4 = _mm_loadh_ps(a3 + 2);
  v5 = _mm_loadh_ps(a3 + 3);
  v6 = _mm_shuffle_ps(v5, v3, 136);
  v7 = _mm_shuffle_ps(v3, v5, 221);
  v8 = _mm_mul_ps(v7, v6);
  v9 = _mm_shuffle_ps(v8, v8, 177);
  v10 = _mm_shuffle_ps(v9, v9, 78);
  v11 = _mm_loadh_ps(a3 + 6);
  v12 = _mm_shuffle_ps(v11, v4, 221);
  v13 = _mm_shuffle_ps(v4, v11, 136);
  v14 = v12;
  v15 = _mm_mul_ps(v12, v10);
  v62 = _mm_mul_ps(v10, v13);
  v16 = _mm_mul_ps(v14, v6);
  v17 = _mm_shuffle_ps(v16, v16, 177);
  v63 = _mm_mul_ps(v9, v13);
  v18 = _mm_add_ps(_mm_mul_ps(v7, v17), _mm_sub_ps(v15, _mm_mul_ps(v14, v9)));
  v19 = v17;
  v20 = _mm_shuffle_ps(v17, v17, 78);
  v64 = _mm_mul_ps(v19, v13);
  v21 = _mm_sub_ps(v18, _mm_mul_ps(v7, v20));
  v22 = v14;
  v23 = _mm_mul_ps(_mm_shuffle_ps(v14, v14, 78), v7);
  v24 = _mm_shuffle_ps(v23, v23, 177);
  v65 = _mm_mul_ps(v20, v13);
  v25 = _mm_shuffle_ps(v6, v6, 78);
  v26 = _mm_add_ps(_mm_mul_ps(v25, v24), v21);
  v27 = v24;
  v28 = _mm_shuffle_ps(v24, v24, 78);
  v66 = v7;
  v29 = v25;
  v30 = _mm_sub_ps(v26, _mm_mul_ps(v25, v28));
  v31 = _mm_sub_ps(_mm_mul_ps(v28, v13), _mm_mul_ps(v27, v13));
  v32 = v13;
  v33 = _mm_mul_ps(v13, v30);
  v61 = v30;
  v34 = _mm_add_ps(_mm_shuffle_ps(v33, v33, 78), v33);
  v30.m128_i32[0] = v34.m128_i32[0];
  v35 = _mm_shuffle_ps(v34, v34, 177);
  v35.m128_f32[0] = v35.m128_f32[0] + v30.m128_f32[0];
  v36 = v32;
  v37 = _mm_mul_ps(v32, v22);
  v38 = _mm_shuffle_ps(v37, v37, 177);
  v67 = v29;
  v68 = v22;
  v39 = _mm_mul_ps(v66, v36);
  v40 = _mm_shuffle_ps(v39, v39, 177);
  v69 = _mm_shuffle_ps(v38, v38, 78);
  v70 = v38;
  v41 = _mm_add_ps(
          _mm_mul_ps(v68, v40),
          _mm_sub_ps(_mm_mul_ps(v66, v69), _mm_add_ps(_mm_mul_ps(v66, v38), _mm_shuffle_ps(v31, v31, 78))));
  v42 = v40;
  v43 = _mm_shuffle_ps(v40, v40, 78);
  v44 = _mm_sub_ps(v41, _mm_mul_ps(v68, v43));
  v45 = _mm_sub_ps(v62, v63);
  v46 = _mm_mul_ps(v36, v67);
  v47 = _mm_add_ps(_mm_sub_ps(_mm_shuffle_ps(v45, v45, 78), _mm_mul_ps(v42, v67)), _mm_mul_ps(v43, v67));
  v48 = _mm_shuffle_ps(v46, v46, 177);
  v49 = _mm_shuffle_ps(v48, v48, 78);
  v71 = v44;
  v50 = _mm_sub_ps(_mm_add_ps(v47, _mm_mul_ps(v66, v48)), _mm_mul_ps(v66, v49));
  v51 = _mm_sub_ps(v65, v64);
  v52 = _mm_add_ps(
          _mm_mul_ps(v68, v49),
          _mm_sub_ps(
            _mm_sub_ps(_mm_sub_ps(_mm_mul_ps(v70, v67), _mm_shuffle_ps(v51, v51, 78)), _mm_mul_ps(v67, v69)),
            _mm_mul_ps(v48, v68)));
  if ( v35.m128_f32[0] == 0.0 )
    return 0;
  if ( a2 )
    *a2 = v35.m128_i32[0];
  v53 = v35;
  v53.m128_f32[0] = 1.0 / v35.m128_f32[0];
  v55 = v53;
  v55.m128_f32[0] = (float)(v55.m128_f32[0] + v55.m128_f32[0])
                  - (float)(v35.m128_f32[0] * (float)(v53.m128_f32[0] * v53.m128_f32[0]));
  v56 = _mm_shuffle_ps(v55, v55, 0);
  v57 = _mm_mul_ps(v61, v56);
  _mm_storel_ps(a1, v57);
  _mm_storeh_ps(a1 + 1, v57);
  v58 = _mm_mul_ps(v50, v56);
  _mm_storel_ps(a1 + 2, v58);
  _mm_storeh_ps(a1 + 3, v58);
  v59 = _mm_mul_ps(v71, v56);
  _mm_storel_ps(a1 + 4, v59);
  _mm_storeh_ps(a1 + 5, v59);
  v60 = _mm_mul_ps(v56, v52);
  _mm_storel_ps(a1 + 6, v60);
  _mm_storeh_ps(a1 + 7, v60);
  return a1;
}

// sub_458B00 @ 0x00458B00
void __stdcall sub_458B00(int a1, int a2, int a3)
{
  JUMPOUT(0x458B11);
}

// sub_458B0E @ 0x00458B0E
double *__stdcall sub_458B0E(double *a1, unsigned int *a2, const double *a3)
{
  __m128 v5; // xmm3
  __m128 v6; // xmm2
  __m128 v7; // xmm1
  __m128 v8; // xmm0
  __m128 v9; // xmm5
  __m128 v10; // xmm7
  __m128 v11; // xmm4
  __m128 v12; // xmm7
  __m128 v13; // xmm6
  __m128 v14; // xmm5
  __m128 v15; // xmm2
  __m128 v16; // xmm1
  __m128 v17; // xmm5
  __m128 v18; // xmm0
  __m128 v19; // xmm6
  __m128 v20; // xmm0

  v5 = _mm_loadh_ps(a3 + 1);
  v6 = _mm_loadh_ps(a3 + 3);
  v7 = _mm_loadh_ps(a3 + 5);
  v8 = _mm_loadh_ps(a3 + 7);
  v9 = _mm_add_ps(
         _mm_add_ps(
           _mm_add_ps(
             _mm_mul_ps(_mm_shuffle_ps((__m128)a2[4], (__m128)a2[4], 0), v5),
             _mm_mul_ps(_mm_shuffle_ps((__m128)a2[5], (__m128)a2[5], 0), v6)),
           _mm_mul_ps(_mm_shuffle_ps((__m128)a2[6], (__m128)a2[6], 0), v7)),
         _mm_mul_ps(_mm_shuffle_ps((__m128)a2[7], (__m128)a2[7], 0), v8));
  v10 = _mm_add_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_shuffle_ps((__m128)*a2, (__m128)*a2, 0), v5),
              _mm_mul_ps(_mm_shuffle_ps((__m128)a2[1], (__m128)a2[1], 0), v6)),
            _mm_mul_ps(_mm_shuffle_ps((__m128)a2[2], (__m128)a2[2], 0), v7)),
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[3], (__m128)a2[3], 0), v8));
  v11 = _mm_unpacklo_ps(v10, v9);
  v12 = _mm_unpackhi_ps(v10, v9);
  v13 = _mm_add_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(_mm_shuffle_ps((__m128)a2[8], (__m128)a2[8], 0), v5),
              _mm_mul_ps(_mm_shuffle_ps((__m128)a2[9], (__m128)a2[9], 0), v6)),
            _mm_mul_ps(_mm_shuffle_ps((__m128)a2[10], (__m128)a2[10], 0), v7)),
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[11], (__m128)a2[11], 0), v8));
  v14 = _mm_add_ps(
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[12], (__m128)a2[12], 0), v5),
          _mm_mul_ps(_mm_shuffle_ps((__m128)a2[13], (__m128)a2[13], 0), v6));
  v15 = _mm_mul_ps(_mm_shuffle_ps((__m128)a2[14], (__m128)a2[14], 0), v7);
  v16 = (__m128)a2[15];
  _mm_storel_ps(a1, v11);
  v17 = _mm_add_ps(_mm_add_ps(v14, v15), _mm_mul_ps(_mm_shuffle_ps(v16, v16, 0), v8));
  _mm_storeh_ps(a1 + 2, v11);
  _mm_storel_ps(a1 + 4, v12);
  _mm_storeh_ps(a1 + 6, v12);
  v18 = v13;
  v19 = _mm_unpacklo_ps(v13, v17);
  _mm_storel_ps(a1 + 1, v19);
  _mm_storeh_ps(a1 + 3, v19);
  v20 = _mm_unpackhi_ps(v18, v17);
  _mm_storel_ps(a1 + 5, v20);
  _mm_storeh_ps(a1 + 7, v20);
  return a1;
}

// sub_458C60 @ 0x00458C60
void __stdcall sub_458C60(int a1, int a2, int a3, int a4)
{
  JUMPOUT(0x458C71);
}

// sub_458C6E @ 0x00458C6E
__m128 *__stdcall sub_458C6E(__m128 *a1, int a2, int a3, int a4)
{
  __m128 v5; // xmm2
  __m128 v6; // xmm2
  __m128 v7; // xmm1
  __m128 v8; // xmm3
  __m128 v9; // xmm4
  __m128 v10; // xmm0
  __m128 v11; // xmm4
  __m128 v12; // xmm2
  __m128 v13; // xmm3
  __m128 v14; // xmm1

  v5 = _mm_loadh_ps((const double *)(a3 + 8));
  v6 = _mm_shuffle_ps(v5, v5, 57);
  v7 = _mm_loadh_ps((const double *)(a2 + 8));
  v8 = _mm_loadh_ps((const double *)(a4 + 8));
  v9 = _mm_shuffle_ps(v8, v8, 78);
  v10 = _mm_mul_ps(_mm_shuffle_ps(v9, v9, 57), v6);
  v11 = _mm_mul_ps(v9, v6);
  v12 = _mm_mul_ps(v6, v8);
  v13 = _mm_shuffle_ps(v7, v7, 57);
  v14 = _mm_shuffle_ps(v13, v13, 57);
  *a1 = _mm_xor_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(v13, _mm_sub_ps(_mm_shuffle_ps(v11, v11, 57), _mm_shuffle_ps(v12, v12, 78))),
              _mm_mul_ps(_mm_sub_ps(_mm_shuffle_ps(v10, v10, 78), v10), v14)),
            _mm_mul_ps(_mm_shuffle_ps(v14, v14, 57), _mm_sub_ps(v11, _mm_shuffle_ps(v12, v12, 57)))),
          (__m128)xmmword_47A9A0);
  return a1;
}

// sub_458D10 @ 0x00458D10
void __stdcall sub_458D10(int a1, int a2)
{
  JUMPOUT(0x458D21);
}

// sub_458D1E @ 0x00458D1E
int __stdcall sub_458D1E(int a1, int a2)
{
  __m128 v2; // xmm0
  __m128 v3; // xmm2
  __m128 v5; // xmm3
  __m128 v6; // xmm0
  int v7; // [esp-14h] [ebp-44h]
  int v8; // [esp-10h] [ebp-40h]
  int v9; // [esp-Ch] [ebp-3Ch]
  int v10; // [esp-8h] [ebp-38h]
  void *vars0; // [esp+30h] [ebp+0h]
  void *retaddr; // [esp+38h] [ebp+8h]

  vars0 = retaddr;
  v2 = sub_45FDC0(v7, v8, v9, v10);
  v3 = (__m128)xmmword_4DC1B0;
  v5 = v2;
  v6 = (__m128)xmmword_4DC1C0;
  *(_OWORD *)a1 = xmmword_4DC1D0;
  *(_DWORD *)(a1 + 16) = v6.m128_i32[0];
  _mm_storel_ps((double *)(a1 + 20), v5);
  _mm_storel_ps((double *)(a1 + 28), v6);
  *(_DWORD *)(a1 + 44) = v6.m128_i32[0];
  _mm_storel_ps((double *)(a1 + 36), _mm_xor_ps(_mm_shuffle_ps(v5, v5, 17), v3));
  *(__m128 *)(a1 + 48) = v6;
  return a1;
}

// sub_458D90 @ 0x00458D90
void __stdcall sub_458D90(int a1, int a2)
{
  JUMPOUT(0x458DA1);
}

// sub_458D9E @ 0x00458D9E
int __stdcall sub_458D9E(int a1, int a2)
{
  __m128 v2; // xmm0
  __m128 v3; // xmm0
  __int128 v5; // xmm1
  int v6; // [esp-14h] [ebp-64h]
  int v7; // [esp-10h] [ebp-60h]
  int v8; // [esp-Ch] [ebp-5Ch]
  int v9; // [esp-8h] [ebp-58h]
  __m128 v10; // [esp+1Ch] [ebp-34h]
  __m128 v11; // [esp+2Ch] [ebp-24h]
  void *vars0; // [esp+50h] [ebp+0h]
  void *retaddr; // [esp+58h] [ebp+8h]

  vars0 = retaddr;
  v11 = (__m128)xmmword_4DC210;
  v10 = (__m128)xmmword_4DC200;
  v2 = sub_45FDC0(v6, v7, v8, v9);
  v3 = _mm_and_ps(_mm_shuffle_ps(v2, v2, 80), v11);
  *(__m128 *)a1 = _mm_xor_ps(v10, v3);
  *(_OWORD *)(a1 + 16) = xmmword_4DC1F0;
  v5 = xmmword_4DC1E0;
  *(__m128 *)(a1 + 32) = _mm_shuffle_ps(v3, v3, 70);
  *(_OWORD *)(a1 + 48) = v5;
  return a1;
}

// sub_458E20 @ 0x00458E20
void __stdcall sub_458E20(int a1)
{
  JUMPOUT(0x458E31);
}

// sub_458E2E @ 0x00458E2E
double __stdcall sub_458E2E(int a1)
{
  __m128 v1; // xmm7
  __m128 v2; // xmm1
  __m128 v3; // xmm2
  __m128 v4; // xmm0
  __m128 v5; // xmm2
  __m128 v6; // xmm3
  __m128 v7; // xmm4
  __m128 v8; // xmm0
  __m128 v9; // xmm4
  __m128 v10; // xmm0
  __m128 v11; // xmm2
  __m128 v12; // xmm0
  __m128 v13; // xmm1
  __m128 v14; // xmm1
  __m128 v15; // xmm0

  if ( (a1 & 0xF) != 0 )
  {
    v2 = _mm_loadh_ps((const double *)(a1 + 24));
    v1 = _mm_loadh_ps((const double *)(a1 + 8));
    v3 = _mm_loadh_ps((const double *)(a1 + 40));
    v4 = _mm_loadh_ps((const double *)(a1 + 56));
  }
  else
  {
    v1 = *(__m128 *)a1;
    v2 = *(__m128 *)(a1 + 16);
    v3 = *(__m128 *)(a1 + 32);
    v4 = *(__m128 *)(a1 + 48);
  }
  v5 = _mm_shuffle_ps(v3, v3, 57);
  v6 = _mm_mul_ps(v4, v5);
  v7 = _mm_shuffle_ps(v4, v4, 78);
  v8 = _mm_shuffle_ps(v7, v7, 57);
  v9 = _mm_mul_ps(v7, v5);
  v10 = _mm_mul_ps(v5, v8);
  v11 = _mm_sub_ps(_mm_shuffle_ps(v10, v10, 78), v10);
  v12 = _mm_shuffle_ps(v2, v2, 57);
  v13 = _mm_shuffle_ps(v12, v12, 57);
  v14 = _mm_mul_ps(
          _mm_add_ps(
            _mm_add_ps(
              _mm_mul_ps(v12, _mm_sub_ps(_mm_shuffle_ps(v9, v9, 57), _mm_shuffle_ps(v6, v6, 78))),
              _mm_mul_ps(v11, v13)),
            _mm_mul_ps(_mm_shuffle_ps(v13, v13, 57), _mm_sub_ps(v9, _mm_shuffle_ps(v6, v6, 57)))),
          v1);
  v15 = _mm_add_ps(v14, _mm_movehl_ps(v14, v14));
  return (float)(v15.m128_f32[0] - _mm_shuffle_ps(v15, v15, 1).m128_f32[0]);
}

// sub_458EF0 @ 0x00458EF0
void __stdcall sub_458EF0(int a1, int a2, int a3, int a4)
{
  JUMPOUT(0x458F01);
}

// sub_458EFE @ 0x00458EFE
__m128 *__stdcall sub_458EFE(__m128 *a1, const double *a2, const double *a3, const double *a4)
{
  __m128 v5; // xmm3
  __m128 v6; // xmm1
  __m128 v7; // xmm0
  __m128 v8; // xmm4
  __m128 v9; // xmm5
  __m128 v10; // xmm3
  __m128 v11; // xmm5
  __m128 v12; // xmm1
  __m128 v13; // xmm3
  __m128 v14; // xmm5
  __m128 v15; // xmm0
  __m128 v16; // xmm5
  __m128 v17; // xmm3
  __m128 v18; // xmm0

  v5 = _mm_loadh_ps(a2);
  v6 = _mm_sub_ps(v5, _mm_loadh_ps(a4));
  v7 = _mm_shuffle_ps(v6, v6, 120);
  v8 = v5;
  v9 = _mm_sub_ps(v5, _mm_loadh_ps(a3));
  v10 = _mm_shuffle_ps(v9, v9, 99);
  v11 = _mm_mul_ps(_mm_shuffle_ps(v9, v9, 120), _mm_shuffle_ps(v6, v6, 99));
  v12 = (__m128)xmmword_47A9D0;
  v13 = _mm_sub_ps(_mm_mul_ps(v7, v10), v11);
  v14 = _mm_mul_ps(v13, v13);
  v15 = _mm_add_ps(v14, _mm_movehl_ps(v14, v14));
  v15.m128_f32[0] = v15.m128_f32[0] + _mm_shuffle_ps(v15, v15, 1).m128_f32[0];
  v16 = v15;
  v15.m128_f32[0] = fsqrt(v15.m128_f32[0]);
  v12.m128_f32[0] = (float)(*(float *)&xmmword_47A9D0 * (float)(1.0 / v15.m128_f32[0]))
                  * (float)(*(float *)&xmmword_47A9C0
                          - (float)((float)(v16.m128_f32[0] * (float)(1.0 / v15.m128_f32[0]))
                                  * (float)(1.0 / v15.m128_f32[0])));
  v17 = _mm_mul_ps(v13, _mm_shuffle_ps(v12, v12, 0));
  *a1 = v17;
  v18 = _mm_mul_ps(_mm_shuffle_ps(v8, v8, 14), v17);
  a1->m128_i32[3] = COERCE_UNSIGNED_INT(
                      v18.m128_f32[0]
                    + (float)(_mm_movehl_ps(v16, v18).m128_f32[0] + _mm_shuffle_ps(v18, v18, 85).m128_f32[0]))
                  ^ xmmword_47A9B0;
  return a1;
}

// sub_458FE0 @ 0x00458FE0
void __stdcall sub_458FE0(int a1, int a2, int a3)
{
  JUMPOUT(0x458FF1);
}

// sub_458FEE @ 0x00458FEE
double *__stdcall sub_458FEE(double *a1, __m128 *a2, __m128 *a3)
{
  __m128 v3; // xmm2
  __m128 v4; // xmm3
  __m128 v5; // xmm3
  __m128 v6; // xmm1
  __m128 v7; // xmm0
  CHAR v8; // al
  __m128 v9; // xmm4
  float v10; // xmm3_4
  float v11; // xmm5_4
  double *result; // eax
  __m128 v13; // xmm4
  __m128 v14; // xmm0
  __m128 v15; // xmm0
  __m128 v16; // xmm0
  __m128 v17; // xmm5
  __m128 v18; // xmm6
  float v19; // xmm7_4
  __m128 v20; // xmm0
  __m128 v21; // xmm1
  __m128 v22; // xmm2
  __m128 v23; // xmm3

  v3 = *a3;
  v4 = _mm_and_ps((__m128)xmmword_47AA20, *a3);
  v5 = _mm_mul_ps(v4, v4);
  v6 = _mm_add_ps(v5, _mm_movehl_ps((__m128)0LL, v5));
  v7 = _mm_shuffle_ps(v6, v6, 1);
  v7.m128_f32[0] = v7.m128_f32[0] + v6.m128_f32[0];
  if ( v7.m128_f32[0] != 0.0 )
  {
    v8 = String[96];
    if ( (String[96] & 1) != 0 )
    {
      v9 = *(__m128 *)&String[64];
    }
    else
    {
      v8 = String[96] | 1;
      v9 = (__m128)(unsigned int)dword_4DC220;
      String[96] |= 1u;
      *(_OWORD *)&String[64] = (unsigned int)dword_4DC220;
    }
    if ( (v8 & 2) != 0 )
    {
      v10 = *(float *)&String[80];
    }
    else
    {
      v10 = *(float *)&dword_4DC224;
      String[96] = v8 | 2;
      *(_OWORD *)&String[80] = (unsigned int)dword_4DC224;
    }
    v11 = 1.0 / fsqrt(v7.m128_f32[0]);
    v9.m128_f32[0] = (float)(v9.m128_f32[0] * v11) * (float)(v10 - (float)((float)(v7.m128_f32[0] * v11) * v11));
    v7 = _mm_mul_ps(v3, _mm_shuffle_ps(v9, v9, 0));
  }
  result = a1;
  v13 = _mm_xor_ps((__m128)xmmword_47A9E0, v7);
  v14 = _mm_mul_ps(v7, *a2);
  v15 = _mm_add_ps(v14, _mm_movehl_ps(v6, v14));
  v15.m128_f32[0] = v15.m128_f32[0] + _mm_shuffle_ps(v15, v15, 1).m128_f32[0];
  v16 = _mm_shuffle_ps(v15, v15, 0);
  v17 = _mm_and_ps((__m128)xmmword_47AA00, v16);
  v18 = _mm_and_ps((__m128)xmmword_47AA10, v16);
  v19 = v16.m128_f32[0];
  v20 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v13, v13, 85), *a2), _mm_and_ps((__m128)xmmword_47A9F0, v16));
  v21 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v13, v13, 170), *a2), v17);
  v23 = _mm_mul_ps(_mm_shuffle_ps(v13, v13, 0), *a2);
  v22 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v13, v13, 255), *a2), v18);
  v23.m128_f32[0] = v23.m128_f32[0] + v19;
  if ( ((unsigned __int8)a1 & 0xF) != 0 )
  {
    _mm_storel_ps(a1, v23);
    _mm_storeh_ps(a1 + 1, v23);
    _mm_storel_ps(a1 + 2, v20);
    _mm_storeh_ps(a1 + 3, v20);
    _mm_storel_ps(a1 + 4, v21);
    _mm_storeh_ps(a1 + 5, v21);
    _mm_storel_ps(a1 + 6, v22);
    _mm_storeh_ps(a1 + 7, v22);
  }
  else
  {
    *(__m128 *)a1 = v23;
    *((__m128 *)a1 + 1) = v20;
    *((__m128 *)a1 + 2) = v21;
    *((__m128 *)a1 + 3) = v22;
  }
  return result;
}

// sub_459170 @ 0x00459170
void __stdcall sub_459170(int a1, int a2)
{
  JUMPOUT(0x459181);
}

// sub_45917E @ 0x0045917E
__m128 *__stdcall sub_45917E(__m128 *a1, const double *a2)
{
  __m128 v3; // xmm1
  __m128 v4; // xmm0
  __m128 v5; // xmm3
  __m128 v6; // xmm4
  __m128 v7; // xmm0
  float v8; // xmm5_4
  __m128 v9; // xmm1
  __m128 v10; // xmm4
  __m128 v11; // xmm0
  __m128 v12; // xmm1
  __m128 v13; // xmm2
  __m128 v14; // xmm0
  __m128 v15; // xmm3
  __m128 v16; // xmm2
  __m128 v17; // xmm4

  v3 = _mm_loadl_ps(a2);
  v4 = _mm_and_ps((__m128)xmmword_47AAA0, v3);
  v5 = (__m128)(unsigned int)dword_47AA90;
  v6 = _mm_mul_ps(v4, v4);
  v7 = _mm_add_ps(v6, _mm_movehl_ps(v6, v6));
  v8 = v7.m128_f32[0] + _mm_shuffle_ps(v7, v7, 1).m128_f32[0];
  v7.m128_f32[0] = 1.0 / fsqrt(v8);
  v5.m128_f32[0] = (float)(*(float *)&dword_47AA90 * v7.m128_f32[0])
                 * (float)(*(float *)&dword_47AA80 - (float)((float)(v8 * v7.m128_f32[0]) * v7.m128_f32[0]));
  v9 = _mm_mul_ps(v3, _mm_shuffle_ps(v5, v5, 0));
  v10 = _mm_mul_ps((__m128)xmmword_47AA70, v9);
  v11 = v9;
  v12 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v9, v9, 0), v10), (__m128)xmmword_47AA60);
  v13 = v11;
  v14 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v11, v11, 255), v10), (__m128)xmmword_47AA30);
  v15 = v13;
  v16 = _mm_add_ps(_mm_mul_ps(_mm_shuffle_ps(v13, v13, 170), v10), (__m128)xmmword_47AA40);
  v17 = _mm_add_ps(_mm_mul_ps(v10, _mm_shuffle_ps(v15, v15, 85)), (__m128)xmmword_47AA50);
  *a1 = v12;
  a1[1] = v17;
  a1[2] = v16;
  a1[3] = v14;
  return a1;
}

// sub_459250 @ 0x00459250
float *__stdcall sub_459250(float *a1, float *a2)
{
  float *result; // eax
  double v3; // st7
  float v4; // edi
  float v5; // esi
  int v6; // ebp
  double v7; // st7
  int v8; // ecx
  int v9; // ebx
  int v10; // ebp
  float *v11; // esi
  long double v12; // st6
  long double v13; // st7
  float *v14; // ecx
  long double v15; // st6
  long double v16; // st7
  _DWORD v17[7]; // [esp+0h] [ebp-1Ch]

  result = a1;
  v3 = *a2 + a2[5] + a2[10];
  v4 = *a2;
  v5 = a2[5];
  v6 = *((_DWORD *)a2 + 10);
  if ( flt_4DC27C < v3 )
  {
    v15 = sqrt(v3 + flt_4DC280) * flt_4DC284;
    v16 = flt_4DC288 / v15;
    a1[3] = v15;
    *a1 = (a2[6] - a2[9]) * v16;
    a1[1] = (a2[8] - a2[2]) * v16;
    a1[2] = v16 * (a2[1] - a2[4]);
  }
  else
  {
    v7 = a2[10];
    *(float *)v17 = *a2;
    *(float *)&v17[1] = v5;
    v17[2] = v6;
    v8 = 2;
    if ( *(float *)&v17[v5 > (double)v4] >= v7 )
      v8 = v5 > (double)v4;
    v9 = dword_4DC270[v8];
    v10 = dword_4DC270[v9];
    v11 = &a2[v8];
    v12 = sqrt(flt_4DC290 + *(float *)&v17[v8] - *(float *)&v17[v9] - *(float *)&v17[v10]) * flt_4DC294;
    v13 = flt_4DC298 / v12;
    a1[v8] = v12;
    v14 = &a2[4 * v8];
    a1[v9] = (v14[v9] + v11[4 * v9]) * v13;
    a1[v10] = (v11[4 * v10] + v14[v10]) * v13;
    a1[3] = v13 * (a2[4 * v9 + v10] - a2[4 * v10 + v9]);
  }
  return result;
}

// sub_459370 @ 0x00459370
void __stdcall sub_459370(int a1, int a2, int a3, int a4)
{
  JUMPOUT(0x459381);
}

// sub_45937E @ 0x0045937E
__m128 *__stdcall sub_45937E(__m128 *a1, unsigned int a2, unsigned int a3, unsigned int a4)
{
  __m128 v4; // xmm0
  __m128 v5; // xmm1
  __m128 v6; // xmm3
  __m128 v7; // xmm2
  __m128 v8; // xmm3
  __m128 v10; // [esp+10h] [ebp-4Ch] BYREF
  __m128 v11[3]; // [esp+20h] [ebp-3Ch] BYREF

  v10 = _mm_mul_ps(
          _mm_shuffle_ps(
            _mm_unpacklo_ps((__m128)a3, (__m128)a4),
            _mm_unpacklo_ps((__m128)(unsigned int)dword_4DC2C0, (__m128)a2),
            17),
          (__m128)xmmword_4DC2B0);
  sub_45FEB0(&v10, &v10, v11);
  v4 = _mm_shuffle_ps(v10, v11[0], 0);
  v5 = _mm_shuffle_ps(v4, v4, 138);
  v6 = _mm_shuffle_ps(v10, v11[0], 153);
  v7 = _mm_shuffle_ps(v6, v6, 247);
  v8 = _mm_shuffle_ps(v6, v6, 168);
  v10 = _mm_add_ps(
          _mm_mul_ps(_mm_mul_ps(v5, v7), v8),
          _mm_xor_ps(
            _mm_mul_ps(_mm_mul_ps(_mm_shuffle_ps(v5, v5, 138), _mm_shuffle_ps(v7, v7, 81)), _mm_shuffle_ps(v8, v8, 1)),
            (__m128)xmmword_4DC2A0));
  *a1 = v10;
  return a1;
}

// sub_459440 @ 0x00459440
__m64 *__stdcall sub_459440(__m64 *a1, __m64 *a2, __m64 *a3)
{
  __m64 v3; // mm3
  __m64 v4; // mm1
  __m64 v6; // mm6
  __m64 v7; // mm7
  unsigned __int64 v8; // mm4
  __m64 v9; // mm6
  __m64 v10; // mm5
  __m64 v11; // mm3

  v3 = a3[1];
  v4 = a2[1];
  v6 = _m_punpckldq(_m_punpckhdq((__m64)a3->m64_u64, (__m64)a3->m64_u64), (__m64)a3->m64_u64);
  v7 = _m_punpckldq(_m_punpckhdq(v3, v3), v3);
  v8 = (unsigned __int64)_m_pfacc(
                           _m_pfsub(_m_pfmul(v6, v4), _m_pfmul(_m_pxor(v7, (__m64)0x80000000LL), (__m64)a2->m64_u64)),
                           _m_pfadd(
                             _m_pxor(_m_pfmul((__m64)a3->m64_u64, v4), (__m64)0x80000000LL),
                             _m_pfmul(v3, (__m64)a2->m64_u64)));
  v9 = _m_pfmul(_m_pxor(v6, (__m64)0x80000000LL), (__m64)a2->m64_u64);
  v10 = _m_pxor(v3, (__m64)0x80000000LL);
  v11 = _m_pfmul((__m64)a3->m64_u64, (__m64)a2->m64_u64);
  a1->m64_u64 = v8;
  a1[1].m64_u64 = (unsigned __int64)_m_pfacc(_m_pfadd(v9, _m_pfmul(v7, v4)), _m_pfsub(_m_pfmul(v10, v4), v11));
  _m_femms();
  return a1;
}

// sub_4594D9 @ 0x004594D9
__m64 *__stdcall sub_4594D9(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm3
  __m64 v3; // mm0
  __m64 v5; // mm0
  __m64 v6; // mm4
  __m64 v7; // mm5
  __m64 v8; // mm0

  v2 = a2[1];
  v3 = _m_pfadd(_m_pfmul((__m64)a2->m64_u64, (__m64)a2->m64_u64), _m_pfmul(v2, v2));
  v5 = _m_pfacc(v3, v3);
  v6 = _m_pfrsqrt(v5);
  v7 = _m_pfcmpgt(v5, (__m64)0x80000000800000LL);
  v8 = _m_pfrcpit2(_m_pfrsqit1(v5, _m_pfmul(v6, v6)), v6);
  a1->m64_u64 = (unsigned __int64)_m_pfmul(_m_pand((__m64)a2->m64_u64, v7), v8);
  a1[1].m64_u64 = (unsigned __int64)_m_pfmul(_m_pand(v2, v7), v8);
  _m_femms();
  return a1;
}

// sub_459536 @ 0x00459536
int __stdcall sub_459536(__m64 *a1, int a2, _DWORD *a3)
{
  __m64 m64_u64; // mm2
  __m64 v4; // mm0
  __m64 v5; // mm5
  __m64 v6; // mm5
  __m64 v7; // mm1
  int result; // eax
  __m64 v9; // mm4
  __m64 v10; // mm1
  __m64 v11; // mm1

  m64_u64 = (__m64)a1->m64_u64;
  v4 = a1[1];
  v5 = _m_pfadd(_m_pfmul(m64_u64, m64_u64), _m_pfmul(v4, v4));
  v6 = _m_pfacc(v5, v5);
  v7 = _m_pfrsqrt(v6);
  result = _mm_cvtsi64_si32(_m_pfcmpge((__m64)0x80000000800000LL, v6));
  v9 = v7;
  if ( result )
  {
    if ( a2 )
    {
      *(_QWORD *)(a2 + 4) = 0;
      *(_DWORD *)a2 = _mm_cvtsi64_si32((__m64)0xBF8000003F800000uLL);
    }
    if ( a3 )
      *a3 = _mm_cvtsi64_si32(0);
  }
  else
  {
    v10 = _m_pfmul(v7, v7);
    if ( a2 )
    {
      v11 = _m_pfrcpit2(_m_pfrsqit1(v10, v6), v9);
      *(__m64 *)a2 = _m_pfmul(m64_u64, v11);
      *(_DWORD *)(a2 + 8) = _mm_cvtsi64_si32(_m_pfmul(v11, v4));
    }
    if ( a3 )
    {
      result = math_acos_packed(a3, a2);
      *a3 = _mm_cvtsi64_si32(_m_pfmul(_m_punpckhdq(v4, v4), (__m64)0x4000000040000000LL));
    }
  }
  _m_femms();
  return result;
}

// sub_4595E9 @ 0x004595E9
__m64 *__stdcall sub_4595E9(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm4
  __m64 v3; // mm5
  __m64 v4; // mm3
  __m64 v5; // mm0
  __m64 v6; // mm1
  __m64 v7; // mm2
  __m64 v8; // mm5
  __m64 v9; // mm3
  __m64 v10; // mm0
  __m64 v11; // mm3
  __m64 v12; // mm6
  int v13; // ecx
  __m64 v14; // mm0
  __m64 v15; // mm7
  __m64 v16; // mm2
  __m64 v17; // mm0
  __m64 v18; // mm4
  __m64 *result; // eax
  __m64 v20; // mm1
  __m64 v21; // mm1
  __m64 v22; // mm0
  __m64 v23; // mm1
  __m64 v24; // mm4
  __m64 v25; // mm1
  __m64 v26; // mm2
  __m64 v27; // mm0
  __m64 v28; // mm2
  __m64 v29; // mm4
  __m64 v30; // mm1
  __m64 v31; // mm3
  __m64 v32; // mm0
  __m64 v33; // mm3
  __m64 v34; // mm2
  __m64 v35; // mm3

  v2 = _mm_cvtsi32_si64(a2[2].m64_u32[1]);
  v3 = _mm_cvtsi32_si64(a2[5].m64_u32[0]);
  v4 = _m_pfsubr((__m64)a2->m64_u64, v3);
  v5 = _m_pfadd(_m_pfadd((__m64)a2->m64_u64, v2), v3);
  v6 = _m_pfsub(_m_pfsub((__m64)a2->m64_u64, v2), v3);
  v7 = _m_pfsub(_m_pfsubr((__m64)a2->m64_u64, v2), v3);
  v8 = a2[4];
  v9 = _m_pfsub(v4, v2);
  v10 = _m_punpckldq(v5, v7);
  v11 = _m_punpckldq(v9, v9);
  v12 = _m_packssdw(_m_pfcmpge(_m_punpckldq(0, v6), v10), _m_pfcmpge(_m_punpckldq(v7, v6), v11));
  v13 = _mm_cvtsi64_si32(_m_packsswb(v12, v12));
  if ( (v13 & 1) != 0 )
  {
    if ( (v13 & 0xFF00FF00) == 0xFF00FF00 )
    {
      v21 = _m_pfadd(v6, (__m64)0xBF8000003F800000uLL);
      v22 = _m_pfrsqrt(v21);
      v23 = _m_punpckldq(v21, v21);
      v24 = _m_pfmul(_m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v22, v22), v23), v22), (__m64)0x3F0000003F000000LL);
      v25 = _m_punpckldq(
              _m_pfmul(v23, v24),
              _m_pfmul(_m_pfsub(_mm_cvtsi32_si64(a2[2].m64_u32[0]), _m_punpckhdq(v7, v7)), v24));
      a1[1].m64_u64 = (unsigned __int64)_m_pfmul(
                                          _m_pfadd(
                                            _m_punpckldq(v8, (__m64)a2[3].m64_u32[0]),
                                            _m_pxor(
                                              _m_punpckldq(_mm_cvtsi32_si64(a2[1].m64_u32[0]), _m_punpckhdq(v8, v8)),
                                              (__m64)0x8000000000000000uLL)),
                                          v24);
      a1->m64_u64 = (unsigned __int64)v25;
      _m_femms();
      return a1;
    }
    else
    {
      result = a1;
      if ( (v13 & 0x10000) != 0 )
      {
        v26 = _m_pfadd(v7, (__m64)0xBF8000003F800000uLL);
        v27 = _m_pfrsqrt(v26);
        v28 = _m_punpckldq(v26, v26);
        v29 = _m_pfmul(_m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v27, v27), v28), v27), (__m64)0x3F0000003F000000LL);
        v30 = _m_punpckldq(
                _m_pfmul(_m_pfadd(_m_punpckhdq(v6, v6), _mm_cvtsi32_si64(a2[2].m64_u32[0])), v29),
                _m_pfmul(v28, v29));
        a1[1].m64_u64 = (unsigned __int64)_m_pfmul(
                                            _m_pfadd(
                                              _m_punpckldq(_mm_cvtsi32_si64(a2[3].m64_u32[0]), v8),
                                              _m_pxor(
                                                _m_punpckldq(_m_punpckhdq(v8, v8), (__m64)a2[1].m64_u32[0]),
                                                (__m64)0x8000000000000000uLL)),
                                            v29);
        a1->m64_u64 = (unsigned __int64)v30;
      }
      else
      {
        v31 = _m_pfadd(v11, (__m64)0xBF8000003F800000uLL);
        v32 = _m_pfrsqrt(v31);
        v33 = _m_punpckldq(v31, v31);
        v34 = _m_pfmul(_m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v32, v32), v33), v32), (__m64)0x3F0000003F000000LL);
        v35 = _m_punpckldq(
                _m_pfmul(v33, v34),
                _m_pfmul(_m_pfsub(_m_punpckhdq(v6, v6), _mm_cvtsi32_si64(a2[2].m64_u32[0])), v34));
        a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                          _m_pfadd(
                                            _m_punpckldq(v8, (__m64)a2[3].m64_u32[0]),
                                            _m_punpckldq(_mm_cvtsi32_si64(a2[1].m64_u32[0]), _m_punpckhdq(v8, v8))),
                                          v34);
        a1[1].m64_u64 = (unsigned __int64)v35;
      }
      _m_femms();
    }
  }
  else
  {
    v14 = _m_pfadd(v10, (__m64)0xBF8000003F800000uLL);
    v15 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
    v16 = _m_pfrsqrt(v14);
    v17 = _m_punpckldq(v14, v14);
    v18 = _m_pfmul(_m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v16, v16), v17), v16), (__m64)0x3F0000003F000000LL);
    v20 = _m_punpckldq(
            _m_pfmul(_m_pfsub(_m_punpckhdq(v6, v6), _mm_cvtsi32_si64(a2[2].m64_u32[0])), v18),
            _m_pfmul(v17, v18));
    a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                      _m_pfsub(
                                        _m_punpckldq(_mm_cvtsi32_si64(a2[3].m64_u32[0]), v8),
                                        _m_punpckhdq(v8, _m_punpckldq(v15, v15))),
                                      v18);
    a1[1].m64_u64 = (unsigned __int64)v20;
    _m_femms();
    return a1;
  }
  return result;
}

// sub_459805 @ 0x00459805
__m64 *__stdcall sub_459805(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm4
  __m64 v3; // mm5
  __m64 v4; // mm3
  __m64 v5; // mm0
  __m64 v6; // mm1
  __m64 v7; // mm2
  __m64 v8; // mm5
  __m64 v9; // mm3
  __m64 v10; // mm0
  __m64 v11; // mm3
  char v12; // cl
  __m64 v13; // mm0
  __m64 v14; // mm7
  __m64 v15; // mm2
  __m64 v16; // mm0
  __m64 v17; // mm4
  __m64 *result; // eax
  __m64 v19; // mm1
  __m64 v20; // mm1
  __m64 v21; // mm0
  __m64 v22; // mm1
  __m64 v23; // mm4
  __m64 v24; // mm1
  __m64 v25; // mm2
  __m64 v26; // mm0
  __m64 v27; // mm2
  __m64 v28; // mm4
  __m64 v29; // mm1
  __m64 v30; // mm3
  __m64 v31; // mm0
  __m64 v32; // mm3
  __m64 v33; // mm2
  __m64 v34; // mm3

  v2 = _mm_cvtsi32_si64(a2[2].m64_u32[1]);
  v3 = _mm_cvtsi32_si64(a2[5].m64_u32[0]);
  v4 = _m_pfsubr((__m64)a2->m64_u64, v3);
  v5 = _m_pfadd(_m_pfadd((__m64)a2->m64_u64, v2), v3);
  v6 = _m_pfsub(_m_pfsub((__m64)a2->m64_u64, v2), v3);
  v7 = _m_pfsub(_m_pfsubr((__m64)a2->m64_u64, v2), v3);
  v8 = a2[4];
  v9 = _m_pfsub(v4, v2);
  v10 = _m_punpckldq(v5, v7);
  v11 = _m_punpckldq(v9, v9);
  v12 = _m_pmovmskb(_m_packssdw(_m_pfcmpge(_m_punpckldq(0, v6), v10), _m_pfcmpge(_m_punpckldq(v7, v6), v11)));
  if ( (v12 & 1) != 0 )
  {
    if ( (v12 & 0xCC) == 0xCC )
    {
      v20 = _m_pfadd(v6, (__m64)0xBF8000003F800000uLL);
      v21 = _m_pfrsqrt(v20);
      v22 = _m_punpckldq(v20, v20);
      v23 = _m_pfmul(_m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v21, v21), v22), v21), (__m64)0x3F0000003F000000LL);
      v24 = _m_punpckldq(
              _m_pfmul(v22, v23),
              _m_pfmul(_m_pfsub(_mm_cvtsi32_si64(a2[2].m64_u32[0]), _m_punpckhdq(v7, v7)), v23));
      a1[1].m64_u64 = (unsigned __int64)_m_pfmul(
                                          _m_pfadd(
                                            _m_punpckldq(v8, (__m64)a2[3].m64_u32[0]),
                                            _m_pxor(
                                              _m_punpckldq(_mm_cvtsi32_si64(a2[1].m64_u32[0]), _m_punpckhdq(v8, v8)),
                                              (__m64)0x8000000000000000uLL)),
                                          v23);
      a1->m64_u64 = (unsigned __int64)v24;
      _m_femms();
      return a1;
    }
    else
    {
      result = a1;
      if ( (v12 & 0x10) != 0 )
      {
        v25 = _m_pfadd(v7, (__m64)0xBF8000003F800000uLL);
        v26 = _m_pfrsqrt(v25);
        v27 = _m_punpckldq(v25, v25);
        v28 = _m_pfmul(_m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v26, v26), v27), v26), (__m64)0x3F0000003F000000LL);
        v29 = _m_punpckldq(
                _m_pfmul(_m_pfadd(_m_punpckhdq(v6, v6), _mm_cvtsi32_si64(a2[2].m64_u32[0])), v28),
                _m_pfmul(v27, v28));
        a1[1].m64_u64 = (unsigned __int64)_m_pfmul(
                                            _m_pfadd(
                                              _m_punpckldq(_mm_cvtsi32_si64(a2[3].m64_u32[0]), v8),
                                              _m_pxor(
                                                _m_punpckldq(_m_punpckhdq(v8, v8), (__m64)a2[1].m64_u32[0]),
                                                (__m64)0x8000000000000000uLL)),
                                            v28);
        a1->m64_u64 = (unsigned __int64)v29;
      }
      else
      {
        v30 = _m_pfadd(v11, (__m64)0xBF8000003F800000uLL);
        v31 = _m_pfrsqrt(v30);
        v32 = _m_punpckldq(v30, v30);
        v33 = _m_pfmul(_m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v31, v31), v32), v31), (__m64)0x3F0000003F000000LL);
        v34 = _m_punpckldq(
                _m_pfmul(v32, v33),
                _m_pfmul(_m_pfsub(_m_punpckhdq(v6, v6), _mm_cvtsi32_si64(a2[2].m64_u32[0])), v33));
        a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                          _m_pfadd(
                                            _m_punpckldq(v8, (__m64)a2[3].m64_u32[0]),
                                            _m_punpckldq(_mm_cvtsi32_si64(a2[1].m64_u32[0]), _m_punpckhdq(v8, v8))),
                                          v33);
        a1[1].m64_u64 = (unsigned __int64)v34;
      }
      _m_femms();
    }
  }
  else
  {
    v13 = _m_pfadd(v10, (__m64)0xBF8000003F800000uLL);
    v14 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
    v15 = _m_pfrsqrt(v13);
    v16 = _m_punpckldq(v13, v13);
    v17 = _m_pfmul(_m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v15, v15), v16), v15), (__m64)0x3F0000003F000000LL);
    v19 = _m_punpckldq(
            _m_pfmul(_m_pfsub(_m_punpckhdq(v6, v6), _mm_cvtsi32_si64(a2[2].m64_u32[0])), v17),
            _m_pfmul(v16, v17));
    a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                      _m_pfsub(
                                        _m_punpckldq(_mm_cvtsi32_si64(a2[3].m64_u32[0]), v8),
                                        _m_punpckhdq(v8, _m_punpckldq(v14, v14))),
                                      v17);
    a1[1].m64_u64 = (unsigned __int64)v19;
    _m_femms();
    return a1;
  }
  return result;
}

// sub_459A1A @ 0x00459A1A
__m64 *__userpurge sub_459A1A@<eax>(__m64 *a1, __m64 a2, __m64 a3)
{
  __m64 v3; // mm1
  __m64 v5; // mm6
  __m64 v6; // mm2
  __m64 v7; // mm6
  __m64 v8; // mm7
  __m64 v9; // [esp+10h] [ebp-10h]

  _m_femms();
  v9 = _m_pfmul((__m64)0x3F0000003F000000LL, a2);
  math_sincos_packed();
  math_sincos_packed();
  math_sincos_packed();
  v3 = _m_pfmul((__m64)0x3F0000003F000000LL, a3);
  v5 = _m_punpckhdq(v9, v9);
  v6 = _m_punpckldq(v5, v5);
  v7 = _m_punpckhdq(v5, v5);
  v8 = _m_punpckldq(_m_punpckhdq(v3, v3), v3);
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfmul(
                                      _m_pfmul(_m_pxor(_m_punpckldq(v9, v9), (__m64)0x8000000000000000uLL), v7),
                                      v3),
                                    _m_pfmul(_m_pfmul(_m_punpckhdq(v9, v9), v6), v8));
  a1[1].m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfmul(_m_pfmul(_m_punpckldq(v9, v9), v6), v8),
                                      _m_pfmul(
                                        _m_pfmul(
                                          _m_pxor(_m_punpckhdq(v9, v9), _m_psrlqi((__m64)0x8000000000000000uLL, 0x20u)),
                                          v7),
                                        v3));
  _m_femms();
  return a1;
}

// sub_459ADF @ 0x00459ADF
__m64 *__stdcall sub_459ADF(__m64 *a1, int a2, unsigned int a3)
{
  __m64 v3; // mm0
  __m64 v5; // mm3
  __m64 v6; // mm2
  __m64 v7; // [esp+0h] [ebp-18h] BYREF
  unsigned int v8; // [esp+8h] [ebp-10h]

  _m_femms();
  sub_45E832((int)&v7, a2);
  v3 = _m_pfmul(_mm_cvtsi32_si64(a3), (__m64)0x3F0000003F000000LL);
  math_sincos_packed();
  v5 = _m_punpckhdq(v3, v3);
  v6 = _m_punpckldq(_m_pfmul(_mm_cvtsi32_si64(v8), v5), v3);
  a1->m64_u64 = (unsigned __int64)_m_pfmul(v7, v5);
  a1[1].m64_u64 = (unsigned __int64)v6;
  _m_femms();
  return a1;
}

// sub_459B4B @ 0x00459B4B
__m64 *__stdcall sub_459B4B(__m64 *a1, __m64 *a2, __m64 *a3, unsigned int a4)
{
  __m64 v4; // mm1
  __m64 v5; // mm4
  __m64 v6; // mm0
  __m64 v7; // mm1
  __m64 v8; // mm7
  __m64 v9; // mm1
  __m64 v10; // mm3
  __m64 v11; // mm4
  __m64 v12; // mm0
  __m64 v13; // mm1
  __m64 v15; // mm4
  __m64 v16; // mm5
  __m64 v17; // mm6
  __m64 v18; // mm0
  __m64 v19; // mm5
  unsigned int v20; // [esp+28h] [ebp+10h]

  _m_femms();
  v4 = _m_pfadd(_m_pfmul((__m64)a2->m64_u64, (__m64)a3->m64_u64), _m_pfmul(a2[1], a3[1]));
  v5 = _mm_cvtsi32_si64(a4);
  v6 = _m_pfsub(_mm_cvtsi32_si64(0x3F800000u), v5);
  v7 = _m_pfacc(v4, v4);
  v8 = _m_pand(_m_pfcmpge(0, v7), (__m64)0x8000000080000000uLL);
  v9 = _m_pxor(v7, v8);
  v10 = _m_pfsubr(_m_pfmul(v9, v9), (__m64)0x3F8000003F800000LL);
  if ( _mm_cvtsi64_si32(_m_pfcmpge((__m64)0x3F7FFF583F7FFF58LL, v9)) )
  {
    v11 = _m_pfrsqrt(v10);
    math_atan2_packed();
    math_sin_packed();
    v20 = _mm_cvtsi64_si32(_m_pfmul(v9, _mm_cvtsi32_si64(a4)));
    v12 = _m_pfmul(_mm_cvtsi32_si64(_mm_cvtsi64_si32(v9)), _mm_cvtsi32_si64(_mm_cvtsi64_si32(v6)));
    math_sin_packed();
    v13 = _mm_cvtsi32_si64(_mm_cvtsi64_si32(_m_pfrcpit2(_m_pfrsqit1(v10, _m_pfmul(v11, v11)), v11)));
    v8 = _mm_cvtsi32_si64(_mm_cvtsi64_si32(v8));
    v6 = _m_pfmul(v12, v13);
    v5 = _m_pfmul(_mm_cvtsi32_si64(v20), v13);
  }
  v15 = _m_pxor(v5, v8);
  v16 = _m_punpckldq(v6, v6);
  v17 = _m_punpckldq(v15, v15);
  v18 = _m_pfmul(v16, (__m64)a2->m64_u64);
  v19 = _m_pfadd(_m_pfmul(v16, a2[1]), _m_pfmul(v17, a3[1]));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(v18, _m_pfmul(v17, (__m64)a3->m64_u64));
  a1[1].m64_u64 = (unsigned __int64)v19;
  _m_femms();
  return a1;
}

// sub_459C82 @ 0x00459C82
__m64 *__stdcall sub_459C82(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, unsigned int a5, unsigned int a6)
{
  __m64 v6; // mm0
  __m64 v7; // mm2
  __m64 v9[2]; // [esp+Ch] [ebp-24h] BYREF
  __m64 v10[2]; // [esp+1Ch] [ebp-14h] BYREF
  unsigned int v11; // [esp+44h] [ebp+14h]

  _m_femms();
  v11 = _mm_cvtsi64_si32(_m_pfadd(_mm_cvtsi32_si64(a5), _mm_cvtsi32_si64(a6)));
  sub_459B4B(v9, a2, a3, v11);
  sub_459B4B(v10, a2, a4, v11);
  v6 = _mm_cvtsi32_si64(v11);
  v7 = _m_pfrcp(v6);
  sub_459B4B(a1, v9, v10, _mm_cvtsi64_si32(_m_pfmul(_m_pfrcpit2(_m_pfrcpit1(v6, v7), v7), _mm_cvtsi32_si64(a6))));
  _m_femms();
  return a1;
}

// sub_459D0F @ 0x00459D0F
__m64 *__stdcall sub_459D0F(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, unsigned int a6)
{
  __m64 v6; // mm1
  __m64 *result; // eax
  __m64 v8[2]; // [esp+10h] [ebp-20h] BYREF
  __m64 v9[2]; // [esp+20h] [ebp-10h] BYREF

  sub_459B4B(v8, a2, a5, a6);
  sub_459B4B(v9, a3, a4, a6);
  v6 = _mm_cvtsi32_si64(a6);
  result = sub_459B4B(
             a1,
             v8,
             v9,
             _mm_cvtsi64_si32(_m_pfmul(_m_pfsub(v6, _m_pfmul(v6, v6)), (__m64)0x4000000040000000LL)));
  _m_femms();
  return result;
}

// sub_459DA1 @ 0x00459DA1
__m64 *__stdcall sub_459DA1(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm3
  __m64 v3; // mm0
  __m64 v4; // mm0
  __m64 v6; // mm4
  __m64 v7; // mm5
  __m64 v8; // mm0

  v2 = a2[1];
  v3 = _m_pfadd(_m_pfmul((__m64)a2->m64_u64, (__m64)a2->m64_u64), _m_pfmul(v2, v2));
  v4 = _m_pfacc(v3, v3);
  v6 = _m_pfrcp(v4);
  v7 = _m_pfcmpgt(v4, (__m64)0x80000000800000LL);
  v8 = _m_pfrcpit2(_m_pfrcpit1(v4, v6), v6);
  a1->m64_u64 = (unsigned __int64)_m_pfmul(_m_pand(_m_pxor((__m64)a2->m64_u64, (__m64)0x8000000080000000uLL), v7), v8);
  a1[1].m64_u64 = (unsigned __int64)_m_pfmul(_m_pand(_m_pxor(v2, (__m64)0x80000000LL), v7), v8);
  _m_femms();
  return a1;
}

// sub_459E05 @ 0x00459E05
__m64 *__stdcall sub_459E05(__m64 *a1, __m64 *a2)
{
  __m64 *result; // eax
  __m64 m64_u64; // mm1
  __m64 v4; // mm2
  __m64 v5; // mm0
  __m64 v6; // mm3
  __m64 v7; // mm4
  __m64 v8; // mm3
  unsigned int v9; // [esp+0h] [ebp-Ch]

  _m_femms();
  result = a1;
  m64_u64 = (__m64)a2->m64_u64;
  v4 = a2[1];
  v5 = _m_punpckhdq(v4, v4);
  if ( !_mm_cvtsi64_si32(_m_pfcmpge(v5, (__m64)0x3F8000003F800000LL)) )
  {
    math_acos_packed(0, a2);
    v9 = _mm_cvtsi64_si32(v5);
    math_sin_packed();
    result = a1;
    m64_u64 = (__m64)a2->m64_u64;
    v4 = a2[1];
    if ( _mm_cvtsi64_si32(_m_pfcmpge(_m_pand(v5, (__m64)0x7FFFFFFF7FFFFFFFLL), (__m64)0x3400000034000000LL)) )
    {
      v6 = _mm_cvtsi32_si64(v9);
      v7 = _m_pfrcp(v5);
      v8 = _m_pfmul(_m_punpckldq(v6, v6), _m_pfrcpit2(_m_pfrcpit1(v5, v7), v7));
      m64_u64 = _m_pfmul(m64_u64, v8);
      v4 = _m_pfmul(v4, v8);
    }
  }
  result->m64_u64 = (unsigned __int64)m64_u64;
  result[1].m64_u64 = (unsigned __int64)_m_pand(v4, (__m64)0xFFFFFFFFLL);
  _m_femms();
  return result;
}

// sub_459EAC @ 0x00459EAC
__m64 *__userpurge sub_459EAC@<eax>(unsigned int a1@<esi>, __m64 *a2, __m64 *a3)
{
  __m64 v3; // mm1
  __m64 v4; // mm0
  __m64 v5; // mm0
  __m64 v6; // mm2
  __m64 v7; // mm1
  __m64 v8; // mm1
  __m64 v9; // mm0
  __m64 *result; // eax
  char v11; // cl
  __m64 m64_u64; // mm2
  __m64 v13; // mm0
  __m64 v14; // mm1
  __m64 v15; // mm3
  __m64 v16; // mm1
  __m64 v17; // [esp+0h] [ebp-Ch]

  v3 = _mm_cvtsi32_si64(a3[1].m64_u32[0]);
  v4 = _m_pfadd(_m_pfmul((__m64)a3->m64_u64, (__m64)a3->m64_u64), _m_pfmul(v3, v3));
  v5 = _m_pfacc(v4, v4);
  v6 = _m_pfrsqrt(v5);
  v7 = _m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v6, v6), v5), v6);
  v17.m64_u64 = __PAIR64__(a1, _mm_cvtsi64_si32(v7));
  math_sincos_packed();
  v8 = _m_pfmul(v5, v7);
  v9 = _m_pfcmpge(_m_pand(v8, (__m64)0x7FFFFFFFFFFFFFFFLL), (__m64)0x3400000034000000LL);
  result = a2;
  v11 = _mm_cvtsi64_si32(_m_punpckhdq(v9, v9));
  m64_u64 = (__m64)a3->m64_u64;
  v13 = v8;
  v14 = _m_pfmul(_m_punpckhdq(v8, v8), v17);
  v15 = _mm_cvtsi32_si64(a3[1].m64_u32[0]);
  if ( (v11 & 1) != 0 )
  {
    v16 = _m_punpckldq(v14, v14);
    v15 = _m_pfmul(v15, v16);
    m64_u64 = _m_pfmul(m64_u64, v16);
  }
  a2->m64_u64 = (unsigned __int64)m64_u64;
  a2[1].m64_u64 = (unsigned __int64)_m_punpckldq(v15, v13);
  _m_femms();
  return result;
}

// sub_459F51 @ 0x00459F51
__m64 *__userpurge sub_459F51@<eax>(
        unsigned int a1@<esi>,
        __m64 *a2,
        __m64 *a3,
        __m64 *a4,
        __m64 *a5,
        __m64 *a6,
        __m64 *a7,
        __m64 *a8)
{
  __m64 v8; // mm0
  __m64 v9; // mm1
  __m64 v10; // mm2
  __m64 v11; // mm3
  __m64 *v12; // edx
  __m64 v13; // mm0
  __m64 v14; // mm2
  __m64 v15; // mm4
  __m64 v16; // mm5
  __m64 v17; // mm1
  __m64 v18; // mm3
  __m64 v19; // mm2
  int v20; // eax
  __m64 v21; // mm4
  __m64 v22; // mm6
  __m64 v23; // mm7
  __m64 v24; // mm3
  __m64 v25; // mm5
  __m64 v26; // mm6
  __m64 v27; // mm3
  __m64 v28; // mm0
  __m64 v29; // mm0
  __m64 v30; // mm4
  __m64 v31; // mm5
  __m64 v32; // mm0
  __m64 v33; // mm6
  __m64 v34; // mm7
  __m64 v35; // mm6
  __m64 v36; // mm7
  __m64 v37; // mm1
  __m64 v38; // mm2
  __m64 v39; // mm0
  __m64 v40; // mm3
  __m64 v41; // mm4
  __m64 v42; // mm3
  __m64 v43; // mm1
  __m64 v44; // mm2
  __m64 v45; // mm0
  __m64 v46; // mm3
  __m64 v47; // mm4
  __m64 v48; // mm3
  __m64 v49; // mm1
  __m64 v50; // mm0
  __m64 v51; // mm0
  __m64 v52; // mm2
  __m64 v53; // mm1
  __int32 v54; // edx
  __m64 v55; // mm1
  __m64 v56; // mm0
  char v57; // cl
  __m64 v58; // mm2
  __m64 v59; // mm0
  __m64 v60; // mm1
  __m64 v61; // mm3
  __m64 v62; // mm1
  __m64 v63; // mm6
  __m64 v64; // mm7
  __m64 v65; // mm0
  __m64 v66; // mm0
  __m64 v67; // mm4
  __m64 v68; // mm5
  __m64 v69; // mm0
  __m64 v70; // mm6
  __m64 v71; // mm7
  __m64 v72; // mm6
  __m64 v73; // mm7
  __m64 v74; // mm1
  __m64 v75; // mm2
  __m64 v76; // mm0
  __m64 v77; // mm3
  __m64 v78; // mm4
  __m64 v79; // mm3
  __m64 v80; // mm1
  __m64 v81; // mm2
  __m64 v82; // mm0
  __m64 v83; // mm3
  __m64 v84; // mm4
  __m64 v85; // mm3
  __m64 v86; // mm1
  __m64 v87; // mm0
  __m64 v88; // mm0
  __m64 v89; // mm2
  __m64 v90; // mm1
  __m64 v91; // mm1
  __m64 v92; // mm0
  char v93; // cl
  __m64 v94; // mm2
  __m64 v95; // mm0
  __m64 v96; // mm1
  __m64 v97; // mm3
  __m64 v98; // mm1
  __m64 v99; // mm6
  __m64 v100; // mm7
  unsigned int v102; // [esp+0h] [ebp-ACh]
  unsigned int v103; // [esp+0h] [ebp-ACh]
  __m64 v104; // [esp+0h] [ebp-ACh]
  unsigned int v105; // [esp+0h] [ebp-ACh]
  unsigned int v106; // [esp+0h] [ebp-ACh]
  __m64 v107; // [esp+0h] [ebp-ACh]
  __m64 m64_u64; // [esp+Ch] [ebp-A0h]
  __m64 v109; // [esp+14h] [ebp-98h]
  __m64 v110; // [esp+1Ch] [ebp-90h]
  __m64 v111; // [esp+24h] [ebp-88h]
  __m64 v112; // [esp+2Ch] [ebp-80h]
  __m64 v113; // [esp+34h] [ebp-78h]
  __m64 v114; // [esp+3Ch] [ebp-70h]
  __m64 v115; // [esp+44h] [ebp-68h]
  __m64 v116; // [esp+4Ch] [ebp-60h]
  __m64 v117; // [esp+4Ch] [ebp-60h]
  __m64 v118; // [esp+54h] [ebp-58h]
  __m64 v119; // [esp+54h] [ebp-58h]
  __m64 v120; // [esp+5Ch] [ebp-50h]
  __m64 v121; // [esp+5Ch] [ebp-50h]
  __m64 v122; // [esp+64h] [ebp-48h]
  __m64 v123; // [esp+64h] [ebp-48h]
  __m64 v124; // [esp+84h] [ebp-28h]
  __m64 v125; // [esp+84h] [ebp-28h]
  __m64 v126; // [esp+8Ch] [ebp-20h]
  __m64 v127; // [esp+8Ch] [ebp-20h]
  __m64 v128; // [esp+8Ch] [ebp-20h]
  __m64 v129; // [esp+8Ch] [ebp-20h]
  __m64 v130; // [esp+94h] [ebp-18h]
  unsigned int v131; // [esp+94h] [ebp-18h]
  __m64 v132; // [esp+94h] [ebp-18h]
  unsigned int v133; // [esp+94h] [ebp-18h]
  __m64 v134; // [esp+9Ch] [ebp-10h]
  __m64 v135; // [esp+9Ch] [ebp-10h]
  __m64 v136; // [esp+A4h] [ebp-8h]
  __m64 v137; // [esp+A4h] [ebp-8h]

  m64_u64 = (__m64)a5->m64_u64;
  v109 = a5[1];
  v110 = (__m64)a6->m64_u64;
  v8 = _m_pfadd((__m64)a5->m64_u64, (__m64)a6->m64_u64);
  v111 = a6[1];
  v9 = _m_pfadd(v109, v111);
  v10 = _m_pfsub((__m64)a5->m64_u64, (__m64)a6->m64_u64);
  v11 = _m_pfsub(v109, v111);
  v12 = a7;
  v13 = _m_pfadd(_m_pfmul(v8, v8), _m_pfmul(v9, v9));
  v14 = _m_pfadd(_m_pfmul(v10, v10), _m_pfmul(v11, v11));
  v112 = (__m64)a7->m64_u64;
  v113 = a7[1];
  v15 = _m_pfadd((__m64)a6->m64_u64, (__m64)a7->m64_u64);
  v16 = _m_pfadd(v111, v113);
  v17 = _m_pfsub((__m64)a6->m64_u64, (__m64)a7->m64_u64);
  v18 = _m_pfsub(v111, v113);
  v19 = _m_pfcmpgt(
          _m_pfacc(v14, _m_pfadd(_m_pfmul(v17, v17), _m_pfmul(v18, v18))),
          _m_pfacc(v13, _m_pfadd(_m_pfmul(v15, v15), _m_pfmul(v16, v16))));
  v20 = _mm_cvtsi64_si32(_m_packsswb(v19, v19));
  if ( (v20 & 1) != 0 )
  {
    v12 = a5;
    m64_u64 = _m_pxor((__m64)0x8000000080000000uLL, (__m64)a5->m64_u64);
    v109 = _m_pxor((__m64)0x8000000080000000uLL, a5[1]);
  }
  if ( (v20 & 0x10000) != 0 )
  {
    v112 = _m_pxor((__m64)0x8000000080000000uLL, (__m64)a7->m64_u64);
    v113 = _m_pxor((__m64)0x8000000080000000uLL, a7[1]);
  }
  v21 = a8[1];
  v22 = _m_pfadd(v112, (__m64)a8->m64_u64);
  v114 = (__m64)a8->m64_u64;
  v23 = _m_pfadd(v113, v21);
  v115 = v21;
  v24 = _m_pfsub(v112, (__m64)a8->m64_u64);
  v25 = _m_pfsub(v113, v21);
  v26 = _m_pfadd(_m_pfmul(v22, v22), _m_pfmul(v23, v23));
  v27 = _m_pfadd(_m_pfmul(v24, v24), _m_pfmul(v25, v25));
  if ( (_mm_cvtsi64_si32(_m_pfcmpgt(_m_pfacc(v27, v27), _m_pfacc(v26, v26))) & 1) != 0 )
  {
    v12 = a8;
    v114 = _m_pxor((__m64)0x8000000080000000uLL, (__m64)a8->m64_u64);
    v115 = _m_pxor((__m64)0x8000000080000000uLL, a8[1]);
  }
  v28 = _m_pfadd(_m_pfmul(v110, v110), _m_pfmul(v111, v111));
  v29 = _m_pfacc(v28, v28);
  v30 = _m_pfrcp(v29);
  v31 = _m_pfcmpgt(v29, (__m64)0x80000000800000LL);
  v32 = _m_pfrcpit2(_m_pfrcpit1(v29, v30), v30);
  v116 = _m_pfmul(_m_pand(_m_pxor(v110, (__m64)0x8000000080000000uLL), v31), v32);
  v118 = _m_pfmul(_m_pand(_m_pxor(v111, (__m64)0x80000000LL), v31), v32);
  v33 = _m_punpckldq(_m_punpckhdq(m64_u64, m64_u64), m64_u64);
  v34 = _m_punpckldq(_m_punpckhdq(v109, v109), v109);
  v126 = _m_pfacc(
           _m_pfsub(_m_pfmul(v33, v118), _m_pfmul(_m_pxor(v34, (__m64)0x80000000LL), v116)),
           _m_pfadd(_m_pxor(_m_pfmul(m64_u64, v118), (__m64)0x80000000LL), _m_pfmul(v109, v116)));
  v130 = _m_pfacc(
           _m_pfadd(_m_pfmul(_m_pxor(v33, (__m64)0x80000000LL), v116), _m_pfmul(v34, v118)),
           _m_pfsub(_m_pfmul(_m_pxor(v109, (__m64)0x80000000LL), v118), _m_pfmul(m64_u64, v116)));
  v35 = _m_punpckldq(_m_punpckhdq(v112, v112), v112);
  v36 = _m_punpckldq(_m_punpckhdq(v113, v113), v113);
  v134 = _m_pfacc(
           _m_pfsub(_m_pfmul(v35, v118), _m_pfmul(_m_pxor(v36, (__m64)0x80000000LL), v116)),
           _m_pfadd(_m_pxor(_m_pfmul(v112, v118), (__m64)0x80000000LL), _m_pfmul(v113, v116)));
  v136 = _m_pfacc(
           _m_pfadd(_m_pfmul(_m_pxor(v35, (__m64)0x80000000LL), v116), _m_pfmul(v36, v118)),
           _m_pfsub(_m_pfmul(_m_pxor(v113, (__m64)0x80000000LL), v118), _m_pfmul(v112, v116)));
  v37 = v126;
  v38 = v130;
  v39 = _m_punpckhdq(v130, v130);
  if ( !_mm_cvtsi64_si32(_m_pfcmpge(v39, (__m64)0x3F8000003F800000LL)) )
  {
    math_acos_packed(0, v12);
    v102 = _mm_cvtsi64_si32(v39);
    math_sin_packed();
    v12 = (__m64 *)m64_u64.m64_i32[1];
    v37 = v126;
    v38 = v130;
    if ( _mm_cvtsi64_si32(_m_pfcmpge(_m_pand(v39, (__m64)0x7FFFFFFF7FFFFFFFLL), (__m64)0x3400000034000000LL)) )
    {
      v40 = _mm_cvtsi32_si64(v102);
      v41 = _m_pfrcp(v39);
      v42 = _m_pfmul(_m_punpckldq(v40, v40), _m_pfrcpit2(_m_pfrcpit1(v39, v41), v41));
      v37 = _m_pfmul(v126, v42);
      v38 = _m_pfmul(v130, v42);
    }
  }
  v120 = v37;
  v122 = _m_pand(v38, (__m64)0xFFFFFFFFLL);
  v43 = v134;
  v44 = v136;
  v45 = _m_punpckhdq(v136, v136);
  if ( !_mm_cvtsi64_si32(_m_pfcmpge(v45, (__m64)0x3F8000003F800000LL)) )
  {
    math_acos_packed(0, v12);
    v103 = _mm_cvtsi64_si32(v45);
    math_sin_packed();
    v43 = v134;
    v44 = v136;
    if ( _mm_cvtsi64_si32(_m_pfcmpge(_m_pand(v45, (__m64)0x7FFFFFFF7FFFFFFFLL), (__m64)0x3400000034000000LL)) )
    {
      v46 = _mm_cvtsi32_si64(v103);
      v47 = _m_pfrcp(v45);
      v48 = _m_pfmul(_m_punpckldq(v46, v46), _m_pfrcpit2(_m_pfrcpit1(v45, v47), v47));
      v43 = _m_pfmul(v134, v48);
      v44 = _m_pfmul(v136, v48);
    }
  }
  v127 = _m_pfmul(_m_pfadd(v120, v43), (__m64)0xBE800000BE800000uLL);
  v131 = _m_pfmul(_m_pfadd(v122, _m_pand(v44, (__m64)0xFFFFFFFFLL)), (__m64)0xBE800000BE800000uLL).m64_u32[0];
  v49 = _mm_cvtsi32_si64(v131);
  v50 = _m_pfadd(_m_pfmul(v127, v127), _m_pfmul(v49, v49));
  v51 = _m_pfacc(v50, v50);
  v52 = _m_pfrsqrt(v51);
  v53 = _m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v52, v52), v51), v52);
  v104.m64_u64 = __PAIR64__(a1, _mm_cvtsi64_si32(v53));
  math_sincos_packed();
  v55 = _m_pfmul(v51, v53);
  v56 = _m_pfcmpge(_m_pand(v55, (__m64)0x7FFFFFFFFFFFFFFFLL), (__m64)0x3400000034000000LL);
  v57 = _mm_cvtsi64_si32(_m_punpckhdq(v56, v56));
  v58 = v127;
  v59 = v55;
  v60 = _m_pfmul(_m_punpckhdq(v55, v55), v104);
  v61 = _mm_cvtsi32_si64(v131);
  if ( (v57 & 1) != 0 )
  {
    v62 = _m_punpckldq(v60, v60);
    v61 = _m_pfmul(v61, v62);
    v58 = _m_pfmul(v127, v62);
  }
  v124 = _m_punpckldq(v61, v59);
  v63 = _m_punpckldq(_m_punpckhdq(v58, v58), v58);
  v64 = _m_punpckldq(_m_punpckhdq(v124, v124), v124);
  a2->m64_u64 = (unsigned __int64)_m_pfacc(
                                    _m_pfsub(_m_pfmul(v63, v111), _m_pfmul(_m_pxor(v64, (__m64)0x80000000LL), v110)),
                                    _m_pfadd(_m_pxor(_m_pfmul(v58, v111), (__m64)0x80000000LL), _m_pfmul(v124, v110)));
  a2[1].m64_u64 = (unsigned __int64)_m_pfacc(
                                      _m_pfadd(_m_pfmul(_m_pxor(v63, (__m64)0x80000000LL), v110), _m_pfmul(v64, v111)),
                                      _m_pfsub(_m_pfmul(_m_pxor(v124, (__m64)0x80000000LL), v111), _m_pfmul(v58, v110)));
  v65 = _m_pfadd(_m_pfmul(v112, v112), _m_pfmul(v113, v113));
  v66 = _m_pfacc(v65, v65);
  v67 = _m_pfrcp(v66);
  v68 = _m_pfcmpgt(v66, (__m64)0x80000000800000LL);
  v69 = _m_pfrcpit2(_m_pfrcpit1(v66, v67), v67);
  v117 = _m_pfmul(_m_pand(_m_pxor(v112, (__m64)0x8000000080000000uLL), v68), v69);
  v119 = _m_pfmul(_m_pand(_m_pxor(v113, (__m64)0x80000000LL), v68), v69);
  v70 = _m_punpckldq(_m_punpckhdq(v110, v110), v110);
  v71 = _m_punpckldq(_m_punpckhdq(v111, v111), v111);
  v128 = _m_pfacc(
           _m_pfsub(_m_pfmul(v70, v119), _m_pfmul(_m_pxor(v71, (__m64)0x80000000LL), v117)),
           _m_pfadd(_m_pxor(_m_pfmul(v110, v119), (__m64)0x80000000LL), _m_pfmul(v111, v117)));
  v132 = _m_pfacc(
           _m_pfadd(_m_pfmul(_m_pxor(v70, (__m64)0x80000000LL), v117), _m_pfmul(v71, v119)),
           _m_pfsub(_m_pfmul(_m_pxor(v111, (__m64)0x80000000LL), v119), _m_pfmul(v110, v117)));
  v72 = _m_punpckldq(_m_punpckhdq(v114, v114), v114);
  v73 = _m_punpckldq(_m_punpckhdq(v115, v115), v115);
  v135 = _m_pfacc(
           _m_pfsub(_m_pfmul(v72, v119), _m_pfmul(_m_pxor(v73, (__m64)0x80000000LL), v117)),
           _m_pfadd(_m_pxor(_m_pfmul(v114, v119), (__m64)0x80000000LL), _m_pfmul(v115, v117)));
  v137 = _m_pfacc(
           _m_pfadd(_m_pfmul(_m_pxor(v72, (__m64)0x80000000LL), v117), _m_pfmul(v73, v119)),
           _m_pfsub(_m_pfmul(_m_pxor(v115, (__m64)0x80000000LL), v119), _m_pfmul(v114, v117)));
  v74 = v128;
  v75 = v132;
  v76 = _m_punpckhdq(v132, v132);
  if ( !_mm_cvtsi64_si32(_m_pfcmpge(v76, (__m64)0x3F8000003F800000LL)) )
  {
    math_acos_packed(0, v54);
    v105 = _mm_cvtsi64_si32(v76);
    math_sin_packed();
    v54 = m64_u64.m64_i32[1];
    v74 = v128;
    v75 = v132;
    if ( _mm_cvtsi64_si32(_m_pfcmpge(_m_pand(v76, (__m64)0x7FFFFFFF7FFFFFFFLL), (__m64)0x3400000034000000LL)) )
    {
      v77 = _mm_cvtsi32_si64(v105);
      v78 = _m_pfrcp(v76);
      v79 = _m_pfmul(_m_punpckldq(v77, v77), _m_pfrcpit2(_m_pfrcpit1(v76, v78), v78));
      v74 = _m_pfmul(v128, v79);
      v75 = _m_pfmul(v132, v79);
    }
  }
  v121 = v74;
  v123 = _m_pand(v75, (__m64)0xFFFFFFFFLL);
  v80 = v135;
  v81 = v137;
  v82 = _m_punpckhdq(v137, v137);
  if ( !_mm_cvtsi64_si32(_m_pfcmpge(v82, (__m64)0x3F8000003F800000LL)) )
  {
    math_acos_packed(0, v54);
    v106 = _mm_cvtsi64_si32(v82);
    math_sin_packed();
    v80 = v135;
    v81 = v137;
    if ( _mm_cvtsi64_si32(_m_pfcmpge(_m_pand(v82, (__m64)0x7FFFFFFF7FFFFFFFLL), (__m64)0x3400000034000000LL)) )
    {
      v83 = _mm_cvtsi32_si64(v106);
      v84 = _m_pfrcp(v82);
      v85 = _m_pfmul(_m_punpckldq(v83, v83), _m_pfrcpit2(_m_pfrcpit1(v82, v84), v84));
      v80 = _m_pfmul(v135, v85);
      v81 = _m_pfmul(v137, v85);
    }
  }
  v129 = _m_pfmul(_m_pfadd(v121, v80), (__m64)0xBE800000BE800000uLL);
  v133 = _m_pfmul(_m_pfadd(v123, _m_pand(v81, (__m64)0xFFFFFFFFLL)), (__m64)0xBE800000BE800000uLL).m64_u32[0];
  v86 = _mm_cvtsi32_si64(v133);
  v87 = _m_pfadd(_m_pfmul(v129, v129), _m_pfmul(v86, v86));
  v88 = _m_pfacc(v87, v87);
  v89 = _m_pfrsqrt(v88);
  v90 = _m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v89, v89), v88), v89);
  v107.m64_u64 = __PAIR64__(v104.m64_u32[1], _mm_cvtsi64_si32(v90));
  math_sincos_packed();
  v91 = _m_pfmul(v88, v90);
  v92 = _m_pfcmpge(_m_pand(v91, (__m64)0x7FFFFFFFFFFFFFFFLL), (__m64)0x3400000034000000LL);
  v93 = _mm_cvtsi64_si32(_m_punpckhdq(v92, v92));
  v94 = v129;
  v95 = v91;
  v96 = _m_pfmul(_m_punpckhdq(v91, v91), v107);
  v97 = _mm_cvtsi32_si64(v133);
  if ( (v93 & 1) != 0 )
  {
    v98 = _m_punpckldq(v96, v96);
    v97 = _m_pfmul(v97, v98);
    v94 = _m_pfmul(v129, v98);
  }
  v125 = _m_punpckldq(v97, v95);
  v99 = _m_punpckldq(_m_punpckhdq(v94, v94), v94);
  v100 = _m_punpckldq(_m_punpckhdq(v125, v125), v125);
  a3->m64_u64 = (unsigned __int64)_m_pfacc(
                                    _m_pfsub(_m_pfmul(v99, v113), _m_pfmul(_m_pxor(v100, (__m64)0x80000000LL), v112)),
                                    _m_pfadd(_m_pxor(_m_pfmul(v94, v113), (__m64)0x80000000LL), _m_pfmul(v125, v112)));
  a3[1].m64_u64 = (unsigned __int64)_m_pfacc(
                                      _m_pfadd(_m_pfmul(_m_pxor(v99, (__m64)0x80000000LL), v112), _m_pfmul(v100, v113)),
                                      _m_pfsub(_m_pfmul(_m_pxor(v125, (__m64)0x80000000LL), v113), _m_pfmul(v94, v112)));
  a4->m64_u64 = (unsigned __int64)v112;
  a4[1].m64_u64 = (unsigned __int64)v113;
  _m_femms();
  return a4;
}

// sub_45A9AA @ 0x0045A9AA
__m64 *__stdcall sub_45A9AA(__m64 *a1, __m64 *a2, __m64 *a3)
{
  __m64 v3; // mm1
  __m64 v4; // mm4
  __m64 v5; // mm5
  __m64 v6; // mm7
  __m64 v7; // mm1
  __m64 v8; // mm6
  __m64 v9; // mm4
  __m64 v10; // mm2
  __m64 v12; // mm5
  __m64 v13; // mm4
  __m64 v14; // mm4
  __m64 v15; // mm5
  __m64 v16; // mm4
  __m64 v17; // mm5
  __m64 v18; // mm4
  __m64 v19; // mm5
  __m64 v20; // [esp+0h] [ebp-44h]
  __m64 v21; // [esp+8h] [ebp-3Ch]
  __m64 v22; // [esp+10h] [ebp-34h]
  __m64 v23; // [esp+18h] [ebp-2Ch]
  __m64 v24; // [esp+28h] [ebp-1Ch]
  __m64 v25; // [esp+30h] [ebp-14h]
  __m64 v26; // [esp+38h] [ebp-Ch]

  _m_femms();
  v3 = a3[2];
  v4 = a3[7];
  v5 = a3[5];
  v20 = _m_punpckldq((__m64)a3->m64_u64, v3);
  v22 = _m_punpckhdq((__m64)a3->m64_u64, v3);
  v6 = a3[3];
  v7 = a3[1];
  v24 = _m_punpckldq(v5, v4);
  v26 = _m_punpckhdq(v5, v4);
  v8 = _m_punpckldq(v7, v6);
  v9 = a3[6];
  v10 = a3[4];
  v25 = _m_punpckhdq(v7, v6);
  v23 = _m_punpckhdq(v10, v9);
  v21 = _m_punpckldq(v10, v9);
  v12 = a2[1];
  v13 = _m_pfadd(
          _m_pfacc(_m_pfmul((__m64)a2->m64_u64, v8), _m_pfmul((__m64)a2->m64_u64, v25)),
          _m_pfacc(_m_pfmul(v12, v24), _m_pfmul(v12, v26)));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfacc(_m_pfmul((__m64)a2->m64_u64, v20), _m_pfmul((__m64)a2->m64_u64, v22)),
                                    _m_pfacc(_m_pfmul(v12, v21), _m_pfmul(v12, v23)));
  a1[1].m64_u64 = (unsigned __int64)v13;
  v14 = a2[2];
  v15 = a2[3];
  a1[2].m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfacc(_m_pfmul(v14, v20), _m_pfmul(v14, v22)),
                                      _m_pfacc(_m_pfmul(v15, v21), _m_pfmul(v15, v23)));
  a1[3].m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfacc(_m_pfmul(v14, v8), _m_pfmul(v14, v25)),
                                      _m_pfacc(_m_pfmul(v15, v24), _m_pfmul(v15, v26)));
  v16 = a2[4];
  v17 = a2[5];
  a1[4].m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfacc(_m_pfmul(v16, v20), _m_pfmul(v16, v22)),
                                      _m_pfacc(_m_pfmul(v17, v21), _m_pfmul(v17, v23)));
  a1[5].m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfacc(_m_pfmul(v16, v8), _m_pfmul(v16, v25)),
                                      _m_pfacc(_m_pfmul(v17, v24), _m_pfmul(v17, v26)));
  v18 = a2[6];
  v19 = a2[7];
  a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfacc(_m_pfmul(v18, v20), _m_pfmul(v18, v22)),
                                      _m_pfacc(_m_pfmul(v19, v21), _m_pfmul(v19, v23)));
  a1[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfacc(_m_pfmul(v18, v8), _m_pfmul(v18, v25)),
                                      _m_pfacc(_m_pfmul(v19, v24), _m_pfmul(v19, v26)));
  _m_femms();
  return a1;
}

// sub_45ABDC @ 0x0045ABDC
double __stdcall sub_45ABDC(unsigned int *a1)
{
  __m64 v1; // mm0
  __m64 v2; // mm3
  __m64 v3; // mm4
  __m64 v4; // mm2
  __m64 v5; // mm3
  __m64 v6; // mm4

  v1 = *(__m64 *)(a1 + 9);
  v2 = *(__m64 *)(a1 + 13);
  v3 = _m_pfsub(
         _m_pfmul(_m_punpckhdq(*((__m64 *)a1 + 7), *((__m64 *)a1 + 7)), v1),
         _m_pfmul(_m_punpckhdq(*((__m64 *)a1 + 5), *((__m64 *)a1 + 5)), v2));
  v4 = _m_pfsub(
         _m_pfmul(_m_punpckldq(*((__m64 *)a1 + 4), *((__m64 *)a1 + 4)), *((__m64 *)a1 + 7)),
         _m_pfmul(_m_punpckldq(*((__m64 *)a1 + 6), *((__m64 *)a1 + 6)), *((__m64 *)a1 + 5)));
  v5 = _m_pfsub(_m_pfmul(v2, *((__m64 *)a1 + 4)), _m_pfmul(v1, *((__m64 *)a1 + 6)));
  v6 = _m_pfsub(
         _m_pfmul(
           _m_pfsub(
             _m_pfadd(
               _m_pfmul(v3, *((__m64 *)a1 + 2)),
               _m_pfmul(v5, _m_punpckhdq(*((__m64 *)a1 + 3), *((__m64 *)a1 + 3)))),
             _m_pfmul(_m_punpckldq(_m_punpckhdq(v4, v4), v3), *(__m64 *)(a1 + 5))),
           _m_punpckldq(*((__m64 *)a1 + 1), (__m64)*a1)),
         _m_pfmul(
           _m_pfsub(
             _m_pfadd(
               _m_pfmul(_m_punpckhdq(v5, v3), _m_punpckldq(*((__m64 *)a1 + 2), *((__m64 *)a1 + 2))),
               _m_pfmul(_m_punpckldq(v5, v4), *((__m64 *)a1 + 3))),
             _m_pfmul(v4, *(__m64 *)(a1 + 5))),
           _m_punpckhdq(*((__m64 *)a1 + 1), *(__m64 *)a1)));
  _m_femms();
  return COERCE_FLOAT(_mm_cvtsi64_si32(_m_pfacc(v6, v6)));
}

// sub_45ACAB @ 0x0045ACAB
__m64 *__stdcall sub_45ACAB(__m64 *a1, unsigned int a2, unsigned int a3, unsigned int a4)
{
  _m_femms();
  a1->m64_u64 = 1065353216;
  a1[1].m64_u64 = 0;
  a1[2].m64_u64 = 0x3F80000000000000LL;
  a1[3].m64_u64 = 0;
  a1[4].m64_u64 = 0;
  a1[5].m64_u64 = 1065353216;
  a1[6].m64_u64 = (unsigned __int64)_m_punpckldq(_mm_cvtsi32_si64(a2), _mm_cvtsi32_si64(a3));
  a1[7].m64_u64 = (unsigned __int64)_m_punpckldq(_mm_cvtsi32_si64(a4), (__m64)1065353216LL);
  _m_femms();
  return a1;
}

// sub_45ACFB @ 0x0045ACFB
__m64 *__stdcall sub_45ACFB(__m64 *a1, __m64 *a2, int a3)
{
  __m64 m64_u64; // mm6
  __m64 v5; // mm7
  __m64 v6; // mm3
  __m64 v7; // mm1
  __m64 v8; // mm0
  __m64 v9; // mm2
  __m64 v10; // mm1
  __m64 v11; // mm3
  __m64 v12; // mm1
  __m64 v13; // mm3
  __m64 v14; // [esp+0h] [ebp-14h] BYREF
  __m64 v15; // [esp+8h] [ebp-Ch]

  _m_femms();
  sub_45FAE8((int)&v14, a3);
  m64_u64 = (__m64)a2->m64_u64;
  v5 = a2[1];
  v6 = _m_pfmul(v5, v15);
  v7 = _m_pfadd(_m_pfmul((__m64)a2->m64_u64, v14), v6);
  v8 = _m_pxor(v14, (__m64)0x8000000080000000uLL);
  v9 = _m_pxor(v15, (__m64)0x8000000080000000uLL);
  v10 = _m_pfacc(v7, v7);
  v11 = _m_punpckldq(v6, v10);
  v12 = _m_psllqi(v10, 0x20u);
  v13 = _m_psrlqi(v11, 0x20u);
  a1->m64_u64 = (unsigned __int64)_m_pfadd(_m_pfmul(_m_punpckldq(v8, v8), (__m64)a2->m64_u64), v13);
  a1[1].m64_u64 = (unsigned __int64)_m_pfmul(_m_punpckldq(v8, v8), v5);
  a1[2].m64_u64 = (unsigned __int64)_m_pfadd(_m_pfmul(_m_punpckhdq(v8, v8), m64_u64), v12);
  a1[3].m64_u64 = (unsigned __int64)_m_pfmul(_m_punpckhdq(v8, v8), v5);
  a1[4].m64_u64 = (unsigned __int64)_m_pfmul(_m_punpckldq(v9, v9), m64_u64);
  a1[5].m64_u64 = (unsigned __int64)_m_pfadd(_m_pfmul(_m_punpckldq(v9, v9), v5), v13);
  a1[6].m64_u64 = (unsigned __int64)_m_pfmul(_m_punpckhdq(v9, v9), m64_u64);
  a1[7].m64_u64 = (unsigned __int64)_m_pfadd(_m_pfmul(_m_punpckhdq(v9, v9), v5), v12);
  _m_femms();
  return a1;
}

// sub_45ADE6 @ 0x0045ADE6
__m64 *__stdcall sub_45ADE6(__m64 *a1, int a2)
{
  __m64 v3; // mm3
  __m64 v4; // mm0
  __m64 v5; // mm1
  __m64 v6; // mm6
  __m64 v7; // mm4
  __m64 v8; // mm6
  __m64 v9; // mm4
  __m64 v10; // mm6
  __m64 v11; // [esp+0h] [ebp-14h] BYREF
  __m64 v12; // [esp+8h] [ebp-Ch]

  _m_femms();
  sub_45FAE8((int)&v11, a2);
  v3 = v12;
  v4 = _m_pfmul(v11, (__m64)0xC0000000C0000000uLL);
  v5 = _m_pfmul(v12, (__m64)0x3F800000C0000000LL);
  v6 = v11;
  v7 = _m_punpckldq(v6, v6);
  v8 = _m_punpckhdq(v6, v6);
  a1->m64_u64 = (unsigned __int64)_m_pfadd(_m_pfmul(v7, v4), (__m64)1065353216LL);
  a1[1].m64_u64 = (unsigned __int64)_m_pfmul(_m_psrlqi(v7, 0x20u), v5);
  a1[2].m64_u64 = (unsigned __int64)_m_pfadd(_m_pfmul(v8, v4), (__m64)0x3F80000000000000LL);
  a1[3].m64_u64 = (unsigned __int64)_m_pfmul(_m_psrlqi(v8, 0x20u), v5);
  v9 = _m_punpckldq(v3, v3);
  v10 = _m_punpckhdq(v3, v3);
  a1[4].m64_u64 = (unsigned __int64)_m_pfmul(v9, v4);
  a1[5].m64_u64 = (unsigned __int64)_m_pfadd(_m_pfmul(_m_psrlqi(v9, 0x20u), v5), (__m64)1065353216LL);
  a1[6].m64_u64 = (unsigned __int64)_m_pfmul(v10, v4);
  a1[7].m64_u64 = (unsigned __int64)_m_pfadd(_m_pfmul(_m_psrlqi(v10, 0x20u), v5), (__m64)0x3F80000000000000LL);
  _m_femms();
  return a1;
}

// sub_45AEC2 @ 0x0045AEC2
__m64 *__stdcall sub_45AEC2(__m64 *a1, unsigned int a2)
{
  __m64 v2; // mm0
  __m64 v4; // mm4

  _m_femms();
  v2 = _mm_cvtsi32_si64(a2);
  math_sincos_packed();
  v4 = _m_psrlqi(v2, 0x20u);
  a1->m64_u64 = 1065353216;
  a1[1].m64_u64 = 0;
  a1[2].m64_i32[0] = _mm_cvtsi64_si32(0);
  a1[2].m64_i32[1] = _mm_cvtsi64_si32(v2);
  a1[3].m64_u64 = (unsigned __int64)v4;
  a1[6].m64_u64 = 0;
  a1[7].m64_u64 = 0x3F80000000000000LL;
  a1[4].m64_i32[0] = _mm_cvtsi64_si32(0);
  a1[4].m64_i32[1] = _mm_cvtsi64_si32(_m_pxor(v4, (__m64)0x80000000LL));
  a1[5].m64_i32[0] = _mm_cvtsi64_si32(v2);
  a1[5].m64_i32[1] = _mm_cvtsi64_si32(0);
  _m_femms();
  return a1;
}

// sub_45AF25 @ 0x0045AF25
__m64 *__stdcall sub_45AF25(__m64 *a1, unsigned int a2)
{
  __m64 v3; // mm4
  __m64 v4; // mm0
  __m64 v5; // mm4

  _m_femms();
  math_sincos_packed();
  v3 = _mm_cvtsi32_si64(a2);
  v4 = _m_pand(v3, (__m64)0xFFFFFFFFLL);
  v5 = _m_psrlqi(v3, 0x20u);
  a1[2].m64_u64 = 0x3F80000000000000LL;
  a1[3].m64_u64 = 0;
  a1[6].m64_u64 = 0;
  a1[7].m64_u64 = 0x3F80000000000000LL;
  a1[4].m64_u64 = (unsigned __int64)v5;
  a1->m64_u64 = (unsigned __int64)v4;
  a1[5].m64_u64 = (unsigned __int64)v4;
  a1[1].m64_u64 = (unsigned __int64)_m_pxor(v5, (__m64)0x80000000LL);
  _m_femms();
  return a1;
}

// sub_45AF83 @ 0x0045AF83
__m64 *__stdcall sub_45AF83(__m64 *a1, unsigned int a2)
{
  __m64 v2; // mm0

  _m_femms();
  v2 = _mm_cvtsi32_si64(a2);
  math_sincos_packed();
  a1->m64_u64 = (unsigned __int64)v2;
  a1[1].m64_u64 = 0;
  a1[3].m64_u64 = 0;
  a1[4].m64_u64 = 0;
  a1[5].m64_u64 = 1065353216;
  a1[6].m64_u64 = 0;
  a1[7].m64_u64 = 0x3F80000000000000LL;
  a1[2].m64_u64 = (unsigned __int64)_m_pxor(_m_punpckldq(_m_punpckhdq(v2, v2), v2), (__m64)0x80000000LL);
  _m_femms();
  return a1;
}

// sub_45AFDC @ 0x0045AFDC
__m64 *__stdcall sub_45AFDC(__m64 *a1, unsigned int a2, unsigned int a3, unsigned int a4)
{
  _m_femms();
  a1->m64_u64 = (unsigned __int64)_mm_cvtsi32_si64(a2);
  a1[1].m64_u64 = 0;
  a1[3].m64_u64 = 0;
  a1[4].m64_u64 = 0;
  a1[6].m64_u64 = 0;
  a1[2].m64_u64 = (unsigned __int64)_m_psllqi(_mm_cvtsi32_si64(a3), 0x20u);
  a1[5].m64_u64 = (unsigned __int64)_mm_cvtsi32_si64(a4);
  a1[7].m64_u64 = 0x3F80000000000000LL;
  _m_femms();
  return a1;
}

// sub_45B023 @ 0x0045B023
__m64 *__stdcall sub_45B023(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm1
  __m64 v3; // mm4
  __m64 v5; // mm2
  __m64 v6; // mm5
  __m64 v7; // mm7
  __m64 v8; // mm0
  __m64 v9; // mm1
  __m64 v10; // mm4

  v2 = a2[2];
  v3 = a2[7];
  v5 = _m_punpckhdq((__m64)a2->m64_u64, v2);
  v6 = a2[5];
  a1->m64_u64 = (unsigned __int64)_m_punpckldq((__m64)a2->m64_u64, v2);
  a1[2].m64_u64 = (unsigned __int64)v5;
  v7 = a2[3];
  v8 = a2[4];
  v9 = a2[1];
  a1[5].m64_u64 = (unsigned __int64)_m_punpckldq(v6, v3);
  a1[7].m64_u64 = (unsigned __int64)_m_punpckhdq(v6, v3);
  v10 = a2[6];
  a1[4].m64_u64 = (unsigned __int64)_m_punpckldq(v9, v7);
  a1[6].m64_u64 = (unsigned __int64)_m_punpckhdq(v9, v7);
  a1[3].m64_u64 = (unsigned __int64)_m_punpckhdq(v8, v10);
  a1[1].m64_u64 = (unsigned __int64)_m_punpckldq(v8, v10);
  _m_femms();
  return a1;
}

// sub_45B092 @ 0x0045B092
__m64 *__cdecl sub_45B092(__m64 *a1)
{
  __m64 v1; // mm1
  __m64 v3; // mm2

  v1 = _mm_cvtsi32_si64(0x3F800000u);
  a1->m64_u64 = (unsigned __int64)v1;
  a1[1].m64_u64 = 0;
  a1[3].m64_u64 = 0;
  a1[4].m64_u64 = 0;
  a1[5].m64_u64 = (unsigned __int64)v1;
  v3 = _m_punpckldq(_m_punpckhdq(v1, v1), v1);
  a1[6].m64_u64 = 0;
  a1[2].m64_u64 = (unsigned __int64)v3;
  a1[7].m64_u64 = (unsigned __int64)v3;
  _m_femms();
  return a1;
}

// sub_45B0CB @ 0x0045B0CB
__m64 *__stdcall sub_45B0CB(__m64 *a1, __m64 *a2)
{
  __m64 m64_u64; // mm3
  __m64 v4; // mm0
  __m64 v5; // mm7
  __m64 v6; // mm2
  __m64 v7; // mm4
  __m64 v8; // mm3
  __m64 v9; // mm1
  __m64 v10; // mm5
  __m64 v11; // mm7
  __m64 v12; // mm6
  __m64 v13; // mm2
  __m64 v14; // mm1
  __m64 v15; // mm6
  __m64 v16; // mm7
  __m64 v17; // mm3
  __m64 v18; // mm2
  __m64 v19; // mm3
  __m64 v20; // mm5
  __m64 v21; // mm6

  m64_u64 = (__m64)a2->m64_u64;
  v4 = _m_pfadd(m64_u64, m64_u64);
  v5 = a2[1];
  v6 = _m_punpckhdq(m64_u64, m64_u64);
  v7 = _m_punpckhdq(v5, v5);
  v8 = _m_pfmul((__m64)a2->m64_u64, v4);
  v9 = _m_punpckldq(_m_pfadd(v5, v5), v4);
  v10 = _m_pfmul(v4, v7);
  v11 = _m_pfmul(_m_punpckldq(v5, v5), v9);
  v12 = _m_pfmul(v9, v7);
  v13 = _m_pfmul(v9, v6);
  v14 = _m_punpckhdq(v13, v11);
  a1[6].m64_u64 = 0;
  v15 = _m_punpckhdq(_m_punpckldq(v12, v12), v10);
  v16 = _m_pfsubr(_m_pfadd(_m_punpckldq(v11, v11), v8), (__m64)0x3F8000003F800000LL);
  a1[5].m64_u64 = (unsigned __int64)_m_punpckldq(_m_pfsubr(_m_pfacc(v8, v8), (__m64)0x3F8000003F800000LL), 0);
  v17 = v13;
  v18 = _m_pfadd(v13, v10);
  v19 = _m_pfsub(v17, v10);
  v20 = _m_pfsub(v14, v15);
  v21 = _m_pfadd(v14, v15);
  a1[3].m64_u64 = (unsigned __int64)_m_punpckldq(v18, 0);
  a1[1].m64_u64 = (unsigned __int64)_m_punpckhdq(v20, 0);
  a1[2].m64_u64 = (unsigned __int64)_m_punpckldq(v20, v16);
  a1->m64_u64 = (unsigned __int64)_m_punpckhdq(v16, _m_punpckldq(v21, v21));
  a1[4].m64_u64 = (unsigned __int64)_m_punpckldq(_m_punpckhdq(v21, v21), v19);
  a1[7].m64_u64 = (unsigned __int64)_m_punpckldq(0, (__m64)1065353216LL);
  _m_femms();
  return a1;
}

// sub_45B19D @ 0x0045B19D
__m64 *__stdcall sub_45B19D(__m64 *a1, __m64 *a2)
{
  __m64 v3; // mm4
  __m64 v4; // mm1
  __m64 v5; // mm5
  __m64 v6; // mm0
  __m64 v7; // mm5
  __m64 v8; // mm2
  __m64 v9; // mm3
  __m64 v10; // mm1
  __m64 v11; // mm6
  __m64 v12; // mm3
  __m64 v13; // mm6
  __m64 v14; // mm2
  __m64 v15; // mm1

  v3 = a2[1];
  v4 = _m_pfadd(v3, v3);
  v5 = _m_pfadd((__m64)a2->m64_u64, (__m64)a2->m64_u64);
  v6 = _m_pfmul(v5, (__m64)a2->m64_u64);
  v7 = _m_punpckldq(v5, v4);
  v8 = _m_pfmul((__m64)a2->m64_u64, v4);
  v9 = _m_pfmul(_m_pswapd((__m64)a2->m64_u64), v4);
  v10 = _m_pfmul(v4, v3);
  v11 = _m_pfmul(_m_punpckhdq((__m64)a2->m64_u64, v3), v7);
  v12 = _m_pfpnacc(v9, v9);
  v13 = _m_pfpnacc(v11, v11);
  v14 = _m_pfpnacc(v8, v8);
  v15 = _m_pfsub(_m_pfsubr(v6, (__m64)0x3F8000003F800000LL), _m_punpckldq(v10, v10));
  a1[6].m64_u64 = 0;
  a1[4].m64_u64 = (unsigned __int64)_m_punpckldq(_m_pswapd(v14), v12);
  a1[1].m64_u64 = (unsigned __int64)_m_punpckldq(v14, 0);
  a1[5].m64_u64 = (unsigned __int64)_m_punpckhdq(_m_pfsubr(_m_pfacc(v6, v6), (__m64)0x3F8000003F800000LL), 0);
  a1->m64_u64 = (unsigned __int64)_m_punpckhdq(v15, v13);
  a1[2].m64_u64 = (unsigned __int64)_m_punpckldq(v13, v15);
  a1[3].m64_u64 = (unsigned __int64)_m_punpckhdq(v12, 0);
  a1[7].m64_u64 = (unsigned __int64)_m_punpckldq(0, (__m64)1065353216LL);
  _m_femms();
  return a1;
}

// sub_45B252 @ 0x0045B252
__m64 *__stdcall sub_45B252(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, __m64 *a6, __m64 *a7)
{
  __m64 *result; // eax
  __m64 m64_u64; // mm3
  __m64 v9; // mm0
  __m64 v10; // mm7
  __m64 v11; // mm2
  __m64 v12; // mm4
  __m64 v13; // mm3
  __m64 v14; // mm1
  __m64 v15; // mm5
  __m64 v16; // mm7
  __m64 v17; // mm6
  __m64 v18; // mm2
  __m64 v19; // mm1
  __m64 v20; // mm6
  __m64 v21; // mm7
  __m64 v22; // mm3
  __m64 v23; // mm2
  __m64 v24; // mm3
  __m64 v25; // mm5
  __m64 v26; // mm6
  __m64 v27; // mm3
  __m64 v28; // mm4
  __m64 v29; // mm1
  __m64 v30; // mm2
  __m64 v31; // mm2
  __m64 v32; // mm1
  __m64 v33; // mm2
  __m64 v34; // mm3
  __m64 v35; // mm0
  __m64 v36; // mm1
  __m64 v37; // mm2
  __m64 v38; // mm5
  __m64 v39; // mm3
  __m64 v40; // mm2
  __m64 v41; // mm7
  __m64 v42; // mm0
  __m64 v43; // mm3
  __m64 v44; // mm1
  __m64 v45; // mm2
  __m64 v46; // mm3
  __m64 v47; // mm0
  __m64 v48; // mm1
  __m64 v49; // mm2
  __m64 v50; // mm5
  __m64 v51; // mm3
  __m64 v52; // mm2
  __m64 v53; // mm7
  __m64 v54; // mm0
  __m64 v55; // mm3
  __m64 v56; // mm1
  __m64 v57; // mm2
  __m64 v58; // mm3
  __m64 v59; // mm0
  __m64 v60; // mm1
  __m64 v61; // mm2
  __m64 v62; // mm5
  __m64 v63; // mm3
  __m64 v64; // mm2
  __m64 v65; // mm7
  __m64 v66; // mm0
  __m64 v67; // mm3
  __m64 v68; // mm1
  __m64 v69; // mm2
  __m64 v70; // mm3
  __m64 v71; // mm0
  __m64 v72; // mm1
  __m64 v73; // mm2
  __m64 v74; // mm5
  __m64 v75; // mm3
  __m64 v76; // mm7
  __m64 v77; // mm2
  __m64 v78; // mm3
  __m64 v79; // mm1
  __m64 v80; // mm2
  __m64 v81; // mm3
  __m64 v82; // mm0
  __m64 v83; // mm1
  __m64 v84; // mm2
  __m64 v85; // mm5
  __m64 v86; // mm3
  __m64 v87; // mm2
  __m64 v88; // mm7
  __m64 v89; // mm0
  __m64 v90; // mm3
  __m64 v91; // mm1
  __m64 v92; // mm2
  __m64 v93; // mm3
  __m64 v94; // mm0
  __m64 v95; // mm1
  __m64 v96; // mm2
  __m64 v97; // mm5
  __m64 v98; // mm3
  __m64 v99; // mm2
  __m64 v100; // mm7
  __m64 v101; // mm0
  __m64 v102; // mm3
  __m64 v103; // mm1
  __m64 v104; // mm2
  __m64 v105; // mm3
  __m64 v106; // mm0
  __m64 v107; // mm1
  __m64 v108; // mm2
  __m64 v109; // mm5
  __m64 v110; // mm3
  __m64 v111; // mm2
  __m64 v112; // mm7
  __m64 v113; // mm0
  __m64 v114; // mm3
  __m64 v115; // mm1
  __m64 v116; // mm2
  __m64 v117; // mm3
  __m64 v118; // mm0
  __m64 v119; // mm1
  __m64 v120; // mm2
  __m64 v121; // mm5
  __m64 v122; // mm3
  __m64 v123; // mm7
  __m64 v124; // mm2
  __m64 v125; // mm3
  __m64 v126; // mm1
  __m64 v127; // mm2
  __m64 v128; // mm3
  __m64 v129; // mm0
  __m64 v130; // mm1
  __m64 v131; // mm2
  __m64 v132; // mm5
  __m64 v133; // mm3
  __m64 v134; // mm2
  __m64 v135; // mm7
  __m64 v136; // mm0
  __m64 v137; // mm3
  __m64 v138; // mm1
  __m64 v139; // mm2
  __m64 v140; // mm3
  __m64 v141; // mm0
  __m64 v142; // mm1
  __m64 v143; // mm2
  __m64 v144; // mm5
  __m64 v145; // mm3
  __m64 v146; // mm2
  __m64 v147; // mm7
  __m64 v148; // mm0
  __m64 v149; // mm3
  __m64 v150; // mm1
  __m64 v151; // mm2
  __m64 v152; // mm3
  __m64 v153; // mm0
  __m64 v154; // mm1
  __m64 v155; // mm2
  __m64 v156; // mm5
  __m64 v157; // mm3
  __m64 v158; // mm2
  __m64 v159; // mm7
  __m64 v160; // mm0
  __m64 v161; // mm3
  __m64 v162; // mm1
  __m64 v163; // mm2
  __m64 v164; // mm3
  __m64 v165; // mm0
  __m64 v166; // mm1
  __m64 v167; // mm2
  __m64 v168; // mm3
  __m64 v169; // mm2
  __m64 v170; // mm3
  __m64 v171; // mm2
  __m64 v172; // mm1
  __m64 v173; // mm2
  __m64 v174; // mm3
  __m64 v175; // mm0
  __m64 v176; // mm1
  __m64 v177; // mm2
  __m64 v178; // mm5
  __m64 v179; // mm3
  __m64 v180; // mm2
  __m64 v181; // mm7
  __m64 v182; // mm0
  __m64 v183; // mm3
  __m64 v184; // mm1
  __m64 v185; // mm2
  __m64 v186; // mm3
  __m64 v187; // mm0
  __m64 v188; // mm1
  __m64 v189; // mm2
  __m64 v190; // mm5
  __m64 v191; // mm3
  __m64 v192; // mm2
  __m64 v193; // mm7
  __m64 v194; // mm0
  __m64 v195; // mm3
  __m64 v196; // mm1
  __m64 v197; // mm2
  __m64 v198; // mm3
  __m64 v199; // mm0
  __m64 v200; // mm1
  __m64 v201; // mm2
  __m64 v202; // mm5
  __m64 v203; // mm3
  __m64 v204; // mm2
  __m64 v205; // mm7
  __m64 v206; // mm0
  __m64 v207; // mm3
  __m64 v208; // mm1
  __m64 v209; // mm2
  __m64 v210; // mm3
  __m64 v211; // mm0
  __m64 v212; // mm1
  __m64 v213; // mm2
  __m64 v214; // mm5
  __m64 v215; // mm3
  __m64 v216; // mm7
  __m64 v217; // mm2
  __m64 v218; // mm3
  __m64 v219; // mm1
  __m64 v220; // mm2
  __m64 v221; // mm3
  __m64 v222; // mm0
  __m64 v223; // mm1
  __m64 v224; // mm2
  __m64 v225; // mm5
  __m64 v226; // mm3
  __m64 v227; // mm2
  __m64 v228; // mm7
  __m64 v229; // mm0
  __m64 v230; // mm3
  __m64 v231; // mm1
  __m64 v232; // mm2
  __m64 v233; // mm3
  __m64 v234; // mm0
  __m64 v235; // mm1
  __m64 v236; // mm2
  __m64 v237; // mm5
  __m64 v238; // mm3
  __m64 v239; // mm2
  __m64 v240; // mm7
  __m64 v241; // mm0
  __m64 v242; // mm3
  __m64 v243; // mm1
  __m64 v244; // mm2
  __m64 v245; // mm3
  __m64 v246; // mm0
  __m64 v247; // mm1
  __m64 v248; // mm2
  __m64 v249; // mm5
  __m64 v250; // mm3
  __m64 v251; // mm2
  __m64 v252; // mm7
  __m64 v253; // mm0
  __m64 v254; // mm3
  __m64 v255; // mm1
  __m64 v256; // mm2
  __m64 v257; // mm3
  __m64 v258; // mm0
  __m64 v259; // mm1
  __m64 v260; // mm2
  __m64 v261; // mm3
  __m64 v262; // mm4
  __m64 v263; // mm5
  __m64 v264; // mm1
  __m64 v265; // mm2
  __m64 v266; // mm3
  __m64 v267; // mm0
  __m64 v268; // mm7
  __m64 v269; // mm2
  __m64 v270; // mm4
  __m64 v271; // mm3
  __m64 v272; // mm1
  __m64 v273; // mm5
  __m64 v274; // mm7
  __m64 v275; // mm6
  __m64 v276; // mm2
  __m64 v277; // mm1
  __m64 v278; // mm6
  __m64 v279; // mm7
  __m64 v280; // mm3
  __m64 v281; // mm2
  __m64 v282; // mm3
  __m64 v283; // mm5
  __m64 v284; // mm2
  __m64 v285; // mm6
  __m64 v286; // mm2
  __m64 v287; // mm3
  __m64 v288; // mm1
  __m64 v289; // mm1
  __m64 v290; // mm2
  __m64 v291; // mm3
  __m64 v292; // mm0
  __m64 v293; // mm1
  __m64 v294; // mm2
  __m64 v295; // mm5
  __m64 v296; // mm3
  __m64 v297; // mm2
  __m64 v298; // mm7
  __m64 v299; // mm0
  __m64 v300; // mm3
  __m64 v301; // mm1
  __m64 v302; // mm2
  __m64 v303; // mm3
  __m64 v304; // mm0
  __m64 v305; // mm1
  __m64 v306; // mm2
  __m64 v307; // mm5
  __m64 v308; // mm3
  __m64 v309; // mm2
  __m64 v310; // mm7
  __m64 v311; // mm0
  __m64 v312; // mm3
  __m64 v313; // mm1
  __m64 v314; // mm2
  __m64 v315; // mm3
  __m64 v316; // mm0
  __m64 v317; // mm1
  __m64 v318; // mm2
  __m64 v319; // mm5
  __m64 v320; // mm3
  __m64 v321; // mm2
  __m64 v322; // mm7
  __m64 v323; // mm0
  __m64 v324; // mm3
  __m64 v325; // mm1
  __m64 v326; // mm2
  __m64 v327; // mm3
  __m64 v328; // mm0
  __m64 v329; // mm1
  __m64 v330; // mm2
  __m64 v331; // mm3
  __m64 v332; // mm1
  __m64 v333; // mm1
  __m64 v334; // mm2
  __m64 v335; // mm3
  __m64 v336; // mm0
  __m64 v337; // mm1
  __m64 v338; // mm2
  __m64 v339; // mm5
  __m64 v340; // mm3
  __m64 v341; // mm2
  __m64 v342; // mm7
  __m64 v343; // mm0
  __m64 v344; // mm3
  __m64 v345; // mm1
  __m64 v346; // mm2
  __m64 v347; // mm3
  __m64 v348; // mm0
  __m64 v349; // mm1
  __m64 v350; // mm2
  __m64 v351; // mm5
  __m64 v352; // mm3
  __m64 v353; // mm2
  __m64 v354; // mm7
  __m64 v355; // mm0
  __m64 v356; // mm3
  __m64 v357; // mm1
  __m64 v358; // mm2
  __m64 v359; // mm3
  __m64 v360; // mm0
  __m64 v361; // mm1
  __m64 v362; // mm2
  __m64 v363; // mm5
  __m64 v364; // mm3
  __m64 v365; // mm2
  __m64 v366; // mm7
  __m64 v367; // mm0
  __m64 v368; // mm3
  __m64 v369; // mm1
  __m64 v370; // mm2
  __m64 v371; // mm3
  __m64 v372; // mm0
  __m64 v373; // mm1
  __m64 v374; // mm2
  __m64 v375; // mm3
  __m64 v376; // mm1
  __m64 v377; // [esp+0h] [ebp-C0h]
  __m64 v378; // [esp+10h] [ebp-B0h]
  __m64 v379; // [esp+28h] [ebp-98h]
  __m64 v380; // [esp+40h] [ebp-80h]
  __m64 v381; // [esp+40h] [ebp-80h]
  __m64 v382; // [esp+48h] [ebp-78h]
  __m64 v383; // [esp+48h] [ebp-78h]
  __m64 v384; // [esp+50h] [ebp-70h]
  __m64 v385; // [esp+50h] [ebp-70h]
  __m64 v386; // [esp+58h] [ebp-68h]
  __m64 v387; // [esp+58h] [ebp-68h]
  __m64 v388; // [esp+60h] [ebp-60h]
  __m64 v389; // [esp+60h] [ebp-60h]
  __m64 v390; // [esp+68h] [ebp-58h]
  __m64 v391; // [esp+68h] [ebp-58h]
  __m64 v392; // [esp+78h] [ebp-48h]
  __m64 v393; // [esp+78h] [ebp-48h]
  __m64 v394; // [esp+80h] [ebp-40h]
  __m64 v395; // [esp+88h] [ebp-38h]
  __m64 v396; // [esp+90h] [ebp-30h]
  __m64 v397; // [esp+98h] [ebp-28h]
  __m64 v398; // [esp+A0h] [ebp-20h]
  __m64 v399; // [esp+A8h] [ebp-18h]
  __m64 v400; // [esp+B0h] [ebp-10h]
  __m64 v401; // [esp+B8h] [ebp-8h]

  result = a1;
  if ( a4 )
  {
    if ( a3 )
    {
      v377 = _m_punpckldq((__m64)a4->m64_u64, 0);
      v378 = _m_punpckhdq(0, (__m64)a4->m64_u64);
      v379 = _mm_cvtsi32_si64(a4[1].m64_u32[0]);
      m64_u64 = (__m64)a3->m64_u64;
      v9 = _m_pfadd(m64_u64, m64_u64);
      v10 = a3[1];
      v11 = _m_punpckhdq(m64_u64, m64_u64);
      v12 = _m_punpckhdq(v10, v10);
      v13 = _m_pfmul((__m64)a3->m64_u64, v9);
      v14 = _m_punpckldq(_m_pfadd(v10, v10), v9);
      v15 = _m_pfmul(v9, v12);
      v16 = _m_pfmul(_m_punpckldq(v10, v10), v14);
      v17 = _m_pfmul(v14, v12);
      v18 = _m_pfmul(v14, v11);
      v19 = _m_punpckhdq(v18, v16);
      v20 = _m_punpckhdq(_m_punpckldq(v17, v17), v15);
      v21 = _m_pfsubr(_m_pfadd(_m_punpckldq(v16, v16), v13), (__m64)0x3F8000003F800000LL);
      v390 = _m_punpckldq(_m_pfsubr(_m_pfacc(v13, v13), (__m64)0x3F8000003F800000LL), 0);
      v22 = v18;
      v23 = _m_pfadd(v18, v15);
      v24 = _m_pfsub(v22, v15);
      v25 = _m_pfsub(v19, v20);
      v26 = _m_pfadd(v19, v20);
      v386 = _m_punpckldq(v23, 0);
      v382 = _m_punpckhdq(v25, 0);
      v384 = _m_punpckldq(v25, v21);
      v380 = _m_punpckhdq(v21, _m_punpckldq(v26, v26));
      v388 = _m_punpckldq(_m_punpckhdq(v26, v26), v24);
      v392 = _m_punpckldq(0, (__m64)1065353216LL);
      if ( a2 )
      {
        v394 = _m_punpckldq(v380, v384);
        v396 = _m_punpckhdq(v380, v384);
        v399 = _m_punpckldq(v390, v392);
        v401 = _m_punpckhdq(v390, v392);
        v398 = _m_punpckldq(v382, v386);
        v400 = _m_punpckhdq(v382, v386);
        v397 = _m_punpckhdq(v388, 0);
        v395 = _m_punpckldq(v388, 0);
        result = a1;
        v27 = (__m64)a2->m64_u64;
        v28 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
        v29 = _mm_cvtsi32_si64(0x3F800000u);
        v30 = _m_punpckldq(_m_punpckhdq(v29, v29), v29);
        a1->m64_u64 = (unsigned __int64)v29;
        a1[1].m64_u64 = 0;
        a1[2].m64_u64 = (unsigned __int64)v30;
        a1[3].m64_u64 = 0;
        a1[4].m64_u64 = 0;
        a1[5].m64_u64 = (unsigned __int64)v29;
        v31 = _m_pfsub(v30, v28);
        a1[7].m64_u64 = (unsigned __int64)v31;
        a1[6].m64_u64 = (unsigned __int64)_m_pfsub(0, v27);
        v32 = a1[1];
        v33 = _m_punpckhdq(v31, (__m64)a1->m64_u64);
        v34 = _m_punpckhdq(v27, v32);
        v35 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v36 = _m_punpckldq(v32, v32);
        v37 = _m_punpckhdq(v33, v33);
        v38 = _m_pfmul(v396, v37);
        v39 = _m_punpckhdq(v34, v34);
        v40 = _m_pfadd(_m_pfadd(_m_pfmul(v37, v397), _m_pfmul(v35, v395)), _m_pfmul(v36, v399));
        v41 = _m_pfadd(_m_pfmul(v400, v39), _m_pfadd(_m_pfmul(v398, v36), _m_pfadd(v38, _m_pfmul(v394, v35))));
        v42 = a1[2];
        v43 = _m_pfadd(_m_pfmul(v39, v401), v40);
        v44 = a1[3];
        a1->m64_u64 = (unsigned __int64)v41;
        a1[1].m64_u64 = (unsigned __int64)v43;
        v45 = _m_punpckhdq(v40, v42);
        v46 = _m_punpckhdq(v43, v44);
        v47 = _m_punpckldq(v42, v42);
        v48 = _m_punpckldq(v44, v44);
        v49 = _m_punpckhdq(v45, v45);
        v50 = _m_pfmul(v396, v49);
        v51 = _m_punpckhdq(v46, v46);
        v52 = _m_pfadd(_m_pfadd(_m_pfmul(v49, v397), _m_pfmul(v47, v395)), _m_pfmul(v48, v399));
        v53 = _m_pfadd(_m_pfmul(v400, v51), _m_pfadd(_m_pfmul(v398, v48), _m_pfadd(v50, _m_pfmul(v394, v47))));
        v54 = a1[4];
        v55 = _m_pfadd(_m_pfmul(v51, v401), v52);
        v56 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v53;
        a1[3].m64_u64 = (unsigned __int64)v55;
        v57 = _m_punpckhdq(v52, v54);
        v58 = _m_punpckhdq(v55, v56);
        v59 = _m_punpckldq(v54, v54);
        v60 = _m_punpckldq(v56, v56);
        v61 = _m_punpckhdq(v57, v57);
        v62 = _m_pfmul(v396, v61);
        v63 = _m_punpckhdq(v58, v58);
        v64 = _m_pfadd(_m_pfadd(_m_pfmul(v61, v397), _m_pfmul(v59, v395)), _m_pfmul(v60, v399));
        v65 = _m_pfadd(_m_pfmul(v400, v63), _m_pfadd(_m_pfmul(v398, v60), _m_pfadd(v62, _m_pfmul(v394, v59))));
        v66 = a1[6];
        v67 = _m_pfadd(_m_pfmul(v63, v401), v64);
        v68 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v65;
        a1[5].m64_u64 = (unsigned __int64)v67;
        v69 = _m_punpckhdq(v64, v66);
        v70 = _m_punpckhdq(v67, v68);
        v71 = _m_punpckldq(v66, v66);
        v72 = _m_punpckldq(v68, v68);
        v73 = _m_punpckhdq(v69, v69);
        v74 = _m_pfmul(v396, v73);
        v75 = _m_punpckhdq(v70, v70);
        v76 = _m_pfmul(v400, v75);
        v77 = _m_pfadd(_m_pfadd(_m_pfmul(v73, v397), _m_pfmul(v71, v395)), _m_pfmul(v72, v399));
        v78 = _m_pfadd(_m_pfmul(v75, v401), v77);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            v76,
                                            _m_pfadd(_m_pfmul(v398, v72), _m_pfadd(v74, _m_pfmul(v394, v71))));
        a1[7].m64_u64 = (unsigned __int64)v78;
        v79 = a1[1];
        v80 = _m_punpckhdq(v77, (__m64)a1->m64_u64);
        v81 = _m_punpckhdq(v78, v79);
        v82 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v83 = _m_punpckldq(v79, v79);
        v84 = _m_punpckhdq(v80, v80);
        v85 = _m_pfmul(v378, v84);
        v86 = _m_punpckhdq(v81, v81);
        v87 = _m_pfadd(_m_pfadd(_m_pfmul(v84, 0), _m_pfmul(v82, 0)), _m_pfmul(v83, v379));
        v88 = _m_pfadd(_m_pfmul(0, v86), _m_pfadd(_m_pfmul(0, v83), _m_pfadd(v85, _m_pfmul(v377, v82))));
        v89 = a1[2];
        v90 = _m_pfadd(_m_pfmul(v86, (__m64)0x3F80000000000000LL), v87);
        v91 = a1[3];
        a1->m64_u64 = (unsigned __int64)v88;
        a1[1].m64_u64 = (unsigned __int64)v90;
        v92 = _m_punpckhdq(v87, v89);
        v93 = _m_punpckhdq(v90, v91);
        v94 = _m_punpckldq(v89, v89);
        v95 = _m_punpckldq(v91, v91);
        v96 = _m_punpckhdq(v92, v92);
        v97 = _m_pfmul(v378, v96);
        v98 = _m_punpckhdq(v93, v93);
        v99 = _m_pfadd(_m_pfadd(_m_pfmul(v96, 0), _m_pfmul(v94, 0)), _m_pfmul(v95, v379));
        v100 = _m_pfadd(_m_pfmul(0, v98), _m_pfadd(_m_pfmul(0, v95), _m_pfadd(v97, _m_pfmul(v377, v94))));
        v101 = a1[4];
        v102 = _m_pfadd(_m_pfmul(v98, (__m64)0x3F80000000000000LL), v99);
        v103 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v100;
        a1[3].m64_u64 = (unsigned __int64)v102;
        v104 = _m_punpckhdq(v99, v101);
        v105 = _m_punpckhdq(v102, v103);
        v106 = _m_punpckldq(v101, v101);
        v107 = _m_punpckldq(v103, v103);
        v108 = _m_punpckhdq(v104, v104);
        v109 = _m_pfmul(v378, v108);
        v110 = _m_punpckhdq(v105, v105);
        v111 = _m_pfadd(_m_pfadd(_m_pfmul(v108, 0), _m_pfmul(v106, 0)), _m_pfmul(v107, v379));
        v112 = _m_pfadd(_m_pfmul(0, v110), _m_pfadd(_m_pfmul(0, v107), _m_pfadd(v109, _m_pfmul(v377, v106))));
        v113 = a1[6];
        v114 = _m_pfadd(_m_pfmul(v110, (__m64)0x3F80000000000000LL), v111);
        v115 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v112;
        a1[5].m64_u64 = (unsigned __int64)v114;
        v116 = _m_punpckhdq(v111, v113);
        v117 = _m_punpckhdq(v114, v115);
        v118 = _m_punpckldq(v113, v113);
        v119 = _m_punpckldq(v115, v115);
        v120 = _m_punpckhdq(v116, v116);
        v121 = _m_pfmul(v378, v120);
        v122 = _m_punpckhdq(v117, v117);
        v123 = _m_pfmul(0, v122);
        v124 = _m_pfadd(_m_pfadd(_m_pfmul(v120, 0), _m_pfmul(v118, 0)), _m_pfmul(v119, v379));
        v125 = _m_pfadd(_m_pfmul(v122, (__m64)0x3F80000000000000LL), v124);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            v123,
                                            _m_pfadd(_m_pfmul(0, v119), _m_pfadd(v121, _m_pfmul(v377, v118))));
        a1[7].m64_u64 = (unsigned __int64)v125;
        v126 = a1[1];
        v127 = _m_punpckhdq(v124, (__m64)a1->m64_u64);
        v128 = _m_punpckhdq(v125, v126);
        v129 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v130 = _m_punpckldq(v126, v126);
        v131 = _m_punpckhdq(v127, v127);
        v132 = _m_pfmul(v384, v131);
        v133 = _m_punpckhdq(v128, v128);
        v134 = _m_pfadd(_m_pfadd(_m_pfmul(v131, v386), _m_pfmul(v129, v382)), _m_pfmul(v130, v390));
        v135 = _m_pfadd(_m_pfmul(0, v133), _m_pfadd(_m_pfmul(v388, v130), _m_pfadd(v132, _m_pfmul(v380, v129))));
        v136 = a1[2];
        v137 = _m_pfadd(_m_pfmul(v133, v392), v134);
        v138 = a1[3];
        a1->m64_u64 = (unsigned __int64)v135;
        a1[1].m64_u64 = (unsigned __int64)v137;
        v139 = _m_punpckhdq(v134, v136);
        v140 = _m_punpckhdq(v137, v138);
        v141 = _m_punpckldq(v136, v136);
        v142 = _m_punpckldq(v138, v138);
        v143 = _m_punpckhdq(v139, v139);
        v144 = _m_pfmul(v384, v143);
        v145 = _m_punpckhdq(v140, v140);
        v146 = _m_pfadd(_m_pfadd(_m_pfmul(v143, v386), _m_pfmul(v141, v382)), _m_pfmul(v142, v390));
        v147 = _m_pfadd(_m_pfmul(0, v145), _m_pfadd(_m_pfmul(v388, v142), _m_pfadd(v144, _m_pfmul(v380, v141))));
        v148 = a1[4];
        v149 = _m_pfadd(_m_pfmul(v145, v392), v146);
        v150 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v147;
        a1[3].m64_u64 = (unsigned __int64)v149;
        v151 = _m_punpckhdq(v146, v148);
        v152 = _m_punpckhdq(v149, v150);
        v153 = _m_punpckldq(v148, v148);
        v154 = _m_punpckldq(v150, v150);
        v155 = _m_punpckhdq(v151, v151);
        v156 = _m_pfmul(v384, v155);
        v157 = _m_punpckhdq(v152, v152);
        v158 = _m_pfadd(_m_pfadd(_m_pfmul(v155, v386), _m_pfmul(v153, v382)), _m_pfmul(v154, v390));
        v159 = _m_pfadd(_m_pfmul(0, v157), _m_pfadd(_m_pfmul(v388, v154), _m_pfadd(v156, _m_pfmul(v380, v153))));
        v160 = a1[6];
        v161 = _m_pfadd(_m_pfmul(v157, v392), v158);
        v162 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v159;
        a1[5].m64_u64 = (unsigned __int64)v161;
        v163 = _m_punpckhdq(v158, v160);
        v164 = _m_punpckhdq(v161, v162);
        v165 = _m_punpckldq(v160, v160);
        v166 = _m_punpckldq(v162, v162);
        v167 = _m_punpckhdq(v163, v163);
        v168 = _m_punpckhdq(v164, v164);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            _m_pfmul(0, v168),
                                            _m_pfadd(
                                              _m_pfmul(v388, v166),
                                              _m_pfadd(_m_pfmul(v384, v167), _m_pfmul(v380, v165))));
        a1[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                            _m_pfmul(v168, v392),
                                            _m_pfadd(
                                              _m_pfadd(_m_pfmul(v167, v386), _m_pfmul(v165, v382)),
                                              _m_pfmul(v166, v390)));
        v169 = _m_pfadd(_mm_cvtsi32_si64(a2[1].m64_u32[0]), _mm_cvtsi32_si64(a1[7].m64_u32[0]));
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd((__m64)a2->m64_u64, a1[6]);
        a1[7].m64_i32[0] = _mm_cvtsi64_si32(v169);
      }
      else
      {
        result = a1;
        a1->m64_u64 = (unsigned __int64)_m_punpckldq(v380, v384);
        a1[2].m64_u64 = (unsigned __int64)_m_punpckhdq(v380, v384);
        v170 = _m_punpckldq(v390, v392);
        a1[5].m64_u64 = (unsigned __int64)v170;
        a1[7].m64_u64 = (unsigned __int64)_m_punpckhdq(v390, v392);
        a1[4].m64_u64 = (unsigned __int64)_m_punpckldq(v382, v386);
        v171 = _m_punpckldq(v388, 0);
        a1[6].m64_u64 = (unsigned __int64)_m_punpckhdq(v382, v386);
        a1[3].m64_u64 = (unsigned __int64)_m_punpckhdq(v388, 0);
        a1[1].m64_u64 = (unsigned __int64)v171;
        v172 = a1[1];
        v173 = _m_punpckhdq(v171, (__m64)a1->m64_u64);
        v174 = _m_punpckhdq(v170, v172);
        v175 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v176 = _m_punpckldq(v172, v172);
        v177 = _m_punpckhdq(v173, v173);
        v178 = _m_pfmul(v378, v177);
        v179 = _m_punpckhdq(v174, v174);
        v180 = _m_pfadd(_m_pfadd(_m_pfmul(v177, 0), _m_pfmul(v175, 0)), _m_pfmul(v176, v379));
        v181 = _m_pfadd(_m_pfmul(0, v179), _m_pfadd(_m_pfmul(0, v176), _m_pfadd(v178, _m_pfmul(v377, v175))));
        v182 = a1[2];
        v183 = _m_pfadd(_m_pfmul(v179, (__m64)0x3F80000000000000LL), v180);
        v184 = a1[3];
        a1->m64_u64 = (unsigned __int64)v181;
        a1[1].m64_u64 = (unsigned __int64)v183;
        v185 = _m_punpckhdq(v180, v182);
        v186 = _m_punpckhdq(v183, v184);
        v187 = _m_punpckldq(v182, v182);
        v188 = _m_punpckldq(v184, v184);
        v189 = _m_punpckhdq(v185, v185);
        v190 = _m_pfmul(v378, v189);
        v191 = _m_punpckhdq(v186, v186);
        v192 = _m_pfadd(_m_pfadd(_m_pfmul(v189, 0), _m_pfmul(v187, 0)), _m_pfmul(v188, v379));
        v193 = _m_pfadd(_m_pfmul(0, v191), _m_pfadd(_m_pfmul(0, v188), _m_pfadd(v190, _m_pfmul(v377, v187))));
        v194 = a1[4];
        v195 = _m_pfadd(_m_pfmul(v191, (__m64)0x3F80000000000000LL), v192);
        v196 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v193;
        a1[3].m64_u64 = (unsigned __int64)v195;
        v197 = _m_punpckhdq(v192, v194);
        v198 = _m_punpckhdq(v195, v196);
        v199 = _m_punpckldq(v194, v194);
        v200 = _m_punpckldq(v196, v196);
        v201 = _m_punpckhdq(v197, v197);
        v202 = _m_pfmul(v378, v201);
        v203 = _m_punpckhdq(v198, v198);
        v204 = _m_pfadd(_m_pfadd(_m_pfmul(v201, 0), _m_pfmul(v199, 0)), _m_pfmul(v200, v379));
        v205 = _m_pfadd(_m_pfmul(0, v203), _m_pfadd(_m_pfmul(0, v200), _m_pfadd(v202, _m_pfmul(v377, v199))));
        v206 = a1[6];
        v207 = _m_pfadd(_m_pfmul(v203, (__m64)0x3F80000000000000LL), v204);
        v208 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v205;
        a1[5].m64_u64 = (unsigned __int64)v207;
        v209 = _m_punpckhdq(v204, v206);
        v210 = _m_punpckhdq(v207, v208);
        v211 = _m_punpckldq(v206, v206);
        v212 = _m_punpckldq(v208, v208);
        v213 = _m_punpckhdq(v209, v209);
        v214 = _m_pfmul(v378, v213);
        v215 = _m_punpckhdq(v210, v210);
        v216 = _m_pfmul(0, v215);
        v217 = _m_pfadd(_m_pfadd(_m_pfmul(v213, 0), _m_pfmul(v211, 0)), _m_pfmul(v212, v379));
        v218 = _m_pfadd(_m_pfmul(v215, (__m64)0x3F80000000000000LL), v217);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            v216,
                                            _m_pfadd(_m_pfmul(0, v212), _m_pfadd(v214, _m_pfmul(v377, v211))));
        a1[7].m64_u64 = (unsigned __int64)v218;
        v219 = a1[1];
        v220 = _m_punpckhdq(v217, (__m64)a1->m64_u64);
        v221 = _m_punpckhdq(v218, v219);
        v222 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v223 = _m_punpckldq(v219, v219);
        v224 = _m_punpckhdq(v220, v220);
        v225 = _m_pfmul(v384, v224);
        v226 = _m_punpckhdq(v221, v221);
        v227 = _m_pfadd(_m_pfadd(_m_pfmul(v224, v386), _m_pfmul(v222, v382)), _m_pfmul(v223, v390));
        v228 = _m_pfadd(_m_pfmul(0, v226), _m_pfadd(_m_pfmul(v388, v223), _m_pfadd(v225, _m_pfmul(v380, v222))));
        v229 = a1[2];
        v230 = _m_pfadd(_m_pfmul(v226, v392), v227);
        v231 = a1[3];
        a1->m64_u64 = (unsigned __int64)v228;
        a1[1].m64_u64 = (unsigned __int64)v230;
        v232 = _m_punpckhdq(v227, v229);
        v233 = _m_punpckhdq(v230, v231);
        v234 = _m_punpckldq(v229, v229);
        v235 = _m_punpckldq(v231, v231);
        v236 = _m_punpckhdq(v232, v232);
        v237 = _m_pfmul(v384, v236);
        v238 = _m_punpckhdq(v233, v233);
        v239 = _m_pfadd(_m_pfadd(_m_pfmul(v236, v386), _m_pfmul(v234, v382)), _m_pfmul(v235, v390));
        v240 = _m_pfadd(_m_pfmul(0, v238), _m_pfadd(_m_pfmul(v388, v235), _m_pfadd(v237, _m_pfmul(v380, v234))));
        v241 = a1[4];
        v242 = _m_pfadd(_m_pfmul(v238, v392), v239);
        v243 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v240;
        a1[3].m64_u64 = (unsigned __int64)v242;
        v244 = _m_punpckhdq(v239, v241);
        v245 = _m_punpckhdq(v242, v243);
        v246 = _m_punpckldq(v241, v241);
        v247 = _m_punpckldq(v243, v243);
        v248 = _m_punpckhdq(v244, v244);
        v249 = _m_pfmul(v384, v248);
        v250 = _m_punpckhdq(v245, v245);
        v251 = _m_pfadd(_m_pfadd(_m_pfmul(v248, v386), _m_pfmul(v246, v382)), _m_pfmul(v247, v390));
        v252 = _m_pfadd(_m_pfmul(0, v250), _m_pfadd(_m_pfmul(v388, v247), _m_pfadd(v249, _m_pfmul(v380, v246))));
        v253 = a1[6];
        v254 = _m_pfadd(_m_pfmul(v250, v392), v251);
        v255 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v252;
        a1[5].m64_u64 = (unsigned __int64)v254;
        v256 = _m_punpckhdq(v251, v253);
        v257 = _m_punpckhdq(v254, v255);
        v258 = _m_punpckldq(v253, v253);
        v259 = _m_punpckldq(v255, v255);
        v260 = _m_punpckhdq(v256, v256);
        v261 = _m_punpckhdq(v257, v257);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            _m_pfmul(0, v261),
                                            _m_pfadd(
                                              _m_pfmul(v388, v259),
                                              _m_pfadd(_m_pfmul(v384, v260), _m_pfmul(v380, v258))));
        a1[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                            _m_pfmul(v261, v392),
                                            _m_pfadd(
                                              _m_pfadd(_m_pfmul(v260, v386), _m_pfmul(v258, v382)),
                                              _m_pfmul(v259, v390)));
      }
    }
    else
    {
      v262 = _mm_cvtsi32_si64(a4[1].m64_u32[0]);
      v263 = _m_punpckhdq(0, (__m64)a4->m64_u64);
      a1->m64_u64 = (unsigned __int64)_m_punpckldq((__m64)a4->m64_u64, 0);
      a1[1].m64_u64 = 0;
      a1[2].m64_u64 = (unsigned __int64)v263;
      a1[3].m64_u64 = 0;
      a1[4].m64_u64 = 0;
      a1[5].m64_u64 = (unsigned __int64)v262;
      a1[6].m64_u64 = 0;
      a1[7].m64_u64 = 0x3F80000000000000LL;
    }
  }
  else
  {
    v264 = _mm_cvtsi32_si64(0x3F800000u);
    v265 = _m_punpckldq(_m_punpckhdq(v264, v264), v264);
    a1->m64_u64 = (unsigned __int64)v264;
    a1[1].m64_u64 = 0;
    a1[2].m64_u64 = (unsigned __int64)v265;
    a1[3].m64_u64 = 0;
    a1[4].m64_u64 = 0;
    a1[5].m64_u64 = (unsigned __int64)v264;
    a1[6].m64_u64 = 0;
    a1[7].m64_u64 = (unsigned __int64)v265;
  }
  if ( a6 )
  {
    v266 = (__m64)a6->m64_u64;
    v267 = _m_pfadd(v266, v266);
    v268 = a6[1];
    v269 = _m_punpckhdq(v266, v266);
    v270 = _m_punpckhdq(v268, v268);
    v271 = _m_pfmul((__m64)a6->m64_u64, v267);
    v272 = _m_punpckldq(_m_pfadd(v268, v268), v267);
    v273 = _m_pfmul(v267, v270);
    v274 = _m_pfmul(_m_punpckldq(v268, v268), v272);
    v275 = _m_pfmul(v272, v270);
    v276 = _m_pfmul(v272, v269);
    v277 = _m_punpckhdq(v276, v274);
    v278 = _m_punpckhdq(_m_punpckldq(v275, v275), v273);
    v279 = _m_pfsubr(_m_pfadd(_m_punpckldq(v274, v274), v271), (__m64)0x3F8000003F800000LL);
    v391 = _m_punpckldq(_m_pfsubr(_m_pfacc(v271, v271), (__m64)0x3F8000003F800000LL), 0);
    v280 = v276;
    v281 = _m_pfadd(v276, v273);
    v282 = _m_pfsub(v280, v273);
    v283 = _m_pfsub(v277, v278);
    v284 = _m_punpckldq(v281, 0);
    v285 = _m_pfadd(v277, v278);
    v387 = v284;
    v383 = _m_punpckhdq(v283, 0);
    v385 = _m_punpckldq(v283, v279);
    v381 = _m_punpckhdq(v279, _m_punpckldq(v285, v285));
    v389 = _m_punpckldq(_m_punpckhdq(v285, v285), v282);
    v393 = _m_punpckldq(0, (__m64)1065353216LL);
    if ( a5 )
    {
      v286 = (__m64)a5->m64_u64;
      v287 = _mm_cvtsi32_si64(a5[1].m64_u32[0]);
      v288 = _m_pfsub(_mm_cvtsi32_si64(result[7].m64_u32[0]), v287);
      result[6].m64_u64 = (unsigned __int64)_m_pfsub(result[6], (__m64)a5->m64_u64);
      result[7].m64_i32[0] = _mm_cvtsi64_si32(v288);
      v289 = result[1];
      v290 = _m_punpckhdq(v286, (__m64)result->m64_u64);
      v291 = _m_punpckhdq(v287, v289);
      v292 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
      v293 = _m_punpckldq(v289, v289);
      v294 = _m_punpckhdq(v290, v290);
      v295 = _m_pfmul(v385, v294);
      v296 = _m_punpckhdq(v291, v291);
      v297 = _m_pfadd(_m_pfadd(_m_pfmul(v294, v387), _m_pfmul(v292, v383)), _m_pfmul(v293, v391));
      v298 = _m_pfadd(_m_pfmul(0, v296), _m_pfadd(_m_pfmul(v389, v293), _m_pfadd(v295, _m_pfmul(v381, v292))));
      v299 = result[2];
      v300 = _m_pfadd(_m_pfmul(v296, v393), v297);
      v301 = result[3];
      result->m64_u64 = (unsigned __int64)v298;
      result[1].m64_u64 = (unsigned __int64)v300;
      v302 = _m_punpckhdq(v297, v299);
      v303 = _m_punpckhdq(v300, v301);
      v304 = _m_punpckldq(v299, v299);
      v305 = _m_punpckldq(v301, v301);
      v306 = _m_punpckhdq(v302, v302);
      v307 = _m_pfmul(v385, v306);
      v308 = _m_punpckhdq(v303, v303);
      v309 = _m_pfadd(_m_pfadd(_m_pfmul(v306, v387), _m_pfmul(v304, v383)), _m_pfmul(v305, v391));
      v310 = _m_pfadd(_m_pfmul(0, v308), _m_pfadd(_m_pfmul(v389, v305), _m_pfadd(v307, _m_pfmul(v381, v304))));
      v311 = result[4];
      v312 = _m_pfadd(_m_pfmul(v308, v393), v309);
      v313 = result[5];
      result[2].m64_u64 = (unsigned __int64)v310;
      result[3].m64_u64 = (unsigned __int64)v312;
      v314 = _m_punpckhdq(v309, v311);
      v315 = _m_punpckhdq(v312, v313);
      v316 = _m_punpckldq(v311, v311);
      v317 = _m_punpckldq(v313, v313);
      v318 = _m_punpckhdq(v314, v314);
      v319 = _m_pfmul(v385, v318);
      v320 = _m_punpckhdq(v315, v315);
      v321 = _m_pfadd(_m_pfadd(_m_pfmul(v318, v387), _m_pfmul(v316, v383)), _m_pfmul(v317, v391));
      v322 = _m_pfadd(_m_pfmul(0, v320), _m_pfadd(_m_pfmul(v389, v317), _m_pfadd(v319, _m_pfmul(v381, v316))));
      v323 = result[6];
      v324 = _m_pfadd(_m_pfmul(v320, v393), v321);
      v325 = result[7];
      result[4].m64_u64 = (unsigned __int64)v322;
      result[5].m64_u64 = (unsigned __int64)v324;
      v326 = _m_punpckhdq(v321, v323);
      v327 = _m_punpckhdq(v324, v325);
      v328 = _m_punpckldq(v323, v323);
      v329 = _m_punpckldq(v325, v325);
      v330 = _m_punpckhdq(v326, v326);
      v331 = _m_punpckhdq(v327, v327);
      result[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                              _m_pfmul(0, v331),
                                              _m_pfadd(
                                                _m_pfmul(v389, v329),
                                                _m_pfadd(_m_pfmul(v385, v330), _m_pfmul(v381, v328))));
      result[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                              _m_pfmul(v331, v393),
                                              _m_pfadd(
                                                _m_pfadd(_m_pfmul(v330, v387), _m_pfmul(v328, v383)),
                                                _m_pfmul(v329, v391)));
      v332 = _m_pfadd(_mm_cvtsi32_si64(result[7].m64_u32[0]), _mm_cvtsi32_si64(a5[1].m64_u32[0]));
      result[6].m64_u64 = (unsigned __int64)_m_pfadd(result[6], (__m64)a5->m64_u64);
      result[7].m64_i32[0] = _mm_cvtsi64_si32(v332);
    }
    else
    {
      v333 = result[1];
      v334 = _m_punpckhdq(v284, (__m64)result->m64_u64);
      v335 = _m_punpckhdq(v282, v333);
      v336 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
      v337 = _m_punpckldq(v333, v333);
      v338 = _m_punpckhdq(v334, v334);
      v339 = _m_pfmul(v385, v338);
      v340 = _m_punpckhdq(v335, v335);
      v341 = _m_pfadd(_m_pfadd(_m_pfmul(v338, v387), _m_pfmul(v336, v383)), _m_pfmul(v337, v391));
      v342 = _m_pfadd(_m_pfmul(0, v340), _m_pfadd(_m_pfmul(v389, v337), _m_pfadd(v339, _m_pfmul(v381, v336))));
      v343 = result[2];
      v344 = _m_pfadd(_m_pfmul(v340, v393), v341);
      v345 = result[3];
      result->m64_u64 = (unsigned __int64)v342;
      result[1].m64_u64 = (unsigned __int64)v344;
      v346 = _m_punpckhdq(v341, v343);
      v347 = _m_punpckhdq(v344, v345);
      v348 = _m_punpckldq(v343, v343);
      v349 = _m_punpckldq(v345, v345);
      v350 = _m_punpckhdq(v346, v346);
      v351 = _m_pfmul(v385, v350);
      v352 = _m_punpckhdq(v347, v347);
      v353 = _m_pfadd(_m_pfadd(_m_pfmul(v350, v387), _m_pfmul(v348, v383)), _m_pfmul(v349, v391));
      v354 = _m_pfadd(_m_pfmul(0, v352), _m_pfadd(_m_pfmul(v389, v349), _m_pfadd(v351, _m_pfmul(v381, v348))));
      v355 = result[4];
      v356 = _m_pfadd(_m_pfmul(v352, v393), v353);
      v357 = result[5];
      result[2].m64_u64 = (unsigned __int64)v354;
      result[3].m64_u64 = (unsigned __int64)v356;
      v358 = _m_punpckhdq(v353, v355);
      v359 = _m_punpckhdq(v356, v357);
      v360 = _m_punpckldq(v355, v355);
      v361 = _m_punpckldq(v357, v357);
      v362 = _m_punpckhdq(v358, v358);
      v363 = _m_pfmul(v385, v362);
      v364 = _m_punpckhdq(v359, v359);
      v365 = _m_pfadd(_m_pfadd(_m_pfmul(v362, v387), _m_pfmul(v360, v383)), _m_pfmul(v361, v391));
      v366 = _m_pfadd(_m_pfmul(0, v364), _m_pfadd(_m_pfmul(v389, v361), _m_pfadd(v363, _m_pfmul(v381, v360))));
      v367 = result[6];
      v368 = _m_pfadd(_m_pfmul(v364, v393), v365);
      v369 = result[7];
      result[4].m64_u64 = (unsigned __int64)v366;
      result[5].m64_u64 = (unsigned __int64)v368;
      v370 = _m_punpckhdq(v365, v367);
      v371 = _m_punpckhdq(v368, v369);
      v372 = _m_punpckldq(v367, v367);
      v373 = _m_punpckldq(v369, v369);
      v374 = _m_punpckhdq(v370, v370);
      v375 = _m_punpckhdq(v371, v371);
      result[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                              _m_pfmul(0, v375),
                                              _m_pfadd(
                                                _m_pfmul(v389, v373),
                                                _m_pfadd(_m_pfmul(v385, v374), _m_pfmul(v381, v372))));
      result[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                              _m_pfmul(v375, v393),
                                              _m_pfadd(
                                                _m_pfadd(_m_pfmul(v374, v387), _m_pfmul(v372, v383)),
                                                _m_pfmul(v373, v391)));
    }
  }
  if ( a7 )
  {
    v376 = _m_pfadd(_mm_cvtsi32_si64(result[7].m64_u32[0]), _mm_cvtsi32_si64(a7[1].m64_u32[0]));
    result[6].m64_u64 = (unsigned __int64)_m_pfadd(result[6], (__m64)a7->m64_u64);
    result[7].m64_i32[0] = _mm_cvtsi64_si32(v376);
  }
  _m_femms();
  return result;
}

// sub_45C3EA @ 0x0045C3EA
__m64 *__userpurge sub_45C3EA@<eax>(__m64 *a1, __m64 a2, __m64 a3)
{
  __m64 v3; // mm0
  __m64 v4; // mm6
  __m64 v5; // mm2
  __m64 v6; // mm6
  __m64 v7; // mm7
  __m64 v9; // mm3
  __m64 v10; // mm0
  __m64 v11; // mm7
  __m64 v12; // mm2
  __m64 v13; // mm4
  __m64 v14; // mm3
  __m64 v15; // mm1
  __m64 v16; // mm5
  __m64 v17; // mm7
  __m64 v18; // mm6
  __m64 v19; // mm2
  __m64 v20; // mm1
  __m64 v21; // mm6
  __m64 v22; // mm7
  __m64 v23; // mm3
  __m64 v24; // mm2
  __m64 v25; // mm3
  __m64 v26; // mm5
  __m64 v27; // mm6
  __m64 v28; // [esp+8h] [ebp-28h]
  __m64 v29; // [esp+28h] [ebp-8h]

  math_sincos_packed();
  v28 = _m_pfmul((__m64)0x3F0000003F000000LL, a3);
  math_sincos_packed();
  v3 = _m_pfmul((__m64)0x3F0000003F000000LL, a2);
  math_sincos_packed();
  v4 = _m_punpckhdq(v3, v3);
  v5 = _m_punpckldq(v4, v4);
  v6 = _m_punpckhdq(v4, v4);
  v7 = _m_punpckldq(_m_punpckhdq(v28, v28), v28);
  v29 = _m_pfadd(
          _m_pfmul(_m_pfmul(_m_punpckldq(v3, v3), v5), v7),
          _m_pfmul(_m_pfmul(_m_pxor(_m_punpckhdq(v3, v3), _m_psrlqi((__m64)0x8000000000000000uLL, 0x20u)), v6), v28));
  v9 = _m_pfadd(
         _m_pfmul(_m_pfmul(_m_pxor(_m_punpckldq(v3, v3), (__m64)0x8000000000000000uLL), v6), v28),
         _m_pfmul(_m_pfmul(_m_punpckhdq(v3, v3), v5), v7));
  v10 = _m_pfadd(v9, v9);
  v11 = v29;
  v12 = _m_punpckhdq(v9, v9);
  v13 = _m_punpckhdq(v11, v11);
  v14 = _m_pfmul(v9, v10);
  v15 = _m_punpckldq(_m_pfadd(v11, v11), v10);
  v16 = _m_pfmul(v10, v13);
  v17 = _m_pfmul(_m_punpckldq(v11, v11), v15);
  v18 = _m_pfmul(v15, v13);
  v19 = _m_pfmul(v15, v12);
  v20 = _m_punpckhdq(v19, v17);
  a1[6].m64_u64 = 0;
  v21 = _m_punpckhdq(_m_punpckldq(v18, v18), v16);
  v22 = _m_pfsubr(_m_pfadd(_m_punpckldq(v17, v17), v14), (__m64)0x3F8000003F800000LL);
  a1[5].m64_u64 = (unsigned __int64)_m_punpckldq(_m_pfsubr(_m_pfacc(v14, v14), (__m64)0x3F8000003F800000LL), 0);
  v23 = v19;
  v24 = _m_pfadd(v19, v16);
  v25 = _m_pfsub(v23, v16);
  v26 = _m_pfsub(v20, v21);
  v27 = _m_pfadd(v20, v21);
  a1[3].m64_u64 = (unsigned __int64)_m_punpckldq(v24, 0);
  a1[1].m64_u64 = (unsigned __int64)_m_punpckhdq(v26, 0);
  a1[2].m64_u64 = (unsigned __int64)_m_punpckldq(v26, v22);
  a1->m64_u64 = (unsigned __int64)_m_punpckhdq(v22, _m_punpckldq(v27, v27));
  a1[4].m64_u64 = (unsigned __int64)_m_punpckldq(_m_punpckhdq(v27, v27), v25);
  a1[7].m64_u64 = (unsigned __int64)_m_punpckldq(0, (__m64)1065353216LL);
  _m_femms();
  return a1;
}

// sub_45C58F @ 0x0045C58F
__m64 *__stdcall sub_45C58F(__m64 *a1, unsigned int a2, __m64 *a3, __m64 *a4, __m64 *a5)
{
  __m64 *result; // eax
  __m64 v6; // mm6
  __m64 m64_u64; // mm3
  __m64 v8; // mm0
  __m64 v9; // mm7
  __m64 v10; // mm2
  __m64 v11; // mm4
  __m64 v12; // mm3
  __m64 v13; // mm1
  __m64 v14; // mm5
  __m64 v15; // mm7
  __m64 v16; // mm6
  __m64 v17; // mm2
  __m64 v18; // mm1
  __m64 v19; // mm6
  __m64 v20; // mm7
  __m64 v21; // mm3
  __m64 v22; // mm2
  __m64 v23; // mm3
  __m64 v24; // mm5
  __m64 v25; // mm2
  __m64 v26; // mm6
  __m64 v27; // mm2
  __m64 v28; // mm3
  __m64 v29; // mm1
  __m64 v30; // mm1
  __m64 v31; // mm2
  __m64 v32; // mm3
  __m64 v33; // mm0
  __m64 v34; // mm1
  __m64 v35; // mm2
  __m64 v36; // mm5
  __m64 v37; // mm3
  __m64 v38; // mm2
  __m64 v39; // mm7
  __m64 v40; // mm0
  __m64 v41; // mm3
  __m64 v42; // mm1
  __m64 v43; // mm2
  __m64 v44; // mm3
  __m64 v45; // mm0
  __m64 v46; // mm1
  __m64 v47; // mm2
  __m64 v48; // mm5
  __m64 v49; // mm3
  __m64 v50; // mm2
  __m64 v51; // mm7
  __m64 v52; // mm0
  __m64 v53; // mm3
  __m64 v54; // mm1
  __m64 v55; // mm2
  __m64 v56; // mm3
  __m64 v57; // mm0
  __m64 v58; // mm1
  __m64 v59; // mm2
  __m64 v60; // mm5
  __m64 v61; // mm3
  __m64 v62; // mm2
  __m64 v63; // mm7
  __m64 v64; // mm0
  __m64 v65; // mm3
  __m64 v66; // mm1
  __m64 v67; // mm2
  __m64 v68; // mm3
  __m64 v69; // mm0
  __m64 v70; // mm1
  __m64 v71; // mm2
  __m64 v72; // mm3
  __m64 v73; // mm1
  __m64 v74; // mm1
  __m64 v75; // mm2
  __m64 v76; // mm3
  __m64 v77; // mm0
  __m64 v78; // mm1
  __m64 v79; // mm2
  __m64 v80; // mm5
  __m64 v81; // mm3
  __m64 v82; // mm2
  __m64 v83; // mm7
  __m64 v84; // mm0
  __m64 v85; // mm3
  __m64 v86; // mm1
  __m64 v87; // mm2
  __m64 v88; // mm3
  __m64 v89; // mm0
  __m64 v90; // mm1
  __m64 v91; // mm2
  __m64 v92; // mm5
  __m64 v93; // mm3
  __m64 v94; // mm2
  __m64 v95; // mm7
  __m64 v96; // mm0
  __m64 v97; // mm3
  __m64 v98; // mm1
  __m64 v99; // mm2
  __m64 v100; // mm3
  __m64 v101; // mm0
  __m64 v102; // mm1
  __m64 v103; // mm2
  __m64 v104; // mm5
  __m64 v105; // mm3
  __m64 v106; // mm2
  __m64 v107; // mm7
  __m64 v108; // mm0
  __m64 v109; // mm3
  __m64 v110; // mm1
  __m64 v111; // mm2
  __m64 v112; // mm3
  __m64 v113; // mm0
  __m64 v114; // mm1
  __m64 v115; // mm2
  __m64 v116; // mm3
  __m64 v117; // mm1
  __m64 v118; // [esp+0h] [ebp-40h]
  __m64 v119; // [esp+8h] [ebp-38h]
  __m64 v120; // [esp+10h] [ebp-30h]
  __m64 v121; // [esp+18h] [ebp-28h]
  __m64 v122; // [esp+20h] [ebp-20h]
  __m64 v123; // [esp+28h] [ebp-18h]
  __m64 v124; // [esp+38h] [ebp-8h]

  result = a1;
  v6 = _mm_cvtsi32_si64(a2);
  a1->m64_u64 = (unsigned __int64)v6;
  a1[1].m64_u64 = 0;
  a1[2].m64_i32[0] = _mm_cvtsi64_si32(0);
  a1[2].m64_i32[1] = _mm_cvtsi64_si32(v6);
  a1[3].m64_u64 = 0;
  a1[4].m64_u64 = 0;
  a1[5].m64_u64 = (unsigned __int64)v6;
  a1[6].m64_u64 = 0;
  a1[7].m64_u64 = 0x3F80000000000000LL;
  if ( a4 )
  {
    m64_u64 = (__m64)a4->m64_u64;
    v8 = _m_pfadd(m64_u64, m64_u64);
    v9 = a4[1];
    v10 = _m_punpckhdq(m64_u64, m64_u64);
    v11 = _m_punpckhdq(v9, v9);
    v12 = _m_pfmul((__m64)a4->m64_u64, v8);
    v13 = _m_punpckldq(_m_pfadd(v9, v9), v8);
    v14 = _m_pfmul(v8, v11);
    v15 = _m_pfmul(_m_punpckldq(v9, v9), v13);
    v16 = _m_pfmul(v13, v11);
    v17 = _m_pfmul(v13, v10);
    v18 = _m_punpckhdq(v17, v15);
    v19 = _m_punpckhdq(_m_punpckldq(v16, v16), v14);
    v20 = _m_pfsubr(_m_pfadd(_m_punpckldq(v15, v15), v12), (__m64)0x3F8000003F800000LL);
    v123 = _m_punpckldq(_m_pfsubr(_m_pfacc(v12, v12), (__m64)0x3F8000003F800000LL), 0);
    v21 = v17;
    v22 = _m_pfadd(v17, v14);
    v23 = _m_pfsub(v21, v14);
    v24 = _m_pfsub(v18, v19);
    v25 = _m_punpckldq(v22, 0);
    v26 = _m_pfadd(v18, v19);
    v121 = v25;
    v119 = _m_punpckhdq(v24, 0);
    v120 = _m_punpckldq(v24, v20);
    v118 = _m_punpckhdq(v20, _m_punpckldq(v26, v26));
    v122 = _m_punpckldq(_m_punpckhdq(v26, v26), v23);
    v124 = _m_punpckldq(0, (__m64)1065353216LL);
    if ( a3 )
    {
      v27 = (__m64)a3->m64_u64;
      v28 = _mm_cvtsi32_si64(a3[1].m64_u32[0]);
      v29 = _m_pfsub(_mm_cvtsi32_si64(a1[7].m64_u32[0]), v28);
      a1[6].m64_u64 = (unsigned __int64)_m_pfsub(a1[6], (__m64)a3->m64_u64);
      a1[7].m64_i32[0] = _mm_cvtsi64_si32(v29);
      v30 = a1[1];
      v31 = _m_punpckhdq(v27, (__m64)a1->m64_u64);
      v32 = _m_punpckhdq(v28, v30);
      v33 = _m_punpckldq((__m64)a1->m64_u64, (__m64)a1->m64_u64);
      v34 = _m_punpckldq(v30, v30);
      v35 = _m_punpckhdq(v31, v31);
      v36 = _m_pfmul(v120, v35);
      v37 = _m_punpckhdq(v32, v32);
      v38 = _m_pfadd(_m_pfadd(_m_pfmul(v35, v121), _m_pfmul(v33, v119)), _m_pfmul(v34, v123));
      v39 = _m_pfadd(_m_pfmul(0, v37), _m_pfadd(_m_pfmul(v122, v34), _m_pfadd(v36, _m_pfmul(v118, v33))));
      v40 = a1[2];
      v41 = _m_pfadd(_m_pfmul(v37, v124), v38);
      v42 = a1[3];
      a1->m64_u64 = (unsigned __int64)v39;
      a1[1].m64_u64 = (unsigned __int64)v41;
      v43 = _m_punpckhdq(v38, v40);
      v44 = _m_punpckhdq(v41, v42);
      v45 = _m_punpckldq(v40, v40);
      v46 = _m_punpckldq(v42, v42);
      v47 = _m_punpckhdq(v43, v43);
      v48 = _m_pfmul(v120, v47);
      v49 = _m_punpckhdq(v44, v44);
      v50 = _m_pfadd(_m_pfadd(_m_pfmul(v47, v121), _m_pfmul(v45, v119)), _m_pfmul(v46, v123));
      v51 = _m_pfadd(_m_pfmul(0, v49), _m_pfadd(_m_pfmul(v122, v46), _m_pfadd(v48, _m_pfmul(v118, v45))));
      v52 = a1[4];
      v53 = _m_pfadd(_m_pfmul(v49, v124), v50);
      v54 = a1[5];
      a1[2].m64_u64 = (unsigned __int64)v51;
      a1[3].m64_u64 = (unsigned __int64)v53;
      v55 = _m_punpckhdq(v50, v52);
      v56 = _m_punpckhdq(v53, v54);
      v57 = _m_punpckldq(v52, v52);
      v58 = _m_punpckldq(v54, v54);
      v59 = _m_punpckhdq(v55, v55);
      v60 = _m_pfmul(v120, v59);
      v61 = _m_punpckhdq(v56, v56);
      v62 = _m_pfadd(_m_pfadd(_m_pfmul(v59, v121), _m_pfmul(v57, v119)), _m_pfmul(v58, v123));
      v63 = _m_pfadd(_m_pfmul(0, v61), _m_pfadd(_m_pfmul(v122, v58), _m_pfadd(v60, _m_pfmul(v118, v57))));
      v64 = a1[6];
      v65 = _m_pfadd(_m_pfmul(v61, v124), v62);
      v66 = a1[7];
      a1[4].m64_u64 = (unsigned __int64)v63;
      a1[5].m64_u64 = (unsigned __int64)v65;
      v67 = _m_punpckhdq(v62, v64);
      v68 = _m_punpckhdq(v65, v66);
      v69 = _m_punpckldq(v64, v64);
      v70 = _m_punpckldq(v66, v66);
      v71 = _m_punpckhdq(v67, v67);
      v72 = _m_punpckhdq(v68, v68);
      a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                          _m_pfmul(0, v72),
                                          _m_pfadd(
                                            _m_pfmul(v122, v70),
                                            _m_pfadd(_m_pfmul(v120, v71), _m_pfmul(v118, v69))));
      a1[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                          _m_pfmul(v72, v124),
                                          _m_pfadd(
                                            _m_pfadd(_m_pfmul(v71, v121), _m_pfmul(v69, v119)),
                                            _m_pfmul(v70, v123)));
      v73 = _m_pfadd(_mm_cvtsi32_si64(a1[7].m64_u32[0]), _mm_cvtsi32_si64(a3[1].m64_u32[0]));
      a1[6].m64_u64 = (unsigned __int64)_m_pfadd(a1[6], (__m64)a3->m64_u64);
      a1[7].m64_i32[0] = _mm_cvtsi64_si32(v73);
    }
    else
    {
      v74 = a1[1];
      v75 = _m_punpckhdq(v25, (__m64)a1->m64_u64);
      v76 = _m_punpckhdq(v23, v74);
      v77 = _m_punpckldq((__m64)a1->m64_u64, (__m64)a1->m64_u64);
      v78 = _m_punpckldq(v74, v74);
      v79 = _m_punpckhdq(v75, v75);
      v80 = _m_pfmul(v120, v79);
      v81 = _m_punpckhdq(v76, v76);
      v82 = _m_pfadd(_m_pfadd(_m_pfmul(v79, v121), _m_pfmul(v77, v119)), _m_pfmul(v78, v123));
      v83 = _m_pfadd(_m_pfmul(0, v81), _m_pfadd(_m_pfmul(v122, v78), _m_pfadd(v80, _m_pfmul(v118, v77))));
      v84 = a1[2];
      v85 = _m_pfadd(_m_pfmul(v81, v124), v82);
      v86 = a1[3];
      a1->m64_u64 = (unsigned __int64)v83;
      a1[1].m64_u64 = (unsigned __int64)v85;
      v87 = _m_punpckhdq(v82, v84);
      v88 = _m_punpckhdq(v85, v86);
      v89 = _m_punpckldq(v84, v84);
      v90 = _m_punpckldq(v86, v86);
      v91 = _m_punpckhdq(v87, v87);
      v92 = _m_pfmul(v120, v91);
      v93 = _m_punpckhdq(v88, v88);
      v94 = _m_pfadd(_m_pfadd(_m_pfmul(v91, v121), _m_pfmul(v89, v119)), _m_pfmul(v90, v123));
      v95 = _m_pfadd(_m_pfmul(0, v93), _m_pfadd(_m_pfmul(v122, v90), _m_pfadd(v92, _m_pfmul(v118, v89))));
      v96 = a1[4];
      v97 = _m_pfadd(_m_pfmul(v93, v124), v94);
      v98 = a1[5];
      a1[2].m64_u64 = (unsigned __int64)v95;
      a1[3].m64_u64 = (unsigned __int64)v97;
      v99 = _m_punpckhdq(v94, v96);
      v100 = _m_punpckhdq(v97, v98);
      v101 = _m_punpckldq(v96, v96);
      v102 = _m_punpckldq(v98, v98);
      v103 = _m_punpckhdq(v99, v99);
      v104 = _m_pfmul(v120, v103);
      v105 = _m_punpckhdq(v100, v100);
      v106 = _m_pfadd(_m_pfadd(_m_pfmul(v103, v121), _m_pfmul(v101, v119)), _m_pfmul(v102, v123));
      v107 = _m_pfadd(_m_pfmul(0, v105), _m_pfadd(_m_pfmul(v122, v102), _m_pfadd(v104, _m_pfmul(v118, v101))));
      v108 = a1[6];
      v109 = _m_pfadd(_m_pfmul(v105, v124), v106);
      v110 = a1[7];
      a1[4].m64_u64 = (unsigned __int64)v107;
      a1[5].m64_u64 = (unsigned __int64)v109;
      v111 = _m_punpckhdq(v106, v108);
      v112 = _m_punpckhdq(v109, v110);
      v113 = _m_punpckldq(v108, v108);
      v114 = _m_punpckldq(v110, v110);
      v115 = _m_punpckhdq(v111, v111);
      v116 = _m_punpckhdq(v112, v112);
      a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                          _m_pfmul(0, v116),
                                          _m_pfadd(
                                            _m_pfmul(v122, v114),
                                            _m_pfadd(_m_pfmul(v120, v115), _m_pfmul(v118, v113))));
      a1[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                          _m_pfmul(v116, v124),
                                          _m_pfadd(
                                            _m_pfadd(_m_pfmul(v115, v121), _m_pfmul(v113, v119)),
                                            _m_pfmul(v114, v123)));
    }
  }
  if ( a5 )
  {
    v117 = _m_pfadd(_mm_cvtsi32_si64(a5[1].m64_u32[0]), _mm_cvtsi32_si64(a1[7].m64_u32[0]));
    a1[6].m64_u64 = (unsigned __int64)_m_pfadd((__m64)a5->m64_u64, a1[6]);
    a1[7].m64_i32[0] = _mm_cvtsi64_si32(v117);
  }
  _m_femms();
  return result;
}

// sub_45CAC3 @ 0x0045CAC3
__m64 *__stdcall sub_45CAC3(__m64 *a1, __m64 *a2, unsigned int a3)
{
  __m64 v3; // mm1
  __m64 v4; // mm1
  __m64 v5; // mm0
  __m64 v6; // mm7
  __m64 v7; // mm3
  __m64 v8; // mm0
  __m64 v9; // mm1
  __m64 v10; // mm2
  __m64 v12; // mm3
  __m64 v13; // mm4
  __m64 v14; // mm5
  __m64 v15; // mm1
  __m64 v16; // mm1
  __m64 v17; // mm6
  __m64 v18; // mm7
  __m64 v19; // mm1
  __m64 v20; // mm6
  __m64 v21; // mm2
  __m64 v22; // mm1
  unsigned __int64 m64_u64; // [esp+0h] [ebp-18h] BYREF
  unsigned int v24; // [esp+8h] [ebp-10h]
  unsigned int v25; // [esp+Ch] [ebp-Ch]

  v3 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
  m64_u64 = a2->m64_u64;
  v24 = _mm_cvtsi64_si32(v3);
  sub_45E832((int)&m64_u64, (int)&m64_u64);
  math_sincos_packed();
  v4 = _mm_cvtsi32_si64(a3);
  v5 = _m_pfsubr(v4, (__m64)0x3F8000003F800000LL);
  v25 = _mm_cvtsi64_si32(_m_punpckhdq(v4, v4));
  v6 = _mm_cvtsi32_si64(v24);
  v7 = _m_punpckldq(v6, v6);
  v8 = _m_punpckldq(v5, v5);
  v9 = _m_punpckldq(v4, v4);
  v10 = _m_pfmul(_m_pfmul(_m_punpckhdq((__m64)m64_u64, v7), (__m64)m64_u64), v8);
  v12 = _m_pfmul(_m_pfmul(v7, (__m64)m64_u64), v8);
  v13 = _m_pfadd(_m_pfmul(_m_pfmul((__m64)m64_u64, (__m64)m64_u64), v8), v9);
  v14 = _m_pfadd(_m_pfmul(_m_pfmul(v6, v6), v8), v9);
  v15 = _mm_cvtsi32_si64(v25);
  v16 = _m_punpckldq(v15, v15);
  v17 = _m_pfmul((__m64)m64_u64, v16);
  a1[6].m64_u64 = 0;
  v18 = _m_punpckldq(_m_pfmul(v6, v16), v17);
  v19 = v10;
  v20 = _m_punpckhdq(v17, v17);
  a1[5].m64_u64 = (unsigned __int64)_m_punpckldq(v14, 0);
  v21 = _m_pfsub(v10, v18);
  v22 = _m_pfadd(v19, v18);
  a1->m64_u64 = (unsigned __int64)_m_punpckldq(v13, v22);
  a1[1].m64_u64 = (unsigned __int64)_m_punpckldq(_m_pfsub(v12, v20), 0);
  a1[3].m64_u64 = (unsigned __int64)_m_punpckhdq(v22, 0);
  a1[7].m64_u64 = (unsigned __int64)_m_punpckhdq(0, (__m64)0x3F8000003F800000LL);
  a1[4].m64_u64 = (unsigned __int64)_m_punpckhdq(_m_pfadd(_m_punpckldq(v12, v12), v20), v21);
  a1[2].m64_u64 = (unsigned __int64)_m_punpckldq(v21, _m_punpckhdq(v13, v13));
  _m_femms();
  return a1;
}

// sub_45CBDC @ 0x0045CBDC
__m64 *__stdcall sub_45CBDC(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, __m64 *a6, __m64 *a7)
{
  __m64 *result; // eax
  __m64 v8; // mm4
  __m64 v9; // mm1
  __m64 v10; // mm5
  __m64 v11; // mm0
  __m64 v12; // mm5
  __m64 v13; // mm2
  __m64 v14; // mm3
  __m64 v15; // mm1
  __m64 v16; // mm6
  __m64 v17; // mm3
  __m64 v18; // mm6
  __m64 v19; // mm2
  __m64 v20; // mm1
  __m64 m64_u64; // mm3
  __m64 v22; // mm4
  __m64 v23; // mm1
  __m64 v24; // mm2
  __m64 v25; // mm2
  __m64 v26; // mm1
  __m64 v27; // mm2
  __m64 v28; // mm3
  __m64 v29; // mm0
  __m64 v30; // mm1
  __m64 v31; // mm2
  __m64 v32; // mm5
  __m64 v33; // mm3
  __m64 v34; // mm2
  __m64 v35; // mm7
  __m64 v36; // mm0
  __m64 v37; // mm3
  __m64 v38; // mm1
  __m64 v39; // mm2
  __m64 v40; // mm3
  __m64 v41; // mm0
  __m64 v42; // mm1
  __m64 v43; // mm2
  __m64 v44; // mm5
  __m64 v45; // mm3
  __m64 v46; // mm2
  __m64 v47; // mm7
  __m64 v48; // mm0
  __m64 v49; // mm3
  __m64 v50; // mm1
  __m64 v51; // mm2
  __m64 v52; // mm3
  __m64 v53; // mm0
  __m64 v54; // mm1
  __m64 v55; // mm2
  __m64 v56; // mm5
  __m64 v57; // mm3
  __m64 v58; // mm2
  __m64 v59; // mm7
  __m64 v60; // mm0
  __m64 v61; // mm3
  __m64 v62; // mm1
  __m64 v63; // mm2
  __m64 v64; // mm3
  __m64 v65; // mm0
  __m64 v66; // mm1
  __m64 v67; // mm2
  __m64 v68; // mm5
  __m64 v69; // mm3
  __m64 v70; // mm7
  __m64 v71; // mm2
  __m64 v72; // mm3
  __m64 v73; // mm1
  __m64 v74; // mm2
  __m64 v75; // mm3
  __m64 v76; // mm0
  __m64 v77; // mm1
  __m64 v78; // mm2
  __m64 v79; // mm5
  __m64 v80; // mm3
  __m64 v81; // mm2
  __m64 v82; // mm7
  __m64 v83; // mm0
  __m64 v84; // mm3
  __m64 v85; // mm1
  __m64 v86; // mm2
  __m64 v87; // mm3
  __m64 v88; // mm0
  __m64 v89; // mm1
  __m64 v90; // mm2
  __m64 v91; // mm5
  __m64 v92; // mm3
  __m64 v93; // mm2
  __m64 v94; // mm7
  __m64 v95; // mm0
  __m64 v96; // mm3
  __m64 v97; // mm1
  __m64 v98; // mm2
  __m64 v99; // mm3
  __m64 v100; // mm0
  __m64 v101; // mm1
  __m64 v102; // mm2
  __m64 v103; // mm5
  __m64 v104; // mm3
  __m64 v105; // mm2
  __m64 v106; // mm7
  __m64 v107; // mm0
  __m64 v108; // mm3
  __m64 v109; // mm1
  __m64 v110; // mm2
  __m64 v111; // mm3
  __m64 v112; // mm0
  __m64 v113; // mm1
  __m64 v114; // mm2
  __m64 v115; // mm5
  __m64 v116; // mm3
  __m64 v117; // mm7
  __m64 v118; // mm2
  __m64 v119; // mm3
  __m64 v120; // mm1
  __m64 v121; // mm2
  __m64 v122; // mm3
  __m64 v123; // mm0
  __m64 v124; // mm1
  __m64 v125; // mm2
  __m64 v126; // mm5
  __m64 v127; // mm3
  __m64 v128; // mm2
  __m64 v129; // mm7
  __m64 v130; // mm0
  __m64 v131; // mm3
  __m64 v132; // mm1
  __m64 v133; // mm2
  __m64 v134; // mm3
  __m64 v135; // mm0
  __m64 v136; // mm1
  __m64 v137; // mm2
  __m64 v138; // mm5
  __m64 v139; // mm3
  __m64 v140; // mm2
  __m64 v141; // mm7
  __m64 v142; // mm0
  __m64 v143; // mm3
  __m64 v144; // mm1
  __m64 v145; // mm2
  __m64 v146; // mm3
  __m64 v147; // mm0
  __m64 v148; // mm1
  __m64 v149; // mm2
  __m64 v150; // mm5
  __m64 v151; // mm3
  __m64 v152; // mm2
  __m64 v153; // mm7
  __m64 v154; // mm0
  __m64 v155; // mm3
  __m64 v156; // mm1
  __m64 v157; // mm2
  __m64 v158; // mm3
  __m64 v159; // mm0
  __m64 v160; // mm1
  __m64 v161; // mm2
  __m64 v162; // mm3
  __m64 v163; // mm2
  __m64 v164; // mm3
  __m64 v165; // mm2
  __m64 v166; // mm1
  __m64 v167; // mm2
  __m64 v168; // mm3
  __m64 v169; // mm0
  __m64 v170; // mm1
  __m64 v171; // mm2
  __m64 v172; // mm5
  __m64 v173; // mm3
  __m64 v174; // mm2
  __m64 v175; // mm7
  __m64 v176; // mm0
  __m64 v177; // mm3
  __m64 v178; // mm1
  __m64 v179; // mm2
  __m64 v180; // mm3
  __m64 v181; // mm0
  __m64 v182; // mm1
  __m64 v183; // mm2
  __m64 v184; // mm5
  __m64 v185; // mm3
  __m64 v186; // mm2
  __m64 v187; // mm7
  __m64 v188; // mm0
  __m64 v189; // mm3
  __m64 v190; // mm1
  __m64 v191; // mm2
  __m64 v192; // mm3
  __m64 v193; // mm0
  __m64 v194; // mm1
  __m64 v195; // mm2
  __m64 v196; // mm5
  __m64 v197; // mm3
  __m64 v198; // mm2
  __m64 v199; // mm7
  __m64 v200; // mm0
  __m64 v201; // mm3
  __m64 v202; // mm1
  __m64 v203; // mm2
  __m64 v204; // mm3
  __m64 v205; // mm0
  __m64 v206; // mm1
  __m64 v207; // mm2
  __m64 v208; // mm5
  __m64 v209; // mm3
  __m64 v210; // mm7
  __m64 v211; // mm2
  __m64 v212; // mm3
  __m64 v213; // mm1
  __m64 v214; // mm2
  __m64 v215; // mm3
  __m64 v216; // mm0
  __m64 v217; // mm1
  __m64 v218; // mm2
  __m64 v219; // mm5
  __m64 v220; // mm3
  __m64 v221; // mm2
  __m64 v222; // mm7
  __m64 v223; // mm0
  __m64 v224; // mm3
  __m64 v225; // mm1
  __m64 v226; // mm2
  __m64 v227; // mm3
  __m64 v228; // mm0
  __m64 v229; // mm1
  __m64 v230; // mm2
  __m64 v231; // mm5
  __m64 v232; // mm3
  __m64 v233; // mm2
  __m64 v234; // mm7
  __m64 v235; // mm0
  __m64 v236; // mm3
  __m64 v237; // mm1
  __m64 v238; // mm2
  __m64 v239; // mm3
  __m64 v240; // mm0
  __m64 v241; // mm1
  __m64 v242; // mm2
  __m64 v243; // mm5
  __m64 v244; // mm3
  __m64 v245; // mm2
  __m64 v246; // mm7
  __m64 v247; // mm0
  __m64 v248; // mm3
  __m64 v249; // mm1
  __m64 v250; // mm2
  __m64 v251; // mm3
  __m64 v252; // mm0
  __m64 v253; // mm1
  __m64 v254; // mm2
  __m64 v255; // mm3
  __m64 v256; // mm4
  __m64 v257; // mm5
  __m64 v258; // mm1
  __m64 v259; // mm2
  __m64 v260; // mm4
  __m64 v261; // mm1
  __m64 v262; // mm5
  __m64 v263; // mm0
  __m64 v264; // mm5
  __m64 v265; // mm2
  __m64 v266; // mm3
  __m64 v267; // mm1
  __m64 v268; // mm6
  __m64 v269; // mm3
  __m64 v270; // mm6
  __m64 v271; // mm2
  __m64 v272; // mm1
  __m64 v273; // mm5
  __m64 v274; // mm2
  __m64 v275; // mm3
  __m64 v276; // mm2
  __m64 v277; // mm3
  __m64 v278; // mm1
  __m64 v279; // mm1
  __m64 v280; // mm2
  __m64 v281; // mm3
  __m64 v282; // mm0
  __m64 v283; // mm1
  __m64 v284; // mm2
  __m64 v285; // mm5
  __m64 v286; // mm3
  __m64 v287; // mm2
  __m64 v288; // mm7
  __m64 v289; // mm0
  __m64 v290; // mm3
  __m64 v291; // mm1
  __m64 v292; // mm2
  __m64 v293; // mm3
  __m64 v294; // mm0
  __m64 v295; // mm1
  __m64 v296; // mm2
  __m64 v297; // mm5
  __m64 v298; // mm3
  __m64 v299; // mm2
  __m64 v300; // mm7
  __m64 v301; // mm0
  __m64 v302; // mm3
  __m64 v303; // mm1
  __m64 v304; // mm2
  __m64 v305; // mm3
  __m64 v306; // mm0
  __m64 v307; // mm1
  __m64 v308; // mm2
  __m64 v309; // mm5
  __m64 v310; // mm3
  __m64 v311; // mm2
  __m64 v312; // mm7
  __m64 v313; // mm0
  __m64 v314; // mm3
  __m64 v315; // mm1
  __m64 v316; // mm2
  __m64 v317; // mm3
  __m64 v318; // mm0
  __m64 v319; // mm1
  __m64 v320; // mm2
  __m64 v321; // mm3
  __m64 v322; // mm1
  __m64 v323; // mm1
  __m64 v324; // mm2
  __m64 v325; // mm3
  __m64 v326; // mm0
  __m64 v327; // mm1
  __m64 v328; // mm2
  __m64 v329; // mm5
  __m64 v330; // mm3
  __m64 v331; // mm2
  __m64 v332; // mm7
  __m64 v333; // mm0
  __m64 v334; // mm3
  __m64 v335; // mm1
  __m64 v336; // mm2
  __m64 v337; // mm3
  __m64 v338; // mm0
  __m64 v339; // mm1
  __m64 v340; // mm2
  __m64 v341; // mm5
  __m64 v342; // mm3
  __m64 v343; // mm2
  __m64 v344; // mm7
  __m64 v345; // mm0
  __m64 v346; // mm3
  __m64 v347; // mm1
  __m64 v348; // mm2
  __m64 v349; // mm3
  __m64 v350; // mm0
  __m64 v351; // mm1
  __m64 v352; // mm2
  __m64 v353; // mm5
  __m64 v354; // mm3
  __m64 v355; // mm2
  __m64 v356; // mm7
  __m64 v357; // mm0
  __m64 v358; // mm3
  __m64 v359; // mm1
  __m64 v360; // mm2
  __m64 v361; // mm3
  __m64 v362; // mm0
  __m64 v363; // mm1
  __m64 v364; // mm2
  __m64 v365; // mm3
  __m64 v366; // mm1
  __m64 v367; // [esp+0h] [ebp-C0h]
  __m64 v368; // [esp+10h] [ebp-B0h]
  __m64 v369; // [esp+28h] [ebp-98h]
  __m64 v370; // [esp+40h] [ebp-80h]
  __m64 v371; // [esp+40h] [ebp-80h]
  __m64 v372; // [esp+48h] [ebp-78h]
  __m64 v373; // [esp+48h] [ebp-78h]
  __m64 v374; // [esp+50h] [ebp-70h]
  __m64 v375; // [esp+50h] [ebp-70h]
  __m64 v376; // [esp+58h] [ebp-68h]
  __m64 v377; // [esp+58h] [ebp-68h]
  __m64 v378; // [esp+60h] [ebp-60h]
  __m64 v379; // [esp+60h] [ebp-60h]
  __m64 v380; // [esp+68h] [ebp-58h]
  __m64 v381; // [esp+68h] [ebp-58h]
  __m64 v382; // [esp+78h] [ebp-48h]
  __m64 v383; // [esp+78h] [ebp-48h]
  __m64 v384; // [esp+80h] [ebp-40h]
  __m64 v385; // [esp+88h] [ebp-38h]
  __m64 v386; // [esp+90h] [ebp-30h]
  __m64 v387; // [esp+98h] [ebp-28h]
  __m64 v388; // [esp+A0h] [ebp-20h]
  __m64 v389; // [esp+A8h] [ebp-18h]
  __m64 v390; // [esp+B0h] [ebp-10h]
  __m64 v391; // [esp+B8h] [ebp-8h]

  result = a1;
  if ( a4 )
  {
    if ( a3 )
    {
      v367 = _m_punpckldq((__m64)a4->m64_u64, 0);
      v368 = _m_punpckhdq(0, (__m64)a4->m64_u64);
      v369 = _mm_cvtsi32_si64(a4[1].m64_u32[0]);
      v8 = a3[1];
      v9 = _m_pfadd(v8, v8);
      v10 = _m_pfadd((__m64)a3->m64_u64, (__m64)a3->m64_u64);
      v11 = _m_pfmul(v10, (__m64)a3->m64_u64);
      v12 = _m_punpckldq(v10, v9);
      v13 = _m_pfmul((__m64)a3->m64_u64, v9);
      v14 = _m_pfmul(_m_pswapd((__m64)a3->m64_u64), v9);
      v15 = _m_pfmul(v9, v8);
      v16 = _m_pfmul(_m_punpckhdq((__m64)a3->m64_u64, v8), v12);
      v17 = _m_pfpnacc(v14, v14);
      v18 = _m_pfpnacc(v16, v16);
      v19 = _m_pfpnacc(v13, v13);
      v20 = _m_pfsub(_m_pfsubr(v11, (__m64)0x3F8000003F800000LL), _m_punpckldq(v15, v15));
      v378 = _m_punpckldq(_m_pswapd(v19), v17);
      v372 = _m_punpckldq(v19, 0);
      v380 = _m_punpckhdq(_m_pfsubr(_m_pfacc(v11, v11), (__m64)0x3F8000003F800000LL), 0);
      v370 = _m_punpckhdq(v20, v18);
      v374 = _m_punpckldq(v18, v20);
      v376 = _m_punpckhdq(v17, 0);
      v382 = _m_punpckldq(0, (__m64)1065353216LL);
      if ( a2 )
      {
        v384 = _m_punpckldq(v370, v374);
        v386 = _m_punpckhdq(v370, v374);
        v389 = _m_punpckldq(v380, v382);
        v391 = _m_punpckhdq(v380, v382);
        v388 = _m_punpckldq(v372, v376);
        v390 = _m_punpckhdq(v372, v376);
        v387 = _m_punpckhdq(v378, 0);
        v385 = _m_punpckldq(v378, 0);
        result = a1;
        m64_u64 = (__m64)a2->m64_u64;
        v22 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
        v23 = _mm_cvtsi32_si64(0x3F800000u);
        v24 = _m_pswapd(v23);
        a1->m64_u64 = (unsigned __int64)v23;
        a1[1].m64_u64 = 0;
        a1[2].m64_u64 = (unsigned __int64)v24;
        a1[3].m64_u64 = 0;
        a1[4].m64_u64 = 0;
        a1[5].m64_u64 = (unsigned __int64)v23;
        v25 = _m_pfsub(v24, v22);
        a1[7].m64_u64 = (unsigned __int64)v25;
        a1[6].m64_u64 = (unsigned __int64)_m_pfsub(0, m64_u64);
        v26 = a1[1];
        v27 = _m_punpckhdq(v25, (__m64)a1->m64_u64);
        v28 = _m_punpckhdq(m64_u64, v26);
        v29 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v30 = _m_punpckldq(v26, v26);
        v31 = _m_punpckhdq(v27, v27);
        v32 = _m_pfmul(v386, v31);
        v33 = _m_punpckhdq(v28, v28);
        v34 = _m_pfadd(_m_pfadd(_m_pfmul(v31, v387), _m_pfmul(v29, v385)), _m_pfmul(v30, v389));
        v35 = _m_pfadd(_m_pfmul(v390, v33), _m_pfadd(_m_pfmul(v388, v30), _m_pfadd(v32, _m_pfmul(v384, v29))));
        v36 = a1[2];
        v37 = _m_pfadd(_m_pfmul(v33, v391), v34);
        v38 = a1[3];
        a1->m64_u64 = (unsigned __int64)v35;
        a1[1].m64_u64 = (unsigned __int64)v37;
        v39 = _m_punpckhdq(v34, v36);
        v40 = _m_punpckhdq(v37, v38);
        v41 = _m_punpckldq(v36, v36);
        v42 = _m_punpckldq(v38, v38);
        v43 = _m_punpckhdq(v39, v39);
        v44 = _m_pfmul(v386, v43);
        v45 = _m_punpckhdq(v40, v40);
        v46 = _m_pfadd(_m_pfadd(_m_pfmul(v43, v387), _m_pfmul(v41, v385)), _m_pfmul(v42, v389));
        v47 = _m_pfadd(_m_pfmul(v390, v45), _m_pfadd(_m_pfmul(v388, v42), _m_pfadd(v44, _m_pfmul(v384, v41))));
        v48 = a1[4];
        v49 = _m_pfadd(_m_pfmul(v45, v391), v46);
        v50 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v47;
        a1[3].m64_u64 = (unsigned __int64)v49;
        v51 = _m_punpckhdq(v46, v48);
        v52 = _m_punpckhdq(v49, v50);
        v53 = _m_punpckldq(v48, v48);
        v54 = _m_punpckldq(v50, v50);
        v55 = _m_punpckhdq(v51, v51);
        v56 = _m_pfmul(v386, v55);
        v57 = _m_punpckhdq(v52, v52);
        v58 = _m_pfadd(_m_pfadd(_m_pfmul(v55, v387), _m_pfmul(v53, v385)), _m_pfmul(v54, v389));
        v59 = _m_pfadd(_m_pfmul(v390, v57), _m_pfadd(_m_pfmul(v388, v54), _m_pfadd(v56, _m_pfmul(v384, v53))));
        v60 = a1[6];
        v61 = _m_pfadd(_m_pfmul(v57, v391), v58);
        v62 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v59;
        a1[5].m64_u64 = (unsigned __int64)v61;
        v63 = _m_punpckhdq(v58, v60);
        v64 = _m_punpckhdq(v61, v62);
        v65 = _m_punpckldq(v60, v60);
        v66 = _m_punpckldq(v62, v62);
        v67 = _m_punpckhdq(v63, v63);
        v68 = _m_pfmul(v386, v67);
        v69 = _m_punpckhdq(v64, v64);
        v70 = _m_pfmul(v390, v69);
        v71 = _m_pfadd(_m_pfadd(_m_pfmul(v67, v387), _m_pfmul(v65, v385)), _m_pfmul(v66, v389));
        v72 = _m_pfadd(_m_pfmul(v69, v391), v71);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            v70,
                                            _m_pfadd(_m_pfmul(v388, v66), _m_pfadd(v68, _m_pfmul(v384, v65))));
        a1[7].m64_u64 = (unsigned __int64)v72;
        v73 = a1[1];
        v74 = _m_punpckhdq(v71, (__m64)a1->m64_u64);
        v75 = _m_punpckhdq(v72, v73);
        v76 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v77 = _m_punpckldq(v73, v73);
        v78 = _m_punpckhdq(v74, v74);
        v79 = _m_pfmul(v368, v78);
        v80 = _m_punpckhdq(v75, v75);
        v81 = _m_pfadd(_m_pfadd(_m_pfmul(v78, 0), _m_pfmul(v76, 0)), _m_pfmul(v77, v369));
        v82 = _m_pfadd(_m_pfmul(0, v80), _m_pfadd(_m_pfmul(0, v77), _m_pfadd(v79, _m_pfmul(v367, v76))));
        v83 = a1[2];
        v84 = _m_pfadd(_m_pfmul(v80, (__m64)0x3F80000000000000LL), v81);
        v85 = a1[3];
        a1->m64_u64 = (unsigned __int64)v82;
        a1[1].m64_u64 = (unsigned __int64)v84;
        v86 = _m_punpckhdq(v81, v83);
        v87 = _m_punpckhdq(v84, v85);
        v88 = _m_punpckldq(v83, v83);
        v89 = _m_punpckldq(v85, v85);
        v90 = _m_punpckhdq(v86, v86);
        v91 = _m_pfmul(v368, v90);
        v92 = _m_punpckhdq(v87, v87);
        v93 = _m_pfadd(_m_pfadd(_m_pfmul(v90, 0), _m_pfmul(v88, 0)), _m_pfmul(v89, v369));
        v94 = _m_pfadd(_m_pfmul(0, v92), _m_pfadd(_m_pfmul(0, v89), _m_pfadd(v91, _m_pfmul(v367, v88))));
        v95 = a1[4];
        v96 = _m_pfadd(_m_pfmul(v92, (__m64)0x3F80000000000000LL), v93);
        v97 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v94;
        a1[3].m64_u64 = (unsigned __int64)v96;
        v98 = _m_punpckhdq(v93, v95);
        v99 = _m_punpckhdq(v96, v97);
        v100 = _m_punpckldq(v95, v95);
        v101 = _m_punpckldq(v97, v97);
        v102 = _m_punpckhdq(v98, v98);
        v103 = _m_pfmul(v368, v102);
        v104 = _m_punpckhdq(v99, v99);
        v105 = _m_pfadd(_m_pfadd(_m_pfmul(v102, 0), _m_pfmul(v100, 0)), _m_pfmul(v101, v369));
        v106 = _m_pfadd(_m_pfmul(0, v104), _m_pfadd(_m_pfmul(0, v101), _m_pfadd(v103, _m_pfmul(v367, v100))));
        v107 = a1[6];
        v108 = _m_pfadd(_m_pfmul(v104, (__m64)0x3F80000000000000LL), v105);
        v109 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v106;
        a1[5].m64_u64 = (unsigned __int64)v108;
        v110 = _m_punpckhdq(v105, v107);
        v111 = _m_punpckhdq(v108, v109);
        v112 = _m_punpckldq(v107, v107);
        v113 = _m_punpckldq(v109, v109);
        v114 = _m_punpckhdq(v110, v110);
        v115 = _m_pfmul(v368, v114);
        v116 = _m_punpckhdq(v111, v111);
        v117 = _m_pfmul(0, v116);
        v118 = _m_pfadd(_m_pfadd(_m_pfmul(v114, 0), _m_pfmul(v112, 0)), _m_pfmul(v113, v369));
        v119 = _m_pfadd(_m_pfmul(v116, (__m64)0x3F80000000000000LL), v118);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            v117,
                                            _m_pfadd(_m_pfmul(0, v113), _m_pfadd(v115, _m_pfmul(v367, v112))));
        a1[7].m64_u64 = (unsigned __int64)v119;
        v120 = a1[1];
        v121 = _m_punpckhdq(v118, (__m64)a1->m64_u64);
        v122 = _m_punpckhdq(v119, v120);
        v123 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v124 = _m_punpckldq(v120, v120);
        v125 = _m_punpckhdq(v121, v121);
        v126 = _m_pfmul(v374, v125);
        v127 = _m_punpckhdq(v122, v122);
        v128 = _m_pfadd(_m_pfadd(_m_pfmul(v125, v376), _m_pfmul(v123, v372)), _m_pfmul(v124, v380));
        v129 = _m_pfadd(_m_pfmul(0, v127), _m_pfadd(_m_pfmul(v378, v124), _m_pfadd(v126, _m_pfmul(v370, v123))));
        v130 = a1[2];
        v131 = _m_pfadd(_m_pfmul(v127, v382), v128);
        v132 = a1[3];
        a1->m64_u64 = (unsigned __int64)v129;
        a1[1].m64_u64 = (unsigned __int64)v131;
        v133 = _m_punpckhdq(v128, v130);
        v134 = _m_punpckhdq(v131, v132);
        v135 = _m_punpckldq(v130, v130);
        v136 = _m_punpckldq(v132, v132);
        v137 = _m_punpckhdq(v133, v133);
        v138 = _m_pfmul(v374, v137);
        v139 = _m_punpckhdq(v134, v134);
        v140 = _m_pfadd(_m_pfadd(_m_pfmul(v137, v376), _m_pfmul(v135, v372)), _m_pfmul(v136, v380));
        v141 = _m_pfadd(_m_pfmul(0, v139), _m_pfadd(_m_pfmul(v378, v136), _m_pfadd(v138, _m_pfmul(v370, v135))));
        v142 = a1[4];
        v143 = _m_pfadd(_m_pfmul(v139, v382), v140);
        v144 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v141;
        a1[3].m64_u64 = (unsigned __int64)v143;
        v145 = _m_punpckhdq(v140, v142);
        v146 = _m_punpckhdq(v143, v144);
        v147 = _m_punpckldq(v142, v142);
        v148 = _m_punpckldq(v144, v144);
        v149 = _m_punpckhdq(v145, v145);
        v150 = _m_pfmul(v374, v149);
        v151 = _m_punpckhdq(v146, v146);
        v152 = _m_pfadd(_m_pfadd(_m_pfmul(v149, v376), _m_pfmul(v147, v372)), _m_pfmul(v148, v380));
        v153 = _m_pfadd(_m_pfmul(0, v151), _m_pfadd(_m_pfmul(v378, v148), _m_pfadd(v150, _m_pfmul(v370, v147))));
        v154 = a1[6];
        v155 = _m_pfadd(_m_pfmul(v151, v382), v152);
        v156 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v153;
        a1[5].m64_u64 = (unsigned __int64)v155;
        v157 = _m_punpckhdq(v152, v154);
        v158 = _m_punpckhdq(v155, v156);
        v159 = _m_punpckldq(v154, v154);
        v160 = _m_punpckldq(v156, v156);
        v161 = _m_punpckhdq(v157, v157);
        v162 = _m_punpckhdq(v158, v158);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            _m_pfmul(0, v162),
                                            _m_pfadd(
                                              _m_pfmul(v378, v160),
                                              _m_pfadd(_m_pfmul(v374, v161), _m_pfmul(v370, v159))));
        a1[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                            _m_pfmul(v162, v382),
                                            _m_pfadd(
                                              _m_pfadd(_m_pfmul(v161, v376), _m_pfmul(v159, v372)),
                                              _m_pfmul(v160, v380)));
        v163 = _m_pfadd(_mm_cvtsi32_si64(a2[1].m64_u32[0]), _mm_cvtsi32_si64(a1[7].m64_u32[0]));
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd((__m64)a2->m64_u64, a1[6]);
        a1[7].m64_i32[0] = _mm_cvtsi64_si32(v163);
      }
      else
      {
        result = a1;
        a1->m64_u64 = (unsigned __int64)_m_punpckldq(v370, v374);
        a1[2].m64_u64 = (unsigned __int64)_m_punpckhdq(v370, v374);
        v164 = _m_punpckldq(v380, v382);
        a1[5].m64_u64 = (unsigned __int64)v164;
        a1[7].m64_u64 = (unsigned __int64)_m_punpckhdq(v380, v382);
        a1[4].m64_u64 = (unsigned __int64)_m_punpckldq(v372, v376);
        v165 = _m_punpckldq(v378, 0);
        a1[6].m64_u64 = (unsigned __int64)_m_punpckhdq(v372, v376);
        a1[3].m64_u64 = (unsigned __int64)_m_punpckhdq(v378, 0);
        a1[1].m64_u64 = (unsigned __int64)v165;
        v166 = a1[1];
        v167 = _m_punpckhdq(v165, (__m64)a1->m64_u64);
        v168 = _m_punpckhdq(v164, v166);
        v169 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v170 = _m_punpckldq(v166, v166);
        v171 = _m_punpckhdq(v167, v167);
        v172 = _m_pfmul(v368, v171);
        v173 = _m_punpckhdq(v168, v168);
        v174 = _m_pfadd(_m_pfadd(_m_pfmul(v171, 0), _m_pfmul(v169, 0)), _m_pfmul(v170, v369));
        v175 = _m_pfadd(_m_pfmul(0, v173), _m_pfadd(_m_pfmul(0, v170), _m_pfadd(v172, _m_pfmul(v367, v169))));
        v176 = a1[2];
        v177 = _m_pfadd(_m_pfmul(v173, (__m64)0x3F80000000000000LL), v174);
        v178 = a1[3];
        a1->m64_u64 = (unsigned __int64)v175;
        a1[1].m64_u64 = (unsigned __int64)v177;
        v179 = _m_punpckhdq(v174, v176);
        v180 = _m_punpckhdq(v177, v178);
        v181 = _m_punpckldq(v176, v176);
        v182 = _m_punpckldq(v178, v178);
        v183 = _m_punpckhdq(v179, v179);
        v184 = _m_pfmul(v368, v183);
        v185 = _m_punpckhdq(v180, v180);
        v186 = _m_pfadd(_m_pfadd(_m_pfmul(v183, 0), _m_pfmul(v181, 0)), _m_pfmul(v182, v369));
        v187 = _m_pfadd(_m_pfmul(0, v185), _m_pfadd(_m_pfmul(0, v182), _m_pfadd(v184, _m_pfmul(v367, v181))));
        v188 = a1[4];
        v189 = _m_pfadd(_m_pfmul(v185, (__m64)0x3F80000000000000LL), v186);
        v190 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v187;
        a1[3].m64_u64 = (unsigned __int64)v189;
        v191 = _m_punpckhdq(v186, v188);
        v192 = _m_punpckhdq(v189, v190);
        v193 = _m_punpckldq(v188, v188);
        v194 = _m_punpckldq(v190, v190);
        v195 = _m_punpckhdq(v191, v191);
        v196 = _m_pfmul(v368, v195);
        v197 = _m_punpckhdq(v192, v192);
        v198 = _m_pfadd(_m_pfadd(_m_pfmul(v195, 0), _m_pfmul(v193, 0)), _m_pfmul(v194, v369));
        v199 = _m_pfadd(_m_pfmul(0, v197), _m_pfadd(_m_pfmul(0, v194), _m_pfadd(v196, _m_pfmul(v367, v193))));
        v200 = a1[6];
        v201 = _m_pfadd(_m_pfmul(v197, (__m64)0x3F80000000000000LL), v198);
        v202 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v199;
        a1[5].m64_u64 = (unsigned __int64)v201;
        v203 = _m_punpckhdq(v198, v200);
        v204 = _m_punpckhdq(v201, v202);
        v205 = _m_punpckldq(v200, v200);
        v206 = _m_punpckldq(v202, v202);
        v207 = _m_punpckhdq(v203, v203);
        v208 = _m_pfmul(v368, v207);
        v209 = _m_punpckhdq(v204, v204);
        v210 = _m_pfmul(0, v209);
        v211 = _m_pfadd(_m_pfadd(_m_pfmul(v207, 0), _m_pfmul(v205, 0)), _m_pfmul(v206, v369));
        v212 = _m_pfadd(_m_pfmul(v209, (__m64)0x3F80000000000000LL), v211);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            v210,
                                            _m_pfadd(_m_pfmul(0, v206), _m_pfadd(v208, _m_pfmul(v367, v205))));
        a1[7].m64_u64 = (unsigned __int64)v212;
        v213 = a1[1];
        v214 = _m_punpckhdq(v211, (__m64)a1->m64_u64);
        v215 = _m_punpckhdq(v212, v213);
        v216 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
        v217 = _m_punpckldq(v213, v213);
        v218 = _m_punpckhdq(v214, v214);
        v219 = _m_pfmul(v374, v218);
        v220 = _m_punpckhdq(v215, v215);
        v221 = _m_pfadd(_m_pfadd(_m_pfmul(v218, v376), _m_pfmul(v216, v372)), _m_pfmul(v217, v380));
        v222 = _m_pfadd(_m_pfmul(0, v220), _m_pfadd(_m_pfmul(v378, v217), _m_pfadd(v219, _m_pfmul(v370, v216))));
        v223 = a1[2];
        v224 = _m_pfadd(_m_pfmul(v220, v382), v221);
        v225 = a1[3];
        a1->m64_u64 = (unsigned __int64)v222;
        a1[1].m64_u64 = (unsigned __int64)v224;
        v226 = _m_punpckhdq(v221, v223);
        v227 = _m_punpckhdq(v224, v225);
        v228 = _m_punpckldq(v223, v223);
        v229 = _m_punpckldq(v225, v225);
        v230 = _m_punpckhdq(v226, v226);
        v231 = _m_pfmul(v374, v230);
        v232 = _m_punpckhdq(v227, v227);
        v233 = _m_pfadd(_m_pfadd(_m_pfmul(v230, v376), _m_pfmul(v228, v372)), _m_pfmul(v229, v380));
        v234 = _m_pfadd(_m_pfmul(0, v232), _m_pfadd(_m_pfmul(v378, v229), _m_pfadd(v231, _m_pfmul(v370, v228))));
        v235 = a1[4];
        v236 = _m_pfadd(_m_pfmul(v232, v382), v233);
        v237 = a1[5];
        a1[2].m64_u64 = (unsigned __int64)v234;
        a1[3].m64_u64 = (unsigned __int64)v236;
        v238 = _m_punpckhdq(v233, v235);
        v239 = _m_punpckhdq(v236, v237);
        v240 = _m_punpckldq(v235, v235);
        v241 = _m_punpckldq(v237, v237);
        v242 = _m_punpckhdq(v238, v238);
        v243 = _m_pfmul(v374, v242);
        v244 = _m_punpckhdq(v239, v239);
        v245 = _m_pfadd(_m_pfadd(_m_pfmul(v242, v376), _m_pfmul(v240, v372)), _m_pfmul(v241, v380));
        v246 = _m_pfadd(_m_pfmul(0, v244), _m_pfadd(_m_pfmul(v378, v241), _m_pfadd(v243, _m_pfmul(v370, v240))));
        v247 = a1[6];
        v248 = _m_pfadd(_m_pfmul(v244, v382), v245);
        v249 = a1[7];
        a1[4].m64_u64 = (unsigned __int64)v246;
        a1[5].m64_u64 = (unsigned __int64)v248;
        v250 = _m_punpckhdq(v245, v247);
        v251 = _m_punpckhdq(v248, v249);
        v252 = _m_punpckldq(v247, v247);
        v253 = _m_punpckldq(v249, v249);
        v254 = _m_punpckhdq(v250, v250);
        v255 = _m_punpckhdq(v251, v251);
        a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                            _m_pfmul(0, v255),
                                            _m_pfadd(
                                              _m_pfmul(v378, v253),
                                              _m_pfadd(_m_pfmul(v374, v254), _m_pfmul(v370, v252))));
        a1[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                            _m_pfmul(v255, v382),
                                            _m_pfadd(
                                              _m_pfadd(_m_pfmul(v254, v376), _m_pfmul(v252, v372)),
                                              _m_pfmul(v253, v380)));
      }
    }
    else
    {
      v256 = _mm_cvtsi32_si64(a4[1].m64_u32[0]);
      v257 = _m_punpckhdq(0, (__m64)a4->m64_u64);
      a1->m64_u64 = (unsigned __int64)_m_punpckldq((__m64)a4->m64_u64, 0);
      a1[1].m64_u64 = 0;
      a1[2].m64_u64 = (unsigned __int64)v257;
      a1[3].m64_u64 = 0;
      a1[4].m64_u64 = 0;
      a1[5].m64_u64 = (unsigned __int64)v256;
      a1[6].m64_u64 = 0;
      a1[7].m64_u64 = 0x3F80000000000000LL;
    }
  }
  else
  {
    v258 = _mm_cvtsi32_si64(0x3F800000u);
    v259 = _m_pswapd(v258);
    a1->m64_u64 = (unsigned __int64)v258;
    a1[1].m64_u64 = 0;
    a1[2].m64_u64 = (unsigned __int64)v259;
    a1[3].m64_u64 = 0;
    a1[4].m64_u64 = 0;
    a1[5].m64_u64 = (unsigned __int64)v258;
    a1[6].m64_u64 = 0;
    a1[7].m64_u64 = (unsigned __int64)v259;
  }
  if ( a6 )
  {
    v260 = a6[1];
    v261 = _m_pfadd(v260, v260);
    v262 = _m_pfadd((__m64)a6->m64_u64, (__m64)a6->m64_u64);
    v263 = _m_pfmul(v262, (__m64)a6->m64_u64);
    v264 = _m_punpckldq(v262, v261);
    v265 = _m_pfmul((__m64)a6->m64_u64, v261);
    v266 = _m_pfmul(_m_pswapd((__m64)a6->m64_u64), v261);
    v267 = _m_pfmul(v261, v260);
    v268 = _m_pfmul(_m_punpckhdq((__m64)a6->m64_u64, v260), v264);
    v269 = _m_pfpnacc(v266, v266);
    v270 = _m_pfpnacc(v268, v268);
    v271 = _m_pfpnacc(v265, v265);
    v272 = _m_pfsub(_m_pfsubr(v263, (__m64)0x3F8000003F800000LL), _m_punpckldq(v267, v267));
    v273 = _m_punpckldq(_m_pswapd(v271), v269);
    v274 = _m_punpckldq(v271, 0);
    v379 = v273;
    v275 = _m_punpckhdq(v269, 0);
    v373 = v274;
    v381 = _m_punpckhdq(_m_pfsubr(_m_pfacc(v263, v263), (__m64)0x3F8000003F800000LL), 0);
    v371 = _m_punpckhdq(v272, v270);
    v375 = _m_punpckldq(v270, v272);
    v377 = v275;
    v383 = _m_punpckldq(0, (__m64)1065353216LL);
    if ( a5 )
    {
      v276 = (__m64)a5->m64_u64;
      v277 = _mm_cvtsi32_si64(a5[1].m64_u32[0]);
      v278 = _m_pfsub(_mm_cvtsi32_si64(result[7].m64_u32[0]), v277);
      result[6].m64_u64 = (unsigned __int64)_m_pfsub(result[6], (__m64)a5->m64_u64);
      result[7].m64_i32[0] = _mm_cvtsi64_si32(v278);
      v279 = result[1];
      v280 = _m_punpckhdq(v276, (__m64)result->m64_u64);
      v281 = _m_punpckhdq(v277, v279);
      v282 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
      v283 = _m_punpckldq(v279, v279);
      v284 = _m_punpckhdq(v280, v280);
      v285 = _m_pfmul(v375, v284);
      v286 = _m_punpckhdq(v281, v281);
      v287 = _m_pfadd(_m_pfadd(_m_pfmul(v284, v377), _m_pfmul(v282, v373)), _m_pfmul(v283, v381));
      v288 = _m_pfadd(_m_pfmul(0, v286), _m_pfadd(_m_pfmul(v379, v283), _m_pfadd(v285, _m_pfmul(v371, v282))));
      v289 = result[2];
      v290 = _m_pfadd(_m_pfmul(v286, v383), v287);
      v291 = result[3];
      result->m64_u64 = (unsigned __int64)v288;
      result[1].m64_u64 = (unsigned __int64)v290;
      v292 = _m_punpckhdq(v287, v289);
      v293 = _m_punpckhdq(v290, v291);
      v294 = _m_punpckldq(v289, v289);
      v295 = _m_punpckldq(v291, v291);
      v296 = _m_punpckhdq(v292, v292);
      v297 = _m_pfmul(v375, v296);
      v298 = _m_punpckhdq(v293, v293);
      v299 = _m_pfadd(_m_pfadd(_m_pfmul(v296, v377), _m_pfmul(v294, v373)), _m_pfmul(v295, v381));
      v300 = _m_pfadd(_m_pfmul(0, v298), _m_pfadd(_m_pfmul(v379, v295), _m_pfadd(v297, _m_pfmul(v371, v294))));
      v301 = result[4];
      v302 = _m_pfadd(_m_pfmul(v298, v383), v299);
      v303 = result[5];
      result[2].m64_u64 = (unsigned __int64)v300;
      result[3].m64_u64 = (unsigned __int64)v302;
      v304 = _m_punpckhdq(v299, v301);
      v305 = _m_punpckhdq(v302, v303);
      v306 = _m_punpckldq(v301, v301);
      v307 = _m_punpckldq(v303, v303);
      v308 = _m_punpckhdq(v304, v304);
      v309 = _m_pfmul(v375, v308);
      v310 = _m_punpckhdq(v305, v305);
      v311 = _m_pfadd(_m_pfadd(_m_pfmul(v308, v377), _m_pfmul(v306, v373)), _m_pfmul(v307, v381));
      v312 = _m_pfadd(_m_pfmul(0, v310), _m_pfadd(_m_pfmul(v379, v307), _m_pfadd(v309, _m_pfmul(v371, v306))));
      v313 = result[6];
      v314 = _m_pfadd(_m_pfmul(v310, v383), v311);
      v315 = result[7];
      result[4].m64_u64 = (unsigned __int64)v312;
      result[5].m64_u64 = (unsigned __int64)v314;
      v316 = _m_punpckhdq(v311, v313);
      v317 = _m_punpckhdq(v314, v315);
      v318 = _m_punpckldq(v313, v313);
      v319 = _m_punpckldq(v315, v315);
      v320 = _m_punpckhdq(v316, v316);
      v321 = _m_punpckhdq(v317, v317);
      result[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                              _m_pfmul(0, v321),
                                              _m_pfadd(
                                                _m_pfmul(v379, v319),
                                                _m_pfadd(_m_pfmul(v375, v320), _m_pfmul(v371, v318))));
      result[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                              _m_pfmul(v321, v383),
                                              _m_pfadd(
                                                _m_pfadd(_m_pfmul(v320, v377), _m_pfmul(v318, v373)),
                                                _m_pfmul(v319, v381)));
      v322 = _m_pfadd(_mm_cvtsi32_si64(result[7].m64_u32[0]), _mm_cvtsi32_si64(a5[1].m64_u32[0]));
      result[6].m64_u64 = (unsigned __int64)_m_pfadd(result[6], (__m64)a5->m64_u64);
      result[7].m64_i32[0] = _mm_cvtsi64_si32(v322);
    }
    else
    {
      v323 = result[1];
      v324 = _m_punpckhdq(v274, (__m64)result->m64_u64);
      v325 = _m_punpckhdq(v275, v323);
      v326 = _m_punpckldq((__m64)result->m64_u64, (__m64)result->m64_u64);
      v327 = _m_punpckldq(v323, v323);
      v328 = _m_punpckhdq(v324, v324);
      v329 = _m_pfmul(v375, v328);
      v330 = _m_punpckhdq(v325, v325);
      v331 = _m_pfadd(_m_pfadd(_m_pfmul(v328, v377), _m_pfmul(v326, v373)), _m_pfmul(v327, v381));
      v332 = _m_pfadd(_m_pfmul(0, v330), _m_pfadd(_m_pfmul(v379, v327), _m_pfadd(v329, _m_pfmul(v371, v326))));
      v333 = result[2];
      v334 = _m_pfadd(_m_pfmul(v330, v383), v331);
      v335 = result[3];
      result->m64_u64 = (unsigned __int64)v332;
      result[1].m64_u64 = (unsigned __int64)v334;
      v336 = _m_punpckhdq(v331, v333);
      v337 = _m_punpckhdq(v334, v335);
      v338 = _m_punpckldq(v333, v333);
      v339 = _m_punpckldq(v335, v335);
      v340 = _m_punpckhdq(v336, v336);
      v341 = _m_pfmul(v375, v340);
      v342 = _m_punpckhdq(v337, v337);
      v343 = _m_pfadd(_m_pfadd(_m_pfmul(v340, v377), _m_pfmul(v338, v373)), _m_pfmul(v339, v381));
      v344 = _m_pfadd(_m_pfmul(0, v342), _m_pfadd(_m_pfmul(v379, v339), _m_pfadd(v341, _m_pfmul(v371, v338))));
      v345 = result[4];
      v346 = _m_pfadd(_m_pfmul(v342, v383), v343);
      v347 = result[5];
      result[2].m64_u64 = (unsigned __int64)v344;
      result[3].m64_u64 = (unsigned __int64)v346;
      v348 = _m_punpckhdq(v343, v345);
      v349 = _m_punpckhdq(v346, v347);
      v350 = _m_punpckldq(v345, v345);
      v351 = _m_punpckldq(v347, v347);
      v352 = _m_punpckhdq(v348, v348);
      v353 = _m_pfmul(v375, v352);
      v354 = _m_punpckhdq(v349, v349);
      v355 = _m_pfadd(_m_pfadd(_m_pfmul(v352, v377), _m_pfmul(v350, v373)), _m_pfmul(v351, v381));
      v356 = _m_pfadd(_m_pfmul(0, v354), _m_pfadd(_m_pfmul(v379, v351), _m_pfadd(v353, _m_pfmul(v371, v350))));
      v357 = result[6];
      v358 = _m_pfadd(_m_pfmul(v354, v383), v355);
      v359 = result[7];
      result[4].m64_u64 = (unsigned __int64)v356;
      result[5].m64_u64 = (unsigned __int64)v358;
      v360 = _m_punpckhdq(v355, v357);
      v361 = _m_punpckhdq(v358, v359);
      v362 = _m_punpckldq(v357, v357);
      v363 = _m_punpckldq(v359, v359);
      v364 = _m_punpckhdq(v360, v360);
      v365 = _m_punpckhdq(v361, v361);
      result[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                              _m_pfmul(0, v365),
                                              _m_pfadd(
                                                _m_pfmul(v379, v363),
                                                _m_pfadd(_m_pfmul(v375, v364), _m_pfmul(v371, v362))));
      result[7].m64_u64 = (unsigned __int64)_m_pfadd(
                                              _m_pfmul(v365, v383),
                                              _m_pfadd(
                                                _m_pfadd(_m_pfmul(v364, v377), _m_pfmul(v362, v373)),
                                                _m_pfmul(v363, v381)));
    }
  }
  if ( a7 )
  {
    v366 = _m_pfadd(_mm_cvtsi32_si64(result[7].m64_u32[0]), _mm_cvtsi32_si64(a7[1].m64_u32[0]));
    result[6].m64_u64 = (unsigned __int64)_m_pfadd(result[6], (__m64)a7->m64_u64);
    result[7].m64_i32[0] = _mm_cvtsi64_si32(v366);
  }
  _m_femms();
  return result;
}

// sub_45DD30 @ 0x0045DD30
int __stdcall sub_45DD30(__m64 *a1, _DWORD *a2, __m64 *a3)
{
  __m64 v3; // mm1
  __m64 v4; // mm2
  __m64 v5; // mm0
  __m64 v6; // mm5
  __m64 v7; // mm6
  __m64 v8; // mm1
  __m64 v9; // mm0
  __m64 v10; // mm7
  __m64 v11; // mm2
  __m64 v12; // rt1
  __m64 v13; // mm1
  __m64 v14; // mm0
  __m64 v15; // mm5
  __m64 v16; // mm6
  __m64 v17; // mm1
  __m64 v18; // mm0
  __m64 v19; // mm7
  __m64 v20; // mm2
  __m64 v21; // mm0
  __m64 v22; // mm0
  __m64 v23; // mm1
  int result; // eax
  __m64 v25; // mm0
  __m64 v26; // mm1
  __m64 v27; // mm3
  __m64 v28; // mm6
  __m64 v29; // mm4
  __m64 v30; // mm7
  __m64 v31; // mm3
  __m64 v32; // mm6
  __m64 v33; // mm4
  __m64 v34; // mm7
  __m64 v35; // [esp+0h] [ebp-40h]
  __m64 v36; // [esp+8h] [ebp-38h]
  __m64 v37; // [esp+10h] [ebp-30h]
  __m64 v38; // [esp+18h] [ebp-28h]
  __m64 v39; // [esp+20h] [ebp-20h]
  __m64 v40; // [esp+28h] [ebp-18h]
  __m64 v41; // [esp+30h] [ebp-10h]
  __m64 v42; // [esp+38h] [ebp-8h]

  v3 = a3[2];
  v4 = a3[4];
  v5 = _m_pswapd(a3[6]);
  v6 = _m_pfnacc(_m_pfmul(_m_pswapd(v3), (__m64)a3->m64_u64), _m_pfmul(_m_pswapd(v4), (__m64)a3->m64_u64));
  v7 = _m_pfnacc(_m_pfmul(v5, (__m64)a3->m64_u64), _m_pfmul(_m_pswapd(v4), v3));
  v8 = _m_pfnacc(_m_pfmul(v3, v5), _m_pfmul(v4, v5));
  v9 = a3[7];
  v10 = a3[5];
  v36 = _m_pfsub(
          _m_pfadd(_m_pfmul(_m_punpckhdq(v7, v7), v9), _m_pfmul(_m_punpckhdq(v8, v8), a3[3])),
          _m_pfmul(_m_punpckldq(v8, v8), v10));
  v38 = _m_pfadd(
          _m_pfsub(_m_pfmul(_m_punpckhdq(v6, v6), v9), _m_pfmul(_m_punpckldq(v7, v7), v10)),
          _m_pfmul(_m_punpckhdq(v8, v8), a3[1]));
  v11 = _m_punpckldq(v6, v6);
  v40 = _m_pfsub(
          _m_pfadd(_m_pfmul(v9, v11), _m_pfmul(_m_punpckldq(v8, v8), a3[1])),
          _m_pfmul(_m_punpckldq(v7, v7), a3[3]));
  v12 = a3[1];
  v42 = _m_pfadd(
          _m_pfsub(_m_pfmul(v11, v10), _m_pfmul(_m_punpckhdq(v6, v6), a3[3])),
          _m_pfmul(_m_punpckhdq(v7, v7), v12));
  v13 = a3[3];
  v14 = _m_pswapd(v9);
  v15 = _m_pfnacc(_m_pfmul(_m_pswapd(v13), v12), _m_pfmul(_m_pswapd(v10), v12));
  v16 = _m_pfnacc(_m_pfmul(v14, v12), _m_pfmul(_m_pswapd(v10), v13));
  v17 = _m_pfnacc(_m_pfmul(v13, v14), _m_pfmul(v10, v14));
  v18 = a3[6];
  v19 = a3[4];
  v35 = _m_pfsub(
          _m_pfadd(_m_pfmul(_m_punpckhdq(v16, v16), v18), _m_pfmul(_m_punpckhdq(v17, v17), a3[2])),
          _m_pfmul(_m_punpckldq(v17, v17), v19));
  v37 = _m_pfadd(
          _m_pfsub(_m_pfmul(_m_punpckhdq(v15, v15), v18), _m_pfmul(_m_punpckldq(v16, v16), v19)),
          _m_pfmul(_m_punpckhdq(v17, v17), (__m64)a3->m64_u64));
  v20 = _m_punpckldq(v15, v15);
  v39 = _m_pfsub(
          _m_pfadd(_m_pfmul(v18, v20), _m_pfmul(_m_punpckldq(v17, v17), (__m64)a3->m64_u64)),
          _m_pfmul(_m_punpckldq(v16, v16), a3[2]));
  v41 = _m_pfadd(
          _m_pfsub(_m_pfmul(v20, v19), _m_pfmul(_m_punpckhdq(v15, v15), a3[2])),
          _m_pfmul(_m_punpckhdq(v16, v16), (__m64)a3->m64_u64));
  v21 = _m_pfnacc(
          _m_pfmul(_m_punpckhdq(v39, v41), _m_punpckldq(v19, v18)),
          _m_pfmul(_m_punpckldq((__m64)a3->m64_u64, (__m64)a3[2].m64_u32[0]), _m_punpckhdq(v35, v37)));
  v22 = _m_pfacc(v21, v21);
  if ( a2 )
    *a2 = _mm_cvtsi64_si32(v22);
  v23 = _m_pfrcp(v22);
  result = _mm_cvtsi64_si32(_m_pfcmpeq(0, v22));
  v25 = _m_pfmul(_m_pfrcpit2(_m_pfrcpit1(_m_punpckldq(v22, v22), v23), v23), (__m64)0xBF8000003F800000uLL);
  v26 = _m_pswapd(v25);
  if ( !result )
  {
    result = (int)a1;
    v27 = _m_pfmul(v37, v25);
    v28 = _m_pfmul(v38, v25);
    v29 = _m_pfmul(v35, v26);
    v30 = _m_pfmul(v36, v26);
    a1->m64_u64 = (unsigned __int64)_m_punpckhdq(v29, v27);
    a1[2].m64_u64 = (unsigned __int64)_m_punpckldq(v29, v27);
    a1[4].m64_u64 = (unsigned __int64)_m_punpckhdq(v30, v28);
    a1[6].m64_u64 = (unsigned __int64)_m_punpckldq(v30, v28);
    v31 = _m_pfmul(v41, v25);
    v32 = _m_pfmul(v42, v25);
    v33 = _m_pfmul(v39, v26);
    v34 = _m_pfmul(v40, v26);
    a1[1].m64_u64 = (unsigned __int64)_m_punpckhdq(v33, v31);
    a1[3].m64_u64 = (unsigned __int64)_m_punpckldq(v33, v31);
    a1[5].m64_u64 = (unsigned __int64)_m_punpckhdq(v34, v32);
    a1[7].m64_u64 = (unsigned __int64)_m_punpckldq(v34, v32);
  }
  _m_femms();
  return result;
}

// sub_45E012 @ 0x0045E012
__m64 *__stdcall sub_45E012(__m64 *a1, __m64 *a2, __m64 *a3)
{
  __m64 v3; // mm1
  __m64 v4; // mm4
  __m64 v5; // mm5
  __m64 v6; // mm7
  __m64 v7; // mm0
  __m64 v8; // mm1
  __m64 v9; // mm4
  __m64 *result; // eax
  __m64 v11; // mm4
  __m64 v12; // mm4
  __m64 v13; // mm4
  __m64 v14; // mm4
  __m64 v15; // mm4
  __m64 v16; // mm4
  __m64 v17; // mm4
  __m64 v18; // [esp+0h] [ebp-44h]
  __m64 v19; // [esp+0h] [ebp-44h]
  __m64 v20; // [esp+8h] [ebp-3Ch]
  __m64 v21; // [esp+8h] [ebp-3Ch]
  __m64 v22; // [esp+10h] [ebp-34h]
  __m64 v23; // [esp+10h] [ebp-34h]
  __m64 v24; // [esp+18h] [ebp-2Ch]
  __m64 v25; // [esp+18h] [ebp-2Ch]
  __m64 v26; // [esp+20h] [ebp-24h]
  __m64 v27; // [esp+20h] [ebp-24h]
  __m64 v28; // [esp+28h] [ebp-1Ch]
  __m64 v29; // [esp+28h] [ebp-1Ch]
  __m64 v30; // [esp+30h] [ebp-14h]
  __m64 v31; // [esp+38h] [ebp-Ch]

  _m_femms();
  v3 = a3[2];
  v4 = a3[7];
  v5 = a3[5];
  v18 = _m_punpckldq((__m64)a3->m64_u64, v3);
  v22 = _m_punpckhdq((__m64)a3->m64_u64, v3);
  v6 = a3[3];
  v7 = a3[4];
  v8 = a3[1];
  v28 = _m_punpckldq(v5, v4);
  v31 = _m_punpckhdq(v5, v4);
  v9 = a3[6];
  v26 = _m_punpckldq(v8, v6);
  v30 = _m_punpckhdq(v8, v6);
  v24 = _m_punpckhdq(v7, v9);
  v20 = _m_punpckldq(v7, v9);
  result = a1;
  v11 = _m_pfadd(
          _m_pfacc(_m_pfmul(v18, a2[4]), _m_pfmul(v18, a2[6])),
          _m_pfacc(_m_pfmul(v20, a2[5]), _m_pfmul(v20, a2[7])));
  if ( a2 == a1 )
  {
    v19 = _m_pfadd(
            _m_pfacc(_m_pfmul(v18, (__m64)a2->m64_u64), _m_pfmul(v18, a2[2])),
            _m_pfacc(_m_pfmul(v20, a2[1]), _m_pfmul(v20, a2[3])));
    v21 = v11;
    v15 = _m_pfadd(
            _m_pfacc(_m_pfmul(v22, a2[4]), _m_pfmul(v22, a2[6])),
            _m_pfacc(_m_pfmul(v24, a2[5]), _m_pfmul(v24, a2[7])));
    v23 = _m_pfadd(
            _m_pfacc(_m_pfmul(v22, (__m64)a2->m64_u64), _m_pfmul(v22, a2[2])),
            _m_pfacc(_m_pfmul(v24, a2[1]), _m_pfmul(v24, a2[3])));
    v25 = v15;
    v16 = _m_pfadd(
            _m_pfacc(_m_pfmul(v26, a2[4]), _m_pfmul(v26, a2[6])),
            _m_pfacc(_m_pfmul(v28, a2[5]), _m_pfmul(v28, a2[7])));
    v27 = _m_pfadd(
            _m_pfacc(_m_pfmul(v26, (__m64)a2->m64_u64), _m_pfmul(v26, a2[2])),
            _m_pfacc(_m_pfmul(v28, a2[1]), _m_pfmul(v28, a2[3])));
    v29 = v16;
    v17 = _m_pfadd(
            _m_pfacc(_m_pfmul(v30, a2[4]), _m_pfmul(v30, a2[6])),
            _m_pfacc(_m_pfmul(v31, a2[5]), _m_pfmul(v31, a2[7])));
    a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                        _m_pfacc(_m_pfmul(v30, (__m64)a2->m64_u64), _m_pfmul(v30, a2[2])),
                                        _m_pfacc(_m_pfmul(v31, a2[1]), _m_pfmul(v31, a2[3])));
    a1[7].m64_u64 = (unsigned __int64)v17;
    a1->m64_u64 = (unsigned __int64)v19;
    a1[1].m64_u64 = (unsigned __int64)v21;
    a1[2].m64_u64 = (unsigned __int64)v23;
    a1[3].m64_u64 = (unsigned __int64)v25;
    a1[4].m64_u64 = (unsigned __int64)v27;
    a1[5].m64_u64 = (unsigned __int64)v29;
  }
  else
  {
    a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfacc(_m_pfmul(v18, (__m64)a2->m64_u64), _m_pfmul(v18, a2[2])),
                                      _m_pfacc(_m_pfmul(v20, a2[1]), _m_pfmul(v20, a2[3])));
    a1[1].m64_u64 = (unsigned __int64)v11;
    v12 = _m_pfadd(
            _m_pfacc(_m_pfmul(v22, a2[4]), _m_pfmul(v22, a2[6])),
            _m_pfacc(_m_pfmul(v24, a2[5]), _m_pfmul(v24, a2[7])));
    a1[2].m64_u64 = (unsigned __int64)_m_pfadd(
                                        _m_pfacc(_m_pfmul(v22, (__m64)a2->m64_u64), _m_pfmul(v22, a2[2])),
                                        _m_pfacc(_m_pfmul(v24, a2[1]), _m_pfmul(v24, a2[3])));
    a1[3].m64_u64 = (unsigned __int64)v12;
    v13 = _m_pfadd(
            _m_pfacc(_m_pfmul(v26, a2[4]), _m_pfmul(v26, a2[6])),
            _m_pfacc(_m_pfmul(v28, a2[5]), _m_pfmul(v28, a2[7])));
    a1[4].m64_u64 = (unsigned __int64)_m_pfadd(
                                        _m_pfacc(_m_pfmul(v26, (__m64)a2->m64_u64), _m_pfmul(v26, a2[2])),
                                        _m_pfacc(_m_pfmul(v28, a2[1]), _m_pfmul(v28, a2[3])));
    a1[5].m64_u64 = (unsigned __int64)v13;
    v14 = _m_pfadd(
            _m_pfacc(_m_pfmul(v30, a2[4]), _m_pfmul(v30, a2[6])),
            _m_pfacc(_m_pfmul(v31, a2[5]), _m_pfmul(v31, a2[7])));
    a1[6].m64_u64 = (unsigned __int64)_m_pfadd(
                                        _m_pfacc(_m_pfmul(v30, (__m64)a2->m64_u64), _m_pfmul(v30, a2[2])),
                                        _m_pfacc(_m_pfmul(v31, a2[1]), _m_pfmul(v31, a2[3])));
    a1[7].m64_u64 = (unsigned __int64)v14;
  }
  _m_femms();
  return result;
}

// mat4_invert @ 0x0045E40A
// inverts a 4x4 matrix; optionally writes determinant
float *mat4_invert(float *out, float *det_out, float *mat)
{
  __m64 v3; // mm1
  __m64 v4; // mm2
  __m64 v5; // mm5
  __m64 v6; // mm0
  __m64 v7; // mm4
  __m64 v8; // mm3
  __m64 v9; // mm6
  __m64 v10; // mm4
  __m64 v11; // mm6
  __m64 v12; // mm1
  __m64 v13; // mm0
  __m64 v14; // mm7
  __m64 v15; // mm2
  __m64 v16; // mm0
  __m64 v17; // mm1
  __m64 v18; // mm5
  __m64 v19; // mm0
  __m64 v20; // mm4
  __m64 v21; // mm3
  __m64 v22; // mm6
  __m64 v23; // mm4
  __m64 v24; // mm6
  __m64 v25; // mm1
  __m64 v26; // mm0
  __m64 v27; // mm7
  __m64 v28; // mm2
  __m64 v29; // mm2
  __m64 v30; // mm0
  __m64 v31; // mm0
  __m64 v32; // mm1
  float *result; // eax
  __m64 v34; // mm0
  __m64 v35; // mm1
  __m64 v36; // mm3
  __m64 v37; // mm6
  __m64 v38; // mm4
  __m64 v39; // mm7
  __m64 v40; // mm3
  __m64 v41; // mm6
  __m64 v42; // mm4
  __m64 v43; // mm7
  __m64 v44; // [esp+0h] [ebp-44h]
  __m64 v45; // [esp+8h] [ebp-3Ch]
  __m64 v46; // [esp+10h] [ebp-34h]
  __m64 v47; // [esp+18h] [ebp-2Ch]
  __m64 v48; // [esp+20h] [ebp-24h]
  __m64 v49; // [esp+28h] [ebp-1Ch]
  __m64 v50; // [esp+38h] [ebp-Ch]

  v3 = *(__m64 *)(mat + 4);
  v4 = *(__m64 *)(mat + 8);
  v5 = _m_pfsub(
         _m_pfmul(_m_punpckldq(*(__m64 *)mat, *(__m64 *)mat), _m_punpckhdq(v3, v4)),
         _m_pfmul(_m_punpckhdq(*(__m64 *)mat, *(__m64 *)mat), _m_punpckldq(v3, v4)));
  v6 = _m_punpckldq(*(__m64 *)mat, v3);
  v7 = *(__m64 *)(mat + 12);
  v8 = _m_punpckhdq(v7, v7);
  v9 = _m_punpckhdq(v7, v4);
  v10 = _m_punpckldq(v7, v4);
  v11 = _m_pfsub(_m_pfmul(v9, v6), _m_pfmul(_m_punpckhdq(*(__m64 *)mat, v3), v10));
  v12 = _m_pfsubr(_m_pfmul(_m_punpckhdq(v3, v4), _m_punpckldq(v10, v10)), _m_pfmul(_m_punpckhdq(v6, v10), v8));
  v13 = *(__m64 *)(mat + 14);
  v14 = *(__m64 *)(mat + 10);
  v45 = _m_pfsub(
          _m_pfadd(_m_pfmul(_m_punpckhdq(v11, v11), v13), _m_pfmul(_m_punpckhdq(v12, v12), *(__m64 *)(mat + 6))),
          _m_pfmul(_m_punpckldq(v12, v12), v14));
  v47 = _m_pfadd(
          _m_pfsub(_m_pfmul(_m_punpckhdq(v5, v5), v13), _m_pfmul(_m_punpckldq(v11, v11), v14)),
          _m_pfmul(_m_punpckhdq(v12, v12), *(__m64 *)(mat + 2)));
  v15 = _m_punpckldq(v5, v5);
  v49 = _m_pfsub(
          _m_pfadd(_m_pfmul(v13, v15), _m_pfmul(_m_punpckldq(v12, v12), *(__m64 *)(mat + 2))),
          _m_pfmul(_m_punpckldq(v11, v11), *(__m64 *)(mat + 6)));
  v50 = _m_pfadd(
          _m_pfsub(_m_pfmul(v15, v14), _m_pfmul(_m_punpckhdq(v5, v5), *(__m64 *)(mat + 6))),
          _m_pfmul(_m_punpckhdq(v11, v11), *(__m64 *)(mat + 2)));
  v16 = *(__m64 *)(mat + 2);
  v17 = *(__m64 *)(mat + 6);
  v18 = _m_pfsub(
          _m_pfmul(_m_punpckldq(v16, v16), _m_punpckhdq(v17, v14)),
          _m_pfmul(_m_punpckhdq(v16, v16), _m_punpckldq(v17, v14)));
  v19 = _m_punpckldq(v16, v17);
  v20 = *(__m64 *)(mat + 14);
  v21 = _m_punpckhdq(v20, v20);
  v22 = _m_punpckhdq(v20, v14);
  v23 = _m_punpckldq(v20, v14);
  v24 = _m_pfsub(_m_pfmul(v22, v19), _m_pfmul(_m_punpckhdq(*(__m64 *)(mat + 2), v17), v23));
  v25 = _m_pfsubr(_m_pfmul(_m_punpckhdq(v17, v14), _m_punpckldq(v23, v23)), _m_pfmul(_m_punpckhdq(v19, v23), v21));
  v26 = *(__m64 *)(mat + 12);
  v27 = *(__m64 *)(mat + 8);
  v44 = _m_pfsub(
          _m_pfadd(_m_pfmul(_m_punpckhdq(v24, v24), v26), _m_pfmul(_m_punpckhdq(v25, v25), *(__m64 *)(mat + 4))),
          _m_pfmul(_m_punpckldq(v25, v25), v27));
  v46 = _m_pfadd(
          _m_pfsub(_m_pfmul(_m_punpckhdq(v18, v18), v26), _m_pfmul(_m_punpckldq(v24, v24), v27)),
          _m_pfmul(_m_punpckhdq(v25, v25), *(__m64 *)mat));
  v28 = _m_punpckldq(v18, v18);
  v48 = _m_pfsub(
          _m_pfadd(_m_pfmul(v26, v28), _m_pfmul(_m_punpckldq(v25, v25), *(__m64 *)mat)),
          _m_pfmul(_m_punpckldq(v24, v24), *(__m64 *)(mat + 4)));
  v29 = _m_pfadd(
          _m_pfsub(_m_pfmul(v28, v27), _m_pfmul(_m_punpckhdq(v18, v18), *(__m64 *)(mat + 4))),
          _m_pfmul(_m_punpckhdq(v24, v24), *(__m64 *)mat));
  v30 = _m_pfadd(
          _m_pfmul(_m_punpckhdq(v48, v29), _m_pfmul(_m_punpckldq(v27, v26), (__m64)0xBF8000003F800000uLL)),
          _m_pfmul(
            _m_pfmul(_m_punpckldq(*(__m64 *)mat, (__m64)*((unsigned int *)mat + 4)), (__m64)0xBF8000003F800000uLL),
            _m_punpckhdq(v44, v46)));
  v31 = _m_pfacc(v30, v30);
  if ( det_out )
    *(_DWORD *)det_out = _mm_cvtsi64_si32(v31);
  v32 = _m_pfrcp(v31);
  result = (float *)_mm_cvtsi64_si32(_m_pfcmpeq(0, v31));
  v34 = _m_pfmul(_m_pfrcpit2(_m_pfrcpit1(_m_punpckldq(v31, v31), v32), v32), (__m64)0xBF8000003F800000uLL);
  v35 = _m_punpckhdq(v34, _m_punpckldq(v29, v34));
  if ( !result )
  {
    v36 = _m_pfmul(v46, v34);
    v37 = _m_pfmul(v47, v34);
    v38 = _m_pfmul(v44, v35);
    v39 = _m_pfmul(v45, v35);
    *(__m64 *)out = _m_punpckhdq(v38, v36);
    *((__m64 *)out + 2) = _m_punpckldq(v38, v36);
    *((__m64 *)out + 4) = _m_punpckhdq(v39, v37);
    *((__m64 *)out + 6) = _m_punpckldq(v39, v37);
    v40 = _m_pfmul(v29, v34);
    v41 = _m_pfmul(v50, v34);
    v42 = _m_pfmul(v48, v35);
    v43 = _m_pfmul(v49, v35);
    *((__m64 *)out + 1) = _m_punpckhdq(v42, v40);
    *((__m64 *)out + 3) = _m_punpckldq(v42, v40);
    *((__m64 *)out + 5) = _m_punpckhdq(v43, v41);
    *((__m64 *)out + 7) = _m_punpckldq(v43, v41);
    return out;
  }
  return result;
}

// sub_45E73E @ 0x0045E73E
__m64 *__stdcall sub_45E73E(__m64 *a1, _DWORD *a2, __m64 *a3)
{
  _m_femms();
  mat4_invert(a1, a2, a3);
  _m_femms();
  return a1;
}

// sub_45E75A @ 0x0045E75A
__m64 *__stdcall sub_45E75A(__m64 *a1, __m64 *a2, __m64 *a3)
{
  unsigned __int64 m64_u64; // mm1
  __m64 v4; // mm0
  __m64 v5; // mm2
  __m64 v6; // mm4
  __m64 v7; // mm5
  __m64 v8; // mm3

  _m_femms();
  m64_u64 = a2->m64_u64;
  v4 = _m_punpckldq((__m64)m64_u64, (__m64)m64_u64);
  v5 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
  v6 = _m_punpckhdq((__m64)m64_u64, (__m64)m64_u64);
  v7 = _m_punpckldq(v5, v5);
  v8 = _m_pfadd(_m_pfadd(_m_pfmul(v4, a3[1]), a3[7]), _m_pfadd(_m_pfmul(v6, a3[3]), _m_pfmul(v7, a3[5])));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(_m_pfmul(v4, (__m64)a3->m64_u64), a3[6]),
                                    _m_pfadd(_m_pfmul(v6, a3[2]), _m_pfmul(v7, a3[4])));
  a1[1].m64_u64 = (unsigned __int64)v8;
  _m_femms();
  return a1;
}

// sub_45E7CB @ 0x0045E7CB
__m64 *__stdcall sub_45E7CB(__m64 *a1, __m64 *a2, __m64 *a3)
{
  unsigned __int64 m64_u64; // mm1
  __m64 v4; // mm0
  __m64 v5; // mm2
  __m64 v6; // mm4
  __m64 v7; // mm5
  __m64 v8; // mm3

  _m_femms();
  m64_u64 = a2->m64_u64;
  v4 = _m_punpckldq((__m64)m64_u64, (__m64)m64_u64);
  v5 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
  v6 = _m_punpckhdq((__m64)m64_u64, (__m64)m64_u64);
  v7 = _m_punpckldq(v5, v5);
  v8 = _m_pfadd(_m_pfmul(v4, a3[1]), _m_pfadd(_m_pfmul(v6, a3[3]), _m_pfmul(v7, a3[5])));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfmul(v4, (__m64)a3->m64_u64),
                                    _m_pfadd(_m_pfmul(v6, a3[2]), _m_pfmul(v7, a3[4])));
  a1[1].m64_i32[0] = _mm_cvtsi64_si32(v8);
  _m_femms();
  return a1;
}

// sub_45E832 @ 0x0045E832
__m64 *__stdcall sub_45E832(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm3
  __m64 v3; // mm0
  __m64 v4; // mm0
  __m64 v5; // mm4
  __m64 v6; // mm5
  __m64 v8; // mm0

  _m_femms();
  v2 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
  v3 = _m_pfadd(_m_pfmul((__m64)a2->m64_u64, (__m64)a2->m64_u64), _m_pfmul(v2, v2));
  v4 = _m_pfacc(v3, v3);
  v5 = _m_pfrsqrt(v4);
  v6 = _m_pfcmpgt(v4, (__m64)0x80000000800000LL);
  v8 = _m_pfrcpit2(_m_pfrsqit1(v4, _m_pfmul(v5, v5)), v5);
  a1->m64_u64 = (unsigned __int64)_m_pfmul(_m_pand((__m64)a2->m64_u64, v6), v8);
  a1[1].m64_i32[0] = _mm_cvtsi64_si32(_m_pfmul(_m_pand(v2, v6), v8));
  _m_femms();
  return a1;
}

// sub_45E891 @ 0x0045E891
__m64 *__stdcall sub_45E891(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, unsigned int a5, unsigned int a6)
{
  __m64 v6; // mm6
  __m64 v7; // mm5
  __m64 v8; // mm7
  __m64 v10; // mm6
  __m64 v11; // mm7
  __m64 v12; // mm1

  v6 = _mm_cvtsi32_si64(a5);
  v7 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
  v8 = _mm_cvtsi32_si64(a6);
  v10 = _m_punpckldq(v6, v6);
  v11 = _m_punpckldq(v8, v8);
  v12 = _m_pfadd(
          _m_pfadd(_m_pfmul(_m_pfsub(_mm_cvtsi32_si64(a3[1].m64_u32[0]), v7), v10), v7),
          _m_pfmul(_m_pfsub(_mm_cvtsi32_si64(a4[1].m64_u32[0]), v7), v11));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(
                                      _m_pfmul(_m_pfsub((__m64)a3->m64_u64, (__m64)a2->m64_u64), v10),
                                      (__m64)a2->m64_u64),
                                    _m_pfmul(_m_pfsub((__m64)a4->m64_u64, (__m64)a2->m64_u64), v11));
  a1[1].m64_i32[0] = _mm_cvtsi64_si32(v12);
  _m_femms();
  return a1;
}

// sub_45E902 @ 0x0045E902
__m64 *__stdcall sub_45E902(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, unsigned int a6)
{
  __m64 v6; // mm0
  __m64 v7; // mm1
  __m64 v8; // mm2
  __m64 v9; // mm7
  __m64 v10; // mm4
  __m64 v11; // mm6
  __m64 v12; // mm2
  __m64 v13; // mm5
  __m64 v14; // mm1
  __m64 v15; // mm6
  __m64 v16; // mm2
  __m64 v17; // mm5
  __m64 v18; // mm0
  __m64 v19; // mm1
  __m64 v21; // mm4
  __m64 v22; // mm3
  __m64 v23; // mm0

  _m_femms();
  v6 = _mm_cvtsi32_si64(a6);
  v7 = _m_pfmul(v6, v6);
  v8 = _m_pfmul(v7, v6);
  v9 = _m_pfsub(v8, v7);
  v10 = _m_pfmul(v7, (__m64)0x4000000040000000LL);
  v11 = v8;
  v12 = _m_pfmul(v8, (__m64)0x4000000040000000LL);
  v13 = _m_pfmul(v7, (__m64)0x4040000040400000LL);
  v14 = _m_pfsub(v13, v12);
  v15 = _m_pfadd(_m_pfsub(v11, v10), v6);
  v16 = _m_pfadd(_m_pfsub(v12, v13), (__m64)0x3F8000003F800000LL);
  v17 = _m_punpckldq(v9, v9);
  v18 = _m_punpckldq(v14, v14);
  v19 = _m_pfmul(v18, (__m64)a4->m64_u64);
  v21 = _m_punpckldq(v15, v15);
  v22 = _m_punpckldq(v16, v16);
  v23 = _m_pfadd(
          _m_pfadd(_m_pfmul(v18, _mm_cvtsi32_si64(a4[1].m64_u32[0])), _m_pfmul(v17, _mm_cvtsi32_si64(a5[1].m64_u32[0]))),
          _m_pfadd(_m_pfmul(v22, _mm_cvtsi32_si64(a2[1].m64_u32[0])), _m_pfmul(v21, _mm_cvtsi32_si64(a3[1].m64_u32[0]))));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(v19, _m_pfmul(v17, (__m64)a5->m64_u64)),
                                    _m_pfadd(_m_pfmul(v22, (__m64)a2->m64_u64), _m_pfmul(v21, (__m64)a3->m64_u64)));
  a1[1].m64_i32[0] = _mm_cvtsi64_si32(v23);
  _m_femms();
  return a1;
}

// sub_45E9D6 @ 0x0045E9D6
__m64 *__stdcall sub_45E9D6(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, unsigned int a6)
{
  __m64 v6; // mm1
  __m64 v7; // mm0
  __m64 v8; // mm1
  __m64 v9; // mm0
  __m64 v10; // mm3
  __m64 v11; // mm1
  __m64 v12; // mm0
  __m64 v13; // mm5
  __m64 v14; // mm0
  __m64 v15; // mm2
  __m64 v16; // mm3
  __m64 v17; // mm4
  __m64 v18; // mm5
  __m64 v19; // mm6
  __m64 v21; // mm7
  __m64 v22; // mm0
  __m64 v23; // mm4

  v6 = _mm_cvtsi32_si64(a6);
  v7 = _m_punpckldq(v6, v6);
  v8 = _m_punpckldq(v6, (__m64)1065353216LL);
  v9 = _m_pfmul(_m_pfmul(v7, v7), v8);
  v10 = v8;
  v11 = _m_pfmul(v8, v8);
  v12 = _m_pfsub(v9, v11);
  v13 = _m_pfmul(v12, (__m64)0x4000000040400000LL);
  v14 = _m_punpckldq(v13, v12);
  v15 = _m_pfsub(_m_pfadd(_m_punpckldq(v11, v11), _m_pxor(_m_punpckldq(v10, v10), (__m64)0x8000000000000000uLL)), v14);
  v16 = _m_pfsub(v14, _m_punpckhdq(v13, 0));
  v17 = _m_punpckhdq(v15, v15);
  v18 = _m_punpckldq(v16, v16);
  v19 = _m_punpckldq(v15, v15);
  v21 = _m_punpckhdq(v16, v16);
  v22 = _m_pfadd(
          _m_pfadd(_m_pfmul(v18, (__m64)a3->m64_u64), _m_pfmul(v17, (__m64)a2->m64_u64)),
          _m_pfmul(v19, (__m64)a4->m64_u64));
  v23 = _m_pfadd(
          _m_pfadd(
            _m_pfadd(
              _m_pfmul(v17, _mm_cvtsi32_si64(a2[1].m64_u32[0])),
              _m_pfmul(v18, _mm_cvtsi32_si64(a3[1].m64_u32[0]))),
            _m_pfmul(v19, _mm_cvtsi32_si64(a4[1].m64_u32[0]))),
          _m_pfmul(v21, _mm_cvtsi32_si64(a5[1].m64_u32[0])));
  a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                    _m_pfadd(v22, _m_pfmul(v21, (__m64)a5->m64_u64)),
                                    (__m64)0x3F0000003F000000LL);
  a1[1].m64_i32[0] = _mm_cvtsi64_si32(_m_pfmul(v23, (__m64)0x3F0000003F000000LL));
  _m_femms();
  return a1;
}

// vec3_transform_coord @ 0x0045EAC0
// transforms a vec3 by a matrix and divides by W (perspective)
float *vec3_transform_coord(float *out, float *vec, float *mat)
{
  __m64 v3; // mm1
  __m64 v4; // mm0
  __m64 v5; // mm2
  __m64 v6; // mm4
  __m64 v7; // mm5
  __m64 v8; // mm1
  __m64 v9; // mm3
  __m64 v10; // mm5
  __m64 v11; // mm4
  __m64 v12; // mm5

  _m_femms();
  v3 = *(__m64 *)vec;
  v4 = _m_punpckldq(v3, v3);
  v5 = _mm_cvtsi32_si64(*((_DWORD *)vec + 2));
  v6 = _m_punpckhdq(v3, v3);
  v7 = _m_punpckldq(v5, v5);
  v8 = _m_pfadd(_m_pfmul(v6, *(__m64 *)(mat + 4)), _m_pfmul(v7, *(__m64 *)(mat + 8)));
  v9 = _m_pfadd(
         _m_pfadd(_m_pfmul(v4, *(__m64 *)(mat + 2)), *(__m64 *)(mat + 14)),
         _m_pfadd(_m_pfmul(v6, *(__m64 *)(mat + 6)), _m_pfmul(v7, *(__m64 *)(mat + 10))));
  v10 = _m_punpckhdq(v9, v9);
  v11 = _m_pfrcp(v10);
  v12 = _m_pfrcpit2(_m_pfrcpit1(v10, v11), v11);
  *(__m64 *)out = _m_pfmul(_m_pfadd(_m_pfadd(_m_pfmul(v4, *(__m64 *)mat), *(__m64 *)(mat + 12)), v8), v12);
  *((_DWORD *)out + 2) = _mm_cvtsi64_si32(_m_pfmul(v9, v12));
  _m_femms();
  return out;
}

// mat4_mul @ 0x0045EB4B
// multiplies two 4x4 matrices (SSE)
float *mat4_mul(float *out, float *lhs, float *rhs)
{
  __m64 v3; // mm2
  __m64 v4; // mm3
  __m64 v5; // mm1
  __m64 v6; // mm2
  __m64 v7; // mm3
  __m64 v8; // mm0
  __m64 v9; // mm1
  __m64 v10; // mm2
  __m64 v11; // mm5
  __m64 v12; // mm3
  __m64 v13; // mm2
  __m64 v14; // mm7
  __m64 v15; // mm0
  __m64 v16; // mm3
  __m64 v17; // mm1
  __m64 v18; // mm4
  __m64 v19; // mm2
  __m64 v20; // mm3
  __m64 v21; // mm0
  __m64 v22; // mm1
  __m64 v23; // mm2
  __m64 v24; // mm5
  __m64 v25; // mm3
  __m64 v26; // mm2
  __m64 v27; // mm7
  __m64 v28; // mm0
  __m64 v29; // mm3
  __m64 v30; // mm1
  __m64 v31; // mm4
  __m64 v32; // mm2
  __m64 v33; // mm3
  __m64 v34; // mm0
  __m64 v35; // mm1
  __m64 v36; // mm2
  __m64 v37; // mm5
  __m64 v38; // mm3
  __m64 v39; // mm2
  __m64 v40; // mm7
  __m64 v41; // mm0
  __m64 v42; // mm3
  __m64 v43; // mm1
  __m64 v44; // mm4
  __m64 v45; // mm2
  __m64 v46; // mm3
  __m64 v47; // mm0
  __m64 v48; // mm1
  __m64 v49; // mm2
  __m64 v50; // mm3
  __m64 v51; // mm7
  __m64 v52; // mm3

  v5 = *(__m64 *)(lhs + 2);
  v6 = _m_punpckhdq(v3, *(__m64 *)lhs);
  v7 = _m_punpckhdq(v4, v5);
  v8 = _m_punpckldq(*(__m64 *)lhs, *(__m64 *)lhs);
  v9 = _m_punpckldq(v5, v5);
  v10 = _m_punpckhdq(v6, v6);
  v11 = _m_pfmul(*(__m64 *)(rhs + 4), v10);
  v12 = _m_punpckhdq(v7, v7);
  v13 = _m_pfadd(
          _m_pfadd(_m_pfmul(v10, *(__m64 *)(rhs + 6)), _m_pfmul(v8, *(__m64 *)(rhs + 2))),
          _m_pfmul(v9, *(__m64 *)(rhs + 10)));
  v14 = _m_pfadd(
          _m_pfmul(*(__m64 *)(rhs + 12), v12),
          _m_pfadd(_m_pfmul(*(__m64 *)(rhs + 8), v9), _m_pfadd(v11, _m_pfmul(*(__m64 *)rhs, v8))));
  v15 = *(__m64 *)(lhs + 4);
  v16 = _m_pfadd(_m_pfmul(v12, *(__m64 *)(rhs + 14)), v13);
  v17 = *(__m64 *)(lhs + 6);
  *(__m64 *)out = v14;
  v18 = *(__m64 *)rhs;
  *((__m64 *)out + 1) = v16;
  v19 = _m_punpckhdq(v13, v15);
  v20 = _m_punpckhdq(v16, v17);
  v21 = _m_punpckldq(v15, v15);
  v22 = _m_punpckldq(v17, v17);
  v23 = _m_punpckhdq(v19, v19);
  v24 = _m_pfmul(*(__m64 *)(rhs + 4), v23);
  v25 = _m_punpckhdq(v20, v20);
  v26 = _m_pfadd(
          _m_pfadd(_m_pfmul(v23, *(__m64 *)(rhs + 6)), _m_pfmul(v21, *(__m64 *)(rhs + 2))),
          _m_pfmul(v22, *(__m64 *)(rhs + 10)));
  v27 = _m_pfadd(
          _m_pfmul(*(__m64 *)(rhs + 12), v25),
          _m_pfadd(_m_pfmul(*(__m64 *)(rhs + 8), v22), _m_pfadd(v24, _m_pfmul(v18, v21))));
  v28 = *(__m64 *)(lhs + 8);
  v29 = _m_pfadd(_m_pfmul(v25, *(__m64 *)(rhs + 14)), v26);
  v30 = *(__m64 *)(lhs + 10);
  *((__m64 *)out + 2) = v27;
  v31 = *(__m64 *)rhs;
  *((__m64 *)out + 3) = v29;
  v32 = _m_punpckhdq(v26, v28);
  v33 = _m_punpckhdq(v29, v30);
  v34 = _m_punpckldq(v28, v28);
  v35 = _m_punpckldq(v30, v30);
  v36 = _m_punpckhdq(v32, v32);
  v37 = _m_pfmul(*(__m64 *)(rhs + 4), v36);
  v38 = _m_punpckhdq(v33, v33);
  v39 = _m_pfadd(
          _m_pfadd(_m_pfmul(v36, *(__m64 *)(rhs + 6)), _m_pfmul(v34, *(__m64 *)(rhs + 2))),
          _m_pfmul(v35, *(__m64 *)(rhs + 10)));
  v40 = _m_pfadd(
          _m_pfmul(*(__m64 *)(rhs + 12), v38),
          _m_pfadd(_m_pfmul(*(__m64 *)(rhs + 8), v35), _m_pfadd(v37, _m_pfmul(v31, v34))));
  v41 = *(__m64 *)(lhs + 12);
  v42 = _m_pfadd(_m_pfmul(v38, *(__m64 *)(rhs + 14)), v39);
  v43 = *(__m64 *)(lhs + 14);
  *((__m64 *)out + 4) = v40;
  v44 = *(__m64 *)rhs;
  *((__m64 *)out + 5) = v42;
  v45 = _m_punpckhdq(v39, v41);
  v46 = _m_punpckhdq(v42, v43);
  v47 = _m_punpckldq(v41, v41);
  v48 = _m_punpckldq(v43, v43);
  v49 = _m_punpckhdq(v45, v45);
  v50 = _m_punpckhdq(v46, v46);
  v51 = _m_pfmul(*(__m64 *)(rhs + 12), v50);
  v52 = _m_pfadd(
          _m_pfmul(v50, *(__m64 *)(rhs + 14)),
          _m_pfadd(
            _m_pfadd(_m_pfmul(v49, *(__m64 *)(rhs + 6)), _m_pfmul(v47, *(__m64 *)(rhs + 2))),
            _m_pfmul(v48, *(__m64 *)(rhs + 10))));
  *((__m64 *)out + 6) = _m_pfadd(
                          v51,
                          _m_pfadd(
                            _m_pfmul(*(__m64 *)(rhs + 8), v48),
                            _m_pfadd(_m_pfmul(*(__m64 *)(rhs + 4), v49), _m_pfmul(v44, v47))));
  *((__m64 *)out + 7) = v52;
  _m_femms();
  return out;
}

// vec3_project @ 0x0045ED17
// projects a vec3 through optional matrices and viewport scale/bias
float *vec3_project(float *out, float *vec, float *viewport, float *world, float *view, float *proj)
{
  float *v6; // esi
  __m64 v7; // mm1
  float lhs[16]; // [esp+Ch] [ebp-40h] BYREF

  v6 = lhs;
  switch ( (world != 0) | (2 * ((view != 0) | (2 * (proj != 0)))) )
  {
    case 0:
      lhs[14] = 0.0;
      lhs[13] = 0.0;
      lhs[12] = 0.0;
      lhs[11] = 0.0;
      lhs[9] = 0.0;
      lhs[8] = 0.0;
      lhs[7] = 0.0;
      lhs[6] = 0.0;
      lhs[4] = 0.0;
      lhs[3] = 0.0;
      lhs[2] = 0.0;
      lhs[1] = 0.0;
      lhs[15] = 1.0;
      lhs[10] = 1.0;
      lhs[5] = 1.0;
      lhs[0] = 1.0;
      break;
    case 1:
      v6 = world;
      break;
    case 2:
      v6 = view;
      break;
    case 3:
      _m_femms();
      mat4_mul(lhs, view, world);
      _m_femms();
      break;
    case 4:
      v6 = proj;
      break;
    case 5:
      _m_femms();
      mat4_mul(lhs, proj, world);
      _m_femms();
      break;
    case 6:
      _m_femms();
      mat4_mul(lhs, proj, view);
      _m_femms();
      break;
    case 7:
      _m_femms();
      mat4_mul(lhs, proj, view);
      mat4_mul(lhs, lhs, world);
      _m_femms();
      break;
    default:
      break;
  }
  vec3_transform_coord(out, vec, v6);
  if ( viewport )
  {
    _m_femms();
    v7 = _m_pfadd(
           _m_pfmul(
             _mm_cvtsi32_si64(*((_DWORD *)out + 2)),
             _m_pfsub(_m_punpckhdq(*(__m64 *)(viewport + 4), *(__m64 *)(viewport + 4)), *(__m64 *)(viewport + 4))),
           *(__m64 *)(viewport + 4));
    *(__m64 *)out = _m_pfadd(
                      _m_pfmul(
                        _m_pfadd(_m_pxor(*(__m64 *)out, (__m64)0x8000000000000000uLL), (__m64)0x3F8000003F800000LL),
                        _m_pfmul(_m_pi2fd(*(__m64 *)(viewport + 2)), (__m64)0x3F0000003F000000LL)),
                      _m_pi2fd(*(__m64 *)viewport));
    *((_DWORD *)out + 2) = _mm_cvtsi64_si32(v7);
    _m_femms();
  }
  return out;
}

// vec3_unproject @ 0x0045EE9F
// unprojects a screen-space vec3 using inverse matrices and viewport
float *vec3_unproject(float *out, float *vec, float *viewport, float *world, float *view, float *proj)
{
  __m64 v6; // mm4
  __m64 v7; // mm2
  __m64 v8; // mm5
  __m64 v9; // mm0
  __m64 v10; // mm5
  __m64 v11; // mm6
  __m64 v12; // mm3
  float mat[16]; // [esp+Ch] [ebp-40h] BYREF

  switch ( (world != 0) | (2 * ((view != 0) | (2 * (proj != 0)))) )
  {
    case 0:
      mat[14] = 0.0;
      mat[13] = 0.0;
      mat[12] = 0.0;
      mat[11] = 0.0;
      mat[9] = 0.0;
      mat[8] = 0.0;
      mat[7] = 0.0;
      mat[6] = 0.0;
      mat[4] = 0.0;
      mat[3] = 0.0;
      mat[2] = 0.0;
      mat[1] = 0.0;
      mat[15] = 1.0;
      mat[10] = 1.0;
      mat[5] = 1.0;
      mat[0] = 1.0;
      break;
    case 1:
      _m_femms();
      mat4_invert(mat, 0, world);
      _m_femms();
      break;
    case 2:
      _m_femms();
      mat4_invert(mat, 0, view);
      _m_femms();
      break;
    case 3:
      _m_femms();
      mat4_mul(mat, view, world);
      mat4_invert(mat, 0, mat);
      _m_femms();
      break;
    case 4:
      _m_femms();
      mat4_invert(mat, 0, proj);
      _m_femms();
      break;
    case 5:
      _m_femms();
      mat4_mul(mat, proj, world);
      mat4_invert(mat, 0, mat);
      _m_femms();
      break;
    case 6:
      _m_femms();
      mat4_mul(mat, proj, view);
      mat4_invert(mat, 0, mat);
      _m_femms();
      break;
    case 7:
      _m_femms();
      mat4_mul(mat, proj, view);
      mat4_mul(mat, mat, world);
      mat4_invert(mat, 0, mat);
      _m_femms();
      break;
    default:
      break;
  }
  if ( viewport )
  {
    _m_femms();
    v6 = *(__m64 *)(viewport + 4);
    v7 = _m_pi2fd(*(__m64 *)(viewport + 2));
    v8 = _m_punpckldq(_m_pfrcp(v7), _m_pfrcp(_m_punpckhdq(v7, v7)));
    v9 = _m_pfmul(
           _m_pfsub(*(__m64 *)vec, _m_pi2fd(*(__m64 *)viewport)),
           _m_pfmul(_m_pfrcpit2(_m_pfrcpit1(v7, v8), v8), (__m64)0x4000000040000000LL));
    v10 = _m_pfsub(_m_punpckhdq(v6, v6), v6);
    v11 = _m_pfrcp(v10);
    v12 = _m_pfmul(_m_pfsub(_mm_cvtsi32_si64(*((_DWORD *)vec + 2)), v6), _m_pfrcpit2(_m_pfrcpit1(v10, v11), v11));
    *(__m64 *)out = _m_pxor(_m_pfsub(v9, (__m64)0x3F8000003F800000LL), (__m64)0x8000000000000000uLL);
    *((_DWORD *)out + 2) = _mm_cvtsi64_si32(v12);
    _m_femms();
    vec3_transform_coord(out, out, mat);
  }
  else
  {
    vec3_transform_coord(out, vec, mat);
  }
  return out;
}

// sub_45F0C5 @ 0x0045F0C5
__m64 *__userpurge sub_45F0C5@<eax>(
        __m64 a1@<mm2>,
        __m64 a2@<mm3>,
        __m64 *a3,
        __m64 *a4,
        __m64 *a5,
        __m64 *a6,
        __m64 *a7,
        __m64 *a8)
{
  __m64 v8; // mm4
  __m64 v9; // mm2
  __m64 v10; // mm5
  __m64 v11; // mm0
  __m64 v12; // mm5
  __m64 v13; // mm6
  __m64 v14; // mm3
  __m64 *v16; // [esp-4h] [ebp-50h]
  __m64 v17[8]; // [esp+Ch] [ebp-40h] BYREF

  switch ( (a6 != 0) | (2 * ((a7 != 0) | (2 * (a8 != 0)))) )
  {
    case 0:
      sub_45B092(v17);
      break;
    case 1:
      sub_45DD30(v17, 0, a6);
      break;
    case 2:
      sub_45DD30(v17, 0, a7);
      break;
    case 3:
      mat4_mul(a1, a2, v17, a7, a6);
      goto LABEL_11;
    case 4:
      sub_45DD30(v17, 0, a8);
      break;
    case 5:
      v16 = a6;
      goto LABEL_9;
    case 6:
      v16 = a7;
LABEL_9:
      mat4_mul(a1, a2, v17, a8, v16);
      goto LABEL_11;
    case 7:
      mat4_mul(a1, a2, v17, a8, a7);
      mat4_mul(a1, a2, v17, v17, a6);
LABEL_11:
      sub_45DD30(v17, 0, v17);
      break;
    default:
      break;
  }
  if ( a5 )
  {
    _m_femms();
    v8 = a5[2];
    v9 = _m_pi2fd(a5[1]);
    v10 = _m_punpckldq(_m_pfrcp(v9), _m_pfrcp(_m_punpckhdq(v9, v9)));
    v11 = _m_pfmul(
            _m_pfsub((__m64)a4->m64_u64, _m_pi2fd((__m64)a5->m64_u64)),
            _m_pfmul(_m_pfrcpit2(_m_pfrcpit1(v9, v10), v10), (__m64)0x4000000040000000LL));
    v12 = _m_pfsub(_m_punpckhdq(v8, v8), v8);
    v13 = _m_pfrcp(v12);
    v14 = _m_pfmul(_m_pfsub(_mm_cvtsi32_si64(a4[1].m64_u32[0]), v8), _m_pfrcpit2(_m_pfrcpit1(v12, v13), v13));
    a3->m64_u64 = (unsigned __int64)_m_pxor(_m_pfsub(v11, (__m64)0x3F8000003F800000LL), (__m64)0x8000000000000000uLL);
    a3[1].m64_i32[0] = _mm_cvtsi64_si32(v14);
    _m_femms();
    vec3_transform_coord(a3, a3, v17);
  }
  else
  {
    vec3_transform_coord(a3, a4, v17);
  }
  return a3;
}

// sub_45F218 @ 0x0045F218
__m64 *__stdcall sub_45F218(__m64 *a1, __m64 *a2, __m64 *a3)
{
  unsigned __int64 m64_u64; // mm1
  __m64 v4; // mm0
  __m64 v5; // mm4
  __m64 v6; // mm3

  _m_femms();
  m64_u64 = a2->m64_u64;
  v4 = _m_punpckldq((__m64)m64_u64, (__m64)m64_u64);
  v5 = _m_punpckhdq((__m64)m64_u64, (__m64)m64_u64);
  v6 = _m_pfadd(_m_pfadd(_m_pfmul(v4, a3[1]), a3[7]), _m_pfmul(v5, a3[3]));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(_m_pfadd(_m_pfmul(v4, (__m64)a3->m64_u64), a3[6]), _m_pfmul(v5, a3[2]));
  a1[1].m64_u64 = (unsigned __int64)v6;
  _m_femms();
  return a1;
}

// sub_45F26D @ 0x0045F26D
__m64 *__stdcall sub_45F26D(__m64 *a1, __m64 *a2, __m64 *a3)
{
  _m_femms();
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfmul(_m_punpckldq((__m64)a2->m64_u64, (__m64)a2->m64_u64), (__m64)a3->m64_u64),
                                    _m_pfmul(_m_punpckhdq((__m64)a2->m64_u64, (__m64)a2->m64_u64), a3[2]));
  _m_femms();
  return a1;
}

// sub_45F2A6 @ 0x0045F2A6
__m64 *__stdcall sub_45F2A6(__m64 *a1, __m64 *a2, __m64 *a3)
{
  unsigned __int64 m64_u64; // mm1
  __m64 v4; // mm0
  __m64 v5; // mm4
  __m64 v6; // mm1
  __m64 v7; // mm3
  __m64 v8; // mm3
  __m64 v9; // mm4

  _m_femms();
  m64_u64 = a2->m64_u64;
  v4 = _m_punpckldq((__m64)m64_u64, (__m64)m64_u64);
  v5 = _m_punpckhdq((__m64)m64_u64, (__m64)m64_u64);
  v6 = _m_pfmul(v5, a3[2]);
  v7 = _m_pfadd(_m_pfadd(_m_pfmul(v4, a3[1]), a3[7]), _m_pfmul(v5, a3[3]));
  v8 = _m_punpckhdq(v7, v7);
  v9 = _m_pfrcp(v8);
  a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                    _m_pfadd(_m_pfadd(_m_pfmul(v4, (__m64)a3->m64_u64), a3[6]), v6),
                                    _m_pfrcpit2(_m_pfrcpit1(v8, v9), v9));
  _m_femms();
  return a1;
}

// sub_45F30A @ 0x0045F30A
__m64 *__stdcall sub_45F30A(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, unsigned int a6)
{
  __m64 v6; // mm0
  __m64 v7; // mm1
  __m64 v8; // mm2
  __m64 v9; // mm7
  __m64 v10; // mm4
  __m64 v11; // mm6
  __m64 v12; // mm2
  __m64 v13; // mm5
  __m64 v14; // mm1
  __m64 v15; // mm6
  __m64 v16; // mm2

  _m_femms();
  v6 = _mm_cvtsi32_si64(a6);
  v7 = _m_pfmul(v6, v6);
  v8 = _m_pfmul(v7, v6);
  v9 = _m_pfsub(v8, v7);
  v10 = _m_pfmul(v7, (__m64)0x4000000040000000LL);
  v11 = v8;
  v12 = _m_pfmul(v8, (__m64)0x4000000040000000LL);
  v13 = _m_pfmul(v7, (__m64)0x4040000040400000LL);
  v14 = _m_pfsub(v13, v12);
  v15 = _m_pfadd(_m_pfsub(v11, v10), v6);
  v16 = _m_pfadd(_m_pfsub(v12, v13), (__m64)0x3F8000003F800000LL);
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(
                                      _m_pfmul(_m_punpckldq(v16, v16), (__m64)a2->m64_u64),
                                      _m_pfmul(_m_punpckldq(v15, v15), (__m64)a3->m64_u64)),
                                    _m_pfadd(
                                      _m_pfmul(_m_punpckldq(v14, v14), (__m64)a4->m64_u64),
                                      _m_pfmul(_m_punpckldq(v9, v9), (__m64)a5->m64_u64)));
  _m_femms();
  return a1;
}

// sub_45F3A2 @ 0x0045F3A2
__m64 *__stdcall sub_45F3A2(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, unsigned int a5, unsigned int a6)
{
  __m64 v6; // mm6
  __m64 v7; // mm7

  v6 = _mm_cvtsi32_si64(a5);
  v7 = _mm_cvtsi32_si64(a6);
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(
                                      (__m64)a2->m64_u64,
                                      _m_pfmul(_m_pfsub((__m64)a3->m64_u64, (__m64)a2->m64_u64), _m_punpckldq(v6, v6))),
                                    _m_pfmul(_m_pfsub((__m64)a4->m64_u64, (__m64)a2->m64_u64), _m_punpckldq(v7, v7)));
  _m_femms();
  return a1;
}

// sub_45F3EB @ 0x0045F3EB
__m64 *__stdcall sub_45F3EB(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm0
  __m64 v4; // mm0
  __m64 v5; // mm5

  v2 = _m_pfmul((__m64)a2->m64_u64, (__m64)a2->m64_u64);
  v4 = _m_pfacc(v2, v2);
  v5 = _m_pfrsqrt(v4);
  a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                    _m_pand((__m64)a2->m64_u64, _m_pfcmpgt(v4, (__m64)0x80000000800000LL)),
                                    _m_pfrcpit2(_m_pfrsqit1(_m_pfmul(v5, v5), v4), v5));
  _m_femms();
  return a1;
}

// sub_45F42E @ 0x0045F42E
__m64 *__stdcall sub_45F42E(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, unsigned int a6)
{
  __m64 v6; // mm1
  __m64 v7; // mm0
  __m64 v8; // mm1
  __m64 v9; // mm0
  __m64 v10; // mm3
  __m64 v11; // mm1
  __m64 v12; // mm4
  __m64 v13; // mm5
  __m64 v14; // mm0
  __m64 v15; // mm1
  __m64 v16; // mm3

  v6 = _mm_cvtsi32_si64(a6);
  v7 = _m_punpckldq(v6, v6);
  v8 = _m_punpckldq(v6, (__m64)1065353216LL);
  v9 = _m_pfmul(_m_pfmul(v7, v7), v8);
  v10 = v8;
  v11 = _m_pfmul(v8, v8);
  v12 = _m_pfsub(v9, v11);
  v13 = _m_pfmul(v12, (__m64)0x4000000040400000LL);
  v14 = _m_punpckldq(v13, v12);
  v15 = _m_pfsub(_m_pfadd(_m_punpckldq(v11, v11), _m_pxor(_m_punpckldq(v10, v10), (__m64)0x8000000000000000uLL)), v14);
  v16 = _m_pfsub(v14, _m_punpckhdq(v13, 0));
  a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                    _m_pfadd(
                                      _m_pfadd(
                                        _m_pfadd(
                                          _m_pfmul(_m_punpckldq(v16, v16), (__m64)a3->m64_u64),
                                          _m_pfmul(_m_punpckhdq(v15, v15), (__m64)a2->m64_u64)),
                                        _m_pfmul(_m_punpckldq(v15, v15), (__m64)a4->m64_u64)),
                                      _m_pfmul(_m_punpckhdq(v16, v16), (__m64)a5->m64_u64)),
                                    (__m64)0x3F0000003F000000LL);
  _m_femms();
  return a1;
}

// sub_45F4D9 @ 0x0045F4D9
__m64 *__stdcall sub_45F4D9(__m64 *a1, __m64 *a2, __m64 *a3)
{
  unsigned __int64 m64_u64; // mm1
  __m64 v4; // mm0
  __m64 v5; // mm3
  __m64 v6; // mm5
  __m64 v7; // mm6
  __m64 v8; // mm7
  __m64 v9; // mm4

  _m_femms();
  m64_u64 = a2->m64_u64;
  v4 = _m_punpckldq((__m64)m64_u64, (__m64)m64_u64);
  v5 = a2[1];
  v6 = _m_punpckhdq((__m64)m64_u64, (__m64)m64_u64);
  v7 = _m_punpckldq(v5, v5);
  v8 = _m_punpckhdq(v5, v5);
  v9 = _m_pfadd(_m_pfadd(_m_pfmul(v4, a3[1]), _m_pfmul(v6, a3[3])), _m_pfadd(_m_pfmul(v7, a3[5]), _m_pfmul(v8, a3[7])));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(_m_pfmul(v4, (__m64)a3->m64_u64), _m_pfmul(v6, a3[2])),
                                    _m_pfadd(_m_pfmul(v7, a3[4]), _m_pfmul(v8, a3[6])));
  a1[1].m64_u64 = (unsigned __int64)v9;
  _m_femms();
  return a1;
}

// sub_45F55B @ 0x0045F55B
__m64 *__stdcall sub_45F55B(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm3
  __m64 v3; // mm0
  __m64 v4; // mm0
  __m64 v6; // mm4
  __m64 v7; // mm5
  __m64 v8; // mm0

  _m_femms();
  v2 = a2[1];
  v3 = _m_pfadd(_m_pfmul((__m64)a2->m64_u64, (__m64)a2->m64_u64), _m_pfmul(v2, v2));
  v4 = _m_pfacc(v3, v3);
  v6 = _m_pfrsqrt(v4);
  v7 = _m_pfcmpgt(v4, (__m64)0x80000000800000LL);
  v8 = _m_pfrcpit2(_m_pfrsqit1(v4, _m_pfmul(v6, v6)), v6);
  a1->m64_u64 = (unsigned __int64)_m_pfmul(_m_pand((__m64)a2->m64_u64, v7), v8);
  a1[1].m64_u64 = (unsigned __int64)_m_pfmul(_m_pand(v2, v7), v8);
  _m_femms();
  return a1;
}

// sub_45F5BA @ 0x0045F5BA
__m64 *__stdcall sub_45F5BA(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4)
{
  __m64 v5; // mm2
  __m64 v6; // mm3
  __m64 v7; // mm4
  __m64 v8; // mm5
  __m64 v9; // mm6
  __m64 v10; // mm1
  __m64 m64_u64; // mm0
  __m64 v12; // mm7
  __m64 v13; // mm2
  __m64 v14; // mm6
  __m64 v15; // mm7

  _m_femms();
  v5 = a3[1];
  v6 = a4[1];
  v7 = _m_pfsub(
         _m_pfmul(_m_punpckhdq(v6, v6), _m_punpckhdq(_m_punpckldq(v5, v5), (__m64)a3->m64_u64)),
         _m_pfmul(_m_punpckhdq(v5, v5), _m_punpckhdq(_m_punpckldq(v6, v6), (__m64)a4->m64_u64)));
  v8 = _m_pfsub(
         _m_pfmul(_m_punpckhdq((__m64)a3->m64_u64, v5), _m_punpckldq(v6, (__m64)a4->m64_u64)),
         _m_pfmul(_m_punpckhdq((__m64)a4->m64_u64, v6), _m_punpckldq(v5, (__m64)a3->m64_u64)));
  v9 = _m_pfsub(
         _m_pfmul(
           _m_punpckldq((__m64)a4->m64_u64, (__m64)a4->m64_u64),
           _m_punpckhdq(_m_punpckldq(v5, v5), (__m64)a3->m64_u64)),
         _m_pfmul(
           _m_punpckldq((__m64)a3->m64_u64, (__m64)a3->m64_u64),
           _m_punpckhdq(_m_punpckldq(v6, v6), (__m64)a4->m64_u64)));
  v10 = a2[1];
  m64_u64 = (__m64)a2->m64_u64;
  a1->m64_u64 = (unsigned __int64)_m_pfsub(
                                    _m_pfmul(
                                      _m_pxor(_m_punpckldq(v7, v7), (__m64)0x8000000000000000uLL),
                                      _m_punpckhdq(
                                        (__m64)a2->m64_u64,
                                        _m_punpckldq((__m64)a2->m64_u64, (__m64)a2->m64_u64))),
                                    _m_pfacc(
                                      _m_pxor(
                                        _m_pfmul(_m_punpckldq(_m_punpckhdq(v7, v7), v8), v10),
                                        (__m64)0x8000000000000000uLL),
                                      _m_pxor(
                                        _m_pfmul(_m_punpckldq(_m_punpckhdq(v8, v8), v9), v10),
                                        (__m64)0x8000000000000000uLL)));
  v12 = _m_psrlqi((__m64)0x8000000000000000uLL, 0x20u);
  v13 = _m_pxor(_m_punpckldq(v8, v9), v12);
  v14 = _m_pxor(_m_punpckhdq(v9, v9), v12);
  v15 = _m_psllqi(v12, 0x20u);
  a1[1].m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfmul(_m_punpckhdq(v10, _m_punpckldq(v10, v10)), v14),
                                      _m_pfacc(
                                        _m_pxor(
                                          _m_pfmul(_m_pxor(_m_punpckhdq(v7, v8), (__m64)0x8000000000000000uLL), m64_u64),
                                          v15),
                                        _m_pxor(_m_pfmul(v13, m64_u64), v15)));
  _m_femms();
  return a1;
}

// sub_45F6EC @ 0x0045F6EC
__m64 *__stdcall sub_45F6EC(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, unsigned int a5, unsigned int a6)
{
  __m64 v6; // mm6
  __m64 v7; // mm7
  __m64 v9; // mm6
  __m64 v10; // mm7
  __m64 v11; // mm1

  v6 = _mm_cvtsi32_si64(a5);
  v7 = _mm_cvtsi32_si64(a6);
  v9 = _m_punpckldq(v6, v6);
  v10 = _m_punpckldq(v7, v7);
  v11 = _m_pfadd(_m_pfadd(_m_pfmul(_m_pfsub(a3[1], a2[1]), v9), a2[1]), _m_pfmul(_m_pfsub(a4[1], a2[1]), v10));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(
                                      _m_pfmul(_m_pfsub((__m64)a3->m64_u64, (__m64)a2->m64_u64), v9),
                                      (__m64)a2->m64_u64),
                                    _m_pfmul(_m_pfsub((__m64)a4->m64_u64, (__m64)a2->m64_u64), v10));
  a1[1].m64_u64 = (unsigned __int64)v11;
  _m_femms();
  return a1;
}

// sub_45F75D @ 0x0045F75D
__m64 *__stdcall sub_45F75D(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, unsigned int a6)
{
  __m64 v6; // mm0
  __m64 v7; // mm1
  __m64 v8; // mm2
  __m64 v9; // mm7
  __m64 v10; // mm4
  __m64 v11; // mm6
  __m64 v12; // mm2
  __m64 v13; // mm5
  __m64 v14; // mm1
  __m64 v15; // mm6
  __m64 v16; // mm2
  __m64 v17; // mm5
  __m64 v18; // mm0
  __m64 v19; // mm1
  __m64 v21; // mm4
  __m64 v22; // mm3
  __m64 v23; // mm0

  _m_femms();
  v6 = _mm_cvtsi32_si64(a6);
  v7 = _m_pfmul(v6, v6);
  v8 = _m_pfmul(v7, v6);
  v9 = _m_pfsub(v8, v7);
  v10 = _m_pfmul(v7, (__m64)0x4000000040000000LL);
  v11 = v8;
  v12 = _m_pfmul(v8, (__m64)0x4000000040000000LL);
  v13 = _m_pfmul(v7, (__m64)0x4040000040400000LL);
  v14 = _m_pfsub(v13, v12);
  v15 = _m_pfadd(_m_pfsub(v11, v10), v6);
  v16 = _m_pfadd(_m_pfsub(v12, v13), (__m64)0x3F8000003F800000LL);
  v17 = _m_punpckldq(v9, v9);
  v18 = _m_punpckldq(v14, v14);
  v19 = _m_pfmul(v18, (__m64)a4->m64_u64);
  v21 = _m_punpckldq(v15, v15);
  v22 = _m_punpckldq(v16, v16);
  v23 = _m_pfadd(
          _m_pfadd(_m_pfmul(v18, a4[1]), _m_pfmul(v17, a5[1])),
          _m_pfadd(_m_pfmul(v22, a2[1]), _m_pfmul(v21, a3[1])));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(v19, _m_pfmul(v17, (__m64)a5->m64_u64)),
                                    _m_pfadd(_m_pfmul(v22, (__m64)a2->m64_u64), _m_pfmul(v21, (__m64)a3->m64_u64)));
  a1[1].m64_u64 = (unsigned __int64)v23;
  _m_femms();
  return a1;
}

// sub_45F825 @ 0x0045F825
__m64 *__stdcall sub_45F825(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4, __m64 *a5, unsigned int a6)
{
  __m64 v6; // mm1
  __m64 v7; // mm0
  __m64 v8; // mm1
  __m64 v9; // mm0
  __m64 v10; // mm3
  __m64 v11; // mm1
  __m64 v12; // mm0
  __m64 v13; // mm5
  __m64 v14; // mm0
  __m64 v15; // mm2
  __m64 v16; // mm3
  __m64 v17; // mm4
  __m64 v18; // mm5
  __m64 v19; // mm6
  __m64 v20; // mm7
  __m64 v22; // mm0
  __m64 v23; // mm4

  v6 = _mm_cvtsi32_si64(a6);
  v7 = _m_punpckldq(v6, v6);
  v8 = _m_punpckldq(v6, (__m64)1065353216LL);
  v9 = _m_pfmul(_m_pfmul(v7, v7), v8);
  v10 = v8;
  v11 = _m_pfmul(v8, v8);
  v12 = _m_pfsub(v9, v11);
  v13 = _m_pfmul(v12, (__m64)0x4000000040400000LL);
  v14 = _m_punpckldq(v13, v12);
  v15 = _m_pfsub(_m_pfadd(_m_punpckldq(v11, v11), _m_pxor(_m_punpckldq(v10, v10), (__m64)0x8000000000000000uLL)), v14);
  v16 = _m_pfsub(v14, _m_punpckhdq(v13, 0));
  v17 = _m_punpckhdq(v15, v15);
  v18 = _m_punpckldq(v16, v16);
  v19 = _m_punpckldq(v15, v15);
  v20 = _m_punpckhdq(v16, v16);
  v22 = _m_pfadd(
          _m_pfadd(_m_pfmul(v18, (__m64)a3->m64_u64), _m_pfmul(v17, (__m64)a2->m64_u64)),
          _m_pfmul(v19, (__m64)a4->m64_u64));
  v23 = _m_pfadd(
          _m_pfadd(_m_pfadd(_m_pfmul(v17, a2[1]), _m_pfmul(v18, a3[1])), _m_pfmul(v19, a4[1])),
          _m_pfmul(v20, a5[1]));
  a1->m64_u64 = (unsigned __int64)_m_pfmul(
                                    _m_pfadd(v22, _m_pfmul(v20, (__m64)a5->m64_u64)),
                                    (__m64)0x3F0000003F000000LL);
  a1[1].m64_u64 = (unsigned __int64)_m_pfmul(v23, (__m64)0x3F0000003F000000LL);
  _m_femms();
  return a1;
}

// sub_45F903 @ 0x0045F903
__m64 *__stdcall sub_45F903(__m64 *a1, __m64 *a2, __m64 *a3)
{
  __m64 v4; // mm1
  __m64 v5; // mm2
  __m64 v6; // mm2

  _m_femms();
  v4 = _mm_cvtsi32_si64(a3[1].m64_u32[0]);
  v5 = _m_pfmul((__m64)a2->m64_u64, (__m64)a3->m64_u64);
  v6 = _m_pfadd(_m_pfacc(v5, v5), _m_pfmul(_mm_cvtsi32_si64(a2[1].m64_u32[0]), v4));
  a1->m64_u64 = a3->m64_u64;
  a1[1].m64_i32[0] = _mm_cvtsi64_si32(v4);
  a1[1].m64_i32[1] = _mm_cvtsi64_si32(_m_pxor(v6, (__m64)0x80000000LL));
  _m_femms();
  return a1;
}

// sub_45F946 @ 0x0045F946
__m64 *__stdcall sub_45F946(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4)
{
  __m64 v4; // mm2
  __m64 v5; // mm1
  __m64 v6; // mm4
  __m64 v7; // mm7
  __m64 v8; // mm5
  __m64 v9; // mm0
  __m64 v10; // mm1
  __m64 v11; // mm1
  __m64 v12; // mm7
  __m64 v13; // mm6
  __m64 v14; // mm6
  __m64 v15; // mm4
  __m64 v16; // mm5
  __m64 v17; // mm6
  unsigned __int64 v19; // mm4
  __m64 v20; // mm5
  __m64 v21; // mm0

  _m_femms();
  v4 = _mm_cvtsi32_si64(a2[1].m64_u32[0]);
  v5 = _m_pfsub(_m_punpckldq(v4, v4), _m_punpckldq(_mm_cvtsi32_si64(a4[1].m64_u32[0]), (__m64)a3[1].m64_u32[0]));
  v6 = _m_pfsub((__m64)a2->m64_u64, (__m64)a4->m64_u64);
  v7 = _m_pfsub(0, v6);
  v8 = _m_pfsub((__m64)a2->m64_u64, (__m64)a3->m64_u64);
  v9 = _m_pxor(
         _m_pfacc(
           _m_pfmul(_m_punpckhdq(v8, v7), v5),
           _m_pfmul(_m_punpckldq(_m_punpckhdq(v5, (__m64)0x8000000000000000uLL), v8), _m_punpckldq(v7, v5))),
         (__m64)0x8000000000000000uLL);
  v10 = _m_pfmul(_m_punpckhdq(v6, _m_punpckldq(v6, v7)), v8);
  v11 = _m_pfacc(v10, v10);
  v12 = _m_psllqi(v11, 0x20u);
  v13 = _m_pfadd(_m_pfmul(v9, v9), _m_pfmul(v12, v12));
  v14 = _m_pfacc(v13, v13);
  v15 = _m_pfrsqrt(v14);
  v16 = _m_pfcmpgt(v14, (__m64)0x80000000800000LL);
  v17 = _m_pfrcpit2(_m_pfrsqit1(v14, _m_pfmul(v15, v15)), v15);
  v19 = (unsigned __int64)_m_pfmul(_m_pand(v9, v16), v17);
  v20 = _m_pfmul(_m_pand(v11, v16), v17);
  v21 = _m_pfmul((__m64)v19, (__m64)a2->m64_u64);
  a1->m64_u64 = v19;
  a1[1].m64_u64 = (unsigned __int64)_m_pxor(
                                      _m_punpckldq(v20, _m_pfadd(_m_pfacc(v21, v21), _m_pfmul(v20, v4))),
                                      (__m64)0x8000000000000000uLL);
  _m_femms();
  return a1;
}

// sub_45FA2A @ 0x0045FA2A
__m64 *__stdcall sub_45FA2A(__m64 *a1, __m64 *a2, __m64 *a3, __m64 *a4)
{
  __m64 v4; // mm7
  __m64 v5; // mm4
  __m64 v6; // mm7
  __m64 v7; // mm4
  __m64 v8; // mm5
  __m64 *result; // eax
  __m64 v10; // mm2
  __m64 v11; // mm2
  __m64 v12; // mm2
  __m64 v13; // mm5

  v4 = _mm_cvtsi32_si64(a3[1].m64_u32[0]);
  v5 = _m_pfsub(
         _m_pfadd(_m_pfmul((__m64)a2->m64_u64, (__m64)a3->m64_u64), _m_pfmul(a2[1], v4)),
         _m_pfadd(_m_pfmul((__m64)a2->m64_u64, (__m64)a4->m64_u64), _m_pfmul(a2[1], _mm_cvtsi32_si64(a4[1].m64_u32[0]))));
  v6 = _m_punpckldq(v4, (__m64)1065353216LL);
  v7 = _m_pfacc(v5, v5);
  v8 = _m_pfrcp(v7);
  result = a1;
  v10 = _m_pfmul((__m64)a2->m64_u64, (__m64)a3->m64_u64);
  if ( _mm_cvtsi64_si32(_m_pfcmpeq(0, v7)) )
  {
    result = 0;
  }
  else
  {
    v11 = _m_pfadd(v10, _m_pfmul(a2[1], v6));
    v12 = _m_pfmul(_m_pfacc(v11, v11), _m_pfrcpit2(_m_pfrcpit1(v7, v8), v8));
    v13 = _m_pfadd(_m_pfmul(_m_pfsub(_mm_cvtsi32_si64(a4[1].m64_u32[0]), v6), v12), v6);
    a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                      _m_pfmul(_m_pfsub((__m64)a4->m64_u64, (__m64)a3->m64_u64), v12),
                                      (__m64)a3->m64_u64);
    a1[1].m64_i32[0] = _mm_cvtsi64_si32(v13);
  }
  _m_femms();
  return result;
}

// sub_45FAE8 @ 0x0045FAE8
__m64 *__stdcall sub_45FAE8(__m64 *a1, __m64 *a2)
{
  __m64 v2; // mm3
  __m64 v3; // mm2
  __m64 v4; // mm0
  __m64 v5; // mm0
  __m64 v6; // mm4
  __m64 v7; // mm5
  __m64 v9; // mm0

  v2 = a2[1];
  v3 = _m_pand(v2, (__m64)0xFFFFFFFFLL);
  v4 = _m_pfadd(_m_pfmul((__m64)a2->m64_u64, (__m64)a2->m64_u64), _m_pfmul(v3, v3));
  v5 = _m_pfacc(v4, v4);
  v6 = _m_pfrsqrt(v5);
  v7 = _m_pfcmpgt(v5, (__m64)0x80000000800000LL);
  v9 = _m_pfrcpit2(_m_pfrsqit1(v5, _m_pfmul(v6, v6)), v6);
  a1->m64_u64 = (unsigned __int64)_m_pfmul(_m_pand((__m64)a2->m64_u64, v7), v9);
  a1[1].m64_u64 = (unsigned __int64)_m_pfmul(_m_pand(v2, v7), v9);
  _m_femms();
  return a1;
}

// sub_45FB4C @ 0x0045FB4C
__m64 *__stdcall sub_45FB4C(__m64 *a1, __m64 *a2, __m64 *a3)
{
  __m64 m64_u64; // mm1
  __m64 v4; // mm0
  __m64 v5; // mm3
  __m64 v6; // mm5
  __m64 v7; // mm6
  __m64 v8; // mm7
  __m64 v10; // mm4

  _m_femms();
  m64_u64 = (__m64)a2->m64_u64;
  v4 = _m_punpckldq(m64_u64, m64_u64);
  v5 = a2[1];
  v6 = _m_punpckhdq(m64_u64, m64_u64);
  v7 = _m_punpckldq(v5, v5);
  v8 = _m_punpckhdq(v5, v5);
  v10 = _m_pfadd(_m_pfadd(_m_pfmul(v4, a3[1]), _m_pfmul(v6, a3[3])), _m_pfadd(_m_pfmul(v7, a3[5]), _m_pfmul(v8, a3[7])));
  a1->m64_u64 = (unsigned __int64)_m_pfadd(
                                    _m_pfadd(_m_pfmul(v4, (__m64)a3->m64_u64), _m_pfmul(v6, a3[2])),
                                    _m_pfadd(_m_pfmul(v7, a3[4]), _m_pfmul(v8, a3[6])));
  a1[1].m64_u64 = (unsigned __int64)v10;
  _m_femms();
  return a1;
}

// sub_45FBD0 @ 0x0045FBD0
__m128 *__cdecl sub_45FBD0(__m128 *a1, __m128 *a2, __m128 *a3)
{
  __m128 v3; // xmm1
  __m128 v4; // xmm2
  __m128 *v5; // edx
  __m128 v6; // xmm3
  __m128 v7; // xmm0
  __m128 v8; // xmm5
  __m128 v9; // xmm6
  __m128 v10; // xmm2
  __m128 v11; // xmm4
  __m128 v12; // xmm3
  __m128 v13; // xmm3
  __m128 v14; // xmm0
  __m128 v15; // xmm5
  __m128 v16; // xmm6
  __m128 v17; // xmm1
  __m128 v18; // xmm0
  int savedregs; // [esp+0h] [ebp+0h] BYREF

  v3 = _mm_and_ps(*a1, (__m128)xmmword_47AD90);
  v4 = _mm_and_ps(*a1, (__m128)xmmword_47ADA0);
  v5 = (__m128 *)(&savedregs - 16);
  v6 = _mm_add_ps(_mm_mul_ps(v4, (__m128)xmmword_47AD80), (__m128)xmmword_47AD30);
  v7 = _mm_sub_ps(v6, (__m128)xmmword_47AD30);
  v8 = (__m128)xmmword_47AD20;
  v9 = (__m128)xmmword_47AD10;
  v10 = _mm_sub_ps(
          _mm_sub_ps(
            _mm_sub_ps(_mm_sub_ps(v4, _mm_mul_ps((__m128)xmmword_47AD70, v7)), _mm_mul_ps((__m128)xmmword_47AD60, v7)),
            _mm_mul_ps((__m128)xmmword_47AD50, v7)),
          _mm_mul_ps((__m128)xmmword_47AD40, v7));
  v11 = _mm_mul_ps(v10, v10);
  v12 = _mm_and_ps(v6, (__m128)xmmword_47AD00);
  *v5 = _mm_and_ps(v12, (__m128)xmmword_47ACF0);
  v5[1] = v12;
  v5[2] = v12;
  v5[1].m128_i32[0] = (dword_47ACE0 & (v5[1].m128_i32[0] - v5->m128_i32[0])) << 30;
  v5[1].m128_i32[1] = (dword_47ACE0 & (v5[1].m128_i32[1] - v5->m128_i32[1])) << 30;
  v5[1].m128_i32[2] = (dword_47ACE0 & (v5[1].m128_i32[2] - v5->m128_i32[2])) << 30;
  v5[1].m128_i32[3] = (dword_47ACE0 & (v5[1].m128_i32[3] - v5->m128_i32[3])) << 30;
  v5[2].m128_i32[0] = (dword_47ACE0 & (v5->m128_i32[0] + v5[2].m128_i32[0])) << 30;
  v5[2].m128_i32[1] = (dword_47ACE0 & (v5->m128_i32[1] + v5[2].m128_i32[1])) << 30;
  v5[2].m128_i32[2] = (dword_47ACE0 & (v5->m128_i32[2] + v5[2].m128_i32[2])) << 30;
  v5[2].m128_i32[3] = (dword_47ACE0 & (v5->m128_i32[3] + v5[2].m128_i32[3])) << 30;
  v5->m128_i32[0] = *(&savedregs - 16) << 30;
  v5->m128_i32[1] <<= 30;
  v5->m128_i32[2] <<= 30;
  v5->m128_i32[3] = *(&savedregs - 13) << 30;
  v13 = _mm_xor_ps(*((__m128 *)&savedregs - 3), v3);
  v14 = _mm_cmpneq_ps(*((__m128 *)&savedregs - 4), (__m128)0LL);
  v15 = _mm_mul_ps(
          _mm_add_ps(
            _mm_mul_ps(
              _mm_add_ps(
                _mm_mul_ps(_mm_add_ps(_mm_mul_ps(v8, v11), (__m128)xmmword_47ACD0), v11),
                (__m128)xmmword_47ACB0),
              v11),
            (__m128)xmmword_47AC90),
          v10);
  v16 = _mm_add_ps(
          _mm_mul_ps(
            _mm_add_ps(
              _mm_mul_ps(
                _mm_add_ps(
                  _mm_mul_ps(_mm_add_ps(_mm_mul_ps(v9, v11), (__m128)xmmword_47ACC0), v11),
                  (__m128)xmmword_47ACA0),
                v11),
              (__m128)xmmword_47AC80),
            v11),
          (__m128)xmmword_47AC70);
  v17 = _mm_or_ps(_mm_andnot_ps(v14, v15), _mm_and_ps(v14, v16));
  v18 = _mm_xor_ps(_mm_or_ps(_mm_and_ps(v14, v15), _mm_andnot_ps(v14, v16)), *((__m128 *)&savedregs - 2));
  *a2 = _mm_xor_ps(v17, v13);
  *a3 = v18;
  return a2;
}

// sub_45FDC0 @ 0x0045FDC0
__m128 __userpurge sub_45FDC0@<xmm0>(__m128i a1@<xmm0>, int a2, int a3, int a4, int a5)
{
  __m128 v6; // xmm2
  __m128 v7; // xmm3
  __m128 v8; // xmm4
  __m128 v9; // xmm2
  __m128 v10; // xmm4
  __m128 v11; // xmm2
  __m128 v12; // xmm4
  __m128 v13; // xmm2
  __m128 v14; // xmm4
  __m128 v15; // xmm7
  __m128i v16; // xmm0
  __m128i v17; // xmm3
  __m128 v18; // xmm7
  __m128 v19; // xmm5
  __m128 v20; // xmm2
  __m128 v21; // xmm0
  __m128 v22; // xmm2

  v6 = (__m128)_mm_and_si128(a1, (__m128i)xmmword_47AE80);
  v7 = _mm_add_ps(_mm_mul_ps(v6, (__m128)xmmword_47AE60), (__m128)xmmword_47AE40);
  v8 = _mm_mul_ps((__m128)xmmword_47AE50, _mm_sub_ps(v7, (__m128)xmmword_47AE40));
  v9 = _mm_sub_ps(v6, v8);
  v10 = _mm_shuffle_ps(v8, v8, 57);
  v11 = _mm_sub_ps(v9, v10);
  v12 = _mm_shuffle_ps(v10, v10, 57);
  v13 = _mm_sub_ps(_mm_sub_ps(v11, v12), _mm_shuffle_ps(v12, v12, 57));
  v14 = _mm_mul_ps(v13, v13);
  v15 = _mm_and_ps(v7, (__m128)xmmword_47AE30);
  v16 = (__m128i)_mm_and_ps(v15, (__m128)xmmword_47AE20);
  v17 = _mm_sub_epi32((__m128i)v15, v16);
  v18 = (__m128)_mm_slli_epi32(_mm_and_si128(_mm_add_epi32((__m128i)v15, v16), (__m128i)xmmword_47AE10), 0x1Eu);
  v19 = _mm_add_ps(
          _mm_mul_ps(
            _mm_add_ps(
              _mm_mul_ps(
                _mm_add_ps(
                  _mm_mul_ps(_mm_add_ps(_mm_mul_ps((__m128)xmmword_47AE00, v14), (__m128)xmmword_47ADF0), v14),
                  (__m128)xmmword_47ADE0),
                v14),
              (__m128)xmmword_47ADD0),
            _mm_unpacklo_ps(v13, v14)),
          (__m128)xmmword_47ADC0);
  v20 = _mm_cmpneq_ps((__m128)_mm_slli_epi32(v16, 0x1Eu), (__m128)0LL);
  v21 = _mm_and_ps(v20, v19);
  v22 = _mm_andnot_ps(v20, v19);
  return _mm_xor_ps(
           _mm_or_ps(v21, _mm_shuffle_ps(v22, v22, 177)),
           _mm_unpacklo_ps(
             v18,
             (__m128)_mm_xor_si128(
                       _mm_slli_epi32(_mm_and_si128(v17, (__m128i)xmmword_47AE10), 0x1Eu),
                       _mm_and_si128(a1, (__m128i)xmmword_47AE70))));
}

// sub_45FEB0 @ 0x0045FEB0
__m128 *__cdecl sub_45FEB0(__m128i *a1, __m128 *a2, __m128 *a3)
{
  __m128 v3; // xmm2
  __m128 v4; // xmm3
  __m128 v5; // xmm0
  __m128 v6; // xmm2
  __m128 v7; // xmm4
  __m128 v8; // xmm7
  __m128i v9; // xmm0
  __m128i v10; // xmm3
  __m128 v11; // xmm7
  __m128 v12; // xmm0
  __m128 v13; // xmm5
  __m128 v14; // xmm6

  v3 = (__m128)_mm_and_si128(*a1, (__m128i)xmmword_47AFC0);
  v4 = _mm_add_ps(_mm_mul_ps(v3, (__m128)xmmword_47AFA0), (__m128)xmmword_47AF50);
  v5 = _mm_sub_ps(v4, (__m128)xmmword_47AF50);
  v6 = _mm_sub_ps(
         _mm_sub_ps(
           _mm_sub_ps(_mm_sub_ps(v3, _mm_mul_ps((__m128)xmmword_47AF90, v5)), _mm_mul_ps((__m128)xmmword_47AF80, v5)),
           _mm_mul_ps((__m128)xmmword_47AF70, v5)),
         _mm_mul_ps((__m128)xmmword_47AF60, v5));
  v7 = _mm_mul_ps(v6, v6);
  v8 = _mm_and_ps(v4, (__m128)xmmword_47AF20);
  v9 = (__m128i)_mm_and_ps(v8, (__m128)xmmword_47AF10);
  v10 = _mm_sub_epi32((__m128i)v8, v9);
  v11 = (__m128)_mm_slli_epi32(_mm_and_si128(_mm_add_epi32((__m128i)v8, v9), (__m128i)xmmword_47AF00), 0x1Eu);
  v12 = _mm_cmpneq_ps((__m128)_mm_slli_epi32(v9, 0x1Eu), (__m128)0LL);
  v13 = _mm_mul_ps(
          _mm_add_ps(
            _mm_mul_ps(
              _mm_add_ps(
                _mm_mul_ps(_mm_add_ps(_mm_mul_ps((__m128)xmmword_47AF40, v7), (__m128)xmmword_47AEF0), v7),
                (__m128)xmmword_47AED0),
              v7),
            (__m128)xmmword_47AEB0),
          v6);
  v14 = _mm_add_ps(
          _mm_mul_ps(
            _mm_add_ps(
              _mm_mul_ps(
                _mm_add_ps(
                  _mm_mul_ps(_mm_add_ps(_mm_mul_ps((__m128)xmmword_47AF30, v7), (__m128)xmmword_47AEE0), v7),
                  (__m128)xmmword_47AEC0),
                v7),
              (__m128)xmmword_47AEA0),
            v7),
          (__m128)xmmword_47AE90);
  *a2 = _mm_xor_ps(
          _mm_or_ps(_mm_andnot_ps(v12, v13), _mm_and_ps(v12, v14)),
          (__m128)_mm_xor_si128(
                    _mm_slli_epi32(_mm_and_si128(v10, (__m128i)xmmword_47AF00), 0x1Eu),
                    _mm_and_si128(*a1, (__m128i)xmmword_47AFB0)));
  *a3 = _mm_xor_ps(_mm_or_ps(_mm_and_ps(v12, v13), _mm_andnot_ps(v12, v14)), v11);
  return a2;
}

// math_atan2_packed @ 0x004600C0
// packed atan2 approximation; inputs in MM0/MM1
void sub_4600C0()
{
  ;
}

// math_acos_packed @ 0x004601C0
// packed acos approximation; input in MM0
void sub_4601C0()
{
  ;
}

// sub_4603C0 @ 0x004603C0
void sub_4603C0()
{
  ;
}

// math_sincos_packed @ 0x004607A0
// packed sin/cos approximation for the angle in MM0
unsigned int __usercall sub_4607A0@<eax>(__m64 a1@<mm0>)
{
  int v1; // eax

  v1 = _mm_cvtsi64_si32(a1);
  return v1 & 0x80000000 ^ v1;
}

// math_sin_packed @ 0x004608C0
// packed sin approximation; input in MM0
unsigned int __usercall sub_4608C0@<eax>(__m64 a1@<mm0>)
{
  int v1; // eax

  v1 = _mm_cvtsi64_si32(a1);
  return v1 & 0x80000000 ^ v1;
}

// FUN_00460cb8 @ 0x00460CB8
// [binja] int32_t sub_460cb8()
int FUN_00460cb8()
{
  int result; // eax

  _cfltcvt_init_10();
  dword_4D9964 = FUN_00463737();
  result = _setdefaultprecision();
  __asm { fnclex }
  return result;
}

// nullsub_103 @ 0x00460CCF
void nullsub_103()
{
  ;
}

// crt_free @ 0x00460DC7
// CRT free wrapper
void crt_free(void *ptr)
{
  crt_free_base(ptr);
}

// sub_461501 @ 0x00461501
int sub_461501()
{
  return crt_flushall(1);
}

// crt_fwrite @ 0x004615AE
// fwrite wrapper with CRT lock/unlock
uint crt_fwrite(void *ptr, uint size, uint count, FILE *fp)
{
  uint v4; // esi

  crt_lock_file(fp);
  v4 = crt_fwrite_nolock(ptr, size, count, fp);
  crt_unlock_file(fp);
  return v4;
}

// crt_fread @ 0x00461AF7
// fread wrapper with CRT lock/unlock
uint crt_fread(void *ptr, uint size, uint count, FILE *fp)
{
  uint v4; // esi

  crt_lock_file(fp);
  v4 = crt_fread_nolock(ptr, size, count, fp);
  crt_unlock_file(fp);
  return v4;
}

// sub_461FD5 @ 0x00461FD5
int sub_461FD5(int a1, ...)
{
  int v1; // edi
  int v2; // ebx
  va_list va; // [esp+14h] [ebp+8h] BYREF

  va_start(va, a1);
  crt_lock_file2(1, &stream);
  v1 = FUN_004666f5(&stream);
  v2 = crt_output(&stream, a1, (int)va);
  _ftbuf(v1, &stream);
  crt_unlock_file2(1, &stream);
  return v2;
}

// crt_thread_entry @ 0x004622B6
// CRT: thread start trampoline
unsigned int __noreturn crt_thread_entry(void *thread_data)
{
  _DWORD *Value; // esi

  Value = TlsGetValue(dwTlsIndex);
  if ( Value )
  {
    Value[18] = *((_DWORD *)thread_data + 18);
    Value[19] = *((_DWORD *)thread_data + 19);
    crt_free_thread_data(thread_data);
  }
  else
  {
    Value = thread_data;
  }
  if ( !TlsSetValue(dwTlsIndex, Value) )
    _amsg_exit(0x10u);
  if ( off_47B164 )
    off_47B164();
  ((void (__cdecl *)(_DWORD))Value[18])(Value[19]);
  crt_endthread();
}

// crt_free_base @ 0x004625C1
// [binja] int32_t sub_462683()
void crt_free_base(void *ptr)
{
  void *region; // eax
  bool v2; // zf
  char *block; // eax
  void *region_out; // [esp+Ch] [ebp-28h] BYREF
  char *v5; // [esp+10h] [ebp-24h]
  unsigned int page_base; // [esp+14h] [ebp-20h] BYREF
  void *v7; // [esp+18h] [ebp-1Ch]
  CPPEH_RECORD ms_exc; // [esp+1Ch] [ebp-18h]

  if ( ptr )
  {
    if ( crt_heap_mode == 3 )
    {
      crt_lock(9);
      ms_exc.registration.TryLevel = 0;
      region = crt_sbh_find_region(ptr);
      v7 = region;
      if ( region )
        FUN_00466ca6(region, (int *)ptr);
      ms_exc.registration.TryLevel = -1;
      crt_unlock(9);
      v2 = v7 == 0;
    }
    else
    {
      if ( crt_heap_mode != 2 )
      {
LABEL_11:
        HeapFree(hHeap, 0, ptr);
        return;
      }
      crt_lock(9);
      ms_exc.registration.TryLevel = 1;
      block = (char *)crt_sbh_find_block(ptr, &region_out, &page_base);
      v5 = block;
      if ( block )
        FUN_00467a2d(region_out, page_base, block);
      ms_exc.registration.TryLevel = -1;
      crt_unlock(9);
      v2 = v5 == 0;
    }
    if ( !v2 )
      return;
    goto LABEL_11;
  }
}

// crt_realloc @ 0x004626AA
// [binja] int32_t sub_462983()
void *crt_realloc(void *ptr, size_t size)
{
  void *v2; // ebx
  void *result; // eax
  uint v4; // esi
  void *region; // eax
  size_t v6; // eax
  size_t v7; // eax
  char *block; // eax
  char *v9; // edi
  size_t v10; // eax
  size_t v11; // eax
  void *region_out; // [esp+Ch] [ebp-38h] BYREF
  size_t v13; // [esp+10h] [ebp-34h]
  char *v14; // [esp+14h] [ebp-30h]
  unsigned int page_base; // [esp+18h] [ebp-2Ch] BYREF
  void *arg1; // [esp+1Ch] [ebp-28h]
  void *dst; // [esp+20h] [ebp-24h]
  size_t v18; // [esp+24h] [ebp-20h]
  CPPEH_RECORD ms_exc; // [esp+2Ch] [ebp-18h]

  v2 = ptr;
  if ( !ptr )
    return malloc(size);
  v4 = size;
  if ( size )
  {
    if ( crt_heap_mode == 3 )
    {
      while ( 1 )
      {
        dst = 0;
        if ( v4 <= 0xFFFFFFE0 )
        {
          crt_lock(9);
          ms_exc.registration.TryLevel = 0;
          region = crt_sbh_find_region(ptr);
          arg1 = region;
          if ( region )
          {
            if ( v4 <= dword_4DA3A0 )
            {
              if ( FUN_00467484((int *)region, (void **)ptr, (void *)v4) )
              {
                dst = ptr;
              }
              else
              {
                dst = crt_sbh_alloc(v4);
                if ( dst )
                {
                  v6 = *((_DWORD *)ptr - 1) - 1;
                  v18 = v6;
                  if ( v6 >= v4 )
                    v6 = v4;
                  crt_bufcpy(dst, ptr, v6);
                  arg1 = crt_sbh_find_region(ptr);
                  FUN_00466ca6(arg1, (int *)ptr);
                }
              }
            }
            if ( !dst )
            {
              if ( !v4 )
                v4 = 1;
              v4 = (v4 + 15) & 0xFFFFFFF0;
              dst = HeapAlloc(hHeap, 0, v4);
              if ( dst )
              {
                v7 = *((_DWORD *)ptr - 1) - 1;
                v18 = v7;
                if ( v7 >= v4 )
                  v7 = v4;
                crt_bufcpy(dst, ptr, v7);
                FUN_00466ca6(arg1, (int *)ptr);
              }
            }
          }
          ms_exc.registration.TryLevel = -1;
          crt_unlock(9);
          if ( !arg1 )
          {
            if ( !v4 )
              v4 = 1;
            v4 = (v4 + 15) & 0xFFFFFFF0;
            dst = HeapReAlloc(hHeap, 0, ptr, v4);
          }
        }
        result = dst;
        if ( dst || !dword_4D9A78 )
          break;
        if ( !crt_call_new_handler(v4) )
          return 0;
      }
    }
    else if ( crt_heap_mode == 2 )
    {
      if ( size <= 0xFFFFFFE0 )
        v4 = (size + 15) & 0xFFFFFFF0;
      while ( 1 )
      {
        dst = 0;
        if ( v4 <= 0xFFFFFFE0 )
        {
          crt_lock(9);
          ms_exc.registration.TryLevel = 1;
          block = (char *)crt_sbh_find_block(v2, &region_out, &page_base);
          v9 = block;
          v14 = block;
          if ( block )
          {
            if ( v4 < dword_47DB14 )
            {
              if ( FUN_00467d9e(region_out, (void **)page_base, block, v4 >> 4) )
              {
                dst = ptr;
              }
              else
              {
                dst = crt_sbh_alloc_units(v4 >> 4);
                if ( dst )
                {
                  v10 = 16 * (unsigned __int8)*v9;
                  v13 = v10;
                  if ( v10 >= v4 )
                    v10 = v4;
                  crt_bufcpy(dst, ptr, v10);
                  FUN_00467a2d(region_out, page_base, v9);
                }
              }
              v2 = ptr;
            }
            if ( !dst )
            {
              dst = HeapAlloc(hHeap, 0, v4);
              if ( dst )
              {
                v11 = 16 * (unsigned __int8)*v9;
                v13 = v11;
                if ( v11 >= v4 )
                  v11 = v4;
                crt_bufcpy(dst, v2, v11);
                FUN_00467a2d(region_out, page_base, v9);
              }
            }
          }
          else
          {
            dst = HeapReAlloc(hHeap, 0, v2, v4);
          }
          ms_exc.registration.TryLevel = -1;
          crt_unlock(9);
        }
        result = dst;
        if ( dst || !dword_4D9A78 )
          break;
        if ( !crt_call_new_handler(v4) )
          return 0;
      }
    }
    else
    {
      while ( 1 )
      {
        result = 0;
        if ( v4 <= 0xFFFFFFE0 )
        {
          if ( !v4 )
            v4 = 1;
          v4 = (v4 + 15) & 0xFFFFFFF0;
          result = HeapReAlloc(hHeap, 0, ptr, v4);
        }
        if ( result || !dword_4D9A78 )
          break;
        if ( !crt_call_new_handler(v4) )
          return 0;
      }
    }
  }
  else
  {
    crt_free_base(ptr);
    return 0;
  }
  return result;
}

// FUN_00462a17 @ 0x00462A17
// [binja] int32_t sub_462add()
void *FUN_00462a17(uint arg1)
{
  void *result; // eax
  uint v2; // esi
  uint v3; // eax
  SIZE_T v4; // eax
  void *v5; // [esp+Ch] [ebp-1Ch]
  void *v6; // [esp+Ch] [ebp-1Ch]

  if ( crt_heap_mode == 3 )
  {
    if ( arg1 <= dword_4DA3A0 )
    {
      crt_lock(9);
      v5 = crt_sbh_alloc(arg1);
      crt_unlock(9);
      result = v5;
      if ( v5 )
        return result;
    }
    goto LABEL_12;
  }
  if ( crt_heap_mode != 2 )
  {
LABEL_12:
    v3 = arg1;
    if ( !arg1 )
      v3 = 1;
    v4 = v3 + 15;
    LOBYTE(v4) = v4 & 0xF0;
    return HeapAlloc(hHeap, 0, v4);
  }
  if ( arg1 )
    v2 = (arg1 + 15) & 0xFFFFFFF0;
  else
    v2 = 16;
  if ( v2 > dword_47DB14 )
    return HeapAlloc(hHeap, 0, v2);
  crt_lock(9);
  v6 = crt_sbh_alloc_units(v2 >> 4);
  crt_unlock(9);
  result = v6;
  if ( !v6 )
    return HeapAlloc(hHeap, 0, v2);
  return result;
}

// nullsub_104 @ 0x00463176
void nullsub_104()
{
  ;
}

// crt_msize @ 0x00463B86
// [binja] int32_t sub_463c6b()
size_t crt_msize(void *ptr)
{
  size_t v1; // esi
  bool v2; // zf
  unsigned __int8 *block; // eax
  void *region_out; // [esp+Ch] [ebp-2Ch] BYREF
  unsigned __int8 *v6; // [esp+10h] [ebp-28h]
  unsigned int page_base; // [esp+14h] [ebp-24h] BYREF
  size_t v8; // [esp+18h] [ebp-20h]
  void *region; // [esp+1Ch] [ebp-1Ch]
  CPPEH_RECORD ms_exc; // [esp+20h] [ebp-18h]

  if ( crt_heap_mode == 3 )
  {
    crt_lock(9);
    ms_exc.registration.TryLevel = 0;
    region = crt_sbh_find_region(ptr);
    if ( region )
    {
      v1 = *((_DWORD *)ptr - 1) - 9;
      v8 = v1;
    }
    else
    {
      v1 = v8;
    }
    ms_exc.registration.TryLevel = -1;
    crt_unlock(9);
    v2 = region == 0;
  }
  else
  {
    if ( crt_heap_mode != 2 )
      return HeapSize(hHeap, 0, ptr);
    crt_lock(9);
    ms_exc.registration.TryLevel = 1;
    block = (unsigned __int8 *)crt_sbh_find_block(ptr, &region_out, &page_base);
    v6 = block;
    if ( block )
    {
      v1 = 16 * *block;
      v8 = v1;
    }
    else
    {
      v1 = v8;
    }
    ms_exc.registration.TryLevel = -1;
    crt_unlock(9);
    v2 = v6 == 0;
  }
  if ( v2 )
    return HeapSize(hHeap, 0, ptr);
  return v1;
}

// crt_output @ 0x00464380
// CRT: core printf formatter
int crt_output(FILE *stream, char *format, void *args)
{
  int v3; // ecx
  char v4; // bl
  char *v5; // esi
  bool v6; // zf
  int v7; // eax
  int v8; // eax
  int v9; // eax
  int v10; // esi
  char *v11; // eax
  char *v12; // ecx
  char *i; // eax
  int v14; // edx
  wchar_t v15; // ax
  __int16 *v16; // eax
  char *v17; // ecx
  unsigned int v18; // eax
  int v19; // eax
  void *v20; // eax
  char *j; // eax
  int v22; // edx
  _WORD *v23; // eax
  __int64 v24; // rax
  int v25; // eax
  int v26; // ebx
  char *v27; // eax
  int v28; // eax
  char v29; // bl
  int v30; // esi
  char *v31; // ebx
  int v32; // edi
  wchar_t v33; // ax
  int v34; // eax
  char MbCh[511]; // [esp+Ch] [ebp-24Ch] BYREF
  char v38; // [esp+20Bh] [ebp-4Dh] BYREF
  int v39; // [esp+20Ch] [ebp-4Ch]
  int v40; // [esp+210h] [ebp-48h]
  char buf[4]; // [esp+214h] [ebp-44h] BYREF
  int v42; // [esp+218h] [ebp-40h]
  int v43; // [esp+21Ch] [ebp-3Ch]
  int v44; // [esp+220h] [ebp-38h]
  int v45; // [esp+224h] [ebp-34h]
  LPVOID lpMem; // [esp+228h] [ebp-30h]
  int v47; // [esp+22Ch] [ebp-2Ch]
  int v48; // [esp+230h] [ebp-28h]
  int v49; // [esp+234h] [ebp-24h]
  unsigned __int64 v50; // [esp+238h] [ebp-20h]
  _WORD count[3]; // [esp+242h] [ebp-16h] BYREF
  int v52; // [esp+248h] [ebp-10h]
  char *v53; // [esp+24Ch] [ebp-Ch]
  int v54; // [esp+250h] [ebp-8h]
  int v55; // [esp+254h] [ebp-4h]
  char *formata; // [esp+264h] [ebp+Ch]

  v3 = 0;
  v52 = 0;
  v4 = *format;
  v5 = format + 1;
  v6 = *format == 0;
  *(_DWORD *)&count[1] = 0;
  lpMem = 0;
  formata = format + 1;
  if ( !v6 )
  {
    while ( 1 )
    {
      if ( *(int *)&count[1] < 0 )
        return *(_DWORD *)&count[1];
      if ( v4 < 32 || v4 > 120 )
        v7 = 0;
      else
        v7 = Source[v4] & 0xF;
      v43 = byte_46FAD8[8 * v7 + v3] >> 4;
      switch ( v43 )
      {
        case 0:
          goto LABEL_42;
        case 1:
          v54 = -1;
          v42 = 0;
          v44 = 0;
          v48 = 0;
          v49 = 0;
          v55 = 0;
          v47 = 0;
          goto LABEL_179;
        case 2:
          switch ( v4 )
          {
            case ' ':
              v55 |= 2u;
              break;
            case '#':
              LOBYTE(v55) = v55 | 0x80;
              break;
            case '+':
              v55 |= 1u;
              break;
            case '-':
              v55 |= 4u;
              break;
            case '0':
              v55 |= 8u;
              break;
          }
          goto LABEL_179;
        case 3:
          if ( v4 == 42 )
          {
            v8 = FUN_00464bbc((int *)&args);
            v48 = v8;
            if ( v8 >= 0 )
              goto LABEL_179;
            v55 |= 4u;
            v9 = -v8;
          }
          else
          {
            v9 = v4 + 10 * v48 - 48;
          }
          v48 = v9;
          goto LABEL_179;
        case 4:
          v54 = 0;
          goto LABEL_179;
        case 5:
          if ( v4 == 42 )
          {
            v54 = FUN_00464bbc((int *)&args);
            if ( v54 < 0 )
              v54 = -1;
          }
          else
          {
            v54 = v4 + 10 * v54 - 48;
          }
          goto LABEL_179;
        case 6:
          switch ( v4 )
          {
            case 'I':
              if ( *v5 == 54 && v5[1] == 52 )
              {
                BYTE1(v55) |= 0x80u;
                formata = v5 + 2;
              }
              else
              {
                v43 = 0;
LABEL_42:
                v47 = 0;
                if ( *((char *)crt_ctype_table + 2 * (unsigned __int8)v4 + 1) < 0 )
                {
                  crt_putc_nolock(v4, stream, (int *)&count[1]);
                  v4 = *v5;
                  formata = v5 + 1;
                }
                crt_putc_nolock(v4, stream, (int *)&count[1]);
              }
              break;
            case 'h':
              v55 |= 0x20u;
              break;
            case 'l':
              v55 |= 0x10u;
              break;
            case 'w':
              v55 |= 0x800u;
              break;
          }
          goto LABEL_179;
        case 7:
          if ( v4 > 103 )
          {
            switch ( v4 )
            {
              case 'i':
                goto LABEL_119;
              case 'n':
                v23 = (_WORD *)FUN_00464bbc((int *)&args);
                if ( (v55 & 0x20) != 0 )
                  *v23 = count[1];
                else
                  *(_DWORD *)v23 = *(_DWORD *)&count[1];
                v44 = 1;
                goto LABEL_177;
              case 'o':
                v52 = 8;
                if ( (v55 & 0x80u) != 0 )
                  v55 |= 0x200u;
                break;
              default:
                switch ( v4 )
                {
                  case 'p':
                    v54 = 8;
LABEL_110:
                    v45 = 7;
                    break;
                  case 's':
                    goto LABEL_55;
                  case 'u':
                    goto LABEL_120;
                  case 'x':
                    v45 = 39;
                    break;
                  default:
                    goto LABEL_154;
                }
                v52 = 16;
                if ( (v55 & 0x80u) != 0 )
                {
                  LOBYTE(count[0]) = 48;
                  v49 = 2;
                  HIBYTE(count[0]) = v45 + 81;
                }
                break;
            }
LABEL_121:
            if ( (v55 & 0x8000) == 0 )
            {
              if ( (v55 & 0x20) != 0 )
              {
                if ( (v55 & 0x40) != 0 )
                  LODWORD(v24) = (__int16)FUN_00464bbc((int *)&args);
                else
                  LODWORD(v24) = (unsigned __int16)FUN_00464bbc((int *)&args);
              }
              else
              {
                if ( (v55 & 0x40) == 0 )
                {
                  v24 = (unsigned int)FUN_00464bbc((int *)&args);
                  goto LABEL_131;
                }
                LODWORD(v24) = FUN_00464bbc((int *)&args);
              }
              v24 = (int)v24;
            }
            else
            {
              LODWORD(v24) = FUN_00464bc9((int *)&args);
            }
LABEL_131:
            if ( (v55 & 0x40) != 0 && v24 < 0 )
            {
              BYTE1(v55) |= 1u;
              v50 = -v24;
            }
            else
            {
              v50 = v24;
            }
            if ( (v55 & 0x8000) == 0 )
              HIDWORD(v50) = 0;
            if ( v54 >= 0 )
            {
              v55 &= ~8u;
              if ( v54 > 512 )
                v54 = 512;
            }
            else
            {
              v54 = 1;
            }
            if ( !v50 )
              v49 = 0;
            v53 = &v38;
            while ( 1 )
            {
              v25 = v54--;
              if ( v25 <= 0 && !v50 )
                break;
              v26 = v50 % v52 + 48;
              v50 /= (unsigned __int64)v52;
              if ( v26 > 57 )
                LOBYTE(v26) = v45 + v26;
              v27 = v53--;
              *v27 = v26;
            }
            v28 = &v38 - v53++;
            v52 = v28;
            if ( (v55 & 0x200) != 0 && (*v53 != 48 || !v28) )
            {
              --v53;
              v19 = v28 + 1;
              *v53 = 48;
              goto LABEL_153;
            }
            goto LABEL_154;
          }
          if ( v4 >= 101 )
            goto LABEL_65;
          if ( v4 > 88 )
          {
            if ( v4 == 90 )
            {
              v16 = (__int16 *)FUN_00464bbc((int *)&args);
              if ( v16 && (v17 = (char *)*((_DWORD *)v16 + 1)) != 0 )
              {
                if ( (v55 & 0x800) != 0 )
                {
                  v18 = (unsigned int)*v16 >> 1;
                  v53 = v17;
                  v52 = v18;
                  v47 = 1;
                  goto LABEL_154;
                }
                v47 = 0;
                v53 = v17;
                v19 = *v16;
              }
              else
              {
                v53 = Str;
                v19 = strlen(Str);
              }
              goto LABEL_153;
            }
            if ( v4 == 99 )
              goto LABEL_69;
            if ( v4 != 100 )
              goto LABEL_154;
LABEL_119:
            v55 |= 0x40u;
LABEL_120:
            v52 = 10;
            goto LABEL_121;
          }
          switch ( v4 )
          {
            case 'X':
              goto LABEL_110;
            case 'C':
              if ( (v55 & 0x830) == 0 )
                v55 |= 0x800u;
LABEL_69:
              if ( (v55 & 0x810) != 0 )
              {
                v15 = (unsigned __int16)FUN_00464bd9((int *)&args);
                v52 = wctomb(MbCh, v15);
                if ( v52 < 0 )
                  v44 = 1;
              }
              else
              {
                MbCh[0] = FUN_00464bbc((int *)&args);
                v52 = 1;
              }
              v53 = MbCh;
              goto LABEL_154;
            case 'E':
            case 'G':
              v42 = 1;
              v4 += 32;
LABEL_65:
              v55 |= 0x40u;
              v53 = MbCh;
              if ( v54 >= 0 )
              {
                if ( v54 )
                {
                  if ( v54 > 512 )
                    v54 = 512;
                  if ( v54 > 163 )
                  {
                    v20 = malloc(v54 + 349);
                    lpMem = v20;
                    if ( v20 )
                      v53 = (char *)v20;
                    else
                      v54 = 163;
                  }
                }
                else
                {
                  v54 = v4 == 103;
                }
              }
              else
              {
                v54 = 6;
              }
              args = (char *)args + 8;
              v39 = *((_DWORD *)args - 2);
              v40 = *((_DWORD *)args - 1);
              off_47B1A8();
              break;
          }
          if ( v4 == 83 )
          {
            if ( (v55 & 0x830) == 0 )
              v55 |= 0x800u;
LABEL_55:
            v10 = 0x7FFFFFFF;
            if ( v54 != -1 )
              v10 = v54;
            v11 = (char *)FUN_00464bbc((int *)&args);
            v12 = v11;
            v53 = v11;
            if ( (v55 & 0x810) != 0 )
            {
              if ( !v11 )
              {
                v12 = (char *)off_47B65C;
                v53 = (char *)off_47B65C;
              }
              v47 = 1;
              for ( i = v12; ; i += 2 )
              {
                v14 = v10--;
                if ( !v14 || !*(_WORD *)i )
                  break;
              }
              v19 = (i - v12) >> 1;
            }
            else
            {
              if ( !v11 )
              {
                v12 = Str;
                v53 = Str;
              }
              for ( j = v12; ; ++j )
              {
                v22 = v10--;
                if ( !v22 || !*j )
                  break;
              }
              v19 = j - v12;
            }
LABEL_153:
            v52 = v19;
          }
LABEL_154:
          if ( v44 )
            goto LABEL_177;
          v29 = v55;
          if ( (v55 & 0x40) == 0 )
            goto LABEL_163;
          if ( (v55 & 0x100) != 0 )
          {
            LOBYTE(count[0]) = 45;
LABEL_162:
            v49 = 1;
            goto LABEL_163;
          }
          if ( (v55 & 1) != 0 )
          {
            LOBYTE(count[0]) = 43;
            goto LABEL_162;
          }
          if ( (v55 & 2) != 0 )
          {
            LOBYTE(count[0]) = 32;
            goto LABEL_162;
          }
LABEL_163:
          v30 = v48 - v49 - v52;
          if ( (v55 & 0xC) == 0 )
            crt_putc_repeat_nolock(32, v48 - v49 - v52, stream, (int *)&count[1]);
          crt_putc_buffer_nolock((char *)count, v49, stream, (int *)&count[1]);
          if ( (v29 & 8) != 0 && (v29 & 4) == 0 )
            crt_putc_repeat_nolock(48, v30, stream, (int *)&count[1]);
          if ( v47 && v52 > 0 )
          {
            v31 = v53;
            v32 = v52 - 1;
            do
            {
              v33 = *(_WORD *)v31;
              v31 += 2;
              v34 = wctomb(buf, v33);
              if ( v34 <= 0 )
                break;
              crt_putc_buffer_nolock(buf, v34, stream, (int *)&count[1]);
            }
            while ( v32-- );
          }
          else
          {
            crt_putc_buffer_nolock(v53, v52, stream, (int *)&count[1]);
          }
          if ( (v55 & 4) != 0 )
            crt_putc_repeat_nolock(32, v30, stream, (int *)&count[1]);
LABEL_177:
          if ( lpMem )
          {
            crt_free_base(lpMem);
            lpMem = 0;
          }
LABEL_179:
          v4 = *formata;
          v5 = formata + 1;
          v6 = *formata++ == 0;
          if ( v6 )
            return *(_DWORD *)&count[1];
          v3 = v43;
          break;
        default:
          goto LABEL_179;
      }
    }
  }
  return *(_DWORD *)&count[1];
}

// crt_dosmaperr @ 0x00465D20
// map Win32 error to errno/doserrno
void crt_dosmaperr(uint os_error)
{
  int v1; // esi
  void (__noreturn **v2)(); // eax

  v1 = 0;
  *crt_doserrno_ptr() = os_error;
  v2 = (void (__noreturn **)())&crt_dosmaperr_table;
  do
  {
    if ( (void (__noreturn *)())os_error == *v2 )
    {
      *crt_errno_ptr() = dword_47B7C4[2 * v1];
      return;
    }
    v2 += 2;
    ++v1;
  }
  while ( v2 < &off_47B928 );
  if ( os_error < 0x13 || os_error > 0x24 )
  {
    if ( os_error < 0xBC || os_error > 0xCA )
      *crt_errno_ptr() = 22;
    else
      *crt_errno_ptr() = 8;
  }
  else
  {
    *crt_errno_ptr() = 13;
  }
}

// crt_invalid_parameter_noinfo_noreturn @ 0x00465FA9
// invokes invalid-parameter handler (if set) then terminates
void __noreturn crt_invalid_parameter_noinfo_noreturn()
{
  EXCEPTION_POINTERS *v0; // ecx
  int v1; // [esp-Ch] [ebp-24h] BYREF
  CPPEH_RECORD ms_exc; // [esp+0h] [ebp-18h]

  ms_exc.registration.ScopeTable = stru_46FBB0;
  ms_exc.registration.ExceptionHandler = _except_handler3;
  ms_exc.registration.Next = (struct _EH3_EXCEPTION_REGISTRATION *)NtCurrentTeb()->NtTib.ExceptionList;
  ms_exc.exc_ptr = v0;
  ms_exc.old_esp = (DWORD)&v1;
  ms_exc.registration.TryLevel = 0;
  if ( off_47B928 )
  {
    ms_exc.registration.TryLevel = 1;
    off_47B928();
  }
  ms_exc.registration.TryLevel = -1;
  crt_terminate();
}

// crt_calloc @ 0x004667AC
// [binja] int32_t sub_4668ce()
void *crt_calloc(unsigned int count, unsigned int size)
{
  SIZE_T v2; // esi
  void *result; // eax
  void *v4; // [esp+14h] [ebp-20h]
  unsigned int v5; // [esp+18h] [ebp-1Ch]

  v2 = size * count;
  v5 = size * count;
  if ( size * count <= 0xFFFFFFE0 )
  {
    if ( !v2 )
      v2 = 1;
    v2 = (v2 + 15) & 0xFFFFFFF0;
  }
  while ( 1 )
  {
    v4 = 0;
    if ( v2 <= 0xFFFFFFE0 )
    {
      if ( crt_heap_mode == 3 )
      {
        if ( v5 > dword_4DA3A0 )
          goto LABEL_14;
        crt_lock(9);
        v4 = crt_sbh_alloc(v5);
        crt_unlock(9);
        if ( v4 )
        {
          memset(v4, 0, v5);
          goto LABEL_14;
        }
LABEL_15:
        v4 = HeapAlloc(hHeap, 8u, v2);
        goto LABEL_16;
      }
      if ( crt_heap_mode == 2 && v2 <= dword_47DB14 )
      {
        crt_lock(9);
        v4 = crt_sbh_alloc_units(v2 >> 4);
        crt_unlock(9);
        if ( !v4 )
          goto LABEL_15;
        memset(v4, 0, v2);
      }
LABEL_14:
      if ( v4 )
        return v4;
      goto LABEL_15;
    }
LABEL_16:
    if ( v4 || !dword_4D9A78 )
      return v4;
    result = (void *)crt_call_new_handler(v2);
    if ( !result )
      return result;
  }
}

// FUN_00466a61 @ 0x00466A61
// [binja] HMODULE sub_466a61(int32_t* arg1)
void *FUN_00466a61(int *arg1)
{
  void *result; // eax
  int v2; // ecx

  *arg1 = 0;
  result = GetModuleHandleA(0);
  if ( *(_WORD *)result == 23117 )
  {
    v2 = *((_DWORD *)result + 15);
    if ( v2 )
    {
      result = (char *)result + v2;
      *(_BYTE *)arg1 = *((_BYTE *)result + 26);
      LOBYTE(result) = *((_BYTE *)result + 27);
      *((_BYTE *)arg1 + 1) = (_BYTE)result;
    }
  }
  return result;
}

// crt_heap_select @ 0x00466A8E
// selects CRT heap strategy
int crt_heap_select()
{
  int result; // eax
  CHAR *i; // ecx
  char v2; // al
  CHAR *v3; // eax
  CHAR *j; // ecx
  char v5; // al
  char *v6; // eax
  _BYTE *v7; // eax
  _BYTE *v8; // ecx
  int v9; // [esp+0h] [ebp-1230h]
  CHAR Buffer[4240]; // [esp+4h] [ebp-122Ch] BYREF
  CHAR Filename[260]; // [esp+1094h] [ebp-19Ch] BYREF
  struct _OSVERSIONINFOA VersionInformation; // [esp+1198h] [ebp-98h] BYREF
  int arg1; // [esp+122Ch] [ebp-4h] BYREF

  VersionInformation.dwOSVersionInfoSize = 148;
  if ( GetVersionExA(&VersionInformation)
    && VersionInformation.dwPlatformId == 2
    && VersionInformation.dwMajorVersion >= 5 )
  {
    return 1;
  }
  if ( !GetEnvironmentVariableA("__MSVCRT_HEAP_SELECT", Buffer, 0x1090u) )
    goto LABEL_29;
  for ( i = Buffer; *i; ++i )
  {
    v2 = *i;
    if ( *i >= 97 && v2 <= 122 )
      *i = v2 - 32;
  }
  if ( !strncmp("__GLOBAL_HEAP_SELECTED", Buffer, 0x16u) )
  {
    v3 = Buffer;
  }
  else
  {
    GetModuleFileNameA(0, Filename, 0x104u);
    for ( j = Filename; *j; ++j )
    {
      v5 = *j;
      if ( *j >= 97 && v5 <= 122 )
        *j = v5 - 32;
    }
    v3 = strstr(Buffer, Filename);
  }
  if ( !v3 )
    goto LABEL_29;
  v6 = strchr(v3, 44);
  if ( !v6 )
    goto LABEL_29;
  v7 = v6 + 1;
  v8 = v7;
  while ( *v8 )
  {
    if ( *v8 == 59 )
      *v8 = 0;
    else
      ++v8;
  }
  result = crt_strtol_l(v7, 0, (char **)0xA, v9);
  if ( result != 2 && result != 3 && result != 1 )
  {
LABEL_29:
    FUN_00466a61(&arg1);
    return 3 - ((unsigned __int8)arg1 < 6u);
  }
  return result;
}

// crt_heap_init @ 0x00466BD6
// CRT heap init (small/large block selection)
int __cdecl sub_466BD6(int a1)
{
  int v1; // eax
  int v2; // eax

  hHeap = HeapCreate(a1 == 0, 0x1000u, 0);
  if ( !hHeap )
    return 0;
  v1 = crt_heap_select();
  crt_heap_mode = v1;
  if ( v1 == 3 )
  {
    v2 = crt_sbh_init(1016);
  }
  else
  {
    if ( v1 != 2 )
      return 1;
    v2 = crt_sbh_create_region();
  }
  if ( !v2 )
  {
    HeapDestroy(hHeap);
    return 0;
  }
  return 1;
}

// FUN_00466ca6 @ 0x00466CA6
// [binja] int32_t* sub_466ca6(void* arg1, int32_t* arg2)
int *FUN_00466ca6(void *arg1, int *arg2)
{
  int *result; // eax
  int *v3; // esi
  unsigned int v4; // edi
  int v5; // ecx
  int *v6; // ebx
  unsigned int v7; // edx
  _BYTE *v8; // ecx
  unsigned int v9; // ebx
  bool v10; // zf
  _BYTE *v11; // ecx
  unsigned int v12; // ebx
  unsigned int v13; // edx
  unsigned int v14; // ebx
  unsigned int v15; // esi
  unsigned int v16; // esi
  int *v17; // ecx
  LPVOID *v18; // eax
  int *v19; // [esp+Ch] [ebp-10h]
  int v20; // [esp+10h] [ebp-Ch]
  int v21; // [esp+14h] [ebp-8h]
  int v22; // [esp+18h] [ebp-4h]
  int *arg2a; // [esp+28h] [ebp+Ch]
  int *arg2b; // [esp+28h] [ebp+Ch]
  char arg2_3; // [esp+2Bh] [ebp+Fh]

  result = (int *)*((_DWORD *)arg1 + 4);
  v3 = arg2 - 1;
  v4 = ((unsigned int)arg2 - *((_DWORD *)arg1 + 3)) >> 15;
  v19 = &result[129 * v4 + 81];
  v5 = *(arg2 - 1) - 1;
  v22 = v5;
  if ( (v5 & 1) == 0 )
  {
    v6 = (int *)((char *)v3 + v5);
    v20 = *(int *)((char *)v3 + v5);
    v21 = *(arg2 - 2);
    arg2a = (int *)((char *)v3 + v5);
    if ( (v20 & 1) == 0 )
    {
      v7 = (v20 >> 4) - 1;
      if ( v7 > 0x3F )
        v7 = 63;
      if ( v6[1] == v6[2] )
      {
        if ( v7 >= 0x20 )
        {
          v11 = (char *)result + v7 + 4;
          v12 = ~(0x80000000 >> (v7 - 32));
          result[v4 + 49] &= v12;
          v10 = (*v11)-- == 1;
          if ( v10 )
            *((_DWORD *)arg1 + 1) &= v12;
        }
        else
        {
          v8 = (char *)result + v7 + 4;
          v9 = ~(0x80000000 >> v7);
          result[v4 + 17] &= v9;
          v10 = (*v8)-- == 1;
          if ( v10 )
            *(_DWORD *)arg1 &= v9;
        }
        v5 = v22;
        v6 = arg2a;
      }
      v5 += v20;
      *(_DWORD *)(v6[2] + 4) = v6[1];
      v22 = v5;
      *(_DWORD *)(arg2a[1] + 8) = arg2a[2];
    }
    v13 = (v5 >> 4) - 1;
    if ( v13 > 0x3F )
      v13 = 63;
    if ( (v21 & 1) != 0 )
    {
      v14 = (unsigned int)arg1;
    }
    else
    {
      arg2b = (int *)((char *)v3 - v21);
      v14 = (v21 >> 4) - 1;
      if ( v14 > 0x3F )
        v14 = 63;
      v22 = v21 + v5;
      v13 = ((v21 + v5) >> 4) - 1;
      if ( v13 > 0x3F )
        v13 = 63;
      if ( v14 != v13 )
      {
        if ( arg2b[1] == arg2b[2] )
        {
          if ( v14 >= 0x20 )
          {
            v16 = ~(0x80000000 >> (v14 - 32));
            result[v4 + 49] &= v16;
            v10 = (*((_BYTE *)result + v14 + 4))-- == 1;
            if ( v10 )
              *((_DWORD *)arg1 + 1) &= v16;
          }
          else
          {
            v15 = ~(0x80000000 >> v14);
            result[v4 + 17] &= v15;
            v10 = (*((_BYTE *)result + v14 + 4))-- == 1;
            if ( v10 )
              *(_DWORD *)arg1 &= v15;
          }
        }
        *(_DWORD *)(arg2b[2] + 4) = arg2b[1];
        *(_DWORD *)(arg2b[1] + 8) = arg2b[2];
      }
      v3 = arg2b;
    }
    if ( (v21 & 1) != 0 || v14 != v13 )
    {
      v17 = &v19[2 * v13];
      v3[1] = v17[1];
      v3[2] = (int)v17;
      v17[1] = (int)v3;
      *(_DWORD *)(v3[1] + 8) = v3;
      if ( v3[1] == v3[2] )
      {
        arg2_3 = *((_BYTE *)result + v13 + 4);
        *((_BYTE *)result + v13 + 4) = arg2_3 + 1;
        if ( v13 >= 0x20 )
        {
          if ( !arg2_3 )
            *((_DWORD *)arg1 + 1) |= 0x80000000 >> (v13 - 32);
          result[v4 + 49] |= 0x80000000 >> (v13 - 32);
        }
        else
        {
          if ( !arg2_3 )
            *(_DWORD *)arg1 |= 0x80000000 >> v13;
          result[v4 + 17] |= 0x80000000 >> v13;
        }
      }
    }
    *v3 = v22;
    *(int *)((char *)v3 + v22 - 4) = v22;
    result += 129 * v4 + 81;
    v10 = (*v19)-- == 1;
    if ( v10 )
    {
      if ( dword_4DA394 )
      {
        VirtualFree((LPVOID)(*((_DWORD *)dword_4DA394 + 3) + (dword_4DA38C << 15)), 0x8000u, 0x4000u);
        *((_DWORD *)dword_4DA394 + 2) |= 0x80000000 >> dword_4DA38C;
        *(_DWORD *)(*((_DWORD *)dword_4DA394 + 4) + 4 * dword_4DA38C + 196) = 0;
        --*(_BYTE *)(*((_DWORD *)dword_4DA394 + 4) + 67);
        v18 = (LPVOID *)dword_4DA394;
        if ( !*(_BYTE *)(*((_DWORD *)dword_4DA394 + 4) + 67) )
        {
          *((_DWORD *)dword_4DA394 + 1) &= ~1u;
          v18 = (LPVOID *)dword_4DA394;
        }
        if ( v18[2] == (LPVOID)-1 )
        {
          VirtualFree(v18[3], 0, 0x8000u);
          HeapFree(hHeap, 0, *((LPVOID *)dword_4DA394 + 4));
          crt_memmove(
            dword_4DA394,
            (char *)dword_4DA394 + 20,
            (size_t)lpMem + 20 * dword_4DA398 - (_DWORD)dword_4DA394 - 20);
          --dword_4DA398;
          if ( arg1 > dword_4DA394 )
            arg1 = (char *)arg1 - 20;
          dword_4DA390 = (int)lpMem;
        }
      }
      dword_4DA38C = v4;
      dword_4DA394 = arg1;
      return (int *)arg1;
    }
  }
  return result;
}

// crt_sbh_create_region @ 0x0046777A
// CRT small-block heap region init
int *sub_46777A()
{
  int *v0; // esi
  _DWORD *v1; // eax
  _DWORD *v2; // edi
  int *v3; // eax
  int v4; // ebp
  int v5; // edx

  if ( dword_47BB00 == -1 )
  {
    v0 = (int *)&off_47BAF0;
  }
  else
  {
    v0 = (int *)HeapAlloc(hHeap, 0, 0x2020u);
    if ( !v0 )
      return 0;
  }
  v1 = VirtualAlloc(0, 0x400000u, 0x2000u, 4u);
  v2 = v1;
  if ( !v1 )
  {
LABEL_19:
    if ( v0 != (int *)&off_47BAF0 )
      HeapFree(hHeap, 0, v0);
    return 0;
  }
  if ( !VirtualAlloc(v1, 0x10000u, 0x1000u, 4u) )
  {
    VirtualFree(v2, 0, 0x8000u);
    goto LABEL_19;
  }
  if ( v0 == (int *)&off_47BAF0 )
  {
    if ( !off_47BAF0 )
      off_47BAF0 = &off_47BAF0;
    if ( !off_47BAF4 )
      off_47BAF4 = &off_47BAF0;
  }
  else
  {
    *v0 = (int)&off_47BAF0;
    v0[1] = (int)off_47BAF4;
    off_47BAF4 = v0;
    *(_DWORD *)v0[1] = v0;
  }
  v0[5] = (int)(v2 + 0x100000);
  v3 = v0 + 6;
  v0[3] = (int)(v0 + 38);
  v0[4] = (int)v2;
  v0[2] = (int)(v0 + 6);
  v4 = 0;
  do
  {
    v5 = v4++ >= 16 ? -1 : 240;
    *v3 = v5;
    v3[1] = 241;
    v3 += 2;
  }
  while ( v4 < 1024 );
  memset(v2, 0, 0x10000u);
  while ( (unsigned int)v2 < v0[4] + 0x10000 )
  {
    *((_BYTE *)v2 + 248) = -1;
    *v2 = v2 + 2;
    v2[1] = 240;
    v2 += 1024;
  }
  return v0;
}

// FUN_004678be @ 0x004678BE
// [binja] BOOL sub_4678be(int32_t* arg1)
BOOL FUN_004678be(int *arg1)
{
  BOOL result; // eax

  result = VirtualFree((LPVOID)arg1[4], 0, 0x8000u);
  if ( off_47DB10 == (_UNKNOWN **)arg1 )
  {
    result = arg1[1];
    off_47DB10 = (_UNKNOWN **)result;
  }
  if ( arg1 == (int *)&off_47BAF0 )
  {
    dword_47BB00 = -1;
  }
  else
  {
    *(_DWORD *)arg1[1] = *arg1;
    *(_DWORD *)(*arg1 + 4) = arg1[1];
    return HeapFree(hHeap, 0, arg1);
  }
  return result;
}

// sub_467914 @ 0x00467914
void __cdecl sub_467914(int a1)
{
  _DWORD *v1; // esi
  _DWORD *v2; // edi
  int i; // ebx
  unsigned int v4; // eax
  _DWORD *v5; // ecx
  _DWORD *v6; // eax
  int j; // edx
  int v8; // [esp+Ch] [ebp-4h]

  v1 = off_47BAF4;
  do
  {
    if ( v1[4] != -1 )
    {
      v8 = 0;
      v2 = v1 + 2052;
      for ( i = 4190208; i >= 0; i -= 4096 )
      {
        if ( *v2 == 240 && VirtualFree((LPVOID)(v1[4] + i), 0x1000u, 0x4000u) )
        {
          *v2 = -1;
          --dword_4D9A70;
          v4 = v1[3];
          if ( !v4 || v4 > (unsigned int)v2 )
            v1[3] = v2;
          ++v8;
          if ( !--a1 )
            break;
        }
        v2 -= 2;
      }
      v5 = v1;
      v1 = (_DWORD *)v1[1];
      if ( v8 && v5[6] == -1 )
      {
        v6 = v5 + 8;
        for ( j = 1; j < 1024; ++j )
        {
          if ( *v6 != -1 )
            break;
          v6 += 2;
        }
        if ( j == 1024 )
          FUN_004678be((LPVOID *)v5);
      }
    }
  }
  while ( v1 != off_47BAF4 && a1 > 0 );
}

// crt_sbh_find_block @ 0x004679D6
// CRT: map a pointer to its small-block heap block header
void *crt_sbh_find_block(void *ptr, void **region_out, unsigned int *page_base)
{
  _UNKNOWN **v3; // ecx

  v3 = &off_47BAF0;
  while ( ptr <= v3[4] || ptr >= v3[5] )
  {
    v3 = (_UNKNOWN **)*v3;
    if ( v3 == &off_47BAF0 )
      return 0;
  }
  if ( ((unsigned __int8)ptr & 0xF) == 0 && ((unsigned __int16)ptr & 0xFFFu) >= 0x100 )
  {
    *region_out = v3;
    *page_base = (unsigned int)ptr & 0xFFFFF000;
    return (void *)(((int)((int)ptr - ((unsigned int)ptr & 0xFFFFF000) - 256) >> 4)
                  + ((unsigned int)ptr & 0xFFFFF000)
                  + 8);
  }
  return 0;
}

// FUN_00467a2d @ 0x00467A2D
// [binja] void* sub_467a2d(void* arg1, int32_t arg2, char* arg3)
void *FUN_00467a2d(void *arg1, int arg2, char *arg3)
{
  void *result; // eax
  bool v4; // zf

  result = (char *)arg1 + 8 * ((arg2 - *((_DWORD *)arg1 + 4)) >> 12) + 24;
  *(_DWORD *)result += (unsigned __int8)*arg3;
  *arg3 = 0;
  v4 = *(_DWORD *)result == 240;
  *((_DWORD *)result + 1) = 241;
  if ( v4 && ++dword_4D9A70 == 32 )
    sub_467914(16);
  return result;
}

// crt_sbh_alloc_units @ 0x00467A72
// allocates small-block heap blocks in 16-byte units
void *crt_sbh_alloc_units(uint blocks)
{
  _UNKNOWN **v1; // esi
  void *v2; // edx
  unsigned int *v3; // edi
  int v4; // eax
  uint v5; // ebx
  void *result; // eax
  char *v7; // edi
  _DWORD *v8; // ebx
  _DWORD *v9; // eax
  _DWORD *i; // esi
  _DWORD *v11; // ecx
  _DWORD *v12; // eax
  _UNKNOWN **v13; // eax
  bool v14; // cf
  int *region; // eax
  int v16; // ecx
  unsigned int Val; // [esp+Ch] [ebp-8h]
  int v18; // [esp+10h] [ebp-4h]
  int v19; // [esp+10h] [ebp-4h]
  int v20; // [esp+10h] [ebp-4h]

  v1 = off_47DB10;
  do
  {
    v2 = v1[4];
    if ( v2 == (void *)-1 )
    {
      v5 = blocks;
    }
    else
    {
      v3 = (unsigned int *)v1[2];
      v4 = (int)v2 + 4096 * (((char *)v3 - (char *)v1 - 24) >> 3);
      v18 = v4;
      if ( v3 < (unsigned int *)v1 + 2054 )
      {
        while ( 1 )
        {
          v5 = blocks;
          if ( (int)*v3 >= (int)blocks && v3[1] > blocks )
          {
            result = (void *)sub_467C7A(v4, *v3, blocks);
            if ( result )
            {
LABEL_21:
              off_47DB10 = v1;
              *v3 -= v5;
              v1[2] = v3;
              return result;
            }
            v4 = v18;
            v3[1] = blocks;
          }
          v3 += 2;
          v4 += 4096;
          v18 = v4;
          if ( v3 >= (unsigned int *)v1 + 2054 )
            goto LABEL_11;
        }
      }
      v5 = blocks;
LABEL_11:
      v3 = (unsigned int *)(v1 + 6);
      Val = (unsigned int)v1[2];
      v19 = (int)v1[4];
      if ( (unsigned int)(v1 + 6) < Val )
      {
        do
        {
          if ( (int)*v3 >= (int)v5 && v3[1] > v5 )
          {
            result = (void *)sub_467C7A(v19, *v3, v5);
            if ( result )
              goto LABEL_21;
            v3[1] = v5;
          }
          v19 += 4096;
          v3 += 2;
        }
        while ( (unsigned int)v3 < Val );
      }
    }
    v1 = (_UNKNOWN **)*v1;
  }
  while ( v1 != off_47DB10 );
  v7 = (char *)&off_47BAF0;
  while ( *((_DWORD *)v7 + 4) == -1 || !*((_DWORD *)v7 + 3) )
  {
    v7 = *(char **)v7;
    if ( v7 == (char *)&off_47BAF0 )
    {
      region = crt_sbh_create_region();
      if ( region )
      {
        v16 = region[4];
        *(_BYTE *)(v16 + 8) = v5;
        off_47DB10 = (_UNKNOWN **)region;
        *(_DWORD *)v16 = v16 + v5 + 8;
        *(_DWORD *)(v16 + 4) = 240 - v5;
        region[6] -= (unsigned __int8)v5;
        return (void *)(v16 + 256);
      }
      return 0;
    }
  }
  v8 = (_DWORD *)*((_DWORD *)v7 + 3);
  v20 = 0;
  v9 = v8;
  for ( i = (_DWORD *)(*((_DWORD *)v7 + 4) + (((char *)v8 - v7 - 24) >> 3 << 12)); *v9 == -1; ++v20 )
  {
    if ( v20 >= 16 )
      break;
    v9 += 2;
  }
  if ( VirtualAlloc(i, v20 << 12, 0x1000u, 4u) != i )
    return 0;
  v11 = v8;
  if ( v20 > 0 )
  {
    v12 = i + 1;
    do
    {
      *((_BYTE *)v12 + 244) = -1;
      *(v12 - 1) = v12 + 1;
      *v12 = 240;
      *v11 = 240;
      v11[1] = 241;
      v12 += 1024;
      v11 += 2;
      --v20;
    }
    while ( v20 );
  }
  off_47DB10 = (_UNKNOWN **)v7;
  v13 = (_UNKNOWN **)(v7 + 8216);
  while ( 1 )
  {
    v14 = v11 < v13;
    if ( v11 >= v13 )
      break;
    if ( *v11 == -1 )
    {
      v14 = v11 < v13;
      break;
    }
    v11 += 2;
  }
  *((_DWORD *)v7 + 3) = v14 ? v11 : 0;
  *((_BYTE *)i + 8) = blocks;
  *((_DWORD *)v7 + 2) = v8;
  *v8 -= blocks;
  i[1] -= blocks;
  *i = (char *)i + blocks + 8;
  return i + 64;
}

// sub_467C7A @ 0x00467C7A
int __cdecl sub_467C7A(int a1, unsigned int a2, unsigned int a3)
{
  unsigned int v4; // esi
  _BYTE *v5; // edi
  unsigned int v6; // ebx
  _BYTE *v7; // eax
  _BYTE *v8; // eax
  _BYTE *v9; // esi
  _BYTE *v10; // ebx
  unsigned int v11; // esi
  _BYTE *v12; // esi
  _BYTE *v13; // ebx
  unsigned int v14; // eax
  _BYTE *v16; // [esp+Ch] [ebp-4h]
  unsigned int v17; // [esp+18h] [ebp+8h]

  v4 = *(_DWORD *)(a1 + 4);
  v5 = *(_BYTE **)a1;
  v6 = a1 + 248;
  v16 = *(_BYTE **)a1;
  v7 = *(_BYTE **)a1;
  v17 = a1 + 248;
  if ( v4 >= a3 )
  {
    *v5 = a3;
    if ( (unsigned int)&v5[a3] >= v6 )
    {
      *(_DWORD *)(a1 + 4) = 0;
      *(_DWORD *)a1 = a1 + 8;
    }
    else
    {
      *(_DWORD *)a1 += a3;
      *(_DWORD *)(a1 + 4) -= a3;
    }
    v8 = v5 + 8;
    return 16 * (_DWORD)v8 - 15 * a1;
  }
  v9 = &v5[v4];
  if ( *v9 )
    v7 = v9;
  if ( (unsigned int)&v7[a3] >= v6 )
  {
LABEL_20:
    v12 = (_BYTE *)(a1 + 8);
    while ( v12 < v5 && (unsigned int)&v12[a3] < v17 )
    {
      if ( *v12 )
      {
        v12 += (unsigned __int8)*v12;
      }
      else
      {
        v13 = v12 + 1;
        v14 = 1;
        while ( !*v13 )
        {
          ++v13;
          ++v14;
        }
        if ( v14 >= a3 )
        {
          if ( (unsigned int)&v12[a3] >= v17 )
          {
            *(_DWORD *)(a1 + 4) = 0;
            *(_DWORD *)a1 = a1 + 8;
          }
          else
          {
            *(_DWORD *)a1 = &v12[a3];
            *(_DWORD *)(a1 + 4) = v14 - a3;
          }
          *v12 = a3;
          v8 = v12 + 8;
          return 16 * (_DWORD)v8 - 15 * a1;
        }
        a2 -= v14;
        if ( a2 < a3 )
          return 0;
        v12 = v13;
      }
    }
    return 0;
  }
  while ( *v7 )
  {
    v7 += (unsigned __int8)*v7;
LABEL_19:
    if ( (unsigned int)&v7[a3] >= v17 )
      goto LABEL_20;
  }
  v10 = v7 + 1;
  v11 = 1;
  while ( !*v10 )
  {
    ++v10;
    ++v11;
  }
  if ( v11 < a3 )
  {
    if ( v7 == v16 )
    {
      *(_DWORD *)(a1 + 4) = v11;
    }
    else
    {
      a2 -= v11;
      if ( a2 < a3 )
        return 0;
    }
    v5 = v16;
    v7 = v10;
    goto LABEL_19;
  }
  if ( (unsigned int)&v7[a3] >= v17 )
  {
    *(_DWORD *)(a1 + 4) = 0;
    *(_DWORD *)a1 = a1 + 8;
  }
  else
  {
    *(_DWORD *)a1 = &v7[a3];
    *(_DWORD *)(a1 + 4) = v11 - a3;
  }
  *v7 = a3;
  v8 = v7 + 8;
  return 16 * (_DWORD)v8 - 15 * a1;
}

// FUN_00467d9e @ 0x00467D9E
// [binja] int32_t sub_467d9e(void* arg1, void** arg2, char* arg3, int32_t arg4)
int FUN_00467d9e(void *arg1, void **arg2, char *arg3, int arg4)
{
  unsigned int v4; // ecx
  _DWORD *v5; // edi
  char *v6; // esi
  char *i; // eax
  bool v8; // zf
  char *v9; // eax
  int v11; // [esp+Ch] [ebp-4h]

  v4 = (unsigned __int8)*arg3;
  v11 = 0;
  v5 = (char *)arg1 + 8 * (((int)arg2 - *((_DWORD *)arg1 + 4)) >> 12) + 24;
  if ( v4 > arg4 )
  {
    *arg3 = arg4;
    *v5 += v4 - arg4;
    v5[1] = 241;
    return 1;
  }
  if ( v4 < arg4 )
  {
    v6 = &arg3[arg4];
    if ( &arg3[arg4] <= (char *)arg2 + 248 )
    {
      for ( i = &arg3[v4]; ; ++i )
      {
        v8 = i == v6;
        if ( i >= v6 )
          break;
        if ( *i )
        {
          v8 = i == v6;
          break;
        }
      }
      if ( v8 )
      {
        *arg3 = arg4;
        if ( arg3 <= *arg2 && v6 > *arg2 )
        {
          if ( v6 >= (char *)arg2 + 248 )
          {
            arg2[1] = 0;
            *arg2 = arg2 + 2;
          }
          else
          {
            v9 = 0;
            *arg2 = v6;
            if ( !*v6 )
            {
              do
                ++v9;
              while ( !v9[(_DWORD)v6] );
            }
            arg2[1] = v9;
          }
        }
        *v5 += v4 - arg4;
        return 1;
      }
    }
  }
  return v11;
}

// crt_report_runtime_error @ 0x00468DDC
// formats and displays CRT runtime errors
int *__cdecl sub_468DDC(DWORD NumberOfBytesWritten)
{
  int v1; // ecx
  int *result; // eax
  int v3; // esi
  char *v4; // edi
  const char **v5; // esi
  HANDLE StdHandle; // eax
  const char *v7; // [esp-14h] [ebp-1B8h]
  DWORD v8; // [esp-10h] [ebp-1B4h]
  DWORD *p_NumberOfBytesWritten; // [esp-Ch] [ebp-1B0h]
  int v10; // [esp-8h] [ebp-1ACh]
  CHAR Filename[260]; // [esp+0h] [ebp-1A4h] BYREF
  char Destination[160]; // [esp+104h] [ebp-A0h] BYREF
  int savedregs; // [esp+1A4h] [ebp+0h] BYREF

  v1 = 0;
  result = dword_47DB28;
  do
  {
    if ( NumberOfBytesWritten == *result )
      break;
    result += 2;
    ++v1;
  }
  while ( result < (int *)&dbl_47DBB8 );
  v3 = 2 * v1;
  if ( NumberOfBytesWritten == dword_47DB28[2 * v1] )
  {
    result = (int *)dword_4D99CC;
    if ( dword_4D99CC == 1 || !dword_4D99CC && dword_47B184 == 1 )
    {
      v5 = (const char **)&(&off_47DB2C)[v3];
      v10 = 0;
      p_NumberOfBytesWritten = &NumberOfBytesWritten;
      v8 = strlen(*v5);
      v7 = *v5;
      StdHandle = GetStdHandle(0xFFFFFFF4);
      return (int *)WriteFile(StdHandle, v7, v8, &NumberOfBytesWritten, 0);
    }
    else if ( NumberOfBytesWritten != 252 )
    {
      if ( !GetModuleFileNameA(0, Filename, 0x104u) )
        crt_strcpy(Filename, "<program name unknown>");
      v4 = Filename;
      if ( strlen(Filename) + 1 > 0x3C )
      {
        v4 = (char *)&savedregs + strlen(Filename) - 479;
        strncpy(v4, "...", 3u);
      }
      crt_strcpy(Destination, "Runtime Error!\n\nProgram: ");
      crt_strcat(Destination, v4);
      crt_strcat(Destination, "\n\n");
      crt_strcat(Destination, (&off_47DB2C)[v3]);
      return (int *)FUN_0046d5e3(Destination, "Microsoft Visual C++ Runtime Library", 73744);
    }
  }
  return result;
}

// FUN_0046a318 @ 0x0046A318
// [binja] int32_t sub_46a318(int16_t* arg1, int32_t* arg2)
int FUN_0046a318(__int16 *arg1, int *arg2)
{
  return FUN_0046a1ac(arg1, arg2, &dword_47DCE0);
}

// FUN_0046a32e @ 0x0046A32E
// [binja] int32_t sub_46a32e(int16_t* arg1, int32_t* arg2)
int FUN_0046a32e(__int16 *arg1, int *arg2)
{
  return FUN_0046a1ac(arg1, arg2, &dword_47DCF8);
}

// sub_46A344 @ 0x0046A344
int __cdecl sub_46A344(int a1, int a2)
{
  _BYTE v3[12]; // [esp+0h] [ebp-Ch] BYREF

  crt_fp_parse(v3, &a2, a2, 0, 0, 0, 0);
  return FUN_0046a318((int)v3, a1);
}

// sub_46A371 @ 0x0046A371
int __cdecl sub_46A371(int a1, int a2)
{
  _BYTE v3[12]; // [esp+0h] [ebp-Ch] BYREF

  crt_fp_parse(v3, &a2, a2, 0, 0, 0, 0);
  return FUN_0046a32e((int)v3, a1);
}

// sub_46D66C @ 0x0046D66C
int sub_46D66C()
{
  return 0;
}

// sub_46D6B5 @ 0x0046D6B5
LONG (__stdcall *sub_46D6B5())(struct _EXCEPTION_POINTERS *ExceptionInfo)
{
  LONG (__stdcall *result)(struct _EXCEPTION_POINTERS *); // eax

  result = SetUnhandledExceptionFilter(FUN_0046d66f);
  lpfn = result;
  return result;
}

// sub_46D6C6 @ 0x0046D6C6
LPTOP_LEVEL_EXCEPTION_FILTER sub_46D6C6()
{
  return SetUnhandledExceptionFilter(lpfn);
}
